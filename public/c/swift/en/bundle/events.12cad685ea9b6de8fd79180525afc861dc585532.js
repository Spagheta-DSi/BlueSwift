define("app/ui/media/media_thumbnails",["module","require","exports","core/component","app/utils/image_thumbnail","app/ui/media/with_flag_action","core/i18n"],function(module, require, exports) {
function mediaThumbnails(){var a=800,b={NOT_LOADED:"not-loaded",RESOLVING:"resolving",LOADED:"loaded"};this.defaultAttrs({defaultGalleryTitle:_('Media Gallery'),thumbnailSelector:".media-thumbnail",thumbnailContainerSelector:".photo-list",thumbnailNotLoadedSelector:'.media-thumbnail[data-load-status="'+b.NOT_LOADED+'"]',thumbnailResolvingSelector:'.media-thumbnail[data-load-status="'+b.RESOLVING+'"]',thumbnailLoadedSelector:'.media-thumbnail[data-load-status="'+b.LOADED+'"]',viewAllSelector:".list-link .media-header",filterPhotos:!1,thumbnailType:"small",captureThumbClick:!0,shouldUpdateThumbs:!1}),this.hasPublishedVisibleThumbsFlag=!1,this.hasFinishedLoadingFlag=!1,this.setThumbStatus=function(a,b){a.attr("data-load-status",b)},this.initThumbs=function(){var a=this.select("thumbnailSelector");if(!a.length)return this.publishVisibleThumbs(),this.hideThumbs();this.loadThumbs()},this.reloadThumbs=function(a,b){this.hasFinishedLoadingFlag=!1,this.hasPublishedVisibleThumbsFlag=!1,this.loadThumbs()},this.loadThumbs=function(a){var c=a||"photo",d=this.select("thumbnailSelector");this.setThumbStatus(d,b.NOT_LOADED);var e=d.slice(0,this.attr.thumbnailsVisible);this.loadThumbSet(e)},this.loadThumbSet=function(a){this.setThumbStatus(a,b.RESOLVING);for(var c=0;c<a.length;c++)this.resolveThumbUrl(a[c])},this.updateThumbs=function(a,b){var c=$(b.thumbnails.join(""));c.prependTo(this.select("thumbnailContainerSelector")),this.loadThumbSet(c)},this.hideThumbs=function(){this.$node.hide()},this.resolveThumbUrl=function(a){var c=$(a);this.setThumbStatus(c,b.RESOLVING),this.resolveThumbCallback(!0,c)},this.resolveThumbCallback=function(a,b){a?this.loadThumb(b):this.thumbFailed(b)},this.thumbFailed=function(a){a.remove(),this.loadNextThumb(),this.checkLoadingStatus()},this.thumbSucceeded=function(c,d){this.setThumbStatus(c,b.LOADED),d.css(imageThumbnail.getThumbnailOffset(d.get(0).height,d.get(0).width,this.attr.thumbnailSize)),d.css("opacity",0),c.append(d),d.animate({opacity:1},a),this.checkLoadingStatus()},this.loadNextThumb=function(){var a=this.select("thumbnailNotLoadedSelector");a.length&&this.resolveThumbUrl(a[0])},this.loadThumb=function(a){var b=this,c=$("<img/>"),d=this.attr.filterPhotos?"photo":"video";c.on("load",function(d){b.thumbSucceeded(a,c)}),c.on("error",function(c){b.thumbFailed(a)}),c.attr("src",a.attr("data-resolved-url-"+this.attr.thumbnailType))},this.checkLoadingStatus=function(){if(this.hasFinishedLoading()){this.publishVisibleThumbs();var a=this.select("thumbnailSelector");a.length||this.hideThumbs()}},this.hasFinishedLoading=function(){if(this.hasFinishedLoadingFlag)return!0;var a,b,c;return a=this.select("thumbnailLoadedSelector"),a.length>=this.attr.thumbnailsVisible?this.hasFinishedLoadingFlag=!0:(b=this.select("thumbnailResolvingSelector"),c=this.select("thumbnailNotLoadedSelector"),!b.length&&!c.length&&(this.hasFinishedLoadingFlag=!0)),this.hasFinishedLoadingFlag},this.publishVisibleThumbs=function(){if(this.hasPublishedVisibleThumbsFlag)return;var a={thumbnails:[]};this.select("thumbnailLoadedSelector").each(function(b,c){a.thumbnails.push($(c).attr("data-url"))}),this.trigger("uiMediaThumbnailsVisible",a),this.hasPublishedVisibleThumbsFlag=!0},this.mediaThumbnailClick=function(a,b){var c=$(b.el),d=c.attr("data-href"),e=c.attr("data-url"),f=c.hasClass("video")?"video":"photo";this.trigger("uiMediaThumbnailClick",{url:e,mediaType:f}),a.stopPropagation(),this.visitLink(a,d)},this.visitLink=function(a,b){a.preventDefault(),this.trigger(a.target,"uiOpenGallery",{title:this.attr.defaultGalleryTitle})},this.viewAllClick=function(a){this.trigger("uiMediaViewAllClick")},this.after("initialize",function(){this.on("uiReloadThumbs",this.reloadThumbs),this.on("click",{viewAllSelector:this.viewAllClick,thumbnailSelector:this.mediaThumbnailClick}),this.attr.shouldUpdateThumbs&&this.on(document,"uiMediaThumbnailGotNewItems",this.updateThumbs),this.initThumbs()})}var defineComponent=require("core/component"),imageThumbnail=require("app/utils/image_thumbnail"),withFlagAction=require("app/ui/media/with_flag_action"),_=require("core/i18n"),MediaThumbnails=defineComponent(withFlagAction,mediaThumbnails);module.exports=MediaThumbnails
});
define("app/ui/timelines/event_timeline",["module","require","exports","core/component","core/clock","core/utils","app/ui/timelines/with_traveling_ptw","app/utils/string"],function(module, require, exports) {
var defineComponent=require("core/component"),clock=require("core/clock"),utils=require("core/utils"),withTravelingPTw=require("app/ui/timelines/with_traveling_ptw"),string=require("app/utils/string");module.exports=defineComponent(withTravelingPTw,function(){this.defaultAttrs({streamItemsSelector:".stream-items"}),this.modifyNewTimelineRequest=function(a,b){if(b.since_id&&!b.hasModified){a.stopPropagation();var c=string.compare(b.since_id,this.photoSinceId)>0?b.since_id:this.photoSinceId;this.trigger("uiWantsMoreTimelineItems",utils.merge(b,{hasModified:!0,since_id:c,curated_timeline_since_id:this.curatedTimelineSinceId}))}},this.dedupe=function(a,b){var c=$(b),d=c.parent(),e=c.attr("data-tweet-id");return a[e]&&!d.hasClass("preexpanded")?d.remove():a[e]=!0,a},this.checkInjectedItem=function(a){var b=$(a.target);this.autoplay||(b.hasClass("preexpanded")&&b.index()!==0&&b.prev().removeClass("before-expanded").end().prevUntil(".open").last().before(b.detach()),this.itemIds=this.dedupe(this.itemIds,b.find(".tweet")[0]))},this.gotMoreItems=function(a,b){b.new_photos_html&&(this.trigger("uiMediaThumbnailGotNewItems",{thumbnails:b.new_photos_html}),this.photoSinceId=$(b.new_photos_html[0]).attr("data-status-id")||"0"),b.curated_timeline_since_id&&(this.curatedTimelineSinceId=b.curated_timeline_since_id)},this.after("initialize",function(){this.curatedTimelineSinceId=this.attr.curated_timeline_since_id,this.itemIds=this.$node.find(".tweet").toArray().reduce(this.dedupe,{}),this.on("uiWantsMoreTimelineItems",this.modifyNewTimelineRequest),this.photoSinceId="0",this.autoplay=this.attr.autoplay,this.on("uiHasDisabledAutoplay",function(){this.autoplay=!1}),this.on("uiHasEnabledAutoplay",function(){this.autoplay=!0}),this.on("uiHasInjectedTimelineItem",this.checkInjectedItem),this.on("uiHasInjectedNewTimeline",this.movePromotedToTop),clock.setTimeoutEvent("uiTimelineShouldRefresh",5e3,{fromPolling:!0}),this.on("dataGotMoreTimelineItems",this.gotMoreItems)})})
});
define("app/ui/page_visibility",["module","require","exports","core/clock","core/component"],function(module, require, exports) {
function PageVisibility(){this.defaultAttrs({heartBeat:0,doc:document,isIe:$.browser.msie});var a,b=!1;this.visibilityChange=function(c){var d;switch(c.type){case"focus":case"focusin":d=!1;break;case"blur":case"focusout":d=!0;break;case"beforeunload":this.trigger("uiPageUnload");break;default:a&&(d=this.attr.doc[a])}d===!0?(b=!0,this.trigger("uiPageHidden")):d===!1&&(b=!1,this.trigger("uiPageVisible"))},this.focusTick=function(){b||this.trigger("uiPageVisible")},this.after("initialize",function(){var b={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",webkitHidden:"webkitvisibilitychange",msHidden:"msvisibilitychange"},c=!1;for(var d in b)d in this.attr.doc&&(a=d,this.on(this.attr.doc,b[a],this.visibilityChange),c=!0);c||(this.attr.isIe?(this.on(this.attr.doc,"focusin",this.visibilityChange),this.on(this.attr.doc,"focusout",this.visibilityChange)):(this.on(window,"focus",this.visibilityChange),this.on(window,"blur",this.visibilityChange))),this.on(window,"beforeunload",this.visibilityChange),this.attr.heartBeat&&(this.timer=clock.setIntervalEvent("uiPageFocusTick",this.attr.heartBeat),this.on("uiPageFocusTick",this.focusTick))})}var clock=require("core/clock"),defineComponent=require("core/component");module.exports=defineComponent(PageVisibility)
});
define("app/data/page_visibility_scribe",["module","require","exports","core/component","app/data/with_scribe"],function(module, require, exports) {
function PageVisibilityScribe(){this.scribePageHidden=function(a,b){this.scribe({action:"hide"},b)},this.scribePageVisible=function(a,b){this.scribe({action:"show"},b)},this.scribePageUnload=function(a,b){this.scribe({action:"complete"},b)},this.after("initialize",function(){this.on(document,"uiPageHidden",this.scribePageHidden),this.on(document,"uiPageVisible",this.scribePageVisible),this.on(document,"uiPageUnload",this.scribePageUnload)})}var defineComponent=require("core/component"),withScribe=require("app/data/with_scribe");module.exports=defineComponent(PageVisibilityScribe,withScribe)
});
define("app/pages/events/hashtag",["module","require","exports","app/boot/app","core/utils","core/i18n","app/ui/media/media_thumbnails","app/data/media_thumbnails_scribe","app/ui/dashboard_tweetbox","app/boot/logged_out","app/boot/tweet_timeline","app/ui/timelines/event_timeline","core/component","app/ui/with_item_actions","app/ui/with_user_actions","app/utils/cookie","app/data/client_event","app/ui/page_visibility","app/data/page_visibility_scribe"],function(module, require, exports) {
var bootApp=require("app/boot/app"),utils=require("core/utils"),_=require("core/i18n"),MediaThumbnails=require("app/ui/media/media_thumbnails"),MediaThumbnailsScribe=require("app/data/media_thumbnails_scribe"),DashboardTweetbox=require("app/ui/dashboard_tweetbox"),loggedOutBoot=require("app/boot/logged_out"),tweetTimelineBoot=require("app/boot/tweet_timeline"),EventTimeline=require("app/ui/timelines/event_timeline"),defineComponent=require("core/component"),withItemActions=require("app/ui/with_item_actions"),withUserActions=require("app/ui/with_user_actions"),cookie=require("app/utils/cookie"),clientEvent=require("app/data/client_event"),PageVisibility=require("app/ui/page_visibility"),PageVisibilityScribe=require("app/data/page_visibility_scribe");module.exports=function(a){bootApp(a);var b=function(b){return a.autoplay_timeline?utils.merge(b,{autoplay:!0,travelingPTw:!0}):b};loggedOutBoot(a),tweetTimelineBoot(b(a),a.timeline_url,"tweet"),clientEvent.scribeData.query=a.event,EventTimeline.attachTo("#timeline",b(a)),defineComponent(withItemActions,withUserActions).attachTo("#top-people",{itemType:"user",loggedIn:a.loggedIn,eventData:{scribeContext:{component:"top_people"}}}),MediaThumbnailsScribe.attachTo(document),MediaThumbnails.attachTo(".photo-strip",{sandboxes:a.sandboxes,defaultGalleryTitle:_('Photos of {{event}}',{event:a.event}),thumbnailSize:112,thumbnailsVisible:7,thumbnailType:"medium",captureThumbClick:!1,shouldUpdateThumbs:!0,eventData:{scribeContext:{component:"events_media"}}}),DashboardTweetbox.attachTo(".profile-tweet-box",{draftTweetId:"event_"+a.event,prependText:"",defaultTextFrom:"data-hashtag",eventData:{scribeContext:{component:"tweet_box"}}}),PageVisibility.attachTo(document,{heartBeat:6e5,eventData:{scribeContext:{component:"page_visibility"}}}),PageVisibilityScribe.attachTo(document),cookie("noReroute_"+a.event,null,{path:"/"})}
});