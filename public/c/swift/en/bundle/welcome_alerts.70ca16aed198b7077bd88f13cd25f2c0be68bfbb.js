define("app/ui/welcome/alerts/download_form",["module","require","exports","core/component"],function(module, require, exports) {
function downloadForm(){this.defaultAttrs({downloadSelector:"#download",skipDownloadSelector:"#skip_download"}),this.onDownloadClick=function(a){this.trigger("uiDownloadClick")},this.onSkipDownloadClick=function(a){this.trigger("uiSkipDownloadClick")},this.after("initialize",function(){this.on("click",{downloadSelector:this.onDownloadClick,skipDownloadSelector:this.onSkipDownloadClick})})}var defineComponent=require("core/component"),DownloadForm=defineComponent(downloadForm);module.exports=DownloadForm
});
define("app/data/welcome/welcome_alerts_download_scribe",["module","require","exports","core/component","app/data/with_scribe"],function(module, require, exports) {
function welcomeAlertsDownloadScribe(){this.scribeDownloadClick=function(a,b){this.scribe({component:"download",element:"form",action:"download_click"},b)},this.scribeSkipDownloadClick=function(a,b){this.scribe({component:"download",element:"form",action:"skip_download_click"},b)},this.after("initialize",function(){this.on("uiDownloadClick",this.scribeDownloadClick),this.on("uiSkipDownloadClick",this.scribeSkipDownloadClick)})}var defineComponent=require("core/component"),withScribe=require("app/data/with_scribe");module.exports=defineComponent(welcomeAlertsDownloadScribe,withScribe)
});
define("app/pages/welcome/alerts/download",["module","require","exports","app/boot/common","app/ui/welcome/alerts/download_form","app/data/welcome/welcome_alerts_download_scribe"],function(module, require, exports) {
var boot=require("app/boot/common"),DownloadForm=require("app/ui/welcome/alerts/download_form"),WelcomeAlertsDownloadScribe=require("app/data/welcome/welcome_alerts_download_scribe");module.exports=function(a){boot(a),WelcomeAlertsDownloadScribe.attachTo(document,a),DownloadForm.attachTo("#download-form")}
});
define("app/ui/alert_banner",["module","require","exports","core/component"],function(module, require, exports) {
function alertBanner(){this.defaultAttrs({closeSelector:"#settings-alert-close",bannerSelector:"h4,p",listenToShow:!0}),this.showBanner=function(a,b){$(window).scrollTop(0),this.select("bannerSelector").remove(),this.$node.append($("<h4>").text(b.message)),this.$node.show()},this.closeBanner=function(){this.select("bannerSelector").remove(),this.$node.hide()},this.after("initialize",function(){this.attr.listenToShow&&this.on(document,"uiAlertBanner",this.showBanner),this.on(document,"uiAlertBannerClose",this.closeBanner),this.on(this.attr.closeSelector,"click",this.closeBanner)})}var defineComponent=require("core/component"),AlertBanner=defineComponent(alertBanner);module.exports=AlertBanner
});
define("app/ui/forms/with_submit_disable",["module","require","exports"],function(module, require, exports) {
function withSubmitDisable(){this.defaultAttrs({submit:":input[type=submit]"}),this.enable=function(){this.isDisabled&&this.$submit.attr("disabled",!1),this.isDisabled=!1},this.disable=function(){this.isDisabled||this.$submit.attr("disabled",!0),this.isDisabled=!0},this.setInitialState=function(){this.$submit=this.select("submit"),this.isDisabled=!1,this.disable()},this.after("initialize",function(){this.on(document,"uiSwiftLoaded uiPageChanged",this.setInitialState),this.on("dataFormValueModified",this.enable),this.on("dataFormValueInit dataFormValueReset",this.disable)})}module.exports=withSubmitDisable
});
define("app/ui/forms/form_value_modification",["module","require","exports","core/component","app/ui/forms/with_submit_disable"],function(module, require, exports) {
function formValueModification(){function a(a,b){var c=Object.keys(a),d=Object.keys(b);return c.concat($.makeArray($(d).not(c)))}function b(b,c){var d=a(b,c);return d.every(function(a){return h(b[a],c[a])})}function c(a){return!!a.name}function d(a){return[a.name,f(a)]}function e(a,b){var c=b[0],d=b[1];return g(d)?a:(a[c]!==undefined?Array.isArray(a[c])?a[c].push(d):a[c]=[a[c],d]:a[c]=d,a)}function f(a){var b=$(a);return b.is("[type=checkbox],[type=radio]")?b.is(":checked")?b.val():undefined:b.val()}function g(a){return a===undefined||String(a).length===0}function h(a,b){return Array.isArray(a)&&Array.isArray(b)?$(a).not(b).length===0&&$(b).not(a).length===0:g(a)&&g(b)?!0:a===b}this.defaultAttrs({fields:":input"}),this.after("initialize",function(){this.initialValues=this.currentValues(),this.isModified=!1,this.trigger("dataFormValueInit"),this.on("change keyup",{fields:this.onChange})}),this.dataModified=function(){this.trigger("dataFormValueModified"),this.isModified=!0},this.dataUnchanged=function(){this.isModified&&this.trigger("dataFormValueReset"),this.isModified=!1},this.currentValues=function(){return $.makeArray(this.select("fields")).filter(c).map(d).reduce(e,{})},this.onChange=function(a){if($(a.target).is("[type=file]")){this.dataModified(),this.off("change keyup");return}b(this.currentValues(),this.initialValues)?this.dataUnchanged():this.dataModified()}}var defineComponent=require("core/component"),withSubmitDisable=require("app/ui/forms/with_submit_disable"),FormValueModification=defineComponent(formValueModification,withSubmitDisable);module.exports=FormValueModification
});
define("app/ui/forms/select_box",["module","require","exports","core/component"],function(module, require, exports) {
function selectBox(){this.clickItems=function(a,b){this.trigger("uiItemClick")},this.itemSelect=function(){var a,b={index:this.node.selectedIndex},c,d;if(this.node.selectedIndex>=0){d=this.node.options[this.node.selectedIndex];for(c=0;c<d.attributes.length;c++)a=d.attributes[c].name,b[a]=d.attributes[c].value;b.text=d.innerHTML}this.trigger("uiItemSelect",b)},this.setItems=function(a,b){this.$node.empty(),b.items&&b.items.forEach(function(a){var b=$("<option />"),c;for(c in a)c=="text"?b.html(a[c]):b.attr(c,a[c]);b.appendTo(this.$node)}.bind(this)),this.itemSelect()},this.after("initialize",function(){this.node.jquery&&(this.node=this.node[0]),this.attr.items&&this.node.trigger("setItems",{items:this.attr.items}),this.on("setItems",this.setItems),this.on("change",this.itemSelect),this.on("mousedown",this.clickItems)})}var defineComponent=require("core/component");module.exports=defineComponent(selectBox)
});
define("app/ui/welcome/alerts/phone_create_form",["module","require","exports","core/component","app/ui/forms/select_box","core/utils"],function(module, require, exports) {
function phoneCreateForm(){this.defaultAttrs({regionsWithHiddenCarrier:[],carrierNameSelector:"#device_carrier_name",countryCodeDisplaySelector:"#country_code_display",countryCodeValueSelector:"#device_country_intl_prefix",chooseCarrierSelector:"#choose-carrier",chooseCountrySelector:"#choose-country",regionCountryCodeValueSelector:"#region_country_code",submitButtonSelector:"#activate_phone",skipActivationSelector:"#skip_activation"}),this.onUiCarrierChange=function(a,b){this.$carrierName.attr("value",b.text)},this.onUiCountryChange=function(a,b){this.setCountry(b.text,b.value,b["data-region"])},this.onUiCreatePhoneClick=function(a){var b={};this.$node.serializeArray().forEach(function(a){b[a.name]=a.value}),this.trigger("uiCreatePhoneClick"),this.trigger("uiWantsCreatePhone",b),a.preventDefault()},this.onUiSkipActivationClick=function(a){this.trigger("uiSkipActivationClick")},this.onDataCreatePhoneSuccess=function(a,b){this.trigger("uiAlertBannerClose"),this.$node.addClass("hidden")},this.onDataCreatePhoneError=function(a,b){this.trigger("uiAlertBanner",{message:b.notice})},this.onDataCancelPhoneVerificationSuccess=function(){this.$node.removeClass("hidden")},this.setCountry=function(a,b,c){this.$countryCodeDisplay.text(b),this.$countryCodeValue.attr("value",b),this.$regionCountryCodeValue.attr("value",c?b:""),this.countryName=a,this.updateCarrierList(c)},this.updateCarrierList=function(a){var b=this.attr.carrierInfo.carriers[this.countryName];if(!b){this.$carrierName.attr("value",""),this.trigger(this.$chooseCarrierSelect,"setItems",{}),this.$chooseCarrier.hide();return}b=b.map(function(a){return a.display&&!a.text&&(a.text=a.display,delete a.display),a.features&&(a=utils.merge(a,a.features)),a}.bind(this)),this.trigger(this.$chooseCarrierSelect,"setItems",{items:b}),a&&this.attr.regionsWithHiddenCarrier.indexOf(a)>=0?this.$chooseCarrier.hide():this.$chooseCarrier.show()},this.after("initialize",function(){this.carrierInfo=this.attr.carrierInfo,this.$carrierName=this.select("carrierNameSelector"),this.$chooseCarrier=this.select("chooseCarrierSelector"),this.$chooseCountry=this.select("chooseCountrySelector"),this.$countryCodeValue=this.select("countryCodeValueSelector"),this.$countryCodeDisplay=this.select("countryCodeDisplaySelector"),this.$regionCountryCodeValue=this.select("regionCountryCodeValueSelector"),this.$chooseCarrierSelect=this.$chooseCarrier.find("select"),SelectBox.attachTo(this.$chooseCarrierSelect),this.on(this.$chooseCarrierSelect,"uiItemSelect",this.onUiCarrierChange),this.$chooseCountrySelect=this.$chooseCountry.find("select"),SelectBox.attachTo(this.$chooseCountrySelect),this.on(this.$chooseCountrySelect,"uiItemSelect",this.onUiCountryChange),this.setCountry(this.attr.defaultCountry.country,this.attr.defaultCountry.code,null),this.on("click",{submitButtonSelector:this.onUiCreatePhoneClick,skipActivationSelector:this.onUiSkipActivationClick}),this.on(this.$node,"submit",this.onUiCreatePhoneClick),this.$node.addClass("ready"),this.on(document,"dataCreatePhoneSuccess",this.onDataCreatePhoneSuccess),this.on(document,"dataCreatePhoneError",this.onDataCreatePhoneError),this.on(document,"dataCancelPhoneVerificationSuccess",this.onDataCancelPhoneVerificationSuccess)})}var defineComponent=require("core/component"),SelectBox=require("app/ui/forms/select_box"),utils=require("core/utils"),PhoneCreateForm=defineComponent(phoneCreateForm);module.exports=PhoneCreateForm
});
define("app/ui/welcome/alerts/phone_verify_form",["module","require","exports","core/i18n","core/component","core/clock"],function(module, require, exports) {
function phoneVerifyForm(){this.defaultAttrs({nextStepUrl:"/welcome/alerts/download",pollInterval:1e4,cancelButtonSelector:"#cancel_verification",deviceAddressSelector:"span.device_address",deviceGoCommandSelector:"span.device_go_command",deviceShortCodeSelector:"span.device_short_code"}),this.populateAndShowVerificationForm=function(a,b){var c=b.devices[0],d=b.settings[0];this.attr.deviceId=c.id,this.$deviceGoCommand.text(d.go_command.string),this.$deviceShortCode.text(d.short_code),this.$deviceAddress.text(c.address),this.$node.removeClass("hidden"),this.attr.verificationCanceled=!1,window.scrollTo(0,1),this.trigger("uiCheckPhoneStatus")},this.cancelPhoneVerification=function(a){var b={device_id:this.attr.deviceId,device_type:"phone"};this.attr.verificationCanceled=!0,this.trigger("uiWantsCancelPhoneVerification",b),a.preventDefault()},this.hideNode=function(){this.$node.addClass("hidden")},this.displayVerificationError=function(a){this.trigger("uiAlertBanner",{message:_('Error canceling verification. Please try again.')})},this.onUiCheckPhoneStatus=function(){this.attr.verificationCanceled||this.trigger("uiWantsVerifyPhone",{device_id:this.attr.deviceId})},this.onDataVerifyPhoneSuccess=function(a,b){var c;if(!this.attr.verificationCanceled&&!b.verified&&!b.error){clock.setTimeoutEvent("uiCheckPhoneStatus",this.attr.pollInterval);return}if(b.error){this.trigger("uiAlertBanner",{message:_('Error verifying phone. Please try again.')});return}this.trigger("uiPhoneVerificationSuccess"),this.trigger("uiNavigate",{href:this.attr.nextStepUrl})},this.after("initialize",function(){this.$deviceAddress=this.select("deviceAddressSelector"),this.$deviceGoCommand=this.select("deviceGoCommandSelector"),this.$deviceShortCode=this.select("deviceShortCodeSelector"),this.on("click",{cancelButtonSelector:this.cancelPhoneVerification}),this.on(document,"dataCreatePhoneSuccess",this.populateAndShowVerificationForm),this.on(document,"dataCancelPhoneVerificationSuccess",this.hideNode),this.on(document,"dataCancelPhoneVerificationError",this.displayVerificationError),this.on(document,"uiCheckPhoneStatus",this.onUiCheckPhoneStatus),this.on(document,"dataVerifyPhoneSuccess",this.onDataVerifyPhoneSuccess)})}var _=require("core/i18n"),defineComponent=require("core/component"),clock=require("core/clock"),PhoneVerifyForm=defineComponent(phoneVerifyForm);module.exports=PhoneVerifyForm
});
define("app/ui/welcome/alerts/phone_verified_form",["module","require","exports","core/i18n","core/component"],function(module, require, exports) {
function phoneVerifiedForm(){this.defaultAttrs({deviceId:null,nextStepUrl:"/welcome/alerts/download",enableTwitterAlertsSmsSelector:"#enable_twitter_alerts_sms",changePhoneSelector:"#change_phone"}),this.enableTwitterAlertsSms=function(a){this.trigger("uiWantsEnableTwitterAlertsSms",{device_id:this.attr.deviceId,device:{lifeline_alerts_enabled:1}}),a.preventDefault()},this.onChangePhoneClick=function(){this.trigger("uiChangePhoneClick")},this.gotoNextStep=function(){this.trigger("uiNavigate",{href:this.attr.nextStepUrl})},this.displayEnableTwitterAlertsSmsError=function(){this.trigger("uiAlertBanner",{message:_('Error enabling notifications. Please try again.')})},this.after("initialize",function(){this.on("click",{enableTwitterAlertsSmsSelector:this.enableTwitterAlertsSms,changePhoneSelector:this.onChangePhoneClick}),this.on(document,"dataEnableTwitterAlertsSmsSuccess",this.gotoNextStep),this.on(document,"dataEnableTwitterAlertsSmsError",this.displayEnableTwitterAlertsSmsError)})}var _=require("core/i18n"),defineComponent=require("core/component"),PhoneVerifiedForm=defineComponent(phoneVerifiedForm);module.exports=PhoneVerifiedForm
});
define("app/data/welcome/welcome_alerts",["module","require","exports","core/component","app/data/with_data"],function(module, require, exports) {
function welcomeAlertsData(){this.defaultAttrs({ajaxTimeout:6e3,noShowError:!0}),this.addLifelineWelcomeFlow=function(a){return a.lifeline_welcome_flow=1,a},this.createPhone=function(a,b){this.post({url:"/settings/devices/create",data:this.addLifelineWelcomeFlow(b),success:"dataCreatePhoneSuccess",error:"dataCreatePhoneError"})},this.cancelPhoneVerification=function(a,b){this.post({url:"/settings/devices/destroy/"+b.device_id,data:this.addLifelineWelcomeFlow(b),success:"dataCancelPhoneVerificationSuccess",error:"dataCancelPhoneVerificationError"})},this.verifyPhone=function(a,b){this.get({url:"/devices/verify",data:this.addAuthToken(b),cache:!1,success:"dataVerifyPhoneSuccess"})},this.enableTwitterAlertsSms=function(a,b){this.post({url:"/settings/devices/enable/"+b.device_id,data:this.addLifelineWelcomeFlow(b),success:"dataEnableTwitterAlertsSmsSuccess",error:"dataEnableTwitterAlertsSmsError"})},this.after("initialize",function(){this.on("uiWantsCreatePhone",this.createPhone),this.on("uiWantsCancelPhoneVerification",this.cancelPhoneVerification),this.on("uiWantsVerifyPhone",this.verifyPhone),this.on("uiWantsEnableTwitterAlertsSms",this.enableTwitterAlertsSms)})}var defineComponent=require("core/component"),withData=require("app/data/with_data"),WelcomeAlertsData=defineComponent(welcomeAlertsData,withData);module.exports=WelcomeAlertsData
});
define("app/data/welcome/welcome_alerts_phone_scribe",["module","require","exports","core/component","app/data/with_scribe"],function(module, require, exports) {
function welcomeAlertsPhoneScribe(){this.scribeSkipActivationClick=function(a,b){this.scribe({component:"phone_create",element:"form",action:"skip_activation_click"},b)},this.scribeCreatePhoneClick=function(a,b){this.scribe({component:"phone_create",element:"form",action:"create_phone_click"},b)},this.scribeCancelPhoneVerificationClick=function(a,b){this.scribe({component:"phone_verify",element:"form",action:"cancel_verification_click"},b)},this.scribePhoneVerificationSuccess=function(a,b){this.scribe({component:"phone_verify",element:"form",action:"verification_success"},b)},this.scribeChangePhoneClick=function(a,b){this.scribe({component:"phone_verified",element:"form",action:"change_phone_click"},b)},this.scribeEnableTwitterAlertsSmsClick=function(a,b){this.scribe({component:"phone_verified",element:"form",action:"enable_twitter_alerts_sms_click"},b)},this.scribeDataEnableTwitterAlertsSmsSuccess=function(a,b){this.scribe({component:"phone_verified",element:"form",action:"enable_twitter_alerts_sms_success"},b)},this.scribeDataEnableTwitterAlertsSmsError=function(a,b){this.scribe({component:"phone_verified",element:"form",action:"enable_twitter_alerts_sms_error"},b)},this.after("initialize",function(){this.on("uiSkipActivationClick",this.scribeSkipActivationClick),this.on("uiCreatePhoneClick",this.scribeCreatePhoneClick),this.on("uiWantsCancelPhoneVerification",this.scribeCancelPhoneVerificationClick),this.on("uiPhoneVerificationSuccess",this.scribePhoneVerificationSuccess),this.on("uiChangePhoneClick",this.scribeChangePhoneClick),this.on("uiWantsEnableTwitterAlertsSms",this.scribeEnableTwitterAlertsSmsClick),this.on("dataEnableTwitterAlertsSmsSuccess",this.scribeDataEnableTwitterAlertsSmsSuccess),this.on("dataEnableTwitterAlertsSmsError",this.scribeDataEnableTwitterAlertsSmsError)})}var defineComponent=require("core/component"),withScribe=require("app/data/with_scribe");module.exports=defineComponent(welcomeAlertsPhoneScribe,withScribe)
});
define("app/pages/welcome/alerts/phone",["module","require","exports","app/boot/common","app/ui/alert_banner","app/ui/forms/form_value_modification","app/ui/welcome/alerts/phone_create_form","app/ui/welcome/alerts/phone_verify_form","app/ui/welcome/alerts/phone_verified_form","app/data/welcome/welcome_alerts","app/data/welcome/welcome_alerts_phone_scribe"],function(module, require, exports) {
var boot=require("app/boot/common"),AlertBanner=require("app/ui/alert_banner"),FormValueModification=require("app/ui/forms/form_value_modification"),PhoneCreateForm=require("app/ui/welcome/alerts/phone_create_form"),PhoneVerifyForm=require("app/ui/welcome/alerts/phone_verify_form"),PhoneVerifiedForm=require("app/ui/welcome/alerts/phone_verified_form"),WelcomeAlertsData=require("app/data/welcome/welcome_alerts"),WelcomeAlertsPhoneScribe=require("app/data/welcome/welcome_alerts_phone_scribe");module.exports=function(a){boot(a),WelcomeAlertsData.attachTo(document,a),WelcomeAlertsPhoneScribe.attachTo(document,a),PhoneCreateForm.attachTo("#phone-create-form",{carrierInfo:a.carrierInfo,regionsWithHiddenCarrier:a.regionsWithHiddenCarrier,defaultCountry:a.defaultCountry}),PhoneVerifyForm.attachTo("#phone-verify-form"),PhoneVerifiedForm.attachTo("#phone-verified-form",{deviceId:a.verifiedDeviceId}),AlertBanner.attachTo("#settings-alert-box"),FormValueModification.attachTo("#phone-create-form")}
});