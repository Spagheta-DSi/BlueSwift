define("test/core/clock_spec",["module","require","exports","core/registry","core/clock"],function(module, require, exports) {
function doCount(){var a=0;return $(document).on("incrementCounter",function(b){a++}),function(){return a}}var registry=require("core/registry"),clock=require("core/clock");module.exports={};var oneSecond=1e3,fiveSeconds=5e3,tenSeconds=1e4;describe("setTimeoutEvent",function(){beforeEach(function(){jasmine.Clock.useMock(),registry.reset(),$(document).off("*")}),it("fires once",function(){var a=doCount(),b=clock.setTimeoutEvent("incrementCounter",oneSecond);jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(1)}),it("does not fire if clock is paused",function(){var a=doCount(),b=clock.setTimeoutEvent("incrementCounter",oneSecond);clock.pause(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0)}),it("fires if clock is paused and restarted",function(){var a=doCount(),b=clock.setTimeoutEvent("incrementCounter",oneSecond);clock.pause(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0),clock.resume(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(1)}),it("does not fire if timeout is paused",function(){var a=doCount(),b=clock.setTimeoutEvent("incrementCounter",oneSecond);b.pause(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0)}),it("fires if timeout is paused and restarted",function(){var a=doCount(),b=clock.setTimeoutEvent("incrementCounter",oneSecond);b.pause(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0),b.resume(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(1)}),it("does not fire if timeout is cleared",function(){var a=doCount(),b=clock.setTimeoutEvent("incrementCounter",oneSecond);b.clear(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0)}),it("passes data",function(){var a=doCount(),b={object:"value"},c=clock.setTimeoutEvent("incrementCounter",oneSecond,b),d;$(document).on("incrementCounter",function(a,b){d=b}),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(1),expect(d).toEqual(b)})}),describe("setIntervalEvent",function(){beforeEach(function(){jasmine.Clock.useMock(),registry.reset(),$(document).off("*")}),afterEach(function(){}),it("fires five times",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",oneSecond);jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(5)}),it("does not fire if clock is paused",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",oneSecond);clock.pause(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0)}),it("fires if clock is paused and restarted",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",oneSecond);clock.pause(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0),clock.resume(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(5)}),it("does not fire if timer is paused",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",oneSecond);b.pause(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0)}),it("fires if timer is paused and restarted",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",oneSecond);b.pause(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0),b.resume(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(5)}),it("does not fire if timer is cleared",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",oneSecond);b.clear(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(0)}),it("passes data",function(){var a=doCount(),b={object:"value"},c=clock.setIntervalEvent("incrementCounter",oneSecond,b),d;$(document).on("incrementCounter",function(a,b){d=b}),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(5),expect(d).toEqual(b)}),it("backs off",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",oneSecond);b.backoff(tenSeconds),jasmine.Clock.tick(35*oneSecond),expect(a()).toEqual(6)}),it("cancels backoff and resumes interval",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",oneSecond);b.backoff(tenSeconds),b.cancelBackoff(),jasmine.Clock.tick(35*oneSecond),expect(a()).toEqual(35)}),it("cancels backoff and resumes interval with countdown unaffected",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",fiveSeconds);jasmine.Clock.tick(oneSecond),expect(a()).toEqual(0),b.backoff(tenSeconds),b.cancelBackoff(),jasmine.Clock.tick(4*oneSecond),expect(a()).toEqual(1)}),it("cancels backoff and resumes interval with countdown reduced",function(){var a=doCount(),b=clock.setIntervalEvent("incrementCounter",fiveSeconds);b.backoff(tenSeconds),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(1),b.cancelBackoff(),jasmine.Clock.tick(fiveSeconds),expect(a()).toEqual(2)})})
});
define("test/core/parameterize_spec",["module","require","exports","core/parameterize"],function(module, require, exports) {
var i18n=require("core/parameterize");module.exports=1,describe("(Core) parameterize",function(){describe("output",function(){it("is unchanged when no replacements",function(){var a="I am {{not}} a yellow fraggle.",b=i18n(a);expect(b).toBe(a)}),it("replaces placeholders with supplied object",function(){var a="I am an {{color}} {{thing}}.",b={color:"orange",thing:"octopus"},c=i18n(a,b);expect(c).toBe("I am an orange octopus.")}),it("ignores missing replacements by not rendering anything",function(){var a="I have no idea what an {{unknown}} is.",b={},c=i18n(a,b);expect(c).toBe("I have no idea what an  is.")}),it("does not silently ignores missing replacements when you say you want to hear about em",function(){var a="I have no idea what an {{unknown}} is.",b={};expect(function(){i18n(a,b,!0)}).toThrow("Cannot parameterize string, no replacement found for unknown")})})})
});
define("test/fixtures/discover_stories",["module","require","exports"],function(module, require, exports) {
module.exports='<div id="discover-stories" role="main" aria-labelledby="content-main-heading" class="content-main "> <div class="content-header"> <div class="header-inner"> <h2 id="content-main-heading">Tweets</h2> <p class="subheader">What\'s happening now, tailored for you.</p> </div> </div> <div id="discover_items"> <div class="stream-container discover-timeline" data-scroll-cursor="1s" data-refresh-cursor="1r"> <div class="stream discover-stream"> <ol class="stream-items js-navigable-stream" id="stream-items-id">  <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="399995" id="stream-item-tweet-399995" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet has-cards " data-feedback-key="story_status_eoBdD3FS" data-tweet-id="399995" data-item-id="399995" data-screen-name="kingofcards" data-name="The King of Cards" data-user-id="32737" data-card-type="photo" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;11:03 AM - 21 Jun 12&quot;&gt;11:03 AM - 21 Jun 12&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/kingofcards/status/399995&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;span class=&quot;flag-container flag-cards&quot;&gt; &lt;button type=&quot;button&quot; class=&quot;flaggable btn-link&quot;&gt; Flag media &lt;/button&gt; &lt;span class=&quot;flagged hidden&quot;&gt; Flagged &lt;span&gt; &lt;a target=&quot;_blank&quot; href=&quot;//support.twitter.com/articles/20069937&quot;&gt; (learn more) &lt;/a&gt; &lt;/span&gt; &lt;/span&gt; &lt;/span&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-story-type="news" data-source="network" data-component-context="news_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/kingofcards" data-user-id="32737"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_5.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">The King of Cards</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>kingofcards</b></span> </a> <small class="time"> <a href="/kingofcards/status/399995" class="tweet-timestamp js-permalink js-nav" title="11:03 AM - 21 Jun 12"><span class="_timestamp js-short-timestamp " data-time="1340301780" data-long-form="true">21 Jun 12</span></a> </small> </div> <p class="js-tweet-text tweet-text">Yet another photo card (card2 photo_card) <a href="http://t.co/PhotoA" rel="nofollow" dir="ltr" data-expanded-url="http://t.co/PhotoA" class="twitter-timeline-link" target="_blank" title="http://t.co/PhotoA"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://t.co/PhotoA</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a></p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="cards-media-container "><div data-card-url="//t.co/PhotoA" data-card-type="photo" class="cards-base cards-multimedia" data-element-context="platform_photo_card"> <div class="media"> <a target="_blank" class="twitter-timeline-link media-thumbnail" href="//t.co/PhotoA" data-url="http://distilleryimage10.s3.amazonaws.com/42edecec1b2411e2837022000a1fa4bb_7.jpg" data-resolved-url-large="http://distilleryimage10.s3.amazonaws.com/42edecec1b2411e2837022000a1fa4bb_7.jpg"> <img src="http://distilleryimage10.s3.amazonaws.com/42edecec1b2411e2837022000a1fa4bb_7.jpg" alt="Embedded image permalink" width="435" height="435" title="card tweet A"> </a> </div> <div class="cards-content"> <h3> <a target="_blank" class="twitter-timeline-link" href="//t.co/PhotoA">card tweet A</a> </h3>    <div class="byline"> By <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/media_maven" data-user-id="1360"> <strong class="fullname js-action-profile-name">Media Maven</strong> <span class="username js-action-profile-name"><s>@</s><b>media_maven</b></span> </a> </div> </div> <div class="source"><a class="account-group js-action-profile js-user-profile-link" href="/flickr" data-user-id="327376"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_0.png" alt=""> <strong class="fullname js-action-profile-name">Flickr</strong> <span class="username js-action-profile-name"><s>@</s><b>flickr</b></span> </a> · <span class="user-actions not-following" data-user-id="327376"> <button type="button" class="btn-link follow-link"> <span class="link-text follow-text">Follow</span> <span class="link-text unfollow-text">Unfollow</span> <span class="link-text cancel-text">Cancel</span> </button> </span> </div> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/kingofcards/status/399995"> <span class="details-icon js-icon-container"> <i class="sm-image"></i> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> </div> <div class="client-and-actions"> <span class="metadata"> <span title="11:03 AM - 21 Jun 12">11:03 AM - 21 Jun 12</span> · <a class="permalink-link js-permalink js-nav" href="/kingofcards/status/399995" tabindex="-1">Details</a> <span class="flag-container flag-cards"> <button type="button" class="flaggable btn-link"> Flag media </button> <span class="flagged hidden"> Flagged <span> <a target="_blank" href="//support.twitter.com/articles/20069937"> (learn more) </a> </span> </span> </span> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="30" id="stream-item-tweet-30" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet with-social-proof " data-feedback-key="story_status_NonOJQZn" data-tweet-id="30" data-item-id="30" data-screen-name="chatty" data-name="I. M. Chatty" data-user-id="707" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container already-open&quot;&gt; &lt;ul class=&quot;stats&quot;&gt; &lt;li class=&quot;js-stat-count js-stat-retweets stat-count&quot;&gt; &lt;a href=&quot;#&quot; class=&quot;request-retweeted-popup&quot; data-activity-popup-title=&quot; Retweeted 2 times &quot; &gt; &lt;strong&gt;2&lt;/strong&gt; Retweets &lt;/a&gt; &lt;/li&gt; &lt;li class=&quot;js-stat-count js-stat-favorites stat-count&quot;&gt; &lt;a href=&quot;#&quot; class=&quot;request-favorited-popup&quot; data-activity-popup-title=&quot;  Favorited 1 time &quot; &gt; &lt;strong&gt;1&lt;/strong&gt; Favorite &lt;/a&gt; &lt;/li&gt; &lt;li class=&quot;avatar-row js-face-pile-container&quot;&gt; &lt;a class=&quot;js-profile-popup-actionable js-user-tipsy&quot; href=&quot;/sir_shares_alot&quot; data-user-id=&quot;1002&quot; original-title=&quot;Sir Shares Alot&quot; title=&quot;Sir Shares Alot&quot;&gt; &lt;img class=&quot;avatar size24 js-user-profile-link js-tooltip&quot; src=&quot;//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_1.png&quot; alt=&quot;Sir Shares Alot&quot; title=&quot;Sir Shares Alot&quot;&gt; &lt;/a&gt; &lt;a class=&quot;js-profile-popup-actionable js-user-tipsy&quot; href=&quot;/shared_once&quot; data-user-id=&quot;1003&quot; original-title=&quot;Shared Once&quot; title=&quot;Shared Once&quot;&gt; &lt;img class=&quot;avatar size24 js-user-profile-link js-tooltip&quot; src=&quot;//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_2.png&quot; alt=&quot;Shared Once&quot; title=&quot;Shared Once&quot;&gt; &lt;/a&gt; &lt;a class=&quot;js-profile-popup-actionable js-user-tipsy&quot; href=&quot;/chatty&quot; data-user-id=&quot;707&quot; original-title=&quot;I. M. Chatty&quot; title=&quot;I. M. Chatty&quot;&gt; &lt;img class=&quot;avatar size24 js-user-profile-link js-tooltip&quot; src=&quot;//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_0.png&quot; alt=&quot;I. M. Chatty&quot; title=&quot;I. M. Chatty&quot;&gt; &lt;/a&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;9:27 AM - 3 Feb 09&quot;&gt;9:27 AM - 3 Feb 09&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/chatty/status/30&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-story-type="news" data-source="network" data-component-context="news_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/chatty" data-user-id="707"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_0.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">I. M. Chatty</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>chatty</b></span> </a> <small class="time"> <a href="/chatty/status/30" class="tweet-timestamp js-permalink js-nav" title="9:27 AM - 3 Feb 09"><span class="_timestamp js-short-timestamp " data-time="1233682027" data-long-form="true">3 Feb 09</span></a> </small> </div> <p class="js-tweet-text tweet-text">A billion Internet users worldwide, Brazil in the top 10 - <a href="http://tinyurl.com/cluh2q" rel="nofollow" dir="ltr" data-expanded-url="http://tinyurl.com/cluh2q" class="twitter-timeline-link" target="_blank" title="http://tinyurl.com/cluh2q"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://tinyurl.com/cluh2q</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a></p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/chatty/status/30"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container already-open"> <ul class="stats"> <li class="js-stat-count js-stat-retweets stat-count"> <a href="#" class="request-retweeted-popup" data-activity-popup-title="Retweeted 2 times "> <strong>2</strong> Retweets </a> </li> <li class="js-stat-count js-stat-favorites stat-count"> <a href="#" class="request-favorited-popup" data-activity-popup-title="  Favorited 1 time "> <strong>1</strong> Favorite </a> </li> <li class="avatar-row js-face-pile-container"> <a class="js-profile-popup-actionable js-user-tipsy" href="/sir_shares_alot" data-user-id="1002" original-title="Sir Shares Alot" title="Sir Shares Alot"> <img class="avatar size24 js-user-profile-link js-tooltip" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_1.png" alt="Sir Shares Alot" title="Sir Shares Alot"> </a> <a class="js-profile-popup-actionable js-user-tipsy" href="/shared_once" data-user-id="1003" original-title="Shared Once" title="Shared Once"> <img class="avatar size24 js-user-profile-link js-tooltip" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_2.png" alt="Shared Once" title="Shared Once"> </a> <a class="js-profile-popup-actionable js-user-tipsy" href="/chatty" data-user-id="707" original-title="I. M. Chatty" title="I. M. Chatty"> <img class="avatar size24 js-user-profile-link js-tooltip" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_0.png" alt="I. M. Chatty" title="I. M. Chatty"> </a> </li> </ul> </div> <div class="client-and-actions"> <span class="metadata"> <span title="9:27 AM - 3 Feb 09">9:27 AM - 3 Feb 09</span> · <a class="permalink-link js-permalink js-nav" href="/chatty/status/30" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="2009" id="stream-item-tweet-2009" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet with-social-proof " data-feedback-key="story_status_IJCdtcGX" data-tweet-id="2009" data-item-id="2009" data-screen-name="chatty" data-name="I. M. Chatty" data-user-id="707" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;ul class=&quot;stats&quot;&gt; &lt;li class=&quot;js-stat-count js-stat-favorites stat-count&quot;&gt; &lt;a href=&quot;#&quot; class=&quot;request-favorited-popup&quot; data-activity-popup-title=&quot;  Favorited 1 time &quot; &gt; &lt;strong&gt;1&lt;/strong&gt; Favorite &lt;/a&gt; &lt;/li&gt; &lt;li class=&quot;avatar-row js-face-pile-container&quot;&gt; &lt;a class=&quot;js-profile-popup-actionable js-user-tipsy&quot; href=&quot;/chatty&quot; data-user-id=&quot;707&quot; original-title=&quot;I. M. Chatty&quot; title=&quot;I. M. Chatty&quot;&gt; &lt;img class=&quot;avatar size24 js-user-profile-link js-tooltip&quot; src=&quot;//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_0.png&quot; alt=&quot;I. M. Chatty&quot; title=&quot;I. M. Chatty&quot;&gt; &lt;/a&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;3:09 PM - 28 Dec 09&quot;&gt;3:09 PM - 28 Dec 09&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/chatty/status/2009&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-mentions="mrtall" data-story-type="news" data-source="network" data-component-context="news_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/chatty" data-user-id="707"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_0.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">I. M. Chatty</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>chatty</b></span> </a> <small class="time"> <a href="/chatty/status/2009" class="tweet-timestamp js-permalink js-nav" title="3:09 PM - 28 Dec 09"><span class="_timestamp js-short-timestamp " data-time="1262041775" data-long-form="true">28 Dec 09</span></a> </small> </div> <p class="js-tweet-text tweet-text">Breaking news: the time is Mon Dec 28 23:09:35 +0000 2009. <a href="/mrtall" class="twitter-atreply pretty-link" dir="ltr"><s>@</s><b>mrtall</b></a> <a href="/search?q=%23election&amp;src=hash" data-query-source="hashtag_click" class="twitter-hashtag pretty-link js-nav" dir="ltr"><s>#</s><b>election</b></a> <a href="http://whitehouse.com" rel="nofollow" dir="ltr" data-expanded-url="http://whitehouse.com" class="twitter-timeline-link" target="_blank" title="http://whitehouse.com"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://whitehouse.com</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a></p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/chatty/status/2009"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> <ul class="stats"> <li class="js-stat-count js-stat-favorites stat-count"> <a href="#" class="request-favorited-popup" data-activity-popup-title="  Favorited 1 time "> <strong>1</strong> Favorite </a> </li> <li class="avatar-row js-face-pile-container"> <a class="js-profile-popup-actionable js-user-tipsy" href="/chatty" data-user-id="707" original-title="I. M. Chatty" title="I. M. Chatty"> <img class="avatar size24 js-user-profile-link js-tooltip" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_0.png" alt="I. M. Chatty" title="I. M. Chatty"> </a> </li> </ul> </div> <div class="client-and-actions"> <span class="metadata"> <span title="3:09 PM - 28 Dec 09">3:09 PM - 28 Dec 09</span> · <a class="permalink-link js-permalink js-nav" href="/chatty/status/2009" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="1010" id="stream-item-tweet-1010" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet " data-feedback-key="story_status_4flONwwM" data-tweet-id="1010" data-item-id="1010" data-screen-name="earlybird" data-name="Earlybird" data-user-id="22" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;10:00 AM - 3 Feb 10&quot;&gt;10:00 AM - 3 Feb 10&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/earlybird/status/1010&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-story-type="topic" data-source="network" data-component-context="topic_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/earlybird" data-user-id="22"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_1.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">Earlybird</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>earlybird</b></span> </a> <small class="time"> <a href="/earlybird/status/1010" class="tweet-timestamp js-permalink js-nav" title="10:00 AM - 3 Feb 10"><span class="_timestamp js-short-timestamp " data-time="1265220000" data-long-form="true">3 Feb 10</span></a> </small> </div> <p class="js-tweet-text tweet-text">I love my deals.</p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/earlybird/status/1010"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> </div> <div class="client-and-actions"> <span class="metadata"> <span title="10:00 AM - 3 Feb 10">10:00 AM - 3 Feb 10</span> · <a class="permalink-link js-permalink js-nav" href="/earlybird/status/1010" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="1011" id="stream-item-tweet-1011" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet " data-feedback-key="story_status_7z3GeL7R" data-tweet-id="1011" data-item-id="1011" data-screen-name="i_tweet_media" data-name="Mediariffic" data-user-id="1402" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;10:00 AM - 3 Feb 10&quot;&gt;10:00 AM - 3 Feb 10&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/i_tweet_media/status/1011&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-story-type="topic" data-source="network" data-component-context="topic_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/i_tweet_media" data-user-id="1402"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_2.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">Mediariffic</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>i_tweet_media</b></span> </a> <small class="time"> <a href="/i_tweet_media/status/1011" class="tweet-timestamp js-permalink js-nav" title="10:00 AM - 3 Feb 10"><span class="_timestamp js-short-timestamp " data-time="1265220000" data-long-form="true">3 Feb 10</span></a> </small> </div> <p class="js-tweet-text tweet-text">Oh my god, Facebook has finally become self-aware. <a href="http://twitpic.com/2kgl6u" rel="nofollow" dir="ltr" data-expanded-url="http://twitpic.com/2kgl6u" class="twitter-timeline-link" target="_blank" title="http://twitpic.com/2kgl6u"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://twitpic.com/2kgl6u</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a></p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/i_tweet_media/status/1011"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> </div> <div class="client-and-actions"> <span class="metadata"> <span title="10:00 AM - 3 Feb 10">10:00 AM - 3 Feb 10</span> · <a class="permalink-link js-permalink js-nav" href="/i_tweet_media/status/1011" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="1012" id="stream-item-tweet-1012" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet " data-feedback-key="story_status_v1NdGoBs" data-tweet-id="1012" data-item-id="1012" data-screen-name="i_tweet_media" data-name="Mediariffic" data-user-id="1402" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;10:00 AM - 3 Feb 10&quot;&gt;10:00 AM - 3 Feb 10&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/i_tweet_media/status/1012&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-story-type="topic" data-source="network" data-component-context="topic_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/i_tweet_media" data-user-id="1402"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_2.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">Mediariffic</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>i_tweet_media</b></span> </a> <small class="time"> <a href="/i_tweet_media/status/1012" class="tweet-timestamp js-permalink js-nav" title="10:00 AM - 3 Feb 10"><span class="_timestamp js-short-timestamp " data-time="1265220000" data-long-form="true">3 Feb 10</span></a> </small> </div> <p class="js-tweet-text tweet-text"><a href="http://www.youtube.com/watch?v=SDUR50xYA0c" rel="nofollow" dir="ltr" data-expanded-url="http://www.youtube.com/watch?v=SDUR50xYA0c" class="twitter-timeline-link" target="_blank" title="http://www.youtube.com/watch?v=SDUR50xYA0c"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://www.youtube.com/watch?v=SDUR50xYA0c</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a> yo we\'re callin you out!!! who wants to battle???!!! -Jay Park (AOM)</p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/i_tweet_media/status/1012"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> </div> <div class="client-and-actions"> <span class="metadata"> <span title="10:00 AM - 3 Feb 10">10:00 AM - 3 Feb 10</span> · <a class="permalink-link js-permalink js-nav" href="/i_tweet_media/status/1012" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="1013" id="stream-item-tweet-1013" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet " data-feedback-key="story_status_XkyAmG07" data-tweet-id="1013" data-item-id="1013" data-screen-name="i_tweet_media" data-name="Mediariffic" data-user-id="1402" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;10:00 AM - 3 Feb 10&quot;&gt;10:00 AM - 3 Feb 10&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/i_tweet_media/status/1013&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-story-type="topic" data-source="network" data-component-context="topic_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/i_tweet_media" data-user-id="1402"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_2.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">Mediariffic</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>i_tweet_media</b></span> </a> <small class="time"> <a href="/i_tweet_media/status/1013" class="tweet-timestamp js-permalink js-nav" title="10:00 AM - 3 Feb 10"><span class="_timestamp js-short-timestamp " data-time="1265220000" data-long-form="true">3 Feb 10</span></a> </small> </div> <p class="js-tweet-text tweet-text">Kiva -Loan has helped another Entreprenuer with finance to help with her Banana crop production: <a href="http://www.kiva.org/lend/223734?_te=j" rel="nofollow" dir="ltr" data-expanded-url="http://www.kiva.org/lend/223734?_te=j" class="twitter-timeline-link" target="_blank" title="http://www.kiva.org/lend/223734?_te=j"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://www.kiva.org/lend/223734?_te=j</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a></p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/i_tweet_media/status/1013"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> </div> <div class="client-and-actions"> <span class="metadata"> <span title="10:00 AM - 3 Feb 10">10:00 AM - 3 Feb 10</span> · <a class="permalink-link js-permalink js-nav" href="/i_tweet_media/status/1013" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="1014" id="stream-item-tweet-1014" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet " data-feedback-key="story_status_7jx93Fq2" data-tweet-id="1014" data-item-id="1014" data-screen-name="i_tweet_media" data-name="Mediariffic" data-user-id="1402" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;10:00 AM - 3 Feb 10&quot;&gt;10:00 AM - 3 Feb 10&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/i_tweet_media/status/1014&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-mentions="xxxxxxxxxxxxxxxxxxxx" data-story-type="topic" data-source="network" data-component-context="topic_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/i_tweet_media" data-user-id="1402"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_2.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">Mediariffic</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>i_tweet_media</b></span> </a> <small class="time"> <a href="/i_tweet_media/status/1014" class="tweet-timestamp js-permalink js-nav" title="10:00 AM - 3 Feb 10"><span class="_timestamp js-short-timestamp " data-time="1265220000" data-long-form="true">3 Feb 10</span></a> </small> </div> <p class="js-tweet-text tweet-text"><a href="/search?q=%23testdesu&amp;src=hash" data-query-source="hashtag_click" class="twitter-hashtag pretty-link js-nav" dir="ltr"><s>#</s><b>testdesu</b></a> <a href="http://example.com/" rel="nofollow" dir="ltr" data-expanded-url="http://example.com/" class="twitter-timeline-link" target="_blank" title="http://example.com/"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://example.com/</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a> <a href="/xxxxxxxxxxxxxxxxxxxx" class="twitter-atreply pretty-link" dir="ltr"><s>@</s><b>xxxxxxxxxxxxxxxxxxxx</b></a> iframe/onload=alert(1)//</p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/i_tweet_media/status/1014"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> </div> <div class="client-and-actions"> <span class="metadata"> <span title="10:00 AM - 3 Feb 10">10:00 AM - 3 Feb 10</span> · <a class="permalink-link js-permalink js-nav" href="/i_tweet_media/status/1014" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="101" id="stream-item-tweet-101" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet with-social-proof " data-feedback-key="story_status_Xe8IB1K8" data-tweet-id="101" data-item-id="101" data-screen-name="talkative" data-name="I. M. Talkative" data-user-id="706" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;ul class=&quot;stats&quot;&gt; &lt;li class=&quot;js-stat-count js-stat-favorites stat-count&quot;&gt; &lt;a href=&quot;#&quot; class=&quot;request-favorited-popup&quot; data-activity-popup-title=&quot;  Favorited 1 time &quot; &gt; &lt;strong&gt;1&lt;/strong&gt; Favorite &lt;/a&gt; &lt;/li&gt; &lt;li class=&quot;avatar-row js-face-pile-container&quot;&gt; &lt;a class=&quot;js-profile-popup-actionable js-user-tipsy&quot; href=&quot;/talkative&quot; data-user-id=&quot;706&quot; original-title=&quot;I. M. Talkative&quot; title=&quot;I. M. Talkative&quot;&gt; &lt;img class=&quot;avatar size24 js-user-profile-link js-tooltip&quot; src=&quot;//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_6.png&quot; alt=&quot;I. M. Talkative&quot; title=&quot;I. M. Talkative&quot;&gt; &lt;/a&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;3:11 PM - 2 Jan 09&quot;&gt;3:11 PM - 2 Jan 09&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/talkative/status/101&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-mentions="chatty" data-story-type="topic" data-source="network" data-component-context="topic_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/talkative" data-user-id="706"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_6.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">I. M. Talkative</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>talkative</b></span> </a> <small class="time"> <a href="/talkative/status/101" class="tweet-timestamp js-permalink js-nav" title="3:11 PM - 2 Jan 09"><span class="_timestamp js-short-timestamp " data-time="1230937895" data-long-form="true">2 Jan 09</span></a> </small> </div> <p class="js-tweet-text tweet-text"><a href="/chatty" class="twitter-atreply pretty-link" dir="ltr"><s>@</s><b>chatty</b></a> hey hey hey x 1 <a href="http://www.youtube.com/embed/7Ru84WuSfpQ?wmode=opaque" rel="nofollow" dir="ltr" data-expanded-url="http://www.youtube.com/embed/7Ru84WuSfpQ?wmode=opaque" class="twitter-timeline-link" target="_blank" title="http://www.youtube.com/embed/7Ru84WuSfpQ?wmode=opaque"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://www.youtube.com/embed/7Ru84WuSfpQ?wmode=opaque</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a></p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/talkative/status/101"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> <ul class="stats"> <li class="js-stat-count js-stat-favorites stat-count"> <a href="#" class="request-favorited-popup" data-activity-popup-title="  Favorited 1 time "> <strong>1</strong> Favorite </a> </li> <li class="avatar-row js-face-pile-container"> <a class="js-profile-popup-actionable js-user-tipsy" href="/talkative" data-user-id="706" original-title="I. M. Talkative" title="I. M. Talkative"> <img class="avatar size24 js-user-profile-link js-tooltip" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_6.png" alt="I. M. Talkative" title="I. M. Talkative"> </a> </li> </ul> </div> <div class="client-and-actions"> <span class="metadata"> <span title="3:11 PM - 2 Jan 09">3:11 PM - 2 Jan 09</span> · <a class="permalink-link js-permalink js-nav" href="/talkative/status/101" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="1012" id="stream-item-tweet-1012" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet " data-feedback-key="story_status_W69vONFC" data-tweet-id="1012" data-item-id="1012" data-screen-name="i_tweet_media" data-name="Mediariffic" data-user-id="1402" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;10:00 AM - 3 Feb 10&quot;&gt;10:00 AM - 3 Feb 10&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/i_tweet_media/status/1012&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-story-type="tweet" data-source="network" data-component-context="tweet_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/i_tweet_media" data-user-id="1402"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_2.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">Mediariffic</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>i_tweet_media</b></span> </a> <small class="time"> <a href="/i_tweet_media/status/1012" class="tweet-timestamp js-permalink js-nav" title="10:00 AM - 3 Feb 10"><span class="_timestamp js-short-timestamp " data-time="1265220000" data-long-form="true">3 Feb 10</span></a> </small> </div> <p class="js-tweet-text tweet-text"><a href="http://www.youtube.com/watch?v=SDUR50xYA0c" rel="nofollow" dir="ltr" data-expanded-url="http://www.youtube.com/watch?v=SDUR50xYA0c" class="twitter-timeline-link" target="_blank" title="http://www.youtube.com/watch?v=SDUR50xYA0c"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://www.youtube.com/watch?v=SDUR50xYA0c</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a> yo we\'re callin you out!!! who wants to battle???!!! -Jay Park (AOM)</p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/i_tweet_media/status/1012"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> </div> <div class="client-and-actions"> <span class="metadata"> <span title="10:00 AM - 3 Feb 10">10:00 AM - 3 Feb 10</span> · <a class="permalink-link js-permalink js-nav" href="/i_tweet_media/status/1012" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="1011" id="stream-item-tweet-1011" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet " data-feedback-key="story_status_pxFivyfX" data-tweet-id="1011" data-item-id="1011" data-screen-name="i_tweet_media" data-name="Mediariffic" data-user-id="1402" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;10:00 AM - 3 Feb 10&quot;&gt;10:00 AM - 3 Feb 10&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/i_tweet_media/status/1011&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-story-type="tweet" data-source="network" data-component-context="tweet_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/i_tweet_media" data-user-id="1402"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_2.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">Mediariffic</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>i_tweet_media</b></span> </a> <small class="time"> <a href="/i_tweet_media/status/1011" class="tweet-timestamp js-permalink js-nav" title="10:00 AM - 3 Feb 10"><span class="_timestamp js-short-timestamp " data-time="1265220000" data-long-form="true">3 Feb 10</span></a> </small> </div> <p class="js-tweet-text tweet-text">Oh my god, Facebook has finally become self-aware. <a href="http://twitpic.com/2kgl6u" rel="nofollow" dir="ltr" data-expanded-url="http://twitpic.com/2kgl6u" class="twitter-timeline-link" target="_blank" title="http://twitpic.com/2kgl6u"><span class="tco-ellipsis"></span><span class="invisible"></span><span class="js-display-url">http://twitpic.com/2kgl6u</span><span class="invisible"></span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a></p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/i_tweet_media/status/1011"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> </div> <div class="client-and-actions"> <span class="metadata"> <span title="10:00 AM - 3 Feb 10">10:00 AM - 3 Feb 10</span> · <a class="permalink-link js-permalink js-nav" href="/i_tweet_media/status/1011" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="7" id="stream-item-tweet-7" data-item-type="tweet"> <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet " data-feedback-key="story_status_UbXYq0vR" data-tweet-id="7" data-item-id="7" data-screen-name="phoenix" data-name="Phoenix" data-user-id="6" data-expanded-footer="&lt;div class=&quot;js-tweet-details-fixer tweet-details-fixer&quot;&gt; &lt;div class=&quot;js-tweet-media-container &quot;&gt;&lt;/div&gt; &lt;div class=&quot;entities-media-container &quot; style=&quot;min-height:0px&quot;&gt; &lt;/div&gt; &lt;div class=&quot;js-machine-translated-tweet-container&quot;&gt;&lt;/div&gt; &lt;div class=&quot;js-tweet-stats-container tweet-stats-container &quot;&gt; &lt;/div&gt; &lt;div class=&quot;client-and-actions&quot;&gt; &lt;span class=&quot;metadata&quot;&gt; &lt;span title=&quot;12:07 AM - 7 Jul 07&quot;&gt;12:07 AM - 7 Jul 07&lt;/span&gt; &amp;middot; &lt;a class=&quot;permalink-link js-permalink js-nav&quot; href=&quot;/phoenix/status/7&quot;  tabindex=&quot;-1&quot;&gt;Details&lt;/a&gt; &lt;/span&gt; &lt;/div&gt; &lt;/div&gt; " data-story-type="tweet" data-source="network" data-component-context="tweet_story" data-you-follow="false" data-you-block="false"> <span class="icon dogear"></span> <div class="content"> <div class="stream-item-header"> <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/phoenix" data-user-id="6"> <img class="avatar js-action-profile-avatar" src="//localhost.twitter.com:1776/sticky/default_profile_images/default_profile_6.png" alt=""> <strong class="fullname js-action-profile-name show-popup-with-id">Phoenix</strong> <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>phoenix</b></span> </a> <small class="time"> <a href="/phoenix/status/7" class="tweet-timestamp js-permalink js-nav" title="12:07 AM - 7 Jul 07"><span class="_timestamp js-short-timestamp " data-time="1183792027" data-long-form="true">7 Jul 07</span></a> </small> </div> <p class="js-tweet-text tweet-text">Tweeting a little bit.</p> <div class="stream-item-footer"> <div class="context"> </div> </div> <div class="discover-tweet-actions"> <a class="details with-icn js-details" href="/phoenix/status/7"> <span class="details-icon js-icon-container"> </span> <b> <span class="expand-stream-item js-view-details"> Expand </span> <span class="collapse-stream-item js-hide-details"> Collapse </span> </b> </a> <ul class="tweet-actions js-actions"> <li class="action-reply-container"> <a role="button" class="with-icn js-action-reply js-tooltip" data-modal="tweet-reply" href="#"> <span class="icon sm-reply"></span> <b>Reply</b> </a> </li> <li class="action-rt-container js-toggle-state js-toggle-rt"> <a role="button" class="with-icn retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweet</b> </a> <a role="button" class="with-icn undo-retweet js-tooltip" data-modal="tweet-retweet" href="#"> <span class="icon sm-rt"></span> <b>Retweeted</b> </a> </li> <li class="action-del-container"> <a role="button" class="with-icn js-action-del js-tooltip" href="#"> <span class="icon sm-trash"></span> <b>Delete</b> </a> </li> <li class="action-fav-container js-toggle-state js-toggle-fav"> <a role="button" class="with-icn favorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorite</b> </a> <a role="button" class="with-icn unfavorite js-tooltip" href="#"> <span class="icon sm-fav"></span> <b>Favorited</b> </a> </li> </ul> </div> <div class="expanded-content js-tweet-details-dropdown"> <div class="js-tweet-details-fixer tweet-details-fixer"> <div class="js-tweet-media-container "></div> <div class="entities-media-container " style="min-height:0px"> </div> <div class="js-machine-translated-tweet-container"></div> <div class="js-tweet-stats-container tweet-stats-container "> </div> <div class="client-and-actions"> <span class="metadata"> <span title="12:07 AM - 7 Jul 07">12:07 AM - 7 Jul 07</span> · <a class="permalink-link js-permalink js-nav" href="/phoenix/status/7" tabindex="-1">Details</a> </span> </div> </div> </div> </div> </div> </li> </ol> <div class="stream-footer "> <div class="timeline-end has-items has-more-items"> <div class="stream-end"> <div class="stream-end-inner "> <i class="bird-etched"></i> <p class="empty-text"> </p> <p><button type="button" class="btn-link back-to-top hidden" style="display: inline-block;">Back to top ↑</button></p> </div> </div> <div class="stream-loading"> <div class="stream-end-inner"> <span class="spinner" title="Loading..."></span> </div> </div> </div> </div> <div class="stream-fail-container"> <div class="js-stream-whale-end stream-whale-end stream-placeholder centered-placeholder"> <div class="stream-end-inner"> <h2 class="title">Loading seems to be taking a while.</h2> <p> Twitter may be over capacity or experiencing a momentary hiccup. <a href="#" class="try-again-after-whale">Try again</a> or visit <a target="_blank" href="http://status.twitter.com">Twitter Status</a> for more information. </p> </div> </div> </div> <ol class="hidden-replies-container"></ol> <div class="stream-autoplay-marker"> <i class="arrow"></i> <span class="text"></span> </div> </div> </div> </div> </div>'
});
define("test/fixtures/user_search",["module","require","exports"],function(module, require, exports) {
module.exports='<div class="content-main" id="timeline"><div class="content-header"><div class="header-inner"><h2 class="js-timeline-title search-nav">People</h2></div></div><div class="stream-container" data-cursor=""><div class="stream search-stream"><div class="stream-items" id="stream-items-id"><div class="js-stream-item stream-item stream-item" data-item-id="1010" data-item-type="user" id="stream-item-user-1010"><div class="account promoted-account js-actionable-user js-profile-popup-actionable " data-screen-name="lilkim" data-user-id="1010" data-impression-id="1345589771.12239" data-impression-cookie=\'["1010","1345589771.12239","promoted","",[]]\'><div class="user-actions btn-group not-following can-dm " data-user-id="1010" data-screen-name="lilkim" data-name="Lil Kim" data-protected="false"><button class="js-follow-btn follow-button btn" type="button"><span class="button-text follow-text"><i class="follow"></i>Follow</span><span class="button-text following-text">Following</span><span class="button-text unfollow-text">Unfollow</span><span class="button-text blocked-text">Blocked</span><span class="button-text unblock-text">Unblock</span><span class="button-text pending-text">Pending</span><span class="button-text cancel-text">Cancel</span></button><span class="user-dropdown js-link btn"><i class="account-arrow"></i><i class="mark-as-spam-silhouette"></i><i class="mark-as-spam-flag"></i><small class="mark-as-spam-text">Spam?</small><ul class="dropdown-menu"><li class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></li><li class="mention-text pretty-link dropdown-link not-blocked">Tweet to <s>@</s>lilkim</li><li class="list-text pretty-link dropdown-link not-blocked">Add or remove from lists&hellip;</li><li class="dropdown-divider not-blocked"><li class="block-text pretty-link dropdown-link not-blocked">Block <s>@</s>lilkim</li><li class="unblock-text pretty-link dropdown-link">Unblock <s>@</s>lilkim</li><li class="report-spam-text pretty-link dropdown-link">Report <s>@</s>lilkim for spam</li><li class="hide-suggestion-text dropdown-link">Hide this suggestion</li><li class="dropdown-divider is-following"><li class="retweet-on-text dropdown-link">Turn on Retweets</li><li class="retweet-off-text dropdown-link">Turn off Retweets</li><li class="device-notifications-on-text dropdown-link">Turn on mobile notifications</li><li class="device-notifications-off-text dropdown-link">Turn off mobile notifications</li></ul></span></div><div class="content"><div class="stream-item-header"><a class="account-group js-user-profile-link" href="/lilkim"><img class="avatar js-action-profile-avatar " src="" alt="Lil Kim" data-user-id="1010"><strong class="fullname js-action-profile-name">Lil Kim</strong><span>&rlm;</span><i class="verified"></i><span class="username js-action-profile-name">@lilkim</span></a></div><p class="bio ">Hip-hop diva</p><span class="metadata with-icn"><a class="js-promoted-badge js-user-profile-link js-tooltip js-disclosure" href="/lilkim" data-user-id="1010" title=""><i class="badge-promoted"></i>Promoted</a></span></div></div></div><div class="js-stream-item stream-item stream-item" data-item-id="3" data-item-type="user" id="stream-item-user-3"><div class="account promoted-account js-actionable-user js-profile-popup-actionable " data-screen-name="jack" data-user-id="3" data-impression-id="1345589771.12239" data-impression-cookie=\'["3","1345589771.12239","political","Paid For By Jack For President.",[]]\'><a class="btn js-thats-you edit-profile-btn js-nav" href="/settings/profile">Edit your profile</a><div class="content"><div class="stream-item-header"><a class="account-group js-user-profile-link" href="/jack"><img class="avatar js-action-profile-avatar " src="" alt="Jack" data-user-id="3"><strong class="fullname js-action-profile-name">Jack</strong><span>&rlm;</span><span class="username js-action-profile-name">@jack</span><i class="sm-lock"></i></a></div><p class="bio ">love, love</p><span class="metadata with-icn"><a class="js-promoted-badge js-user-profile-link js-tooltip js-disclosure" href="/jack" data-user-id="3" title="Paid For By Jack For President."><i class="badge-political"></i>Promoted</a></span></div></div></div><div class="js-stream-item stream-item stream-item" data-item-id="707" data-item-type="user" id="stream-item-user-707"><div class="account js-actionable-user js-profile-popup-actionable " data-screen-name="chatty" data-user-id="707"><div class="user-actions btn-group not-following can-dm " data-user-id="707" data-screen-name="chatty" data-name="I. M. Chatty" data-protected="false"><button class="js-follow-btn follow-button btn" type="button"><span class="button-text follow-text"><i class="follow"></i>Follow</span><span class="button-text following-text">Following</span><span class="button-text unfollow-text">Unfollow</span><span class="button-text blocked-text">Blocked</span><span class="button-text unblock-text">Unblock</span><span class="button-text pending-text">Pending</span><span class="button-text cancel-text">Cancel</span></button><span class="user-dropdown js-link btn"><i class="account-arrow"></i><i class="mark-as-spam-silhouette"></i><i class="mark-as-spam-flag"></i><small class="mark-as-spam-text">Spam?</small><ul class="dropdown-menu"><li class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></li><li class="mention-text pretty-link dropdown-link not-blocked">Tweet to <s>@</s>chatty</li><li class="list-text pretty-link dropdown-link not-blocked">Add or remove from lists&hellip;</li><li class="dropdown-divider not-blocked"><li class="block-text pretty-link dropdown-link not-blocked">Block <s>@</s>chatty</li><li class="unblock-text pretty-link dropdown-link">Unblock <s>@</s>chatty</li><li class="report-spam-text pretty-link dropdown-link">Report <s>@</s>chatty for spam</li><li class="hide-suggestion-text dropdown-link">Hide this suggestion</li><li class="dropdown-divider is-following"><li class="retweet-on-text dropdown-link">Turn on Retweets</li><li class="retweet-off-text dropdown-link">Turn off Retweets</li><li class="device-notifications-on-text dropdown-link">Turn on mobile notifications</li><li class="device-notifications-off-text dropdown-link">Turn off mobile notifications</li></ul></span></div><div class="content"><div class="stream-item-header"><a class="account-group js-user-profile-link" href="/chatty"><img class="avatar js-action-profile-avatar " src="" alt="I. M. Chatty" data-user-id="707"><strong class="fullname js-action-profile-name">I. M. Chatty</strong><span>&rlm;</span><span class="username js-action-profile-name">@chatty</span></a></div><p class="bio "></p></div></div></div></div><div class="stream-footer"><div class="timeline-end has-items "><div class="stream-end"><div class="stream-end-inner"><i class="bird-etched"></i><p class="empty-text">No people results for john.</p><p><button type="button" class="btn-link back-to-top hidden">Back to top &uarr;</button></p></div></div><div class="stream-loading"><div class="stream-end-inner"><span class="spinner" title="Loading..."></span></div></div></div></div><div class="stream-fail-container"><div class="js-stream-whale-end stream-whale-end stream-placeholder centered-placeholder"><div class="stream-end-inner"><h2 class="title">Loading seems to be taking a while.</h2><p> Twitter may be over capacity or experiencing a momentary hiccup. <a href="#" class="try-again-after-whale">Try again</a> or visit <a target="_blank" href="http://status.twitter.com">Twitter Status</a> for more information. </p></div></div></div><div class="stream-autoplay-marker"><i class="arrow"></i><span class="text"></span></div></div></div></div>'
});
define("test/fixtures/own_profile_header",["module","require","exports"],function(module, require, exports) {
module.exports='<div class="module profile-card component profile-header" data-component-term="profile_follow_card"><div class="profile-header-inner flex-module clearfix " data-background-image="url(\'http://localhost.twitter.com:1776/t1/img/grey_header_web.jpg\')" data-default-background-image="http://localhost.twitter.com:1776/t1/img/grey_header_web.jpg"><div class="profile-header-inner-overlay"></div><div class="hidden help-text edit-avatar-help-text">Edit profile photo</div><div class="hidden help-text edit-header-help-text">Edit header photo</div><div class="hidden help-text drag-photo-help-text">Or drag photo here</div><div class="profile-header-mask"></div><div class="edit-header-target"><i class="inline-edit-icon"></i><i class="inline-photo-drop-icon hidden"></i></div><a href="/unversioned_dev_assets/profile_images/2/jack.jpg" class="profile-picture media-thumbnail" data-resolved-url-large="/unversioned_dev_assets/profile_images/2/jack.jpg" data-url="/unversioned_dev_assets/profile_images/2/jack.jpg" target="_blank"><i class="inline-edit-icon"></i><i class="inline-photo-drop-icon hidden"></i><img src="" alt="Jack" class="avatar size73"></a><div class="profile-picture-placeholder"><a href="/settings/profile" class="profile-picture js-nav js-tooltip" title="Add an avatar" data-placement="right"><i class="inline-edit-icon"></i><i class="inline-photo-drop-icon hidden"></i><img src="" alt="Jack" class="avatar empty-avatar size73"></a></div><div class="controls avatar-settings inline-upload-avatar"><div class="uploader-image uploader-avatar clearfix"><div id="choose-photo" class="dropdown open launchpad center"><ul class="dropdown-menu"><li class="dropdown-caret center"><span class="caret-outer"></span><span class="caret-inner"></span></li><li id="photo-choose-webcam" class="pretty-link dropdown-link hidden">Take photo</li><li id="photo-choose-existing" class="photo-choose-existing upload-photo pretty-link dropdown-link"> Choose existing photo <div class="photo-selector"><button class="btn" type="button" disabled> Change photo </button><span class="photo-file-name">No file selected</span><div class="image-selector"><input type="hidden" name="media_file_name" class="file-name"><input type="hidden" name="media_data_empty" class="file-data"><input type="file" name="media_empty" class="file-input"><div class="swf-container"></div></div></div></li><li id="photo-delete-image" class="pretty-link dropdown-link ">Remove photo</li><li class="cancel-options pretty-link dropdown-link">Cancel</li></ul><div class="webcam-detect swf-container"></div></div></div></div><div class="profile-card-inner" data-screen-name="jack" data-user-id="3"><h1 class="fullname editable-group"><label class="visuallyhidden" for="user_name">Name</label><input type="text" class="editable-field" placeholder="Name" maxlength="20" value="Jack" id="user_name" name="user[name]"><span class="profile-field">Jack</span><a href="//support.twitter.com/articles/14016-about-public-and-protected-tweets" class="protected-link js-tooltip" title="Protected account"><span class="icon lock-large"><span class="visuallyhidden">Protected account</span></span></a></h1><h2 class="username"><span class="screen-name"><s>@</s>jack</span></h2><div class="bio-container editable-group"><label class="visuallyhidden" for="user_description">Tell us about yourself</label><textarea class="editable-field" maxlength="160" placeholder="Tell us about yourself" name="user[description]" id="user_description">love, love</textarea><p class="bio profile-field">love, love</p></div><p class="location-and-url"><span class="location-container editable-group"><label class="visuallyhidden" for="user_location">Location</label><input type="text" maxlength="30" class="editable-field" placeholder="Location" value="San Francisco" name="user[location]" id="user_location"><span class="location profile-field"> San Francisco </span></span><span class="divider hidden">&middot;</span><span class="url editable-group"><label class="visuallyhidden" for="user_url">Website</label><input type="text" class="editable-field" placeholder="Website" value="" name="user[url]" id="user_url"><span class="profile-field"><a target="_blank" rel="me nofollow" href=""></a></span></span></p></div></div><div class="profile-editing-dialogs"><div id="profile_image_upload_dialog" class="modal-container image-upload-dialog"><div class="close-modal-background-target"></div><div class="modal draggable profile-avatar-modal"><div class="modal-content"><button class="modal-btn modal-close"><i class="close-medium"></i></button><div class="modal-header"><h3 class="modal-title">Upload a profile image</h3></div><div class="modal-body"><div class="alert profile-image-alert message" style="display: none;"><div><span id="profile-image-alert-message"></span><a class="dismiss" href="#">&times;</a></div></div><div class="upload-frame image-upload-webcam" style="display: none"><div class="webcam-container"></div><canvas class="webcam-canvas" height="240" width="320" style="display:none"></canvas></div><div class="upload-frame clearfix image-upload-crop" style="display: none"><span class="spinner-bigger crop-spinner" style="display: none"></span><div class="crop-zone cropper-avatar-size"><div class="cropper-mask"><div class="cropper-overlay"></div><img class="crop-image" src=""></div><div class="cropper-slider-outer"><i class="image-gray"></i><div class="cropper-slider"></div><i class="image-gray-large"></i></div></div></div><div style="display: none;"><canvas class="drawsurface"></canvas></div><div class="upload-frame clearfix image-upload-spinner"></div></div><div class="modal-footer"><button type="button" class="btn profile-image-cancel">Cancel</button><button type="button" class="btn profile-image-previous" style="display: none">Previous</button><button type="button" class="btn primary-btn profile-image-capture-webcam" disabled style="display: none">Take picture</button><button type="button" class="btn primary-btn profile-image-save" style="display: none">Save</button></div></div></div></div><div id="header_image_upload_dialog" class="modal-container image-upload-dialog"><div class="close-modal-background-target"></div><div class="modal draggable profile-header-modal"><div class="modal-content"><button class="modal-btn modal-close"><i class="close-medium"></i></button><div class="modal-header"><h3 class="modal-title">Upload a header image</h3></div><div class="modal-body"><div class="alert profile-image-alert message" style="display: none;"><div><span id="profile-image-alert-message"></span><a class="dismiss" href="#">&times;</a></div></div><div class="upload-frame image-upload-webcam" style="display: none"><div class="webcam-container"></div><canvas class="webcam-canvas" height="240" width="320" style="display:none"></canvas></div><div class="upload-frame clearfix image-upload-crop" style="display: none"><span class="spinner-bigger crop-spinner" style="display: none"></span><div class="crop-zone cropper-header-size"><div class="cropper-mask"><div class="cropper-overlay"></div><img class="crop-image" src=""></div><div class="cropper-slider-outer"><i class="image-gray"></i><div class="cropper-slider"></div><i class="image-gray-large"></i></div></div></div><div style="display: none;"><canvas class="drawsurface"></canvas></div><div class="upload-frame clearfix image-upload-spinner"></div></div><div class="modal-footer"><button type="button" class="btn profile-image-cancel">Cancel</button><button type="button" class="btn profile-image-previous" style="display: none">Previous</button><button type="button" class="btn primary-btn profile-image-capture-webcam" disabled style="display: none">Take picture</button><button type="button" class="btn primary-btn profile-image-save" style="display: none">Save</button></div></div></div></div></div><div class="controls header-settings inline-upload-header"><div class="uploader-image uploader-header clearfix"><div id="choose-header" class="dropdown open launchpad center"><ul class="dropdown-menu"><li class="dropdown-caret center"><span class="caret-outer"></span><span class="caret-inner"></span></li><li id="header-choose-existing" class="header-choose-existing upload-photo pretty-link dropdown-link"> Choose existing image <div class="photo-selector"><button class="btn" type="button" disabled> Change header </button><span class="photo-file-name">No file selected</span><div class="image-selector"><input type="hidden" name="media_file_name" class="file-name"><input type="hidden" name="media_data_empty" class="file-data"><input type="file" name="media_empty" class="file-input"><div class="swf-container"></div></div></div></li><li id="header-delete-image" class="pretty-link dropdown-link hidden">Remove</li><li class="cancel-options pretty-link dropdown-link">Cancel</li></ul><div class="webcam-detect swf-container"></div></div></div></div><div class="flex-module profile-banner-footer clearfix"><div class="default-footer"><ul class="stats js-mini-profile-stats" data-user-id="3"><li><a class="js-nav" href="/jack" data-element-term="tweet_stats" data-nav="profile"><strong>1</strong> Tweet </a></li><li><a class="js-nav" href="/following" data-element-term="following_stats" data-nav="following"><strong>2</strong> Following </a></li><li><a class="js-nav" href="/followers" data-element-term="follower_stats" data-nav="followers"><strong>3</strong> Followers </a></li></ul><span class="btn edit-profile-btn inline-edit-profile-btn">Edit Profile</span><button class="btn dm-button" type="button" title="Direct messages"><i class="dm-envelope"><span class="dm-new"></span></i></button></div><div class="save-profile-footer"><button class="btn primary-btn save-profile-btn">Save</button><button class="btn saving-profile-btn" disabled>Saving...</button><button class="btn cancel-profile-btn">Cancel</button></div></div></div>'
});
define("test/fixtures/trends_api",["module","require","exports"],function(module, require, exports) {
module.exports=JSON.parse('{"personalized":false,"woeid":2487956,"module_html":"\\u003Cdiv class=\\"flex-module-header\\"\\u003E\\n  \\n  \\u003Ch3\\u003E\\n    \\u003Cspan class=\\"js-trend-location\\"\\u003E\\n        San Francisco Trends\\n    \\u003C\\/span\\u003E\\n  \\u003C\\/h3\\u003E\\n  \\u003Csmall\\u003E&middot; \\u003Ca href=\\"#\\" data-modal=\\"change-trends\\" class=\\"change-trends js-trend-toggle\\"\\u003EChange\\u003C\\/a\\u003E\\u003C\\/small\\u003E\\n\\u003C\\/div\\u003E\\n\\u003Cdiv class=\\"flex-module-inner\\"\\u003E\\n  \\u003Cul class=\\"trend-items js-trends\\"\\u003E\\n      \\u003Cli class=\\"js-trend-item  promoted-trend\\" data-trend-name=\\"#ts3\\" data-promoted-trend-id=\\"1\\"\\u003E\\n          \\u003Ca class=\\"promoted pretty-link\\" href=\\"\\/search\\/?q=%23ts3&amp;src=ptrn\\" data-query-source=\\"promoted_trend_click\\"\\u003E\\u003Cb\\u003E#ts3\\u003C\\/b\\u003E \\u003Cspan class=\\"with-icn js-disclosure js-tooltip\\" title=\\"\\"\\u003E\\u003Ci class=\\"badge-promoted\\"\\u003E\\u003C\\/i\\u003E\\u003Cb class=\\"promoted-text\\"\\u003EPromoted\\u003C\\/b\\u003E\\u003C\\/span\\u003E\\u003C\\/a\\u003E\\n      \\u003C\\/li\\u003E      \\u003Cli class=\\"js-trend-item  \\" data-trend-name=\\"Trend D\\" \\u003E\\n            \\u003Ca href=\\"\\/search\\/?q=trend+d&amp;src=tren\\" data-query-source=\\"trend_click\\"\\u003ETrend D\\u003C\\/a\\u003E\\n      \\u003C\\/li\\u003E      \\u003Cli class=\\"js-trend-item  \\" data-trend-name=\\"Trend E\\" \\u003E\\n            \\u003Ca href=\\"\\/search\\/?q=trend+e&amp;src=tren\\" data-query-source=\\"trend_click\\"\\u003ETrend E\\u003C\\/a\\u003E\\n      \\u003C\\/li\\u003E  \\u003C\\/ul\\u003E\\n\\u003C\\/div\\u003E\\n\\u003C\\/div\\u003E","dialog_html":"\\u003Cdiv class=\\"trends-by-location\\"\\u003E\\n\\n  \\u003Cdiv class=\\"trends-breadcrumb\\"\\u003E\\n        \\u003Ca href=\\"#\\" class=\\"trend-breadcrumb-location js-trend-link\\" data-woeid=\\"1\\"\\u003EWorldwide\\u003C\\/a\\u003E\\n          \\u003Cspan class=\\"separator\\"\\u003E\\/\\u003C\\/span\\u003E\\n        \\u003Ca href=\\"#\\" class=\\"trend-breadcrumb-location js-trend-link\\" data-woeid=\\"23424977\\"\\u003EUnited States\\u003C\\/a\\u003E\\n      \\u003C\\/div\\u003E\\n\\n  \\u003Cdiv class=\\"trends-locations clearfix\\"\\u003E\\n    \\u003Cul class=\\"trends-locations-list\\"\\u003E\\n        \\u003Cli\\u003E\\n          \\u003Ca href=\\"#\\" class=\\"trends-location-item js-trend-link\\" data-woeid=\\"2442047\\"\\u003E\\n            Los Angeles\\n            \\u003Ci class=\\"checkmark\\"\\u003E\\u003C\\/i\\u003E\\n          \\u003C\\/a\\u003E\\n        \\u003C\\/li\\u003E    \\u003C\\/ul\\u003E\\n    \\u003Cul class=\\"trends-locations-list\\"\\u003E\\n        \\u003Cli\\u003E\\n          \\u003Ca href=\\"#\\" class=\\"trends-location-item js-trend-link\\" data-woeid=\\"2487956\\"\\u003E\\n            San Francisco\\n            \\u003Ci class=\\"checkmark\\"\\u003E\\u003C\\/i\\u003E\\n          \\u003C\\/a\\u003E\\n        \\u003C\\/li\\u003E    \\u003C\\/ul\\u003E\\n    \\u003Cul class=\\"trends-locations-list\\"\\u003E\\n    \\u003C\\/ul\\u003E\\n  \\u003C\\/div\\u003E\\n\\u003C\\/div\\u003E\\n"}')
});
define("test/fixtures/trends_location_dialog_api",["module","require","exports"],function(module, require, exports) {
module.exports={trends_cache_key:"203212ee5a2999e68700d1f29cfb99",location:{woeid:1,name:"Worldwide"},dialog_html:'<div class="trends-by-location">\n\n  <div id="trend-locations-loading" class="spinner" style="display:none;"></div>\n\n  <div class="trends-search-locations trend-locations-section">\n  <form class="form-search trends-search-form">\n    <label class="visuallyhidden">Trend location search</label>\n    <input class="search-input trends-location-search-input" type="text" name="search-locations" placeholder="Search locations" autocomplete="off"></input>\n    <div class="dropdown-menu typeahead">\n  <div class="dropdown-caret">\n    <div class="caret-outer"></div>\n    <div class="caret-inner"></div>\n  </div>\n  <div class="dropdown-inner js-typeahead-results">\n    <ul class="typeahead-items saved-searches-list">\n  \n  <li class="typeahead-item typeahead-saved-search-item"><a class="js-nav" href="" data-search-query="" data-query-source="" data-ds="saved_search" tabindex="-1"><i class="generic-search"></i></a></li>\n</ul>\n    <ul class="typeahead-items topics-list">\n  \n  <li class="typeahead-item typeahead-topic-item"><a class="js-nav" href="" data-search-query="" data-query-source="typeahead_click" data-ds="topics" tabindex="-1"><i class="generic-search"></i></a></li>\n</ul>\n    <div class="typeahead-accounts js-typeahead-accounts">\n  <ul class="typeahead-items">\n    \n    <li data-user-id="" data-user-screenname="" data-remote="true" data-score="" class="typeahead-item typeahead-account-item js-selectable">\n      \n      <a class="js-nav" data-query-source="typeahead_click" data-search-query="" data-ds="account">\n        <img width="24" height="24" class="avatar size24">\n        <span class="fullname"></span>\n        <span class="js-verified hidden"><span class="icon verified"><span class="visuallyhidden">Verified account</span></span></span>\n        <span class="username"><s>@</s><b></b></span>\n      </a>\n    </li>\n    <li class="js-selectable typeahead-accounts-shortcut js-shortcut"><a class="js-nav" href="" data-search-query="" data-query-source="typeahead_click" data-shortcut="true" data-ds="account_search"></a></li>\n  </ul>\n</div>\n    <ul class="typeahead-items typeahead-trend-locations-list">\n  \n  <li class="typeahead-item typeahead-trend-locations-item"><a class="js-nav" href="" data-ds="trend_location" data-search-query="" tabindex="-1"></a></li>\n</ul>\n  </div>\n</div>\n  </form>\n</div>\n\n  <hr class="modal-divider">\n\n  <div id="trend-locations-panes">\n\n    \n    <div id="trend-locations-no-results" style="display:none;">\n      No results were found. <a class="js-show-dropdown-select">Try selecting from a list.</a>\n    </div>\n\n    <div id="trend-locations-quick-select">\n      <div class="trends-recent-locations trend-locations-section">\n  <h3>Recent Locations</h3>\n  <p class="no-results">No recent locations available.</p>\n  \n  <ul class="trend-location-picker clearfix">\n    \n    <li>\n      <a class="trend-location-picker-item" href="#"></a>\n    </li>\n  </ul>\n</div>\n      <div class="trends-nearby-locations trend-locations-section">\n  <h3>Nearby Locations</h3>\n  &middot;\n  <a class="js-show-dropdown-select">Select your location</a>\n  <ul class="trend-location-picker clearfix">\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="1" data-name="Worldwide">Worldwide</a>\n      </li>\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="2972" data-name="Winnipeg">Winnipeg</a>\n      </li>\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="3369" data-name="Ottawa">Ottawa</a>\n      </li>\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="3444" data-name="Quebec">Quebec</a>\n      </li>\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="3534" data-name="Montreal">Montreal</a>\n      </li>\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="4118" data-name="Toronto">Toronto</a>\n      </li>\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="8676" data-name="Edmonton">Edmonton</a>\n      </li>\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="8775" data-name="Calgary">Calgary</a>\n      </li>\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="9807" data-name="Vancouver">Vancouver</a>\n      </li>\n      <li>\n        <a class="trend-location-picker-item" href="#" data-woeid="12723" data-name="Birmingham">Birmingham</a>\n      </li>\n  </ul>\n</div>\n    </div>\n\n    <div id="trend-locations-dropdown-select" class="trend-locations-section" style="display:none;">\n      <div class="trend-locations-section">\n  <h3>Select a location for your trends</h3> &middot;\n  <a class="js-show-quick-select">Back</a>\n  <form class="form-horizontal">\n    <fieldset class="control-group">\n      <label class="control-label">Region/Country:</label>\n      <div class="controls">\n        <select name="regions">\n            <option value="1">Worldwide</option>\n        </select>\n      </div>\n    </fieldset>\n    <fieldset class="control-group">\n      <label class="control-label">City:</label>\n      <div class="controls">\n        <select name="cities">\n          \n            <optgroup label="Worldwide" data-woeid="1">\n                <option value="1" data-name="Worldwide">All Cities</option>\n            </optgroup>\n        </select>\n      </div>\n    </fieldset>\n  </form>\n</div>\n    </div>\n\n  </div>\n</div>\n',personalized:!1,trendLocations:[{name:"Worldwide",countryName:"",woeid:1,placeTypeCode:19},{name:"Winnipeg",countryName:"Canada",woeid:2972,placeTypeCode:7},{name:"Ottawa",countryName:"Canada",woeid:3369,placeTypeCode:7},{name:"Quebec",countryName:"Canada",woeid:3444,placeTypeCode:7},{name:"Montreal",countryName:"Canada",woeid:3534,placeTypeCode:7},{name:"Toronto",countryName:"Canada",woeid:4118,placeTypeCode:7},{name:"Edmonton",countryName:"Canada",woeid:8676,placeTypeCode:7},{name:"Calgary",countryName:"Canada",woeid:8775,placeTypeCode:7},{name:"Vancouver",countryName:"Canada",woeid:9807,placeTypeCode:7},{name:"Birmingham",countryName:"United Kingdom",woeid:12723,placeTypeCode:7}]}
});
define("test/fixtures/advanced_search",["module","require","exports"],function(module, require, exports) {
module.exports='<div class="search advanced-search"><h1>Advanced <strong>Search</strong></h1><form class="twitter-form"><fieldset><legend><span>Words</span></legend><div class="txt"><label><span class="td">All of these words</span><input type="text" name="ands"></label></div><div class="txt"><label><span class="td">This exact phrase</span><input type="text" name="phrase"></label></div><div class="txt"><label><span class="td">Any of these words</span><input type="text" name="ors"></label></div><div class="txt"><label><span class="td">None of these words</span><input type="text" name="nots"></label></div><div class="txt"><label><span class="td">These hashtags</span><input type="text" name="tag"></label></div><div class="txt"><label><span class="td">Written in</span><select id="lang" name="lang"><option value="all" selected>Any Language</option><option value="am">Amharic (&#4768;&#4635;&#4653;&#4763;)</option><option value="ar">Arabic (&#1575;&#1604;&#1593;&#1585;&#1576;&#1610;&#1577;)</option><option value="bg">Bulgarian (&#1041;&#1098;&#1083;&#1075;&#1072;&#1088;&#1089;&#1082;&#1080;)</option><option value="bn">Bengali (&#2476;&#2494;&#2434;&#2482;&#2494;)</option><option value="bo">Tibetan (&#3926;&#3964;&#3921;&#3851;&#3942;&#3984;&#3921;)</option><option value="chr">Cherokee (&#5091;&#5043;&#5033;)</option><option value="da">Danish (Dansk)</option><option value="de">German (Deutsch)</option><option value="dv">Maldivian (&#1931;&#1960;&#1928;&#1964;&#1920;&#1960;)</option><option value="el">Greek (&Epsilon;&lambda;&lambda;&eta;&nu;&iota;&kappa;&#940;)</option><option value="en">English (English)</option><option value="es">Spanish (Espa&ntilde;ol)</option><option value="fa">Persian (&#1601;&#1575;&#1585;&#1587;&#1740;)</option><option value="fi">Finnish (Suomi)</option><option value="fr">French (Fran&ccedil;ais)</option><option value="gu">Gujarati (&#2711;&#2753;&#2716;&#2736;&#2750;&#2724;&#2752;)</option><option value="iw">Hebrew (&#1506;&#1489;&#1512;&#1497;&#1514;)</option><option value="hi">Hindi (&#2361;&#2367;&#2306;&#2342;&#2368;)</option><option value="hu">Hungarian (Magyar)</option><option value="hy">Armenian (&#1344;&#1377;&#1397;&#1381;&#1408;&#1381;&#1398;)</option><option value="in">Indonesian (Bahasa Indonesia)</option><option value="is">Icelandic (&Iacute;slenska)</option><option value="it">Italian (Italiano)</option><option value="iu">Inuktitut (&#5123;&#5316;&#5251;&#5198;&#5200;&#5222;)</option><option value="ja">Japanese (&#26085;&#26412;&#35486;)</option><option value="ka">Georgian (&#4325;&#4304;&#4320;&#4311;&#4323;&#4314;&#4312;)</option><option value="km">Khmer (&#6017;&#6098;&#6040;&#6082;&#6042;)</option><option value="kn">Kannada (&#3221;&#3240;&#3277;&#3240;&#3233;)</option><option value="ko">Korean (&#54620;&#44397;&#50612;)</option><option value="lo">Lao (&#3749;&#3762;&#3751;)</option><option value="lt">Lithuanian (Lietuvi&#371;)</option><option value="ml">Malayalam (&#3374;&#3378;&#3375;&#3390;&#3379;&#3330;)</option><option value="my">Myanmar (&#4121;&#4156;&#4116;&#4154;&#4121;&#4140;&#4120;&#4140;&#4126;&#4140;)</option><option value="ne">Nepali (&#2344;&#2375;&#2346;&#2366;&#2354;&#2368;)</option><option value="nl">Dutch (Nederlands)</option><option value="no">Norwegian (Norsk)</option><option value="or">Oriya (&#2835;&#2849;&#2876;&#2879;&#2822;)</option><option value="pa">Panjabi (&#2602;&#2672;&#2588;&#2622;&#2604;&#2624;)</option><option value="pl">Polish (Polski)</option><option value="pt">Portuguese (Portugu&ecirc;s)</option><option value="ru">Russian (&#1056;&#1091;&#1089;&#1089;&#1082;&#1080;&#1081;)</option><option value="si">Sinhala (&#3523;&#3538;&#3458;&#3524;&#3517;)</option><option value="sv">Swedish (Svenska)</option><option value="ta">Tamil (&#2980;&#2990;&#3007;&#2996;&#3021;)</option><option value="te">Telugu (&#3108;&#3142;&#3122;&#3137;&#3095;&#3137;)</option><option value="th">Thai (&#3652;&#3607;&#3618;)</option><option value="tl">Tagalog (Tagalog)</option><option value="tr">Turkish (T&uuml;rk&ccedil;e)</option><option value="ur">Urdu (&#65165;&#65197;&#65193;&#65261;)</option><option value="vi">Vietnamese (Ti&#7871;ng Vi&#7879;t)</option><option value="zh">Chinese (&#20013;&#25991;)</option></select></label></div></fieldset><fieldset><legend><span>People</span></legend><div class="txt"><label><span class="td">From these accounts</span><input type="text" name="from"></label></div><div class="txt"><label><span class="td">To these accounts</span><input type="text" name="to"></label></div><div class="txt"><label><span class="td">Mentioning these accounts</span><input type="text" name="ref"></label></div></fieldset><fieldset class="geo"><legend><span>Places</span></legend><div class="txt"><label><span class="td">Near this place</span><input type="text" name="near"></label></div><div class="sel"><label><span class="td">Within this distance</span><select name="within"><option value="1">1</option><option value="5">5</option><option value="10">10</option><option value="15" selected>15</option><option value="25">25</option><option value="50">50</option><option value="100">100</option><option value="500">500</option><option value="1000">1000</option></select></label><span class="rad"><label><input name="units" type="radio" value="mi" checked><span>miles</span></label><label><input name="units" type="radio" value="km"><span>kilometers</span></label></span></div></fieldset><fieldset><legend><span>Other</span></legend><div class="chk"><span class="td">Select:</span><span class="chk-inner"><label><input name="attd" type="checkbox" value=":)"><span>Positive :)</span></label><label><input name="attd" type="checkbox" value=":("><span>Negative :(</span></label><label><input name="attd" type="checkbox" value="?"><span>Question ?</span></label><label><input name="include" type="checkbox" value="retweets"><span>Include retweets</span></label></span></div></fieldset><button class="button btn primary-btn submit selected" type="submit" value="go">Search</button></form></div>'
});
define("test/fixtures/settings_design_page",["module","require","exports"],function(module, require, exports) {
module.exports='<form id="design-form" class="form-horizontal" method="post" enctype="multipart/form-data" action="http://localhost.twitter.com:4000/settings/design/update"><input type="hidden" name="authenticity_token" value="dummy auth token"><div id="settings-alert-box" class="alert" style="display: none;"><i id="settings-alert-close" class="close"></i></div><h3 class="settings-header">Pick a premade theme</h3><input id="user_profile_theme" name="profile_theme" type="hidden" value="1"><input id="user_profile_default" name="user[profile_default]" type="hidden" value=""><fieldset class="control-group"><ul class="theme-list clearfix"><li class="theme-item"><label class="theme selected" data-image="/images/themes/theme1/bg.png" data-id="1" data-background_color="#C0DEED" data-link_color="#0084B4" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme2/bg.gif" data-id="2" data-background_color="#C6E2EE" data-link_color="#1F98C7" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme3/bg.gif" data-id="3" data-background_color="#EDECE9" data-link_color="#088253" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme4/bg.gif" data-id="4" data-background_color="#0099B9" data-link_color="#0099B9" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme5/bg.gif" data-id="5" data-background_color="#352726" data-link_color="#D02B55" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme6/bg.gif" data-id="6" data-background_color="#709397" data-link_color="#FF3300" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme7/bg.gif" data-id="7" data-background_color="#EBEBEB" data-link_color="#990000" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme8/bg.gif" data-id="8" data-background_color="#8B542B" data-link_color="#9D582E" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme9/bg.gif" data-id="9" data-background_color="#1A1B1F" data-link_color="#2FC2EF" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme10/bg.gif" data-id="10" data-background_color="#642D8B" data-link_color="#FF0000" data-tiled="true"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme11/bg.gif" data-id="11" data-background_color="#FF6699" data-link_color="#B40B43" data-tiled="true"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme12/bg.gif" data-id="12" data-background_color="#BADFCD" data-link_color="#FF0000" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme13/bg.gif" data-id="13" data-background_color="#B2DFDA" data-link_color="#93A644" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme14/bg.gif" data-id="14" data-background_color="#131516" data-link_color="#009999" data-tiled="true"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme15/bg.png" data-id="15" data-background_color="#022330" data-link_color="#0084B4" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme16/bg.gif" data-id="16" data-background_color="#9AE4E8" data-link_color="#0084B4" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme17/bg.gif" data-id="17" data-background_color="#DBE9ED" data-link_color="#CC3366" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme18/bg.gif" data-id="18" data-background_color="#ACDED6" data-link_color="#038543" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li><li class="theme-item"><label class="theme" data-image="/images/themes/theme19/bg.gif" data-id="19" data-background_color="#FFF04D" data-link_color="#0099CC" data-tiled="false"><span class="selected-border"></span><img class="theme-image" src=""></label></li></ul><div class="themeleon-callout"><strong><a href="http://www.colourlovers.com/themeleon/twitter" target="_blank" id="themeleon_link">Check out Themeleon &raquo;</a></strong> Thousands of background patterns &amp; color palettes available to customize your Twitter profile. </div></fieldset><hr><h3 class="settings-header">Customize your own</h3><fieldset class="control-group"><p>See your changes instantly; they\'re not saved until you click "Save changes." <a href="https://support.twitter.com/articles/15357" target="_blank">Learn more</a>.</p></fieldset><fieldset class="control-group"><label class="control-label">Background</label><div class="controls background-settings"><div class="uploader-image uploader-background clearfix"><span id="background_image_preview" class="image-preview bg-preview" style="background-image: url(/unversioned_dev_assets/images/themes/theme1/bg.png)"></span><div class="uploader-tools"><input id="user_profile_use_background_image" type="hidden" name="user[profile_use_background_image]" value="true"><div class="photo-selector"><button class="btn" type="button" disabled>Choose file</button><span class="photo-file-name">No file selected</span><div class="image-selector"><input type="hidden" name="media_file_name" class="file-name"><input type="hidden" name="media_data_empty" class="file-data"><input type="file" name="media_empty" class="file-input"><div class="swf-container"></div></div></div><p>Maximum size of 800k. GIF, JPG, PNG.</p><button class="btn-link" id="remove_background" type="button">Remove background</button><label class="checkbox"><input id="user_profile_background_tile" name="user[profile_background_tile]" type="checkbox" value="1"><input name="user[profile_background_tile]" type="hidden" value="0"> Tile background</label></div></div></div></fieldset><fieldset class="control-group"><label class="control-label">Background color</label><div class="controls"><div id="background_color" class="color-preview" style="background-color: #C0DEED;"></div><input id="background_color_hex" class="input-small input-color" type="text" data-type="background_color" data-color="#C0DEED" value="#C0DEED" name="user[profile_background_color]"></div></fieldset><fieldset class="control-group"><label class="control-label">Link color</label><div class="controls"><div id="links_color" class="color-preview" style="background-color: #0084B4;"></div><input id="links_color_hex" class="input-small input-color" data-type="links_color" data-color="#0084B4" type="text" value="#0084B4" name="user[profile_link_color]"></div></fieldset><hr><div class="form-actions"><button id="settings_save" class="btn primary-btn" type="submit">Save changes</button></div><div id="profile_image_upload_dialog" class="modal-container"><div id="avatar-guid" name="super-secret-div" style="display:none"></div><div class="close-modal-background-target"></div><div class="modal draggable profile-header-modal" style="top: 50px!important"><div class="modal-content"><button class="modal-btn modal-close"><i class="close-medium"></i></button><div class="modal-header"><h3 class="modal-title">Upload a header image</h3></div><div class="modal-body"><div class="alert profile-image-alert message" style="display: none;"><div><span id="profile-image-alert-message"></span><a class="dismiss" href="#">&times;</a></div></div><img src="" id="swf-spinner" style="display: none"><div class="upload-frame" id="image-upload-select"><div class="uploader-avatar clearfix"><div><div class="uploader-tool" id="upload-option-file"><strong class="uploader-copy">Upload an image.</strong><form id="profile-upload-image-form" class="form-horizontal" enctype="multipart/form-data" method="POST" action=""><input type="hidden" name="authenticity_token" value="dummy auth token"><input type="hidden" value="POST" name="_method"><div class="photo-selector"><button class="btn" type="button" disabled>Choose file</button><span class="photo-file-name">No file selected</span><div class="image-selector"><input type="hidden" name="media_file_name" class="file-name"><input type="hidden" name="media_data_empty" class="file-data"><input type="file" name="media_empty" class="file-input"><div class="swf-container"></div></div></div></form></div></div></div></div><div class="upload-frame" id="image-upload-webcam" style="display: none"><div id="webcam-container"></div><canvas id="webcam-canvas" height="240" width="320" style="display:none"></canvas></div><div class="upload-frame clearfix" id="image-upload-crop" style="display: none"><img src="" id="crop-spinner" style="display: none"><div class="crop-zone cropper-header-size" id="crop-zone"><div class="cropper-mask" id="cropper-mask"><div class="cropper-overlay"></div><img id="crop-image" class="crop-image" src=""></div><div class="cropper-slider" id="cropper-slider"></div></div></div></div><div class="modal-footer"><div class="left-buttons"><a class="btn" id="profile-image-cancel">Cancel</a></div><div class="right-buttons"><a class="btn" id="profile-image-previous" style="display: none">Previous</a><a class="btn primary-btn disabled" id="profile-image-capture-webcam" style="display: none">Take picture</a><a class="btn primary-btn" id="profile-image-save" style="display: none">Save</a></div></div></div></div></div></form>'
});
define("test/fixtures/resend_password_help",["module","require","exports"],function(module, require, exports) {
module.exports='<div id="resend_password_help" class="page-canvas route-resend-password"><div class="resend-password-wrapper"><h1>Haven\'t received your password reset message?</h1><input type="hidden" id="resend_type" value="email"><div id="alternate_choice" class="hidden top-element"><p>It looks like you\'ve already tried to reset your password by email. Would you like to try resetting by phone instead?</p></div><div id="resend_email" class="hidden top-element"><p>You have a valid email address associated with your account. Should we send a password reset link to this address?</p></div><div id="verify_phone" class="hidden top-element"><p>The phone number we have on file ends in <span id="phone_digits"></span>. Is this correct?</p></div><div id="verify_domain" class="hidden top-element"><p>The email address we have on file is a <span class="email_domain"></span> address. Do you have a <span class="email_domain"></span> email account?</p></div><div id="request_sms" class="hidden top-element"><p>Try <a href="/account/resend_password">requesting a new SMS</a>. If you still don\'t receive a message in a few minutes, then unfortunately there is nothing else we can do to help you regain access to your account.</p></div><div id="contact_support" class="hidden top-element contact_support"><p>Please <a href="https://support.twitter.com/forms/signin?type=lost_access">contact Twitter support</a> for further assistance.</p></div><div id="yes_no_buttons" class="hidden top-element"><div class="resend-password separator"></div><button class="btn primary-btn" id="yes_button">Yes</button><button class="btn primary-btn" id="no_button">No</button></div></div></div>'
});
define("test/app/ui/with_conversation_actions_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_conversation_actions",function(){function f(a,b){return c.replace(/{{id}}/g,a).replace(/{{ancestors}}/g,b.join(","))}function g(a,b){return d.replace(/{{id}}/g,a).replace(/{{ancestors}}/g,b.join(","))}function h(a,b){return e.replace(/{{id}}/g,a).replace(/{{ancestors}}/g,b.join(","))}function i(a){a.attr("tabindex",-1).focus()}var a="<ol class='stream-items'>\n    <li id='stream-item-tweet-6' class='stream-item'>\n      <ol class='conversation-module' data-ancestors='3,5'>\n        <li><div class='tweet simple-tweet'></div></li>\n        <li><div class='tweet simple-tweet'></div></li>\n        <li class='original-tweet-item'><div class='tweet original-tweet' data-item-id='6'></div></li>\n      </ol>\n    </li>\n    <li id='stream-item-tweet-5' class='stream-item'><div class='tweet original-tweet'></div></li>\n    <li id='stream-item-tweet-4' class='before-expanded stream-item'><div class='tweet original-tweet'></div></li>\n    <li id='stream-item-tweet-3' class='selected-stream-item stream-item'><div class='tweet original-tweet'></div></li>\n    <li id='stream-item-tweet-2' class='after-expanded stream-item'><div class='tweet original-tweet'></div></li>\n    <li id='stream-item-tweet-1' class='stream-item'><div class='tweet original-tweet'></div></li>\n  </ol>\n  ",b="<li id='stream-item-tweet-7' class='stream-item'>\n    <ol class='conversation-module' data-ancestors='3,5,6'>\n      <li><div class='tweet simple-tweet'></div></li>\n      <li><div class='tweet simple-tweet'></div></li>\n      <li class='original-tweet-item'><div class='tweet original-tweet'></div></li>\n    </ol>\n  </li>\n  ",c="<li id='stream-item-tweet-{{id}}' class='stream-item'>\n    <ol class='conversation-module' data-ancestors='{{ancestors}}'>\n      <li class='conversation-header' style='display: none'>\n        <a href='/' class='uncollapse'>User started this conversation</a>\n      </li>\n      <li class='conversation-ancestor conversation-root conversation-tweet-item'><div class='tweet simple-tweet'></div></li>\n      <li class='original-tweet-item'><div class='tweet original-tweet'></div></li>\n    </ol>\n  </li>\n  ",d="<li id='stream-item-tweet-{{id}}' class='stream-item'>\n    <ol class='conversation-module' data-ancestors='{{ancestors}}'>\n      <li class='conversation-header' style='display: none'>\n        <a href='/' class='uncollapse'>User started this conversation</a>\n      </li>\n      <li class='conversation-ancestor conversation-root conversation-tweet-item'><div class='tweet simple-tweet'></div></li>\n      <li class='conversation-ancestor conversation-tweet-item'><div class='tweet simple-tweet'></div></li>\n      <li class='original-tweet-item'><div class='tweet original-tweet'></div></li>\n    </ol>\n  </li>\n  ",e="<li id='stream-item-tweet-{{id}}' class='stream-item'>\n    <ol class='conversation-module' data-ancestors='{{ancestors}}'>\n      <li class='conversation-header' style='display: none'>\n        <a href='/' class='uncollapse'>User started this conversation</a>\n      </li>\n      <li class='conversation-root conversation-tweet-item'><div class='tweet simple-tweet'></div></li>\n      <li class='missing-tweets-bar'>\n        <a href='/' class='missing-tweets-link'>View more tweets</a>\n      </li>\n      <li class='conversation-ancestor conversation-tweet-item'><div class='tweet simple-tweet'></div></li>\n      <li class='original-tweet-item'><div class='tweet original-tweet'></div></li>\n    </ol>\n  </li>\n  ";beforeEach(function(){jasmine.Clock.useMock(),spyOnEvent(document,"uiSelectNext"),setupComponent(a,{selectedClass:"selected-stream-item"})}),describe("Deduping",function(){describe("on module initialization",function(){it("removes elements that match data-ancestors",function(){jasmine.Clock.tick(1e3),expect(this.$node.find("li#stream-item-tweet-6")).toExist(),expect(this.$node.find("li#stream-item-tweet-5")).not.toExist(),expect(this.$node.find("li#stream-item-tweet-3")).not.toExist()}),it("moves selection to next tweet if selection is deleted",function(){jasmine.Clock.tick(1e3),expect("uiSelectNext").toHaveBeenTriggeredOn(document)}),it("removes before-expanded and after-expanded classes from adjacent stream items",function(){var a=this.$node.find("li#stream-item-tweet-4"),b=this.$node.find("li#stream-item-tweet-2");jasmine.Clock.tick(1e3),expect(a).not.toHaveClass("before-expanded"),expect(b).not.toHaveClass("after-expanded")})}),describe("on uiHasInjectedNewTimeline",function(){describe("with option noNewDedup set to to false",function(){beforeEach(function(){setupComponent(a,{noNewDedup:!1})}),it("removes elements that match data-ancestors",function(){jasmine.Clock.tick(1e3),expect(this.$node.find("li#stream-item-tweet-6")).toExist(),expect(this.$node.find("li#stream-item-tweet-7")).not.toExist(),this.$node.prepend(b),this.$node.trigger("uiHasInjectedNewTimeline"),jasmine.Clock.tick(1e3),expect(this.$node.find("li#stream-item-tweet-6")).not.toExist(),expect(this.$node.find("li#stream-item-tweet-7")).toExist()})}),describe("with option noNewDedup set to to true",function(){beforeEach(function(){setupComponent(a,{noNewDedup:!0})}),it("doesn't dedup, but collapses elements that match data-ancestors",function(){jasmine.Clock.tick(1e3),expect(this.$node.find("li#stream-item-tweet-6")).toExist(),expect(this.$node.find("li#stream-item-tweet-7")).not.toExist(),this.$node.prepend(b),this.$node.trigger("uiHasInjectedNewTimeline"),jasmine.Clock.tick(1e3),expect(this.$node.find("li#stream-item-tweet-6")).toExist(),expect(this.$node.find("li#stream-item-tweet-7 .conversation-module")).toHaveClass("collapsed-ancestors")})})})}),describe("Collapsing",function(){describe("two modules with identical ancestors",function(){beforeEach(function(){var a="<ol class='stream-items'>";a+=h(7,[5,4,3,2,1]),a+=h(6,[5,4,3,2,1]),a+="</ol>",setupComponent(a)}),describe("in the default state",function(){beforeEach(function(){var a=$("#stream-item-tweet-7");jasmine.Clock.tick(1e3)}),it("hides duplicated ancestors",function(){var a=$("#stream-item-tweet-7");expect(a.find(".conversation-header")).toBeVisible(),expect(a.find(".missing-tweets-bar")).not.toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).not.toBeVisible(),expect(a.find(".conversation-tweet-item:not(.conversation-root)")).not.toBeVisible(),expect(a.find(".original-tweet-item")).toBeVisible()}),it("makes the header selectable via the keyboard",function(){var a=$("#stream-item-tweet-7");expect(a.find(".conversation-header")).not.toHaveClass(this.component.attr.unselectableStreamItemClass)}),it("adds the 'first-navigable-stream-item' class to the first visible item in the conversation",function(){var a=$("#stream-item-tweet-7");expect(a.find(".conversation-module>li").filter(":visible").first()).toHaveClass(this.component.attr.firstNavigableStreamItemClass)}),it("adds the 'last-navigable-stream-item' class to the last visible item in the conversation",function(){var a=$("#stream-item-tweet-7");expect(a.find(".conversation-module>li").filter(":visible").last()).toHaveClass(this.component.attr.lastNavigableStreamItemClass)})}),describe("when the conversation header is clicked",function(){beforeEach(function(){var a=$("#stream-item-tweet-7");jasmine.Clock.tick(1e3),a.find(".uncollapse").click(),jasmine.Clock.tick(1e3)}),it("shows hidden ancestors",function(){var a=$("#stream-item-tweet-7");expect(a.find(".conversation-header")).not.toBeVisible(),expect(a.find(".missing-tweets-bar")).toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).toBeVisible(),expect(a.find(".conversation-tweet-item:not(.conversation-root)")).toBeVisible(),expect(a.find(".original-tweet-item")).toBeVisible()}),it("makes the header unselectable via the keyboard",function(){var a=$("#stream-item-tweet-7");expect(a.find(".conversation-header")).toHaveClass(this.component.attr.unselectableStreamItemClass)}),it("adds the 'first-navigable-stream-item' class to the first visible item in the conversation",function(){var a=$("#stream-item-tweet-7");expect(a.find(".conversation-module>li").filter(":visible").first()).toHaveClass(this.component.attr.firstNavigableStreamItemClass)}),it("adds the 'last-navigable-stream-item' class to the last visible item in the conversation",function(){var a=$("#stream-item-tweet-7");expect(a.find(".conversation-module>li").filter(":visible").last()).toHaveClass(this.component.attr.lastNavigableStreamItemClass)})}),describe("when the user presses Enter while focused on the header",function(){describe("and the conversation does not have visible ancestors",function(){beforeEach(function(){var a=$("#stream-item-tweet-7");jasmine.Clock.tick(1e3);var b=a.find(".conversation-root.conversation-tweet-item");spyOnEvent(b,"uiSelectItem");var c=a.find(".conversation-header");i(c),this.component.trigger(c,"uiShortcutEnter"),jasmine.Clock.tick(1e3)}),it("hides the header",function(){var a=$("#stream-item-tweet-7");expect(a.find(".conversation-header")).not.toBeVisible()}),it("selects and focuses the root Tweet",function(){var a=$("#stream-item-tweet-7"),b=a.find(".conversation-root.conversation-tweet-item");expect("uiSelectItem").toHaveBeenTriggeredOnAndWith(b,{setFocus:!0})}),it("shows the hidden ancestors",function(){var a=$("#stream-item-tweet-7");expect(a.find(".missing-tweets-bar")).toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).toBeVisible(),expect(a.find(".conversation-tweet-item:not(.conversation-root)")).toBeVisible(),expect(a.find(".original-tweet-item")).toBeVisible()})})})}),describe("modules with shared roots",function(){beforeEach(function(){var a="<ol class='stream-items'>";a+=h(15,[14,13,12,1]),a+=f(9,[1]),a+=g(8,[6,1]),a+=h(5,[4,3,2,1]),a+="</ol>",setupComponent(a),jasmine.Clock.tick(1e3)}),describe("two-tweet module",function(){it("hides duplicated roots",function(){var a=$("#stream-item-tweet-9");expect(a.find(".conversation-header")).toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).not.toBeVisible(),expect(a.find(".original-tweet-item")).toBeVisible()}),it("shows hidden root on .uncollapse click",function(){var a=$("#stream-item-tweet-9");a.find(".uncollapse").click(),jasmine.Clock.tick(1e3),expect(a.find(".conversation-header")).not.toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).toBeVisible(),expect(a.find(".original-tweet-item")).toBeVisible()})}),describe("three-tweet module",function(){describe("in the default state",function(){it("hides duplicated roots",function(){var a=$("#stream-item-tweet-8");expect(a.find(".conversation-header")).toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).not.toBeVisible(),expect(a.find(".conversation-tweet-item:not(.conversation-root)")).toBeVisible(),expect(a.find(".original-tweet-item")).toBeVisible()})}),describe("when the user clicks on the conversation-header",function(){it("shows hidden root",function(){var a=$("#stream-item-tweet-8");a.find(".uncollapse").click(),jasmine.Clock.tick(1e3),expect(a.find(".conversation-header")).not.toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).toBeVisible(),expect(a.find(".conversation-tweet-item:not(.conversation-root)")).toBeVisible(),expect(a.find(".original-tweet-item")).toBeVisible()})}),describe("when the user presses Enter while focused on the header",function(){beforeEach(function(){var a=$("#stream-item-tweet-8");jasmine.Clock.tick(1e3);var b=a.find(".conversation-root.conversation-tweet-item");spyOnEvent(b,"uiSelectItem");var c=a.find(".conversation-header");i(c),this.component.trigger(c,"uiShortcutEnter"),jasmine.Clock.tick(1e3)}),it("hides the header",function(){var a=$("#stream-item-tweet-8");expect(a.find(".conversation-header")).not.toBeVisible()}),it("selects and focuses the root Tweet",function(){var a=$("#stream-item-tweet-8"),b=a.find(".conversation-root.conversation-tweet-item");expect("uiSelectItem").toHaveBeenTriggeredOnAndWith(b,{setFocus:!0})})})}),describe("multi-tweet module",function(){it("hides duplicated roots",function(){var a=$("#stream-item-tweet-15");expect(a.find(".conversation-header")).toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).not.toBeVisible(),expect(a.find(".missing-tweets-bar")).not.toBeVisible(),expect(a.find(".conversation-tweet-item:not(.conversation-root)")).toBeVisible(),expect(a.find(".original-tweet-item")).toBeVisible()}),it("shows hidden root on .uncollapse click",function(){var a=$("#stream-item-tweet-15");a.find(".uncollapse").click(),jasmine.Clock.tick(1e3),expect(a.find(".conversation-header")).not.toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).toBeVisible(),expect(a.find(".missing-tweets-bar")).toBeVisible(),expect(a.find(".conversation-tweet-item:not(.conversation-root)")).toBeVisible(),expect(a.find(".original-tweet-item")).toBeVisible()})})}),describe("properly collapsing new conversation tweets",function(){beforeEach(function(){var a="<ol class='stream-items'>";a+=h(15,[14,13,12,1]),a+=f(9,[1]),a+=g(8,[6,1]),a+="</ol>",setupComponent(a,{streamItemSelector:".stream-item"}),jasmine.Clock.tick(1e3)}),it("collapses new conversation tweets over existing tweets",function(){var a=$(g(10,[7,1]));$(".stream-items").prepend(a),$(document).trigger("uiHasInjectedNewTimeline",{tweets:[{tweetId:10}]}),jasmine.Clock.tick(1e3);var b=$("#stream-item-tweet-8");expect(b.find(".conversation-tweet-item.conversation-root")).toBeVisible(),expect(a.find(".conversation-tweet-item.conversation-root")).not.toBeVisible()})})})})
});
define("test/app/ui/discover_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/discover",{fixture:"test/fixtures/discover_stories"},function(){beforeEach(function(){setupComponent(this.fixture)}),describe("event dataStoriesRefreshed",function(){beforeEach(function(){spyOnEvent(this.$node,"uiWantsToCloseAllStories"),spyOnEvent(this.$node,"uiTimelineReset"),this.component.trigger("dataStoriesRefreshed",{items_html:'<div class="new-node"></div>'})}),it("substitutes the html content",function(){expect(this.$node).toContain(".new-node")}),it("triggers uiWantsToCloseAllStories on refresh",function(){expect("uiWantsToCloseAllStories").toHaveBeenTriggeredOn(this.$node)}),it("triggers uiTimelineReset",function(){expect("uiTimelineReset").toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/promptbird_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/promptbird",function(){describe("standard prompts",function(){function a(){var a='<div class="promptbird promptbird-below-black-bar" data-prompt-id="8">\n        <a class="dismiss js-dismiss" href="#"><i class="close"></i></a>\n        <div class="prompt-wrapper language" data-language="es">\n          <div class="prompt-content-wrapper">\n            <h2>¿Hablas español?</h2>\n            <p class="prompt-explanation">\n              Twitter esta disponible en español. Haz clic para cambiar tu configuración de idioma.\n            </p>\n            <div class="prompt-action-wrapper">\n              <span class="btn call-to-action set-language">Usa Twitter en español</span>\n              <span class="btn call-to-action dismiss-prompt">Usa Twitter en español</span>\n            </div>\n          </div>\n        </div>\n      </div>\n      ';return a}beforeEach(function(){setupComponent(a())}),describe("closing a prompt",function(){it("triggers a uiPromptbirdDismissPrompt when dismiss button is clicked",function(){spyOnEvent(document,"uiPromptbirdDismissPrompt"),this.component.select("dismissSelector").click(),expect("uiPromptbirdDismissPrompt").toHaveBeenTriggeredOnAndWith(document,{prompt_id:8})}),it("closes the prompt when dismiss button is clicked",function(){this.component.select("dismissSelector").click(),expect($(".promptbird").length).toEqual(0)})}),describe("clicking 'set language'",function(){it("triggers uiPromptbirdSetLanguage with the correct params",function(){spyOnEvent(this.$node,"uiPromptbirdSetLanguage"),this.component.select("setLanguageSelector").click(),expect("uiPromptbirdSetLanguage").toHaveBeenTriggeredOnAndWith(this.component,{lang:"es"})}),it("triggers uiPromptbirdClick",function(){spyOnEvent(this.$node,"uiPromptbirdClick"),this.component.select("setLanguageSelector").click(),expect("uiPromptbirdClick").toHaveBeenTriggeredOn(this.component)})}),describe("clicking 'dismiss prompt'",function(){it("triggers uiPromptbirdDismissPrompt",function(){spyOnEvent(this.$node,"uiPromptbirdDismissPrompt"),this.component.select("callToActionDismissSelector").click(),expect("uiPromptbirdDismissPrompt").toHaveBeenTriggeredOnAndWith(this.component,{prompt_id:8})}),it("triggers uiPromptbirdClick",function(){spyOnEvent(this.$node,"uiPromptbirdClick"),this.component.select("callToActionDismissSelector").click(),expect("uiPromptbirdClick").toHaveBeenTriggeredOn(this.component)})}),describe("clicking 'dismiss prompt'",function(){it("triggers uiPromptbirdDismissPrompt",function(){spyOnEvent(this.$node,"uiPromptbirdDismissPrompt"),this.component.select("callToActionDismissSelector").click(),expect("uiPromptbirdDismissPrompt").toHaveBeenTriggeredOnAndWith(this.component,{prompt_id:8})}),it("triggers uiPromptbirdClick",function(){spyOnEvent(this.$node,"uiPromptbirdClick"),this.component.select("callToActionDismissSelector").click(),expect("uiPromptbirdClick").toHaveBeenTriggeredOn(this.component)}),it("triggers uiPromptbirdClick",function(){spyOnEvent(this.$node,"uiPromptbirdClick"),this.component.select("callToActionSelector").click(),expect("uiPromptbirdClick").toHaveBeenTriggeredOn(this.component)})})}),describe("dashboard profile prompt",function(){function a(){var a='<div class="promptbird promptbird-dashboard-profile" data-prompt-id="102" style="display:none;">\n        <a class="dismiss js-dismiss" href="#" tabindex="-1"> <i class="close"></i> </a>\n        <div class="gain_followers_prompt prompt">\n          <div class="arrow-up-border"></div>\n          <div class="arrow-up-body"></div>\n\n          <p class="title"><strong>Gain more followers</strong></p>\n          <p>\n            <a class="call-to-action" href="https://ads.twitter.com/start?ref=us-me-tw-profile_module-1" target="_blank">Promote your account</a>\n            and get discovered by more people on Twitter. <a href="#" class="preview-promoted-account">Preview it first below</a>.\n          </p>\n        </div>\n      </div>\n      ';return a}beforeEach(function(){setupComponent(a())}),describe("receiving uiDidGetRecommendations",function(){it("triggers uiGotPromptbirdDashboardProfile",function(){spyOnEvent(this.$node,"uiGotPromptbirdDashboardProfile"),this.component.trigger(document,"uiDidGetRecommendations"),expect("uiGotPromptbirdDashboardProfile").toHaveBeenTriggeredOn(this.component)})}),describe("receiving uiDidGetRecommendations and dataDidGetSelfPromotedAccount",function(){it("triggers uiShowDashboardProfilePromptbird",function(){spyOnEvent(this.$node,"uiShowDashboardProfilePromptbird"),this.component.trigger(document,"uiDidGetRecommendations"),this.component.trigger(document,"dataDidGetSelfPromotedAccount"),expect("uiShowDashboardProfilePromptbird").toHaveBeenTriggeredOn(this.component)}),it("makes itself visible",function(){expect(this.$node).not.toBeVisible(),this.component.trigger(document,"uiDidGetRecommendations"),this.component.trigger(document,"dataDidGetSelfPromotedAccount"),expect(this.$node).toBeVisible()})}),describe("clicking 'preview promoted' account",function(){it("triggers uiPromptbirdPreviewPromotedAccount",function(){spyOnEvent(this.$node,"uiPromptbirdPreviewPromotedAccount"),this.component.select("previewPromotedAccountSelector").click(),expect("uiPromptbirdPreviewPromotedAccount").toHaveBeenTriggeredOn(this.component)})})}),describe("one click contact import button triggers uiPromptbirdDoOneClickImport",function(){it("Yahoo OAuth popup is triggered",function(){var a='<div class="promptbird promptbird-below-black-bar" data-prompt-id="49">\n        <div class="prompt-wrapper one-click-import">\n          <div class="prompt-content-wrapper">\n            <h2>Find your friends on Twitter</h2>\n\n            <div class="prompt-action-wrapper">\n              <span class="btn primary-btn call-to-action one-click-import-button" href="#" data-email="twitter@yahoo.com">\n                Import your contacts from twitter@yahoo.com\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      ';setupComponent(a),spyOnEvent(this.$node,"uiPromptbirdDoOneClickImport"),this.component.select("oneClickImportSelector").click(),expect("uiPromptbirdDoOneClickImport").toHaveBeenTriggeredOnAndWith(this.component,{url:"/invitations/oauth_launch?email=twitter%40yahoo.com",triggerEvent:!0})}),it("Gmail domain email launches larger OAuth popup",function(){var a='<div class="promptbird promptbird-below-black-bar" data-prompt-id="46">\n        <div class="prompt-wrapper one-click-import">\n          <div class="prompt-content-wrapper">\n            <h2>Find your friends on Twitter</h2>\n\n            <div class="prompt-action-wrapper">\n              <span class="btn primary-btn call-to-action one-click-import-button" href="#" data-email="twitter@gmail.com">\n                Import your contacts from twitter@gmail.com\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      ';setupComponent(a),spyOnEvent(this.$node,"uiPromptbirdDoOneClickImport"),this.component.select("oneClickImportSelector").click(),expect("uiPromptbirdDoOneClickImport").toHaveBeenTriggeredOnAndWith(this.component,{url:"/invitations/oauth_launch?email=twitter%40gmail.com",triggerEvent:!0,width:880,height:550})})}),describe("device follow button click",function(){it("triggers uiDeviceNotificationsOnAction",function(){var a='<div class="promptbird promptbird-below-black-bar" data-prompt-id="263">\n        <div class="prompt-wrapper device-follow" data-user-id="14984928">\n          <div class="prompt-content-wrapper">\n            <h2 class="device-follow">Don\'t miss out on Diana\'s tweets</h2>\n            <div class="device-follow prompt-action-wrapper">\n              <a href="javascript:;" class="btn call-to-action">Turn on mobile notifications</a>\n            </div>\n          </div>\n        </div>\n      </div>\n      ';setupComponent(a),spyOnEvent(this.$node,"uiDeviceNotificationsOnAction"),this.component.select("deviceFollowSelector").click(),expect("uiDeviceNotificationsOnAction").toHaveBeenTriggeredOnAndWith(this.component,{userId:14984928}),expect(this.$node).not.toBeVisible()})}),describe("mention tweet compose button click",function(){it("triggers uiPromptMentionTweetCompose",function(){var a='<div class="promptbird promptbird-below-black-bar" data-prompt-id="256">\n        <div class="prompt-wrapper show_tweet_dialog" data-screenname="dhc" data-title="Tweet to @dhc">\n          <div class="prompt-content-wrapper">\n            <h2>Say hi to Diana</h2>\n\n            <div class="prompt-action-wrapper">\n              <a class="btn primary-btn call-to-action" href="javascript:;">\n                Tweet\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n      ';setupComponent(a),spyOnEvent(this.$node,"uiPromptMentionTweetCompose"),this.component.select("promptMentionTweetComposeSelector").click(),expect("uiPromptMentionTweetCompose").toHaveBeenTriggeredOnAndWith(this.component,{screenName:"dhc",title:"Tweet to @dhc"}),expect(this.$node).not.toBeVisible()})}),describe("prompt with ending message",function(){function a(){var a='<div class="promptbird promptbird-below-black-bar" data-prompt-id="128">\n        <div class="prompt-wrapper">\n          <div class="prompt-content-wrapper">\n            <h2>Title</h2>\n\n            <p class="prompt-explanation">\n              Explanation\n            </p>\n\n            <div class="prompt-action-wrapper">\n              <button class="btn primary-btn call-to-action disabled" type="button" disabled="disabled">\n                Button\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div class="promptbird-ending-msg" style="display:none">\n          <div>\n            <h2 class="ending-msg-title">Thank you message</h2>\n            <p>additional type if necessary can go here</p>\n          </div>\n        </div>\n      </div>\n      ';return a}beforeEach(function(){setupComponent(a())}),describe("clicking the button",function(){it("hides the prompt and shows the ending message",function(){expect(this.component.select("promptWrapperSelector")).toBeVisible(),expect(this.component.select("promptEndingMessageSelector")).not.toBeVisible(),spyOnEvent(this.$node,"uiPromptbirdClick"),this.component.select("callToActionSelector").click(),expect("uiPromptbirdClick").toHaveBeenTriggeredOn(this.component),expect(this.component.select("promptWrapperSelector")).not.toBeVisible(),expect(this.component.select("promptEndingMessageSelector")).toBeVisible()})}),describe("dissmiss ending message",function(){it("shoudln't trigger 'uiPromptbirdDismissPrompt'",function(){spyOnEvent(this.$node,"uiPromptbirdDismissPrompt"),this.component.select("dismissSelector").click(),expect("uiPromptbirdDismissPrompt").not.toHaveBeenTriggeredOn(this.component),expect(this.component).not.toBeVisible()})})}),describe("prompt collecting data",function(){function a(){var a='<div class="promptbird promptbird-below-black-bar" data-prompt-id="128">\n        <div class="prompt-wrapper prompt-survey">\n          <div class="prompt-content-wrapper">\n            <h2>Title</h2>\n\n            <p class="prompt-explanation">\n              Explanation\n            </p>\n\n            <div class="prompt-action-wrapper">\n              <div class="prompt-choices">\n                <label class="checkbox">\n                  <input class="choice" type="checkbox">\n                    Arizona State University\n                </label>\n                <label class="checkbox">\n                  <input class="choice" type="checkbox">\n                    University of Arizona\n                </label>\n              </div>\n\n              <button class="btn primary-btn call-to-action disabled" type="button" disabled="disabled">\n                Submit\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n      ';return a}beforeEach(function(){setupComponent(a())}),describe("checking/unchecking checkbox",function(){it("should enable/disable submit button",function(){expect(this.component.select("callToActionSelector")).toBeDisabled(),expect(this.component.select("callToActionSelector")).toHaveClass(this.component.attr.disableClass),this.component.select("promptChoiceSelector").click(),expect(this.component.select("callToActionSelector")).not.toBeDisabled(),expect(this.component.select("callToActionSelector")).not.toHaveClass(this.component.attr.disableClass),this.component.select("promptChoiceSelector").click(),expect(this.component.select("callToActionSelector")).toBeDisabled(),expect(this.component.select("callToActionSelector")).toHaveClass(this.component.attr.disableClass)})})}),describe("input prompt",function(){function a(){var a='<div class="promptbird promptbird-below-black-bar" data-prompt-id="128">\n        <div class="prompt-wrapper prompt-input">\n          <div class="prompt-content-wrapper">\n            <h2>Title</h2>\n\n            <p class="prompt-explanation">\n              Something...\n            </p>\n\n            <div class="prompt-action-wrapper">\n              <table class="flex-table prompt-input-container">\n                <tbody>\n                  <tr>\n                    <td class="flex-table-primary">\n                      <input class="prompt-input-field" type="text"/>\n                    </td>\n                    <td class="flex-table-secondary">\n                      <button class="btn primary-btn call-to-action disabled" type="button" disabled="disabled">\n                        Submit\n                      </button>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n      </div>\n      ';return a}beforeEach(function(){setupComponent(a())}),describe("typing something in input field",function(){it("should enable the submit button",function(){expect(this.component.select("callToActionSelector")).toBeDisabled(),this.component.select("promptInputFieldSelector").val("something..."),this.component.select("promptInputFieldSelector").trigger(jQuery.Event("input")),expect(this.component.select("callToActionSelector")).not.toBeDisabled()})})})})
});
define("test/app/ui/password_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/password",function(){beforeEach(function(){var a='<form><input id="foo" value="bar" type="password"></form>';setupComponent(a,{currentPasswordSelector:"#foo"})}),it("sets it currentPasswordSelector on initialization",function(){expect(this.component.attr.currentPasswordSelector).toBe("#foo")}),it("empties the password field",function(){var a=this.component.select("currentPasswordSelector");expect(a).toHaveValue("")})})
});
define("test/app/ui/with_click_outside_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_click_outside",function(){beforeEach(function(){var a='<div id="with-click-outside">  <div class="outer">    <div class="inner"></div>  </div>  <div class="sibling-included"></div>  <div class="sibling-excluded"></div></div>';setupComponent(a,{outerSelector:".outer",innerSelector:".inner",siblingIncludedSelector:".sibling-included",siblingExcludedSelector:".sibling-excluded"}),this.component.cb=function(){},spyOn(this.component,"cb");var b=this.component.select("outerSelector").add(this.component.select("siblingIncludedSelector"));this.component.onClickOutside(b,this.component.cb)});var a={boo:"yah"};describe("clicking on the outer element",function(){it("does not call the callback",function(){this.component.select("outerSelector").trigger("click",a),expect(this.component.cb).not.toHaveBeenCalled()})}),describe("clicking on the inner element",function(){it("does not call the callback",function(){this.component.select("innerSelector").trigger("click",a),expect(this.component.cb).not.toHaveBeenCalled()})}),describe("clicking on the sibling included element",function(){it("does not call the callback",function(){this.component.select("siblingIncludedSelector").trigger("click",a),expect(this.component.cb).not.toHaveBeenCalled()})}),describe("clicking on the sibling excluded element",function(){it("does not call the callback",function(){this.component.select("siblingExcludedSelector").trigger("click",a),expect(this.component.cb).toHaveBeenCalledWith(jasmine.any($.Event),a)})}),describe("clicking on the parent of outer element",function(){it("calls the callback",function(){this.component.select("outerSelector").parent().trigger("click",a),expect(this.component.cb).toHaveBeenCalledWith(jasmine.any($.Event),a)})}),describe("clicking on the document",function(){it("calls the callback",function(){$(document).trigger("click",a),expect(this.component.cb).toHaveBeenCalledWith(jasmine.any($.Event),a)})}),describe("clicking on the document after tearing down the component",function(){it("does not call the callback",function(){var b=this.component.cb;this.component.teardown(),this.component=null,$(document).trigger("click",a),expect(b).not.toHaveBeenCalled()})})})
});
define("test/app/ui/dynamic_card_watcher_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dynamic_card_watcher",function(){function c(a,b,c){spyOn(a,"scrollTop").andReturn(b),spyOn(a,"height").andReturn(c),spyOn(a,"offset").andReturn({top:0})}function d(a,b,c){spyOn(a,"offset").andReturn({top:b}),spyOn(a,"height").andReturn(c)}var a='<div>\n      <div id="tweet1" class="tweet" data-tweet-id="4"><div class="js-macaw-cards-iframe-container" data-src="/i/cards/tfw/v1/4"></div></div>\n      <div id="tweet2" class="tweet" data-tweet-id="20"><div class="js-macaw-cards-iframe-container" data-src="/i/cards/tfw/v1/20"></div></div>\n    </div>\n  ',b='<div>\n      <div id="tweet1" class="tweet" data-tweet-id="4"><div class="js-macaw-cards-iframe-container" data-src="/i/cards/tfw/v1/4"><span>fake iframe</span></div></div>\n    </div>\n  ';describe("#resetWatchedCards",function(){beforeEach(function(){setupComponent(a)}),it("should reset unwatchedCards array",function(){this.component.watchedCards=[1,2,3],this.component.resetWatchedCards(),expect(this.component.watchedCards.length).toBe(0)}),it("should remove data-watched attr from all cards",function(){this.component.resetWatchedCards();var a=this.component.$container.find(this.component.attr.unloadedCardsSelector);expect(a.length).toBe(2)}),it("should call watchUnloadedCards",function(){spyOn(this.component,"watchUnloadedCards"),this.component.resetWatchedCards(),expect(this.component.watchUnloadedCards).toHaveBeenCalled()})}),describe("#watchUnloadedCards",function(){describe("when there are some unloaded cards",function(){beforeEach(function(){spyOn(this.Component.prototype,"processWatchedCards"),setupComponent(a)}),it("should add cards to watch queue",function(){expect(this.component.watchedCards.length).toBe(2)}),it('should mark cards as "watched"',function(){expect($(this.component.watchedCards[0]).attr("data-watched")).toBe("true"),expect($(this.component.watchedCards[1]).attr("data-watched")).toBe("true")}),it("should call processWatchedCards",function(){expect(this.component.processWatchedCards).toHaveBeenCalled()})}),describe("when there are no unloaded cards",function(){beforeEach(function(){spyOn(this.Component.prototype,"processWatchedCards"),setupComponent()}),it("should not add cards to watch queue",function(){expect(this.component.watchedCards.length).toBe(0)})}),describe("when the card is already loaded",function(){beforeEach(function(){spyOn(this.Component.prototype,"processWatchedCards"),setupComponent(b)}),it("should not add cards to watch queue",function(){expect(this.component.watchedCards.length).toBe(0)})})}),describe("#processWatchedCards",function(){beforeEach(function(){spyOn(this.Component.prototype,"isWithinBounds").andCallFake(function(a){return a.parentNode.id=="tweet1"?!0:!1}),setupComponent(a)}),it("should process cards within bounds",function(){expect(this.component.watchedCards.length).toBe(1)})}),describe("#isAboveViewport",function(){describe("with no viewport threshold",function(){beforeEach(function(){setupComponent(a,{viewportThreshold:0})}),it("should return true when element is above viewport",function(){var b=$(a).find(".js-macaw-cards-iframe-container:first");c(this.component.$node,100,200),d(b,0,100),expect(this.component.isAboveViewport(b)).toBe(!0)}),it("should return false when element is below top of viewport",function(){var b=$(a).find(".js-macaw-cards-iframe-container:first");c(this.component.$node,100,200),d(b,100,50),expect(this.component.isAboveViewport(b)).toBe(!1)})}),describe("with a viewport threshold",function(){beforeEach(function(){setupComponent(a,{viewportThreshold:10})}),it("should return false when element above viewport but within threshold",function(){var b=$(a).find(".js-macaw-cards-iframe-container:first");c(this.component.$node,100,200),d(b,0,100),expect(this.component.isAboveViewport(b)).toBe(!1)})})}),describe("#isBelowViewport",function(){describe("with no viewport threshold",function(){beforeEach(function(){setupComponent(a,{viewportThreshold:0})}),it("should return true when element is below viewport",function(){var b=$(a).find(".js-macaw-cards-iframe-container:first");c(this.component.$node,100,200),d(b,300,40),expect(this.component.isBelowViewport(b)).toBe(!0)}),it("should return false when element is above bottom of viewport",function(){var b=$(a).find(".js-macaw-cards-iframe-container:first");c(this.component.$node,100,200),d(b,250,50),expect(this.component.isBelowViewport(b)).toBe(!1)})}),describe("with a viewport threshold",function(){beforeEach(function(){setupComponent(a,{viewportThreshold:10})}),it("should return false when element below viewport but within threshold",function(){var b=$(a).find(".js-macaw-cards-iframe-container:first");c(this.component.$node,100,200),d(b,300,40),expect(this.component.isBelowViewport(b)).toBe(!1)})})})})
});
define("test/app/ui/with_user_actions_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_user_actions",function(){function b(b){var c=$(a.replace(/chatty/g,b.screenName));return c.attr("class","user-actions "+b.followingState),c.attr("data-user-id",b.userId),c.attr("data-screen-name",b.screenName),c.attr("data-protected",!!b.isProtected),c.attr("data-name",b.name),c.attr("data-impression-id",b.impressionId),c.attr("data-disclosure-type",b.disclosureType),c.wrap("<div>").parent().html()}var a='<div class="user-actions btn-group following can-dm including " data-user-id="707" data-screen-name="chatty" data-name="I. M. Chatty" data-protected="false">\n      <button class="js-follow-btn follow-button btn" type="button">\n        <span class="button-text follow-text"><i class="follow"></i>Follow</span>\n        <span class="button-text following-text">Following</span>\n        <span class="button-text unfollow-text">Unfollow</span>\n        <span class="button-text blocked-text">Blocked</span>\n        <span class="button-text unblock-text">Unblock</span>\n        <span class="button-text pending-text">Pending</span>\n        <span class="button-text cancel-text">Cancel</span>\n      </button>\n      <div class="dropdown">\n        <button id="dropdown-toggle" type="button" class="user-dropdown js-dropdown-toggle js-link btn">\n          <i class="account-arrow"></i>\n          <i class="mark-as-spam-silhouette"></i>\n          <i class="mark-as-spam-flag"></i>\n          <small class="mark-as-spam-text">Spam?</small>\n        </button>\n        <div class="dropdown-menu">\n          <ul>\n            <li class="mention-text pretty-link not-blocked"><button type="button" class="dropdown-link">Tweet to <s>@</s>chatty</button></li>\n            <li class="dm-text"><button type="button" class="dropdown-link">Send a Direct Message</button></li>\n            <li class="list-text pretty-link not-blocked"><button type="button" class="dropdown-link">Add or remove from lists&hellip;</button></li>\n            <li class="dropdown-divider not-blocked"></li>\n            <li class="block-text pretty-link not-blocked"><button type="button" class="dropdown-link">Block <s>@</s>chatty</button></li>\n            <li class="unblock-text pretty-link"><button type="button" class="dropdown-link">Unblock <s>@</s>chatty</button></li>\n            <li class="report-spam-text pretty-link"><button type="button" class="dropdown-link">Report <s>@</s>chatty for spam</button></li>\n            <li class="hide-suggestion-text"><button type="button" class="dropdown-link">Hide this suggestion</button></li>\n            <li class="dropdown-divider is-following"></li>\n            <li class="retweet-on-text"><button type="button" class="dropdown-link">Turn on Retweets</button></li>\n            <li class="retweet-off-text"><button type="button" class="dropdown-link">Turn off Retweets</button></li>\n            <li class="device-notifications-on-text"><button type="button" class="dropdown-link">Turn on mobile notifications</button></li>\n            <li class="device-notifications-off-text"><button type="button" class="dropdown-link">Turn off mobile notifications</button></li>\n            <li class="dropdown-divider is-embeddable"></li>\n            <li class="embed-profile"><button type="button" class="dropdown-link">Embed this Profile</button></li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  ';describe("follow button",function(){describe("logged out",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"not-following"}),a+=b({userId:"12",screenName:"jack",name:"Jack",followingState:"not-following"}),a+="</div>",setupComponent(a,{loggedIn:!1,itemType:"user"})}),describe("clicking the follow button",function(){beforeEach(function(){spyOnEvent(this.$node,"uiOpenSigninOrSignupDialog")}),it("stops propagation of the click event",function(){var a=!1;$(document).on("click",function(){a=!0}),this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click(),expect(a).toBe(!1)}),it("hides the dropdown menu",function(){var a=this.$node.find("[data-screen-name=Horse_ebooks] .follow-button");spyOnEvent(a,"uiCloseDropdowns"),a.click(),expect("uiCloseDropdowns").toHaveBeenTriggeredOn(a)}),it("triggers uiOpenSigninOrSignupDialog with the correct options",function(){this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click(),expect("uiOpenSigninOrSignupDialog").toHaveBeenTriggeredOnAndWith(this.$node,{signUpOnly:!0,screenName:"Horse_ebooks"})})})}),describe("not-followed users",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"not-following",impressionId:"187",disclosureType:"promoted"}),a+=b({userId:"12",screenName:"jack",name:"Jack",followingState:"not-following"}),a+="</div>",setupComponent(a,{loggedIn:!0,itemType:"user"})}),describe("clicking the follow button",function(){beforeEach(function(){spyOnEvent(this.$node,"uiFollowAction")}),it("stops propagation of the click event",function(){var a=!1;$(document).on("click",function(){a=!0}),this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click(),expect(a).toBe(!1)}),it("hides the dropdown menu",function(){var a=this.$node.find("[data-screen-name=Horse_ebooks] .follow-button");spyOnEvent(a,"uiCloseDropdowns"),a.click(),expect("uiCloseDropdowns").toHaveBeenTriggeredOn(a)}),it("triggers uiFollowAction",function(){this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click(),expect("uiFollowAction").toHaveBeenTriggeredOn(this.$node)}),it("passes the user id, impression id, and original state with the uiFollowAction event",function(){this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click(),expect("uiFollowAction").toHaveBeenTriggeredOnAndWith(this.$node,{isReplyTo:!1,isMentionClick:!1,itemType:"user",profileClickTarget:"screen_name",userId:"174958347",containerUserId:"174958347",impressionId:"187",disclosureType:"promoted",originalFollowState:"not-following",isPromotedBadgeClick:!1})})}),describe("on uiFollowAction",function(){beforeEach(function(){this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click()}),it('changes the class of the relevant button to "following"',function(){expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("following"),expect(this.$node.find("[data-screen-name=Horse_ebooks]")).not.toHaveClass("not-following")}),it('adds the "including" class',function(){expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("including")}),it("doesn't change the class of other follow buttons",function(){expect(this.$node.find("[data-screen-name=jack]")).toHaveClass("not-following"),expect(this.$node.find("[data-screen-name=jack]")).not.toHaveClass("following")})})}),describe("followed users",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"following",impressionId:"187"}),a+=b({userId:"12",screenName:"jack",name:"Jack",followingState:"following"}),a+="</div>",setupComponent(a,{loggedIn:!0,itemType:"user"})}),describe("clicking the follow button",function(){beforeEach(function(){spyOnEvent(this.$node,"uiUnfollowAction"),this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click()}),it("triggers uiUnfollowAction",function(){expect("uiUnfollowAction").toHaveBeenTriggeredOn(this.$node)}),it("passes the user id, impression id, and original state with the uiUnfollowAction event",function(){expect("uiUnfollowAction").toHaveBeenTriggeredOnAndWith(this.$node,{isReplyTo:!1,isMentionClick:!1,itemType:"user",profileClickTarget:"screen_name",userId:"174958347",containerUserId:"174958347",impressionId:"187",originalFollowState:"following",isPromotedBadgeClick:!1})})}),describe("on uiUnfollowAction",function(){beforeEach(function(){this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click()}),it('changes the class of the relevant button to "not-following"',function(){expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("not-following")}),it('removes the "including" class',function(){expect(this.$node.find("[data-screen-name=Horse_ebooks]")).not.toHaveClass("including")}),it("doesn't change the class of other follow buttons",function(){expect(this.$node.find("[data-screen-name=jack]")).toHaveClass("following")})}),describe("on uiBlockAction",function(){beforeEach(function(){$("#dropdown-toggle").click()}),it("stops propagation of the click event",function(){var a=!1;$(document).on("click",function(){a=!0}),this.$node.find("[data-screen-name=Horse_ebooks] .block-text").click(),expect(a).toBe(!1)}),it('changes the class of the relevant button to "blocked"',function(){this.$node.find("[data-screen-name=Horse_ebooks] .block-text").click(),expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("blocked")}),it('removes the "including" class',function(){this.$node.find("[data-screen-name=Horse_ebooks] .block-text").click(),expect(this.$node.find("[data-screen-name=Horse_ebooks]")).not.toHaveClass("including")}),it("doesn't change the class of other follow buttons",function(){this.$node.find("[data-screen-name=Horse_ebooks] .block-text").click(),expect(this.$node.find("[data-screen-name=jack]")).toHaveClass("following")})}),describe("on uiDidBlockUser",function(){it("triggers uiBlockAction",function(){var a={userId:"12",username:"dude",fromShortcut:!0};spyOnEvent(this.$node,"uiBlockAction"),$(this.$node).trigger("uiDidBlockUser",{sourceEventData:a}),expect("uiBlockAction").toHaveBeenTriggeredOnAndWith(this.$node,a)})})}),describe("protected unfollowed user",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"not-following",isProtected:!0}),a+="</div>",setupComponent(a,{loggedIn:!0,itemType:"user"})}),describe("on uiFollowAction",function(){beforeEach(function(){this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click()}),it('changes the class of the relevant button to "pending"',function(){expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("pending")}),describe("cancelling a follow request",function(){beforeEach(function(){spyOnEvent(this.$node,"uiCancelFollowRequestAction"),this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click()}),it('changes the class to "not-following"',function(){expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("not-following")}),it("triggers a uiCancelAction",function(){expect("uiCancelFollowRequestAction").toHaveBeenTriggeredOn(this.$node)})})})}),describe("blocked user",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"blocked",impressionId:"187"}),a+="</div>",setupComponent(a,{loggedIn:!0,itemType:"user"})}),describe("clicking the follow button",function(){beforeEach(function(){spyOnEvent(this.$node,"uiUnblockAction"),this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click()}),it("triggers uiUnblockAction",function(){expect("uiUnblockAction").toHaveBeenTriggeredOn(this.$node)}),it("passes the user id, impression id, and original state with uiUnblockAction event",function(){expect("uiUnblockAction").toHaveBeenTriggeredOnAndWith(this.$node,{isReplyTo:!1,isMentionClick:!1,itemType:"user",profileClickTarget:"screen_name",userId:"174958347",containerUserId:"174958347",impressionId:"187",originalFollowState:"blocked",isPromotedBadgeClick:!1})})}),describe("on uiUnblockAction",function(){beforeEach(function(){this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click()}),it('changes the class of the relevant button to "not-following"',function(){expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("not-following")})})}),describe("pending user",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"pending"}),a+="</div>",setupComponent(a,{loggedIn:!0,itemType:"user"})}),describe("on uiUnfollowAction",function(){beforeEach(function(){this.$node.find("[data-screen-name=Horse_ebooks] .follow-button").click()}),it('changes the class of the relevant button to "not-following"',function(){expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("not-following")})})})}),describe("user dropdown",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"not-following"}),a+=b({userId:"12",screenName:"jack",name:"Jack",followingState:"not-following"}),a+="</div>",setupComponent(a,{loggedIn:!0,itemType:"user"}),this.$horse=this.$node.find("[data-screen-name=Horse_ebooks]"),this.$jack=this.$node.find("[data-screen-name=jack]")}),describe("when an item in the user dropdown is clicked",function(){it('triggers the "uiCloseDropdowns" event',function(){var a=this.$horse.find(".user-dropdown"),b=a.closest(".dropdown").find(".mention-text");a.click(),spyOnEvent(b,"uiCloseDropdowns");var b=b.click();expect("uiCloseDropdowns").toHaveBeenTriggeredOn(b)})}),describe("actions",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"not-following",impressionId:"187"}),a+=b({userId:"12",screenName:"jack",name:"Jack",followingState:"not-following"}),a+="</div>",setupComponent(a,{loggedIn:!0,itemType:"user"}),$("#dropdown-toggle").click(),this.$horse=this.$node.find("[data-screen-name=Horse_ebooks]")}),describe("mention",function(){it("triggers a uiOpenTweetDialog event with the screen name and title",function(){spyOnEvent(this.$node,"uiOpenTweetDialog"),this.$horse.find(".dropdown .dropdown-menu").find(".mention-text").click(),expect("uiOpenTweetDialog").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({title:"Tweet to Horse ebooks",screenName:"Horse_ebooks"}))})}),describe("send a DM",function(){it("triggers a uiNeedsDMDialog event with the name and screen name",function(){spyOnEvent(this.$node,"uiNeedsDMDialog"),this.$horse.find(".dropdown .dropdown-menu").find(".dm-text").click(),expect("uiNeedsDMDialog").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({name:"Horse ebooks",screen_name:"Horse_ebooks"}))})}),describe("add or remove from list",function(){it("triggers a uiListAction event with the user id",function(){spyOnEvent(this.$node,"uiListAction"),this.$horse.find(".dropdown .dropdown-menu").find(".list-text").click(),expect("uiListAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}))})}),describe("block",function(){it("triggers a uiBlockAction event with the correct options",function(){spyOnEvent(this.$node,"uiBlockAction"),this.$horse.find(".dropdown .dropdown-menu").find(".block-text").click(),expect("uiBlockAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",impressionId:"187",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}))})}),describe("unblock",function(){it("triggers a uiUnblockAction event with the correct options",function(){this.$horse.removeClass("not-following").addClass("blocked"),spyOnEvent(this.$node,"uiUnblockAction"),this.$horse.find(".dropdown .dropdown-menu").find(".unblock-text").click(),expect("uiUnblockAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",impressionId:"187",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}))})}),describe("report spam",function(){it("triggers a uiReportSpamAction event with the user id",function(){spyOnEvent(this.$node,"uiReportSpamAction"),this.$horse.find(".dropdown .dropdown-menu").find(".report-spam-text").click(),expect("uiReportSpamAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",impressionId:"187",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}))})}),describe("hide suggestion",function(){it("triggers a uiHideSuggestionAction event with the user id and feedback token",function(){this.$horse.attr("data-feedback-token","test-feedback-token"),spyOnEvent(this.$node,"uiHideSuggestionAction"),this.$horse.find(".dropdown .dropdown-menu").find(".hide-suggestion-text").click(),expect("uiHideSuggestionAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",feedbackToken:"test-feedback-token",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}))})}),describe("embed profile",function(){it("triggers a uiEmbedProfileAction event",function(){spyOnEvent(this.$node,"uiEmbedProfileAction"),spyOnEvent(this.$node,"uiNavigate"),this.$horse.find(".dropdown .dropdown-menu").find(".embed-profile").click(),expect("uiEmbedProfileAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",profileClickTarget:"screen_name"})),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({href:"/settings/widgets/new/user?screen_name=Horse_ebooks"}))})}),describe("turn on retweets",function(){beforeEach(function(){spyOnEvent(this.$node,"uiRetweetOnAction"),this.$horse.find(".dropdown .dropdown-menu").find(".retweet-on-text").click()}),it("triggers a uiRetweetOnAction event with the user id",function(){expect("uiRetweetOnAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}))}),it('adds the "including" class to the user actions div',function(){expect(this.$horse).toHaveClass("including")})}),describe("turn off retweets",function(){beforeEach(function(){spyOnEvent(this.$node,"uiRetweetOffAction"),this.$horse.addClass("including"),this.$horse.find(".dropdown .dropdown-menu").find(".retweet-off-text").click()}),it("triggers a uiRetweetOffAction event with the user id",function(){expect("uiRetweetOffAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}))}),it('removes the "including" class from the user actions div',function(){expect(this.$horse).not.toHaveClass("including")})}),describe("turn on mobile notifications",function(){describe("with device enabled and verified",function(){beforeEach(function(){this.component.attr.deviceEnabled=!0,this.component.attr.smsDeviceVerified=!0,this.component.attr.hasPushDevice=!1,spyOnEvent(this.$node,"uiDeviceNotificationsOnAction"),this.$horse.find(".dropdown .dropdown-menu").find(".device-notifications-on-text").click()}),it("triggers a uiDeviceNotificationsOnAction event with the user id",function(){expect("uiDeviceNotificationsOnAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}))}),it('adds the "notifying" class to the user actions div',function(){expect(this.$horse).toHaveClass("notifying")})}),describe("with device not setup or verified",function(){beforeEach(function(){this.component.attr.deviceEnabled=!1,this.component.attr.smsDeviceVerified=!1,this.component.attr.hasPushDevice=!1,spyOnEvent(document,"uiOpenConfirmDialog"),this.$horse.find(".dropdown .dropdown-menu").find(".device-notifications-on-text").click()}),it("triggers a uiOpenConfirmDialog",function(){expect("uiOpenConfirmDialog").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({action:"ShowMobileNotifications"}))})}),describe("with push device but not enabled",function(){beforeEach(function(){this.component.attr.deviceEnabled=!1,this.component.attr.smsDeviceVerified=!1,this.component.attr.hasPushDevice=!0,spyOnEvent(this.$node,"uiDeviceNotificationsOnAction"),this.$horse.find(".dropdown .dropdown-menu").find(".device-notifications-on-text").click()}),it("triggers a uiOpenConfirmDialog",function(){expect("uiOpenConfirmDialog").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({action:"ShowPushTweetsNotifications"}))})})}),describe("turn off mobile notifications",function(){beforeEach(function(){spyOnEvent(this.$node,"uiDeviceNotificationsOffAction"),this.$horse.addClass("notifying"),this.$horse.find(".dropdown .dropdown-menu").find(".device-notifications-off-text").click()}),it("triggers a uiDeviceNotificationsOffAction event with the user id",function(){expect("uiDeviceNotificationsOffAction").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"174958347",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}))}),it('removes the "notifying" class from the user actions div',function(){expect(this.$horse).not.toHaveClass("notifying")})})})}),describe("on dataFollowStateChange",function(){describe("un-following",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"not-following"}),a+="</div>",setupComponent(a,{loggedIn:!0,itemType:"user"})}),it("sets the follow state of the button to the value given in the event data",function(){$(document).trigger("dataFollowStateChange",{userId:"174958347",newState:"not-following",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}),expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("not-following")})}),describe("blocking",function(){beforeEach(function(){var a="<div>";a+=b({userId:"174958347",screenName:"Horse_ebooks",name:"Horse ebooks",followingState:"not-following"}),a+="</div>",setupComponent(a,{loggedIn:!0,itemType:"user"})}),it("sets the follow state of the button to the value given in the event data",function(){$(document).trigger("dataFollowStateChange",{userId:"174958347",newState:"blocked",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1}),expect(this.$node.find("[data-screen-name=Horse_ebooks]")).toHaveClass("blocked")}),it("triggers uiUpdateAfterBlock when blocking from keyboard shortcut",function(){spyOnEvent(document,"uiUpdateAfterBlock"),$(document).trigger("dataFollowStateChange",{userId:"174958347",newState:"blocked",fromShortcut:!0}),expect("uiUpdateAfterBlock").toHaveBeenTriggeredOnAndWith(document,{userId:"174958347"})})}),describe("unblocking",function(){beforeEach(function(){setupComponent("<div></div>",{loggedIn:!0})}),it("triggers uiShowMessage when unblocking from keyboard shortcut",function(){spyOnEvent(document,"uiShowMessage"),$(document).trigger("dataFollowStateChange",{newState:"not-following",username:"dude",fromShortcut:!0}),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"You have unblocked dude"})}),it("does not trigger uiShowMessage when unblocking without keyboard shortcut",function(){spyOnEvent(this.$node,"uiShowMessage"),$(document).trigger("dataFollowStateChange",{newState:"not-following",username:"dude"}),expect("uiShowMessage").not.toHaveBeenTriggeredOn(this.$node)})}),describe("blocking from an outside event",function(){it("calls component.block in response to uiDidTriggerBlockingAction",function(){spyOn(this.Component.prototype,"block"),setupComponent("<div></div>",{loggedIn:!0}),$(document).trigger("uiDidTriggerBlockingAction"),expect(this.component.block).toHaveBeenCalled()})})})})
});
define("test/app/ui/geo_picker_spec",["module","require","exports"],function(module, require, exports) {
describeComponentWithDataComponents("app/ui/geo_picker",["app/data/tweet_box_scribe"],function(){var a='<li class="geo-place-result geo-focusable" data-place-id="5a110d312052166f"><i class="geo-check"></i>San Francisco, CA</li>\n    <li class="geo-place-result geo-focusable" data-place-id="5ef5b7f391e30aff">Berkeley, CA</li>\n    <li class="geo-place-result geo-focusable" data-place-id="6a71821001635bbd">Daly City, CA</li>\n  ',b='<li class="geo-search-result geo-focusable" data-place-id="0a81db1f9ab667bc">Palos Verdes, CA</li>\n    <li class="geo-search-result geo-focusable" data-place-id="7319dcf938bca827">Kota Palopo, South Sulawesi</li>\n    <li class="geo-search-result geo-focusable" data-place-id="3ad0f706b3fa62a8">Palo Alto, CA</li>\n    <li class="geo-search-result geo-focusable" data-place-id="905627646db90fef">Rancho Palos Verdes, CA</li>\n    <li class="geo-search-result geo-focusable" data-place-id="b9da7881046990df">East Palo Alto, CA</li>\n    <li class="geo-search-result dropdown-divider"></li>\n  ',c='<div class="geo-picker">\n      <button class="btn geo-picker-btn" type="button">\n        <i class="tweet-geo"></i>\n      </button>\n      <span class="dropdown-container"></span>\n      <span class="geo-status"></span>\n      <input type="hidden" name="place_id">\n    </div>\n  ',d='<div id="geo-disabled-dropdown" tabindex="-1">\n      <ul class="dropdown-menu">\n        <li class="dropdown-caret">\n          <span class="caret-outer"></span>\n          <span class="caret-inner"></span>\n        </li>\n        <li class="geo-not-enabled-yet">\n          <h2>{{_i}}Add a location to your Tweets{{/i}}</h2>\n          <p>\n            When you tweet with a location, Twitter stores that location.\n            You can switch location on/off before each Tweet and always have the option to delete your location history.\n            <a href="http://support.twitter.com/forums/26810/entries/78525" target="_blank">Learn more</a>\n          </p>\n          <div>\n            <button type="button" class="geo-turn-on btn primary-btn">Turn location on</button>\n            <button type="button" class="geo-not-now btn-link">Not now</button>\n          </div>\n        </li>\n      </ul>\n    </div>\n    <div id="geo-enabled-dropdown" tabindex="-1">\n      <ul class="dropdown-menu">\n        <li class="dropdown-caret">\n          <span class="caret-outer"></span>\n          <span class="caret-inner"></span>\n        </li>\n        <li class="geo-query-location">\n          <div>\n            <input type="text" autocomplete="off" placeholder="Search for a neighborhood or city">\n            <i class="geo-search"></i>\n          </div>\n        </li>\n        <li class="geo-dropdown-status"></li>\n        <li class="geo-turn-off-item geo-focusable">\n          <i class="geo-turn-off"></i>Turn off location\n        </li>\n      </ul>\n    </div>\n  ',e={state:"located",place_id:"5a110d312052166f",place_name:"San Francisco, CA",places_html:a},f={html:b,sourceEventData:{query:"Palo",placeId:"5a110d312052166f",isPrefix:!0}};beforeEach(function(){setupComponent(c,{parent:document}),attachFixtureToDom($(d));var a="uiRequestGeoState uiRequestGeoState uiGeoPickerEnable uiGeoPickerTurnOn uiGeoPickerTurnOff uiGeoPickerChange uiGeoPickerSearch";a.split(" ").map(function(a){spyOnEvent(this.$node,a)}.bind(this)),jasmine.Clock.useMock(),this.triggerKey=function(a,b,c){var d=$.Event(b);d.which=c,this.component.select(a).trigger(d)}}),describe("event uiPrepareTweetBox from parent",function(){it("triggers uiRequestGeoState",function(){$(document).trigger("uiPrepareTweetBox"),expect("uiRequestGeoState").toHaveBeenTriggeredOn(this.$node)})}),describe("event dataGeoState",function(){this.testStateMessage=function(a,b){describe("state = "+a,function(){it("displays "+b,function(){$(document).trigger("dataGeoState",{state:a}),expect(this.component.select("statusSelector")).toHaveText(b)}),it("does not have the active class",function(){expect(this.$node).not.toBe(".active")}),it("does not have a place_id",function(){expect(this.component.select("placeIdSelector")).toHaveText("")})})},this.testStateMessage("enabling","Getting location..."),this.testStateMessage("locating","Getting location..."),this.testStateMessage("enableIsUnavailable","Location service unavailable"),this.testStateMessage("locateIsUnavailable","Location service unavailable"),this.testStateMessage("changing","Changing location..."),this.testStateMessage("locationUnknown","Unknown location"),describe("state = located in San Francisco",function(){beforeEach(function(){$(document).trigger("dataGeoState",e)}),it("displays San Francisco, CA",function(){expect(this.component.select("statusSelector")).toHaveText("San Francisco, CA")}),it("sets place_id to 5a110d312052166f",function(){expect(this.component.select("placeIdSelector")).toHaveValue("5a110d312052166f")}),it("sets active class",function(){expect(this.$node).toBe(".active")})}),describe("state = enabledTurnedOff",function(){it("doesnt display any text if rosetta is off",function(){$(document).trigger("dataGeoState",{state:"enabledTurnedOff"}),expect(this.component.select("statusSelector")).toHaveText("")}),it('displays "Add location" if rosetta is on',function(){this.component.attr.rosetta=!0,$(document).trigger("dataGeoState",{state:"enabledTurnedOff"}),expect(this.component.select("statusSelector")).toHaveText("Add location")})})}),describe("event click button",function(){function a(a){it("hides the dropdown",function(){expect(this.component.select("dropdownSelector")).not.toBeVisible(),a&&expect(this.component.select("buttonSelector")).toBeFocused()})}describe("when state = disabled",function(){beforeEach(function(){$(document).trigger("dataGeoState",{state:"disabled"}),this.component.select("buttonSelector").focus().click()}),it("shows geo-disabled dropdown",function(){expect(this.component.select("dropdownSelector")).toBeVisible(),expect(this.component.select("enableButtonSelector")).toBeVisible(),expect(this.component.select("notNowButtonSelector")).toBeVisible()}),it("focuses the button to enable location",function(){expect(this.component.select("enableButtonSelector")).toBeFocused()}),describe('event click "Turn geo on" button',function(){beforeEach(function(){this.component.select("enableButtonSelector").click()}),it("triggers uiGeoPickerEnable",function(){expect("uiGeoPickerEnable").toHaveBeenTriggeredOn(this.$node)}),a(!0)}),describe('event click "Not now" button',function(){beforeEach(function(){this.component.select("notNowButtonSelector").click()}),a(!0)}),describe("event click outside of the dropdown and button",function(){beforeEach(function(){$(document).click()}),a()}),describe("event click the geo button again",function(){beforeEach(function(){this.component.select("buttonSelector").click()}),a(!0)}),describe("event keydown=escape",function(){beforeEach(function(){this.component.trigger(this.component.select("dropdownSelector"),"uiShortcutEsc")}),a(!0)})}),describe("when state = locateIsUnavailable",function(){it("triggers uiRequestGeoState",function(){$(document).trigger("dataGeoState",{state:"locateIsUnavailable"}),this.component.select("buttonSelector").click(),expect("uiRequestGeoState").toHaveBeenTriggeredOn(this.$node)})}),describe("when state = enabledTurnedOff",function(){it("triggers uiRequestGeoState",function(){$(document).trigger("dataGeoState",{state:"enabledTurnedOff"}),this.component.select("buttonSelector").click(),expect("uiGeoPickerTurnOn").toHaveBeenTriggeredOn(this.$node)})}),describe("when state = located in San Francisco",function(){beforeEach(function(){$(document).trigger("dataGeoState",e),this.component.select("buttonSelector").focus().click()}),it("shows geo-enabled dropdown",function(){expect(this.component.select("querySelector")).toBeVisible(),expect(this.component.select("turnOffButtonSelector")).toBeVisible()}),it("focuses the text input",function(){expect(this.component.select("querySelector")).toBeFocused()}),it("dropdown has Berkeley",function(){expect(this.component.select("dropdownSelector")).toContain('[data-place-id="5ef5b7f391e30aff"]')}),it("dropdown has three total places",function(){expect(this.component.select("changePlaceSelector").length).toBe(3)}),describe("click a new geo-result",function(){beforeEach(function(){this.component.select("changePlaceSelector").eq(1).click()}),it("triggers uiGeoPickerChange",function(){jasmine.Clock.tick(1),expect("uiGeoPickerChange").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({placeId:"5ef5b7f391e30aff"}))}),it("scribes select with new and old place ids in item_name array",function(){jasmine.Clock.tick(1),expect(this.tweetBoxScribe).toScribe({element:"geo_picker",action:"select"},{item_names:["5ef5b7f391e30aff","5a110d312052166f"]})}),a(!0)}),describe("click the current geo-result",function(){beforeEach(function(){this.component.select("changePlaceSelector").eq(0).click()}),it("does not trigger uiGeoPickerChange",function(){jasmine.Clock.tick(1),expect("uiGeoPickerChange").not.toHaveBeenTriggeredOn(this.$node)}),a(!0)}),describe("click turn off",function(){beforeEach(function(){this.component.select("turnOffButtonSelector").click()}),it("triggers uiGeoPickerTurnOff",function(){expect("uiGeoPickerTurnOff").toHaveBeenTriggeredOn(this.$node)}),a(!0)}),describe("input change event after entering a query",function(){beforeEach(function(){this.component.select("querySelector").val("foo").trigger("change")}),it("triggers uiGeoPickerSearch with prefix match",function(){jasmine.Clock.tick(1),expect("uiGeoPickerSearch").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({placeId:"5a110d312052166f",query:"foo",isPrefix:!0}))}),it("triggers uiGeoPickerInteraction",function(){spyOnEvent(this.$node,"uiGeoPickerInteraction"),jasmine.Clock.tick(1),expect("uiGeoPickerInteraction").toHaveBeenTriggeredOn(this.$node)}),it("does not trigger uiGeoPickerInteraction on second change event",function(){jasmine.Clock.tick(1),spyOnEvent(this.$node,"uiGeoPickerInteraction"),this.component.select("querySelector").val("foo more").trigger("change"),jasmine.Clock.tick(1),expect("uiGeoPickerInteraction").not.toHaveBeenTriggeredOn(this.$node)})}),describe("enter keydown event after a query",function(){it("triggers uiGeoPickerSearch with no prefix match",function(){this.component.select("querySelector").val("foo"),this.triggerKey("querySelector","keydown",13),expect("uiGeoPickerSearch").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({placeId:"5a110d312052166f",query:"foo",isPrefix:!1}))})}),describe("clicking geo icon after a query",function(){beforeEach(function(){this.component.select("querySelector").val("foo"),this.component.select("geoSearchSelector").click()}),it("triggers uiGeoPickerSearch with no prefix match",function(){expect("uiGeoPickerSearch").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({placeId:"5a110d312052166f",query:"foo",isPrefix:!1}))})}),describe("event keydown=escape",function(){beforeEach(function(){this.component.trigger(this.component.select("querySelector"),"uiShortcutEsc")}),a(!0)}),describe("event keydown = down arrow",function(){beforeEach(function(){this.triggerKey("querySelector","keydown",40)}),it("focuses the first item",function(){expect(this.component.select("focusedSelector")).toBe(this.component.select("firstFocusableSelector"))}),describe("event keydown = down arrow",function(){beforeEach(function(){this.triggerKey("querySelector","keydown",40)}),it("focuses the 2nd item",function(){expect(this.component.select("focusedSelector")).toBe(this.component.select("focusableSelector").eq(1))}),describe("event keydown = enter",function(){beforeEach(function(){this.triggerKey("querySelector","keydown",13)}),it("triggers uiGeoPickerChange",function(){jasmine.Clock.tick(1),expect("uiGeoPickerChange").toHaveBeenTriggeredOn(this.$node)})})}),describe("event keydown = up arrow",function(){it("focuses the last item",function(){this.triggerKey("querySelector","keydown",38),expect(this.component.select("focusedSelector")).toBe(this.component.select("focusableSelector").eq(-1))})})}),describe("event keydown = up arrow",function(){beforeEach(function(){this.triggerKey("querySelector","keydown",38)}),it("focuses the last item",function(){expect(this.component.select("focusedSelector")).toBe(this.component.select("focusableSelector").eq(-1))}),describe("event keydown = enter",function(){beforeEach(function(){this.triggerKey("querySelector","keydown",13)}),it("triggers uiGeoPickerTurnOff",function(){expect("uiGeoPickerTurnOff").toHaveBeenTriggeredOn(this.$node)})})}),describe("event dataGeoSearchResults from parent",function(){beforeEach(function(){this.component.select("querySelector").val("Palo"),this.component.select("querySelector").trigger("paste"),jasmine.Clock.tick(1),$(document).trigger("dataGeoSearchResults",f)}),it("has 6 items",function(){expect(this.component.select("searchResultsSelector").length).toBe(6)}),describe("click a geo search result",function(){beforeEach(function(){this.component.select("searchResultsSelector").eq(2).click()}),it("triggers uiGeoPickerChange",function(){jasmine.Clock.tick(1),expect("uiGeoPickerChange").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({placeId:"3ad0f706b3fa62a8"}))}),it("scribes select with query",function(){jasmine.Clock.tick(1),expect(this.tweetBoxScribe).toScribe({element:"geo_picker",action:"select"},{item_names:["3ad0f706b3fa62a8","5a110d312052166f"],query:"Palo"})}),a(!0)})}),describe("event dataGeoSearchResultsUnavailable from parent",function(){it("Shows Location service unavailable in drodpown status",function(){$(document).trigger("dataGeoSearchResultsUnavailable");var a=this.component.select("dropdownStatusSelector");expect(a).toBeVisible(),expect(a).toHaveText("Location service unavailable")})})})})})
});
define("test/app/ui/infinite_scroll_watcher_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/infinite_scroll_watcher",function(){function a(a,b,c,d){spyOn(this.component.$node,"height").andReturn(b),spyOn(this.component.$node,"scrollTop").andReturn(a),spyOn(this.component.$content,"height").andReturn(c),spyOnEvent(this.component.$node,"uiNearTheBottom"),spyOnEvent(this.component.$node,"uiNearTheTop"),d||this.component.checkScrollPosition()}beforeEach(setupComponent),describe("event uiNearTheBottom",function(){describe("infinite scroll on page load",function(){beforeEach(function(){a.call(this,1300,500,1500,!0),expect("uiNearTheBottom").not.toHaveBeenTriggeredOn(this.component)}),it("triggers uiNearTheBottom after the user first navigates to the page",function(){this.component.trigger("uiSwiftLoaded"),expect("uiNearTheBottom").toHaveBeenTriggeredOn(this.component)}),it("triggers uiNearTheBottom after the user navigates via pushState",function(){this.component.trigger("uiPageChanged"),expect("uiNearTheBottom").toHaveBeenTriggeredOn(this.component)})}),it("triggers uiNearTheBottom when scrolled beyond half a screen's height",function(){a.call(this,1300,500,1500),expect("uiNearTheBottom").toHaveBeenTriggeredOn(this.component)}),it("does not trigger uiNearTheBottom when scrolled less than half a screen's height",function(){a.call(this,200,500,1500),expect("uiNearTheBottom").not.toHaveBeenTriggeredOn(this.component)}),it("does trigger once, and remembers the last inner height at which it triggered",function(){a.call(this,1300,500,1500),expect("uiNearTheBottom").toHaveBeenTriggeredOn(this.component),expect(this.component.lastTriggeredHeight).toBe(1500)})}),describe("event uiNearTheTop",function(){it("triggers uiNearTheTop when scroll top is less then half a screen's height",function(){a.call(this,200,500,1500),expect("uiNearTheTop").toHaveBeenTriggeredOn(this.component)}),it("does not trigger uiNearTheTop when scroll top is more than half a screen's height",function(){a.call(this,1300,500,1500),expect("uiNearTheTop").not.toHaveBeenTriggeredOn(this.component)}),it("does trigger once, and remembers the last inner height at which it triggered",function(){a.call(this,200,500,1500),expect("uiNearTheTop").toHaveBeenTriggeredOn(this.component),expect(this.component.lastTriggeredHeight).toBe(1500)})}),describe("event uiTimelineReset",function(){it("resets the lastTriggeredHeight",function(){a.call(this,1300,500,1500),this.component.$node.trigger("uiTimelineReset"),expect(this.component.lastTriggeredHeight).toBe(0)})})})
});
define("test/app/ui/with_tweet_activity_actions_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_tweet_activity_actions",function(){var a='<div class="tweet permalink-tweet js-actionable-user js-actionable-tweet with-social-proof logged-in opened-tweet"\n          data-tweet-id="81122302762291200" data-item-id="81122302762291200" data-screen-name="Wendys" data-user-id="59553554"\n          data-card-type="" data-is-reply-to="false" data-mentions="">\n        <p class="js-tweet-text tweet-text">\n          RT for a good cause. Each retweet sends 50¢ to help kids in foster care.\n          <a class="twitter-hashtag pretty-link" href="/search/%23TreatItFwd">\n            <s>#</s><b>TreatItFwd</b>\n          </a>\n        </p>\n        <div class="permalink-footer">\n          <div class="js-tweet-details-fixer tweet-details-fixer">\n            <div class="cards-media-container"></div>\n            <div class="js-tweet-media-container"></div>\n            <div class="js-machine-translated-tweet-container"></div>\n            <div class="js-tweet-stats-container tweet-stats-container">\n              <ul class="stats">\n                <li class="js-stat-count js-stat-retweets stat-count">\n                  <a class="request-retweeted-popup" data-activity-popup-title="Retweeted 229,403 times">\n                     <strong>229,403</strong> Retweets\n                  </a>\n                </li>\n                <li class="js-stat-count js-stat-favorites stat-count">\n                  <a class="request-favorited-popup" data-activity-popup-title=" Favorited 630 times">\n                    <strong>630</strong> Favorites\n                  </a>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </div>\n  ';beforeEach(function(){setupComponent(a,{openClass:"open",loggedIn:!0}),spyOnEvent(this.$node,"uiRequestActivityPopup")}),describe("requestActivityPopup()",function(){it("triggers uiRequestActivityPopup with isRetweeted=true when retweeted word is clicked",function(){this.component.$node.find("a.request-retweeted-popup").click(),expect("uiRequestActivityPopup").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({isRetweeted:!0}))}),it("triggers uiRequestActivityPopup with isRetweeted=true when retweeted count is clicked",function(){this.component.$node.find("a.request-retweeted-popup strong").click(),expect("uiRequestActivityPopup").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({isRetweeted:!0}))}),it("triggers uiRequestActivityPopup with isRetweeted=false when favorited word is clicked",function(){this.component.$node.find("a.request-favorited-popup").click(),expect("uiRequestActivityPopup").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({isRetweeted:!1}))}),it("triggers uiRequestActivityPopup with isRetweeted=false when favorited count is clicked",function(){this.component.$node.find("a.request-favorited-popup strong").click(),expect("uiRequestActivityPopup").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({isRetweeted:!1}))})})})
});
define("test/app/ui/global_loading_indicator_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/global_loading_indicator",function(){var a='<div>\n      <div class="fake-body">\n        <div class="global-nav">\n          <h1 class="fake-bird-class" style="border: 1px solid red;"></h1>\n        </div>\n      </div>\n    </div>\n  ';beforeEach(function(){setupComponent(a,{birdSelector:"h1.fake-bird-class",spinnerContainer:".fake-body"}),this.$node.trigger("uiSwiftLoaded")}),describe("on uiSwiftLoaded",function(){it("adds the spinner to the dom",function(){expect(this.$node.find(".pushstate-spinner").length).toBe(1)})}),describe("on uiShowGlobalLoadingIndicator",function(){it("shows the spinner",function(){this.$node.trigger("uiShowGlobalLoadingIndicator"),expect(this.$node.find(".fake-body")).toHaveClass("pushing-state")})}),describe("on uiHideGlobalLoadingIndicator",function(){it("hides the spinner",function(){this.$node.trigger("uiShowGlobalLoadingIndicator"),this.$node.trigger("uiHideGlobalLoadingIndicator"),expect(this.$node.find(".fake-body")).not.toHaveClass("pushing-state"),expect(this.$node.find(".fake-bird-class")).not.toHaveAttr("style")})})})
});
define("test/app/ui/hidden_descendants_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/hidden_descendants",function(){beforeEach(function(){var a='<div class="permalink">\n        <div class="replies-to">\n          <ol class="stream-items"></ol>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("adds a class to the node when a new reply is added when there were previously none",function(){this.component.$node.find(".stream-items").append('<li><div class="tweet">new tweet</div></li>'),this.component.trigger(document,"uiTweetInserted"),expect(this.component.$node).toHaveClass(this.component.attr.hasRepliesClass)}),it("removes a class from the node when there are no replies after a tweet is removed",function(){this.component.$node.find(".stream-items").empty(),this.component.trigger(document,"uiTweetRemoved"),expect(this.component.$node).not.toHaveClass(this.component.attr.hasRepliesClass)})})
});
define("test/app/ui/timezone_detector_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/timezone_detector",function(){var a='<select id="user_time_zone" name="user[time_zone]">\n      <option data-offset="-36000" value="Hawaii" >(GMT-10:00) Hawaii</option>\n      <option data-offset="-32400" value="Alaska" >(GMT-09:00) Alaska</option>\n      <option data-offset="-28800" value="Pacific Time (US &amp; Canada)" >(GMT-08:00) Pacific Time (US &amp; Canada)</option>\n      <option data-offset="-25200" value="Arizona" >(GMT-07:00) Arizona</option>\n      <option data-offset="-25200" value="Mountain Time (US &amp; Canada)" >(GMT-07:00) Mountain Time (US &amp; Canada)</option>\n      <option data-offset="-21600" value="Central Time (US &amp; Canada)" >(GMT-06:00) Central Time (US &amp; Canada)</option>\n      <option data-offset="-18000" value="Eastern Time (US &amp; Canada)" >(GMT-05:00) Eastern Time (US &amp; Canada)</option>\n      <option data-offset="-18000" value="Indiana (East)" >(GMT-05:00) Indiana (East)</option>\n      <option data-offset="" value="">-------------</option>\n      <option data-offset="-39600" value="International Date Line West" >(GMT-11:00) International Date Line West</option>\n      <option data-offset="-39600" value="Midway Island" >(GMT-11:00) Midway Island</option>\n      <option data-offset="-39600" value="Samoa" >(GMT-11:00) Samoa</option>\n      <option data-offset="-28800" value="Tijuana" >(GMT-08:00) Tijuana</option>\n      <option data-offset="-25200" value="Chihuahua" >(GMT-07:00) Chihuahua</option>\n      <option data-offset="-25200" value="Mazatlan" >(GMT-07:00) Mazatlan</option>\n      <option data-offset="-21600" value="Central America" >(GMT-06:00) Central America</option>\n      <option data-offset="-21600" value="Guadalajara" >(GMT-06:00) Guadalajara</option>\n      <option data-offset="-21600" value="Mexico City" >(GMT-06:00) Mexico City</option>\n      <option data-offset="-21600" value="Monterrey" >(GMT-06:00) Monterrey</option>\n      <option data-offset="-21600" value="Saskatchewan" >(GMT-06:00) Saskatchewan</option>\n      <option data-offset="-18000" value="Bogota" >(GMT-05:00) Bogota</option>\n      <option data-offset="-18000" value="Lima" >(GMT-05:00) Lima</option>\n      <option data-offset="-18000" value="Quito" >(GMT-05:00) Quito</option>\n      <option data-offset="-16200" value="Caracas" >(GMT-04:30) Caracas</option>\n      <option data-offset="-14400" value="Atlantic Time (Canada)" >(GMT-04:00) Atlantic Time (Canada)</option>\n      <option data-offset="-14400" value="La Paz" >(GMT-04:00) La Paz</option>\n      <option data-offset="-14400" value="Santiago" >(GMT-04:00) Santiago</option>\n      <option data-offset="-12600" value="Newfoundland" >(GMT-03:30) Newfoundland</option>\n      <option data-offset="-10800" value="Brasilia" >(GMT-03:00) Brasilia</option>\n      <option data-offset="-10800" value="Buenos Aires" >(GMT-03:00) Buenos Aires</option>\n      <option data-offset="-10800" value="Georgetown" >(GMT-03:00) Georgetown</option>\n      <option data-offset="-10800" value="Greenland" >(GMT-03:00) Greenland</option>\n      <option data-offset="-7200" value="Mid-Atlantic" >(GMT-02:00) Mid-Atlantic</option>\n      <option data-offset="-3600" value="Azores" >(GMT-01:00) Azores</option>\n      <option data-offset="-3600" value="Cape Verde Is." >(GMT-01:00) Cape Verde Is.</option>\n      <option data-offset="0" value="Casablanca" >(GMT) Casablanca</option>\n      <option data-offset="0" value="Dublin" >(GMT) Dublin</option>\n      <option data-offset="0" value="Edinburgh" >(GMT) Edinburgh</option>\n      <option data-offset="0" value="Lisbon" >(GMT) Lisbon</option>\n      <option data-offset="0" value="London" >(GMT) London</option>\n      <option data-offset="0" value="Monrovia" >(GMT) Monrovia</option>\n      <option data-offset="3600" value="Amsterdam" >(GMT+01:00) Amsterdam</option>\n      <option data-offset="3600" value="Belgrade" >(GMT+01:00) Belgrade</option>\n      <option data-offset="3600" value="Berlin" >(GMT+01:00) Berlin</option>\n      <option data-offset="3600" value="Bern" >(GMT+01:00) Bern</option>\n      <option data-offset="3600" value="Bratislava" >(GMT+01:00) Bratislava</option>\n      <option data-offset="3600" value="Brussels" >(GMT+01:00) Brussels</option>\n      <option data-offset="3600" value="Budapest" >(GMT+01:00) Budapest</option>\n      <option data-offset="3600" value="Copenhagen" >(GMT+01:00) Copenhagen</option>\n      <option data-offset="3600" value="Ljubljana" >(GMT+01:00) Ljubljana</option>\n      <option data-offset="3600" value="Madrid" >(GMT+01:00) Madrid</option>\n      <option data-offset="3600" value="Paris" >(GMT+01:00) Paris</option>\n      <option data-offset="3600" value="Prague" >(GMT+01:00) Prague</option>\n      <option data-offset="3600" value="Rome" >(GMT+01:00) Rome</option>\n      <option data-offset="3600" value="Sarajevo" >(GMT+01:00) Sarajevo</option>\n      <option data-offset="3600" value="Skopje" >(GMT+01:00) Skopje</option>\n      <option data-offset="3600" value="Stockholm" >(GMT+01:00) Stockholm</option>\n      <option data-offset="3600" value="Vienna" >(GMT+01:00) Vienna</option>\n      <option data-offset="3600" value="Warsaw" >(GMT+01:00) Warsaw</option>\n      <option data-offset="3600" value="West Central Africa" >(GMT+01:00) West Central Africa</option>\n      <option data-offset="3600" value="Zagreb" >(GMT+01:00) Zagreb</option>\n      <option data-offset="7200" value="Athens" >(GMT+02:00) Athens</option>\n      <option data-offset="7200" value="Bucharest" >(GMT+02:00) Bucharest</option>\n      <option data-offset="7200" value="Cairo" >(GMT+02:00) Cairo</option>\n      <option data-offset="7200" value="Harare" >(GMT+02:00) Harare</option>\n      <option data-offset="7200" value="Helsinki" >(GMT+02:00) Helsinki</option>\n      <option data-offset="7200" value="Istanbul" >(GMT+02:00) Istanbul</option>\n      <option data-offset="7200" value="Jerusalem" >(GMT+02:00) Jerusalem</option>\n      <option data-offset="7200" value="Kyiv" >(GMT+02:00) Kyiv</option>\n      <option data-offset="7200" value="Pretoria" >(GMT+02:00) Pretoria</option>\n      <option data-offset="7200" value="Riga" >(GMT+02:00) Riga</option>\n      <option data-offset="7200" value="Sofia" >(GMT+02:00) Sofia</option>\n      <option data-offset="7200" value="Tallinn" >(GMT+02:00) Tallinn</option>\n      <option data-offset="7200" value="Vilnius" >(GMT+02:00) Vilnius</option>\n      <option data-offset="10800" value="Baghdad" >(GMT+03:00) Baghdad</option>\n      <option data-offset="10800" value="Kuwait" >(GMT+03:00) Kuwait</option>\n      <option data-offset="10800" value="Minsk" >(GMT+03:00) Minsk</option>\n      <option data-offset="10800" value="Nairobi" >(GMT+03:00) Nairobi</option>\n      <option data-offset="10800" value="Riyadh" >(GMT+03:00) Riyadh</option>\n      <option data-offset="12600" value="Tehran" >(GMT+03:30) Tehran</option>\n      <option data-offset="14400" value="Abu Dhabi" >(GMT+04:00) Abu Dhabi</option>\n      <option data-offset="14400" value="Baku" >(GMT+04:00) Baku</option>\n      <option data-offset="14400" value="Moscow" >(GMT+04:00) Moscow</option>\n      <option data-offset="14400" value="Muscat" >(GMT+04:00) Muscat</option>\n      <option data-offset="14400" value="St. Petersburg" >(GMT+04:00) St. Petersburg</option>\n      <option data-offset="14400" value="Tbilisi" >(GMT+04:00) Tbilisi</option>\n      <option data-offset="14400" value="Volgograd" >(GMT+04:00) Volgograd</option>\n      <option data-offset="14400" value="Yerevan" >(GMT+04:00) Yerevan</option>\n      <option data-offset="16200" value="Kabul" >(GMT+04:30) Kabul</option>\n      <option data-offset="18000" value="Islamabad" >(GMT+05:00) Islamabad</option>\n      <option data-offset="18000" value="Karachi" >(GMT+05:00) Karachi</option>\n      <option data-offset="18000" value="Tashkent" >(GMT+05:00) Tashkent</option>\n      <option data-offset="19800" value="Chennai" >(GMT+05:30) Chennai</option>\n      <option data-offset="19800" value="Kolkata" >(GMT+05:30) Kolkata</option>\n      <option data-offset="19800" value="Mumbai" >(GMT+05:30) Mumbai</option>\n      <option data-offset="19800" value="New Delhi" >(GMT+05:30) New Delhi</option>\n      <option data-offset="20700" value="Kathmandu" >(GMT+05:45) Kathmandu</option>\n      <option data-offset="21600" value="Almaty" >(GMT+06:00) Almaty</option>\n      <option data-offset="21600" value="Astana" >(GMT+06:00) Astana</option>\n      <option data-offset="21600" value="Dhaka" >(GMT+06:00) Dhaka</option>\n      <option data-offset="21600" value="Ekaterinburg" >(GMT+06:00) Ekaterinburg</option>\n      <option data-offset="21600" value="Sri Jayawardenepura" >(GMT+06:00) Sri Jayawardenepura</option>\n      <option data-offset="23400" value="Rangoon" >(GMT+06:30) Rangoon</option>\n      <option data-offset="25200" value="Bangkok" >(GMT+07:00) Bangkok</option>\n      <option data-offset="25200" value="Hanoi" >(GMT+07:00) Hanoi</option>\n      <option data-offset="25200" value="Jakarta" >(GMT+07:00) Jakarta</option>\n      <option data-offset="25200" value="Novosibirsk" >(GMT+07:00) Novosibirsk</option>\n      <option data-offset="28800" value="Beijing" >(GMT+08:00) Beijing</option>\n      <option data-offset="28800" value="Chongqing" >(GMT+08:00) Chongqing</option>\n      <option data-offset="28800" value="Hong Kong" >(GMT+08:00) Hong Kong</option>\n      <option data-offset="28800" value="Krasnoyarsk" >(GMT+08:00) Krasnoyarsk</option>\n      <option data-offset="28800" value="Kuala Lumpur" >(GMT+08:00) Kuala Lumpur</option>\n      <option data-offset="28800" value="Perth" >(GMT+08:00) Perth</option>\n      <option data-offset="28800" value="Singapore" >(GMT+08:00) Singapore</option>\n      <option data-offset="28800" value="Taipei" >(GMT+08:00) Taipei</option>\n      <option data-offset="28800" id="TestMongolia" value="Ulaan Bataar" >(GMT+08:00) Ulaan Bataar</option>\n      <option data-offset="28800" value="Urumqi" >(GMT+08:00) Urumqi</option>\n      <option data-offset="32400" value="Irkutsk" >(GMT+09:00) Irkutsk</option>\n      <option data-offset="32400" value="Osaka" >(GMT+09:00) Osaka</option>\n      <option data-offset="32400" value="Sapporo" >(GMT+09:00) Sapporo</option>\n      <option data-offset="32400" value="Seoul" >(GMT+09:00) Seoul</option>\n      <option data-offset="32400" value="Tokyo" >(GMT+09:00) Tokyo</option>\n      <option data-offset="34200" value="Adelaide" >(GMT+09:30) Adelaide</option>\n      <option data-offset="34200" value="Darwin" >(GMT+09:30) Darwin</option>\n      <option data-offset="36000" value="Brisbane" >(GMT+10:00) Brisbane</option>\n      <option data-offset="36000" value="Canberra" >(GMT+10:00) Canberra</option>\n      <option data-offset="36000" value="Guam" >(GMT+10:00) Guam</option>\n      <option data-offset="36000" value="Hobart" >(GMT+10:00) Hobart</option>\n      <option data-offset="36000" value="Melbourne" >(GMT+10:00) Melbourne</option>\n      <option data-offset="36000" value="Port Moresby" >(GMT+10:00) Port Moresby</option>\n      <option data-offset="36000" value="Sydney" >(GMT+10:00) Sydney</option>\n      <option data-offset="36000" value="Yakutsk" >(GMT+10:00) Yakutsk</option>\n      <option data-offset="39600" value="New Caledonia" >(GMT+11:00) New Caledonia</option>\n      <option data-offset="39600" value="Solomon Is." >(GMT+11:00) Solomon Is.</option>\n      <option data-offset="39600" value="Vladivostok" >(GMT+11:00) Vladivostok</option>\n      <option data-offset="43200" value="Auckland" >(GMT+12:00) Auckland</option>\n      <option data-offset="43200" value="Fiji" >(GMT+12:00) Fiji</option>\n      <option data-offset="43200" value="Kamchatka" >(GMT+12:00) Kamchatka</option>\n      <option data-offset="43200" value="Magadan" >(GMT+12:00) Magadan</option>\n      <option data-offset="43200" value="Marshall Is." >(GMT+12:00) Marshall Is.</option>\n      <option data-offset="43200" value="Wellington" >(GMT+12:00) Wellington</option>\n      <option data-offset="46800" value="Nuku&#39;alofa" >(GMT+13:00) Nuku&#39;alofa</option>\n    </select>\n  ';describe("Select a timezone when nothing is previously selected.",function(){beforeEach(function(){setupComponent(a)}),it("selects an option from the current timezone",function(){var a=String((new Date).getTimezoneOffset()*60*-1),b=this.component.$node.find(":selected");expect(b.attr("data-offset")).toBe(a)})}),describe("Use the selected timezone when one has been chosen",function(){beforeEach(function(){var b=window.$(a);b.find("#TestMongolia").attr("selected",!0),setupComponent(b)}),it("uses Ulaan Bataar as indicated in the markup",function(){var a=this.component.$node.find(":selected");expect(a.attr("value")).toBe("Ulaan Bataar")})}),describe("tzOffset",function(){beforeEach(function(){setupComponent(a)}),it("returns the timezone offset in seconds with negative numbers for timezones trailing UTC",function(){expect((new Date).getTimezoneOffset()*60*-1).toBe(this.component.tzOffset())})})})
});
define("test/app/ui/password_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/password_dialog",function(){describe("submitForm()",function(){xit("",function(){expect("").toBe("")})}),describe("openDialog()",function(){xit("",function(){expect("").toBe("")})}),describe("closeDialog()",function(){xit("",function(){expect("").toBe("")})}),describe("notifyForgotPassword()",function(){xit("",function(){expect("").toBe("")})}),describe("notifyReminderSent()",function(){xit("",function(){expect("").toBe("")})})})
});
define("test/app/ui/email_confirmation_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/email_confirmation",function(){describe("event dataCancelEmailSuccess",function(){xit("",function(){expect("").toBe("")})}),describe("event dataCancelEmailFailure",function(){xit("",function(){expect("").toBe("")})}),describe("event dataResendEmailSuccess",function(){xit("",function(){expect("").toBe("")})}),describe("event dataResendEmailFailure",function(){xit("",function(){expect("").toBe("")})})})
});
define("test/app/ui/oauth_revoker_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/oauth_revoker",function(){var a="19-foo";beforeEach(function(){var b='<div class="stream" id="apps-stream">';b+='<div id="oauth_application_'+a+'" class="stream-item oauth-application ">',b+='<a class="revoke btn" id="btn_oauth_application_'+a+'" type="button" href="#">Revoke access</a>',b+="</div>",b+="</div>",setupComponent(b)}),describe("clicking the revoke button",function(){it("triggers a uiRevokeClick event on the stream",function(){spyOnEvent(document,"uiRevokeClick"),$("#btn_oauth_application_"+a).trigger("click"),expect("uiRevokeClick").toHaveBeenTriggeredOnAndWith(document,{token:a,twttr:!0})})}),describe("dataOAuthRevokeResultSuccess application revoked",function(){beforeEach(function(){this.label="unrevoke application",$(document).trigger("dataOAuthRevokeResultSuccess",{sourceEventData:{token:a},revoked:!0,label:this.label})}),it("sets revoked class",function(){expect($("#oauth_application_"+a)).toHaveClass("revoked")}),it("sets an unrevoke application label",function(){expect($(".revoke.btn")).toHaveText(this.label)})}),describe("dataOAuthRevokeResultSuccess application unrevoked",function(){beforeEach(function(){this.label="unrevoking application",this.unrevokedLabel="revoke application",$(document).trigger("dataOAuthRevokeResultSuccess",{sourceEventData:{token:a},revoked:!0,label:this.label}),$(document).trigger("dataOAuthRevokeResultSuccess",{sourceEventData:{token:a},revoked:!1,label:this.unrevokedLabel})}),it("unsets revoked class",function(){expect($("#oauth_application_"+a)).not.toHaveClass("revoked")}),it("sets a revoke application label",function(){expect($(".revoke.btn")).toHaveText(this.unrevokedLabel)})})})
});
define("test/app/ui/related_tweets_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/related_tweets",function(){it("should immediately fire 'uiGetRelatedTweets'",function(){var a='<div>\n      <div id="related-tweets-container"></div>\n     </div>\n     ';spyOnEvent(document,"uiGetRelatedTweets"),setupComponent(a),expect("uiGetRelatedTweets").toHaveBeenTriggeredOn(document)}),describe("event 'dataGotRelatedTweets'",function(){beforeEach(function(){var a='<div>\n       <div id="related-tweets-container"></div>\n       </div>\n       ';setupComponent(a)}),it("should add HTML from 'dataGotRelatedTweets'",function(){var a="<div>Giggity</div>";$(document).trigger("dataGotRelatedTweets",{items_html:a}),expect(this.component.$node.html()).toEqual(a)})})})
});
define("test/app/ui/list_members_dashboard_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/list_members_dashboard",function(){beforeEach(function(){setupComponent('<div class="newest-members-module"></div>')}),describe("event dataGotNewListMembers",function(){it("replaces the markup with new data",function(){this.component.trigger("dataGotNewListMembers",{newest_members_html:"New Text",follow_card_html:"Some new text"}),expect(this.component.$node.html()).toBe("New Text")})})})
});
define("test/app/ui/with_inline_image_editing_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_inline_image_editing",{fixture:"test/fixtures/own_profile_header"},function(){var a,b;beforeEach(function(){setupComponent(this.fixture),a=this.component.select("headerImageUploadDialogSelector"),b=this.component.$node}),describe("on uiDialogOpened by header image upload dialog",function(){it("should have class 'profile-header-editing' on body",function(){a.trigger("uiDialogOpened"),expect($("body")).toHaveClass("profile-header-editing")}),it("should hide header options",function(){$("body").addClass("show-header-options"),a.trigger("uiDialogOpened"),expect($("body")).not.toHaveClass("show-header-options")}),describe("preview is added to header upload dialog",function(){it("should not have input fields and dialogs",function(){a.trigger("uiDialogOpened");var b=a.find(".profile-header");expect(b.find(this.component.attr.removeFromPreview)).not.toExist()}),it("it is removed on uiDialogClosed",function(){a.trigger("uiDialogOpened");var b=a.find(".profile-header");expect(b).toExist(),a.trigger("uiDialogClosed"),expect(b).not.toExist()}),it("triggers uiNeedsTextPreview",function(){spyOnEvent(b,"uiNeedsTextPreview"),a.trigger("uiDialogOpened"),expect("uiNeedsTextPreview").toHaveBeenTriggeredOn(this.component)})})}),describe("on uiDialogClosed by header image upload dialog",function(){it("should not have class 'profile-header-editing' on body",function(){a.trigger("uiDialogClosed"),expect($("body")).not.toHaveClass("profile-header-editing")})}),describe("on uiImageSave",function(){var a="/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAACAAIDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAZEAADAAMAAAAAAAAAAAAAAAAAAQQDIZL/xAAVAQEBAAAAAAAAAAAAAAAAAAACBP/EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAwDAQACEQMRAD8As3XU9unL2wARBkf/2Q==";describe("with header data",function(){it("should update header",function(){spyOnEvent(b,"uiProfileHeaderUpdated"),$(document).trigger("uiImageSave",{uploadType:"header",fileData:a}),expect("uiProfileHeaderUpdated").toHaveBeenTriggeredOn(this.component);var c=this.component.select("profileHeaderInnerSelector").css("background-image").replace(/"/g,"");expect(c).toBe("url(data:image/jpeg;base64,"+a+")");var d=this.component.select("profileHeaderInnerSelector").css("background-size");expect(d).toBe("100% 100%")})}),describe("with avatar data",function(){it("should update avatar",function(){spyOnEvent(b,"uiProfileAvatarUpdated"),$(document).trigger("uiImageSave",{uploadType:"avatar",fileData:a}),expect("uiProfileAvatarUpdated").toHaveBeenTriggeredOn(this.component),expect(this.component.select("avatarSelector")).toHaveAttr("src","data:image/jpeg;base64,"+a),expect(this.component.select("avatarContainerSelector")).not.toHaveClass("hidden"),expect(this.component.select("avatarPlaceholderSelector")).toHaveClass("hidden")})})}),describe("on dataDeleteImageSuccess",function(){var a,b;beforeEach(function(){a=this.component.select("avatarContainerSelector").show(),b=this.component.select("avatarPlaceholderSelector").hide()}),describe("with avatar",function(){it("should show avatar placeholder",function(){$(document).trigger("dataDeleteImageSuccess",{sourceEventData:{uploadType:"avatar"}}),expect(a).toHaveClass("hidden"),expect(b).not.toHaveClass("hidden")})}),describe("with header",function(){it("should not show avatar placeholder",function(){var c=this.component.select("profileHeaderInnerSelector");c.css("background-image","/test.png"),$(document).trigger("dataDeleteImageSuccess",{sourceEventData:{uploadType:"header"}}),expect(c.css("background-image")).toMatch(/\/t1\/img\/grey_header_web.jpg/),expect(a).toBeVisible(),expect(b).not.toBeVisible()})})})})
});
define("test/app/ui/search_input_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/search_input",function(){beforeEach(function(){var a='<form class="form-search js-search-form focus" action="/search" id="global-nav-search">\n        <span class="search-icon js-search-action">\n          <i class="nav-search"></i>\n        </span>\n        <input class="search-input" type="text" id="search-query" placeholder="Enter a #hashtag or keyword" name="q" autocomplete="off" spellcheck="false">\n        <div class="typeahead"></div>\n        <input disabled="disabled" class="search-input search-hinting-input" type="text" id="search-query-hint" autocomplete="off" spellcheck="false">\n      </form>\n    ',b=$(a);this.$input=b.find("#search-query"),this.$dropdown=b.find(".typeahead"),setupComponent(b,{searchPathWithQuery:"/search?q=query&src=typd"})}),describe("uiTypeaheadInputSubmit",function(){it("is triggered on form submit",function(){spyOnEvent(this.$node,"uiTypeaheadInputSubmit"),this.$input.val("camouflage"),this.$node.submit(),expect("uiTypeaheadInputSubmit").toHaveBeenTriggeredOn(this.$node)}),it("is triggered on magnifying glass icon click",function(){spyOnEvent(this.$node,"uiTypeaheadInputSubmit"),this.$input.val("camouflage"),this.$node.find(".js-search-action").click(),expect("uiTypeaheadInputSubmit").toHaveBeenTriggeredOn(this.$node)})}),describe("when the search box receives focus",function(){beforeEach(function(){spyOnEvent(this.$node,"uiSearchInputFocused"),this.component.$input.focus()}),it("adds the specified focus class to the node",function(){expect(this.component.$node).toHaveClass(this.component.attr.focusClass)}),it("adds the specified focus class to the search box",function(){expect(this.component.$input).toHaveClass(this.component.attr.focusClass)}),it("adds the specified focus class to the hint",function(){expect(this.component.$hint).toHaveClass(this.component.attr.focusClass)}),it("triggers a uiSearchInputFocused event",function(){expect("uiSearchInputFocused").toHaveBeenTriggeredOn(this.$node)})}),describe("when the search box loses focus",function(){beforeEach(function(){this.component.addFocusStyles(),this.component.$input.blur()}),it("removes the specified focus class to the node",function(){expect(this.component.$node).not.toHaveClass(this.component.attr.focusClass)}),it("removes the specified focus class to the search box",function(){expect(this.component.$input).not.toHaveClass(this.component.attr.focusClass)}),it("removes the specified focus class to the hint",function(){expect(this.component.$hint).not.toHaveClass(this.component.attr.focusClass)})}),describe("uiNavigate",function(){describe("when uiTypeaheadItemSelected",function(){it("is not triggered if the input is empty",function(){spyOnEvent(this.$node,"uiNavigate"),this.$node.find(".js-search-action").click(),expect("uiNavigate").not.toHaveBeenTriggeredOn(this.$node)}),it("is not triggered if click and source is not search",function(){spyOnEvent(this.$node,"uiNavigate"),this.$dropdown.trigger("uiTypeaheadItemSelected",{type:"text",value:"camouflage",query:"camouflage",display:"display",href:"/test",source:"account",isClick:!0}),expect("uiNavigate").not.toHaveBeenTriggeredOn(this.$node)}),it("changes the input value if not an account",function(){this.$input.val("not-display"),this.$dropdown.trigger("uiTypeaheadItemSelected",{type:"text",value:"camouflage",query:"camouflage",display:"display",href:"/test",source:"other",isClick:!0}),expect(this.$input).toHaveValue("display")}),it("doesn't change the input value if it's an account",function(){this.$input.val("not-display"),this.$dropdown.trigger("uiTypeaheadItemSelected",{type:"text",value:"camouflage",query:"camouflage",display:"display",href:"/test",source:"account",isClick:!0}),expect(this.$input).toHaveValue("not-display")}),it("is triggered on query submit",function(){spyOnEvent(this.$node,"uiNavigate"),spyOnEvent(this.$node,"uiSearchQuery"),this.component.trigger("uiTypeaheadSubmitQuery",{query:"#test"}),expect("uiSearchQuery").toHaveBeenTriggeredOnAndWith(this.$node,{query:"#test",source:"search"}),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,{href:"/search?q=%23test&src=typd"})})})}),describe("tweets search",function(){it("is triggered if source is save search",function(){spyOnEvent(this.$node,"uiNavigate"),this.$node.trigger("uiTypeaheadItemSelected",{input:"jack",query:"jack",display:"display",href:"/search/jack",source:"saved_search"}),expect(this.$input).toHaveValue("display"),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,{href:"/search/jack"})})}),describe("sets the value of query",function(){it("sets given query value",function(){var a="one little indian";setupComponent(this.$node,{query:a}),expect(this.$input).toHaveValue(a)}),it("sets empty query value if not set",function(){setupComponent(this.$node,{query:null}),expect(this.$input).toHaveValue("")})})})
});
define("test/app/ui/search_query_source_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/search_query_source",function(){beforeEach(function(){var a='<div>\n  <a id="new" data-query-source="new_query">Typed</a>\n  <a id="other" data-query-source="other_query">Other</a>\n  <a id="not_really">Typed</a>\n</div>\n    ';setupComponent(a)}),describe("click on link with data-query-source",function(){it("sets the query source in the element",function(){this.$node.find("#new").click();var a=this.component.storage.getItem("source");expect(a.source.value).toBe("new_query"),this.$node.find("#other").click(),a=this.component.storage.getItem("source"),expect(a.source.value).toBe("other_query")})}),describe("click on link without data-query-source",function(){it("should not set the storage",function(){this.$node.find("#not_really").click();var a=this.component.storage.getItem("source");expect(a).toBeNull()})}),describe("uiSearchQuery",function(){it("sets the query source if the data is search",function(){this.component.trigger("uiSearchQuery",{source:"search"});var a=this.component.storage.getItem("source");expect(a.source.value).toBe("typed_query")}),it("does not set the query source if data is not for search",function(){this.component.trigger("uiSearchQuery",{source:"accounts"});var a=this.component.storage.getItem("source");expect(a).toBeNull()})})})
});
define("test/app/ui/temporary_password_button_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/temporary_password_button",function(){beforeEach(setupComponent),describe("opening temporary password dialog",function(){it("triggers a uiOpenTemporaryPasswordDialog event when clicked",function(){spyOnEvent(document,"uiOpenTemporaryPasswordDialog"),this.$node.trigger("click"),expect("uiOpenTemporaryPasswordDialog").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/with_image_selection_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_image_selection",function(){beforeEach(function(){var a='<div class="photo-selector">\n        <button class="btn" type="button">\n          <i class="tweet-camera"></i>\n        </button>\n        <div class="image-selector">\n          <input type="file" name="image" class="file-input">\n          <input type="hidden" class="file-data">\n          <div class="swf-container"></div>\n        </div>\n      </div>\n    ';setupComponent(a)}),describe("setup()",function(){beforeEach(function(){spyOn(this.component,"setupFlash")}),it("should make flash init call if mode is flash",function(){spyOn(this.component,"mode").andReturn("flash"),this.component.setup(),expect(this.component.setupFlash).toHaveBeenCalled()}),it("should not make flash init call if mode is not flash",function(){spyOn(this.component,"mode").andReturn("bananas"),this.component.setup(),expect(this.component.setupFlash).not.toHaveBeenCalled()})}),describe("setupFlash()",function(){beforeEach(function(){jasmine.Clock.useMock(),spyOn(this.component,"mode").andReturn("flash")}),it("should call loadSwf",function(){this.component.loadSwf=function(){},spyOn(this.component,"loadSwf"),this.component.setupFlash(),jasmine.Clock.tick(500),expect(this.component.loadSwf).toHaveBeenCalled()}),it("should assign the callbacks",function(){var a=Date;spyOn(window,"Date").andReturn(new a(123456));var b=spyOn(this.component,"gotFlashImageData"),c=spyOn(this.component,"gotFlashImageError");this.component.setupFlash(),window.swift_tweetbox_callback_123456(),window.swift_tweetbox_error_callback_123456(),expect(b).toHaveBeenCalled(),expect(c).toHaveBeenCalled()})}),describe("showPreview()",function(){it("should trigger the uiTweetBoxShowPreview event",function(){spyOnEvent(document,"uiTweetBoxShowPreview");var a={foo:"bar"};this.component.showPreview(a),expect("uiTweetBoxShowPreview").toHaveBeenTriggeredOnAndWith(document,a)})}),describe("resetInput()",function(){it("replaces the fileSelector with the blank file input field",function(){this.component.resetInput(),expect(this.component.select("fileSelector")).toHaveAttr("name","media_empty")})}),describe("readyFileData()",function(){it("sets attrs on the file data input field and resets the input",function(){var a="image data!!!";spyOn(this.component,"resetInput"),this.component.readyFileData(a),expect(this.component.select("fileDataSelector")).toHaveAttr("name","media_data[]"),expect(this.component.select("fileDataSelector")).toHaveAttr("value",a),expect(this.component.resetInput).toHaveBeenCalled()})}),describe("readyFileInput",function(){it("should set the file input field name",function(){this.component.readyFileInput(),expect(this.component.select("fileSelector")).toHaveAttr("name","media[]")})}),describe("gotFileInput()",function(){it("should call showPreview and readyFileInput",function(){spyOn(this.component,"showPreview"),spyOn(this.component,"readyFileInput");var a="lolcat.jpg";this.component.gotFileInput(a),expect(this.component.showPreview).toHaveBeenCalledWith({fileName:a}),expect(this.component.readyFileInput).toHaveBeenCalled()})}),describe("gotResizedImageData()",function(){var a,b;beforeEach(function(){this.component.addFileError=function(){},spyOn(this.component,"addFileError"),spyOn(this.component,"showPreview"),spyOn(this.component,"readyFileData"),a="lolcat.jpg",b="fake image data!!!"}),it("should add an error and return if no image data was found",function(){this.component.gotResizedImageData(a),expect(this.component.addFileError).toHaveBeenCalledWith("notImage"),expect(this.component.showPreview).not.toHaveBeenCalled(),expect(this.component.readyFileData).not.toHaveBeenCalled()}),it("should call showPreview and readyFileData if imageData is present",function(){this.component.gotResizedImageData(a,b),expect(this.component.addFileError).not.toHaveBeenCalled(),expect(this.component.showPreview).toHaveBeenCalledWith({imageData:b,fileName:a}),expect(this.component.readyFileData).toHaveBeenCalledWith(b)}),it("should remove any extra data before the base64-encoded image because the monorail doesn't like this",function(){b="content-type:image/jpeg,someimagedata",this.component.gotResizedImageData(a,b),expect(this.component.readyFileData).toHaveBeenCalledWith("someimagedata")})}),describe("gotFlashImageError()",function(){it("should call addFileError with the error type",function(){this.component.addFileError=function(){},spyOn(this.component,"addFileError"),this.component.gotFlashImageError("fake error","lolcat.jpg"),expect(this.component.addFileError).toHaveBeenCalledWith("fake error")})}),describe("gotFlashImageData()",function(){it("should call showPreview and readyFileData",function(){spyOn(this.component,"showPreview"),spyOn(this.component,"readyFileData");var a="lolcat.jpg",b="fake image data",c="fake thumb data";this.component.gotFlashImageData(a,b,c),expect(this.component.showPreview).toHaveBeenCalledWith({imageData:c,fileName:a}),expect(this.component.readyFileData).toHaveBeenCalledWith(b)}),it("should not call showPreview and readyFileData if the filename is invalid",function(){var a="lolcat",b="fake image data",c="fake thumb data";this.component.addFileError=function(){},spyOn(this.component,"addFileError"),spyOn(this.component,"showPreview"),spyOn(this.component,"readyFileData"),this.component.gotFlashImageData(a,b,c),expect(this.component.showPreview).not.toHaveBeenCalled(),expect(this.component.readyFileData).not.toHaveBeenCalled()})}),describe("reset()",function(){it("calls resetInput, replaces the fileDataSelector element, and triggers the uiTweetBoxHidePreview event",function(){spyOn(this.component,"resetInput"),spyOnEvent(document,"uiTweetBoxHidePreview"),this.component.reset(),expect(this.component.resetInput).toHaveBeenCalled(),expect(this.component.select("fileDataSelector")).toHaveAttr("name","media_data_empty"),expect("uiTweetBoxHidePreview").toHaveBeenTriggeredOn(document)})}),describe("gotFileHandle()",function(){var a="lolcat.jpg",b="fakefilehandle";it("should call getFileData if using HTML5",function(){this.component.gotImageData=function(){},spyOn(this.component,"mode").andReturn("html5"),spyOn(this.component,"getFileData"),spyOn(this.component.gotImageData,"bind").andCallFake(function(){return this}),this.component.gotFileHandle(a,b),expect(this.component.getFileData).toHaveBeenCalledWith(a,b,this.component.gotImageData)}),it("should call gotFileInput if not using HTML5",function(){spyOn(this.component,"mode").andReturn("flash"),spyOn(this.component,"gotFileInput"),this.component.gotFileHandle(a,b),expect(this.component.gotFileInput).toHaveBeenCalledWith(a)})}),describe("imageSelected()",function(){var a,b,c;beforeEach(function(){a="lolcat.jpg",b="FILEHANDLE",c=this.component.select("fileSelector").get(0),spyOn(this.component,"getFileName").andReturn(a),spyOn(this.component,"getFileHandle").andReturn(b),spyOn(this.component,"gotFileHandle")}),it("should call gotFileHandle if the image is valid",function(){spyOn(this.component,"validateImage").andReturn(!0),this.component.imageSelected(),expect(this.component.getFileName).toHaveBeenCalledWith(c.value),expect(this.component.getFileHandle).toHaveBeenCalledWith(c),expect(this.component.gotFileHandle).toHaveBeenCalledWith(a,b)}),it("should not call gotFileHandle if the image is not valid",function(){spyOn(this.component,"validateImage").andReturn(!1),this.component.imageSelected(),expect(this.component.getFileName).toHaveBeenCalledWith(c.value),expect(this.component.getFileHandle).toHaveBeenCalledWith(c),expect(this.component.gotFileHandle).not.toHaveBeenCalled()})}),describe("validateImage()",function(){var a,b;beforeEach(function(){a="lolcat.jpg",b="FILEHANDLE",this.component.addFileError=function(){},spyOn(this.component,"addFileError")}),it("should add notImage error if validateFileName fails",function(){spyOn(this.component,"validateFileName").andReturn(!1),this.component.validateImage(a,b),expect(this.component.addFileError).toHaveBeenCalledWith("notImage")}),it("should add a tooLarge image if validateFileSize fails",function(){spyOn(this.component,"validateFileName").andReturn(!0),spyOn(this.component,"validateImageSize").andReturn(!1),this.component.validateImage(a,b),expect(this.component.addFileError).toHaveBeenCalledWith("tooLarge")}),it("should return true if both validations succeed",function(){spyOn(this.component,"validateFileName").andReturn(!0),spyOn(this.component,"validateImageSize").andReturn(!0),expect(this.component.validateImage(a,b)).toBeTruthy()})})})
});
define("test/app/ui/with_loading_indicator_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_loading_indicator",function(){beforeEach(function(){var a='<div class="container"><div class="loady-thingy"></div></div>';setupComponent(a,{spinnerContainer:".loady-thingy"})}),describe("#showSpinner",function(){it("adds spinner class to the spinner container",function(){this.component.showSpinner(),expect(this.component.select("spinnerContainer")).toHaveClass(this.component.attr.spinnerClass)})}),describe("#hideSpinner",function(){it("removes spinner class from the spinner container",function(){this.component.hideSpinner(),expect(this.component.select("spinnerContainer")).not.toHaveClass(this.component.attr.spinnerClass)})})})
});
define("test/app/ui/tweet_injector_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/tweet_injector",function(){describe("on dataTweetSuccess",function(){describe("when there is no 'view more' link",function(){beforeEach(function(){var a='<div class="replies-to">\n            <div class="tweets-wrapper">\n              <ol>\n                <li id="tweet1"><div class="tweet"></div></li>\n              </ol>\n            </div>\n          </div>\n        ';setupComponent(a)}),it("appends the tweet to the tweets container if the guard evaluates to true",function(){this.component.attr.guard=function(){return!0},this.component.trigger("dataTweetSuccess",{tweet_html:'<li id="tweet2"><div class="tweet"></div></li>'}),expect(this.component.$node.children().index($("#tweet2"))).toEqual(1)}),it("adds the class specified by the descendantClass attribute",function(){this.component.attr.guard=function(){return!0},this.component.trigger("dataTweetSuccess",{tweet_html:'<li id="tweet3"><div class="tweet"></div></li>'}),expect($("#tweet3").find(this.component.attr.tweetSelector)).toHaveClass(this.component.attr.descendantClass)}),it("triggers 'uiTweetInserted' on the newly inserted Tweet",function(){this.component.attr.guard=function(){return!0};var a;this.component.on("uiTweetInserted",function(b){a=b.target}),this.component.trigger("dataTweetSuccess",{tweet_html:'<li id="tweet3"><div class="tweet"></div></li>'}),expect(a).toBe($("#tweet3")[0])}),it("sets the 'data-component-context' HTML attribute to the value specified by the descendantScribeContext attribute",function(){this.component.attr.guard=function(){return!0},this.component.trigger("dataTweetSuccess",{tweet_html:'<li id="tweet4"><div class="tweet"></div></li>'}),expect($("#tweet4").find(this.component.attr.tweetSelector).attr("data-component-context")).toEqual(this.component.attr.descendantScribeContext)}),it("does not append the tweet to the tweets container if the guard evaluates to false",function(){this.component.attr.guard=function(){return!1},this.component.trigger("dataTweetSuccess",{tweet_html:'<li id="tweet5"><div class="tweet"></div></li>'}),expect(this.$node.find("#tweet5")).not.toExist()})}),describe("if there is a 'view more' link",function(){beforeEach(function(){var a='<div class="replies-to">\n            <div class="tweets-wrapper">\n              <ol>\n                <li id="tweet1"><div class="tweet"></div></li>\n                <li><div class="view-more-container"></div></li>\n              </ol>\n            </div>\n          </div>\n        ';setupComponent(a)}),it("appends the new tweet before the 'view more' link",function(){this.component.attr.guard=function(){return!0},this.component.trigger("dataTweetSuccess",{tweet_html:'<li id="tweet2"><div class="tweet"></div></li>'}),expect(this.component.$node.find("ol").children().index($("#tweet2"))).toEqual(1)})})})})
});
define("test/app/ui/dashboard_tweetbox_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dashboard_tweetbox",function(){var a='<div class="profile-tweet-box" data-screen-name="chatty">\n    <form class="tweet-form" method="post" target="tweet-post-iframe" action="/i/tweet/create_with_media.iframe" enctype="multipart/form-data"></form>\n  </div>\n\n  ';beforeEach(function(){setupComponent(a)}),describe("#getText",function(){it('gets the string in "data-screen-name" attribute',function(){expect(this.component.getText()).toMatch("chatty")})}),describe("#getDefaultText",function(){it("gets the screen name with @ prepended",function(){expect(this.component.getDefaultText()).toMatch("@chatty")})}),describe("#getCondensedText",function(){it("gets the screen name with @ prepended",function(){expect(this.component.getCondensedText()).toMatch("@chatty")})}),it("calls initTweetbox after initialize",function(){spyOnEvent(document,"uiInitTweetbox"),setupComponent(a),expect("uiInitTweetbox").toHaveBeenTriggeredOnAndWith(document,{condensable:!0,condensedText:"@chatty",defaultText:"@chatty "})})})
});
define("test/app/ui/page_title_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/page_title",function(){var a=document.title;beforeEach(setupComponent),afterEach(function(){document.title=a}),it("sets the page title on uiAddPageCount",function(){this.component.trigger("uiAddPageCount",{count:3}),expect(document.title).toContain("(3)")}),it("sets the page title on uiBeforePageChanged",function(){this.component.trigger("uiBeforePageChanged",{title:"boo"}),expect(document.title).toContain("boo")}),it("sets the page title on uiRemovePageCount",function(){this.component.trigger("uiAddPageCount",{count:3}),this.component.trigger("uiHasInjectedNewTimeline"),expect(document.title).not.toContain("(3)")})})
});
define("test/app/ui/with_tweet_actions_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_tweet_actions",function(){var a='<ul class=\'js-actions\'>\n\n      <li class="action-reply-container">\n        <a class="with-icn js-action-reply" data-modal="tweet-reply" href="#">\n          <span class="icon sm-reply"></span>\n          <b>Reply</b>\n        </a>\n      </li>\n\n      <li class="action-rt-container js-toggle-state js-toggle-rt">\n        <a class="with-icn retweet" data-modal="tweet-retweet" href="#">\n          <span class="icon sm-rt"></span>\n          <b>Retweet</b>\n        </a>\n        <a class="with-icn undo-retweet" data-modal="tweet-retweet" href="#" title="Undo retweet">\n          <span class="icon sm-rt"></span>\n          <b>Retweeted</b>\n        </a>\n      </li>\n\n      <li class="action-del-container">\n        <a class="with-icn js-action-del" href="#">\n          <span class="icon sm-trash"></span>\n          <b>Delete</b>\n        </a>\n      </li>\n\n      <li class="action-fav-container js-toggle-state js-toggle-fav">\n        <a class="with-icn favorite" href="#">\n          <span class="icon sm-fav"></span>\n          <b>Favorite</b>\n        </a>\n        <a class="with-icn unfavorite" href="#" title="Undo favorite">\n          <span class="icon sm-fav"></span>\n          <b>Favorited</b>\n        </a>\n      </li>\n\n      <li class="more-tweet-actions">\n        <div class="action-more-container">\n          <div class="dropdown">\n            <button type="button" class="btn-link with-icn dropdown-toggle js-tooltip" data-delay="200" data-original-title="More">\n              <i class="icon sm-more"></i>\n              <b>More</b>\n            </button>\n            <ul class="dropdown-menu">\n              <li class="dropdown-caret">\n                <span class="caret-outer"></span>\n                <span class="caret-inner"></span>\n              </li>\n              <li class="share-via-email">\n                <a class="js-share-via-email" href="#" data-nav="share_tweet">Share via email</a>\n              </li>\n              <li class="embed-link">\n                <a class="js-embed-tweet" href="#" data-nav="embed_tweet">Embed Tweet</a>\n              </li>\n              <li>\n                <a class="user-pin-tweet js-toggle-user-pin-tweet" href="#" data-nav="user_pin_tweet">Pin to your profile page</a>\n                <a class="user-unpin-tweet js-toggle-user-pin-tweet" href="#" data-nav="user_unpin_tweet">Unpin from profile page</a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </li>\n\n    </ul>\n    <button class=\'js-action-dismiss\'>X</button>\n  ',b=function(b){var d="";return b.replies&&b.replies.forEach(function(a){d+=c(a)}),"    <li class='js-stream-item' data-item-id='"+b.id+"'>      <div class='tweet' "+(b.mentions?"data-mentions='"+b.mentions.join(" ")+"' ":"")+"data-tweet-id='"+b.id+"' data-impression-id='"+b.impressionId+"' data-screen-name='username' data-disclosure-type='promoted'>"+a+"</div>      <div class='replies'>"+d+"</div>    </li>"},c=function(b){return"    <div class='tweet simple-tweet' data-tweet-id='"+b.id+"' data-impression-id='"+b.impressionId+"' data-screen-name='username' data-disclosure-type='promoted'>"+a+"</div>"},d=[{id:42,impressionId:30,replies:[{id:43,impressionId:31}]},{id:43,impressionId:32,mentions:["anotherusername","andanotherone","loggedinuser"]},{id:44,impressionId:33,mentions:["anotherusername","andanotherone","loggedinuser"]}],e,f,g,h,i,j,k;beforeEach(function(){var a="";d.forEach(function(c){a+=b(c)}),setupComponent("<div id='#timeline'>"+a+"</div>",{genericItemSelector:".js-stream-item",loggedIn:!0,screenName:"loggedinuser",itemType:"tweet"}),e=this.$node.find(".tweet:first"),f=e.find(".js-action-reply"),g=e.find(".js-toggle-rt .retweet"),$undoRetweetLink=e.find(".js-toggle-rt .undo-retweet"),h=e.find(".js-action-del"),i=e.find(".js-toggle-fav .favorite"),$unfavoriteLink=e.find(".js-toggle-fav .unfavorite"),j=e.find(".js-action-dismiss"),k=this.$node.find(".tweet[data-tweet-id='43']:not(.simple-tweet)"),jasmine.Clock.useMock(),jQuery.fx.off=!0}),describe("getTweetData behavior",function(){it("marks data.isTweetProof as true if 'data-is-tweet-proof' is set to 'true'",function(){e.attr("data-is-tweet-proof","true");var a=this.component.getTweetData(e);expect(a.isTweetProof).toEqual(!0)}),it("marks data.isTweetProof as false if 'data-is-tweet-proof' is not set to 'true'",function(){var a=this.component.getTweetData(e);expect(a.isTweetProof).toEqual(!1)}),it("marks data.viewerFollowsAuthor as true if 'data-you-follow' is set to 'true'",function(){e.attr("data-you-follow","true");var a=this.component.getTweetData(e);expect(a.viewerFollowsAuthor).toEqual(!0)}),it("marks data.viewerFollowsAuthor as false if 'data-you-follow' is not set to 'true'",function(){var a=this.component.getTweetData(e);expect(a.viewerFollowsAuthor).toEqual(!1)}),it("marks data.viewerBlocksAuthor as true if 'data-you-block' is set to 'true'",function(){e.attr("data-you-block","true");var a=this.component.getTweetData(e);expect(a.viewerBlocksAuthor).toEqual(!0)}),it("marks data.viewerBlocksAuthor as false if 'data-you-block' is not set to 'true'",function(){var a=this.component.getTweetData(e);expect(a.viewerBlocksAuthor).toEqual(!1)})}),describe("When the user favorites a Tweet",function(){describe("and the target of the event is a descendent of the component's node",function(){it("triggers the 'uiDidFavoriteTweet' event",function(){spyOnEvent(e,"uiDidFavoriteTweet"),this.component.trigger(e.closest(".js-stream-item"),"uiDidFavoriteTweetToggle"),expect("uiDidFavoriteTweet").toHaveBeenTriggeredOnAndWith(e,this.component.getTweetData(e))})}),describe("and the target of the event is not a descendent of the component's node",function(){it("does not trigger the 'uiDidFavoriteTweet' event",function(){spyOnEvent(e,"uiDidFavoriteTweet"),this.component.trigger(document,"uiDidFavoriteTweetToggle"),expect("uiDidFavoriteTweet").not.toHaveBeenTriggeredOnAndWith(e,this.component.getTweetData(e))})})}),describe("click on favorite link",function(){it("triggers uiDidFavoriteTweet when the tweet is unfavorited",function(){spyOnEvent(e,"uiDidFavoriteTweet"),i.trigger("click"),expect("uiDidFavoriteTweet").toHaveBeenTriggeredOnAndWith(e,this.component.getTweetData(e))}),it("triggers uiDidUnfavoriteTweet when the tweet is favorited",function(){spyOnEvent(this.$node,"uiDidUnfavoriteTweet"),e.addClass("favorited"),i.trigger("click"),expect("uiDidUnfavoriteTweet").toHaveBeenTriggeredOnAndWith(this.$node,this.component.getTweetData(e))}),it("updates attributes on uiDidFavoriteTweet event",function(){e.data("favorite-state","unfavorited"),this.component.trigger("uiDidFavoriteTweet",this.component.getTweetData(e)),expect(e).toHaveClass("favorited")}),it("does not focus the undo favorite link if the favorite link did not have focus",function(){this.component.trigger("uiDidFavoriteTweet",this.component.getTweetData(e)),expect($unfavoriteLink).not.toBeFocused()}),it("focuses the undo favorite link if the favorite link had focus",function(){i.focus(),this.component.trigger("uiDidFavoriteTweet",this.component.getTweetData(e)),expect($unfavoriteLink).toBeFocused()}),it("updates attributes on uiDidUnfavoriteTweet event",function(){e.addClass("favorited"),this.component.trigger("uiDidUnfavoriteTweet",this.component.getTweetData(e)),expect(e).not.toHaveClass("favorited")}),it("updates attributes on dataFailedToFavoriteTweet event",function(){e.addClass("favorited"),this.component.trigger("dataFailedToFavoriteTweet",this.component.getTweetData(e)),expect(e).not.toHaveClass("favorited")}),it("updates attributes on dataFailedToUnfavoriteTweet event",function(){this.component.trigger("dataFailedToUnfavoriteTweet",{sourceEventData:this.component.getTweetData(e)}),expect(e).toHaveClass("favorited")})}),describe("click on retweet link",function(){it("triggers uiOpenRetweetDialog when the tweet is unretweeted",function(){spyOnEvent(this.$node,"uiOpenRetweetDialog"),g.trigger("click"),expect("uiOpenRetweetDialog").toHaveBeenTriggeredOnAndWith(this.$node,this.component.getTweetData(e))}),it("triggers uiDidUnretweet when the tweet is retweeted",function(){spyOnEvent(this.$node,"uiDidUnretweet"),e.addClass("retweeted"),g.trigger("click"),expect("uiDidUnretweet").toHaveBeenTriggeredOnAndWith(this.$node,this.component.getTweetData(e))}),it("updates attributes on uiDidRetweet event",function(){this.component.trigger("uiDidRetweet",{id:"42"}),expect(e).toHaveClass("retweeted")}),it("does not focus the undo retweet link if the retweet link did not have focus",function(){this.component.trigger("uiDidRetweet",{id:"42"}),expect($undoRetweetLink).not.toBeFocused()}),it("focuses the undo retweet link if the retweet link had focus",function(){g.focus(),this.component.trigger("uiDidRetweet",{id:"42"}),expect($undoRetweetLink).toBeFocused()}),it("updates attributes on uiDidUnretweet event",function(){e.addClass("retweeted"),this.component.trigger("uiDidUnretweet",{id:"42"}),expect(e).not.toHaveClass("retweeted")}),it("updates attributes on dataFailedToRetweet event",function(){e.addClass("retweeted"),this.component.trigger("dataFailedToRetweet",{id:"42"}),expect(e).not.toHaveClass("retweeted")}),it("updates attributes on dataFailedToUnretweet event",function(){this.component.trigger("dataFailedToUnretweet",{tweetId:"42",isReplyTo:!1,impressionId:"30",disclosureType:"promoted",position:0,isMentionClick:!1,profileClickTarget:"screen_name",id:"42",screenName:"username",screenNames:["username"]}),expect(e).toHaveClass("retweeted")})}),describe("click on reply link",function(){it("extracts correct attributes from tweet",function(){var a=this.component.getTweetData(e);expect(a).toEqual({scribeContext:{},scribeData:{},tweetId:"42",isReplyTo:!1,impressionId:"30",disclosureType:"promoted",position:0,isMentionClick:!1,itemType:"tweet",profileClickTarget:"screen_name",id:"42",screenName:"username",screenNames:["username"],isPromotedBadgeClick:!1,isTweetProof:!1,viewerFollowsAuthor:!1,viewerBlocksAuthor:!1})}),it("extracts correct attributes from other tweet, and don't include loggedinuser in screenNames",function(){var a=this.component.getTweetData(k);expect(a).toEqual({scribeContext:{},scribeData:{},tweetId:"43",isReplyTo:!1,impressionId:"32",disclosureType:"promoted",position:1,isMentionClick:!1,itemType:"tweet",profileClickTarget:"screen_name",id:"43",screenName:"username",screenNames:["username","anotherusername","andanotherone"],isPromotedBadgeClick:!1,isTweetProof:!1,viewerFollowsAuthor:!1,viewerBlocksAuthor:!1})}),it("triggers expandTweetByReply",function(){spyOnEvent(e,"expandTweetByReply"),f.trigger("click"),expect("expandTweetByReply").toHaveBeenTriggeredOn(e)}),it("triggers expandTweetByReply",function(){e.addClass("simple-tweet"),spyOnEvent(this.$node,"uiOpenReplyDialog"),f.trigger("click");var a=this.component.getTweetData(e);a.replyLinkClick=!0,expect("uiOpenReplyDialog").toHaveBeenTriggeredOnAndWith(this.$node,a)})}),describe("click on delete link",function(){it("triggers uiOpenDeleteDialog",function(){spyOnEvent(this.$node,"uiOpenDeleteDialog"),h.trigger("click"),expect("uiOpenDeleteDialog").toHaveBeenTriggeredOnAndWith(this.$node,this.component.getTweetData(e))}),describe("when slideUpTweetOnRemove is false",function(){it("keeps the tweet visible before and after uiDidDeleteTweet",function(){expect(this.$node.find(".tweet[data-tweet-id='43']")).toBeVisible(),this.component.trigger("uiDidDeleteTweet",{id:43}),expect(this.$node.find(".tweet[data-tweet-id='43']")).toBeVisible()}),it("do not trigger uiCloseDeleteTweetDialog after uiDidDeleteTweet",function(){spyOnEvent(this.$node,"uiCloseDeleteTweetDialog"),this.component.trigger("uiDidDeleteTweet",{id:43}),expect("uiCloseDeleteTweetDialog").not.toHaveBeenTriggeredOn(this.$node)}),it("keeps the tweet in the same state before and after dataFailedToDeleteTweet",function(){var a=this.$node.find(".tweet[data-tweet-id='43']"),b=this.$node.find(".tweet[data-tweet-id='44']");b.hide(),expect(a).toBeVisible(),expect(b).toBeHidden(),this.component.trigger("dataFailedToDeleteTweet",{sourceEventData:{id:43}}),this.component.trigger("dataFailedToDeleteTweet",{sourceEventData:{id:44}}),expect(a).toBeVisible(),expect(b).toBeHidden()})}),describe("when slideUpTweetOnRemove is true",function(){beforeEach(function(){this.component.attr.slideUpTweetOnRemove=!0}),it("hides the tweet after uiDidDeleteTweet",function(){expect(this.$node.find(".tweet[data-tweet-id='43']")).toBeVisible(),this.component.trigger("uiDidDeleteTweet",{id:43}),expect(this.$node.find(".tweet[data-tweet-id='43']")).toBeHidden()}),it("triggers uiCloseDeleteTweetDialog after uiDidDeleteTweet",function(){spyOnEvent(this.$node,"uiCloseDeleteTweetDialog"),this.component.trigger("uiDidDeleteTweet",{id:43}),expect("uiCloseDeleteTweetDialog").toHaveBeenTriggeredOn(this.$node)}),it("shows the hidden tweet after dataFailedToDeleteTweet",function(){var a=this.$node.find(".tweet[data-tweet-id='43']"),b=this.$node.find(".tweet[data-tweet-id='44']");b.hide(),expect(a).toBeVisible(),expect(b).toBeHidden(),this.component.trigger("dataFailedToDeleteTweet",{sourceEventData:{id:43}}),this.component.trigger("dataFailedToDeleteTweet",{sourceEventData:{id:44}}),expect(a).toBeVisible(),expect(b).toBeVisible()})}),it("deletes tweet on dataDidDeleteTweet event",function(){expect(this.$node.find(".tweet[data-tweet-id='43']").length).toEqual(2),this.component.trigger("dataDidDeleteTweet",{sourceEventData:{id:43}}),expect(this.$node.find(".tweet[data-tweet-id='43']").length).toEqual(0)}),describe("and the Tweet is a permalink Tweet",function(){it("does not trigger the 'uiBeforeTweetRemoved' event",function(){e.addClass(this.component.attr.permalinkTweetClass),spyOnEvent(e,"uiBeforeTweetRemoved"),this.component.trigger("dataDidDeleteTweet",{sourceEventData:{id:43}}),expect("uiBeforeTweetRemoved").not.toHaveBeenTriggeredOnAndWith(e,{sourceEventData:{id:43}})})})}),describe("Before a Tweet is deleted",function(){it("triggers the 'uiBeforeTweetRemoved' event on the Tweet",function(){var a=this.component.$node.find("div[data-tweet-id=43]");spyOnEvent(a,"uiBeforeTweetRemoved"),this.component.trigger("dataDidDeleteTweet",{sourceEventData:{id:43}}),expect("uiBeforeTweetRemoved").toHaveBeenTriggeredOnAndWith(a,{sourceEventData:{id:43}})})}),describe("click on dismiss link",function(){beforeEach(function(){spyOnEvent(this.$node,"uiTweetDismissed"),j.trigger("click")}),it("triggers uiTweetDismissed with the impression id",function(){var a=this.component.getTweetData(e);expect(a.impressionId).toEqual("30"),a.position=0,expect("uiTweetDismissed").toHaveBeenTriggeredOnAndWith(this.$node,a)}),it("removes the tweet after the dismiss button is clicked",function(){jasmine.Clock.tick(300),expect(this.$node.find(".tweet[data-tweet-id='42']").length).toEqual(0)}),it("stamps the tweet with a class to indicate it has been dismissed",function(){expect(j.closest(".js-stream-item")).toHaveClass(this.component.attr.dismissedTweetClass)})}),describe("when the user navigates to a new page via pushstate",function(){it("removes all dismissed tweets from the page",function(){j.closest(".js-stream-item").addClass(this.component.attr.dismissedTweetClass),$(document).trigger("uiBeforePageChanged"),expect(this.$node.find(".tweet[data-tweet-id='42']").length).toEqual(0)})}),describe("click on more Tweet actions",function(){var a;beforeEach(function(){spyOnEvent(e,"uiOpenConfirmDialog"),e.find(".more-tweet-actions .dropdown-toggle").click(),a={sourceEventData:{id:this.component.getTweetData(e).id},message:"Success"}}),describe("click on pin Tweet from an unpinned tweet",function(){beforeEach(function(){spyOnEvent(e,"uiNeedUserPinTweetConfirm"),e.find(".js-toggle-user-pin-tweet.user-pin-tweet").click()}),it("triggers uiNeedUserPinTweetConfirm",function(){expect("uiNeedUserPinTweetConfirm").toHaveBeenTriggeredOn(e)}),it("triggers uiOpenConfirmDialog",function(){expect("uiOpenConfirmDialog").toHaveBeenTriggeredOnAndWith(e,{titleText:"Pin this Tweet to the top of your profile",bodyText:"This will replace any previously pinned Tweet. Are you sure?",cancelText:"Cancel",submitText:"Pin",action:"UserPinTweetToggle"})}),describe("when user confirms pin from dialog",function(){beforeEach(function(){spyOnEvent(e,"uiDidUserPinTweet"),k.addClass("user-pinned"),this.component.trigger(e,"uiUserPinTweetToggleConfirm")}),it("triggers uiDidUserPinTweet on Tweet",function(){expect("uiDidUserPinTweet").toHaveBeenTriggeredOn(e)}),it("adds user-pinned class on Tweet",function(){expect(e).toHaveClass("user-pinned")}),describe("on dataDidUserPinTweet event",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowStickyMessage"),this.component.trigger("dataDidUserPinTweet",a)}),it("shows message",function(){expect("uiShowStickyMessage").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Success"})}),it("unpins previously pinned tweet",function(){expect(k).not.toHaveClass("user-pinned")})}),describe("on dataFailedToUserPinTweet event",function(){it("removes user-pinned class",function(){this.component.trigger(document,"dataFailedToUserPinTweet",a),expect(e).not.toHaveClass("user-pinned")})})})}),describe("click on unpin Tweet from a pinned tweet",function(){beforeEach(function(){spyOnEvent(e,"uiNeedUserUnpinTweetConfirm"),e.addClass("user-pinned").find(".js-toggle-user-pin-tweet.user-unpin-tweet").click()}),it("triggers uiNeedUserUnpinTweetConfirm",function(){expect("uiNeedUserUnpinTweetConfirm").toHaveBeenTriggeredOn(e)}),it("triggers uiOpenConfirmDialog",function(){expect("uiOpenConfirmDialog").toHaveBeenTriggeredOnAndWith(e,{titleText:"Unpin this Tweet from your profile",bodyText:"Are you sure?",cancelText:"Cancel",submitText:"Unpin",action:"UserPinTweetToggle"})}),describe("when user confirms unpin from dialog",function(){beforeEach(function(){spyOnEvent(e,"uiDidUserUnpinTweet"),this.component.trigger(e,"uiUserPinTweetToggleConfirm")}),it("triggers uiDidUserUnpinTweet on Tweet",function(){expect("uiDidUserUnpinTweet").toHaveBeenTriggeredOn(e)}),it("removes user-pinned class",function(){expect(e).not.toHaveClass("user-pinned")}),describe("on dataDidUserUnpinTweet event",function(){it("shows message",function(){spyOnEvent(this.$node,"uiShowStickyMessage"),this.component.trigger(document,"dataDidUserUnpinTweet",a),expect("uiShowStickyMessage").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Success"})})}),describe("on dataFailedToUserUnpinTweet event",function(){it("adds back user-pinned class",function(){this.component.trigger(document,"dataFailedToUserUnpinTweet",a),expect(e).toHaveClass("user-pinned")})})})})})})
});
define("test/app/ui/design_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/design",{fixture:"test/fixtures/settings_design_page"},function(){beforeEach(function(){setupComponent(this.fixture)}),describe("blur on #background_color_hex",function(){it("triggers uiThemeChanged event",function(){$("#background_color_hex").attr("value","#cacaca"),spyOnEvent(this.$node,"uiThemeChanged"),$("#background_color_hex").trigger("blur"),expect("uiThemeChanged").toHaveBeenTriggeredOnAndWith(this.$node,{backgroundColor:"#cacaca"})}),it("sets color preview",function(){$("#background_color_hex").val("#0000ff"),$("#background_color_hex").trigger("blur"),expect($("#background_color")).toHaveCss("background-color","rgb(0, 0, 255)")})}),describe("event uiThemePicked",function(){it("updates preview colors and color inputs and hidden values",function(){this.component.trigger("uiThemePicked",{id:4,backgroundColor:"#0000ff",linkColor:"#00ff00",image:"test.png",tiled:!0}),expect($("#background_color")).toHaveCss("background-color","rgb(0, 0, 255)"),expect($("#links_color")).toHaveCss("background-color","rgb(0, 255, 0)"),expect($("#background_color_hex")).toHaveValue("#0000ff"),expect($("#links_color_hex")).toHaveValue("#00ff00"),expect($("#background_image_preview")).toHaveCss("background-image",/test\.png/),expect($("#user_profile_default")).toHaveValue("true")})}),describe("event fileUploaded",function(){it("sets the default theme to false",function(){expect($("#user_profile_default").val()).toBe(""),this.component.trigger("fileUploaded"),expect($("#user_profile_default")).toHaveValue("false")})})})
});
define("test/app/ui/login_verification_confirmation_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/login_verification_confirmation_dialog",function(){beforeEach(function(){var a='<div id="login_verification_confirmation_dialog" class="modal-container" style="display:none;">\n        <div class="close-modal-background-target"></div>\n        <div class="modal modal-medium draggable visuallyhidden">\n          <div class="modal-content">\n            <button type="button" class="modal-btn modal-close js-close"><i class="close-medium"><span class="visuallyhidden">Close</span></i></button>      <div class="modal-header">\n              <h3 class="modal-title pre-send">May we send you a test message?</h3>\n              <h3 class="modal-title post-send visuallyhidden">Did you receive our message?</h3>\n            </div>\n            <div class="modal-body">\n              <div class="pre-send">\n                We\'d like to send you a message to make sure your current phone will work with login verification, may we?\n              </div>\n              <div class="post-send visuallyhidden">\n                We\'ve sent a message your way confirming you have enrolled in login verification.  If you did *not* receive this message something may be broken and we recommend you unenroll and check out this article\n              </div>\n            </div>\n            <div class="modal-footer">\n              <a class="btn primary-btn send_message_action pre-send">Sure, send me a message</a>\n              <div id="login_verification_test_sms_spinner" class="preview-spinner visuallyhidden">foo</div>\n              <div class="post-send visuallyhidden">\n                <a class="btn fix_action">No, fix it</a>\n                <a class="btn primary-btn save_action">Yes, save changes</a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("should replace the button with a spinner when send message is clicked",function(){this.component.select("sendMessageSelector").trigger("click"),expect(this.component.select("sendMessageSelector")).toHaveClass("visuallyhidden"),expect(this.component.select("spinnerSelector")).not.toHaveClass("visuallyhidden")}),it("should hide the spinner when the message send call succeeds",function(){this.component.select("spinnerSelector").show(),$(document).trigger("dataSendTestSmsSuccess"),expect(this.component.select("fixitSelector")).not.toHaveClass("visuallyhidden"),expect(this.component.select("spinnerSelector")).toHaveClass("visuallyhidden")}),it("should hide the spinner and bring back the send button button when the message send call fails",function(){this.component.select("spinnerSelector").show(),this.component.select("sendMessageSelector").hide(),$(document).trigger("dataSendTestSmsError"),expect(this.component.select("sendMessageSelector")).not.toHaveClass("visuallyhidden"),expect(this.component.select("spinnerSelector")).toHaveClass("visuallyhidden")}),it("should show an error on message send failure",function(){spyOnEvent(this.component.$node,"uiShowError"),$(document).trigger("dataSendTestSmsError"),expect("uiShowError").toHaveBeenTriggeredOn(this.component.$node)}),it("should check the checkbox on save button clicked",function(){$(document).trigger("uiOpenLoginVerificationConfirmationDialog"),spyOnEvent(this.component.$node,"uiCheckLoginVerification"),this.component.select("saveSelector").trigger("click"),expect("uiCheckLoginVerification").toHaveBeenTriggeredOn(this.component.$node)}),it("should open the password dialog on save button clicked",function(){$(document).trigger("uiOpenLoginVerificationConfirmationDialog"),spyOnEvent(this.component.$node,"uiSubmitSettings"),this.component.select("saveSelector").trigger("click"),expect("uiSubmitSettings").toHaveBeenTriggeredOn(this.component.$node)}),it("fixit should redirect to devices page",function(){$(document).trigger("uiOpenLoginVerificationConfirmationDialog"),this.component.redirectToDevices=function(){expect(!0).toBe(!0)},this.component.select("fixitSelector").trigger("click")})})
});
define("test/app/ui/with_interaction_data_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_interaction_data",function(){function b(a,c){var d="",e="",f="";c=c||"",a.replies&&(d+='<div class="replies-to" data-component-context="replies">',a.replies.forEach(function(a){d+=b(a,"simple-tweet")}),d+="</div>"),a.conversation&&(e+='<div class="in-reply-to js-tweet-ancestors" data-component-context="conversation">',a.conversation.forEach(function(a){e+=b(a,"simple-tweet")}),e+="</div>");var g=c?"":' data-component-context="retweet_activity"';return f='<div class="js-stream-item stream-item" data-item-type="tweet" data-item-id="'+(a.tweetId||"")+'"'+g+">"+e+'<div class="tweet original-tweet js-stream-tweet '+c+'" data-user-id="'+(a.userId||"")+'"               data-item-id="'+(a.tweetId||"")+'" data-tweet-id="'+(a.tweetId||"")+'" data-associated-tweet-id="'+(a.tweetId||"")+'"              data-impression-id="'+(a.impressionId||"")+'" data-feedback-token="'+(a.feedbackToken||"")+'"               data-activity-type="retweet" data-story-type="news" data-story-token="retweets">                <div class"content">                  <div class="js-tweet-text">Lorem ipsum</div>                  <div class="js-action-profile-avatar"><img/></div>                  <span class="twitter-atreply">@mrtall</span>                </div>              </div>'+d+"</div>",f}function c(){var c='<div class="stream"><div class="stream-items">';return a.forEach(function(a){c+=b(a)}),c+="</div></div>",c}var a=[{tweetId:1001,userId:101,impressionId:"a"},{tweetId:1002,userId:102},{tweetId:1003,userId:103},{tweetId:1004,userId:104,replies:[{tweetId:2001,userId:201},{tweetId:2002,userId:202},{tweetId:2003,userId:203}],conversation:[{tweetId:3001,userId:301},{tweetId:3002,userId:302},{tweetId:3003,userId:303}]},{tweetId:1005,userId:105,feedbackToken:"feedback"},{tweetId:1006,userId:106},{tweetId:1007,userId:107},{tweetId:1008,userId:108,impressionId:"b"},{tweetId:1009,userId:109},{tweetId:1010,userId:110}];beforeEach(function(){setupComponent(c(),{genericItemSelector:".js-stream-item"})}),describe("getScribeContext method",function(){it("returns the correct context for various types of stream items",function(){this.component.attr.itemType="tweet";var a=this.$node.find("[data-tweet-id=2001] .js-tweet-text"),b=this.component.getScribeContext(a,{});expect(b).toEqual({component:"replies"}),a=this.$node.find("[data-tweet-id=3001] .js-tweet-text"),b=this.component.getScribeContext(a,{}),expect(b).toEqual({component:"conversation"}),a=this.$node.find(".stream-items"),b=this.component.getScribeContext(a,{}),expect(b).toBeUndefined(),this.component.attr.itemType="user",b=this.component.getScribeContext(a,{}),expect(b).toBeUndefined(),this.component.attr.itemType="activity",a=this.$node.find("[data-tweet-id=1002] .js-tweet-text"),b=this.component.getScribeContext(a,{activityType:"retweet"}),expect(b).toEqual({component:"retweet_activity"});var a=this.$node.find("[data-tweet-id=2001] .js-tweet-text"),b=this.component.getScribeContext(a,{});expect(b).toEqual({component:"replies"}),a=this.$node.find("[data-tweet-id=3001] .js-tweet-text"),b=this.component.getScribeContext(a,{}),expect(b).toEqual({component:"conversation"}),a=this.$node.find("[data-tweet-id=1002]").addClass("has-cards"),a.wrapInner($('<div class="cards-base" data-card-type="summary" data-element-context="platform_summary_card"/>')),this.component.attr.itemType="foo",a=a.find(".cards-base"),b=this.component.getScribeContext(a,{}),expect(b).toEqual({component:"retweet_activity",element:"platform_summary_card"})})}),describe("getInteractionItemPosition method",function(){it("defaults to the position in the data",function(){var a=this.$node.find("[data-tweet-id=1007] .js-tweet-text"),b=this.component.getInteractionItemPosition(a,{position:42});expect(b).toBe(42)}),it("uses the components getItemPosition method first",function(){var a=this.$node.find("[data-tweet-id=1007] .js-tweet-text");this.component.getItemPosition=function(a){return 42};var b=this.component.getInteractionItemPosition(a);expect(b).toBe(42)}),it("returns the proper position within the stream or the expanded replies or conversation sections",function(){var a=this.$node.find("[data-tweet-id=1007] .js-tweet-text"),b=this.component.getInteractionItemPosition(a);expect(b).toBe(6),a=this.$node.find("[data-tweet-id=2002] .js-tweet-text"),b=this.component.getInteractionItemPosition(a),expect(b).toBe(1),a=this.$node.find("[data-tweet-id=3003] .js-tweet-text"),b=this.component.getInteractionItemPosition(a),expect(b).toBe(2)})}),describe("getEventData method",function(){it("returns the correct eventData hash from the DOM",function(){this.component.attr.itemType="tweet";var a=this.$node.find("[data-tweet-id=1007] .js-tweet-text"),b=this.component.getEventData(a,{});expect(b).toEqual({tweetId:"1007",associatedTweetId:"1007",userId:"107",containerUserId:"107",isMentionClick:!1,itemType:"tweet",feedbackToken:"",impressionId:"",position:6,isReplyTo:!1,profileClickTarget:"screen_name",isPromotedBadgeClick:!1}),a=this.$node.find("[data-tweet-id=1001] .js-action-profile-avatar"),b=this.component.getEventData(a,{}),expect(b).toEqual({tweetId:"1001",associatedTweetId:"1001",userId:"101",containerUserId:"101",isMentionClick:!1,itemType:"tweet",feedbackToken:"",impressionId:"a",position:0,isReplyTo:!1,profileClickTarget:"avatar",isPromotedBadgeClick:!1}),a=this.$node.find("[data-tweet-id=1005] .twitter-atreply"),b=this.component.getEventData(a,{}),expect(b).toEqual({tweetId:"1005",associatedTweetId:"1005",userId:"105",containerUserId:"105",targetUserId:"105",isMentionClick:!0,itemType:"tweet",feedbackToken:"feedback",impressionId:"",position:4,isReplyTo:!1,profileClickTarget:"screen_name",isPromotedBadgeClick:!1}),a=this.$node.find("[data-tweet-id=2002] .twitter-atreply"),b=this.component.getEventData(a,{}),expect(b).toEqual({tweetId:"2002",associatedTweetId:"2002",userId:"202",containerUserId:"202",targetUserId:"202",isMentionClick:!0,itemType:"tweet",feedbackToken:"",impressionId:"",position:1,isReplyTo:!1,profileClickTarget:"screen_name",isPromotedBadgeClick:!1}),a=this.$node.find("[data-tweet-id=1001] .js-action-profile-avatar"),this.component.attr.itemType="user",b=this.component.getEventData(a,{}),expect(b).toEqual({userId:"101",containerUserId:"101",associatedTweetId:"1001",isMentionClick:!1,itemType:"user",feedbackToken:"",impressionId:"a",position:0,isReplyTo:!1,profileClickTarget:"avatar",isPromotedBadgeClick:!1}),a=this.$node.find("[data-tweet-id=1001] .js-action-profile-avatar"),this.component.attr.itemType="activity",b=this.component.getEventData(a,{}),expect(b).toEqual({tweetId:"1001",associatedTweetId:"1001",userId:"101",containerUserId:"101",activityType:"retweet",isMentionClick:!1,itemType:"activity",feedbackToken:"",impressionId:"a",position:0,isReplyTo:!1,profileClickTarget:"avatar",isPromotedBadgeClick:!1,isNetworkActivity:!1})}),it("returns no card data for interactionDataWithCard",function(){var a=this.$node.find("[data-tweet-id=1007] .js-tweet-text");this.component.attr.itemType="tweet",spyOn(this.component,"getCardDataFromTweet").andReturn({}),this.component.interactionDataWithCard(a),expect(this.component.getCardDataFromTweet).toHaveBeenCalled()}),it("returns card data for interactionData",function(){var a=this.$node.find("[data-tweet-id=1007] .js-tweet-text");this.component.attr.itemType="tweet",spyOn(this.component,"getCardDataFromTweet"),this.component.interactionData(a),expect(this.component.getCardDataFromTweet).not.toHaveBeenCalled()})})})
});
define("test/app/ui/page_visibility_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/page_visibility",function(){var a;beforeEach(function(){jasmine.Clock.useMock(),a=$("<div/>")});var b=function(b,c){beforeEach(function(){a[b]=!1,setupComponent({doc:a})}),it("sends uiPageVisible when page is revealed",function(){spyOnEvent(this.$node,"uiPageVisible"),a.trigger(c),expect("uiPageVisible").toHaveBeenTriggeredOn(this.$node)}),it("sends uiPageHidden when page is hidden",function(){a[b]=!0,spyOnEvent(this.$node,"uiPageHidden"),a.trigger(c),expect("uiPageHidden").toHaveBeenTriggeredOn(this.$node)})};describe("when acting like ultra-modern browser",function(){b("hidden","visibilitychange")}),describe("when acting like firefox",function(){b("mozHidden","mozvisibilitychange")}),describe("when acting like webkit",function(){b("webkitHidden","webkitvisibilitychange")}),describe("when acting like modern ms browser",function(){b("msHidden","msvisibilitychange")}),describe("when acting like legacy ms browser",function(){beforeEach(function(){setupComponent({isIe:!0,doc:a})}),it("sends uiPageVisible when page is focused in",function(){spyOnEvent(this.$node,"uiPageVisible"),a.trigger("focusin"),expect("uiPageVisible").toHaveBeenTriggeredOn(this.$node)}),it("sends uiPageHidden when page is focused out",function(){spyOnEvent(this.$node,"uiPageHidden"),a.trigger("focusout"),expect("uiPageHidden").toHaveBeenTriggeredOn(this.$node)})}),describe("when acting like a generic legacy browser",function(){beforeEach(function(){setupComponent({doc:a})}),it("sends uiPageVisible when window is focused",function(){spyOnEvent(this.$node,"uiPageVisible"),$(window).trigger("focus"),expect("uiPageVisible").toHaveBeenTriggeredOn(this.$node)}),it("sends uiPageHidden when window is blurred",function(){spyOnEvent(this.$node,"uiPageHidden"),$(window).trigger("blur"),expect("uiPageHidden").toHaveBeenTriggeredOn(this.$node)}),it("send event when page is unloaded",function(){spyOnEvent(this.$node,"uiPageUnload"),$(window).trigger("beforeunload"),expect("uiPageUnload").toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/profile_image_monitor_dom_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile_image_monitor",function(){beforeEach(function(){var a='<fieldset id="profile-image-controls" class="control-group">';a+='<img src="" id="avatar_preview">',a+='<input id="profile_image_uploaded_data" name="profile_image[uploaded_data]" size="15" type="file">',a+="</fieldset>",setupComponent(a)}),describe("event dataImageProcessingResult",function(){beforeEach(function(){spyOn(this.component,"getKey").andReturn("foo")}),xit("sets the avatar src to empty when the status is processing",function(){this.component.select("avatarSelector").attr("src","image.png"),$(document).trigger("dataImageProcessingResult",{status:"processing"}),expect(this.component.select("avatarSelector")).toHaveAttr("src","")}),xit("sets the avatar src to empty when the status is data:base64",function(){this.component.select("avatarSelector").attr("src","image.png"),$(document).trigger("dataImageProcessingResult",{status:"processing"}),expect(this.component.select("avatarSelector").attr("src")).toBe(""),expect(this.component.select("avatarSelector")).toHaveAttr("src","")})})})
});
define("test/app/ui/dashboard_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dashboard",function(){var a;beforeEach(function(){a=$("<div><div id='testId' class='js-wtf-module'></div></div>")}),describe("#initialize",function(){it("adds a resize handler for the window if initData.freezeDashboard is set",function(){spyOn(this.Component.prototype,"fixDashboard"),setupComponent(a,{freezeDashboard:!0}),$(window).trigger("resize"),expect(this.Component.prototype.fixDashboard).toHaveBeenCalled()}),it("adds a resize handler for the window if initData.freezeDashboard is set",function(){spyOn(this.Component.prototype,"fixDashboard"),setupComponent(a,{freezeDashboard:!1}),$(window).trigger("resize"),expect(this.Component.prototype.fixDashboard).not.toHaveBeenCalled()}),it("adds a scroll handler for the window if initData.freezeDashboard is set",function(){spyOn(this.Component.prototype,"fixDashboard"),setupComponent(a,{freezeDashboard:!1}),$(window).trigger("scroll"),expect(this.Component.prototype.fixDashboard).not.toHaveBeenCalled()}),it("adds a fixDashboard handler when uiDashboardShouldCheckHeight is triggered when freezeDashboard is set",function(){spyOn(this.Component.prototype,"fixDashboard"),setupComponent(a,{freezeDashboard:!0}),$(document).trigger("uiDashboardShouldCheckHeight"),expect(this.Component.prototype.fixDashboard).toHaveBeenCalled()}),it("does not a fixDashboard handler when uiDashboardShouldCheckHeight is triggered",function(){spyOn(this.Component.prototype,"fixDashboard"),setupComponent(a,{freezeDashboard:!1}),$(document).trigger("uiDashboardShouldCheckHeight"),expect(this.Component.prototype.fixDashboard).not.toHaveBeenCalled()})}),describe("#setWtfModule",function(){beforeEach(function(){setupComponent(a)}),it("sets the node if not set",function(){expect(this.component.$wtfModule).toBeUndefined(),this.component.setWtfModule(a),expect(this.component.$wtfModule.attr("id")).toBe("testId")}),it("does not set the node if set",function(){var b=$("<div><div id='nonTestId' class='js-wtf-module'></div></div>");this.component.setWtfModule(a),this.component.setWtfModule(b),expect(this.component.$wtfModule.attr("id")).toBe("testId")})}),describe("#fixDashboardElement",function(){beforeEach(function(){setupComponent(a)}),it("sets fixedDashboard to true",function(){expect(this.component.fixedDashboard).not.toBe(!0),this.component.fixDashboardElement(a,""),expect(this.component.fixedDashboard).toBe(!0)}),it("sets the class on the dashboard",function(){this.component.fixDashboardElement(a,""),expect(a.hasClass(this.component.attr.fixedClass)).toBe(!0)}),it("sets the top position on the element when passed",function(){var b=120;this.component.fixDashboardElement(a,120),expect(a.css("top")).toBe(b+"px")})}),describe("#unfixDashboard",function(){beforeEach(function(){setupComponent(a),a.addClass(this.component.attr.fixedClass)}),it("sets fixedDashboard to false",function(){this.component.fixedDashboard=!0,this.component.unfixDashboard(a),expect(this.component.fixedDashboard).toBe(!1)}),it("unsets the class",function(){this.component.unfixDashboard(a),expect(a.hasClass(this.component.attr.fixedClass)).toBe(!1)}),it("unsets the top position",function(){var b=a.css("top");a.css("top",1250),this.component.unfixDashboard(a),expect(a.css("top")).toBe(b)})}),describe("#fixWholeDashboard",function(){beforeEach(function(){setupComponent(a),this.component.initialDashboardTop=0}),it("fixes the dashboard if the dashboard is taller than the window",function(){var b=jasmine.createSpy();this.component.fixDashboardElement=b;var c=this.component.fixWholeDashboard(a,1e3,100,0);expect(c).toBe(!0),expect(b).toHaveBeenCalledWith(a,"")}),it("unfixes if the dashboard is smaller than the window",function(){var b=jasmine.createSpy();this.component.unfixDashboard=b;var c=this.component.fixWholeDashboard(a,100,1e3,0);expect(c).toBe(!1),expect(b).toHaveBeenCalledWith(a)}),it("does not unfix if you're already scroll down the page",function(){var b=jasmine.createSpy();this.component.unfixDashboard=b;var c=this.component.fixWholeDashboard(a,100,1e3,50);expect(c).toBe(!1),expect(b).not.toHaveBeenCalled()})}),describe("#fixPartialDashboard",function(){beforeEach(function(){setupComponent(a),this.component.initialDashboardTop=0}),it("sets if not fixed, we are scrolled passed, and the wtf module and down will fit",function(){var b=jasmine.createSpy();this.component.fixDashboardElement=b,this.component.initialDashboardTop=54,this.component.topBarHeight=40,this.component.fixPartialDashboard(a,761,782,230,222),expect(b).toHaveBeenCalledWith(a,-123)}),it("does not set if we are already fixed",function(){var b=jasmine.createSpy();this.component.fixDashboardElement=b,this.component.initialDashboardTop=54,this.component.fixedDashboard=!0,this.component.fixPartialDashboard(a,761,782,297,222),expect(b).not.toHaveBeenCalled()}),it("unsets if the partial the dashboard is too bigger than the screen",function(){var b=jasmine.createSpy();this.component.unfixDashboard=b,this.component.fixPartialDashboard(a,761,50,230,222),expect(b).toHaveBeenCalledWith(a)}),it("unset if you are not scrolled passed the wtf module",function(){var b=jasmine.createSpy();this.component.unfixDashboard=b,this.component.fixPartialDashboard(a,761,782,150,222),expect(b).toHaveBeenCalledWith(a)}),it("does not set if you are scrolled further than the wtf module and the dashboard is fixed",function(){var b=jasmine.createSpy(),c=jasmine.createSpy();this.component.fixDashboardElement=b,this.component.unfixDashboard=c,this.component.fixedDashboard=!0,this.component.fixPartialDashboard(a,1e3,500,200,150),expect(b).not.toHaveBeenCalled(),expect(c).not.toHaveBeenCalled()})}),describe("#fixDashboard",function(){beforeEach(function(){setupComponent(a),this.component.setWtfModule(a)}),it("sets the wtf module",function(){this.component.setWtfModule(a);var b=jasmine.createSpy();this.component.setWtfModule=b,this.component.fixDashboard(),expect(b).toHaveBeenCalled()}),it("calls fixWholeDashboard only if fixWholeDashboard returns true",function(){var a=jasmine.createSpy().andReturn(!0),b=jasmine.createSpy();this.component.fixWholeDashboard=a,this.component.fixPartialDashboard=b,this.component.fixDashboard(),expect(a).toHaveBeenCalled(),expect(b).not.toHaveBeenCalled()}),it("calls fixPartialDashboard if fixWholeDashboard returns false",function(){this.component.fixWholeDashboard=function(){return!1};var a=jasmine.createSpy();this.component.fixPartialDashboard=a,this.component.fixDashboard(),expect(a).toHaveBeenCalled()})})})
});
define("test/app/ui/drag_state_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/drag_state",function(){beforeEach(function(){setupComponent("<div>element</div>")}),describe("on uiDragEnter",function(){it("adds draggingClass to node",function(){this.component.trigger("uiDragEnter"),expect(this.component.$node).toHaveClass(this.component.attr.draggingClass)})}),describe("on uiDragLeave",function(){it("removes draggingClass from node",function(){this.component.trigger("uiDragEnter"),expect(this.component.$node).toHaveClass(this.component.attr.draggingClass),this.component.trigger("uiDragLeave"),expect(this.component.$node).not.toHaveClass(this.component.attr.draggingClass)})}),describe("on uiDrop",function(){it("removes draggingClass from node",function(){this.component.trigger("uiDragEnter"),expect(this.component.$node).toHaveClass(this.component.attr.draggingClass),this.component.trigger("uiDrop"),expect(this.component.$node).not.toHaveClass(this.component.attr.draggingClass)})}),describe("when browser has drag and drop support",function(){it("has supportsDraggingClass",function(){expect(this.component.$node).toHaveClass(this.component.attr.supportsDraggingClass)})}),describe("when browser doesn't support drag and drop",function(){beforeEach(function(){var a=$.browser.msie;$.browser.msie=!0,setupComponent("<div>element</div>"),$.browser.msie=a}),it("doesn't have supportsDraggingClass",function(){expect(this.component.$node).not.toHaveClass(this.component.attr.supportsDraggingClass)}),describe("on uiDragEnter",function(){it("doesn't add draggingClass to node",function(){this.component.trigger("uiDragEnter"),expect(this.component.$node).not.toHaveClass(this.component.attr.draggingClass)})})})})
});
define("test/app/ui/inline_edit_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/inline_edit",function(){beforeEach(function(){var a='<div>\n        <label for="user_url" class="placeholder">URL</label>\n        <input type="text" class="editable-field" value="http://current-site.com" id="user_url" maxlength="30">\n        <span type="text" class="profile-field"><a href="http://current-site.com">http://current-site.com</a></span>\n        <span type="text" class="measuring-field" style="display:none; white-space: pre-wrap;"></span>\n      </div>\n    ';setupComponent(a),this.$editableField=this.component.select("editableFieldSelector"),this.$profileField=this.component.select("profileFieldSelector"),this.$measuringField=this.component.select("measuringFieldSelector"),$(document).trigger("uiEditProfileStart")}),describe("on uiEditProfileCancel",function(){it("resets editable field to old text value",function(){this.$editableField.val("http://new-site.com"),expect(this.$editableField).toHaveValue("http://new-site.com"),$(document).trigger("uiEditProfileCancel"),expect(this.$editableField).toHaveValue("http://current-site.com")}),describe("after a failed save",function(){it("resets profile field to original html",function(){this.$editableField.val("not-a-url"),expect(this.$editableField).toHaveValue("not-a-url"),$(document).trigger("uiEditProfileSaveFields"),$(document).trigger("uiEditProfileSave"),expect(this.$profileField).toHaveHtml("not-a-url"),$(document).trigger("uiEditProfileCancel"),expect(this.$profileField).toHaveHtml('<a href="http://current-site.com">http://current-site.com</a>')})})}),describe("on uiEditProfileSaveFields",function(){describe("with a new value",function(){it("should change the profile field",function(){this.$editableField.val("http://new-site.com"),$(document).trigger("uiEditProfileSaveFields"),expect(this.$profileField).toHaveHtml("http://new-site.com")})}),describe("with a new invalid value",function(){it("should change the profile field and reset it on uiShowProfileEditError",function(){this.$editableField.val("http://new-site.com"),$(document).trigger("uiEditProfileSaveFields"),expect(this.$profileField).toHaveHtml("http://new-site.com"),$(document).trigger("uiShowProfileEditError"),expect(this.$profileField).toHaveHtml('<a href="http://current-site.com">http://current-site.com</a>')})}),describe("with the same value",function(){it("should not change the profile field",function(){this.$editableField.val("http://current-site.com"),$(document).trigger("uiEditProfileSaveFields"),expect(this.$profileField).toHaveHtml('<a href="http://current-site.com">http://current-site.com</a>')})})}),describe("on uiNeedsTextPreview",function(){it("should change the profile field",function(){this.$editableField.val("http://new-site.com"),$(document).trigger("uiNeedsTextPreview"),expect(this.$profileField).toHaveHtml("http://new-site.com")})}),describe("text input padding",function(){it("should add padding and resize on focus",function(){var a=this.$editableField.width();this.$editableField.trigger("focus"),expect(this.$editableField.width()).toBeGreaterThan(a)}),it("should remove padding and resize on blur",function(){this.$editableField.trigger("focus");var a=this.$editableField.width();this.$editableField.trigger("blur"),expect(this.$editableField.width()).toBeLessThan(a)})}),describe("sync dimensions",function(){it("uiEditProfileStart should sync dimensions",function(){var a=this.$editableField.width();this.$editableField.val("a"),$(document).trigger("uiEditProfileStart");var b=this.$editableField.width();expect(b).not.toBe(a)}),it("update should sync dimensions",function(){var a=this.$editableField.width();this.$editableField.val("a").trigger("update");var b=this.$editableField.width();expect(b).not.toBe(a)}),it("blur should sync dimensions",function(){var a=this.$editableField.width();this.$editableField.val("a").trigger("blur");var b=this.$editableField.width();expect(b).not.toBe(a)}),it("paste should sync dimensions",function(){var a=this.$editableField.width();this.$editableField.val("a").trigger("paste");var b=this.$editableField.width();expect(b).not.toBe(a)}),it("keyup should sync dimensions",function(){var a=this.$editableField.width();this.$editableField.val("a").trigger("keyup");var b=this.$editableField.width();expect(b).not.toBe(a)})}),it("should use placeholder width when blank",function(){this.$placeholder=this.component.select("placeholderSelector");var a=this.$editableField.val(this.$placeholder.text()).trigger("update").width(),b=this.$editableField.val("a").trigger("update").width();expect(a).not.toBe(b);var c=this.$editableField.val("").trigger("update").width();expect(a).toBe(c)}),it("width resizing should measure whitespace",function(){this.$editableField.val("Bob").trigger("update");var a=this.$editableField.width();this.$editableField.val("Bob ").trigger("update");var b=this.$editableField.width();expect(b).toBeGreaterThan(a)}),it("prevents default on enter key",function(){var a={type:"keydown",keyCode:13,preventDefault:function(){},stopImmediatePropagation:function(){}},b=spyOn(a,"stopImmediatePropagation"),c=spyOn(a,"preventDefault");this.$editableField.trigger(a),expect(b).toHaveBeenCalled(),expect(c).toHaveBeenCalled()}),describe("leading space",function(){it("should prevents default on leading space while empty",function(){var a={type:"keydown",keyCode:32,preventDefault:function(){},stopImmediatePropagation:function(){}},b=spyOn(a,"stopImmediatePropagation"),c=spyOn(a,"preventDefault");this.$editableField.val(""),this.$editableField.trigger(a),expect(b).toHaveBeenCalled(),expect(c).toHaveBeenCalled()}),it("should allow space when non empty",function(){var a={type:"keydown",keyCode:32,preventDefault:function(){},stopImmediatePropagation:function(){}},b=spyOn(a,"stopImmediatePropagation"),c=spyOn(a,"preventDefault");this.$editableField.val("abc"),this.$editableField.trigger(a),expect(b).not.toHaveBeenCalled(),expect(c).not.toHaveBeenCalled()})}),describe("text area",function(){beforeEach(function(){var a='<div>\n          <label class="placeholder" for="user_description">Rocket ship builder, pizza expert, loves the Giants, parent.</label>\n          <textarea class="editable-field" maxlength="160" name="user[description]" id="user_description">my bio</textarea>\n          <p class="bio profile-field">my bio</p>\n          <p class="measuring-field" style="display:none; white-space: pre-wrap;"></p>\n        </div>\n      ';setupComponent(a),this.$editableField=this.component.select("editableFieldSelector"),this.$profileField=this.component.select("profileFieldSelector"),this.$measuringField=this.component.select("measuringFieldSelector")}),it("resizes height",function(){$(document).trigger("uiEditProfileStart"),this.$measuringField.css("display","inline-block"),this.$measuringField.css("width",this.$measuringField.width()),expect(this.$editableField).toHaveAttr("rows",1),this.$editableField.val(this.$editableField.val()+"aaaaa").trigger("update"),expect(this.$editableField).toHaveAttr("rows",2)})}),describe("truncate length",function(){beforeEach(function(){var a='<div>\n          <label for="user_url" class="placeholder">URL</label>\n          <input type="text" class="editable-field" value="http://current-site.com" id="user_url" data-truncate-length="30">\n          <span type="text" class="profile-field"><a href="http://current-site.com">http://current-site.com</a></span>\n          <span type="text" class="measuring-field" style="display:none; white-space: pre-wrap;"></span>\n        </div>\n      ';setupComponent(a),this.$editableField=this.component.select("editableFieldSelector"),this.$profileField=this.component.select("profileFieldSelector"),$(document).trigger("uiEditProfileStart")}),it("should be used when determining width",function(){expect(this.$editableField).toHaveAttr("data-truncate-length","30");var a=this.$editableField.val(Array(21).join("a")).trigger("update").width(),b=this.$editableField.val(Array(31).join("a")).trigger("update").width();expect(b).toBeGreaterThan(a);var c=this.$editableField.val(Array(32).join("a")).trigger("update").width();expect(b).toBe(c)}),describe("on uiEditProfileSaveFields",function(){describe("field over truncate length",function(){it("should truncate text in profileField",function(){this.$editableField.val("http://example.com/abcdefghijkl"),$(document).trigger("uiEditProfileSaveFields"),expect(this.$profileField).toHaveHtml("http://example.com/abcdefghijk…")})}),describe("field under truncate length",function(){it("should not truncate text in profileField",function(){this.$editableField.val("http://example.com/abc"),$(document).trigger("uiEditProfileSaveFields"),expect(this.$profileField).toHaveHtml("http://example.com/abc")})})})}),describe("no measuring field",function(){beforeEach(function(){var a='<div>\n          <label for="user_url" class="placeholder">URL</label>\n          <input type="text" class="editable-field" value="http://current-site.com" id="user_url" data-truncate-length="30">\n          <span type="text" class="profile-field"><a href="http://current-site.com">http://current-site.com</a></span>\n        </div>\n      ';setupComponent(a),this.$editableField=this.component.select("editableFieldSelector"),this.$profileField=this.component.select("profileFieldSelector"),$(document).trigger("uiEditProfileStart")}),it("uiEditProfileStart should not sync dimensions",function(){var a=this.$editableField.width();this.$editableField.val("a"),$(document).trigger("uiEditProfileStart");var b=this.$editableField.width();expect(b).toBe(a)})})})
});
define("test/app/ui/global_nav_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/global_nav",function(){beforeEach(function(){var a='<div>\n        <h2 class="bird-topbar-etched"></h2>\n        <ul class="nav js-global-actions" id="global-actions" id="home">\n          <li id="global-nav-home" class="home active" data-global-action="home">\n            <a href="/" data-component-term="home_nav">\n              <span class="new-wrapper"><i class="nav-home"></i><i class="nav-new"></i></span> Home\n            </a>\n          </li>\n          <li class="people" data-global-action="connect" id="connect">\n            <a href="/i/connect" data-component-term="connect_nav">\n              <span class="new-wrapper"><i class="nav-people"></i><i class="nav-new"></i></span> Connect\n            </a>\n          </li>\n          <li class="topics" data-global-action="discover" id="discover">\n            <a href="/i/discover" data-component-term="discover_nav">\n              <span class="new-wrapper"><i class="nav-topics"></i><i class="nav-new"></i></span> Discover\n            </a>\n          </li>\n        </ul>\n      </div>\n    ';setupComponent(a)});var a=location.pathname+location.search,b=document.title;afterEach(function(){history.replaceState({},b,a)}),describe("when dataPageRefresh triggered with section",function(){beforeEach(function(){$(document).trigger("dataPageRefresh",{section:"discover"})}),it("highlights nav item",function(){expect(this.component.$node.find("#discover")).toHaveClass("active")}),it("removes highlight from old item",function(){expect(this.component.$node.find("#home")).not.toHaveClass("active")})}),describe("when dataPageRefresh triggered with no section",function(){beforeEach(function(){$(document).trigger("dataPageRefresh",{})}),it("removes all highlighting",function(){expect(this.component.$node.find("#home")).not.toHaveClass("active"),expect(this.component.$node.find("#discover")).not.toHaveClass("active")})}),it("sets a glow on the active tab on event uiAddPageCount",function(){expect(this.component.$node.find(".home")).not.toHaveClass("new"),this.component.trigger("uiAddPageCount",{count:3}),expect(this.component.$node.find(".home")).toHaveClass("new")}),it("removes a glow from the active tab on event uiRemovePageCount",function(){this.component.$node.find(".home").addClass("new"),this.component.trigger("uiHasInjectedNewTimeline"),expect(this.component.$node.find(".home")).not.toHaveClass("new")}),describe("clicking a link in the global nav for the current page",function(){beforeEach(function(){this.$link=this.component.$node.find(".people a"),spyOnEvent(document,"uiGotoTopOfScreen"),history.pushState({},"cachedPage","/i/connect"),$(window).scrollTop(200),this.$link.trigger("click")}),it("scrolls the page to the top",function(){expect($(window).scrollTop()).toBe(0)}),it("fires uiGotoTopOfScreen",function(){expect("uiGotoTopOfScreen").toHaveBeenTriggeredOn(document)})}),describe("clicking the bird takes you to the top",function(){beforeEach(function(){this.$bird=this.component.$node.find(".bird-topbar-etched"),spyOnEvent(document,"uiGotoTopOfScreen"),$(window).scrollTop(200),this.$bird.trigger("click")}),it("scrolls the page to the top",function(){expect($(window).scrollTop()).toBe(0)}),it("fires uiGotoTopOfScreen",function(){expect("uiGotoTopOfScreen").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/direct_message_link_handler_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/direct_message_link_handler",function(){var a='<button type="button" class="js-dm-dialog" data-name="charlie" data-screen-name="charliecroom">Open Me</button>\n';beforeEach(function(){setupComponent(a)}),it("triggers uiNeedsDMDialog when clicked",function(){spyOnEvent(this.$node,"uiNeedsDMDialog"),this.$node.select("dmLinkSelector").click(),expect("uiNeedsDMDialog").toHaveBeenTriggeredOnAndWith(this.$node,{name:"charlie",screen_name:"charliecroom"})})})
});
define("test/app/ui/with_upload_photo_affordance_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_upload_photo_affordance",function(){beforeEach(function(){var a='<div>\n      <button class="upload-photo">Upload Photo</button>\n    </div>\n    ';setupComponent(a)}),describe("on photoSelector hover",function(){it("should add and remove upload-photo-hover class",function(){this.component.select("uploadPhotoSelector").trigger("mouseover"),expect(this.component.$node).toHaveClass("upload-photo-hover"),this.component.select("uploadPhotoSelector").trigger("mouseout"),expect(this.component.$node).not.toHaveClass("upload-photo-hover")})})})
});
define("test/app/ui/field_edit_warning_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/field_edit_warning",function(){function a(){it("causes the link to revert to its original value",function(){expect($("#user_url")).toHaveValue("http://example.com")}),it("causes the warning div to be hidden",function(){expect($(".alert.warning")).not.toBeVisible()}),it("causes the input to have the error class removed",function(){expect($("#user_url")).not.toHaveClass("errors")})}beforeEach(function(){var a='<fieldset id="user_web_fieldset" class="control-group"><div class="controls"><input id="user_url" name="user_url" rel="http://example.com" size="30" type="text" value="http://example.com"></div><div class="controls"><div class="alert warning" style="display: none;"><p>WARNING: Changing this field will cause you to lose your badge until you are re-verified.</p><p><a href="#" id="undo">Undo your changes</a></p></div></div></fieldset>';setupComponent(a);var b=$("#user_url");b.val(b.val()+"/foo"),b.trigger("keyup")}),describe("Editing the field",function(){it("causes the warning div to be displayed",function(){expect($(".alert.warning")).toBeVisible()}),it("causes the input to have the error class applied",function(){expect($("#user_url")).toHaveClass("errors")})}),describe("clicking the undo link",function(){beforeEach(function(){$("#undo").trigger("click")}),a()}),describe("editing the field back to its original value",function(){beforeEach(function(){var a=$("#user_url");a.val(a.attr("rel")),a.trigger("keyup")}),a()})})
});
define("test/app/ui/with_password_strength_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_password_strength",function(){beforeEach(function(){var a='<fieldset id="foo"><input id="user_password" value="barbarbar" type="password"><small id="password_strength_feedback"></small></fieldset>';setupComponent(a,{bannedPasswords:["grfggrfggrfg1234"]})}),describe("#strength",function(){it("identifies obvious, short, weak, banned, spaces, good, strong, and very strong password strings",function(){var a=this.component.strength("foo");expect(a.message).toBe("Too Short"),expect(a.score).toBe(3),expect(a.reason).toBe("tooshort"),a=this.component.strength("testtesttest1234"),expect(a.message).toBe("Too Obvious"),expect(a.score).toBe(0),expect(a.reason).toBe("obvious"),a=this.component.strength("sameasusername","sameasusername"),expect(a.message).toBe("Too Obvious"),expect(a.score).toBe(0),expect(a.reason).toBe("obvious"),a=this.component.strength("foobarbaz"),expect(a.message).toBe("Weak"),expect(a.score).toBe(25),expect(a.reason).toBe("weak"),a=this.component.strength("foobarbaz2"),expect(a.message).toBe("Good"),expect(a.score).toBe(44),expect(a.reason).toBe("good"),a=this.component.strength("foobarbaz2000"),expect(a.message).toBe("Strong"),expect(a.score).toBe(59),expect(a.reason).toBe("strong"),a=this.component.strength("%%%%foobarbaz2000!!!!"),expect(a.message).toBe("Very Strong"),expect(a.score).toBe(100),expect(a.reason).toBe("verystrong"),a=this.component.strength("sameasfullname","username","sameasfullname"),expect(a.message).toBe("Too Obvious"),expect(a.score).toBe(0),expect(a.reason).toBe("obvious"),a=this.component.strength("sameasfullname","username","SaMeAsFuLlNaMe"),expect(a.message).toBe("Too Obvious"),expect(a.score).toBe(0),expect(a.reason).toBe("obvious")})})})
});
define("test/app/ui/image_selector_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/image_selector",function(){beforeEach(function(){var a='<div class="photo-selector">\n        <button class="btn" type="button">\n          <i class="tweet-camera"></i>\n        </button>\n        <div class="image-selector">\n          <input type="file" name="image" class="file-input">\n          <div class="swf-container"></div>\n        </div>\n      </div>\n    ';this.$node=$(a),this.$tweetbox=$('<div class="tweet-form" />'),this.$tweetbox.append(this.$node),this.component=(new this.Component).initialize(this.$node[0]),attachFixtureToDom(this.$tweetbox)}),describe("disable()",function(){it("should add the disabled class",function(){this.component.disable(),expect(this.component.$node).toHaveClass("disabled"),expect(this.component.select("buttonSelector")).toBeDisabled()})}),describe("enable()",function(){it("should remove the disabled class",function(){this.component.enable(),expect(this.component.$node).not.toHaveClass("disabled"),expect(this.component.select("buttonSelector")).not.toBeDisabled()})}),describe("gotImageData()",function(){it("should call resize()",function(){spyOn(this.component,"resize"),spyOn(this.component.gotResizedImageData,"bind").andCallFake(function(){return this});var a="lolcat.jpg",b="fake image data";this.component.gotImageData(a,b),expect(this.component.resize).toHaveBeenCalledWith(a,b,2048,this.component.gotResizedImageData)})}),describe("addFileError()",function(){beforeEach(function(){spyOnEvent(document,"uiShowError")}),it("should reset the form",function(){this.component.reset=function(){},spyOn(this.component,"reset"),this.component.addFileError("something"),expect(this.component.reset).toHaveBeenCalled()}),it("should show the too large message with tooLarge as input",function(){this.component.addFileError("tooLarge"),expect("uiShowError").toHaveBeenTriggeredOnAndWith(document,{message:"The file you selected is greater than the 3MB limit."})}),it("should show the not image message with notImage as input",function(){this.component.addFileError("notImage"),expect("uiShowError").toHaveBeenTriggeredOnAndWith(document,{message:"You did not select an image."})}),it("should show the not image message with ioError as input",function(){this.component.addFileError("ioError"),expect("uiShowError").toHaveBeenTriggeredOnAndWith(document,{message:"You did not select an image."})}),it("should not trigger an event with a bogus input",function(){this.component.addFileError("notAnError"),expect("uiShowError").not.toHaveBeenTriggeredOn(document)})}),describe("resetAndHidePreview",function(){it("should call reset and trigger the uiTweetBoxHidePreview event",function(){this.component.reset=function(){},spyOn(this.component,"reset"),spyOnEvent(document,"uiTweetBoxHidePreview"),this.component.resetAndHidePreview(),expect(this.component.reset).toHaveBeenCalled(),expect("uiTweetBoxHidePreview").toHaveBeenTriggeredOn(document)})}),describe("event uiTweetBoxShowPreview on document",function(){it("should call disable",function(){this.component.trigger("uiTweetBoxShowPreview"),expect(this.component.$node).toHaveClass("disabled"),expect(this.component.select("buttonSelector")).toBeDisabled()})}),describe("event uiTweetBoxHidePreview on document",function(){it("should call enable",function(){this.component.trigger("uiTweetBoxHidePreview"),expect(this.component.$node).not.toHaveClass("disabled"),expect(this.component.select("buttonSelector")).not.toBeDisabled()})}),describe("event uiTweetBoxRemoveImage on document",function(){it("should call reset",function(){spyOn(this.component,"reset"),spyOnEvent(document,"uiTweetBoxHidePreview"),this.component.trigger("uiTweetBoxRemoveImage"),expect(this.component.reset).toHaveBeenCalled(),expect("uiTweetBoxHidePreview").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/with_tweet_translation_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_tweet_translation",function(){function b(b){return"    <div class='js-stream-item' data-item-id='"+b.id+"'>      <div class='tweet' "+(b.mentions?"data-mentions='"+b.mentions.join(" ")+"' ":"")+"data-tweet-id='"+b.id+"' data-impression-id='"+b.impressionId+"' data-screen-name='username' data-disclosure-type='promoted'>"+a+"<p class='tweet-text'></p>         <div class='tweet-translation'><p class='tweet-translation-text'></p></div>      </div>    </div>"}function c(b){return"      <div class='tweet permalink-tweet' "+(b.mentions?"data-mentions='"+b.mentions.join(" ")+"' ":"")+"data-tweet-id='"+b.id+"' data-impression-id='"+b.impressionId+"' data-screen-name='username' data-disclosure-type='promoted'>"+a+"<p class='tweet-text'></p>         <div class='tweet-translation'><p class='tweet-translation-text'></p></div>      </div>"}function d(b){return"    <div class='tweet simple-tweet' data-tweet-id='"+b.id+"' data-impression-id='"+b.impressionId+"' data-screen-name='username' data-disclosure-type='promoted'>"+a+"</div>"}function f(){var a="";return e.forEach(function(c){a+=b(c)}),a}var a='<button type="button" class="btn-link js-translate-tweet translate-button" data-nav="translate_tweet">\n    <span class="translate-label">View Translation</span><i class=\'translate-globe\'></i></button>\n  ',e=[{id:42,impressionId:30,replies:[{id:43,impressionId:31}]},{id:43,impressionId:32,mentions:["anotherusername","andanotherone","loggedinuser"]}],g,h,i,j={id:42,id_str:"42",translated_lang:"es",item_html:"Translated tweet."};beforeEach(function(){setupComponent("<div id='#timeline'>"+f()+"</div>",{genericItemSelector:".js-stream-item",loggedIn:!0,screenName:"loggedinuser",itemType:"tweet"}),g=this.$node.find(".tweet:first"),h=g.find(".tweet-translation"),i=g.find(".js-translate-tweet"),h.hide(),jasmine.Clock.useMock(),jQuery.fx.off=!0,this.component.findTweet=jasmine.createSpy().andReturn($(d(e[0])))}),describe("click on translate tweet link",function(){it("triggers uiNeedsTweetTranslation if a translation is not visible",function(){spyOnEvent(g,"uiNeedsTweetTranslation"),i.trigger("click"),expect("uiNeedsTweetTranslation").toHaveBeenTriggeredOn(g)}),it("does not trigger uiNeedsTweetTranslation if a translation is visible",function(){h.show(),spyOnEvent(g,"uiNeedsTweetTranslation"),i.trigger("click"),expect("uiNeedsTweetTranslation").not.toHaveBeenTriggeredOn(i)}),it("inject tweet translation dom on dataTweetTranslationSuccess event if result translation is available",function(){$(document).trigger("dataTweetTranslationSuccess",j),expect(g.find(".tweet-translation-text").html()).toEqual("Translated tweet.")}),it("does nothing on dataTweetTranslationSuccess event if result translation is not available",function(){$(document).trigger("dataTweetTranslationSuccess",{message:"Translation error"}),expect(g.find(".tweet-translation-text").html()).toEqual("")})}),describe("findTweetTranslation",function(){it("appropriately removes non-numerical characters from IDs",function(){var a="a^@!<>",b=this.component.findTweetTranslation(g.attr("data-tweet-id")+a);expect(g.attr("data-tweet-id")).toEqual(b.parent().attr("data-tweet-id"))})}),describe("timeline translation event",function(){it("runs the translate click method when the tweet expands if it's in a timeline",function(){spyOnEvent(g,"uiNeedsTweetTranslation"),g.trigger("uiTimelineNeedsTranslation"),expect("uiNeedsTweetTranslation").toHaveBeenTriggeredOn(g)}),it("doesn't hide translate tweet button in timeline after translation",function(){$(document).trigger("dataTweetTranslationSuccess",j),expect(i.is(":visible")).toBe(!0)}),it("only hides the globe for a single tweet when that tweet's detected language is unreliable",function(){expect(this.component.$node.find(this.component.attr.translateTweetSelector+":visible").length).toBe(2);var a={id:42,id_str:"42",item_html:"Translated tweet."};$(document).trigger("dataTweetTranslationSuccess",a),expect(this.component.$node.find(this.component.attr.translateTweetSelector+":visible").length).toBe(1)})}),describe("permalink translations",function(){beforeEach(function(){setupComponent("<div class='permalink-tweet-container'>"+c(e[0])+"</div>",{genericItemSelector:".js-stream-item",loggedIn:!0,screenName:"loggedinuser",itemType:"tweet"}),g=this.$node.find(".tweet:first")}),it("does not attempt to translate the tweet on timeline event when in a permalink",function(){spyOnEvent(g,"uiNeedsTweetTranslation"),g.trigger("uiTimelineNeedsTranslation"),expect("uiNeedsTweetTranslation").not.toHaveBeenTriggeredOn(g)}),it("hides translate tweet button on permalink after translation",function(){i=g.find(".js-translate-tweet"),$(document).trigger("dataTweetTranslationSuccess",j),expect(i.is(":visible")).toBe(!1)})})})
});
define("test/app/ui/cookie_warning_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/cookie_warning",function(){var a=$('<input id="fat">'),b=$('<div id="fat"></div>');describe("#setElements",function(){beforeEach(function(){setupComponent(b,{target:$("div")}),this.$node.hide()}),it("should show the node if cookies are disabled",function(){expect(this.$node).not.toBeVisible(),spyOn(this.component,"cookiesEnabled").andReturn(!1),this.component.trigger("uiSwiftLoaded"),expect(this.$node).toBeVisible()}),it("should not show the node if cookies are enabled",function(){expect(this.$node).not.toBeVisible(),this.component.trigger("uiSwiftLoaded"),expect(this.$node).not.toBeVisible()})})})
});
define("test/app/ui/settings_controls_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings_controls",function(){beforeEach(function(){var a='<div class="requires-password">\n        <button id="settings_save">\n      </div>\n    ';setupComponent(a,{submitSelector:"#settings_save"})}),describe("submit",function(){it("triggers uiOpenPasswordDialog event on submit when requires-password class is present",function(){spyOnEvent(document,"uiOpenPasswordDialog"),this.component.trigger("submit"),expect("uiOpenPasswordDialog").toHaveBeenTriggeredOn(document)}),it("does not trigger uiOpenPasswordDialog event when requires-password class is not present",function(){this.component.$node.removeClass("requires-password"),spyOnEvent(document,"uiOpenPasswordDialog"),this.component.trigger("submit"),expect("uiOpenPasswordDialog").not.toHaveBeenTriggeredOn(document)}),it("submits the settings form on uiSubmitSettings",function(){spyOnEvent(this.component.$node,"submit"),$(document).trigger("uiSubmitSettings"),expect("submit").toHaveBeenTriggeredOn(this.component.$node)})})})
});
define("test/app/ui/protected_verified_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/protected_verified_dialog",function(){function a(a){a.select("checkboxSelector").attr("checked",!0),a.select("checkboxSelector").trigger("click")}beforeEach(function(){var a='<form>\n        <div id="protected_verified_dialog" style="display: none;" class="modal-container">\n          <div class="modal modal-small draggable">\n            <div class="modal-content">\n              <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n              <div class="modal-header">\n                <h3 class="modal-title">Warning!</h3>\n              </div>\n              <div class="modal-body">\n                <p>Sorry, Twitter only verifies public accounts. If you protect your account, you will lose your verified badge.</p>\n              </div>\n              <div class="modal-footer">\n                <button id="stay_verified_link" class="btn">Stay verified</button>\n                <button id="protect_my_tweets_link" class="btn primary-btn">Protect my Tweets</button>\n              </div>\n            </div>\n          </div>\n          <div class="modal-overlay"></div>\n        </div>\n        <input id="user_protected" name="user[protected]" type="checkbox" value="1">\n      </form>\n    ';setupComponent(a)}),describe("checkbox clicks with unverified user",function(){it("does not open when protect tweets is checked",function(){spyOnEvent(this.$node,"uiDialogOpened"),a(this.component),expect("uiDialogOpened").not.toHaveBeenTriggeredOn(this.$node)})}),describe("checkbox clicks with verified user",function(){beforeEach(function(){this.component.attr.userVerified=!0}),it("opens when protect tweets is checked",function(){spyOnEvent(this.$node,"uiDialogOpened"),a(this.component),expect("uiDialogOpened").toHaveBeenTriggeredOn(this.$node)}),it("unchecks and closes if the user stays verified",function(){spyOnEvent(this.$node,"uiDialogClosed"),a(this.component),this.component.select("stayVerifiedSelector").trigger("click"),expect(this.component.select("checkboxSelector").is(":checked")).toBe(!1),expect("uiDialogClosed").toHaveBeenTriggeredOn(this.$node)}),it("stays checked and closes if the user protects tweets",function(){spyOnEvent(this.$node,"uiDialogClosed"),a(this.component),this.component.select("protectMyTweetsSelector").trigger("click"),expect(this.component.select("checkboxSelector").is(":checked")).toBe(!0),expect("uiDialogClosed").toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/profile_edit_param_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile_edit_param",{fixture:"test/fixtures/own_profile_header"},function(){var a=location.pathname+location.search,b=document.title,c=["uiSwiftLoaded","uiPageChanged"];history.replaceState&&afterEach(function(){history.replaceState({},b,a)}),c.forEach(function(a){describe("on "+a,function(){beforeEach(function(){this.$fixture=$(this.fixture),spyOnEvent(this.$fixture,"uiEditProfileInitialize")}),describe("has edit parameter",function(){beforeEach(function(){history.replaceState?history.replaceState(null,"Has edit param","/?edit=true"):this.Component.prototype.hasEditParam=function(){return!0}}),it("calls uiEditProfileInitialize",function(){setupComponent(this.$fixture,{supportsCropper:!0}),$(document).trigger(a),expect("uiEditProfileInitialize").toHaveBeenTriggeredOn(this.$fixture)})}),describe("no edit parameter",function(){beforeEach(function(){history.replaceState?history.replaceState(null,"No edit param","/"):this.Component.prototype.hasEditParam=function(){return!1}}),it("doesn't call uiEditProfileInitialize",function(){setupComponent(this.$fixture,{supportsCropper:!0}),$(document).trigger(a),expect("uiEditProfileInitialize").not.toHaveBeenTriggeredOn(this.$fixture)})})})})})
});
define("test/app/ui/with_redirect_after_follow_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_redirect_after_follow",function(){beforeEach(function(){setupComponent(),this.component.attr.redirectUrl="/welcome/alerts/phone"}),describe("on dataFollowStateChange",function(){describe("when newState is following",function(){it("should trigger uiNavigate",function(){spyOnEvent(document,"uiNavigate"),this.component.trigger(document,"dataFollowStateChange",{user:"user",userId:"1234",newState:"following"}),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(document,{href:"/welcome/alerts/phone"})})}),describe("when newState is not-following",function(){it("should not trigger uiNavigate",function(){spyOnEvent(document,"uiNavigate"),this.component.trigger(document,"dataFollowStateChange",{user:"user",userID:"1234",newState:"not-following"}),expect("uiNavigate").not.toHaveBeenTriggeredOnAndWith(document,{href:"/welcome/alerts/phone"})})})})})
});
define("test/app/ui/with_focus_highlight_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_focus_highlight",function(){beforeEach(function(){var a='<div>\n        <div class="tweet permalink-tweet">\n          <a href="#" class="fav"></a>\n          <a href="#" class="reply"></a>\n          <a href="#" class="retweet"></a>\n          <a href="#" class="block"></a>\n          <a href="#" class="unblock"></a>\n        </div>\n      </div>\n    ';setupComponent(a)}),beforeEach(function(){jasmine.Clock.useMock()}),afterEach(function(){this.component.select("focusContainerSelector").removeClass(this.component.attr.focusClass)}),it("adds the specified class to the specified container when one of its descendants receives focus",function(){$(".fav").focus(),expect($(this.component.attr.focusContainerSelector)).toHaveClass(this.component.attr.focusClass),$(".fav").blur()}),it("removes the specified class from the specified container when one of its descendants loses focus",function(){$(".fav").focus(),$(".fav").blur(),jasmine.Clock.tick(1),expect($(this.component.attr.focusContainerSelector)).not.toHaveClass(this.component.attr.focusClass)}),it("adds the specified class to the specified container when the container receives focus",function(){this.component.select("focusContainerSelector").attr("tabIndex",-1).focus(),expect($(this.component.attr.focusContainerSelector)).toHaveClass(this.component.attr.focusClass)}),it("adds the specified class to the specified container in response to the 'uiShouldAddFocusStyle' event",function(){this.component.trigger(this.component.select("focusContainerSelector"),"uiShouldAddFocusStyle"),expect($(this.component.attr.focusContainerSelector)).toHaveClass(this.component.attr.focusClass)}),it("removes the specified class from the specified container when the container loses focus",function(){this.component.select("focusContainerSelector").focus(),this.component.select("focusContainerSelector").blur(),jasmine.Clock.tick(1),expect($(this.component.attr.focusContainerSelector)).not.toHaveClass(this.component.attr.focusClass)})})
});
define("test/app/ui/with_topic_pivots_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_topic_pivots",function(){var a='<div id="discover-stories" role="main" aria-labelledby="content-main-heading" class="content-main {{#shuffle_timeline}}home-exp-shuffle-content{{/shuffle_timeline}}">\n    <div class="content-header">\n      <div class="header-inner">\n        <div class="topic-back-nav"><a class="js-topic-back-nav" href="{{discover_path}}">Back to All Topics</a></div>\n        <h2 id="content-main-heading">{{_i}}Tweets{{/i}}</h2>\n        <p class="subheader">Technology</p>\n      </div>\n    </div>\n    <div id="discover_items">\n      <div class="stream-container discover-timeline">\n        <div class="stream discover-stream">\n          <ol class="stream-items js-navigable-stream" id="stream-items-id">\n            <li class="js-stream-item stream-item stream-item expanding-stream-item semi-expanded disco-stream-item" data-item-id="382146240823042049" id="stream-item-tweet-382146240823042049" data-item-type="tweet">\n              <div class="tweet original-tweet js-stream-tweet js-actionable-tweet js-profile-popup-actionable js-original-tweet has-cards has-native-media" data-feedback-key="story_status_9q7clkZf" data-tweet-id="382146240823042049" data-item-id="382146240823042049" data-screen-name="robinsloan" data-name="Robin Sloan" data-user-id="13919072" data-card-type="photo" data-mentions="madeleine" data-story-type="topic" data-source="activity" data-component-context="topic_story" data-you-follow="false" data-you-block="false">\n                <span class="icon dogear"></span>\n                <div class="content">\n                  <div class="stream-item-header">\n                    <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" href="/robinsloan" data-user-id="13919072">\n                      <img class="avatar js-action-profile-avatar" src="https://si0.twimg.com/profile_images/2899944710/62364b6546e465865a9a6fe82672cbf1_normal.jpeg" alt="">\n                      <strong class="fullname js-action-profile-name show-popup-with-id">Robin Sloan</strong>\n                      <span>‏</span><span class="username js-action-profile-name"><s>@</s><b>robinsloan</b></span>\n                    </a>\n                    <small class="time">\n                      <a href="/robinsloan/status/382146240823042049" class="tweet-timestamp js-permalink js-nav" title="10:15 AM - 23 Sep 13"><span class="_timestamp js-short-timestamp js-relative-timestamp" data-time="1379945738" data-long-form="true">7h</span></a>\n                    </small>\n                  </div>\n                  <p class="js-tweet-text tweet-text">That brooch tho <a href="http://t.co/zmGMlJUadf" class="twitter-timeline-link" data-pre-embedded="true" dir="ltr">pic.twitter.com/zmGMlJUadf</a></p>\n\n                  <div class="stream-item-footer"></div>\n                  <div class="tweet-topics">\n                    <a href="/i/discover?topic=645" class="js-topic-label" data-topic-id="645"><div class="metadata topic-label">Music &amp; Radio</div></a>\n                  </div>\n                </div>\n              </div>\n            </li>\n          </ol>\n        </div>\n      </div>\n    </div>\n  </div>\n  ';beforeEach(function(){setupComponent(a)}),describe("When the user clicks a topic label",function(){it("triggers the 'uiTopicLabelClick' event",function(){spyOnEvent(this.component.$node,"uiTopicLabelClick");var a=this.$node.find(".js-topic-label");this.component.trigger(a,"click");var b=this.component.interactionData(a);expect("uiTopicLabelClick").toHaveBeenTriggeredOnAndWith(this.component,b)})}),describe("When the user clicks back navigation on a topic pivoted timeline",function(){it("triggers the 'uiTopicBackNavClick' event",function(){spyOnEvent(this.component.$node,"uiTopicBackNavClick");var a=this.$node.find(".js-topic-back-nav");this.component.trigger(a,"click"),expect("uiTopicBackNavClick").toHaveBeenTriggeredOn(this.component)})})})
});
define("test/app/ui/with_position_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_position",function(){describe("#adjacent",function(){xit("",function(){expect("").toBe("")})}),describe("#center",function(){xit("",function(){expect("").toBe("")})})})
});
define("test/app/ui/email_field_highlight_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/email_field_highlight",function(){beforeEach(function(){setupComponent('<fieldset id="email_fieldset"></fieldset>')}),describe("highlightField()",function(){it("it highlights the email field",function(){var a=$(this.component.attr.emailFieldsetSelector);this.component.highlightField(),expect(a).toHaveClass("alert")})})})
});
define("test/app/ui/user_dropdown_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/user_dropdown",function(){beforeEach(function(){var a='<div id="content">\n        <a id="toggler" class="js-dropdown-toggle"></a>\n        <form id="signout-form"></form>\n        <a id="signout-button"></a>\n        <a id="dm-count"></a>\n        <a class="feedback-callout-link"></a>\n      </div>\n    ',b=$(a);setupComponent(b,{signout:"#signout-button",signoutForm:"#signout-form",toggler:"#toggler",dmCount:"#dm-count",glowClass:"new"})}),afterEach(function(){$(".dm-dialog").remove()}),it("triggers uiPrepareFeedbackDialog when clicked",function(){spyOnEvent(this.$node,"uiPrepareFeedbackDialog"),this.component.select("feedbackLinkSelector").trigger("click"),expect("uiPrepareFeedbackDialog").toHaveBeenTriggeredOn(this.$node)}),it("submits the signoutForm when clicking signout",function(){spyOn(this.component.$signoutForm,"submit"),this.component.select("signout").trigger("click"),expect(this.component.$signoutForm.submit).toHaveBeenCalled()}),it("glows the dropdown when new messages arrive",function(){expect(this.component.$node).not.toHaveClass("new"),this.component.trigger("uiDMDialogHasNewConversations",{threads:["talkative"]}),expect(this.component.$node).toHaveClass("new")}),it("shows the new message count when messages arrive",function(){expect(this.component.$dmCount).not.toHaveClass("new"),this.component.trigger("uiDMDialogHasNewConversations",{threads:["talkative"]}),expect(this.component.$dmCount).toHaveClass("new"),expect(this.component.$dmCount).toHaveText("1")}),it("decrements the new message count when messages are opened",function(){this.component.trigger("uiDMDialogHasNewConversations",{threads:["a","b","c","d","e"]}),expect(this.component.$dmCount).toHaveText("5"),this.component.trigger("uiDMDialogOpenedConversation",{recipient:"a"}),expect(this.component.$dmCount).toHaveText("4")}),it("clears the new message glow once all messages have been opened",function(){this.component.trigger("uiDMDialogHasNewConversations",{threads:["a"]}),expect(this.component.$node).toHaveClass("new"),expect(this.component.$dmCount).toHaveText("1"),this.component.trigger("uiDMDialogOpenedConversation",{recipient:"a"}),expect(this.component.$session).not.toHaveClass("new"),expect(this.component.$dmCount).not.toHaveClass("new"),expect(this.component.$dmCount).toHaveText("")})})
});
define("test/app/ui/image_uploader_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/image_uploader",function(){beforeEach(function(){var a='<div class="photo-selector">\n        <button class="btn" type="button">\n          <i class="tweet-camera"></i>\n        </button>\n        <span class="photo-file-name">\n        <div class="image-selector">\n          <input type="file" name="image" class="file-input">\n          <div class="swf-container"></div>\n        </div>\n      </div>\n    ',b="The file's size is too damn high!",c=function(){};setupComponent(a,{fileTooBigMessage:b,onError:c})}),describe("truncate()",function(){it("ignores a string that is smaller than the truncated length",function(){var a="This is short",b=this.component.truncate(a,20);expect(b).toBe(a)}),it("truncates a string that is larger than length",function(){var a="This is a super long string",b=this.component.truncate(a,6);expect(b).toBe("Thi…ing")}),it("truncates a string with the longer part at the beginning if length is odd",function(){var a="This is a super long string",b=this.component.truncate(a,7);expect(b).toBe("This…ing")})}),describe("addFileError()",function(){beforeEach(function(){spyOnEvent(document,"uiAlertBanner")}),it("should reset the form",function(){this.component.reset=function(){},spyOn(this.component,"reset"),this.component.addFileError("something"),expect(this.component.reset).toHaveBeenCalled()}),it("should show the too large message with tooLarge as input",function(){this.component.addFileError("tooLarge"),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(document,{message:this.component.attr.fileTooBigMessage})}),it("should show the not image message with notImage as input",function(){this.component.addFileError("notImage"),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(document,{message:"You did not select an image."})}),it("should show the not image message with ioError as input",function(){this.component.addFileError("ioError"),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(document,{message:"You did not select an image."})}),it("should scribe an upload failure client_event",function(){this.component.addFileError("notImage"),expect(this.component).toScribe({component:"profile_image",element:"upload",action:"failure"})}),it("should call the callback",function(){spyOn(this.component.attr,"onError"),this.component.addFileError("tooLarge"),expect(this.component.attr.onError).toHaveBeenCalled()})}),describe("gotImageData()",function(){it("should call gotResizedImageData()",function(){spyOn(this.component,"gotResizedImageData");var a="lolcat.jpg",b="fake image data";this.component.gotImageData(a,b),expect(this.component.gotResizedImageData).toHaveBeenCalledWith(a,b)})}),describe("updateFileNameText()",function(){it("updates the file name span",function(){var a="faketext.jpg";spyOn(this.component,"truncate").andCallFake(function(a){return a}),this.component.updateFileNameText(null,{fileName:a}),expect(this.component.select("fileNameTextSelector")).toHaveHtml(a)})})})
});
define("test/app/ui/signup_call_out_spec",["module","require","exports"],function(module, require, exports) {
describeComponentWithDataComponents("app/ui/signup_call_out",["app/data/signup_click_scribe"],function(){beforeEach(function(){var a='<form class="signup">\n        <input type="submit" />\n      </form>\n    ';setupComponent(a,{eventData:{scribeContext:{section:"signup_callout",component:"form"}}})}),describe("clicking the signup button",function(){it("scribes form submission",function(){spyOnEvent(this.$node,"uiSignupButtonClicked");var a=jasmine.createSpy().andCallFake(function(a){a.preventDefault()});this.$node.on("submit",a),this.$node.find("input[type=submit]").click(),expect(this.signupClickScribe).toScribe({section:"signup_callout",component:"form",action:"signup_click"})})})})
});
define("test/app/ui/password_match_pair_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/password_match_pair",function(){beforeEach(function(){var a='<fieldset id="foo">\n        <small id="password_match">Passwords don\'t match</small>\n        <input id="user_password" type="password" name="user_password">\n        <input id="user_password_confirmation" type="password" name="user_password_confirmation">\n      </fieldset>\n    ';setupComponent(a)}),it("shows a message on non-matching passwords",function(){var a=this.component.$node;a.find("#user_password").val("foo"),a.find("#user_password_confirmation").val("bar"),a.keyup(),expect(a.find("#password_match")).toBeVisible()}),it("does not show a message when the passwords match",function(){this.$node.find("#user_password").val("foo"),this.$node.find("#user_password_confirmation").val("foo"),this.$node.keyup(),expect(this.$node.find("#password_match")).not.toBeVisible()})})
});
define("test/app/ui/color_picker_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/color_picker",function(){var a=$('<input id="fat">'),b=$('<div id="fat"></div>');describe("#setElements",function(){beforeEach(function(){setupComponent(b,{target:$("div")})}),it("should define a $container for the color_picker",function(){expect(typeof this.component.$container[0]).toBe("object"),expect(this.component.$container.hasClass(this.component.attr.colorPickerContainerClass)).toBe(!0),expect(this.component.$container.parent()[0]).toBe($("body")[0])}),it("should define a $picker for the color_picker",function(){expect(typeof this.component.$picker).toBe("object"),expect(typeof this.component.$picker.data("colorpicker").onSubmit).toBe("function")}),it("should define a $trigger for the color_picker",function(){expect(typeof this.component.$trigger).toBe("object")}),it("should set isInput to false",function(){expect(this.component.isInput).toBe(!1)}),it("should define a $target if target option is specified",function(){expect(typeof this.component.$target).toBe("object"),expect(this.component.$target[0].tagName.toLowerCase()).toBe("div")})}),describe("#attachEvents-input",function(){beforeEach(function(){setupComponent(a)}),it("should show color_picker if target is focused",function(){a.focus(),expect(this.component.$container).toBeVisible()}),it("should close color_picker if tab key is pressed",function(){var b=jQuery.Event("keydown");b.which=9,a.focus(),expect(this.component.$container).toBeVisible(),a.trigger(b),expect(this.component.$container).not.toBeVisible()}),it("should close color_picker if enter key is pressed",function(){var b=jQuery.Event("keydown");b.which=13,a.focus(),expect(this.component.$container).toBeVisible(),a.trigger(b),expect(this.component.$container).not.toBeVisible()})}),describe("#attachEvents-div",function(){beforeEach(function(){setupComponent(b)}),it("should show color_picker if target is clicked",function(){b.click(),expect(this.component.$container).toBeVisible()})}),describe("#onSubmit",function(){beforeEach(function(){setupComponent(b)}),it("should set a color data attribute on the target",function(){this.component.submit(null,"000000"),expect(this.component.$target.data("color")).toBe("#000000")}),it("should trigger uiColorPicked event with targetSelector and hex",function(){spyOnEvent(document,"uiColorPicked"),this.component.submit(null,"000000"),expect("uiColorPicked").toHaveBeenTriggeredOnAndWith(document,{targetSelector:"#fat",hex:"#000000"})}),it("should hide the color_picker",function(){this.component.submit(null,"000000"),expect(this.component.$container).not.toBeVisible()})})})
});
define("test/app/ui/with_inline_image_options_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_inline_image_options",{fixture:"test/fixtures/own_profile_header"},function(){beforeEach(function(){setupComponent(this.fixture)}),afterEach(function(){$("body").removeClass("show-header-options show-avatar-options")}),describe("when clicking cancel",function(){it("should hide avatar and header options",function(){$("body").addClass("show-header-options show-avatar-options"),this.component.select("cancelOptionsSelector").click(),expect($("body")).not.toHaveClass("show-header-options"),expect($("body")).not.toHaveClass("show-avatar-options")})}),describe("on uiProfileHeaderUpdated",function(){it("should hide avatar and header options",function(){$("body").addClass("show-header-options show-avatar-options"),this.component.trigger("uiProfileHeaderUpdated"),expect($("body")).not.toHaveClass("show-header-options"),expect($("body")).not.toHaveClass("show-avatar-options")})}),describe("on uiProfileAvatarUpdated",function(){it("should hide avatar and header options",function(){$("body").addClass("show-header-options show-avatar-options"),this.component.trigger("uiProfileAvatarUpdated"),expect($("body")).not.toHaveClass("show-header-options"),expect($("body")).not.toHaveClass("show-avatar-options")})}),describe("on avatar click",function(){describe("in edit mode",function(){it("should show avatar options",function(){spyOnEvent(this.component.select("changePhotoSelector"),"uiShouldShowDropdown"),this.component.trigger("uiEditProfileStart"),this.component.select("editAvatarSelector").eq(0).trigger("click"),expect($("body")).toHaveClass("show-avatar-options"),expect("uiShouldShowDropdown").toHaveBeenTriggeredOn(this.component.select("changePhotoSelector"))}),it("should hide avatar options when options are being shown",function(){spyOnEvent(document,"uiForceDropdownClosed"),this.component.trigger("uiEditProfileStart"),this.component.select("editAvatarSelector").eq(0).trigger("click"),expect($("body")).toHaveClass("show-avatar-options"),this.component.select("editAvatarSelector").eq(0).trigger("click"),expect($("body")).not.toHaveClass("show-avatar-options"),expect("uiForceDropdownClosed").toHaveBeenTriggeredOn(document)})})}),describe("on uiShowEditHeaderOptions",function(){describe("in edit mode",function(){it("should show header options",function(){spyOnEvent(this.component.select("changeHeaderSelector"),"uiShouldShowDropdown"),this.component.trigger("uiEditProfileStart"),this.component.trigger("uiShowEditHeaderOptions"),expect($("body")).toHaveClass("show-header-options"),expect("uiShouldShowDropdown").toHaveBeenTriggeredOn(this.component.select("changeHeaderSelector"))})})}),describe("on uiShowEditAvatarOptions",function(){describe("in edit mode",function(){it("should show avatar options",function(){spyOnEvent(this.component.select("changePhotoSelector"),"uiShouldShowDropdown"),this.component.trigger("uiEditProfileStart"),this.component.trigger("uiShowEditAvatarOptions"),expect($("body")).toHaveClass("show-avatar-options"),expect("uiShouldShowDropdown").toHaveBeenTriggeredOn(this.component.select("changePhotoSelector"))})})}),describe("on header mask click while showing avatar options",function(){it("should hide avatar options",function(){spyOnEvent(document,"uiForceDropdownClosed"),this.component.trigger("uiEditProfileStart"),$("body").addClass("show-avatar-options"),this.component.select("profileHeaderMaskSelector").trigger("click"),expect($("body")).not.toHaveClass("show-avatar-options"),expect("uiForceDropdownClosed").toHaveBeenTriggeredOn(document)})}),describe("on headerTarget click",function(){describe("in edit mode",function(){it("should show header options",function(){spyOnEvent(this.component.select("changeHeaderSelector"),"uiShouldShowDropdown"),this.component.trigger("uiEditProfileStart"),this.component.select("editHeaderSelector").trigger("click"),expect($("body")).toHaveClass("show-header-options"),expect("uiShouldShowDropdown").toHaveBeenTriggeredOn(this.component.select("changeHeaderSelector"))})}),describe("not in edit mode",function(){it("should not show header options",function(){this.component.select("editHeaderSelector").trigger("click"),expect($("body")).not.toHaveClass("show-header-options")})})})})
});
define("test/app/ui/search_dropdown_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/search_dropdown",function(){var a='<div class="dropdown btn-group flex-table-btn js-search-dropdown">\n      <button type="button" class="btn btn-search-actions js-search-dropdown-button js-dropdown-toggle" aria-haspopup="true">\n        <span class="icon search-toggle"><span class="visuallyhidden">Search Options</span></span>\n      </button>\n      <div class="dropdown-menu btn-group-dropdown js-combo-btn-dropdown-options">\n        <div class="dropdown-caret right">\n          <span class="caret-outer"></span>\n          <span class="caret-inner"></span>\n        </div>\n        <ul>\n          <li class="js-toggle-saved-search-link js-unsaved-search" data-query="twitter">\n            <button type="button" class="dropdown-link saved-search-text">Save search</button>\n          </li>\n          <li>\n            <a href="/search-advanced" data-nav="advanced-search" class="advanced-search">Advanced search</a>\n          </li>\n          <li>\n            <a href="/settings/widgets/new/search?query=twitter" data-nav="embedded-search" class="embed-search">Embed this search</a>\n          </li>\n        </ul>\n      </div>\n    </div>\n  ';beforeEach(function(){setupComponent(a)}),describe("event uiSavedSearchRemoveConfirm",function(){it("should not fire next event if savedSearchId not defined",function(){spyOnEvent(this.$node,"uiRemoveSavedSearch"),this.component.trigger("uiSavedSearchRemoveConfirm"),expect("uiRemoveSavedSearch").not.toHaveBeenTriggeredOn(this.$node)}),it("if savedSearchId defined, fire next event",function(){spyOnEvent(this.$node,"uiRemoveSavedSearch"),this.component.savedSearchId="1234",this.component.trigger("uiSavedSearchRemoveConfirm"),expect("uiRemoveSavedSearch").toHaveBeenTriggeredOnAndWith(this.$node,{id:"1234"})})}),describe("event dataAddedSavedSearch",function(){it("should change the text in the dropdown and header",function(){this.component.trigger("dataAddedSavedSearch",{id:"1234"});var a=this.$node.find(".js-toggle-saved-search-link");expect(a.data("id")).toEqual("1234"),expect(a.text()).toMatch("Remove saved search")})}),describe("event dataRemovedSavedSearch",function(){it("should change the text in the dropdown and header",function(){this.component.trigger("dataRemovedSavedSearch",{id:"1234"});var a=this.$node.find(".js-toggle-saved-search-link");expect(a.text()).toMatch("Save search")})}),describe("event click on savedSearchSelector creates dialog",function(){it("should trigger dialog",function(){spyOnEvent(this.$node,"uiOpenConfirmDialog"),this.component.trigger("dataAddedSavedSearch",{id:"1234"}),this.$node.find(".js-saved-search").trigger("click"),expect("uiOpenConfirmDialog").toHaveBeenTriggeredOn(this.$node)})}),describe("event click unsavedSearchSelector",function(){it("will trigger saved search",function(){spyOnEvent(this.$node,"uiAddSavedSearch"),this.$node.find(".js-unsaved-search").trigger("click"),expect("uiAddSavedSearch").toHaveBeenTriggeredOnAndWith(this.$node,{query:"twitter"})})}),describe("event click advancedSearchSelector",function(){it("will trigger uiNavigate",function(){spyOnEvent(this.$node,"uiNavigate"),this.$node.find(".advanced-search").trigger("click"),expect("uiNavigate").toHaveBeenTriggeredOn(this.$node)})}),describe("event click embedSearchSelector",function(){it("will trigger uiNavigate",function(){spyOnEvent(this.$node,"uiNavigate"),this.$node.find(".embed-search").trigger("click"),expect("uiNavigate").toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/tweet_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/tweet_dialog",function(){beforeEach(function(){var a='<div id="global-tweet-dialog" style="display: none;" class="modal-container">\n        <div class="modal draggable">\n          <div class="modal-content">\n            <button type="button" class="modal-btn modal-close"><i class="close-medium"></i></button>\n            <div class="modal-header">\n              <h3 class="modal-title"></h3>\n            </div>\n            <div class="modal-body">\n              <form class="tweet-form"\n                method="post"\n                target="tweet-post-iframe"\n                action="//upload.twitter.com/i/tweet/create_with_media.iframe"\n                enctype="multipart/form-data">\n              </form>\n            </div>\n            <div class="modal-footer modal-tweet"></div>\n          </div>\n        </div>\n      </div>\n    ';this.html=a,setupComponent(this.html)}),describe("opening",function(){it("calls open when uiOpenTweetDialog is triggered on document",function(){var a=spyOn(this.component,"open");$(document).trigger("uiOpenTweetDialog"),expect(a).toHaveBeenCalled(),this.$node.trigger("uiDialogClosed")}),it("triggers open when uiOpenTweetDialog is received on document",function(){spyOnEvent(document,"uiDialogOpened"),$(document).trigger("uiOpenTweetDialog"),expect("uiDialogOpened").toHaveBeenTriggeredOn(document)})}),describe("lazy initialization",function(){it("triggers uiInitTweetbox when uiOpenTweetDialog is received on document",function(){var a=this.$node.find("form.tweet-form");spyOnEvent(a,"uiInitTweetbox"),$(document).trigger("uiOpenTweetDialog"),expect("uiInitTweetbox").toHaveBeenTriggeredOn(a)})}),describe("event uiOpenTweetDialog",function(){it("opens a dialog with the default title when no data is present",function(){this.component.trigger("uiOpenTweetDialog"),expect(this.component.select("modalTitleSelector")).toHaveText("Compose new Tweet")}),it("opens a dialog with an alternate title when specified",function(){this.component.trigger("uiOpenTweetDialog",{title:"Wassssuuuuupppp?"}),expect(this.component.select("modalTitleSelector")).toHaveText("Wassssuuuuupppp?")}),it("fires the uiOverrideTweetBoxOptions event with given options",function(){spyOnEvent(document,"uiOverrideTweetBoxOptions");var a={foo:"foo",bar:"bar"};this.component.trigger("uiOpenTweetDialog",a),expect("uiOverrideTweetBoxOptions").toHaveBeenTriggeredOnAndWith(document,a)}),it("fires the uiOverrideTweetBoxOptions event with default screenName",function(){spyOnEvent(document,"uiOverrideTweetBoxOptions");var a={foo:"foo",bar:"bar",screenNames:["name"]};this.component.trigger("uiOpenTweetDialog",a),expect("uiOverrideTweetBoxOptions").toHaveBeenTriggeredOnAndWith(document,{foo:"foo",bar:"bar",screenNames:["name"],defaultText:"@name ",condensedText:"Reply to @name "})}),it("fires the uiOverrideTweetBoxOptions event with default screenName with single screenName",function(){spyOnEvent(document,"uiOverrideTweetBoxOptions");var a={foo:"foo",bar:"bar",screenName:"name"};this.component.trigger("uiOpenTweetDialog",a),expect("uiOverrideTweetBoxOptions").toHaveBeenTriggeredOnAndWith(document,{foo:"foo",bar:"bar",screenName:"name",defaultText:"@name ",condensedText:"Reply to @name "})}),it("fires the uiOverrideTweetBoxOptions event with related screenNames",function(){spyOnEvent(document,"uiOverrideTweetBoxOptions");var a={foo:"foo",bar:"bar",screenNames:["name1","name2","name3"]};this.component.trigger("uiOpenTweetDialog",a),expect("uiOverrideTweetBoxOptions").toHaveBeenTriggeredOnAndWith(document,{foo:"foo",bar:"bar",screenNames:["name1","name2","name3"],defaultText:"@name1 @name2 @name3 ",condensedText:"Reply to @name1 @name2 @name3 "})}),it("does not set the tweet-showing class on the modal header",function(){this.component.trigger("uiOpenTweetDialog",{}),expect($(".modal-header")).not.toHaveClass("tweet-showing")})}),describe("event uiShortcutShowTweetbox",function(){it("fires the uiOverrideTweetBoxOptions event with global draftTweetId",function(){spyOnEvent(document,"uiOverrideTweetBoxOptions"),this.component.trigger("uiShortcutShowTweetbox"),expect("uiOverrideTweetBoxOptions").toHaveBeenTriggeredOnAndWith(document,{draftTweetId:"global"})})}),describe("event uiOpenReplyDialog",function(){it("sets the defaultText based on the given screenName",function(){spyOnEvent(document,"uiOverrideTweetBoxOptions"),this.component.trigger("uiOpenReplyDialog",{screenName:"shinypb",screenNames:["shinypb"]}),expect("uiOverrideTweetBoxOptions").toHaveBeenTriggeredOnAndWith(document,{screenName:"shinypb",screenNames:["shinypb"],defaultText:"@shinypb ",condensedText:"Reply to @shinypb ",title:"Reply to @shinypb"})}),it("sets the defaultText based on the given screenNames",function(){spyOnEvent(document,"uiOverrideTweetBoxOptions"),this.component.trigger("uiOpenReplyDialog",{screenName:"shinypb",screenNames:["shinypb","kpk"]}),expect("uiOverrideTweetBoxOptions").toHaveBeenTriggeredOnAndWith(document,{defaultText:"@shinypb @kpk ",condensedText:"Reply to @shinypb @kpk ",screenName:"shinypb",screenNames:["shinypb","kpk"],title:"Reply to @shinypb"})}),it("sets the tweet-showing class on the modal header",function(){this.component.trigger("uiOpenReplyDialog",{screenName:"ryanoneill",screenNames:["ryanoneill","kpk"]}),expect($(".modal-header")).toHaveClass("tweet-showing")})}),describe("closing",function(){it("calls uiDialogClosed when uiTweetSent is received",function(){var a=spyOn(this.Component.prototype,"close");setupComponent(this.html),this.$node.trigger("uiTweetSent"),expect(a).toHaveBeenCalled()}),it("triggers close when uiTweetSent is received",function(){setupComponent(this.html),this.component.open(),spyOnEvent(this.$node,"uiDialogClosed"),this.$node.trigger("uiTweetSent"),expect("uiDialogClosed").toHaveBeenTriggeredOn(this.$node)}),it("triggers removeTweet when uiDialogClosed is received",function(){var a=spyOn(this.Component.prototype,"removeTweet");setupComponent(this.html),this.$node.trigger("uiDialogClosed"),expect(a).toHaveBeenCalled()})}),describe("updating",function(){it("updates the dialog title when uiDialogUpdateTitle is received",function(){setupComponent(this.html),this.$node.trigger("uiDialogUpdateTitle",{title:"new title"}),expect(this.component.select("modalTitleSelector")).toHaveText("new title")}),it("does not update the dialog title if uiDialogUpdateTitle is received without a title property",function(){setupComponent(this.html),this.$node.trigger("uiDialogUpdateTitle"),expect(this.component.select("modalTitleSelector")).toHaveText("")})}),describe("When the dialog is opened",function(){it("prevents default behavior of the uiDialogInitialFocus event",function(){$(document).trigger("uiOpenTweetDialog"),expect(this.component.$node.find(".modal-close")).not.toBeFocused()})})})
});
define("test/app/ui/suggested_users_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/suggested_users",function(){describe("profile event mode",function(){beforeEach(setupComponent),describe("on dataSuggestedUsersSuccess",function(){beforeEach(function(){$(document).trigger("dataSuggestedUsersSuccess",{html:'<div id="test">Hello world</div><a href="#" class="js-close">Close</a>',sourceEventData:{userId:5,profileHead:!0}})}),it("fills its div with the HTML from the event",function(){expect(this.$node.find("#test")).toHaveText("Hello world")}),describe("with a second dataSuggestedUsersSuccess",function(){beforeEach(function(){$(document).trigger("dataSuggestedUsersSuccess",{html:'<div id="test2">Goodbye world</div><a href="#" class="js-close">Close</a>',sourceEventData:{userId:5,profileHead:!0}})}),it("does nothing",function(){expect(this.$node.find("#test")).toExist(),expect(this.$node.find("#test2")).not.toExist()})}),describe("clicking the close button",function(){it("closes the module and removes the content",function(){this.$node.find(".js-close").trigger("click"),expect(this.$node).toBeEmpty()})})}),it("should not respond to timeline events",function(){$(document).trigger("dataSuggestedUsersSuccess",{html:'<div id="test3">Hello</div><a href="#" class="js-close">Close</a>',sourceEventData:{userId:3,timeline_recommendations:!0}}),expect(this.$node.find("#test3")).not.toExist()})}),describe("replace followed user",function(){var a='<div class="user-similarities-list breakable">\n            <div class="content-header">\n              <div class="header-inner">\n                <small class="pull-right">\n                  <button aria-label="close" class="btn-link js-close">{{_i}}Close{{/i}}</button>\n                </small>\n                <h2>You might also want to follow</h2>\n              </div>\n            </div>\n            <div class="stream">\n                <div class="stream-item stream-end-item">\n                  <div class="account js-actionable-user js-profile-popup-actionable" data-screen-name="TelegraphNews" data-user-id="3" data-feedback-token="131">\n                    <div class="follow-bar">\n                      <div class="user-actions btn-group including" data-user-id="3" data-screen-name="TelegraphNews" data-name="Telegraph News" data-protected="false">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      ',b='<div class="component" id="suggested-users">\n          <div class="user-similarities-list breakable">\n            <div class="content-header">\n              <div class="header-inner">\n                <small class="pull-right">\n                  <button aria-label="close" class="btn-link js-close">{{_i}}Close{{/i}}</button>\n                </small>\n                <h2>You might also want to follow</h2>\n              </div>\n            </div>\n            <div class="stream">\n              <div class="js-users-list stream-items">\n                <div class="stream-item">\n                  <div class="account js-actionable-user js-profile-popup-actionable" data-screen-name="TelegraphNews" data-user-id="2" data-feedback-token="131">\n                    <div class="follow-bar">\n                      <div class="user-actions btn-group including following" data-user-id="2" data-screen-name="TelegraphNews" data-name="Telegraph News" data-protected="false">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div class="stream-item stream-end-item">\n                  <div class="account js-actionable-user js-profile-popup-actionable" data-screen-name="TelegraphNews" data-user-id="1" data-feedback-token="131">\n                    <div class="follow-bar">\n                      <div class="user-actions btn-group including" data-user-id="1" data-screen-name="TelegraphNews" data-name="Telegraph News" data-protected="false">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      ',c=[{scribeContext:{},scribeData:{},feedbackToken:"131",isReplyTo:!1,isMentionClick:!1,isPromotedBadgeClick:!1,itemType:"user",profileClickTarget:"screen_name",userId:"3",containerUserId:"3",position:1}];beforeEach(function(){var a=$(b);setupComponent(a,{closeSelector:".js-close",itemType:"user",userSelector:".js-actionable-user",eventMode:"profileHead",targetSelector:"#suggested-users",childSelector:"",followedButtonSelector:".stream-item .following",lastStreamItemSelector:".stream-end-item",refreshAnimationDuration:0,isClusterFollowReplenishEnabled:!0})}),it("should replace user if user followed",function(){spyOnEvent(document,"uiSuggestedUsersRendered"),$(document).trigger("dataSuggestedUsersSuccess",{html:a,sourceEventData:{userId:15,timeline_recommendations:!0},isReplacement:!0}),expect("uiSuggestedUsersRendered").toHaveBeenTriggeredOnAndWith(document,{isReplacement:!0,items:c,user_id:15}),expect(this.$node.find(".js-actionable-user[data-user-id='2']").length).toEqual(0),expect(this.$node.find(".js-actionable-user[data-user-id='3']").length).toEqual(1)}),it("should not replace user if user not followed",function(){this.$node.find(".js-actionable-user[data-user-id='2'] .following").removeClass("following"),spyOnEvent(document,"uiSuggestedUsersRendered"),$(document).trigger("dataSuggestedUsersSuccess",{html:a,sourceEventData:{userId:15,timeline_recommendations:!0},isReplacement:!0}),expect("uiSuggestedUsersRendered").not.toHaveBeenTriggeredOn(document),expect(this.$node.find(".js-actionable-user[data-user-id='2']").length).toEqual(1),expect(this.$node.find(".js-actionable-user[data-user-id='3']").length).toEqual(0)})}),describe("timeline event mode",function(){var a=["1","2","3","4"],b=function(a){return'<div class="spec-test" data-item-id="'+a+'"><div class="js-suggested-users-container"></div></div>'},c=function(a){return"<div>"+a+"</div>"},d=a.map(b),e=function(a,b){$(document).trigger("dataSuggestedUsersSuccess",{html:'<div class="js-actionable-user" id="test'+b+'">'+a+'</div><a href="#" class="js-close">Close</a>',sourceEventData:{userId:b,timeline_recommendations:!0}})};beforeEach(function(){setupComponent(c(d),{eventMode:"timeline_recommendations",targetSelector:".spec-test",childSelector:".js-suggested-users-container"})}),describe("on dataSuggestedUsersSuccess",function(){it("fills the element associated with the correct user",function(){e("Hello world",3),expect(this.$node.find(".spec-test[data-item-id='3'] #test3")).toHaveText("Hello world")})}),describe("with a second dataSuggestedUsersSuccess",function(){it("does nothing if the user was already filled",function(){e("Hello world",3),expect(this.$node.find(".spec-test[data-item-id='3'] #test3")).toHaveText("Hello world"),e("Good bye",3),expect(this.$node.find(".spec-test[data-item-id='3'] #test3")).toHaveText("Hello world")}),it("fills the element associated with the user if that user has not been filled",function(){e("Hello world",3),expect(this.$node.find(".spec-test[data-item-id='3'] #test3")).toHaveText("Hello world"),e("foo",1),expect(this.$node.find(".spec-test[data-item-id='1'] #test1")).toHaveText("foo")})}),describe("clicking the close button",function(){it("should close the module and remove the content",function(){var a=this.$node.find(".spec-test[data-item-id='4']");e("Bar",4),expect(a.find(".js-suggested-users-container")).not.toBeEmpty(),a.find(".js-close").trigger("click"),expect(a.find(".js-suggested-users-container")).toBeEmpty()}),it("should close only the module that was clicked",function(){e("Foo",1),e("Bar",2),e("Qux",4);var a=this.$node.find(".spec-test[data-item-id='2'] .js-suggested-users-container");a.find(".js-close").trigger("click"),expect(a).toBeEmpty(),expect(this.$node.find(".spec-test[data-item-id='1'] .js-suggested-users-container")).not.toBeEmpty(),expect(this.$node.find(".spec-test[data-item-id='4'] .js-suggested-users-container")).not.toBeEmpty()})}),it("should not respond to profile events",function(){$(document).trigger("dataSuggestedUsersSuccess",{html:'<div id="test3">Hello</div><a href="#" class="js-close">Close</a>',sourceEventData:{userId:3,profileHead:!0}}),expect(this.$node.find("#test3")).not.toExist()}),it("should not inject HTML from requests with no userID",function(){$(document).trigger("dataSuggestedUsersSuccess",{html:'<div id="testNoId">Hello world</div><a href="#" class="js-close">Close</a>',sourceEventData:{userId:null,timeline_recommendations:!0}}),expect(this.$node.find("#testNoId")).not.toExist()}),it("should trigger 'uiSuggestedUsersRendered' with user_id on successfully injecting HTML",function(){spyOnEvent(document,"uiSuggestedUsersRendered"),e("Bar",2),expect("uiSuggestedUsersRendered").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({user_id:2}))})})})
});
define("test/app/ui/captcha_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/captcha_dialog",function(){beforeEach(function(){var a='<div id="captcha_dialog">\n        <button id="cancel_captcha_button"></button>\n        <button id="lookup_user"></button>\n      </div>\n    ';this.html=a,setupComponent(this.html)}),describe("event uiOpenCaptchaDialog",function(){it("opens the dialog",function(){var a=spyOn(this.component,"open");$(document).trigger("uiOpenCaptchaDialog"),expect(a).toHaveBeenCalled()})}),describe("event click on cancel",function(){it("closes the dialog",function(){var a=spyOn(this.Component.prototype,"close");setupComponent(this.html),this.component.select("cancelSelector").trigger("click"),expect(a).toHaveBeenCalled()})})})
});
define("test/app/ui/with_viewer_follow_state_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_viewer_follow_state",function(){function e(){return b.data("you-follow")}function f(){return c.data("you-follow")}function g(){return d.data("you-follow")}function h(){return b.data("you-block")}function i(){return c.data("you-block")}function j(){return d.data("you-block")}var a='<div>\n      <div id="el1" data-user-id="1" data-you-follow="false" data-you-block="false" />\n      <div id="el2" data-user-id="2" data-you-follow="false" data-you-block="false" />\n      <div id="el3" data-user-id="2" />\n    </div>\n   ',b,c,d;beforeEach(function(){setupComponent(a),b=this.$node.find("#el1"),c=this.$node.find("#el2"),d=this.$node.find("#el3")}),describe("updateYouFollow",function(){it("updates all elements for the correct user which have the data-you-follow flag",function(){this.component.updateYouFollow(2,!0),expect(e()).toBeFalsy(),expect(f()).toBeTruthy(),expect(g()).toBeUndefined()})}),describe("updateYouBlock",function(){it("updates all elements for the correct user which have the data-you-block flag",function(){this.component.updateYouBlock(2,!0),expect(h()).toBeFalsy(),expect(i()).toBeTruthy(),expect(j()).toBeUndefined()})}),describe("uiFollowAction",function(){it("updates the state of the user element",function(){$(document).trigger("uiFollowAction",{userId:1}),expect(e()).toBeTruthy(),expect(h()).toBeFalsy()})}),describe("uiUnfollowAction",function(){it("updates the state of the user element",function(){b.attr("data-you-follow",!0),$(document).trigger("uiUnfollowAction",{userId:1}),expect(e()).toBeFalsy()})}),describe("uiBlockAction uiReportSpamAction uiDidTriggerBlockingAction",function(){var a=["uiBlockAction","uiReportSpamAction","uiDidTriggerBlockingAction"];beforeEach(function(){$(document).trigger("uiFollowAction",{userId:1})}),$.each(a,function(a,b){describe(b,function(){it("sets data-you-follow to false, data-you-block to true",function(){$(document).trigger(b,{userId:1}),expect(e()).toBeFalsy(),expect(h()).toBeTruthy()})})})}),describe("dataFollowStateChange",function(){describe("following",function(){it("sets data-you-follow to true",function(){$(document).trigger("dataFollowStateChange",{userId:1,newState:"following"}),expect(e()).toBeTruthy()}),it("sets data-you-block to false",function(){b.attr("data-you-block","true"),$(document).trigger("dataFollowStateChange",{userId:1,newState:"following"}),expect(h()).toBeFalsy()})}),describe("not-following",function(){it("sets data-you-follow to false",function(){$(document).trigger("uiFollowAction",{userId:1}),$(document).trigger("dataFollowStateChange",{userId:1,newState:"not-following"}),expect(e()).toBeFalsy()}),it("sets data-you-block to false",function(){b.attr("data-you-block","true"),$(document).trigger("dataFollowStateChange",{userId:1,newState:"not-following"}),expect(h()).toBeFalsy()})}),describe("blocked",function(){it("sets data-you-follow to false",function(){$(document).trigger("uiFollowAction",{userId:1}),$(document).trigger("dataFollowStateChange",{userId:1,newState:"blocked"}),expect(e()).toBeFalsy()}),it("sets data-you-block to true",function(){$(document).trigger("dataFollowStateChange",{userId:1,newState:"blocked"}),expect(h()).toBeTruthy()})}),describe("other",function(){it("does not update any attrs",function(){spyOn(this.component,"updateYouFollow"),spyOn(this.component,"updateYouBlock"),$(document).trigger("dataFollowStateChange",{userId:1,newState:"pending"}),expect(this.component.updateYouFollow).not.toHaveBeenCalled(),expect(this.component.updateYouBlock).not.toHaveBeenCalled()})})})})
});
define("test/app/ui/theme_picker_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/theme_picker",function(){beforeEach(function(){var a='<form id="fixture">';a+='<div id="background_color" style="background-color: #cacaca;"></div>',a+='<button type="button" class="theme" data-image="/images/themes/theme11/bg.gif" data-id="11" data-background_color="#FF6699" data-link_color="#B40B43" data-tiled="true"></button>',a+="</form>",setupComponent(a)}),describe("When a user clicks on a theme",function(){it("triggers uiThemePicked with data",function(){spyOnEvent(document,"uiThemePicked"),$(".theme").trigger("click"),expect("uiThemePicked").toHaveBeenTriggeredOnAndWith(document,{id:"11",backgroundColor:"#FF6699",linkColor:"#B40B43",image:"/images/themes/theme11/bg.gif",tiled:!0})})})})
});
define("test/app/ui/spoonbill_producer_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/spoonbill_producer",function(){beforeEach(function(){var a=$('<div id="spoonbill-outer"></div>');setupComponent(a),jasmine.Clock.useMock(),spyOn(this.component,"showNextSpoonbill").andCallThrough(),this.component.off(document,"uiRequestNextSpoonbill"),this.component.on(document,"uiRequestNextSpoonbill",this.component.showNextSpoonbill),this.component.trigger("uiNewSpoonbillsArrived",{spoonbills:[{type:"mention",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:"BarackObama",retweeter:"",include_image_picker:!0,timestamp:0}]}),expect("uiRequestRotateSpoonbill").not.toHaveBeenTriggeredOn(document),this.component.on("uiRequestSpoonbillRender",function(b,c){$(a).empty();var d="spoonbill_"+(new Date).getTime();$('<div class="WebNotification" id="'+d+'"></div>').appendTo(a),c.elementId=d,this.trigger("uiSpoonbillDidShow",c)})}),it("accepts incoming notifications in batch",function(){spyOnEvent(document,"uiRequestRotateSpoonbill"),spyOnEvent(document,"uiRequestSpoonbillRender"),this.component.trigger("uiNewSpoonbillsArrived",{spoonbills:[{type:"mention",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:"BarackObama",retweeter:"",include_image_picker:!0,timestamp:1},{type:"dm",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:"BarackObama",retweeter:"",timestamp:2}]}),expect("uiRequestRotateSpoonbill").toHaveBeenTriggeredOn(document),expect("uiRequestSpoonbillRender").toHaveBeenTriggeredOn(document);var a=$(".WebNotification");expect(a).toExist()}),it("ignores unknown notification type",function(){spyOnEvent(document,"uiRequestRotateSpoonbill"),spyOnEvent(document,"uiRequestSpoonbillRender"),this.component.trigger("uiNewSpoonbillsArrived",{spoonbills:[{type:"What_The_Heck"}]}),expect("uiRequestRotateSpoonbill").not.toHaveBeenTriggeredOn(document),expect("uiRequestSpoonbillRender").not.toHaveBeenTriggeredOn(document);var a=$(".WebNotification");expect(a).not.toExist()}),it("dismiss a notification if not interacted with",function(){var a=$(".WebNotification");this.component.trigger("uiNewSpoonbillsArrived",{spoonbills:[{type:"mention",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:"BarackObama",retweeter:"",include_image_picker:!0,timestamp:1}]});var a=$(".WebNotification");jasmine.Clock.tick(this.component.attr.cycleTime),expect(a).not.toExist()}),it("keep a notification if the tweet box is focused",function(){this.component.trigger("uiNewSpoonbillsArrived",{spoonbills:[{type:"mention",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:"BarackObama",retweeter:"",include_image_picker:!0,timestamp:1}]}),$("#spoonbill_tweet_box").focus();var a=$(".WebNotification");jasmine.Clock.tick(this.component.attr.cycleTime),expect(a).not.toExist()}),it("keep a notification is cursor is over it",function(){this.component.trigger("uiNewSpoonbillsArrived",{spoonbills:[{type:"mention",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:"BarackObama",retweeter:"",include_image_picker:!0,timestamp:1}]});var a=$(".WebNotification");$(a).trigger("mouseenter"),jasmine.Clock.tick(this.component.attr.cycleTime),expect(a).toExist()}),it("dismiss a kept notification when cursor move out",function(){this.component.trigger("uiNewSpoonbillsArrived",{spoonbills:[{type:"mention",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:"BarackObama",retweeter:"",include_image_picker:!0,timestamp:1}]});var a=$(".WebNotification");$(a).trigger("mouseenter"),jasmine.Clock.tick(this.component.attr.cycleTime),$(a).trigger("mouseleave"),jasmine.Clock.tick(this.component.attr.cycleTime),expect(a).not.toExist()}),it("only shows certain number of notifications per cycle",function(){var a=[];for(var b=0;b<this.component.attr.numberOfNotifications*2;b++)a.push({type:"mention",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:"BarackObama",retweeter:"",include_image_picker:!0,timestamp:1});this.component.trigger("uiNewSpoonbillsArrived",{spoonbills:a}),jasmine.Clock.tick(this.component.attr.cycleTime),expect(this.component.showNextSpoonbill.callCount).toEqual(this.component.attr.numberOfNotifications),jasmine.Clock.tick(this.component.attr.cycleTime),expect(this.component.showNextSpoonbill.callCount).toEqual(this.component.attr.numberOfNotifications*2)})})
});
define("test/app/ui/tweet_box_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/tweet_box",function(){var html='<form class="tweet-form" method="post" target="tweet-post-iframe" action="/i/tweet/create_with_media.iframe" enctype="multipart/form-data">\n      <input type="hidden" name="post_authenticity_token" class="auth-token">\n      <input type="hidden" name="iframe_callback" class="iframe-callback">\n      <input type="hidden" name="in_reply_to_status_id" class="in-reply-to-status-id">\n      <input type="hidden" name="impression_id" class="impression-id">\n      <input type="hidden" name="disclosure_type" class="disclosure-type">\n      <div class="tweet-content">\n        <textarea class="tweet-box" name="status"></textarea>\n        <div class="thumbnail-container">\n          <div class="preview">\n            <div class="dismiss">\n              <i class="close"></i>\n            </div>\n            <span class="filename"></span>\n          </div>\n          <div class="preview-message">Image will appear as a link</div>\n        </div>\n      </div>\n      <div class="toolbar js-toolbar">\n        <div class="tweet-box-extras">\n          <div class="photo-selector">\n            <button class="btn" type="button">\n              <i class="tweet-camera"></i>\n            </button>\n            <div class="image-selector">\n              <input type="hidden" name="media_data_empty" class="file-data">\n              <input type="file" name="media_empty" class="file-input">\n              <div class="swf-container"></div>\n            </div>\n          </div>\n          <button class="btn" type="button">\n            <i class="tweet-geo"></i>\n          </button>\n        </div>\n        <div class="tweet-button">\n          <span class="tweet-counter">140</span>\n          <button class="btn primary-btn tweet-action disabled" type="button">\n            <span class="button-text tweeting-text">{{_i}}Tweet{{/i}}</span>\n            <span class="button-text messaging-text">{{_i}}Send message{{/i}}</span>\n          </button>\n        </div>\n      </div>\n    </form>\n  ';beforeEach(function(){setupComponent(html,{modal:!0,condensable:!0,eventParams:{type:"Tweet"},defaultText:"Default text",draftTweetId:"tweetbox"})}),describe("sending a tweet with and without media",function(){it("triggers uiSendTweet when tweeting without media",function(){spyOnEvent(this.$node,"uiSendTweet"),this.component.val("test"),this.component.trigger("uiTweetTextUpdated"),this.component.sendTweet(),expect("uiSendTweet").toHaveBeenTriggeredOn(this.$node)}),it("triggers uiSendTweetWithMedia when tweeting with media",function(){spyOnEvent(this.$node,"uiSendTweetWithMedia"),this.component.val("test"),this.$node.trigger("uiTweetBoxShowPreview",{fileName:"test.jpg"}),this.component.sendTweet(),expect("uiSendTweetWithMedia").toHaveBeenTriggeredOn(this.$node)}),it("adds correct classes to tweetbox when uiTweetBoxShowPreview is triggered",function(){this.$node.trigger("uiTweetBoxShowPreview",{}),expect(this.$node).toHaveClass("has-preview"),this.$node.trigger("uiTweetBoxHidePreview"),expect(this.$node).not.toHaveClass("has-preview"),this.$node.trigger("uiTweetBoxShowPreview",{imageData:"blah"}),expect(this.$node).toHaveClass("has-preview has-thumbnail")})}),describe("relaying that a tweet was sent to the ui",function(){it("triggers uiTweetSent when dataTweetSuccess is received on document",function(){spyOnEvent(this.$node,"uiTweetSent"),spyOnEvent(this.$node,"uiShowMessage"),spyOnEvent(this.$node,"uiTweetboxTweetSuccess"),spyOnEvent(this.$node,"uiTweetboxReplySuccess"),spyOnEvent(this.$node,"uiTweetboxDMSuccess"),this.component.tweetboxId=1,$(document).trigger("dataTweetSuccess",{tweetboxId:1,message:"success!"}),expect("uiTweetSent").toHaveBeenTriggeredOn(this.$node),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(this.$node,{message:"success!"}),expect("uiTweetboxTweetSuccess").toHaveBeenTriggeredOn(this.$node),this.component.attr.inReplyToStatusId=1,$(document).trigger("dataTweetSuccess",{tweetboxId:1}),expect("uiTweetboxReplySuccess").toHaveBeenTriggeredOn(this.$node),this.component.attr.inReplyToStatusId=undefined,this.component.val("d @username blah"),$(document).trigger("dataTweetSuccess",{tweetboxId:1,message:"success!"}),expect("uiTweetboxDMSuccess").toHaveBeenTriggeredOn(this.$node),expect("uiTweetboxTweetSuccess").toHaveBeenTriggeredOn(this.$node)})}),describe("tweetbox should have correct classes when preview is shown",function(){it("should have has-preview class when showPreview event is called without imageData",function(){this.$node.trigger("uiTweetBoxShowPreview",{fileName:"test.jpg"}),expect(this.component.$node).toHaveClass("has-preview"),expect(this.component.$node).not.toHaveClass("has-thumbnail")}),it("should have has-preview and has-thumbnail class when showPreview event is called with imageData",function(){this.$node.trigger("uiTweetBoxShowPreview",{fileName:"test.jpg",imageData:"blah"}),expect(this.component.$node).toHaveClass("has-preview"),expect(this.component.$node).toHaveClass("has-thumbnail")})}),describe("tweetbox should detect when text is a direct message",function(){it('should change the action button text to "Send message" when it detects a dm (by adding class)',function(){spyOnEvent(this.component.$node,"uiDialogUpdateTitle"),this.component.val("d @username blah"),expect(this.component.select("tweetActionSelector")).toHaveClass("messaging"),expect("uiDialogUpdateTitle").toHaveBeenTriggeredOnAndWith(this.$node,{title:"Message @username"})}),it('should change the action button text back to "Tweet" if the message is not a dm (by removing class)',function(){this.component.val("d @username blah"),expect(this.component.select("tweetActionSelector")).toHaveClass("messaging"),this.component.val("hello"),expect(this.component.select("tweetActionSelector")).not.toHaveClass("messaging")}),it("should fire uiDialogUpdateTitle if the dm username changes",function(){spyOnEvent(this.component.$node,"uiDialogUpdateTitle"),this.component.val("d @username blah"),expect(this.component.select("tweetActionSelector")).toHaveClass("messaging"),expect("uiDialogUpdateTitle").toHaveBeenTriggeredOnAndWith(this.$node,{title:"Message @username"}),this.component.val("d @nobody sdfsf"),expect("uiDialogUpdateTitle").toHaveBeenTriggeredOnAndWith(this.$node,{title:"Message @nobody"})}),it("should disable Send message button until there is a valid user and text",function(){this.component.val("dm "),expect(this.component.select("tweetActionSelector")).not.toHaveClass("messaging"),this.component.val("dm k"),expect(this.component.select("tweetActionSelector")).toHaveClass("messaging"),expect(this.component.select("tweetActionSelector")).toHaveClass("disabled"),this.component.val("dm !k hi"),expect(this.component.select("tweetActionSelector")).toHaveClass("disabled"),this.component.val("dm k hi"),expect(this.component.select("tweetActionSelector")).not.toHaveClass("disabled")})}),describe("tweetbox should have correct default text",function(){it("should have condensedText in textSelector intially",function(){expect(this.component.val()).toEqual("Compose new Tweet...")}),it("should have defaultText when opened",function(){this.component.trigger("uiPrepareTweetBox"),expect(this.component.val()).toEqual("Default text")}),it("should reset to condensedText when textSelector is blurred and the user hasn't entered any text",function(){this.component.trigger("uiPrepareTweetBox"),expect(this.component.val()).toEqual("Default text"),this.component.$text.blur(),expect(this.component.val()).toEqual("Compose new Tweet...")}),it("should reset to condensedText when textSelector is blurred and the user has entered only whitespace",function(){this.component.trigger("uiPrepareTweetBox"),this.component.val(this.component.attr.defaultText+" "),this.component.$text.blur(),expect(this.component.val()).toEqual("Compose new Tweet...")}),it("should not reset to condensedText when textSelector is blurred if the user has entered text",function(){this.component.trigger("uiPrepareTweetBox"),expect(this.component.val()).toEqual("Default text"),this.component.val("Things are pretty awesome"),this.component.$text.blur(),expect(this.component.val()).toEqual("Things are pretty awesome")}),it("should fire uiTextChanged whenever the value is set",function(){spyOnEvent(this.component.$node,"uiTextChanged"),this.component.val("test"),expect("uiTextChanged").toHaveBeenTriggeredOnAndWith(this.component.$node,{text:"test",position:jasmine.any(Number),condensed:!0})}),it("should fire uiTextChanged with the correct condensed value",function(){spyOnEvent(this.component.$node,"uiTextChanged"),this.component.condensed=!1,this.component.val("test"),expect("uiTextChanged").toHaveBeenTriggeredOnAndWith(this.component.$node,{text:"test",position:jasmine.any(Number),condensed:!1})}),it("should not let you Tweet the default text",function(){this.component.trigger("uiPrepareTweetBox"),this.component.updateTweetButton(),expect(this.component.select("tweetActionSelector")).toHaveClass("disabled")}),it("should not let you tweet if you are already tweeting",function(){this.component.trigger("uiPrepareTweetBox"),this.component.$node.addClass("tweeting"),this.component.updateTweetButton(),expect(this.component.select("tweetActionSelector")).toHaveClass("disabled")})}),describe("tweetbox should set the overriden cursor position",function(){it("should set the cursor position given in the data object",function(){$(document).trigger("uiOverrideTweetBoxOptions",{cursorPosition:10,defaultText:"cursor in 10"}),this.component.trigger("uiPrepareTweetBox");var a=this.component.select("textSelector");expect(a[0].selectionStart).toBe(10)}),it("should set the cursor at the end if no position is defined",function(){$(document).trigger("uiOverrideTweetBoxOptions",{defaultText:(new Array(20)).join("0")}),this.component.trigger("uiPrepareTweetBox");var a=this.component.select("textSelector");expect(a[0].selectionStart).toBe(19)})}),describe("tweet process should respect eventParam",function(){it('should not tweet if eventParam is not "tweet"',function(){setupComponent(html,{modal:!0}),spyOnEvent(this.component.$node,"uiSendTweet"),$(document).trigger("uiOverrideTweetBoxOptions",{id:1,impressionId:2,defaultText:"new default"}),this.component.trigger("uiPrepareTweetBox"),this.component.val("text"),this.component.trigger("uiTweetTextUpdated"),this.component.tweetboxId=1,this.component.sendTweet(),expect("uiSendTweet").not.toHaveBeenTriggeredOn(this.component.$node)})}),describe("tweetbox should have correct state when it's a reply",function(){it("should update the reply id & default text when uiOverrideTweetBoxOptions event is triggered",function(){spyOnEvent(this.component.$node,"uiSendTweet"),$(document).trigger("uiOverrideTweetBoxOptions",{id:1,impressionId:2,disclosureType:"promoted",defaultText:"new default"}),this.component.trigger("uiPrepareTweetBox"),expect(this.component.val()).toEqual("new default"),this.component.val("text"),this.component.trigger("uiTweetTextUpdated"),this.component.tweetboxId=1,this.component.sendTweet(),expect("uiSendTweet").toHaveBeenTriggeredOnAndWith(this.component.$node,{tweetboxId:1,tweetData:{status:"text",in_reply_to_status_id:1,impression_id:2,earned:!1}})})}),describe("event ui{{type}}BoxReset",function(){it("focuses the tweetbox",function(){this.component.select("textSelector").trigger("blur"),this.component.trigger("uiTweetBoxReset"),expect(this.component.select("textSelector")).toBeFocused()}),it("fills the tweetbox with default text",function(){$(document).trigger("uiOverrideTweetBoxOptions",{defaultText:"new default"}),this.component.trigger("uiTweetBoxReset"),expect(this.component.val()).toEqual("new default")}),it("triggers ui{{type}}HidePreview",function(){spyOnEvent(this.component.$node,"uiTweetBoxHidePreview"),this.component.trigger("uiTweetBoxReset"),expect("uiTweetBoxHidePreview").toHaveBeenTriggeredOn(this.component.$node)}),it("resets hidden elements",function(){this.$node.find("input[type=hidden]").val("hidden data"),this.component.trigger("uiTweetBoxReset"),expect(this.$node.find("input[type=hidden]")).toHaveText("")}),it("disables the tweetbox",function(){this.component.trigger("uiTweetBoxReset"),expect(this.component.select("tweetActionSelector")).toHaveClass("disabled")})}),describe("#enable",function(){it("triggers uiEnableTweetAction",function(){spyOnEvent(this.$node,"uiEnableTweetAction"),this.component.enable(),expect("uiEnableTweetAction").toHaveBeenTriggeredOn(this.$node)})}),describe("#disable",function(){it("triggers uiDisableTweetAction",function(){spyOnEvent(this.$node,"uiDisableTweetAction"),this.component.disable(),expect("uiDisableTweetAction").toHaveBeenTriggeredOn(this.$node)})}),describe("the tweet button should only be enabled when tweet is valid",function(){beforeEach(function(){this.component.trigger("uiPrepareTweetBox"),this.checkStatusLengths=function(a){a.forEach(function(a){this.component.val(a.status),expect(this.component.getLength()).toEqual(a.len),expect(this.component.select("counterSelector").text()).toEqual(140-a.len+"")},this)}});var status130char=(new Array(131)).join("a"),status140char=(new Array(141)).join("a"),status141char=(new Array(142)).join("a");it("disables tweet button by default",function(){expect(this.component.select("tweetActionSelector")).toHaveClass("disabled")}),it("disables tweet button if content is over 140 chars",function(){this.component.val(status140char),this.component.trigger("uiTweetTextUpdated"),expect(this.component.select("tweetActionSelector")).not.toHaveClass("disabled"),this.component.val(status141char),this.component.trigger("uiTweetTextUpdated"),expect(this.component.select("tweetActionSelector")).toHaveClass("disabled")}),it("disables the tweet button if status is empty with no media",function(){this.component.val(""),this.component.trigger("uiTweetTextUpdated"),expect(this.component.select("tweetActionSelector")).toHaveClass("disabled")}),it("disables the tweet button if status is same as defaultText with no media",function(){this.component.attr.defaultText="default ",this.component.val("default"),this.component.trigger("uiTweetTextUpdated"),expect(this.component.select("tweetActionSelector")).toHaveClass("disabled")}),it("enables the tweet button if status is empty with media",function(){this.component.select("textSelector").val(""),this.$node.trigger("uiTweetBoxShowPreview",{fileName:"test.jpg"}),this.component.trigger("uiTweetTextUpdated"),expect(this.component.select("tweetActionSelector")).not.toHaveClass("disabled")}),it("disables the tweet button if status with media is over 140 chars",function(){this.component.val(status130char),this.$node.trigger("uiTweetBoxShowPreview",{fileName:"test.jpg"}),this.component.trigger("uiTweetTextUpdated"),expect(this.component.select("tweetActionSelector")).toHaveClass("disabled")}),it("should detect links and adjust the counter properly",function(){var a=[{status:"blah http://www.twitter.com blah",len:32},{status:"blah http://www.twitter.com http://www.google.com blah",len:55},{status:"blah https://www.twitter.com blah",len:33},{status:"blah https://www.twitter.com https://www.google.com blah",len:57},{status:"blah http://www.twitter.com https://www.google.com blah",len:56}];this.checkStatusLengths(a)}),it("should set the counter correctly for unicode chars outside the basic multilingual plane",function(){var statuses=[{status:"퟿",len:2},{status:"𐏿",len:1},{status:"񐄀񐄀񐄀",len:3},{status:eval("'\\uDFFF\\uD800'"),len:2}];this.checkStatusLengths(statuses)})}),describe("TweetBox with condensable option",function(){it("condenses text when enabled",function(){setupComponent(html,{condensable:!0,defaultText:"Default text",eventParams:{type:"Tweet"}}),this.component.trigger("uiPrepareTweetBox"),expect(this.component.val()).toEqual("Default text"),this.component.$text.blur(),expect(this.component.val()).toEqual("Compose new Tweet...")}),it("condenses on blur if the user has removed all text",function(){setupComponent(html,{condensable:!0,defaultText:"Default text",eventParams:{type:"Tweet"}}),this.component.trigger("uiPrepareTweetBox"),this.component.val(""),this.component.$text.blur(),expect(this.component.val()).toEqual("Compose new Tweet..."),this.component.focus(),expect(this.component.val()).toEqual("Default text")}),it("does not condense if the tweetbox has media attached with no text",function(){expect(this.$node).toHaveClass("condensed"),this.component.focus(),expect(this.$node).not.toHaveClass("condensed"),this.component.val(""),this.$node.trigger("uiTweetBoxShowPreview",{fileName:"test.jpg"}),this.component.$text.blur(),expect(this.$node).not.toHaveClass("condensed")}),it("does not condense text when disabled",function(){setupComponent(html,{condensable:!1,defaultText:"Default text",eventParams:{type:"Tweet"}}),this.component.trigger("uiPrepareTweetBox"),expect(this.component.val()).toEqual("Default text"),this.component.$text.blur(),expect(this.component.val()).toEqual("Default text")}),it("does not condense when focused and the user clicks on any element inside its form before adding any text",function(){this.component.focus(),this.component.val(""),this.component.select("imageSelector").trigger("mousedown"),expect(this.$node).not.toHaveClass("condensed")}),it("does not condense when media is attached and the user clicks any element outside the context of the form",function(){this.component.focus(),this.component.val(""),this.$node.trigger("uiTweetBoxShowPreview",{fileName:"test.jpg"});var a=$('<button type="button">Click Me</button>');attachFixtureToDom(a),a.click(),expect(this.$node).not.toHaveClass("condensed")})}),describe("when the input element used for image uploads is focused",function(){it("styles the proxy button to look focused",function(){setupComponent(html,{defaultText:"Default text",eventParams:{type:"Tweet"}}),this.component.select("imageSelector").find(".file-input").focus(),expect(this.component.select("imageBtnSelector")).toHaveClass(this.component.attr.focusClass)})}),describe("when the input element used for image uploads loses focus",function(){it("removes the focus styles from the proxy button",function(){setupComponent(html,{defaultText:"Default text",eventParams:{type:"Tweet"}}),this.component.select("imageSelector").find(".file-input").focus(),this.component.select("imageSelector").find(".file-input").blur(),expect(this.component.select("imageBtnSelector")).not.toHaveClass(this.component.attr.focusClass)})}),describe("With RTL support",function(){describe("erasePastMarkers",function(){it("should backspace over markers",function(){var a=this.component.$text;a.focus(),a.val("Hi‎‏"),this.Component.caret.setPosition(a.get(0),4);var b=$.Event("keydown");b.which=8,a.trigger(b),expect(a.val()).toEqual("H")}),it("should delete forward over markers",function(){var a=this.component.$text;a.focus(),a.val("‎‏Hi"),this.Component.caret.setPosition(a.get(0),0);var b=$.Event("keydown");b.which=46,a.trigger(b),expect(a.val()).toEqual("i")})}),describe("setting and getting rtl text with val",function(){var a="ימון נגד ינגולשטד מהליגה השנייה",b,c;beforeEach(function(){c=a+" @user",b=this.component.$text,b.focus(),this.component.val(c)}),it("should set dir to RTL",function(){expect(b.attr("dir")).toEqual("rtl")}),it("should set text markers around user",function(){expect(b).toHaveValue(a+" ‎@user‏")}),it("should return plain text from val",function(){expect(this.component.val()).toEqual(c)}),it("should not count marker chars in character counter",function(){expect(this.component.getLength()).toEqual(c.length)}),it("should set the cursor position to the end of the text",function(){b.focus(),this.component.setCursorPosition(),expect(b[0].selectionStart).toBe(b.val().length)}),it("should set dir back to LTR",function(){this.component.val(a+" @user and then lots of other LTR text "+"was added so the count went below 30%"),expect(b.attr("dir")).toEqual("ltr")}),it("should set dir to default LTR when nothing but whitespace",function(){this.component.val("  "),expect(b.attr("dir")).toEqual("ltr")}),it("should set dir to default RTL when nothing but whitespace",function(){this.component.attr.isRTL=!0,this.component.val("  "),expect(b.attr("dir")).toEqual("rtl")})})}),describe("with draft tweets",function(){it("overrides draftTweetId on uiOverride{{type}}BoxOptions",function(){this.component.trigger("uiOverrideTweetBoxOptions",{draftTweetId:"new_tweetbox"}),expect(this.component.attr.draftTweetId).toEqual("new_tweetbox")}),it("stores the text entered into the tweetbox excluding trailing whitespace as a draft tweet",function(){this.component.focus(),this.component.val(" draft tweet "),expect(this.component.getDraftTweet()).toEqual("draft tweet")}),describe("with a draft tweet set",function(){beforeEach(function(){this.component.draftTweets().setItem(this.component.attr.draftTweetId,"draft tweet"),expect(this.component.getDraftTweet()).toEqual("draft tweet")}),describe("initializing the tweetbox",function(){beforeEach(function(){setupComponent(html,{modal:!0,condensable:!1,eventParams:{type:"Tweet"},defaultText:"Default text",draftTweetId:"tweetbox"}),this.component.trigger("uiPrepareTweetBox")}),it("expands the tweetbox",function(){expect(this.$node).not.toHaveClass("condensed")}),it("sets the tweet button enabled",function(){expect(this.component.select("tweetActionSelector")).not.toHaveClass("disabled")}),it("sets the cursor position to the end of the draft tweet",function(){var a=this.component.select("textSelector");expect(a[0].selectionStart).toBe(this.component.getDraftTweet().length)})}),describe("clearing the draft tweet",function(){beforeEach(function(){this.component.focus()}),it("clears when the empty string + trailing whitespace is entered into the tweetbox",function(){this.component.val(" "),expect(this.component.getDraftTweet()).toBeNull()}),it("clears when the condensed text + trailing whitespace is entered into the tweetbox",function(){this.component.val(this.component.attr.condensedText+" "),expect(this.component.getDraftTweet()).toBeNull()}),it("clears when the default text + trailing whitespace is entered into the tweetbox",function(){this.component.val(this.component.attr.defaultText+" "),expect(this.component.getDraftTweet()).toBeNull()}),it("clears after tweeting",function(){this.component.trigger("uiTweetSent"),expect(this.component.getDraftTweet()).toBeNull()})})})}),describe("ignoreDuringFakeFocus",function(){var a,b;beforeEach(function(){a=jasmine.createSpy(),b=this.component.ignoreDuringFakeFocus(a)}),it("calls through when fake-focus class is not on the text node",function(){b(),expect(a).toHaveBeenCalled()}),it("does not call through when fake-focus class is on the text node",function(){this.component.$text.addClass("fake-focus"),b(),expect(a).not.toHaveBeenCalled()})})})
});
define("test/app/ui/aria_event_logger_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/aria_event_logger",function(){var a='<ol class="expanded-conversation">\n      <li id="item-1"></li>\n      <li id="item-2"></li>\n      <li id="item-3"></li>\n    </ol>\n  ';beforeEach(function(){setupComponent(a),this.component.trigger("uiSwiftLoaded")}),afterEach(function(){this.component.$log.remove()}),describe("when the uiSwiftLoaded is triggered",function(){it("creates the logger",function(){expect(this.component.$log.length).toBe(1)})}),describe("when the context is changed",function(){it("clears the logger",function(){this.component.trigger("uiDidFavoriteTweet"),this.component.trigger("uiPageChanged"),expect(this.component.$log.children().length).toBe(0)})}),describe("when an event is trigger",function(){it("appends the event to the log",function(){this.component.trigger("uiDidFavoriteTweet"),expect(this.component.$log.children().eq(0)).toHaveText(this.component.MESSAGES.FAVORITED)})}),describe("when the log size exceeds three messages",function(){it("removes the oldest message from the log",function(){this.component.trigger("uiDidFavoriteTweet"),this.component.trigger("uiDidRetweet"),this.component.trigger("uiHasExpandedTweet"),this.component.trigger("uiHasCollapsedTweet"),expect(this.component.$log.children().first()).toHaveText(this.component.MESSAGES.RETWEETED)})}),describe("when the user navigates to the first item in an expanded conversation",function(){it("logs the user has reached the end of the conversation",function(){this.component.trigger(this.component.$node.find("#item-1"),"uiPreviousItemSelected"),expect(this.component.$log.children().first()).toHaveText(this.component.MESSAGES.CONVERSATION_START)})}),describe("when the user navigates to the last item in an expanded conversation",function(){it("logs the user has reached the end of the conversation",function(){this.component.trigger(this.component.$node.find("#item-3"),"uiNextItemSelected"),expect(this.component.$log.children().first()).toHaveText(this.component.MESSAGES.CONVERSATION_END)})}),describe("when the user navigates to the only item in an expanded conversation",function(){beforeEach(function(){this.component.$node.find("#item-2").remove(),this.component.$node.find("#item-3").remove()}),it("does not log the user has reached the start of the conversation",function(){this.component.trigger(this.component.$node.find("#item-1"),"uiPreviousItemSelected"),expect(this.component.$log.children().first()).not.toHaveText(this.component.MESSAGES.CONVERSATION_START)}),it("does not log the user has reached the end of the conversation",function(){this.component.trigger(this.component.$node.find("#item-1"),"uiNextItemSelected"),expect(this.component.$log.children().first()).not.toHaveText(this.component.MESSAGES.CONVERSATION_END)})}),describe("when logging the number of remaining characters in the Tweetbox",function(){it("clears the entire contents of the log first",function(){this.component.trigger("uiDidFavoriteTweet"),this.component.trigger("uiDidRetweet"),this.component.trigger(document,"uiCharCountWarningVisible",{charCount:5}),expect(this.component.$log.length).toBe(1)})})})
});
define("test/app/ui/with_select_all_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_select_all",function(){beforeEach(function(){var a='<div>\n        <div class="select-all-people">\n          <label class="contacts-select-all">\n            <input type="checkbox" class="select-all-contacts" name="select_all">\n            Select all 4\n          </label>\n        </div>\n\n        <div class="contacts">\n          <label class="contact-item">\n            <input name="emails[]" value="john22@twitter.com" id="contact-box-1" type="checkbox">\n          </label>\n          <label class="contact-item">\n            <input name="emails[]" value="john43@twitter.com" id="contact-box-2" type="checkbox">\n          </label>\n          <label class="contact-item">\n            <input name="emails[]" value="john41@twitter.com" id="contact-box-3" type="checkbox">\n          </label>\n          <label class="contact-item">\n            <input name="emails[]" value="john40@twitter.com" id="contact-box-4" type="checkbox">\n          </label>\n        </div>\n\n        <button class="js-invite" disabled>Invite these friends</button>\n      </div>\n    ';setupComponent(a,{checkboxSelector:".contact-item input",selectAllSelector:".select-all-contacts",actionButtonSelector:".js-invite"})}),it("enables and disables the button when selecting",function(){var a=this.component.select("actionButtonSelector");expect(a).toBeDisabled(),this.$node.find("#contact-box-1").click(),expect(a).not.toBeDisabled(),this.$node.find("#contact-box-2").click(),expect(a).not.toBeDisabled(),this.$node.find("#contact-box-1").click(),expect(a).not.toBeDisabled(),this.$node.find("#contact-box-2").click(),expect(a).toBeDisabled()}),it("enables and disables the button when select-alling",function(){var a=this.component.select("actionButtonSelector");expect(a).toBeDisabled(),this.component.select("selectAllSelector").click(),expect(a).not.toBeDisabled(),this.component.select("selectAllSelector").click(),expect(a).toBeDisabled()}),it("checks and unchecks select all when selecting",function(){var a=this.component.select("selectAllSelector");expect(a).not.toBe(":checked"),this.$node.find("#contact-box-1").click(),this.$node.find("#contact-box-2").click(),this.$node.find("#contact-box-3").click(),expect(this.component.select("selectAllSelector")).not.toBe(":checked"),this.$node.find("#contact-box-4").click(),expect(this.component.select("selectAllSelector")).toBe(":checked"),this.$node.find("#contact-box-4").click(),expect(this.component.select("selectAllSelector")).not.toBe(":checked")}),it("checks and unchecks everything when selecting all",function(){expect(this.$node.find("#contact-box-1")).not.toBe(":checked"),expect(this.$node.find("#contact-box-2")).not.toBe(":checked"),expect(this.$node.find("#contact-box-3")).not.toBe(":checked"),expect(this.$node.find("#contact-box-4")).not.toBe(":checked"),this.component.select("selectAllSelector").click(),expect(this.$node.find("#contact-box-1")).toBe(":checked"),expect(this.$node.find("#contact-box-2")).toBe(":checked"),expect(this.$node.find("#contact-box-3")).toBe(":checked"),expect(this.$node.find("#contact-box-4")).toBe(":checked"),this.component.select("selectAllSelector").click(),expect(this.$node.find("#contact-box-1")).not.toBe(":checked"),expect(this.$node.find("#contact-box-2")).not.toBe(":checked"),expect(this.$node.find("#contact-box-3")).not.toBe(":checked"),expect(this.$node.find("#contact-box-4")).not.toBe(":checked")})})
});
define("test/app/ui/validating_fieldset_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/validating_fieldset",function(){beforeEach(function(){var a='<fieldset id="testFieldset"><input id="test" type="text" id="input"><p id="testNotification"></p></fieldset>';setupComponent(a,{name:"Test",input:"#test",notification:"#testNotification",changeEvent:"uiTestChange"}),jQuery.fx.off=!0}),afterEach(function(){jQuery.fx.off=!1}),describe("event dataTestResult",function(){it("applies class ok when valid is true",function(){this.component.trigger("dataTestResult",{valid:!0,msg:"anything!"}),expect($("#testFieldset")).toHaveClass("ok")}),it("applies class problem when valid is false",function(){this.component.trigger("dataTestResult",{valid:!1,msg:"no!"}),expect($("#testFieldset")).toHaveClass("problem")})})})
});
define("test/app/ui/with_import_services_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_import_services",function(){beforeEach(function(){var a='<div class="stream-item">\n      <div class="import-service">\n        <button data-service="gmail" data-height="550" data-width="880" data-url="http://localhost.twitter.com:3000/invitations/oauth_launch?service=gmail" class="btn  primary-btn  js-launch-service">Search contacts</button>\n      </div>\n    </div>\n    ';setupComponent(a,{launchServiceSelector:".js-launch-service"})}),it("pops up OAuth on button click",function(){spyOn(this.component,"oauthPopup"),spyOnEvent(this.$node,"uiImportServiceLaunched"),this.component.select("launchServiceSelector").click(),expect(this.component.oauthPopup).toHaveBeenCalledWith({url:"http://localhost.twitter.com:3000/invitations/oauth_launch?service=gmail",triggerEvent:!0,width:880,height:550}),expect("uiImportServiceLaunched").toHaveBeenTriggeredOnAndWith(this.$node,{service:"gmail"})}),it("shows an error on OAuth error",function(){spyOnEvent(document,"uiShowError"),$(document).trigger("uiOauthImportMissing"),expect("uiShowError").toHaveBeenTriggeredOnAndWith(document,{message:"An error occurred validating your credentials."})}),it("shows a message on OAuth denied",function(){spyOnEvent(document,"uiShowError"),$(document).trigger("uiOauthImportDenied"),expect("uiShowError").toHaveBeenTriggeredOnAndWith(document,{message:"You denied Twitter's access to your contact information."})})})
});
define("test/app/ui/edit_header_button_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/edit_header_button",{fixture:"test/fixtures/own_profile_header"},function(){var a=["uiSwiftLoaded","uiPageChanged"];a.forEach(function(a){describe("on "+a,function(){beforeEach(function(){setupComponent($(this.fixture))}),describe("Listens to dataDeleteImageSuccess",function(){it("and switches to a header absent state",function(){$(document).trigger("dataDeleteImageSuccess",{sourceEventData:{uploadType:"header"}}),expect(this.component.$node).not.toHaveClass("has-header")})}),describe("Listens to dataImageEnqueued",function(){it("and switches to a header present state",function(){$(document).trigger("dataImageEnqueued",{sourceEventData:{uploadType:"header"}}),expect(this.component.$node).toHaveClass("has-header")})})})})})
});
define("test/app/ui/alert_banner_to_message_drawer_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/alert_banner_to_message_drawer",function(){beforeEach(setupComponent),describe("on uiAlertBanner",function(){it("should trigger uiShowMessage",function(){spyOnEvent(document,"uiShowMessage"),this.component.trigger("uiAlertBanner",{message:"hello"}),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"hello"})})})})
});
define("test/app/ui/permalink_keyboard_support_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/permalink_keyboard_support",function(){beforeEach(function(){var a='<div>\n        <div class="tweet permalink-tweet">\n          <a href="#" class="fav"></a>\n          <a href="#" class="reply"></a>\n          <a href="#" class="retweet"></a>\n          <a href="#" class="block"></a>\n          <a href="#" class="unblock"></a>\n        </div>\n      </div>\n    ';setupComponent(a,{favoriteSelector:".fav",replySelector:".reply",retweetSelector:".retweet",blockSelector:".block",unblockSelector:".unblock",permalinkTweetSelector:".permalink-tweet"})}),it("triggers a click on a link when an event is fired",function(){var a={favoriteSelector:"uiShortcutFavorite",replySelector:"uiShortcutReply",retweetSelector:"uiShortcutRetweet",blockSelector:"uiShortcutBlock",unblockSelector:"uiShortcutUnblock"};Object.keys(a).forEach(function(b){var c=a[b];expect(c).toBeTruthy();var d=this.component.select(b);expect(d.length).toBe(1),spyOnEvent(d,"click"),$(document).trigger(c),expect("click").toHaveBeenTriggeredOn(d)}.bind(this))})})
});
define("test/app/ui/with_text_polling_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_text_polling",function(){var a,b,c,d;beforeEach(function(){b=$("<div/>"),c=this.Component.prototype.$text=$("<textarea/>").appendTo(b),a=this.Component.prototype.detectUpdatedText=jasmine.createSpy(),d=!1,this.Component.prototype.hasFocus=function(){return d},jasmine.Clock.useMock()}),it("does not poll before getting focus",function(){setupComponent(b),jasmine.Clock.tick(this.component.attr.pollIntervalInMs*2),expect(a).not.toHaveBeenCalled()});var e=function(){it("polls immediately after getting focused",function(){expect(a).toHaveBeenCalled()}),it("polls every 100 ms when focused",function(){a.reset(),jasmine.Clock.tick(this.component.attr.pollIntervalInMs),expect(a).toHaveBeenCalled(),a.reset(),jasmine.Clock.tick(this.component.attr.pollIntervalInMs),expect(a).toHaveBeenCalled()}),it("polls one last time after losing focus",function(){d=!1,a.reset(),jasmine.Clock.tick(this.component.attr.pollIntervalInMs),expect(a).toHaveBeenCalled()}),it("stops polling when not focused for two polling cycles",function(){d=!1,jasmine.Clock.tick(this.component.attr.pollIntervalInMs),a.reset(),jasmine.Clock.tick(this.component.attr.pollIntervalInMs),expect(a).not.toHaveBeenCalled()}),it("stops polling after teardown",function(){a.reset(),this.component.teardown(),jasmine.Clock.tick(this.component.attr.pollIntervalInMs),expect(a).not.toHaveBeenCalled(),this.component=null})};describe("text element focused before attach",function(){beforeEach(function(){d=!0,setupComponent(b)}),e()}),describe("text element focused after attach",function(){beforeEach(function(){setupComponent(b),d=!0,c.focus()}),e()})})
});
define("test/app/ui/toolbar_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/toolbar",function(){beforeEach(function(){var a='<div id="toolbar">\n        <button id="btn-1" type="button">One</button>\n        <button id="btn-2" type="button">Two</button>\n        <button id="btn-3" type="button">Three</button>\n      </div>\n    ';setupComponent(a,{buttonsSelector:"button"})}),describe("when toolbar is attached",function(){it("adds an ARIA role of toolbar to the root node",function(){expect(this.$node).toHaveAttr("role","toolbar")})}),describe("when the user presses the left arrow key",function(){it("moves focus to the previous button in the toolbar",function(){$("#btn-3").focus();var a=jQuery.Event("keydown",{which:37});$("#btn-3").trigger(a),expect(document.activeElement).toBe(this.$node.find("#btn-2")[0])})}),describe("when the user presses the right arrow key",function(){it("moves focus to the next button in the toolbar",function(){$("#btn-1").focus();var a=jQuery.Event("keydown",{which:39});$("#btn-1").trigger(a),expect(document.activeElement).toBe(this.$node.find("#btn-2")[0])})})})
});
define("test/app/ui/impression_cookies_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/impression_cookies",function(){beforeEach(function(){var a='<div id="links">\n        <a href="#" data-impression-cookie="an_impression_string" data-send-impression-cookie="true">Promoted Account</a>\n        <a href="#" data-impression-cookie="an_impression_string_no_attr" id="noattr">Promoted Account without attribute</a>\n        <a href="#">Normal Account</a>\n      </div>\n    ';setupComponent(a)}),describe("#sendImpressionCookie",function(){it("writes the impression id to the cookie",function(){spyOn(this.component,"setCookie"),this.component.select("sendImpressionCookieSelector").trigger("click"),expect(this.component.setCookie).toHaveBeenCalledWith("an_impression_string",jasmine.any(Object))}),it("writes the impression id to the cookie when opening a new tab instead of profile popup",function(){spyOn(this.component,"setCookie"),this.$node.find("#noattr").trigger("uiShowProfileNewWindow"),expect(this.component.setCookie).toHaveBeenCalledWith("an_impression_string_no_attr",jasmine.any(Object))}),it("fires uiPromotedLinkClick",function(){spyOnEvent(this.component.node,"uiPromotedLinkClick"),this.component.select("sendImpressionCookieSelector").trigger("click"),expect("uiPromotedLinkClick").toHaveBeenTriggeredOnAndWith(this.component.node,{href:"#"})}),it("doesn't write the cookie if there is no impression",function(){var a='<div id="links">\n          <a href="#" data-send-impression-cookie="true">Promoted Account</a>\n        </div>\n      ';setupComponent(a),spyOn(this.component,"setCookie"),this.$node.select("sendImpressionCookieSelector").trigger("click"),expect(this.component.setCookie).not.toHaveBeenCalled()}),it("doesn't fire uiPromotedLinkClick if there is no impression",function(){var a='<div id="links">\n          <a href="#" data-send-impression-cookie="true">Promoted Account</a>\n        </div>\n      ';setupComponent(a),spyOnEvent(this.component.node,"uiPromotedLinkClick"),this.$node.select("sendImpressionCookieSelector").trigger("click"),expect("uiPromotedLinkClick").not.toHaveBeenTriggeredOn(this.component.node)}),it("doesn't write the cookie if we're going to a phoenix page",function(){var a='<div id="links">\n          <a href="/#!/x5315" data-impression-cookie="an_impression_string" data-send-impression-cookie="true">Promoted Account</a>\n        </div>\n      ';setupComponent(a),spyOn(this.component,"setCookie"),this.$node.select("sendImpressionCookieSelector").trigger("click"),expect(this.component.setCookie).not.toHaveBeenCalled()}),it("doesn't fire uiPromotedLinkClick if we're going to a phoenix page",function(){var a='<div id="links">\n          <a href="/#!/x5315" data-impression-cookie="an_impression_string" data-send-impression-cookie="true">Promoted Account</a>\n        </div>\n      ';setupComponent(a),spyOnEvent(this.component.node,"uiPromotedLinkClick"),this.$node.select("sendImpressionCookieSelector").trigger("click"),expect("uiPromotedLinkClick").not.toHaveBeenTriggeredOn(this.component.node)}),it("doesn't call the function to set the cookie when a normal account is clicked",function(){spyOn(this.component,"setCookie"),this.$node.find("a:not([data-send-impression-cookie])").trigger("click"),expect(this.component.setCookie).not.toHaveBeenCalled()}),it("doesn't fire uiPromotedLinkClick when a normal account is clicked",function(){spyOnEvent(this.component.node,"uiPromotedLinkClick"),this.$node.find("a:not([data-send-impression-cookie])").trigger("click"),expect("uiPromotedLinkClick").not.toHaveBeenTriggeredOn(this.component.node)})})})
});
define("test/app/ui/with_profile_stats_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_profile_stats",function(){var a='<div class="mini-home-profile">\n      <ul class="stats js-mini-profile-stats" data-user-id="16956007">\n        <li><a href="/jeffmagee" data-element-term="tweet_stats">1 Tweet</a></li>\n        <li><a href="/following" data-element-term="following_stats" data-is-compact="true">2K Following</a></li>\n      </ul>\n    </div>\n  ';beforeEach(function(){setupComponent(a),this.stat=function(a){return this.$node.find("[data-element-term="+a+"_stats]").html()}}),describe("on dataGotProfileStats",function(){describe("when userId is not the user displayed",function(){beforeEach(function(){$(document).trigger("dataGotProfileStats",{stats:[{userId:3,stat:"tweet",html:"3 Tweets"}]})}),it("does not change the stat",function(){expect(this.stat("tweet")).toBe("1 Tweet")})}),describe("when userId is the user displayed",function(){beforeEach(function(){$(document).trigger("dataGotProfileStats",{stats:[{user_id:16956007,stat:"tweet",html:"3 Tweets"},{user_id:16956007,stat:"following",html:"4 Following"}]})}),it("updates the stats",function(){expect(this.stat("tweet")).toBe("3 Tweets")}),it("does not update the stats when the number is compact",function(){expect(this.stat("following")).toBe("2K Following")})})})})
});
define("test/app/ui/hidden_ancestors_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/hidden_ancestors",function(){describe("if there are ancestors",function(){beforeEach(function(){var a='<div id="page-container">\n          <div class="in-reply-to">\n            <div class="tweets-wrapper">\n              <div class="stream-top" style="display:none"></div>\n                <ol class="stream-items">\n                  <li class="ancestor">ancestor 1</li>\n                  <li class="ancestor">ancestor 2</li>\n                </ol>\n            </div>\n          </div>\n        </div>\n      ';setupComponent(a),$("html").addClass(this.component.attr.ancestorAdjustmentClass)}),it("removes the ancestor adjustment class in response to the uiSwiftLoaded event",function(){$(document).trigger("uiSwiftLoaded"),expect($("html")).not.toHaveClass(this.component.attr.ancestorAdjustmentClass)}),it("removes the ancestor adjustment class in response to the uiPageChanged event",function(){$(document).trigger("uiPageChanged"),expect($("html")).not.toHaveClass(this.component.attr.ancestorAdjustmentClass)})})})
});
define("test/app/ui/with_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_dialog",function(){var a='<div id="dialog-1" class="modal-container" style="display:none">\n    <div class="close-modal-background-target"></div>\n    <div class="modal">\n      <div class="modal-content">\n        <button type="button" class="modal-btn modal-close js-close">\n          <span class="icon close-medium"><span class="visuallyhidden">Close</span></span>\n        </button>\n        <div class="modal-header"><h3 class="modal-title">header</h3></div>\n        <div class="modal-body">body</div>\n        <div class="modal-footer">footer</div>\n        <div class="modal-overlay"></div>\n      </div>\n    </div>\n  </div>\n  ',b='<form>\n    <input id="text-field-1" type="text" disabled class="js-initial-focus">\n    <input id="text-field-2" type="text">\n  </form>\n  ',c='<form>\n    <input id="text-field-1" type="text" aria-disabled="true" class="js-initial-focus">\n    <input id="text-field-2" type="text">\n  </form>\n  ',d='<form>\n    <input id="text-field-1" type="text" style="display:none" class="js-initial-focus">\n    <input id="text-field-2" type="text">\n  </form>\n  ',e='<form>\n    <input id="text-field-1" type="text" style="visibility:hidden" class="js-initial-focus">\n    <input id="text-field-2" type="text">\n  </form>\n  ',f='<form>\n    <input id="text-field-1" type="text" style="opacity:.5" class="js-initial-focus">\n    <input id="text-field-2" type="text">\n  </form>\n  ',g='<form>\n    <input id="text-field-1" type="text" class="js-initial-focus">\n    <input id="text-field-2" type="text">\n  </form>\n  ',h='<button type="button" class="modal-btn modal-close js-close">\n    <span class="icon close-medium"><span class="visuallyhidden">Close</span></span>\n  </button>\n  <div class="modal-header">Confirm Action</div>\n  <div class="modal-body">\n    <p>Are you sure you want to continue?</p>\n  </div>\n  <div class="modal-footer">\n    <button id="button-1" type="button">Ok</button>\n    <button id="button-2" type="button">Cancel</button>\n  </div>\n  <div class="modal-overlay"></div>\n  ',i='<button type="button" class="modal-btn modal-close js-close">\n    <span class="icon close-medium"><span class="visuallyhidden">Close</span></span>\n  </button>\n  <div class="modal-header">Keyboard Shortcuts</div>\n  <div class="modal-body">\n    <p>Checkout these shortcuts</p>\n  </div>\n  <div class="modal-overlay"></div>\n  ',j='<div class="dropdown">\n    <button type="button" class="dropdown-toggle" id="dropdown-toggle-1">Show Menu</button>\n    <div>\n      <ul>\n        <li tabindex="0" id="menuitem-1">menuitem one</li>\n      </ul>\n    </div>\n  </div>\n  ';beforeEach(function(){var b={width:400,height:200};setupComponent(a,b)}),describe("When the dialog is opened",function(){beforeEach(function(){spyOn(this.component,"position"),spyOnEvent(this.component.$node,"uiDialogOpened"),spyOnEvent(this.component.$node,"uiCloseDropdowns"),this.component.open()}),it('applies the "modal-enabled" class to body',function(){expect($("body").hasClass("modal-enabled")).toBeTruthy()}),it("makes the dialog visible",function(){expect(this.component.$node.is(":visible")).toBeTruthy("")}),it('triggers the "uiDialogOpened" event',function(){expect("uiDialogOpened").toHaveBeenTriggeredOn(this.component.$node)}),it("closes any open dropdown menus",function(){expect("uiCloseDropdowns").toHaveBeenTriggeredOn(this.component.$node)}),it("positions the dialog",function(){expect(this.component.position).toHaveBeenCalled()}),it("resizes the dialog to the specified height",function(){expect(this.component.$dialog).toHaveCss("height",this.component.attr.height+"px")}),it("resizes the dialog to the specified width",function(){expect(this.component.$dialog).toHaveCss("width",this.component.attr.width+"px")}),it("adds a tab stop before the content",function(){expect(this.component.select("firstTabStopSelector")).toExist()}),it("adds a tab stop after the content",function(){expect(this.component.select("lastTabStopSelector")).toExist()}),it("focuses the first focusable descendant",function(){expect(this.component.select("closeButtonSelector")).toBeFocused()})}),describe('If the dialog has the class "draggable" applied',function(){it("makes the dialog draggable when opened",function(){spyOn(this.component.$dialog,"drag"),this.component.$dialog.addClass(this.component.attr.dragabilityClass),this.component.open(),expect(this.component.$dialog.drag).toHaveBeenCalled()})}),describe('If the dialog does not have the class "draggable" applied',function(){it("does not make the dialog draggable when opened",function(){spyOn(this.component.$dialog,"drag"),this.component.open(),expect(this.component.$dialog.drag).not.toHaveBeenCalled()})}),describe('When a dialog is opened and the default behavior of the "uiDialogInitialFocus" event has been prevented',function(){it("does not focus the first focusable descendant",function(){this.component.on("uiDialogInitialFocus",function(a){a.preventDefault()}),this.component.open(),expect(this.component.select("closeButtonSelector")).not.toBeFocused()})}),describe("When the dialog is opened",function(){describe('and one of the descendants has the "js-initial-focus" class applied',function(){describe("and the specified element is disabled",function(){it("it will not focus the specified element",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(b),this.component.open(),expect($("#text-field-1")).not.toBeFocused()}),it("will focus the next focusable descendant",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(b),this.component.open(),expect($("#text-field-2")).toBeFocused()})}),describe('and the specified element has the "aria-disabled" attribute set to true',function(){it("it will not focus the specified element",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(c),this.component.open(),expect($("#text-field-1")).not.toBeFocused()}),it("will focus the next focusable descendant",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(c),this.component.open(),expect($("#text-field-2")).toBeFocused()})}),describe('and the "display" property of the specified element is set to "none"',function(){it("it will not focus the specified element",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(d),this.component.open(),expect($("#text-field-1")).not.toBeFocused()}),it("will focus the next focusable descendant",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(d),this.component.open(),expect($("#text-field-2")).toBeFocused()})}),describe('and the "visibility" property of the specified element is set to "hidden"',function(){it("it will not focus the specified element",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(e),this.component.open(),expect($("#text-field-1")).not.toBeFocused()}),it("will focus the next focusable descendant",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(e),this.component.open(),expect($("#text-field-2")).toBeFocused()})}),describe("and the specified element is not fully opaque",function(){it("it will not focus the specified element",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(f),this.component.open(),expect($("#text-field-1")).not.toBeFocused()}),it("will focus the next focusable descendant",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(f),this.component.open(),expect($("#text-field-2")).toBeFocused()})}),it("generates an id for the dialog element",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(b),this.component.open();var a=this.component.$dialog.closest(this.component.attr.modalContainerSelector);expect(this.component.$dialog.attr("id")).toBe(a.attr("id")+"-dialog")}),it("generates an id for the heading element",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(b),this.component.open();var a=this.component.$dialog.closest(this.component.attr.modalContainerSelector),c=this.component.$dialog.find(this.component.attr.modalTitleSelector);expect(c.attr("id")).toBe(a.attr("id")+"-header")}),it('labels the dialog using the "aria-labelledby" attribute',function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(b),this.component.open();var a=this.component.$dialog.find(this.component.attr.modalTitleSelector);expect(this.component.$dialog.attr("aria-labelledby")).toBe(a.attr("id"))}),it('applies the "aria-controls" attribute to the close button',function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(b),this.component.open();var a=this.component.$dialog.find(this.component.attr.closeButtonSelector);expect(a.attr("aria-controls")).toBe(this.component.$dialog.attr("id"))}),it('applies the "aria-hidden" attribute to the topmost container for the view',function(){$("#fixture_parent").append('<div id="doc"></div>'),this.component.$dialog.find(this.component.attr.modalBodySelector).html(b),this.component.open(),expect($("#doc").attr("aria-hidden")).toBe("true")}),it('applies the "document" role to the node wrapping the dialog content',function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(b),this.component.open(),expect(this.component.$dialog.find(this.component.attr.modalContentSelector).attr("role")).toBe("document")}),describe("and the dialog contains no form controls other than the close button",function(){beforeEach(function(){this.component.$dialog.html(h),this.component.open()}),it('applies the "alertdialog" role to the element with the class "modal"',function(){expect(this.component.$dialog.attr("role")).toBe("alertdialog")}),it("generates a unique id for the dialog's body element",function(){var a=this.component.$dialog.find(this.component.attr.modalBodySelector);expect(a.attr("id")).toBe("dialog-1-body")}),it('describes the dialog using the "aria-describedby" attribute',function(){var a=this.component.$dialog.find(this.component.attr.modalBodySelector);expect(this.component.$dialog.attr("aria-describedby")).toBe(a.attr("id"))}),it('describes the close button using the "aria-describedby" attribute',function(){var a=this.component.$dialog.find(this.component.attr.closeButtonSelector),b=this.component.$dialog.find(this.component.attr.modalBodySelector);expect(a.attr("aria-describedby")).toBe(b.attr("id"))})}),describe("and the dialog contains form controls",function(){beforeEach(function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(b),this.component.open()}),it('applies the "dialog" role to the element with the class "modal"',function(){expect(this.component.$dialog.attr("role")).toBe("dialog")}),it("makes the close button the last Tab stop",function(){expect(this.component.select("lastTabStopSelector").prev()).toHaveClass("modal-close")})}),it("focuses the specified element",function(){this.component.$dialog.find(this.component.attr.modalBodySelector).html(g),this.component.open(),expect($("#text-field-1")).toBeFocused()})}),describe('and the dialog does not have a descendant with the class of "js-initial-focus" applied',function(){describe('but it does have an element with the class of "primary-btn"',function(){it('sets focus to the element with the class of "primary-btn"',function(){this.component.$dialog.html(h);var a=$("#button-2");a.addClass("primary-btn"),this.component.open(),expect(a).toBeFocused()})}),describe('and it does not have an element with the class of "primary-btn"',function(){it("sets focus to the first focusable descendant",function(){this.component.$dialog.html(h),this.component.open(),expect($("#button-1")).toBeFocused()})})}),describe("and the close button is focused initially",function(){beforeEach(function(){this.component.$dialog.html(i),this.component.open()}),it("hides the focus outline",function(){expect(this.component.select("closeButtonSelector")).toHaveClass(this.component.attr.hideFocusClass)}),it("removes the focus outline from the button when it loses focus",function(){var a=this.component.select("closeButtonSelector");a.blur(),expect(a).not.toHaveClass(this.component.attr.hideFocusClass)}),it("shows the focus outline the next time the button receives focus",function(){var a=this.component.select("closeButtonSelector");a.blur(),a.focus(),expect(a).not.toHaveClass(this.component.attr.hideFocusClass)})})}),describe("When a descendant of the dialog is focused",function(){beforeEach(function(){this.component.$dialog.html(h),this.component.open()}),it("the hasFocus method returns true",function(){expect(this.component.hasFocus()).toBe(!0)}),describe("and the dialog is closed",function(){it("blurs the focused element",function(){expect($("#button-1")).toBeFocused(),this.component.close(),expect($("#button-1")).not.toBeFocused()})})}),describe("When none of the descendants of the dialog have focus",function(){it("the hasFocus method returns false",function(){this.component.$dialog.html(h),this.component.open(),document.activeElement.blur(),expect(this.component.hasFocus()).toBe(!1)})}),describe("When a dialog is closed",function(){beforeEach(function(){$("#fixture_parent").append('<div id="doc"></div>'),this.component.open(),spyOn(this.component.$dialogContainer,"fadeOut").andCallThrough(),spyOnEvent(this.component.$node,"uiDialogClosed"),spyOnEvent(this.component.$node,"uiDialogRestorePreviousFocus"),this.component.close()}),it("hides the dialog by fading it out",function(){expect(this.component.$dialogContainer.fadeOut).toHaveBeenCalled()}),it('triggers the "uiDialogRestorePreviousFocus" event',function(){expect("uiDialogRestorePreviousFocus").toHaveBeenTriggeredOn(this.component.$node)}),it('triggers the "uiDialogClosed" event',function(){expect("uiDialogClosed").toHaveBeenTriggeredOn(this.component.$node)}),it("removes the first additonal tab stop created when the dialog was opened",function(){expect(this.component.select("firstTabStopSelector")).not.toExist()}),it("removes the last additonal tab stop created when the dialog was opened",function(){expect(this.component.select("lastTabStopSelector")).not.toExist()}),it('removes the "aria-hidden" attribute from the topmost view container',function(){expect(this.component.select("lastTabStopSelector")).not.toExist()}),describe("and no other dialogs are open",function(){it("hides the modal mask",function(){expect($("body")).not.toHaveClass(this.component.attr.modalEnabledClass)})})}),describe("When two dialogs are dialogs are open and one of them is closed",function(){it("does not remove the modal mask",function(){$("#fixture_parent").append('<div class="modal-container">MODAL DIALOG</div>'),this.component.open(),this.component.close(),expect($("body")).toHaveClass(this.component.attr.modalEnabledClass)})}),describe("When an element in the DOM had focus prior to the dialog being opened and the dialog is closed",function(){it("restores focus to the element that was focused before the dialog was visible",function(){$("#fixture_parent").append('<button type="button" id="previously-focused">Click Me</button>'),$("#previously-focused")[0].focus(),this.component.open(),expect($("#previously-focused")).not.toBeFocused(),expect(this.component.select("closeButtonSelector")).toBeFocused(),this.component.close(),expect($("#previously-focused")).toBeFocused()}),describe("and the previously focused element was a menuitem in a dropdown",function(){it("restores focus to the toggle for the dropdown",function(){$("#fixture_parent").append(j),$("#menuitem-1")[0].focus(),this.component.open(),expect($("#menuitem-1")).not.toBeFocused(),expect(this.component.select("closeButtonSelector")).toBeFocused(),this.component.close(),expect($("#dropdown-toggle-1")).toBeFocused()})}),describe('and the default behavior of the "uiDialogRestorePreviousFocus" is prevented',function(){it("does not restore focus to the element that was focused before the dialog was visible",function(){$("#fixture_parent").append('<button type="button" id="previously-focused">Click Me</button>'),$("#previously-focused")[0].focus(),this.component.open(),expect($("#previously-focused")).not.toBeFocused(),expect(this.component.select("closeButtonSelector")).toBeFocused(),this.component.on("uiDialogRestorePreviousFocus",function(a){a.preventDefault()}),this.component.close(),expect($("#previously-focused")).not.toBeFocused()})})}),describe("If the close button has focus",function(){beforeEach(function(){this.component.open()}),describe("and the user preses the Enter key",function(){it("closes the dialog",function(){var a=jQuery.Event("keydown",{keyCode:13});this.component.select("closeButtonSelector").trigger(a),expect(this.component.isOpen()).toBe(!1)})}),describe("and the user preses the Spacebar key",function(){it("closes the dialog",function(){var a=jQuery.Event("keydown",{keyCode:32});this.component.select("closeButtonSelector").trigger(a),expect(this.component.isOpen()).toBe(!1)})})}),describe("When the dialog is open",function(){beforeEach(function(){this.component.open()}),describe('and the default behavior of the "uiDialogCloseRequested" event is prevented',function(){it("does not close the dialog",function(){this.component.on("uiDialogCloseRequested",function(a){a.preventDefault()}),this.component.trigger("uiShortcutEsc"),expect(this.component.isOpen()).toBe(!0)})}),describe("and the user presses the Esc key",function(){it("closes the dialog",function(){this.component.trigger("uiShortcutEsc"),expect(this.component.isOpen()).toBe(!1)})}),describe("and the user clicks the modal mask",function(){it("closes dialog",function(){this.component.$node.find(".close-modal-background-target").trigger("click"),expect(this.component.isOpen()).toBe(!1)})}),describe("and the user clicks the close button",function(){it("closes dialog",function(){this.component.select("closeButtonSelector").click(),expect(this.component.isOpen()).toBe(!1)})})}),describe("When the user navigates away from the page",function(){it("hides the dialog without animation",function(){spyOn(this.component.$dialogContainer,"fadeOut").andCallThrough(),this.component.open(),this.component.trigger(document,"uiBeforePageChanged"),expect(this.component.$dialogContainer.fadeOut).not.toHaveBeenCalled(),expect(this.component.isOpen()).toBe(!1)})})})
});
define("test/app/ui/navigation_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/navigation",function(){var html='<div>\n      <div id="doc">\n        <a id="newplace" href="/newplace" class="js-nav">PUSHSTATE</a>\n        <div class="js-global-actions"><a id="somewhere" href="/somewhere" class="js-nav">PUSHSTATE</a></div>\n        <a href="#thing" class="normal">NOT PUSHSTATE</a>\n        <div id="page-container"></div>\n      </div>\n    </div>\n  ',originalPath=location.pathname+location.search,originalTitle=document.title;afterEach(function(){history.replaceState({},originalTitle,originalPath)}),eval("provide('noop', function(exports) { exports(function () {}); });"),history.pushState&&(beforeEach(function(){setupComponent(html,{spinnerContainer:"#page-container",pushState:history.pushState})}),describe("clicking on a pushState link when pushState is supported",function(){beforeEach(function(){this.$link=this.component.$node.find("#newplace"),spyOnEvent(this.component.node,"uiNavigate"),spyOnEvent(this.$link,"uiNavigate"),this.$link.trigger("click")}),it("fires a uiNavigate event on the link itself",function(){expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$link,{href:"/newplace"})}),it("fires a uiNavigate event that bubbles to the node",function(){expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.component.node,{href:"/newplace"})})}),describe("clicking on a pushState link with a modifier key",function(){beforeEach(function(){var a=jQuery.Event("click",{ctrlKey:!0});spyOnEvent(this.component.node,"uiNavigate"),this.component.$node.find("a.js-nav").trigger(a)}),it("does not fire a uiNavigate event",function(){expect("uiNavigate").not.toHaveBeenTriggeredOnAndWith(this.component.node,{href:"/newplace"})})}),describe("clicking on a pushState link with the right mouse button",function(){beforeEach(function(){var a=jQuery.Event("click",{which:3});spyOnEvent(this.component.node,"uiNavigate"),this.component.$node.find("a.js-nav").trigger(a)}),it("does not fire a uiNavigate event",function(){expect("uiNavigate").not.toHaveBeenTriggeredOnAndWith(this.component.node,{href:"/newplace"})})}),describe("when the popstate event fires",function(){beforeEach(function(){spyOnEvent(this.component.node,"uiNavigate")}),describe("and the event does not have a state property",function(){it("does not trigger the uiNavigate event",function(){var a=jQuery.Event("popstate",{originalEvent:{}});$(window).trigger(a),expect("uiNavigate").not.toHaveBeenTriggeredOn(this.component.node)})}),describe("and the event does have a state property",function(){it("triggers the uiNavigate event with the URL currently specified in the location bar",function(){var a=jQuery.Event("popstate",{originalEvent:{state:{}}});$(window).trigger(a),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.component.node,{href:[location.pathname,location.search].join(""),isPopState:!0})})})}),describe("when uiNavigate triggers",function(){beforeEach(function(){spyOnEvent(document,"uiShowGlobalLoadingIndicator"),this.component.$node.trigger("dataPageFetch",{})}),it("shows the spinner",function(){expect("uiShowGlobalLoadingIndicator").toHaveBeenTriggeredOn(document)})}),describe("when a dataPageRefresh fires",function(){beforeEach(function(){$(window).scrollTop(200),spyOnEvent(this.component.node,"uiBeforePageChanged"),spyOnEvent(this.component.node,"uiTeardown"),spyOnEvent(this.component.node,"uiPageChanged"),this.component.$node.trigger("dataPageRefresh",{page:"<h1>Hello</h1>",title:"test",module:"noop",body_class_names:"foo",doc_class_names:"bar",page_container_class_names:"baz",init_data:{someData:1,viewContainer:"#page-container",htmlFoucClassNames:"swift-loading another-class",htmlClassNames:"debug"},pushState:!0})}),it("updates the DOM",function(){expect(this.component.select("pageContainer").find("h1").text()).toBe("Hello")}),it("applies the class(es) specified in the htmlClassNames property to the HTML element",function(){expect($("html")).toHaveClass("debug")}),it("updates classes applied to the body, document container and page container",function(){expect($("body")).toHaveClass("foo"),expect(this.component.select("docContainer")).toHaveClass("bar"),expect(this.component.select("pageContainer")).toHaveClass("baz")}),it("hides the spinner",function(){expect(this.component.select("spinnerContainer")).not.toHaveClass(this.component.attr.spinnerClass)}),it("scrolls the window to the top",function(){expect($(window).scrollTop()).toBe(0)}),it("results in the firing of the uiBeforePageChanged event",function(){expect("uiBeforePageChanged").toHaveBeenTriggeredOnAndWith(this.component.node,jasmine.objectContaining({page:"<h1>Hello</h1>"}))}),it("results in the firing of the uiTeardown event",function(){expect("uiTeardown").toHaveBeenTriggeredOn(this.component.node)}),it("results in the firing of the uiPageChanged event",function(){expect("uiPageChanged").toHaveBeenTriggeredOnAndWith(this.component.node,jasmine.objectContaining({page:"<h1>Hello</h1>"}))})}),describe("when a dataPageRefresh fires",function(){it("applies the class(es) specified in the html_fouc_class_names property to the HTML element",function(){this.component.attr.baseFoucClass="",this.component.$node.trigger("dataPageRefresh",{page:"<h1>Hello</h1>",module:"noop",init_data:{viewContainer:"#page-container",htmlFoucClassNames:"swift-loading another-class",htmlClassNames:"debug"},pushState:!0}),expect($("html")).toHaveClass("swift-loading")}),it("removes the default FOUC class after initializing the new page",function(){this.component.$node.trigger("dataPageRefresh",{page:"<h1>Hello</h1>",module:"noop",init_data:{viewContainer:"#page-container",htmlFoucClassNames:"swift-loading another-class",htmlClassNames:"debug"},pushState:!0}),expect($("html")).not.toHaveClass("swift-loading"),expect($("html")).toHaveClass("another-class")})}),describe("when a dataPageRefresh fires and the response contains banners",function(){it("renders the page with banners",function(){this.component.$node.trigger("dataPageRefresh",{page:"<h1>Hello</h1>",banners:'<div class="module-banner">Banner</div>',title:"test",module:"noop",init_data:{someData:1,viewContainer:"#page-container"},pushState:!0}),expect(this.component.select("pageContainer").find(".module-banner").length).toBe(1)}),it("does not add banners when rendering the page from cache",function(){this.component.$node.trigger("dataPageRefresh",{page:'<div class="module-banner">Banner</div><h1>Hello</h1>',banners:'<div class="module-banner">Banner</div>',title:"test",module:"noop",init_data:{someData:1,viewContainer:"#page-container"},fromCache:!0,pushState:!0}),expect(this.component.select("pageContainer").find(".module-banner").length).toBe(1)})}),describe("when a dataPageRefresh fires in response to a popstate event",function(){afterEach(function(){$(window).scrollTop(0)}),it("does not scroll the window to the top",function(){$(window).scrollTop(200),this.component.$node.trigger("dataPageRefresh",{page:"<h1>Hello</h1>",title:"test",module:"noop",body_class_names:"foo",doc_class_names:"bar",page_container_class_names:"baz",init_data:{someData:1},isPopState:!0,pushState:!0}),expect($(window).scrollTop()).toBe(200)})}),describe("clicking on a normal link when pushState is enabled or supported",function(){beforeEach(function(){setupComponent(html,{pushState:history.pushState}),it("does not fire a uiNavigate on the link",function(){var a=this.component.$node.find("a.normal");spyOnEvent(a,"uiNavigate"),a.trigger("click"),expect("uiNavigate").not.toHaveBeenTriggeredOn(a)})})}))})
});
define("test/app/ui/user_completion_module_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/user_completion_module",function(){var a="<div id='user-completion-module'>\n      <a id='follow-accounts-step' class='user-completion-step' href='#'></a>\n      <a id='complete-profile-step' class='user-completion-step' href='#'></a>\n      <a id='confirm-email-step' class='user-completion-step' href='#'></a>\n      <a id='first-tweet-step' class='user-completion-step' href='#'></a>\n    </div>\n  ";beforeEach(function(){setupComponent(a),this.$confirmEmailLink=this.$node.find("#confirm-email-step"),this.$followAccountsLink=this.$node.find("#follow-accounts-step"),this.$completeProfileLink=this.$node.find("#complete-profile-step"),this.$firstTweetLink=this.$node.find("#first-tweet-step")}),describe("event uiDidReachTargetFollowingCount",function(){beforeEach(function(){this.$followAccountsLink.addClass("selected"),$(document).trigger("uiDidReachTargetFollowingCount")}),it("marks follow accounts step as completed",function(){expect(this.$followAccountsLink).toHaveClass("completed")}),it("un-selects follow accounts step",function(){expect(this.$followAccountsLink).not.toHaveClass("selected")})}),describe("event uiOpenTweetDialog",function(){beforeEach(function(){this.$completeProfileLink.addClass("selected"),$(document).trigger("uiOpenTweetDialog")}),it("un-selects complete profile step",function(){expect(this.$completeProfileLink).not.toHaveClass("selected")}),it("selects first tweet step",function(){expect(this.$firstTweetLink).toHaveClass("selected")}),describe("event uiTweetDialogClosed",function(){beforeEach(function(){$(document).trigger("uiTweetDialogClosed")}),it("un-selects first tweet step",function(){expect(this.$firstTweetLink).not.toHaveClass("selected")}),it("re-selects complete profile step",function(){expect(this.$completeProfileLink).toHaveClass("selected")})}),describe("tweet sent",function(){beforeEach(function(){$(document).trigger("uiSendTweet"),$(document).trigger("uiTweetDialogClosed")}),it("marks first tweet step as completed",function(){expect(this.$firstTweetLink).toHaveClass("completed")}),it("un-selects first tweet step",function(){expect(this.$firstTweetLink).not.toHaveClass("selected")}),it("re-selects complete profile step",function(){expect(this.$completeProfileLink).toHaveClass("selected")})})}),describe("event dataImageEnqueued",function(){beforeEach(function(){this.$completeProfileLink.addClass("selected")}),describe("avatar upload",function(){beforeEach(function(){$(document).trigger("dataImageEnqueued",{sourceEventData:{uploadType:"avatar"}})}),it("marks complete profile step as completed",function(){expect(this.$completeProfileLink).toHaveClass("completed")}),it("un-selects complete profile step",function(){expect(this.$completeProfileLink).not.toHaveClass("selected")})}),describe("header upload",function(){beforeEach(function(){$(document).trigger("dataImageEnqueued",{sourceEventData:{uploadType:"header"}})}),it("does not mark complete profile step as completed",function(){expect(this.$completeProfileLink).not.toHaveClass("completed")}),it("does not un-select complete profile step",function(){expect(this.$completeProfileLink).toHaveClass("selected")})})}),describe("click confirm email link",function(){beforeEach(function(){spyOnEvent(this.$node,"uiOpenConfirmEmailDialog"),spyOnEvent(this.$node,"uiResendConfirmationEmail")}),it("triggers openConfirmEmailDialog when confirm email step is not complete",function(){this.$confirmEmailLink.click(),expect("uiOpenConfirmEmailDialog").toHaveBeenTriggeredOn(this.$node)}),it("does not trigger openConfirmEmailDialog when confirm email step is complete",function(){this.$confirmEmailLink.addClass("completed"),this.$confirmEmailLink.click(),expect("uiOpenConfirmEmailDialog").not.toHaveBeenTriggeredOn(this.$node)}),it("triggers uiResendConfirmationEmail when confirm email step links to a inbox url",function(){this.$confirmEmailLink.attr("href","/some_url"),this.$confirmEmailLink.click(),expect("uiResendConfirmationEmail").toHaveBeenTriggeredOn(this.$node)}),it("does not trigger openConfirmEmailDialog when confirm email step links to a inbox url",function(){this.$confirmEmailLink.attr("href","/some_url"),this.$confirmEmailLink.click(),expect("uiOpenConfirmEmailDialog").not.toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/advanced_search_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/advanced_search",{fixture:"test/fixtures/advanced_search"},function(){beforeEach(function(){setupComponent(this.fixture)}),describe("uiNavigate and uiSearchQuery",function(){it("triggers for a given serialized query",function(){spyOnEvent(this.$node,"uiNavigate"),spyOnEvent(this.$node,"uiSearchQuery"),this.$node.find("input[name=ands]").val("some query"),this.component.select("searchButtonSelector").click(),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,{href:"/search?q=some%20query&src=typd"}),expect("uiSearchQuery").toHaveBeenTriggeredOnAndWith(this.$node,{query:"some query",source:"search"})}),it("does not trigger for empty query",function(){spyOnEvent(this.$node,"uiNavigate"),spyOnEvent(this.$node,"uiSearchQuery"),this.component.select("searchButtonSelector").click(),expect("uiNavigate").not.toHaveBeenTriggeredOn(this.$node),expect("uiSearchQuery").not.toHaveBeenTriggeredOn(this.$node)}),it("triggers on form submit",function(){spyOnEvent(this.$node,"uiNavigate"),spyOnEvent(this.$node,"uiSearchQuery"),this.$node.find("input[name=ands]").val("some query"),this.component.select("searchForm").submit(),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,{href:"/search?q=some%20query&src=typd"}),expect("uiSearchQuery").toHaveBeenTriggeredOnAndWith(this.$node,{query:"some query",source:"search"})})}),describe("serialized form",function(){it("adds the 'All these words'",function(){this.$node.find("input[name=ands]").val("some query"),expect(this.component.serializeAdvancedForm()).toBe("some query")}),describe("emotions",function(){it("adds :)",function(){this.$node.find('input[name=attd][value=":)"]').attr("checked",!0),expect(this.component.serializeAdvancedForm()).toBe(":)")}),it("adds :(",function(){this.$node.find('input[name=attd][value=":("]').attr("checked",!0),expect(this.component.serializeAdvancedForm()).toBe(":(")}),it("adds ?",function(){this.$node.find('input[name=attd][value="?"]').attr("checked",!0),expect(this.component.serializeAdvancedForm()).toBe("?"),expect(this.component.serializeAdvancedForm()).toBe("?")}),it("adds all the emotions",function(){this.$node.find('input[name=attd][value=":)"]').attr("checked",!0),this.$node.find('input[name=attd][value=":("]').attr("checked",!0),this.$node.find('input[name=attd][value="?"]').attr("checked",!0),expect(this.component.serializeAdvancedForm()).toBe(":) :( ?")})}),describe("adds OR",function(){it("takes single word",function(){this.$node.find("input[name=ors]").val("some"),expect(this.component.serializeAdvancedForm()).toBe("some")}),it("adds all the words separated by OR",function(){this.$node.find("input[name=ors]").val("one two"),expect(this.component.serializeAdvancedForm()).toBe("one OR two")})}),it("adds the phrase with double quotes",function(){this.$node.find("input[name=phrase]").val("one two"),expect(this.component.serializeAdvancedForm()).toBe('"one two"')}),it("adds the - to nots",function(){this.$node.find("input[name=nots]").val("one two"),expect(this.component.serializeAdvancedForm()).toBe("-one -two")}),describe("hashtags",function(){it("adds # to words without them",function(){this.$node.find("input[name=tag]").val("one two"),expect(this.component.serializeAdvancedForm()).toBe("#one OR #two")}),it("does not add the # to words that already have them",function(){this.$node.find("input[name=tag]").val("#one #two"),expect(this.component.serializeAdvancedForm()).toBe("#one OR #two")})}),describe("from",function(){it("adds OR and from: to words",function(){this.$node.find("input[name=from]").val("one two"),expect(this.component.serializeAdvancedForm()).toBe("from:one OR from:two")}),it("adds OR and from: and removes @ from words",function(){this.$node.find("input[name=from]").val("@one @two"),expect(this.component.serializeAdvancedForm()).toBe("from:one OR from:two")})}),describe("to",function(){it("adds OR and to: to words",function(){this.$node.find("input[name=to]").val("one two"),expect(this.component.serializeAdvancedForm()).toBe("to:one OR to:two")}),it("adds OR and to: and removes the @ from words",function(){this.$node.find("input[name=to]").val("@one @two"),expect(this.component.serializeAdvancedForm()).toBe("to:one OR to:two")})}),describe("mentions",function(){it("adds OR and @ to words",function(){this.$node.find("input[name=ref]").val("one two"),expect(this.component.serializeAdvancedForm()).toBe("@one OR @two")}),it("adds OR leaves the @ from words",function(){this.$node.find("input[name=ref]").val("@one @two"),expect(this.component.serializeAdvancedForm()).toBe("@one OR @two")})}),it("near",function(){this.$node.find("input[name=near]").val("San Francisco"),expect(this.component.serializeAdvancedForm()).toBe('near:"San Francisco" within:15mi')}),it("adds include:retweets if selected",function(){this.$node.find("input[name=include]").attr("checked",!0),expect(this.component.serializeAdvancedForm()).toBe("include:retweets")}),it("adds lang code",function(){this.$node.find("select#lang option[value=fi]").attr("selected",!0),expect(this.component.serializeAdvancedForm()).toBe("lang:fi")}),it("returns an empty string for empty form",function(){expect(this.component.serializeAdvancedForm()).toBe("")})})})
});
define("test/app/ui/alert_banner_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/alert_banner",function(){describe("event uiAlertBanner",function(){xit("",function(){expect("").toBe("")})}),describe("event uiAlertBannerClose",function(){xit("",function(){expect("").toBe("")})})})
});
define("test/app/ui/with_stream_users_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_stream_users",{fixture:"test/fixtures/user_search"},function(){beforeEach(function(){setupComponent(this.fixture)}),describe("uiUsersDisplayed",function(){it("triggers on component load",function(){spyOnEvent(document,"uiUsersDisplayed"),setupComponent(this.$node),expect("uiUsersDisplayed").toHaveBeenTriggeredOnAndWith(document,{users:[{id:"1010",impressionId:jasmine.any(String)},{id:"3",impressionId:jasmine.any(String)},{id:"707",impressionId:undefined}]})})})})
});
define("test/app/ui/with_dropdownmenu_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_dropdownmenu",function(){var a='<div id="dropdown1" class="dropdown">\n      <button class="js-dropdown-toggle" type="button">Toggle</button>\n      <div class="dropdown-menu">\n        <ul>\n          <li><button type="button">Menuitem 1</button></li>\n          <li><button type="button">Menuitem 2</button></li>\n          <li class="dropdown-divider"></li>\n          <li style="display:none;"><button type="button">Menuitem 3</button></li>\n          <li><button type="button">Menuitem 4</button></li>\n        </ul>\n      </div>\n    </div>\n  ',b='<div id="dropdown2" class="dropdown">\n      <button class="js-dropdown-toggle" type="button">Toggle</button>\n      <div class="dropdown-menu">\n        <ul>\n          <li><a href="#">Menuitem 1</a></li>\n          <li><a>Menuitem 2</a></li>\n          <li class="dropdown-divider"></li>\n          <li><a>Menuitem 1</a></li>\n          <li><a>Menuitem 1</a></li>\n        </ul>\n      </div>\n    </div>\n  ',c='<div id="dropdown3" class="dropdown">\n      <button class="js-dropdown-toggle" type="button">Toggle</button>\n      <div class="dropdown-menu">\n        <ul>\n          <li style="display:none;"><a>Menuitem 1</a></li>\n        </ul>\n      </div>\n    </div>\n  ',d='<div id="dropdown4" class="dropdown">\n      <button class="js-dropdown-toggle" type="button">Toggle</button>\n      <div class="dropdown-menu">\n        <ul>\n          <li><a style="display:none;">Menuitem 1</a></li>\n        </ul>\n      </div>\n    </div>\n  ';describe("When the menu is shown",function(){describe("and the toggler has a unqiue id",function(){it("does not generate a unique id for the toggler",function(){var b=$(a);b.find(".js-dropdown-toggle").attr("id","foo"),setupComponent(b),this.component.select("togglerSelector").trigger("click"),expect(this.component.select("togglerSelector").attr("id")).toBe("foo")})}),describe("and the toggler does not have a unqiue id",function(){it("generates a unique id for the toggler",function(){var c=$(a),d=$(b);setupComponent(c),setupComponent(d),this.component.select("togglerSelector").trigger("click");var e=c.find(this.component.attr.togglerSelector)[0].id,f=d.find(this.component.attr.togglerSelector)[0].id;expect(e).not.toBe(f)})}),it('sets the "role" attribute of list to "menu"',function(){setupComponent(a),this.component.select("togglerSelector").trigger("click"),expect($("#dropdown1").find(this.component.attr.menuListSelector).attr("role")).toBe("menu")}),it('sets the "aria-labelledby" attribute on the menu to the id of the toggler',function(){setupComponent(a),this.component.select("togglerSelector").trigger("click"),expect($("#dropdown1").find(this.component.attr.menuListSelector).attr("aria-labelledby")).toBe(this.component.select("togglerSelector").attr("id"))}),it('sets the "tabindex" attribute on the menu to "-1"',function(){setupComponent(a),this.component.select("togglerSelector").trigger("click"),expect($("#dropdown1").find(this.component.attr.menuListSelector).attr("tabindex")).toBe("-1")}),it('toggles the "aria-hidden" attribute to "false"',function(){setupComponent(a),this.component.select("togglerSelector").trigger("click"),expect($("#dropdown1").find(this.component.attr.menuListSelector).attr("aria-hidden")).toBe("false")}),it("focuses the menu",function(){setupComponent(a),this.component.select("togglerSelector").trigger("click"),expect($("#dropdown1").find(this.component.attr.menuListSelector)).toBeFocused()}),describe("and the LIs contain a link or a buttons",function(){describe("and the LI is visible",function(){beforeEach(function(){setupComponent(b),this.component.select("togglerSelector").trigger("click")}),it('sets the "role" attribute of the link to "menuitem"',function(){expect($("#dropdown2").find(this.component.attr.menuItemSelector).find("a").attr("role")).toBe("menuitem")}),it('sets the "role" attribute of the LI to "presentation"',function(){expect($("#dropdown2").find(this.component.attr.menuItemSelector).attr("role")).toBe("presentation")})}),describe("and an LI is hidden",function(){beforeEach(function(){setupComponent(c),this.component.select("togglerSelector").trigger("click")}),it('does not set the "role" attribute of the link to "menuitem"',function(){expect($("#dropdown3").find(this.component.attr.menuItemSelector).find("a").attr("role")).not.toExist()})}),describe("and the link or button inside the LI is hidden",function(){beforeEach(function(){setupComponent(d),this.component.select("togglerSelector").trigger("click")}),it('does not set the "role" attribute of the link to "menuitem"',function(){expect($("#dropdown4").find(this.component.attr.menuItemSelector).find("a").attr("role")).not.toExist()})})})}),describe("When the menu is hidden",function(){beforeEach(function(){setupComponent(a),this.component.select("togglerSelector").trigger("click"),this.component.trigger("uiDropdownClosed")}),it('sets the "aria-hidden" attribute to "true"',function(){expect($("#dropdown1").find(this.component.attr.menuListSelector).attr("aria-hidden")).toBe("true")}),it("clears the current selection",function(){expect($("#dropdown1").find(this.component.attr.selectedMenuItemSelector).length).toBe(0)})}),describe("When the user presses the down arrow key",function(){var b=$.Event("keydown",{keyCode:40});beforeEach(function(){spyOn(b,"preventDefault"),setupComponent(a)}),describe("and the menu is hidden",function(){beforeEach(function(){var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b)}),it("does not prevent the browser window from scolling",function(){expect(b.preventDefault).not.toHaveBeenCalled()}),it("does not move focus to the last item",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).last().find("[role=menuitem]")).not.toBeFocused()}),it("does not mark the last item as selected",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).first().find("[role=menuitem]")).not.toHaveClass(this.component.attr.selectedMenuItemClass)})}),describe("and the menu is open",function(){beforeEach(function(){this.component.select("togglerSelector").trigger("click")}),describe("and the menu is focused",function(){beforeEach(function(){var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b)}),it("prevents the browser window from scolling",function(){expect(b.preventDefault).toHaveBeenCalled()}),it("moves focus to the first item",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).first().find("[role=menuitem]")).toBeFocused()}),it("marks the first item as selected",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).first().find("[role=menuitem]")).toHaveClass(this.component.attr.selectedMenuItemClass)})}),describe("and an item is already selected",function(){it("prevents the browser window from scolling",function(){$("#dropdown1").find(this.component.attr.menuItemSelector).first().find("[role=menuitem]").addClass(this.component.attr.selectedMenuItemClass);var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b),expect(b.preventDefault).toHaveBeenCalled()}),it("moves focus to the next adjacent item",function(){$("#dropdown1").find(this.component.attr.menuItemSelector).first().find("[role=menuitem]").addClass(this.component.attr.selectedMenuItemClass);var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b),expect($("#dropdown1").find(this.component.attr.menuItemSelector).eq(1).find("[role=menuitem]")).toBeFocused()}),describe("and the next item is a divider",function(){beforeEach(function(){$("#dropdown1").find(this.component.attr.menuItemSelector).eq(1).find("[role=menuitem]").addClass(this.component.attr.selectedMenuItemClass);var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b)}),it("prevents the browser window from scolling",function(){expect(b.preventDefault).toHaveBeenCalled()}),it("moves focus to the next item after the divider",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).eq(3).find("[role=menuitem]")).toBeFocused()})}),describe("and there is no next item",function(){beforeEach(function(){$("#dropdown1").find(this.component.attr.menuItemSelector).last().find("[role=menuitem]").addClass(this.component.attr.selectedMenuItemClass);var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b)}),it("prevents the browser window from scolling",function(){expect(b.preventDefault).toHaveBeenCalled()}),it("moves focus to the first item",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).first().find("[role=menuitem]")).toBeFocused()})})})})}),describe("When the user presses the up arrow key",function(){var b=$.Event("keydown",{keyCode:38});beforeEach(function(){spyOn(b,"preventDefault"),setupComponent(a)}),describe("and the menu is hidden",function(){beforeEach(function(){var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b)}),it("does not prevent the browser window from scolling",function(){expect(b.preventDefault).not.toHaveBeenCalled()}),it("does not move focus to the last item",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).last().find("[role=menuitem]")).not.toBeFocused()}),it("does not mark the last item as selected",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).last().find("[role=menuitem]")).not.toHaveClass(this.component.attr.selectedMenuItemClass)})}),describe("and the menu is open",function(){beforeEach(function(){this.component.select("togglerSelector").trigger("click")}),describe("and the menu is focused",function(){beforeEach(function(){var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b)}),it("prevents the browser window from scolling",function(){expect(b.preventDefault).toHaveBeenCalled()}),it("moves focus to the last item",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).last().find("[role=menuitem]")).toBeFocused()}),it("marks the last item as selected",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).last().find("[role=menuitem]")).toHaveClass(this.component.attr.selectedMenuItemClass)})}),describe("and an item is already selected",function(){it("prevents the browser window from scolling",function(){$("#dropdown1").find(this.component.attr.menuItemSelector).eq(1).find("[role=menuitem]").addClass(this.component.attr.selectedMenuItemClass);var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b),expect(b.preventDefault).toHaveBeenCalled()}),it("moves focus to the next adjacent item",function(){$("#dropdown1").find(this.component.attr.menuItemSelector).eq(1).find("[role=menuitem]").addClass(this.component.attr.selectedMenuItemClass);var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b),expect($("#dropdown1").find(this.component.attr.menuItemSelector).first().find("[role=menuitem]")).toBeFocused()}),describe("and the next item is a divider",function(){beforeEach(function(){$("#dropdown1").find(this.component.attr.menuItemSelector).eq(3).find("[role=menuitem]").addClass(this.component.attr.selectedMenuItemClass);var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b)}),it("prevents the browser window from scolling",function(){expect(b.preventDefault).toHaveBeenCalled()}),it("moves focus to the next item before the divider",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).eq(1).find("[role=menuitem]")).toBeFocused()})}),describe("and there is no next item",function(){beforeEach(function(){$("#dropdown1").find(this.component.attr.menuItemSelector).first().find("[role=menuitem]").addClass(this.component.attr.selectedMenuItemClass);var a=$("#dropdown1").find(this.component.attr.menuListSelector);a.trigger(b)}),it("prevents the browser window from scolling",function(){expect(b.preventDefault).toHaveBeenCalled()}),it("moves focus to the last item",function(){expect($("#dropdown1").find(this.component.attr.menuItemSelector).last().find("[role=menuitem]")).toBeFocused()})})})})}),describe('When the user clicks on a menuitem whose href attribute is set to "#"',function(){it("prevents the browser from navigating to the specified URL",function(){var a=window.location.href;setupComponent(b),this.component.select("togglerSelector").trigger("click"),this.component.$dropdown.find(this.component.attr.firstMenuItemSelector).find("a")[0].click(),expect(a).toBe(window.location.href)})})})
});
define("test/app/ui/dm_envelope_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dm_envelope",function(){var a='<div id="container">\n      <a href="#" class="nav">\n        <i class="global-dm-envelope"></i>\n        <span class="dm-new">5</span>\n      </a>\n    </div>\n';beforeEach(function(){setupComponent(a,{directMessagesSelector:".nav"})}),describe("dataUserHasUnreadDMsWithCount",function(){it("shows an unread indicator",function(){this.component.trigger("dataUserHasUnreadDMsWithCount",{}),expect(this.$node.find("a")).toHaveClass("new"),expect(this.$node.find("a")).not.toHaveClass("with-count"),expect(this.$node.find(".dm-new")).toHaveText(5)}),it("displays the count",function(){this.component.trigger("dataUserHasUnreadDMsWithCount",{msgCount:8}),expect(this.$node.find("a")).toHaveClass("with-count"),expect(this.$node.find("a")).not.toHaveClass("with-count-2"),expect(this.$node.find(".dm-new")).toHaveText(8)}),it("handles double digit counts",function(){this.component.trigger("dataUserHasUnreadDMsWithCount",{msgCount:10}),expect(this.$node.find("a")).toHaveClass("new"),expect(this.$node.find("a")).toHaveClass("with-count-2"),expect(this.$node.find("a")).not.toHaveClass("with-count-3"),expect(this.$node.find(".dm-new")).toHaveText(10)}),it("handles triple digit counts",function(){this.component.trigger("dataUserHasUnreadDMsWithCount",{msgCount:100}),expect(this.$node.find("a")).toHaveClass("new"),expect(this.$node.find("a")).toHaveClass("with-count-3"),expect(this.$node.find(".dm-new")).toHaveText(100)})}),describe("dataUserHasNoUnreadDMsWithCount",function(){beforeEach(function(){this.component.trigger("dataUserHasNoUnreadDMsWithCount")}),it("does not have unread indicators",function(){expect(this.$node.find("a")).not.toHaveClass("new"),expect(this.$node.find("a")).not.toHaveClass("with-count"),expect(this.$node.find("a")).not.toHaveClass("with-count-2"),expect(this.$node.find("a")).not.toHaveClass("with-count-3")})})})
});
define("test/app/ui/tooltips_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/tooltips",function(){beforeEach(function(){var a="<div id='tooltips'>\n        <img id='tooltip-top' class='js-tooltip' title='john1'>\n        <img id='tooltip-bottom' class='js-tooltip' title='john2' data-placement='bottom' >\n        <button type='button' id='button-1' class='js-tooltip' title=\"Button 1\"></button>\n        <button type='button' id='button-2' class='js-tooltip' title=\"Button 2\">\n          <img alt='Button 2'>\n        </button>\n        <button type='button' id='button-3' class='js-tooltip' title=\"Button 3\">\n          <img alt='Button 3'>\n        </button>\n      </div>\n    ";setupComponent(a),this.$tooltips=$("#tooltips"),this.$tooltipTop=$("#tooltip-top"),this.$tooltipBottom=$("#tooltip-bottom")}),afterEach(function(){$(".tooltip").remove()}),describe("when tooltip html is present before component initialization",function(){it("it shows/hides tooltips",function(){this.$tooltipTop.trigger("mouseover"),expect($(".tooltip.top .tooltip-inner")).toHaveText("john1"),this.$tooltipTop.trigger("mouseleave"),expect($(".tooltip.top")).not.toBeVisible(),this.$tooltipBottom.trigger("mouseover"),expect($(".tooltip.bottom .tooltip-inner")).toHaveText("john2"),this.$tooltipBottom.trigger("mouseleave"),expect($(".tooltip.bottom")).not.toBeVisible()})}),describe("when tooltip html is added after component initialization",function(){it("it shows/hides tooltips",function(){this.$tooltips.append("<img id='new-tooltip' class='js-tooltip' title='john3'>"),this.$newTooltip=$("#new-tooltip"),this.$newTooltip.trigger("mouseover"),expect($(".tooltip.top .tooltip-inner")).toHaveText("john3"),this.$newTooltip.trigger("mouseleave"),expect($(".tooltip.top")).not.toBeVisible()})}),describe("when the user navigates via pushState",function(){it("hides any visible tooltips",function(){this.$tooltips.append("<img id='new-tooltip' class='js-tooltip' title='john3'>"),this.$newTooltip=$("#new-tooltip"),this.$newTooltip.trigger("mouseover"),expect($(".tooltip.top")).toBeVisible(),this.component.trigger(document,"uiBeforePageChanged"),expect($(".tooltip.top")).not.toBeVisible()})}),describe("when the user invokes the profile popup",function(){it("hides any visible tooltips",function(){this.$tooltips.append("<img id='new-tooltip' class='js-tooltip' title='john3'>"),this.$newTooltip=$("#new-tooltip"),this.$newTooltip.trigger("mouseover"),expect($(".tooltip.top")).toBeVisible(),this.component.trigger(document,"uiShowProfilePopup"),expect($(".tooltip.top")).not.toBeVisible()})}),describe('When an element with the class of "js-tooltip" receives focus',function(){it("displays the tooltip",function(){$("#button-1").trigger("focus"),expect($(".tooltip")).toBeVisible()}),it('applies the "aria-describedby" attribute to the element',function(){$("#button-1").trigger("focus"),expect($("#button-1")).toHaveAttr("aria-describedby","aria-tooltip")}),it('sets the ARIA "role" attribute of the tooltip to "tooltip"',function(){$("#button-1").trigger("focus"),expect($(".tooltip").find(".tooltip-inner").attr("role")).toBe("tooltip")}),describe("and the text of the tooltip duplicates the elememt's text label",function(){$("#button-2").trigger("focus"),it('does not apply the "aria-describedby" attribute to the elememt',function(){$("#button-2").trigger("focus"),expect($("#button-1")).not.toHaveAttr("aria-describedby")}),it('does not apply the "role" attribute to the tooltip',function(){$("#button-2").trigger("focus"),expect($(".tooltip").find(".tooltip-inner")).not.toHaveAttr("role")})}),describe('and the text of the tooltip duplicates the value of the "alt" attribute of the image used to label the element',function(){$("#button-3").trigger("focus"),it('does not apply the "aria-describedby" attribute to the element',function(){$("#button-3").trigger("focus"),expect($("#button-1")).not.toHaveAttr("aria-describedby")}),it('does not apply the "role" attribute to the tooltip',function(){$("#button-3").trigger("focus"),expect($(".tooltip").find(".tooltip-inner")).not.toHaveAttr("role")})})}),describe('When an element with the class of "js-tooltip" loses focus',function(){it("hides the tooltip",function(){$("#button-1").trigger("focus"),$("#button-1").trigger("blur"),expect($(".tooltip")).not.toBeVisible()})}),describe("When a tooltip is visible and the user presses the Esc key",function(){it("hides the tooltip",function(){$("#button-1").trigger("focus"),$("#button-1").trigger("uiShortcutEsc"),expect($(".tooltip")).not.toBeVisible()})})})
});
define("test/app/ui/embed_stats_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/embed_stats",function(){var a='<div class="embed-stats-container">\n      <div class="permalink-tweet" data-tweet-id="20"></div>\n      <a data-expanded-url="http://example.iana.org/" class="embed-stats-url-link"></a>\n      <a class="embed-stats-more-button"></a>\n    </div>\n  ';beforeEach(function(){setupComponent($(a),{})}),it("fires event when embeddedLinkSelector clicked",function(){spyOnEvent(document,"uiClickedEmbeddedTweetLink"),this.component.select("embeddedLinkSelector").trigger("click"),expect("uiClickedEmbeddedTweetLink").toHaveBeenTriggeredOnAndWith(document,{tweetId:20,url:"http://example.iana.org/"})}),it("fires event when moreButtonSelector clicked",function(){spyOnEvent(document,"uiExpandedMoreEmbeddedTweetLinks"),this.component.select("moreButtonSelector").trigger("click"),expect("uiExpandedMoreEmbeddedTweetLinks").toHaveBeenTriggeredOnAndWith(document,{tweetId:20})})})
});
define("test/app/ui/geo_deletion_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/geo_deletion",function(){beforeEach(function(){var a='<div id="delete_geo_data">';a+='<p><a class="btn" id="geo_button" href="#">Delete all location information</a></p>',a+='<p id="delete_geo_info">This will delete all location information from past tweets.{{/i}} {{_i}}This may take up to 30 minutes.</p>',a+='<p id="deleting_geo_data" style="display: none;">Deleting all location information from your past Tweets...</p>',a+="</div>",setupComponent(a,{confirmFunction:function(){return!0}})}),it("instantiates default DOM options",function(){expect(this.component.attr.buttonSelector).toBe("#geo_button"),expect(this.component.attr.deleteInfoSelector).toBe("#delete_geo_info"),expect(this.component.attr.deletingDataSelector).toBe("#deleting_geo_data")}),it("shows #delete_geo_info on dataGeoDeletionError event",function(){$(document).trigger("dataGeoDeletionError"),expect(this.component.select("deleteInfoSelector")).toBeVisible(),expect(this.component.select("deletingDataSelector")).not.toBeVisible()}),it("shows #deleting_geo_data on uiDeleteGeoData event",function(){this.component.select("buttonSelector").click(),expect(this.component.select("deleteInfoSelector")).not.toBeVisible(),expect(this.component.select("deletingDataSelector")).toBeVisible()})})
});
define("test/app/ui/new_tweet_button_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/new_tweet_button",function(){beforeEach(setupComponent),describe("opening global tweet dialog",function(){it("triggers uiOpenTweetDialog on itself when clicked",function(){spyOnEvent(this.$node,"uiOpenTweetDialog"),this.$node.trigger("click"),expect("uiOpenTweetDialog").toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/spoonbill_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/spoonbill",function(){beforeEach(function(){setupComponent('<div id="spoonbill-outer"></div>',{loggedIn:!0,itemType:"user"})}),describe("retweet notification",function(){it("renders one",function(){var a={type:"retweet",user_screen_name:"chatty",user_name:"I.M. chatty",user_avatar:"https://si0.twimg.com/profile_images/3388670773/d0e937b2eb937f67aac060f86bd93596.jpeg",tweet_html:"New feature!!"};$(document).trigger("uiRequestSpoonbillRender",a),expect(this.$node.find(".WebNotification")).toBeVisible(),expect(this.$node.find(".WebNotification .IndentBox")).toHaveText(new RegExp("retweeted")),expect(this.$node.find(".WebNotification .Avatar").attr("src")).toEqual(a.user_avatar),expect(this.$node.find(".WebNotification .UserIdentityFullname")).toHaveText(new RegExp(a.user_name)),expect(this.$node.find(".WebNotification .TweetExcerpt")).toHaveText(new RegExp(a.tweet_html))}),it("scribes after rendering",function(){var a={type:"retweet",user_screen_name:"chatty",user_name:"I.M. chatty",user_avatar:"https://si0.twimg.com/profile_images/3388670773/d0e937b2eb937f67aac060f86bd93596.jpeg",tweet_html:"New feature!!"};$(document).trigger("uiRequestSpoonbillRender",a),expect(this.component).toScribe({component:"spoonbill",action:"impression"})})}),describe("favorite notification",function(){it("renders one",function(){var a={type:"favorite",user_screen_name:"chatty",user_name:"I.M. chatty",user_avatar:"https://si0.twimg.com/profile_images/3235924628/658742ae47152dfc4590e64adb4aa098_bigger.png",tweet_html:"I am so popular."};$(document).trigger("uiRequestSpoonbillRender",a),expect(this.$node.find(".WebNotification")).toBeVisible(),expect(this.$node.find(".WebNotification .IndentBox")).toHaveText(new RegExp("favorited")),expect(this.$node.find(".WebNotification .Avatar").attr("src")).toEqual(a.user_avatar),expect(this.$node.find(".WebNotification .UserIdentityFullname")).toHaveText(new RegExp(a.user_name)),expect(this.$node.find(".WebNotification .TweetExcerpt")).toHaveText(new RegExp(a.tweet_html))}),it("scribes after rendering",function(){var a={type:"favorite",user_screen_name:"chatty",user_name:"I.M. chatty",user_avatar:"https://si0.twimg.com/profile_images/3235924628/658742ae47152dfc4590e64adb4aa098_bigger.png",tweet_html:"I am so popular."};$(document).trigger("uiRequestSpoonbillRender",a),expect(this.component).toScribe({component:"spoonbill",action:"impression"})})}),describe("following notification",function(){it("renders one",function(){var a={type:"follow",user_id:123,user_screen_name:"chatty",user_name:"I.M. chatty",user_avatar:"https://si0.twimg.com/profile_images/2370238025/6powh39olczriflspmnc_bigger.jpeg",follow_state:"not-following"};$(document).trigger("uiRequestSpoonbillRender",a),expect(this.$node.find(".WebNotification")).toBeVisible(),expect(this.$node.find(".WebNotification .Avatar").attr("src")).toEqual(a.user_avatar),expect(this.$node.find(".WebNotification .UserIdentityFullname")).toHaveText(new RegExp(a.user_name)),expect(this.$node.find(".WebNotification .UserIdentity-username")).toHaveText(new RegExp("@"+a.user_screen_name))}),it("scribes after rendering",function(){var a={type:"follow",user_id:123,user_screen_name:"chatty",user_name:"I.M. chatty",user_avatar:"https://si0.twimg.com/profile_images/2370238025/6powh39olczriflspmnc_bigger.jpeg",follow_state:"not-following"};$(document).trigger("uiRequestSpoonbillRender",a),expect(this.component).toScribe({component:"spoonbill",action:"impression"})}),it("triggers uiFollowAction when clicked follow button",function(){var a={type:"follow",user_id:123,user_screen_name:"chatty",user_name:"I.M. chatty",user_avatar:"https://si0.twimg.com/profile_images/2370238025/6powh39olczriflspmnc_bigger.jpeg",follow_state:"not-following"};$(document).trigger("uiRequestSpoonbillRender",a),spyOnEvent(document,"uiFollowAction"),this.$node.find(".follow-popup-button").click(),expect("uiFollowAction").toHaveBeenTriggeredOn(document)}),it("triggers uiUnfollowAction when clicked unfollow button",function(){var a={type:"follow",user_id:123,user_screen_name:"chatty",user_name:"I.M. chatty",user_avatar:"https://si0.twimg.com/profile_images/2370238025/6powh39olczriflspmnc_bigger.jpeg",follow_state:"following"};$(document).trigger("uiRequestSpoonbillRender",a),spyOnEvent(document,"uiUnfollowAction"),this.$node.find(".follow-popup-button").click(),expect("uiUnfollowAction").toHaveBeenTriggeredOn(document)})}),describe("@mention notification",function(){var a;beforeEach(function(){spyOnEvent(document,"uiInitTweetbox"),a={type:"mention",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:["BarackObama"],retweeter:"",include_image_picker:!0},$(document).trigger("uiRequestSpoonbillRender",a)}),it("renders one",function(){expect(this.$node.find(".WebNotification")).toBeVisible(),expect(this.$node.find(".WebNotification .Avatar").attr("src")).toEqual(a.user_avatar),expect(this.$node.find(".WebNotification .UserIdentityFullname")).toHaveText(new RegExp(a.user_name)),expect(this.$node.find(".WebNotification .UserIdentity-username")).toHaveText(new RegExp("@"+a.user_screen_name)),expect(this.$node.find(".WebNotification .tweet-text")).toHaveText(a.tweet_html),expect(this.$node.find(".WebNotification .notifiation-box-tweet-actions")).toExist(),expect(this.$node.find(".WebNotification-buffer .tweet-form").attr("data-default-text")).toMatch(new RegExp("@"+a.user_screen_name)),expect(this.$node.find(".WebNotification-buffer .tweet-form").attr("data-default-text")).toMatch(new RegExp("@"+a.mentions[0])),expect(this.$node.find(".WebNotification-buffer .tweet-form div.tweet-button button.js-tweet-btn .tweeting-text")).toHaveText("Tweet")}),it("scribes after rendering",function(){expect(this.component).toScribe({component:"spoonbill",action:"impression"})}),it("can retweet/unretweet to @mentio ninline",function(){spyOnEvent(this.$node,"uiDidInlineRetweet"),spyOnEvent(document,"uiDidRetweet"),this.$node.find(".js-actionInlineRetweet").click(),expect("uiDidInlineRetweet").toHaveBeenTriggeredOn(this.$node),expect("uiDidRetweet").toHaveBeenTriggeredOn(document),spyOnEvent(document,"uiDidUnretweet"),this.$node.find(".js-actionInlineRetweet").click(),expect("uiDidUnretweet").toHaveBeenTriggeredOn(document)}),it("can fav/unfav to @mention inline",function(){spyOnEvent(document,"uiDidFavoriteTweet"),this.$node.find(".js-actionFavorite").click(),expect("uiDidFavoriteTweet").toHaveBeenTriggeredOn(document),spyOnEvent(document,"uiDidUnfavoriteTweet"),this.$node.find(".js-actionFavorite").click(),expect("uiDidUnfavoriteTweet").toHaveBeenTriggeredOn(document)}),it("creates an inline reply box",function(){expect("uiInitTweetbox").toHaveBeenTriggeredOn(document)}),it("pause rotation when sending reply",function(){spyOnEvent(document,"uiPauseSpoonbillRotation"),this.component.trigger("uiSendTweet",{tweetboxId:"123"}),expect("uiPauseSpoonbillRotation").toHaveBeenTriggeredOn(document)}),it("resume rotation when reply is sent",function(){spyOnEvent(document,"uiRequestRotateSpoonbill"),this.component.trigger("uiSendTweet",{tweetboxId:"123"}),this.component.trigger("dataTweetSuccess",{tweetboxId:"123"}),expect("uiRequestRotateSpoonbill").toHaveBeenTriggeredOn(document)})}),describe("DM notification",function(){var a;beforeEach(function(){spyOnEvent(document,"uiInitTweetbox"),a={type:"dm",user_screen_name:"talkative",user_name:"I. M. Talkative",user_id:706,user_avatar:"http://localhost.twitter.com:3000/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",tweet_id:327379,tweet_html:"this is an earned tweet @barackobama http://earnedtweets.com #this",mentions:"BarackObama"},$(document).trigger("uiRequestSpoonbillRender",a)}),it("renders one",function(){expect(this.$node.find(".WebNotification")).toBeVisible(),expect(this.$node.find(".WebNotification .Avatar").attr("src")).toEqual(a.user_avatar),expect(this.$node.find(".WebNotification .UserIdentityFullname")).toHaveText(new RegExp(a.user_name)),expect(this.$node.find(".WebNotification .UserIdentity-username")).toHaveText(new RegExp("@"+a.user_screen_name)),expect(this.$node.find(".WebNotification .tweet-text")).toHaveText(a.tweet_html),expect(this.$node.find(".WebNotification .dm-tweetbox")).toExist()}),it("scribes after rendering",function(){expect(this.component).toScribe({component:"spoonbill",action:"impression"})}),it("creates an inline DM box",function(){expect("uiInitTweetbox").toHaveBeenTriggeredOn(document)}),it("pause rotation when sending DM",function(){spyOnEvent(document,"uiPauseSpoonbillRotation"),this.component.trigger("uiSendDM",{tweetboxId:"123",tweetData:{status:"hello, DM"}}),expect("uiPauseSpoonbillRotation").toHaveBeenTriggeredOn(document)}),it("resume rotation when DM is sent",function(){spyOnEvent(document,"uiRequestRotateSpoonbill"),this.component.attr.sentTweetboxId="123",this.component.trigger("dataDMSuccess",{sourceEventData:{tweetboxId:"123"}}),expect("uiRequestRotateSpoonbill").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/prefilled_tweet_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/prefilled_tweet",function(){beforeEach(function(){var a='<div class="js-tweet">\n        <div>\n          <span class="js-spinner"></span>\n          <button class="js-tweet-btn"></button>\n        </div>\n        <div class="js-tweet-text">Tweet</div>\n      </div>\n    ';setupComponent(a),this.$tweetButton=this.component.select("tweetButtonSelector"),this.tweetText="Tweet"}),describe("on click tweet button",function(){beforeEach(function(){spyOnEvent(this.$node,"uiSendTweet"),this.$tweetButton.click()}),it("triggers uiSendTweet with the prefilled tweet",function(){expect("uiSendTweet").toHaveBeenTriggeredOnAndWith(this.$node,{tweetboxId:this.component.tweetboxId,tweetData:{status:this.tweetText}})}),it("adds is-sending class to the component node",function(){expect(this.$node).toHaveClass("is-sending")}),it("adds disabled class to the tweet button",function(){expect(this.$tweetButton).toHaveClass("disabled")})}),describe("on event dataTweetSuccess",function(){it("removes the component node",function(){$(document).trigger("dataTweetSuccess",{tweetboxId:this.component.tweetboxId,message:"Tweet sent"}),expect(this.$node).not.toExist()}),it("triggers uiTweetSent",function(){spyOnEvent(this.$node,"uiTweetSent"),$(document).trigger("dataTweetSuccess",{tweetboxId:this.component.tweetboxId,message:"Tweet sent"}),expect("uiTweetSent").toHaveBeenTriggeredOn(this.$node)}),it("triggers uiShowStickyMessage when unusual attribute is truthy in response",function(){spyOnEvent(this.$node,"uiShowStickyMessage"),$(document).trigger("dataTweetSuccess",{tweetboxId:this.component.tweetboxId,message:"Tweet sent",unusual:!0}),expect("uiShowStickyMessage").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Tweet sent"})}),it("triggers uiShowMessage when unusual attribute is falsy in response",function(){spyOnEvent(this.$node,"uiShowMessage"),$(document).trigger("dataTweetSuccess",{tweetboxId:this.component.tweetboxId,message:"Tweet sent"}),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Tweet sent"})})}),describe("on event dataTweetError",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowError"),this.$node.addClass("is-sending"),this.$tweetButton.addClass("disabled"),$(document).trigger("dataTweetError",{tweetboxId:this.component.tweetboxId,message:"Error"})}),it("triggers uiShowError",function(){expect("uiShowError").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Error"})}),it("removes is-sending class from the component node",function(){expect(this.$node).not.toHaveClass("is-sending")}),it("removes disabled class from the tweet button",function(){expect(this.$tweetButton).not.toHaveClass("disabled")})})})
});
define("test/app/ui/with_forgot_password_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_forgot_password",function(a){beforeEach(function(){var a='<div>\n        <a href="/foo" id="forgot_password"></a>\n        <div id="reminder_sent" style="visibility: hidden"></div>\n      </div>\n    ';setupComponent(a,{forgotSelector:"#forgot_password",reminderSelector:"#reminder_sent"})}),describe("#notifyForgotPassword",function(){it("triggers uiForgotPassword on notifyForgotPassword",function(){spyOnEvent(this.component.$node,"uiForgotPassword"),this.component.notifyForgotPassword({preventDefault:function(){}}),expect("uiForgotPassword").toHaveBeenTriggeredOnAndWith(this.component.$node,{url:urlForAssertion("/foo"),scribeContext:{element:"resend_password"}})})}),describe("#notifyReminderSent",function(){it("turns on reminder sent notification on notifyReminderSent",function(){this.component.notifyReminderSent(),expect(this.component.select("reminderSelector")).toHaveCss("visibility","visible")})})})
});
define("test/app/ui/with_rtl_tweet_box_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_rtl_tweet_box",function(){var a="ימון נגד ינגולשטד מהליגה השנייה",b="#ימון נ";beforeEach(function(){setupComponent(),this.component.$text=$("<textarea/>"),this.setMarkersAndRTLHelper=function(a){return this.component.setMarkersAndRTL(a,this.component.removeMarkers(a))}}),describe("removeMarkers",function(){it("removes markers from text",function(){expect(this.component.removeMarkers("‎Hello‏")).toEqual("Hello")})}),describe("setMarkersAndRTL",function(){describe("text has RTL chars in it",function(){it("adds markers around username if text has RTL chars",function(){expect(this.setMarkersAndRTLHelper(a+" @user")).toEqual(a+" ‎@user‏")}),it("adds marker to beginning of hashtag when first char is LTR",function(){expect(this.setMarkersAndRTLHelper(a+" #winning")).toEqual(a+" ‎#winning")}),it("does not add marker to beginning of hashtag when first char is RTL",function(){expect(this.setMarkersAndRTLHelper(a+b)).toEqual(a+b)}),it("adds marker after url",function(){expect(this.setMarkersAndRTLHelper(a+" http://example.com")).toEqual(a+" http://example.com"+"‎")}),it("sets RTL True",function(){this.setMarkersAndRTLHelper(a),expect(this.component.$text.attr("dir")).toEqual("rtl")})}),describe("text has no RTL chars in it",function(){it("does not add markers around username",function(){expect(this.setMarkersAndRTLHelper("Hello @user")).toEqual("Hello @user")}),it("does not add marker to beginning of hashtag",function(){expect(this.setMarkersAndRTLHelper("Hello #winning")).toEqual("Hello #winning")}),it("does not add marker after url",function(){expect(this.setMarkersAndRTLHelper("Hello http://example.com")).toEqual("Hello http://example.com")}),it("sets RTL false",function(){this.setMarkersAndRTLHelper("Hello"),expect(this.component.$text.attr("dir")).toEqual("ltr")})})})})
});
define("test/app/ui/login_verification_form_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/login_verification_form",function(){describe("on initialize",function(){it("triggers a uiCheckLoginVerification",function(){spyOnEvent(document,"uiCheckLoginVerification"),setupComponent(),this.$node.trigger("uiSwiftLoaded"),expect("uiCheckLoginVerification").toHaveBeenTriggeredOn(document)}),it("calls uiCheckLoginVerification with params",function(){spyOnEvent(this.$node,"uiCheckLoginVerification"),setupComponent();var a={redirect_after_login_verification:"/settings",remember_me:"true"};spyOn(this.component,"getQueryParams").andReturn(a),this.$node.trigger("uiSwiftLoaded"),expect("uiCheckLoginVerification").toHaveBeenTriggeredOnAndWith(this.$node,a)})}),describe("on data result",function(){beforeEach(setupComponent),it("redirects on error",function(){spyOn(this.component,"redirect"),this.$node.trigger("dataLoginVerificationError"),expect(this.component.redirect).toHaveBeenCalledWith("/?login_verification_error=BadSessionLoginVerification")}),it("calls uiCheckLoginVerification on success without verification or error",function(){jasmine.Clock.useMock(),spyOnEvent(this.$node,"uiCheckLoginVerification"),this.$node.trigger("dataLoginVerificationSuccess",{verified:!1}),jasmine.Clock.tick(1e3),expect("uiCheckLoginVerification").toHaveBeenTriggeredOn(this.$node)}),it("redirects on success with error code",function(){spyOn(this.component,"redirect"),this.$node.trigger("dataLoginVerificationSuccess",{error_status:!0}),expect(this.component.redirect).toHaveBeenCalledWith("/?login_verification_error=BadSessionLoginVerification")}),it("redirects on success",function(){spyOn(this.component,"redirect"),this.$node.trigger("dataLoginVerificationSuccess",{verified:!0}),expect(this.component.redirect).toHaveBeenCalledWith("/")}),it("redirects to a absolute URL",function(){var a="https://twitter.com/foo";spyOn(this.component,"getRedirectUrl").andReturn(a),spyOn(this.component,"redirect"),this.$node.trigger("dataLoginVerificationSuccess",{verified:!0}),expect(this.component.redirect).toHaveBeenCalledWith(a)}),it("redirects to a relative URL",function(){var a="/foo";spyOn(this.component,"getRedirectUrl").andReturn(a),spyOn(this.component,"redirect"),this.$node.trigger("dataLoginVerificationSuccess",{verified:!0}),expect(this.component.redirect).toHaveBeenCalledWith(a)}),it("doesn't redirect to a non-twitter URL",function(){var a="http://badtwitter.com/foo";spyOn(this.component,"getRedirectUrl").andReturn(a),spyOn(this.component,"redirect"),this.$node.trigger("dataLoginVerificationSuccess",{verified:!0}),expect(this.component.redirect).toHaveBeenCalledWith("/")})})})
});
define("test/app/ui/capped_file_upload_spec",["module","require","exports"],function(module, require, exports) {
describeComponentWithDataComponents("app/ui/capped_file_upload",["app/data/settings/account_scribe"],function(){var a={maxSize:400,message:"test alert message",eventData:{scribeContext:{component:"form",element:"account"}},error:function(){}};describe("on form change",function(){beforeEach(function(){var b='<form id="fixture">\n          <input id="upload_data" type="file">\n          <input name="commit" type="submit" />\n        </form>\n      ';setupComponent(b,a)}),it("triggers fileUploaded on itself",function(){spyOnEvent(this.$node,"fileUploaded"),this.$node.trigger("change"),expect("fileUploaded").toHaveBeenTriggeredOn(this.$node)}),it("triggers an alert banner when the file size is too big",function(){spyOnEvent(this.component.$node,"uiAlertBanner");var b=jQuery.Event("change");b.target={},b.target.files=[{size:500}],this.$node.trigger(b),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(this.component.$node,{message:a.message})}),it("makes the error callback if present",function(){spyOnEvent(this.component.$node,"uiAlertBanner");var b=spyOn(this.component.attr,"error"),c=jQuery.Event("change");c.target={},c.target.files=[{size:500}],this.$node.trigger(c),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(this.component.$node,{message:a.message}),expect(b).toHaveBeenCalled()}),it("does not make the error callback if successful",function(){var a=spyOn(this.component.attr,"error"),b=jQuery.Event("change");b.target={},b.target.files=[{size:400,name:"test name"}],this.$node.trigger(b),expect(a).not.toHaveBeenCalled()}),it("triggers fileUploaded when the file size is within limits, and specified with size and name",function(){spyOnEvent(this.component.$node,"fileUploaded");var a=jQuery.Event("change");a.target={},a.target.files=[{size:300,name:"test name"}],this.$node.trigger(a),expect("fileUploaded").toHaveBeenTriggeredOnAndWith(this.component.$node,{name:"test name"})}),it("triggers an alert banner when the file size is too big, and specified with fileSize",function(){spyOnEvent($(document),"uiAlertBanner");var b=jQuery.Event("change");b.target={},b.target.files=[{fileSize:500}],this.$node.trigger(b),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(this.$node,{message:a.message})}),it("triggers fileUploaded when the file size is within limits, and specified with fileSize and fileName",function(){spyOnEvent(this.component.$node,"fileUploaded");var a=jQuery.Event("change");a.target={},a.target.files=[{fileSize:300,fileName:"test name"}],this.$node.trigger(a),expect("fileUploaded").toHaveBeenTriggeredOnAndWith(this.component.$node,{name:"test name"})}),it("triggers fileUploaded when no name and size are supplied",function(){spyOnEvent(this.component.$node,"fileUploaded");var a=jQuery.Event("change");a.target={},a.target.files=[{}],this.$node.trigger(a),expect("fileUploaded").toHaveBeenTriggeredOnAndWith(this.component.$node,{name:undefined})})})})
});
define("test/app/ui/password_strength_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/password_strength",function(){beforeEach(function(){var a='<fieldset id="foo"><input id="user_password" value="barbarbar" type="password"><small id="password_strength_feedback"></small></fieldset>';setupComponent(a,{bannedPasswords:["grfggrfggrfg1234"]})}),describe("strength check on keyup",function(){it("shows feedback as weak when the fieldset is barbarbar",function(){this.$node.keyup(),expect(this.$node.find("#password_strength_feedback")).toHaveText("Weak")}),it("shows and hides feedback",function(){this.$node.keyup(),expect(this.$node.find("#password_strength_feedback")).toHaveText("Weak"),expect(this.$node.find("#password_strength_feedback")).toBeVisible(),this.$node.find("#user_password").val(""),this.$node.keyup(),expect(this.$node.find("#password_strength_feedback")).not.toBeVisible()})})})
});
define("test/app/ui/who_to_tweet_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/who_to_tweet",function(){beforeEach(function(){var a='<div class="user-actions" data-screen-name="grimezsz" data-name="Grimes the elf"><button class="js-tweet-to-btn">Tweet</button></div>';setupComponent(a)}),describe("when tweet to button is clicked",function(){it("triggers uiOpenTweetDialog with mention info",function(){spyOnEvent(this.$node,"uiOpenTweetDialog"),this.component.select("tweetToButtonSelector").click(),expect("uiOpenTweetDialog").toHaveBeenTriggeredOnAndWith(this.$node,{screenName:"grimezsz",title:"Tweet to Grimes the elf"})})})})
});
define("test/app/ui/profile_hovercard_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile_hovercard",function(){beforeEach(function(){var a='<div id="profile-hover-container">\n      </div>\n    ';setupComponent(a)}),describe("on uiShowProfileHover",function(){it("calls showHTML",function(){spyOnEvent(this.component.$node,"uiWantsProfilePopup"),this.$node.trigger("uiShowProfileHover",{userId:1}),expect("uiWantsProfilePopup").toHaveBeenTriggeredOn(this.component.$node)}),it("does not call showHTML if within a modal",function(){spyOnEvent(this.component.$node,"uiWantsProfilePopup");var a=$("<div class='modal-container'><span></span></div>"),b=jQuery.Event("uiShowProfileHover",{target:a.find("span")});this.$node.trigger(b,{userId:1}),expect("uiWantsProfilePopup").not.toHaveBeenTriggeredOn(this.component.$node)}),describe("when the user is not promoted, after a promoted profile popup was shown",function(){beforeEach(function(){this.$node.trigger("uiShowProfileHover",{userId:1,impressionId:"187",impressionCookie:"cookie"}),this.$node.trigger("uiShowProfileHover",{userId:1})}),it("does not have data-impression-id and data-impression-cookie on the components DOM node",function(){expect(this.$node).not.toHaveAttr("data-impression-id"),expect(this.$node).not.toHaveAttr("data-impression-cookie")})}),describe("when the user is promoted",function(){beforeEach(function(){this.$node.trigger("uiShowProfileHover",{userId:1,impressionId:"187",impressionCookie:"cookie"})}),it("adds data-impression-id and data-impression-cookie to the components DOM node",function(){expect(this.$node).toHaveAttr("data-impression-id","187"),expect(this.$node).toHaveAttr("data-impression-cookie","cookie")}),describe("on a uiShowProfileHover for a different promoted user",function(){beforeEach(function(){this.$node.trigger("uiShowProfileHover",{userId:1,impressionId:"781",impressionCookie:"iekooc"})}),it("adds data-impression-id and data-impression-cookie for the current promoted user to the components DOM node",function(){expect(this.$node).toHaveAttr("data-impression-id","781"),expect(this.$node).toHaveAttr("data-impression-cookie","iekooc")})})}),describe("when the user is earned",function(){beforeEach(function(){this.$node.trigger("uiShowProfileHover",{userId:1,impressionId:"187",disclosureType:"earned",impressionCookie:"cookie"})}),it("adds data-impression-id and data-impression-cookie to the components DOM node",function(){expect(this.$node).toHaveAttr("data-impression-id","187"),expect(this.$node).toHaveAttr("data-impression-cookie","cookie"),expect(this.$node).toHaveAttr("data-disclosure-type","earned")})}),describe("when a tweetId is present",function(){beforeEach(function(){this.$node.trigger("uiShowProfileHover",{userId:1,tweetId:2})}),it("adds a data-associated-tweet-id attribute",function(){expect(this.$node.attr("data-associated-tweet-id")).toBe("2")})}),describe("setting the last requested id",function(){it("uses the lower case screen name if present",function(){this.$node.trigger("uiShowProfileHover",{screenName:"SOMEONE",userId:1}),expect(this.component.lastRequested).toBe("someone")}),it("uses the userId otherwise",function(){this.$node.trigger("uiShowProfileHover",{userId:1}),expect(this.component.lastRequested).toBe(1)})})}),describe("on dataProfilePopupSuccess",function(){beforeEach(function(){spyOn(this.component,"showHTML")}),it("calls showHTML when id matches",function(){this.component.lastRequested=1,$(document).trigger("dataProfilePopupSuccess",{html:"<p>Some arbitrary HTML</p>",screen_name:"someone",user_id:1}),expect(this.component.showHTML).toHaveBeenCalled()}),it("calls showHTML when screen_name matches",function(){this.component.lastRequested="someone",$(document).trigger("dataProfilePopupSuccess",{html:"<p>Some arbitrary HTML</p>",screen_name:"someone",user_id:1}),expect(this.component.showHTML).toHaveBeenCalled()}),it("does not call showHTML if screen_name does not match",function(){this.component.lastRequested="name",$(document).trigger("dataProfilePopupSuccess",{html:"<p>Some arbitrary HTML</p>",screen_name:"someone"}),expect(this.component.showHTML).not.toHaveBeenCalled()}),it("does not call showHTML if userId does not match",function(){this.component.lastRequested=1,$(document).trigger("dataProfilePopupSuccess",{html:"<p>Some arbitrary HTML</p>",user_id:2}),expect(this.component.showHTML).not.toHaveBeenCalled()}),it("adds the screen name and userId to the node",function(){this.component.lastRequested=187,$(document).trigger("dataProfilePopupSuccess",{html:"<p>Some arbitrary HTML</p>",screen_name:"someone",user_id:187}),expect(this.$node).toHaveAttr("data-screen-name","someone"),expect(this.$node).toHaveAttr("data-user-id","187")})})})
});
define("test/app/ui/profile_image_monitor_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile_image_monitor",function(){var a="<img id='avatar_preview'/>\n    <div class='mini-profile'>\n      <img class='avatar'/>\n    </div>\n    <img class='image-preview' src='/images/spinner_center_72.gif'>\n  ";beforeEach(function(){jasmine.Clock.useMock(),spyOn(this.Component.prototype,"startPollingUploadStatus").andCallThrough(),spyOn(this.Component.prototype,"stopPollingUploadStatus").andCallThrough(),spyOn(this.Component.prototype,"handleUploadComplete").andCallThrough(),spyOn(this.Component.prototype,"setThumbsLoading").andCallThrough(),spyOn(this.Component.prototype,"updateThumbs").andCallThrough(),setupComponent(),attachFixtureToDom($(a))}),afterEach(function(){document.cookie=this.component.attr.isProcessingCookie+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}),it("has default options",function(){expect(this.component.attr.thumbnailSelector).toBe("#avatar_preview"),expect(this.component.attr.isProcessingCookie).toBe("image_processing_complete_key"),expect(this.component.attr.uploadType).toBe("avatar")}),describe("after initialize",function(){it("calls startPollingUploadStatus if the image is still processing",function(){document.cookie=this.component.attr.isProcessingCookie+"=processing; path=/",setupComponent(),expect(this.component.startPollingUploadStatus.callCount).toBe(1)}),it("does not call startPollingUploadStatuswhen if the image is not processing",function(){expect(this.component.startPollingUploadStatus).not.toHaveBeenCalled()})}),describe("event dataImageEnqueued",function(){it("calls startPollingUploadStatus",function(){this.component.trigger("dataImageEnqueued"),expect(this.component.startPollingUploadStatus.callCount).toBe(1)})}),describe("event dataHasImageUploadStatus",function(){beforeEach(function(){spyOnEvent(this.$node,"uiImageUploadSuccess")}),describe("when the image is still being processed",function(){beforeEach(function(){this.component.trigger("dataHasImageUploadStatus",{status:"processing"})}),it("does not call handleUploadComplete",function(){expect(this.component.handleUploadComplete).not.toHaveBeenCalled()}),it("does not trigger uiImageUploadSuccess",function(){expect("uiImageUploadSuccess").not.toHaveBeenTriggeredOn(this.$node)})}),describe("when the image is no longer being processed",function(){beforeEach(function(){this.component.trigger("dataHasImageUploadStatus",{status:"image/url",sourceEventData:{uploadType:this.component.attr.uploadType}})}),it("calls handleUploadComplete with the image url",function(){expect(this.component.handleUploadComplete.callCount).toBe(1),expect(this.component.handleUploadComplete).toHaveBeenCalledWith("image/url")}),it("triggers uiImageUploadSuccess",function(){expect("uiImageUploadSuccess").toHaveBeenTriggeredOn(this.$node)})})}),describe("event dataDeleteImageSuccess",function(){beforeEach(function(){this.component.trigger("dataDeleteImageSuccess",{status:"image/url",sourceEventData:{uploadType:this.component.attr.uploadType}})}),it("calls handleUploadComplete with the new image url (for example the avatar egg)",function(){expect(this.component.handleUploadComplete).toHaveBeenCalledWith("image/url")})}),describe("event dataFailedToGetImageUploadStatus",function(){beforeEach(function(){spyOnEvent(this.$node,"uiImageUploadFailure"),this.component.trigger("dataFailedToGetImageUploadStatus")}),it("calls stopPollingUploadStatus",function(){expect(this.component.stopPollingUploadStatus.callCount).toBe(1)}),it("triggers uiImageUploadFailure",function(){expect("uiImageUploadFailure").toHaveBeenTriggeredOn(this.$node)})}),describe("event uiDeleteImage",function(){it("calls setThumbsLoading",function(){this.component.trigger("uiDeleteImage"),expect(this.component.setThumbsLoading.callCount).toBe(1)})}),describe("#startPollingUploadStatus",function(){beforeEach(function(){spyOnEvent(document,"uiCheckImageUploadStatus"),document.cookie=this.component.attr.isProcessingCookie+"=key; path=/",this.callCount=0,$(document).on("uiCheckImageUploadStatus",function(){this.callCount+=1}.bind(this)),this.component.startPollingUploadStatus()}),it("triggers uiCheckImageUploadStatus in an interval",function(){jasmine.Clock.tick(this.component.attr.pollInterval),expect("uiCheckImageUploadStatus").toHaveBeenTriggeredOnAndWith(document,{uploadType:this.component.attr.uploadType,key:"key"}),expect(this.callCount).toBe(1),jasmine.Clock.tick(this.component.attr.pollInterval),expect(this.callCount).toBe(2)}),it("stops any existing status polling",function(){this.component.startPollingUploadStatus(),jasmine.Clock.tick(this.component.attr.pollInterval),expect(this.callCount).toBe(1)}),it("calls setThumbsLoading",function(){expect(this.component.setThumbsLoading.callCount).toBe(1)})}),describe("#stopPollingUploadStatus",function(){it("stops the interval timer triggering uiCheckImageUploadStatus",function(){spyOnEvent(document,"uiCheckImageUploadStatus"),this.component.startPollingUploadStatus(),this.component.stopPollingUploadStatus(),jasmine.Clock.tick(this.component.attr.pollInterval),expect("uiCheckImageUploadStatus").not.toHaveBeenTriggeredOn(document)})}),describe("#handleUploadComplete",function(){beforeEach(function(){document.cookie=this.component.attr.isProcessingCookie+"=processing; path=/",this.component.handleUploadComplete("image/url")}),it("calls stopPollingUploadStatus",function(){expect(this.component.stopPollingUploadStatus.callCount).toBe(1)}),it("clears the cookie signifying that an upload is in progress",function(){expect(document.cookie).not.toMatch(this.component.attr.isProcessingCookie)}),it("calls updateThumbs",function(){expect(this.component.updateThumbs.callCount).toBe(1),expect(this.component.updateThumbs).toHaveBeenCalledWith("image/url")})}),describe("#setThumbsLoading",function(){it("calls updateThumbs with the url for the spinner gif",function(){this.component.setThumbsLoading(),expect(this.component.updateThumbs.callCount).toBe(1),expect(this.component.updateThumbs).toHaveBeenCalledWith(this.component.attr.spinnerUrl)})}),describe("#updateThumbs",function(){describe("when the uploadType is avatar",function(){beforeEach(function(){this.component.updateThumbs("image/url")}),it("updates the avatar preview",function(){expect($(this.component.attr.thumbnailSelector)).toHaveAttr("src","image/url")}),it("updates the avatar on the mini profile",function(){expect($(this.component.attr.miniAvatarThumbnailSelector)).toHaveAttr("src","image/url")})}),describe("when the uploadType is header",function(){beforeEach(function(){this.component.attr.uploadType="header",this.component.updateThumbs("image/url")}),it("updates the header preview",function(){expect($(this.component.attr.thumbnailSelector).css("background-image")).toMatch("image/url")})})})})
});
define("test/app/ui/direct_message_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/direct_message_dialog",function(){beforeEach(function(){var a='<div id="shell" style="display: none;" class="modal-container">\n        <div class="modal draggable twttr-dialog dm-dialog">\n          <div class="mark-read js-mark-read">\n            <a class="btn mark-all-read js-mark-all-read" href="#" title="Mark All as Read">\n              <i class="dm-mark-all-read"></i>\n            </a>\n            <a class="btn dm-new-button dm-header-new" href="#">New message</a>\n          </div>\n          <div class="mark-read-confirm js-mark-read-confirm">\n            <button type="button" class="btn js-prompt-cancel">Cancel</button>\n            <button type="button" class="btn caution-btn js-prompt-ok">Mark all as read</button>\n          </div>\n          <div class="js-close"></div>\n          <div id="new">\n            <div class="content"></div>\n            <input type="text" class="dm-input">\n            <img src="" class="selected-profile">\n            <textarea class="tweetbox"></textarea>\n          </div>\n          <div id="conversationList">\n            <div class="content">\n              <ul>\n                <li class="dm-thread-item" data-thread-id="chatty" data-last-message-id="123">\n                  <div class="dm-thread-status"><i class="unread"></i>\n                  hey\n                </li>\n                <div class="dm-placeholder-empty dm-no-messages"></div>\n              </ul>\n            </div>\n          </div>\n          <div id="conversation">\n            <div class="content">\n              <div class="marked-for-deletion dm-convo" data-message-id="123" data-thread-id="chatty"></div>\n            </div>\n          </div>\n          <div class="dm-tweetbox"></div>\n          <div id="error-container">\n            <div id="error-close"></div>\n            <div id="error-text"></div>\n          </div>\n        </div>\n      </div>\n    ';setupComponent(a,{dialogSelector:"#shell",classConversationList:"dm-conversation-list",classConversation:"dm-conversation",classNew:"dm-new",viewConversationList:"#conversationList",viewConversation:"#conversation",viewNew:"#new",linksForConversationListView:"",linksForConversationView:"",linksForNewView:"",contentSelector:".content",errorContainerSelector:"#error-container",errorTextSelector:"#error-text",errorCloseSelector:"#error-close",autocompleteInput:".dm-input",autocompleteImage:"img.selected-profile",newConversationEditor:".tweetbox",markAllReadSelector:".mark-all-read",markReadConfirmSelector:".mark-read-confirm .js-prompt-ok",markReadCancelSelector:".mark-read-confirm .js-prompt-cancel"})}),describe("event uiNeedsDMDialog",function(){it("opens the dialog",function(){var a=spyOn(this.component,"open");this.component.trigger("uiNeedsDMDialog"),expect(a).toHaveBeenCalled()}),it("triggers 'dataRefreshDMs'",function(){spyOnEvent(document,"dataRefreshDMs"),this.component.trigger("uiNeedsDMDialog"),expect("dataRefreshDMs").toHaveBeenTriggeredOn(document)}),it("calls renderConversationView if screen name given",function(){var a=spyOn(this.component,"renderConversationView");this.component.trigger("uiNeedsDMDialog",{screen_name:"havoc"}),expect(a).toHaveBeenCalledWith(null,{screen_name:"havoc"})}),it("calls renderConversationListView if no screen name given",function(){var a=spyOn(this.component,"renderConversationListView");this.component.trigger("uiNeedsDMDialog"),expect(a).toHaveBeenCalled()}),describe("event uiNavigate",function(){it("is not triggered when dialog is closed",function(){spyOnEvent(document,"uiNavigate"),this.component.trigger("uiNeedsDMDialog"),this.component.trigger("uiDialogClosed"),expect("uiNavigate").not.toHaveBeenTriggeredOn(document)}),it("is triggered if dialog is opened from init_data and it is closed",function(){spyOnEvent(document,"uiNavigate"),this.component.trigger("uiNeedsDMDialog",{fromInitData:!0}),this.component.trigger("uiDialogClosed"),expect("uiNavigate").toHaveBeenTriggeredOn(document)})})}),describe("event dataDMConversationListResult",function(){it("does nothing when data is empty",function(){var a=this.component.$node.html();this.component.trigger("dataDMConversationListResult",{sourceEventData:{since_id:123}}),expect(this.component.$node).toHaveHtml(a)}),it("adds new threads to the dialog",function(){var a={threads:["talkative"],html:'<li data-thread-id="talkative">howdy</li>',sourceEventData:{since_id:123}};this.component.trigger("uiNeedsDMDialog"),expect(this.$node.find("li").length).toEqual(1),this.component.trigger("dataDMConversationListResult",a),expect(this.$node.find("li").length).toEqual(2),expect(this.$node.find("li[data-thread-id=talkative]")).toHaveText(/howdy/)}),it("updates existing threads",function(){var a={threads:["chatty"],html:'<li data-thread-id="chatty">howdy</li>',sourceEventData:{since_id:123}};this.component.trigger("uiNeedsDMDialog"),expect(this.$node.find("li[data-thread-id=chatty]")).toHaveText(/hey/),this.component.trigger("dataDMConversationListResult",a),expect(this.$node.find("li[data-thread-id=chatty]")).not.toHaveText(/hey/),expect(this.$node.find("li[data-thread-id=chatty]")).toHaveText(/howdy/)}),it("shows 'no messages' when no threads are returned",function(){this.component.trigger("dataDMConversationListResult",{sourceEventData:{since_id:0}}),expect(this.$node.find(".dm-no-messages")).toHaveClass("show"),expect(this.component.select("markAllReadSelector")).toHaveClass("disabled")}),it("hides 'no messages' when threads are returned",function(){var a={threads:["chatty"],html:'<li data-thread-id="chatty">howdy</li>',sourceEventData:{since_id:123}};this.$node.find("li").remove(),this.component.trigger("dataDMConversationListResult",a),expect(this.$node.find(".dm-no-messages")).not.toHaveClass("show"),expect(this.component.select("markAllReadSelector")).not.toHaveClass("disabled")}),it("hides 'no messages' when no threads are returned, but threads exist on or before 'since_id'",function(){var a={sourceEventData:{since_id:123}};this.component.trigger("dataDMConversationListResult",a),expect(this.$node.find(".dm-no-messages")).not.toHaveClass("show")})}),describe("method refreshConversation",function(){describe("with valid markup",function(){var a={recipient:{screen_name:"Talkative",name:"talkative",profile_image_url_https:"http://twitter.com"},html:'<div id="test-conversation" class="dm-convo"><div class="dm js-dm-item" data-message-id="123">Test</div></div>'};it("renders the conversation view",function(){this.component.trigger("dataDMSendSuccess",a),expect(this.$node).toContain("#test-conversation")}),it("triggers uiDMDialogOpenedConversation",function(){spyOnEvent(document,"uiDMDialogOpenedConversation"),this.component.trigger("dataDMSendSuccess",a),expect("uiDMDialogOpenedConversation").toHaveBeenTriggeredOnAndWith(document,{recipient:"Talkative",scribeContext:{component:"dm_existing_conversation_dialog"}})}),it("does not trigger uiDMDialogOpenedConversation if empty result",function(){spyOnEvent(document,"uiDMDialogOpenedConversation");var b=a;b.html="",this.component.trigger("dataDMSendSuccess",b),expect("uiDMDialogOpenedConversation").not.toHaveBeenTriggeredOn(document)}),it("does not make mark messages call",function(){spyOnEvent(document,"dataMarkDMsAsRead"),this.component.trigger("dataDMSendSuccess",a),expect("dataMarkDMsAsRead").not.toHaveBeenTriggeredOn(document)}),it("renders the new conversation dialog when there are no conversations",function(){a.html="",a.msgAction="send",spyOnEvent(document,"uiOpenNewDM"),this.component.trigger("dataDMSendSuccess",a),expect("uiOpenNewDM").toHaveBeenTriggeredOn(document)}),it("renders the conversation list when empty conversations after delete",function(){a.html="",a.msgAction="delete",spyOnEvent(document,"uiDMDialogOpenedConversationList"),this.component.trigger("dataDMDeleteSuccess",a),expect("uiDMDialogOpenedConversationList").toHaveBeenTriggeredOn(document)})}),describe("without any markup",function(){var a={recipient:{screen_name:"Talkative",name:"talkative",profile_image_url_https:"http://twitter.com"},msgAction:"delete"},b={screen_name:"chatty",name:"Mr. Chatty",id_str:"707"},c=$.Event("click");beforeEach(function(){this.component.renderConversationView(c,$.extend(b,{el:'<div class="dm-thread-item" data-last-message-id="123"><div class="dm-thread-status"><i></i></div></div>'})),this.component.trigger("dataDMConversationResult",{recipient:b,html:'<div class="dm-convo" data-thread-id="Talkative"><div class="dm js-dm-item" data-message-id="123">Test</div></div>'})}),it("triggers uiNeedsDMConversation",function(){spyOnEvent(document,"uiNeedsDMConversation"),this.component.trigger("dataDMDeleteSuccess",a),expect("uiNeedsDMConversation").toHaveBeenTriggeredOnAndWith(document,{screen_name:"Talkative",msgAction:"Delete",lastMsgId:"123"})}),it("does not make mark messages call",function(){spyOnEvent(document,"dataMarkDMsAsRead"),this.component.trigger("dataDMDeleteSuccess",a),expect("dataMarkDMsAsRead").not.toHaveBeenTriggeredOn(document)})}),describe("retry stale messages",function(){function b(a){return'<div class="dm-convo" data-thread-id="Talkative"><div class="dm js-dm-item" data-message-id="'+a+'">Test</div></div>'}var a={tweetboxId:1,recipient:{screen_name:"Talkative",name:"talkative",profile_image_url_https:"http://twitter.com"},sourceEventData:{lastMsgId:"123"}};beforeEach(function(){this.component.trigger("dataDMConversationResult",$.extend(a,{html:b("123")})),delete a.html;var c=spyOnEvent(document,"uiNeedsDMConversation");this.component.trigger("dataDMSendSuccess",a),c.reset()}),it("retries when the sent message doesn't appear",function(){this.component.trigger("dataDMSendSuccess",$.extend(a,{html:b("123")})),expect("uiNeedsDMConversation").toHaveBeenTriggeredOnAndWith(document,{screen_name:"Talkative",tweetboxId:1,msgAction:"Send",lastMsgId:"123"})}),it("retries up to a maximum of 3 times and eventually calls dataDMSuccess",function(){spyOnEvent(document,"dataDMSuccess");for(var c=0;c<5;c++)this.component.trigger("dataDMSendSuccess",$.extend(a,{html:b("123")}));expect(this.component.retryRefresh).toBe(3),expect("dataDMSuccess").toHaveBeenTriggeredOn(document)}),it("doesn't retry when the sent message appears",function(){this.component.trigger("dataDMSendSuccess",$.extend(a,{html:b("456")})),expect("uiNeedsDMConversation").not.toHaveBeenTriggeredOn(document)})})}),describe("event dataDMConversationResult",function(){var a={recipient:{screen_name:"Talkative",name:"talkative",profile_image_url_https:"http://twitter.com"},html:""};it("renders the new conversation dialog when there are no conversations",function(){spyOnEvent(document,"uiOpenNewDM"),this.component.trigger("dataDMConversationResult",a),expect("uiOpenNewDM").toHaveBeenTriggeredOn(document)})}),describe("method renderNewView with dialog closed",function(){it("opens the dialog and triggers a refresh event",function(){spyOnEvent(document,"dataRefreshDMs"),this.component.renderNewView(),expect("dataRefreshDMs").toHaveBeenTriggeredOn(document),expect(this.component.isOpen()).toBe(!0),this.component.close()})}),describe("method renderNewView",function(){beforeEach(function(){this.component.open()}),afterEach(function(){this.component.close()}),it("updates the dialog header",function(){this.component.renderNewView(),expect(this.$node).toContain("#new"),expect(this.$node.find("#new")).toBeVisible()}),it("triggers uiDMDialogOpenedNewConversation",function(){spyOnEvent(document,"uiDMDialogOpenedNewConversation"),this.component.renderNewView(),expect("uiDMDialogOpenedNewConversation").toHaveBeenTriggeredOnAndWith(document,{scribeContext:{component:"dm_new_conversation_dialog"}})}),it("resets the tweetbox",function(){spyOnEvent(this.component.select("tweetBoxSelector"),"uiDMBoxReset"),this.component.renderNewView(),expect("uiDMBoxReset").toHaveBeenTriggeredOn(this.component.select("tweetBoxSelector"))}),it("focuses the autocomplete input area",function(){this.component.renderNewView(),expect(this.component.select("autocompleteInput")).toBeFocused()}),it("prefills the autocomplete input area when a user is passed in",function(){this.component.renderNewView($.Event("click"),{recipient:{screen_name:"Talkative",name:"talkative",profile_image_url_https:"https://twitter.com"}}),expect(this.component.select("autocompleteInput")).toHaveValue("Talkative"),expect(this.component.select("autocompleteImage")).toHaveAttr("src","//twitter.com"),expect(this.component.select("newConversationEditor")).toBeFocused()})}),describe("method renderConversationListView",function(){beforeEach(function(){this.component.open()}),afterEach(function(){this.component.close()}),it("renders the conversation list view",function(){this.component.renderConversationListView(),expect(this.$node.find("#conversationList")).toBeVisible()}),it("triggers uiDMDialogOpenedConversationList",function(){spyOnEvent(document,"uiDMDialogOpenedConversationList"),this.component.renderConversationListView(),expect("uiDMDialogOpenedConversationList").toHaveBeenTriggeredOn(document)}),it("triggers 'uiNeedsDMConversationList' if the class 'needs-refresh' exists",function(){spyOnEvent(document,"uiNeedsDMConversationList"),this.$node.find("#conversationList").addClass("needs-refresh"),this.component.renderConversationListView(),expect("uiNeedsDMConversationList").toHaveBeenTriggeredOn(document)})}),describe("method renderConversationView",function(){beforeEach(function(){this.component.open()}),afterEach(function(){this.component.close()});var a={screen_name:"chatty",name:"Mr. Chatty",id_str:"707"};it("renders the conversation view",function(){spyOnEvent(document,"uiNeedsDMConversation"),this.component.renderConversationView(null,a),expect(this.$node).toContain("#conversation"),expect(this.$node.find("#conversation")).toBeVisible(),expect("uiNeedsDMConversation").toHaveBeenTriggeredOnAndWith(document,{screen_name:"chatty"})}),it("sets focus within the conversation view",function(){this.component.renderConversationView(null,a),expect(this.component.hasFocus()).toBe(!0)}),it("resets the tweetbox",function(){spyOnEvent(this.component.select("tweetBoxSelector"),"uiDMBoxReset"),this.component.renderConversationView(null,a),expect("uiDMBoxReset").toHaveBeenTriggeredOn(this.component.select("tweetBoxSelector"))}),it("does not render the conversation view if it is a profile link",function(){spyOnEvent(document,"uiNeedsDMConversation"),this.component.renderConversationView({preventDefault:function(){},target:'<a href="#" class="js-user-profile-link"><b>Some name</b></a>'},null),expect(this.$node.find("#conversation")).not.toBeVisible(),expect(this.component.isDialogNavigation).toBe(!0),expect("uiNeedsDMConversation").not.toHaveBeenTriggeredOn(document)}),describe("mark as read",function(){function c(a){return'<div class="dm-thread-item" data-last-message-id="123"><div class="dm-thread-status"><i'+(a?' class="unread"':"")+"></i></div></div>"}function d(a){return'<div class="dm-convo"><div class="dm js-dm-item" data-message-id="'+a+'">Test</div></div>'}beforeEach(function(){spyOnEvent(document,"dataMarkDMsAsRead")});var b=$.Event("click");it("triggers dataMarkDMsAsRead if the conversation is unread",function(){this.component.renderConversationView(b,$.extend(a,{el:c(!0)})),this.component.trigger("dataDMConversationResult",{recipient:a,html:d(123)}),expect("dataMarkDMsAsRead").toHaveBeenTriggeredOnAndWith(document,{last_message_id:"123",recipient_id:"707",recipient_name:"chatty"}),expect(this.component.select("viewConversationList").find(".dm-thread-item[data-last-message-id=123] .dm-thread-status i")).not.toHaveClass("unread")}),it("does not trigger dataMarkDMsAsRead if the conversation is read",function(){this.component.renderConversationView(b,$.extend(a,{el:c(!1)})),this.component.trigger("dataDMConversationResult",{recipient:a,html:d(123)}),expect("dataMarkDMsAsRead").not.toHaveBeenTriggeredOn(document)}),it("triggers dataMarkDMsAsRead if there's a new message in the conversation",function(){this.component.renderConversationView(b,$.extend(a,{el:c(!1)})),this.component.trigger("dataDMConversationResult",{recipient:a,html:d(456)}),expect("dataMarkDMsAsRead").toHaveBeenTriggeredOnAndWith(document,{last_message_id:"456",recipient_id:"707",recipient_name:"chatty"})}),it("does not trigger dataMarkDMsAsRead if there's an old message in the conversation",function(){this.component.renderConversationView(b,$.extend(a,{el:c(!1)})),this.component.trigger("dataDMConversationResult",{recipient:a,html:d(122)}),expect("dataMarkDMsAsRead").not.toHaveBeenTriggeredOn(document)}),it("does not trigger dataMarkDMsAsRead when sending/deleting a message even when there's a new message",function(){this.component.renderConversationView(b,$.extend(a,{el:c(!1)})),this.component.trigger("dataDMSendSuccess",{recipient:a,html:d(456)}),expect("dataMarkDMsAsRead").not.toHaveBeenTriggeredOn(document)}),describe("failures",function(){var a={screen_name:"talkative",name:"Talkative",id_str:"706"};beforeEach(function(){this.component.renderConversationView(b,$.extend(a,{el:c(!0)})),this.component.trigger("dataDMConversationResult",{recipient:a,html:d(100)})}),it("triggers dataMarkDMsAsRead if mark as read failed with invalid response",function(){this.component.trigger("dataDMReadSuccess",{text:"failure",sourceEventData:{recipient_name:"talkative"}}),this.component.renderConversationView(b,$.extend(a,{el:c(!1)})),expect("dataMarkDMsAsRead").toHaveBeenTriggeredOnAndWith(document,{last_message_id:"100",recipient_id:"706",recipient_name:"talkative"})}),it("triggers dataMarkDMsAsRead if mark as read failed with some error",function(){this.component.trigger("dataDMReadError",{sourceEventData:{recipient_name:"talkative"}}),this.component.renderConversationView(b,$.extend(a,{el:c(!1)})),expect("dataMarkDMsAsRead").toHaveBeenTriggeredOnAndWith(document,{last_message_id:"100",recipient_id:"706",recipient_name:"talkative"})})})}),describe("mark all as read",function(){it("triggers uiDMDialogMarkMessage",function(){spyOnEvent(document,"uiDMDialogMarkMessage"),this.component.select("markReadConfirmSelector").click(),expect("uiDMDialogMarkMessage").toHaveBeenTriggeredOn(document)}),it("triggers uiReadStateChanged",function(){spyOnEvent(document,"uiReadStateChanged"),this.component.select("markReadConfirmSelector").click(),expect("uiReadStateChanged").toHaveBeenTriggeredOnAndWith(document,{msgCount:0})})}),describe("caching",function(){var a={screen_name:"chatty",name:"Mr. Chatty",el:'<div data-last-message-id="123"></div>'},b={recipient:a,html:'<div class="dm-convo dm-conversation js-dm-conversation" data-thread-id="talkative"><div id="test-conversation" class="dm js-dm-item" data-message-id="123">Test</div></div>'},c=$.Event("click");beforeEach(function(){spyOnEvent(document,"uiNeedsDMConversation")}),it("requests target conversation",function(){this.component.renderConversationView(c,a),expect("uiNeedsDMConversation").toHaveBeenTriggeredOnAndWith(document,{screen_name:"chatty"})}),it("renders cached conversation view",function(){this.component.renderView(this.component.attr.classConversation),this.component.trigger("dataDMConversationResult",b),this.component.renderConversationView(c,a),expect("uiNeedsDMConversation").not.toHaveBeenTriggeredOnAndWith(document,{screen_name:"chatty"})}),it("does not render cached conversation when message list is refreshed and has new items",function(){this.component.renderView(this.component.attr.classConversation),this.component.trigger("dataDMConversationResult",b),this.component.renderConversationView(c,$.extend(a,{el:'<div data-last-message-id="1234"></div>'})),expect("uiNeedsDMConversation").toHaveBeenTriggeredOnAndWith(document,{screen_name:"chatty"})})})}),describe("uiSendDM",function(){it("sends a tweet",function(){spyOnEvent(document,"uiDMDialogSendMessage"),this.component.trigger("uiSendDM",{recipient:"chatty",tweetData:{status:"test"},tweetboxId:"123"}),expect("uiDMDialogSendMessage").toHaveBeenTriggeredOnAndWith(document,{screen_name:"chatty",text:"test",tweetboxId:"123"})}),it("marks the conversation list for refresh",function(){this.component.trigger("uiSendDM",{recipient:"chatty",tweetData:{status:"test"}}),expect(this.$node.find("#conversationList")).toHaveClass("needs-refresh")}),it("sends a message to the recipient specified in the autocomplete field",function(){spyOnEvent(document,"uiDMDialogSendMessage"),this.component.renderNewView(),this.$node.find("#new input[type=text]").val("talkative"),this.component.trigger("uiSendDM",{tweetData:{status:"test"}}),expect("uiDMDialogSendMessage").toHaveBeenTriggeredOnAndWith(document,{screen_name:"talkative",text:"test"})}),it("sends a message to a recipient with an all numeric screen name",function(){var a='<div class="dm-convo dm-conversation js-dm-conversation" data-thread-id="123456">\n          <div id="test-conversation" class="dm js-dm-item" data-message-id="1000">\n            Testing\n          </div>\n        </div>\n      ';spyOnEvent(document,"uiDMDialogSendMessage"),this.$node.addClass(this.component.attr.classConversation),this.component.trigger("dataDMConversationResult",{recipient:{screen_name:"123456",name:"abcd",el:'<div data-last-message-id="1000"></div>'},html:a}),this.component.trigger("uiSendDM",{tweetData:{status:"testing"},tweetboxId:"1000"}),expect("uiDMDialogSendMessage").toHaveBeenTriggeredOnAndWith(document,{screen_name:"123456",text:"testing",tweetboxId:"1000"}),expect(this.$node.find("#conversationList")).toHaveClass("needs-refresh")})}),describe("show error banner",function(){beforeEach(function(){this.component.open(),this.mockData={message:"oh no! an error just happened!"},this.$node.find("#error-container").hide()}),afterEach(function(){this.component.close()}),it("shows it on dataDMError",function(){$(document).trigger("dataDMError",this.mockData),expect(this.$node.find("#error-container")).toBeVisible()}),it("displays the text in data.message",function(){$(document).trigger("dataDMError",this.mockData),expect(this.$node.find("#error-text")).toHaveText(this.mockData.message)}),it("displays the text in data.error",function(){this.mockData={error:"a simple but harmful error"},$(document).trigger("dataDMError",this.mockData),expect(this.$node.find("#error-text")).toHaveText(this.mockData.error)}),it("sets focus within the dialog",function(){expect(this.component.hasFocus()).toBe(!0)})}),describe("hide error banner",function(){beforeEach(function(){$(document).trigger("dataDMError",{message:"failure!"})}),it("hides it on opening",function(){this.component.trigger("uiNeedsDMDialog"),expect(this.$node.find("#error-container")).toBeHidden()}),it("hides it on view change",function(){this.component.renderNewView(),expect(this.$node.find("#error-container")).toBeHidden()}),it("hides it on close click",function(){this.$node.find("#error-close").click(),expect(this.$node.find("#error-container")).toBeHidden()})}),describe("method deleteConfirm",function(){it("deletes a message",function(){spyOnEvent(document,"uiDMDialogDeleteMessage"),this.component.deleteConfirm(),expect("uiDMDialogDeleteMessage").toHaveBeenTriggeredOnAndWith(document,{id:"123"})}),it("marks the conversation list for refresh",function(){this.component.deleteConfirm(),expect(this.$node.find("#conversationList")).toHaveClass("needs-refresh")})}),describe("method markMessages",function(){it("marks all messages as read",function(){spyOnEvent(document,"dataMarkDMsAsRead"),this.component.markMessages(null,{messageId:"1234"}),expect("dataMarkDMsAsRead").toHaveBeenTriggeredOnAndWith(document,{last_message_id:"1234"})})}),describe("event uiTypeaheadItemSelected and uiTypeaheadItemComplete",function(){it("upates the autocomplete textbox with the user's profile picture and does not switch view",function(){spyOn(this.component,"renderConversationView"),this.component.trigger("uiTypeaheadItemSelected",{item:{profile_image_url_https:"http://twitter.com",screen_name:"bob"}}),expect(this.$node.find("img.selected-profile")).toHaveAttr("src","//twitter.com"),expect(this.component.renderConversationView).not.toHaveBeenCalled()}),it("switches the dialog to the conversation if a conversation has previously taken place",function(){spyOn(this.component,"renderConversationView"),this.component.trigger("uiTypeaheadItemComplete",{item:{screen_name:"chatty",name:"Chatty"}}),expect(this.component.renderConversationView).toHaveBeenCalledWith(null,{screen_name:"chatty",name:"Chatty"})})}),describe("dataNotificationsReceived",function(){beforeEach(function(){this.component.unreadCount=1,this.component.open()}),describe("message list",function(){beforeEach(function(){spyOnEvent(document,"dataRefreshDMs"),this.$node.addClass(this.component.attr.classConversationList)}),it("does not refresh when there are no new messages",function(){this.component.trigger("dataNotificationsReceived",{d:{status:"ok",response:1}}),expect("dataRefreshDMs").not.toHaveBeenTriggeredOn(document)}),it("refreshes when there's a new unread message",function(){this.component.trigger("dataNotificationsReceived",{d:{status:"ok",response:2}}),expect("dataRefreshDMs").toHaveBeenTriggeredOn(document)})}),describe("conversation",function(){beforeEach(function(){spyOnEvent(document,"uiNeedsDMConversation"),this.component.$node.addClass(this.component.attr.classConversation)}),it("does not refresh conversation when no new messages",function(){this.component.trigger("dataNotificationsReceived",{d:{status:"ok",response:1}}),expect("uiNeedsDMConversation").not.toHaveBeenTriggeredOn(document)}),it("refreshes the conversation when there's a new unread message",function(){this.component.trigger("dataNotificationsReceived",{d:{status:"ok",response:2}}),expect("uiNeedsDMConversation").toHaveBeenTriggeredOnAndWith(document,{screen_name:"chatty"})})})})})
});
define("test/app/ui/profile_popup_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile_popup",function(){beforeEach(function(){var a='<div id="profile_popup" style="display: none;" class="modal-container">\n        <div class="modal modal-small draggable clearfix">\n          <div class="modal-content">\n            <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n            <div class="modal-header">\n              <h3 class="modal-title">Profile summary</h3>\n            </div>\n            <div class="modal-body profile-modal"></div>\n            <div class="loading">\n              <img src="" />\n              <p>Loading...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    ';setupComponent(a),this.$spinner=this.$node.find(".loading")}),describe("on uiShowProfilePopup",function(){beforeEach(function(){this.component.open()}),afterEach(function(){this.component.close()}),describe("for any user",function(){beforeEach(function(){this.$node.trigger("uiShowProfilePopup",{userId:1})}),it("shows the profile popup",function(){expect(this.$node).toBeVisible()}),it("shows a loading spinner",function(){expect(this.$node).not.toHaveClass("has-content")})}),describe("when the user is not promoted, after a promoted profile popup was shown",function(){beforeEach(function(){this.$node.trigger("uiShowProfilePopup",{userId:1,impressionId:"187",impressionCookie:"cookie"}),this.$node.trigger("uiShowProfilePopup",{userId:1})}),it("does not have data-impression-id and data-impression-cookie on the components DOM node",function(){expect(this.$node).not.toHaveAttr("data-impression-id"),expect(this.$node).not.toHaveAttr("data-impression-cookie")})}),describe("when the user is promoted",function(){beforeEach(function(){this.$node.trigger("uiShowProfilePopup",{userId:1,impressionId:"187",impressionCookie:"cookie"})}),it("adds data-impression-id and data-impression-cookie to the components DOM node",function(){expect(this.$node).toHaveAttr("data-impression-id","187"),expect(this.$node).toHaveAttr("data-impression-cookie","cookie")}),describe("on a uiShowProfilePopup for a different promoted user",function(){beforeEach(function(){this.$node.trigger("uiShowProfilePopup",{userId:1,impressionId:"781",impressionCookie:"iekooc"})}),it("adds data-impression-id and data-impression-cookie for the current promoted user to the components DOM node",function(){expect(this.$node).toHaveAttr("data-impression-id","781"),expect(this.$node).toHaveAttr("data-impression-cookie","iekooc")})})}),describe("when the user is earned",function(){beforeEach(function(){this.$node.trigger("uiShowProfilePopup",{userId:1,impressionId:"187",disclosureType:"earned",impressionCookie:"cookie"})}),it("adds data-impression-id and data-impression-cookie to the components DOM node",function(){expect(this.$node).toHaveAttr("data-impression-id","187"),expect(this.$node).toHaveAttr("data-impression-cookie","cookie"),expect(this.$node).toHaveAttr("data-disclosure-type","earned")})}),describe("when a tweetId is present",function(){beforeEach(function(){this.$node.trigger("uiShowProfilePopup",{userId:1,tweetId:2})}),it("adds a data-associated-tweet-id attribute",function(){expect(this.$node.attr("data-associated-tweet-id")).toBe("2")})}),describe("on dataProfilePopupSuccess",function(){beforeEach(function(){$(document).trigger("dataProfilePopupSuccess",{html:'<p>Some <a href="#" class="js-initial-focus">arbitrary</a> HTML</p>'})}),it("inserts the returned content into the DOM",function(){expect(this.$node).toHaveText(/Some arbitrary HTML/)}),it("hides the loading spinner",function(){expect(this.$node).toHaveClass("has-content")}),it("sets focus to an element within the popup",function(){expect(this.component.$node.find(".js-initial-focus")).toBeFocused()}),describe("on a second dataProfilePopupSuccess",function(){beforeEach(function(){$(document).trigger("dataProfilePopupSuccess",{html:"<p>Some different HTML</p>"})}),it("removes the old content and inserts the new content",function(){expect(this.$node).not.toHaveText(/Some arbitrary HTML/),expect(this.$node).toHaveText(/Some different HTML/)}),describe("closing the dialog",function(){it("clears the content of the dialog",function(){this.component.trigger("uiDialogClosed"),expect(this.$node).not.toHaveText(/Some different HTML/)})})}),describe("with a click on a user link for the user whose profile popup is showing",function(){beforeEach(function(){var a=['<div class="profile-modal-header" data-user-id="706" data-screen-name="talkative">','<s>@</s><a href="/talkative" class="twitter-atreply">talkative</a>',"</div>"].join("");spyOnEvent(this.$node,"uiWantsProfilePopup"),$(document).trigger("dataProfilePopupSuccess",{html:a,screen_name:"talkative",user_id:706}),this.$node.find(".twitter-atreply").click()}),it("does not trigger a uiWantsProfilePopup",function(){expect("uiWantsProfilePopup").not.toHaveBeenTriggeredOn(this.$node)})})}),describe("on dataProfilePopupFailure",function(){beforeEach(function(){$(document).trigger("dataProfilePopupFailure",{message:"Sorry!"})}),it("adds the error message to the body of the popup",function(){expect(this.$node).toHaveText(/Sorry!/)})}),describe("removes tweets for short viewports",function(){var a,b,c=5,d=50;beforeEach(function(){b=this.component.$dialog.height(),this.component.attr.top=0,this.component.attr.bottom=0;var e=$("<div class='simple-tweet'>...</div>").height(d);a=$("<div>");for(var f=0;f<c;f++)a.append(e.clone())}),it("shows all tweets when there is plenty of height",function(){this.component.getWindowHeight=function(){return 1e3},$(document).trigger("dataProfilePopupSuccess",{html:a.html()}),expect(this.$node.find(".simple-tweet").length).toBe(c)}),it("shows the minimum number of tweets when there is little room",function(){this.component.getWindowHeight=function(){return 150},$(document).trigger("dataProfilePopupSuccess",{html:a.html()}),expect(this.$node.find(".simple-tweet").length).toBe(this.component.attr.tweetMinimum)}),it("shows 4 tweets",function(){this.component.getWindowHeight=function(){return b+d*4},$(document).trigger("dataProfilePopupSuccess",{html:a.html()}),expect(this.$node.find(".simple-tweet").length).toBe(4)}),it("shows 3 tweets",function(){this.component.getWindowHeight=function(){return b+d*4-1},$(document).trigger("dataProfilePopupSuccess",{html:a.html()}),expect(this.$node.find(".simple-tweet").length).toBe(3)})}),describe("when a user moves from the page when the popup is open",function(){beforeEach(function(){$(document).trigger("uiShowProfilePopup",{userId:1,impressionId:"187",impressionCookie:"cookie"})}),it("should close, even when the profile dropdown is opened and closed",function(){var a=$("#profule_popup");a.find(".user-dropdown").trigger("click").trigger("click"),$(".view-profile").click(),expect(a.is(":visible")).toBe(!1)})})})})
});
define("test/app/ui/message_drawer_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/message_drawer",function(){beforeEach(function(){jasmine.Clock.useMock(),this.message="A message for the user";var a='<div class="alert-messages hidden" id="message-drawer">\n        <div class="message">\n          <div class="message-inside">\n            <span class="message-text"></span><a class="dismiss" href="#">&times;</a>\n          </div>\n        </div>\n      </div>\n    ';setupComponent(a)}),describe("uiShowMessage",function(){beforeEach(function(){jQuery.fx.off=!0,this.component.trigger("uiShowMessage",{message:this.message})}),it("removes hidden class from the message drawer",function(){expect(this.component.$node).not.toHaveClass("hidden")}),it("displays the message within the message-text span",function(){expect(this.component.select("textSelector")).toHaveText(this.message)}),it("does not show a close button",function(){expect(this.component.select("closeSelector")).toBeHidden()}),it("fades away after 3 seconds",function(){expect(this.component.$node).toBeVisible(),jasmine.Clock.tick(3e3),expect(this.component.$node).toHaveCss("opacity",0),expect(this.component.$node).toHaveClass("hidden")}),it("replaces the current message with newer messages, even after fade away",function(){expect(this.component.select("textSelector")).toHaveText(this.message),expect(this.component.$node).toHaveCss("opacity",1),expect(this.component.$node).not.toHaveClass("hidden"),jasmine.Clock.tick(3e3),this.component.trigger("uiShowMessage",{message:"newer message"}),expect(this.component.select("textSelector")).toHaveText("newer message"),expect(this.component.$node).toHaveCss("opacity",1),expect(this.component.$node).not.toHaveClass("hidden")})}),describe("uiShowError",function(){beforeEach(function(){this.component.trigger("uiShowError",{message:this.message})}),it("displays the message within the message-text span",function(){expect(this.component.select("textSelector")).toHaveText(this.message)}),it("shows a close button",function(){expect(this.component.select("closeSelector")).toBeVisible()}),it("hides when the close button is clicked",function(){expect(this.component.$node).not.toHaveClass("hidden"),this.component.select("closeSelector").click(),expect(this.component.$node).toHaveClass("hidden")}),it("reloads the page when the reload link is clicked",function(){this.component.trigger("uiShowError",{message:'<a href="#" class="js-reload">Reload the page</a>'}),spyOn(this.component,"reloadPage"),this.component.select("reloadSelector").click(),expect(this.component.reloadPage).toHaveBeenCalled()}),it("hides when the uiBeforePageChanged event is fired",function(){expect(this.component.$node).not.toHaveClass("hidden"),this.component.trigger(document,"uiBeforePageChanged"),expect(this.component.$node).toHaveClass("hidden")}),it("replaces the current error with newer errors",function(){expect(this.component.select("textSelector")).toHaveText(this.message),this.component.trigger("uiShowError",{message:"newer error"}),expect(this.component.select("textSelector")).toHaveText("newer error")}),it("does not fade away after 60 seconds",function(){expect(this.component.$node).toBeVisible(),jasmine.Clock.tick(6e4),expect(this.component.$node).toHaveCss("opacity",1)})}),describe("uiShowStickyMessage",function(){beforeEach(function(){this.component.trigger("uiShowStickyMessage",{message:this.message})}),it("displays the message within the message-text span",function(){expect(this.component.select("textSelector")).toHaveText(this.message)}),it("shows a close button",function(){expect(this.component.select("closeSelector")).toBeVisible()}),it("does not fade away after 60 seconds",function(){expect(this.component.$node).toBeVisible(),jasmine.Clock.tick(6e4),expect(this.component.$node).toHaveCss("opacity",1)})}),describe("closeMessage()",function(){it("hides the message drawer",function(){this.component.trigger("uiShowError",{message:this.message}),expect(this.component.$node).not.toHaveClass("hidden"),this.component.closeMessage(),expect(this.component.$node).toHaveClass("hidden")})}),describe("calculateFadeTimeout()",function(){it("Chooses default time as the minimum fadeout time.",function(){expect(this.component.calculateFadeTimeout("Programming in Scala")).toEqual(this.component.attr.fadeTimeout)}),it("Returns a fadeout time that allows for sentence readability given that the average reading speed is 5s per word.",function(){expect(this.component.calculateFadeTimeout("Programming in Scala: Consider again the definition of class ArrayElement shown in the previous section.")).toEqual(3225)})})})
});
define("test/app/ui/deactivated_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/color_picker",function(){describe("#onClick",function(){xit("",function(){expect("").toBe("")})})})
});
define("test/app/ui/with_rosetta_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_rosetta",function(){describe("rosettaMixin",function(){describe("rosetta styling",function(){beforeEach(function(){setupComponent({rosetta:!0})}),it("should have a wider grid",function(){var a=function(){return 123};expect(this.component.aroundGetGridWidth(a)).toEqual(584)})}),describe("rosetta styling off",function(){beforeEach(function(){setupComponent({rosetta:!1})}),it("should have the default width grid",function(){var a=function(){return 123};expect(this.component.aroundGetGridWidth(a)).toEqual(123)})})})})
});
define("test/app/ui/inline_profile_editing_initializor_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/inline_profile_editing_initializor",function(){beforeEach(function(){setupComponent('<div><div class="testForEditingCss" style="display:none"></div></div>',{profileEditingCSSBundle:"/test.css"}),spyOnEvent(this.$node,"uiEditProfileStart"),spyOnEvent(this.$node,"uiNavigate"),this.triggerUiEditProfileInitialize=function(){var a=window.using;spyOn(window,"using").andCallFake(function(a,b){b()}),$(document).trigger("uiEditProfileInitialize",{scribeElement:"button"}),window.using=a}}),describe("on uiEditProfileInitialize",function(){describe("when it supports inline editing",function(){describe("when testForCssSelector is not set",function(){it("calls uiEditProfileStart",function(){this.triggerUiEditProfileInitialize(),expect("uiEditProfileStart").toHaveBeenTriggeredOnAndWith(this.$node,{scribeContext:{element:"button"}})})}),describe("when testForCssSelector is set",function(){beforeEach(function(){this.component.attr.testForCssSelector=".testForEditingCss:visible",jasmine.Clock.useMock()}),describe("when the test selector is initially visible",function(){beforeEach(function(){this.$node.find(".testForEditingCss").show(),this.triggerUiEditProfileInitialize(),jasmine.Clock.tick(this.component.attr.retryDelay*this.component.attr.retryMax)}),it("triggers uiEditProfileStart",function(){expect("uiEditProfileStart").toHaveBeenTriggeredOn(this.$node)}),it("does not trigger uiNavigate",function(){expect("uiNavigate").not.toHaveBeenTriggeredOnAndWith(this.$node,{href:"/settings/profile"})})}),describe("when the test selector becomes visible after uiEditProfileInitialize",function(){beforeEach(function(){this.triggerUiEditProfileInitialize(),this.$node.find(".testForEditingCss").show(),jasmine.Clock.tick(this.component.attr.retryDelay*this.component.attr.retryMax)}),it("triggers uiEditProfileStart",function(){expect("uiEditProfileStart").toHaveBeenTriggeredOn(this.$node)}),it("does not trigger uiNavigate",function(){expect("uiNavigate").not.toHaveBeenTriggeredOnAndWith(this.$node,{href:"/settings/profile"})})}),describe("when the test selector never becomes visible",function(){beforeEach(function(){this.triggerUiEditProfileInitialize(),jasmine.Clock.tick(this.component.attr.retryDelay*this.component.attr.retryMax)}),it("does not trigger uiEditProfileStart",function(){expect("uiEditProfileStart").not.toHaveBeenTriggeredOn(this.$node)}),it("triggers uiNavigate",function(){expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,{href:"/settings/profile"})})})})}),describe("when it doesn't inline editing",function(){it("calls uiNavigate",function(){spyOn(this.component,"supportsInlineEditing").andReturn(!1),$(document).trigger("uiEditProfileInitialize",{scribeElement:"button"}),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,{href:"/settings/profile"})})})})})
});
define("test/app/ui/with_rich_editor_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_rich_editor",function(){function b(a){return a}var a='<form class="tweet-form">\n      <div class="tweet-content">\n        <div contenteditable="true" spellcheck="true" class="tweet-box rich-editor"></div>\n        <div class="rich-normalizer" style="position:absolute;visibility:hidden"></div>\n      </div>\n    </form>\n  ';beforeEach(function(){setupComponent(a,{maxLength:140}),spyOn($,"browser").andReturn({}),this.component.ignoreDuringFakeFocus=b,this.component.initTextNode(),this.component.shouldBeRTL=jasmine.createSpy().andReturn(!1),this.component.hasFocus=jasmine.createSpy().andReturn(!0),this.component.getLength=jasmine.createSpy().andCallFake(function(a){return a.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/gm," ").length})}),it("sets isRich to true when attached to a content editable",function(){expect(this.component.isRich).toBeTruthy()}),it("sets notie class on content editable when browser is not ie",function(){expect(this.component.$text).toHaveClass("notie")}),it("clears notie class on content editable when browser is ie",function(){$.browser.msie=!0,this.component.initTextNode(),expect(this.component.$text).not.toHaveClass("notie")}),it("does not set isRich to true when attached to a content editable and calls legacy initTextNode",function(){setupComponent("<textarea></textarea>");var a=jasmine.createSpy();this.component.ignoreDuringFakeFocus=b,this.component.initTextNode(a),expect(a).toHaveBeenCalled(),expect(this.component.isRich).toBeFalsy()}),describe("linkify",function(){it("Linkifies mention",function(){expect(this.component.linkify("Hello @tw")).toEqual('Hello <a class="twitter-atreply pretty-link" href="/tw" dir="ltr"><s>@</s>tw</a>')}),it("Linkifies hashtag",function(){expect(this.component.linkify("#boom")).toEqual('<a href="/search?q=%23boom" class="twitter-hashtag pretty-link" dir="ltr"><s>#</s>boom</a>')}),it("Linkifies rtol hashtag",function(){this.component.shouldBeRTL.andReturn(!0),expect(this.component.linkify("#boom")).toEqual('<a href="/search?q=%23boom" class="twitter-hashtag pretty-link" dir="rtl"><s>#</s>boom</a>'),expect(this.component.shouldBeRTL).toHaveBeenCalledWith("boom",0)}),it("Linkifies url",function(){expect(this.component.linkify("Check out example.com")).toEqual('Check out <a href="http://example.com" class="twitter-timeline-link" dir="ltr">example.com</a>')}),it("Leaves whitespace alone",function(){expect(this.component.linkify(" a  b \n\n  ")).toEqual(" a  b \n\n  ")}),it("Escapes html entities in plain text and in links",function(){expect(this.component.linkify("&<>'\" example.com/?a&b")).toEqual('&amp;&lt;&gt;&#39;&quot; <a href="http://example.com/?a&amp;b" class="twitter-timeline-link" dir="ltr">example.com/?a&amp;b</a>')})}),describe("setCursorPosition",function(){it("calls the legacy setCursorPosition when isRich is false",function(){var a=jasmine.createSpy();this.component.isRich=!1,this.component.setCursorPosition(a,3),expect(a).toHaveBeenCalledWith(3)}),it("calls setSelectionOffsets with 0 when position is 0",function(){spyOn(this.component.htmlRich,"setSelectionOffsets"),this.component.setCursorPosition(null,0),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([0])}),it("calls setSelectionOffsets with attr.cursorPosition when defined",function(){this.component.attr.cursorPosition=3,spyOn(this.component.htmlRich,"setSelectionOffsets"),this.component.setCursorPosition(),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([this.component.attr.cursorPosition])}),it("calls setSelectionOffsets with MAX_VALUE when position is undefined",function(){spyOn(this.component.htmlRich,"setSelectionOffsets"),this.component.setCursorPosition(),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([Number.MAX_VALUE])}),it("does not call setSelectionOffsets when not focused",function(){this.component.hasFocus.andReturn(!1),spyOn(this.component.htmlRich,"setSelectionOffsets"),this.component.setCursorPosition(),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled()})}),describe("detectUpdatedText",function(){beforeEach(function(){spyOn(this.component.htmlRich,"setSelectionOffsets"),spyOn(this.component.htmlRich,"getSelectionOffsets").andReturn(null),spyOn(this.component.htmlRich,"setHtml"),spyOn(this.component.htmlRich,"getHtml").andReturn(""),spyOn(this.component.htmlRich,"getText").andReturn(""),this.component.prevSelectionOffset=Number.MAX_VALUE,this.component.updateCleanedTextAndOffset=jasmine.createSpy()}),it("calls the legacy detectUpdatedText when isRich is false",function(){var a=jasmine.createSpy();this.component.isRich=!1,this.component.detectUpdatedText(a),expect(a).toHaveBeenCalledWith(undefined,undefined)}),it("returns before calling updateCleanedTextAndOffset if html has not changed",function(){this.component.prevHtml="",this.component.detectUpdatedText(null),expect(this.component.updateCleanedTextAndOffset).not.toHaveBeenCalled()}),it("calls updateCleanedTextAndOffset if text has not changed but force is true",function(){this.component.prevHtml="",this.component.detectUpdatedText(null,!0),expect(this.component.updateCleanedTextAndOffset).toHaveBeenCalled()}),it("calls updateCleanedTextAndOffset if text has not changed but is being specified",function(){this.component.prevHtml="",this.component.detectUpdatedText(null,!1,""),expect(this.component.updateCleanedTextAndOffset).toHaveBeenCalled()}),it("calls updateCleanedTextAndOffset if text has not changed but position has",function(){this.component.prevHtml="",this.component.prevSelectionOffset=0,this.component.detectUpdatedText(null),expect(this.component.updateCleanedTextAndOffset).toHaveBeenCalled()}),describe("fake-focus",function(){beforeEach(function(){this.verifyFakeFocusDuringSetHtmlToBe=function(a){var b=!1;this.component.htmlRich.setHtml.andCallFake(function(){b=this.component.$text.hasClass("fake-focus")}.bind(this)),this.component.detectUpdatedText(null,!1,"New forced text"),expect(this.component.$text).not.toHaveClass("fake-focus"),expect(b).toBe(a)}}),describe("when isFocusing is false",function(){it("adds fake-focus during html overwriting if new text is forced",function(){this.component.isFocusing=!1,this.verifyFakeFocusDuringSetHtmlToBe(!0)})}),describe("when isFocusing is true",function(){it("does not add fake-focus during html overwriting if new text is forced",function(){this.component.isFocusing=!0,this.verifyFakeFocusDuringSetHtmlToBe(!1)})})}),it("html escapes < > and & but not single or double quotes",function(){this.component.detectUpdatedText(null,!0,"<>&\"'"),expect(this.component.htmlRich.setHtml).toHaveBeenCalledWith("<div>&lt;&gt;&amp;\"'</div>")}),it("removes invalid chars",function(){this.component.detectUpdatedText(null,!0,"﻿￿‪‫‬‭‮\0"),expect(this.component.htmlRich.setHtml).toHaveBeenCalledWith("<div><br></div>")}),it("sets html and puts cursor at end",function(){this.component.detectUpdatedText(null,!1,"Test"),expect(this.component.htmlRich.setHtml).toHaveBeenCalledWith("<div>Test</div>"),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([Number.MAX_VALUE])}),it("does not set html or cursor position when text change does not alter html",function(){this.component.htmlRich.getHtml.andReturn("<div>Hello</div>"),this.component.detectUpdatedText(null,!1,"Hello"),expect(this.component.htmlRich.setHtml).not.toHaveBeenCalled(),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled()}),it("does not replace html while in composition",function(){this.component.htmlRich.getHtml.andReturn("Hello"),this.component.$text.attr("data-in-composition","true"),this.component.detectUpdatedText(null,!1),expect(this.component.htmlRich.setHtml).not.toHaveBeenCalled(),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled()}),it("replaces html with markup and preserves cursor offset",function(){this.component.htmlRich.getHtml.andReturn("Hello @tw."),this.component.htmlRich.getText.andReturn("Hello @tw."),this.component.htmlRich.getSelectionOffsets.andReturn([8]),this.component.detectUpdatedText(null),expect(this.component.htmlRich.setHtml).toHaveBeenCalledWith('<div>Hello <a class="twitter-atreply pretty-link" href="/tw"><s>@</s>tw</a>.</div>'),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([8])}),it("adds em tags around text overage",function(){var a=Array(146).join("a")+"\nbbb";this.component.detectUpdatedText(null,!1,a),expect(this.component.htmlRich.setHtml).toHaveBeenCalledWith("<div>"+a.slice(0,140)+"<em>aaaaa</em></div><div><em>bbb</em></div>")}),it("replaces trailing space with non-breaking space inside the em tag",function(){var a=Array(146).join("a")+"  ";this.component.detectUpdatedText(null,!1,a),expect(this.component.htmlRich.setHtml).toHaveBeenCalledWith("<div>"+a.slice(0,140)+"<em>aaaaa &nbsp;</em></div>")}),it("adds em tag around correct place when all non-bmp unicode chars are present",function(){var a=Array(142).join("𐀀");this.component.detectUpdatedText(null,!1,a),expect(this.component.htmlRich.setHtml).toHaveBeenCalledWith("<div>"+a.slice(0,280)+"<em>𐀀</em></div>")}),it("adds em tag around correct place when two non-bmp unicode chars follow 139 normal chars",function(){var a=Array(140).join("a")+"𐀀񐄀bbb";this.component.detectUpdatedText(null,!1,a),expect(this.component.htmlRich.setHtml).toHaveBeenCalledWith("<div>"+a.slice(0,139)+"𐀀<em>񐄀bbb</em></div>")})}),describe("getMaxLengthOffset",function(){it("returns -1 when the text is less than 140 chars",function(){expect(this.component.getMaxLengthOffset("Hello")).toBe(-1)}),it("returns -1 when the text is equal to 140 chars",function(){expect(this.component.getMaxLengthOffset(Array(141).join("a"))).toBe(-1)}),it("returns 140 when the text is more than 140 chars",function(){expect(this.component.getMaxLengthOffset(Array(142).join("a"))).toBe(140)}),it("returns 141 when the text is more than 140 chars and there is one non-BMP unicode char",function(){expect(this.component.getMaxLengthOffset("𐀀"+Array(141).join("a"))).toBe(141)}),it("returns 150 when the actual text length is 10 chars longer than the calculated tweet length",function(){this.component.getLength.andReturn(141),expect(this.component.getMaxLengthOffset(Array(152).join("a"))).toBe(150)}),it("returns 130 when the actual text length is 10 chars shorter than the calculated tweet length",function(){this.component.getLength.andReturn(141),expect(this.component.getMaxLengthOffset(Array(132).join("a"))).toBe(130)})}),describe("setSelectionIfFocused",function(){beforeEach(function(){spyOn(this.component.htmlRich,"setSelectionOffsets")}),it("sets selection if focused",function(){this.component.setSelectionIfFocused([3]),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([3])}),it("does not set selection if not focused",function(){this.component.hasFocus.andReturn(!1),this.component.setSelectionIfFocused([3]),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled()})}),describe("selectPrevCharOnBackspace",function(){var a;beforeEach(function(){a=$.Event("keydown"),a.which=8}),it("does not call selectPrevCharOnBackspace when browser is not msie",function(){spyOn(this.component,"selectPrevCharOnBackspace"),this.component.$text.trigger(a),expect(this.component.selectPrevCharOnBackspace).not.toHaveBeenCalled()}),describe("browser is msie",function(){beforeEach(function(){$.browser.msie=!0,this.component.initTextNode(),spyOn(this.component.htmlRich,"setSelectionOffsets"),spyOn(this.component.htmlRich,"getSelectionOffsets").andReturn(null)}),it("does not set selection if cursor not present",function(){this.component.$text.trigger(a),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled()}),it("sets selection to prev char when cursor is collapsed",function(){this.component.htmlRich.getSelectionOffsets.andReturn([5]),this.component.$text.trigger(a),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([4,5])}),it("does not set selection and blocks keydown if cursor is at 0",function(){this.component.htmlRich.getSelectionOffsets.andReturn([0]),spyOn(a,"preventDefault"),spyOn(a,"stopPropagation"),this.component.$text.trigger(a),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled(),expect(a.preventDefault).toHaveBeenCalled(),expect(a.stopPropagation).toHaveBeenCalled()}),it("does not set selection when cursor is max value",function(){this.component.htmlRich.getSelectionOffsets.andReturn([Number.MAX_VALUE]),this.component.$text.trigger(a),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled()}),it("does not set selection when cursor is a range",function(){this.component.htmlRich.getSelectionOffsets.andReturn([4,5]),this.component.$text.trigger(a),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled()})})}),describe("emulateCommandArrow",function(){var a;beforeEach(function(){a=$.Event("keydown"),a.which=37,a.metaKey=!0}),it("does not call emulateCommandArrow when browser is not mozilla",function(){spyOn(this.component,"emulateCommandArrow"),this.component.$text.trigger(a),expect(this.component.emulateCommandArrow).not.toHaveBeenCalled()}),describe("browser is mozilla",function(){beforeEach(function(){$.browser.mozilla=!0,this.component.initTextNode(),spyOn(this.component.htmlRich,"setSelectionOffsets")}),it("sets selection to beginning when cmd-left",function(){this.component.$text.trigger(a),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([0])}),it("sets selection to end when cmd-right",function(){a.which=39,this.component.$text.trigger(a),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([Number.MAX_VALUE])}),it("does not set selection when shift is pressed",function(){a.shiftKey=!0,this.component.$text.trigger(a),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled()})})}),describe("stopEvent",function(){it("calls stopEvent when links are clicked on in the rich editor",function(){spyOn(this.component,"stopEvent").andCallThrough(),this.component.initTextNode(),this.component.htmlRich.setHtml('<a href="#"></a>');var a=this.component.$text.find("a");expect(a.length).toEqual(1),a.click(),expect(this.component.stopEvent).toHaveBeenCalled()})}),describe("saveUndoStateDeferred",function(){beforeEach(function(){spyOn(this.component,"saveUndoState"),spyOn(this.component,"detectUpdatedText"),jasmine.Clock.useMock()}),it("calls saveUndoState right away and detectUpdatedText/saveUndoState deferred when not a focus event",function(){this.component.$text.trigger($.Event("paste")),expect(this.component.detectUpdatedText).not.toHaveBeenCalled(),expect(this.component.saveUndoState).toHaveBeenCalled(),this.component.saveUndoState.reset(),jasmine.Clock.tick(1),expect(this.component.detectUpdatedText).toHaveBeenCalled(),expect(this.component.saveUndoState).toHaveBeenCalled()}),it("calls saveUndoState and detectUpdatedText deferred when a focus event",function(){this.component.$text.trigger($.Event("focus")),expect(this.component.detectUpdatedText).not.toHaveBeenCalled(),expect(this.component.saveUndoState).not.toHaveBeenCalled(),jasmine.Clock.tick(1),expect(this.component.detectUpdatedText).toHaveBeenCalled(),expect(this.component.saveUndoState).toHaveBeenCalled()})}),describe("saveUndoState",function(){beforeEach(function(){spyOn(this.component.htmlRich,"getText").andReturn("hey"),spyOn(this.component.htmlRich,"getSelectionOffsets").andReturn([3]),this.component.undoHistory=[],this.component.undoIndex=-1}),it("pushes undo state when history is empty",function(){this.component.saveUndoState(),expect(this.component.undoHistory).toEqual([["hey",[3]]]),expect(this.component.undoIndex).toEqual(0)}),it("does not push undo state when condensed",function(){this.component.condensed=!0,this.component.saveUndoState(),expect(this.component.undoHistory).toEqual([]),expect(this.component.undoIndex).toEqual(-1)}),it("pushes undo state when it does not match current state",function(){this.component.undoHistory=[["nomatch",[0]]],this.component.undoIndex=0,this.component.saveUndoState(),expect(this.component.undoHistory).toEqual([["nomatch",[0]],["hey",[3]]]),expect(this.component.undoIndex).toEqual(1)}),it("truncates future undo states if a new undo state is pushed",function(){this.component.undoHistory=[["nomatch",[0]],["future1",[0]],["future2",[0]]],this.component.undoIndex=0,this.component.saveUndoState(),expect(this.component.undoHistory).toEqual([["nomatch",[0]],["hey",[3]]]),expect(this.component.undoIndex).toEqual(1)}),it("does not push new undo state when it matches the current state",function(){this.component.undoHistory=[["before",[0]],["hey",[3]],["after",[0]]],this.component.undoIndex=1,this.component.saveUndoState(),expect(this.component.undoHistory).toEqual([["before",[0]],["hey",[3]],["after",[0]]]),expect(this.component.undoIndex).toEqual(1)})}),describe("emulateUndo",function(){var a;beforeEach(function(){spyOn(this.component,"stopEvent"),spyOn(this.component,"saveUndoState"),a=$.Event("keydown"),a.which=90,a.ctrlKey=!0,this.component.isMac=!1,this.component.isWin=!1}),it("calls stop event when browser is mac and key is meta-z",function(){this.component.isMac=!0,a.metaKey=!0,a.ctrlKey=!1,this.component.$text.trigger(a),expect(this.component.stopEvent).toHaveBeenCalled()}),it("calls stop event when browser is win and key is ctrl-z",function(){this.component.isWin=!0,this.component.$text.trigger(a),expect(this.component.stopEvent).toHaveBeenCalled()}),it("calls stop event when browser is not mac or win and key is ctrl-z",function(){this.component.$text.trigger(a),expect(this.component.stopEvent).toHaveBeenCalled()}),it("calls saveUndoState",function(){this.component.$text.trigger(a),expect(this.component.saveUndoState).toHaveBeenCalled()}),it("calls setUndoState with the previous undo state",function(){spyOn(this.component,"setUndoState"),this.component.undoHistory=[["undone",[6]]],this.component.undoIndex=1,this.component.$text.trigger(a),expect(this.component.setUndoState).toHaveBeenCalledWith(["undone",[6]])})}),describe("emulateRedo",function(){var a;beforeEach(function(){spyOn(this.component,"stopEvent"),spyOn(this.component,"saveUndoState"),a=$.Event("keydown"),a.which=90,a.ctrlKey=!0,a.shiftKey=!0,this.component.isMac=!1,this.component.isWin=!1,spyOn(this.component.htmlRich,"getText").andReturn("")}),it("calls stop event when browser is mac and key is meta-shift-z",function(){this.component.isMac=!0,a.metaKey=!0,a.ctrlKey=!1,this.component.$text.trigger(a),expect(this.component.stopEvent).toHaveBeenCalled()}),it("calls stop event when browser is win and key is ctrl-y",function(){this.component.isWin=!0,a.shiftKey=!1,a.which=89,this.component.$text.trigger(a),expect(this.component.stopEvent).toHaveBeenCalled()}),it("calls stop event when browser is not mac or win and key is ctrl-shift-z",function(){this.component.$text.trigger(a),expect(this.component.stopEvent).toHaveBeenCalled()}),it("calls setUndoState with the next undo state",function(){spyOn(this.component,"setUndoState"),this.component.undoHistory=[["",[0]],["redo",[4]]],this.component.undoIndex=0,this.component.$text.trigger(a),expect(this.component.setUndoState).toHaveBeenCalledWith(["redo",[4]])})}),describe("setUndoState",function(){beforeEach(function(){spyOn(this.component,"detectUpdatedText"),spyOn(this.component.htmlRich,"setSelectionOffsets"),spyOnEvent(this.component.node,"uiHideAutocomplete"),this.component.setUndoState(["hello",[0]])}),it("calls detectUpdatedText with the new text",function(){expect(this.component.detectUpdatedText).toHaveBeenCalledWith(!1,"hello")}),it("calls setSelectionOffsets with the new offsets",function(){expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([0])}),it("triggers uiHideAutocomplete",function(){expect("uiHideAutocomplete").toHaveBeenTriggeredOn(this.component.node)})}),describe("interceptPlainTextPaste on paste",function(){var a;beforeEach(function(){spyOn(this.component,"saveUndoStateDeferred"),spyOn(this.component,"detectUpdatedText"),a=jQuery.Event("paste"),spyOn(a,"preventDefault"),jasmine.Clock.useMock()}),describe("when clipboardData is not available",function(){beforeEach(function(){a.originalEvent={}}),it("does not call prevent default on paste when clipboardData is not avialable",function(){this.component.$text.trigger(a),expect(a.preventDefault).not.toHaveBeenCalled()})}),describe("when clipboardData is available",function(){beforeEach(function(){a.originalEvent={clipboardData:{getData:jasmine.createSpy().andReturn("")}}}),it("calls event.originalEvent.clipboardData.getData('text')",function(){this.component.$text.trigger(a),expect(a.originalEvent.clipboardData.getData).toHaveBeenCalledWith("text")}),it("when clipboard is empty does not prevent default on paste ",function(){this.component.$text.trigger(a),expect(a.preventDefault).not.toHaveBeenCalled()}),describe("when clipboard has text",function(){beforeEach(function(){a.originalEvent.clipboardData.getData.andReturn("http://example.com/?a&b"),this.component.$text.focus(),window.getSelection().selectAllChildren(this.component.$text[0])}),it("prevents default",function(){this.component.$text.trigger(a),expect(a.preventDefault).toHaveBeenCalled()}),it("inserts the text into the editor with escaping",function(){this.component.$text.trigger(a),expect(this.component.$text).toHaveHtml("http://example.com/?a&amp;b")}),it("calls save undo state before injecting pasted text",function(){spyOn(this.component,"saveUndoState").andCallFake(function(){expect(this.component.$text).not.toHaveHtml("http://example.com/?a&amp;b")}.bind(this)),this.component.$text.trigger(a),expect(this.component.saveUndoState).toHaveBeenCalled()})})})}),describe("clearSelectionOnBlur",function(){beforeEach(function(){spyOn(window,"getSelection").andReturn({removeAllRanges:jasmine.createSpy()})}),it("removes ranges when selection is still in rich editor during blur",function(){spyOn(this.component.htmlRich,"getSelectionOffsets").andReturn([0]),this.component.$text.trigger("blur"),expect(window.getSelection().removeAllRanges).toHaveBeenCalled(),expect(this.component.previousSelection).toEqual([0])}),it("does not remove ranges when selection is not in rich editor during blur",function(){spyOn(this.component.htmlRich,"getSelectionOffsets").andReturn(null),this.component.$text.trigger("blur"),expect(window.getSelection().removeAllRanges).not.toHaveBeenCalled(),expect(this.component.previousSelection).toBeFalsy()})}),describe("restoreSelectionOnFocus",function(){beforeEach(function(){setupComponent(a,{maxLength:140}),spyOn(this.component,"saveUndoStateDeferred"),this.component.ignoreDuringFakeFocus=b,this.component.initTextNode(),spyOn(this.component.htmlRich,"setSelectionOffsets")}),it("restores and clears previousSelection when present during focus",function(){this.component.previousSelection=[0],this.component.$text.trigger("focus"),expect(this.component.htmlRich.setSelectionOffsets).toHaveBeenCalledWith([0]),expect(this.component.previousSelection).toBeFalsy()}),it("does not change selection when previousSelection not present during focus",function(){this.component.$text.trigger("focus"),expect(this.component.htmlRich.setSelectionOffsets).not.toHaveBeenCalled()})}),describe("restoreSelectionOnFocus",function(){beforeEach(function(){jasmine.Clock.useMock(),this.component.$text.trigger("focusin")}),it("sets isFocusing right after a focusin event handler",function(){expect(this.component.isFocusing).toBe(!0)}),it("clears isFocusing after time passed",function(){this.component.$text.trigger("focusin"),jasmine.Clock.tick(1),expect(this.component.isFocusing).toBe(!1)})}),describe("setSelection",function(){beforeEach(function(){spyOn(this.component,"setSelectionIfFocused"),this.component.initTextNode()}),it("calls setSelectionIfFocused with the selection",function(){this.component.setSelection(null,[4]),expect(this.component.setSelectionIfFocused).toHaveBeenCalledWith([4])}),it("does not call setSelectionIfFocused if no selection is passed",function(){this.component.setSelection(null),expect(this.component.setSelectionIfFocused).not.toHaveBeenCalled()})})})
});
define("test/app/ui/with_removable_stream_items_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_removable_stream_items",function(){beforeEach(function(){var a=$('<div id="timeline">      <div class="stream-items">        <div class="js-stream-item" data-item-id="42">          <div class="js-actionable-user" data-user-id="42">Felix</div>        </div>        <div class="js-stream-item" data-item-id="43">          <div class="js-actionable-user" data-user-id="43">Nick</div>        </div>      </div>    </div>');setupComponent(a)}),it("removes a stream item from the timeline",function(){this.component.removeStreamItem("42"),expect(this.$node.find('.js-stream-item[data-item-id="42"]')).not.toBeVisible()})})
});
define("test/app/ui/theme_preview_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/theme_preview",function(){var a,b;beforeEach(function(){a=$("body"),b=a.attr("style")||null,setupComponent()}),afterEach(function(){a.attr("style",b)}),describe("event uiThemeChanged",function(){it("updates attributes on uiThemeChanged event",function(){this.component.trigger("uiThemeChanged",{image:"test.png",tiled:!0,backgroundColor:"#00F"}),expect(a).toHaveCss("background-image",/test\.png/),expect(a).toHaveCss("background-repeat","repeat"),expect(a).toHaveCss("background-attachment","scroll");var b=a.css("background-color");expect(b=="rgb(0, 0, 255)"||b=="#00f").toBe(!0)})}),it("changes tiling on uiImageTileChanged event",function(){this.component.trigger("uiImageTileChanged",{tiled:!1}),expect(a).toHaveCss("background-repeat","no-repeat"),expect(a).toHaveCss("background-attachment","fixed")}),it("changes tiling on uiBackgroundRemoved event",function(){this.component.trigger("uiBackgroundRemoved"),expect(a).toHaveCss("background-image","none")})})
});
define("test/app/ui/tweet_box_thumbnails_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/tweet_box_thumbnails",function(){var a="/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCABFAGQDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD7ouPA3hC/v4tbuNHH29CJfOE0qENsmUkbWA5W4mDdmDDdnYuM2H4S/D6z0kaRpuhfZbZLGfSgiTu5SzmMfnQAyMx2v5SZ7g5ZSGZmP5t/GX4y/FnRfiz4z0zS/ix41s7bT/Eup28Ntba9dwwxxx3TqqRokgVVUdAOPbiuG1D45/G3dk/Fnx2rBwfl8S356gcj97n0/P3r4/8As/GYvDUZPEShPlXNa+rsvNfkem7KTP1xl8B+HJbhLw2V6Z1uba7EgvpwTcQDEUpIflumT/Hk7t2TUekfD7wzo0V3b2emN5V5FFBcJdXU1wZ44lKoreYzEqFO3nqODkCvyIm+OHx+kRWPxn+I5iCncp8TX4BXrwRJ9P196908G+J9P1PSLO81/wDa/wDifplzcR6OlxEPiCx8uaSewN/lM7ljEOoHyznKPY3bPvVGVYeQVZL38VN/16ib8j76/wCFZeDItSuNRXRQk9y8UkrpfT4cxXcl1Gcb8fLNNKw44Dsv3Tiq0Xwv+HtjLZX1t4fjiurG1Nnb3EU0yzLCbeK327w24/uoIQCTkbA2d2Wr4jtNRM2p2B/4a2+IFpp/22zt9Wif4nxzvZGeLTSUSRX23KJNcairTxoYwsCliArM8Fp4o0+8toJYv2q/iRD5stneyT3PxEmjNvYyNqE00MsCRvIbmG3s4ICYwwM93GVRlKLJK4dnfTEy+5C57dD7rg8EeBVtrKGPQbeaK0hsIbXzNz7I7R2a2xkn7hduepDEHIyKvSeHPDMumWelXVgrWNkkCQwSTuyKIHjkhzn7xRoo2UnJBXgjJz8Uxar4bstS0uyvf2vPG0seoX8EMF7D49MkcNq99fkPOFbKM1nbWykniKa6QuFXIHnHw0+LD+IdF0q/8f8Ax+8caffPrw0e8tm8VXUbG2la3kS8G44WJYkv4nOTh2tz0JBHw/iV8OIv6p/pIOddj9HrXw34Ztpbb7BplvAbS7nv7cAMPLuJmkMsoH95vPl3N1IlcdGOdmIrHJ5ssyoMkMFYnC/5AP8AnNfnfbeNvBV/qmj2Ot/HXxmdMuNLsrufUE8WSTFbiRUhnh2JO7ARy3Uc3zxxnZbXChWA3n578cfEXxnD4v1iDwr8S/FtzoEGozw6fIdYuGaS2R2WKU7mzkoFYjpknoBinHJsVHX2iv8A9v8A/wAmNNH7NvJHIwVnMhOC537lxuHXr/n04pymYSRCFAse4ZGOo9OfpX4ef8LD+JTkGXxhrhAO1VkvZCueMdT7dMZ5z2qo/irxtfSn7Rr+rSeYoARbmTG3nqPr7ev4dlDA4qnL36rt5N/+3XG7PY/ca51K7tpmiZ1HcBVJAH4GivMPgDJeXnwN+H0807GQ+GdMDltzMT9mjySSc5or8fzTMsfh8dWpKtOylJfE+/lb8jphycq0/r7i9onwp+BXjrRLPxvZ/DPwVrUXiGCPVodRuvD1vNJdx3C+aJnaWPczSBtxLfMSTnnNXZP2evguxjH/AAqH4eoF5Yf8IxZdMegjqr+zuraN+zz8NY9SK2z2Pg3SPtKSSKBAws4t24McqF+Yk8d/w9A/tjRzHcyR6raGK1V2uT56YhA3AlyT8oG1uv8AdPpX7p9XpqT3+84FNuKOBl/Z6+Aqq8r/AAb+HsQVTll8N2Sj15/djjGOvpVUfs7/AAIzn/hTfgQggkY8NWeefpCM+9egX+s6Pa/aI7nU7O3FoIvtRknRfJMhxHuBPy7ieOmccU5Iol25kRcZCNnnn8P8BWipwj0JcmcGf2efgUoYj4M+BGUDKE+H7TIB5x/qvavI/GF38B/BWqa7He/s1+E7qy8Oaiun3F3Do0BhZjp/25vLP2chmEI+ZQfkYHeVQo7fSDa1pn9ovpH9oWn25YRcG1LqJjCWKiTZnIXcMZPcHvRa61b6hGw07U4LsRu8JMMiyBZEco6HbxlWVlI7MrDqOGoRknoK7ufNsWofASPxENAuP2ffBNvaS3gs45YbGyllybyC1EnliELtVrlJHIkIWKOVssUAfU8OL8IfEXifTvDml/APwpbR6iNQ3SX2k21pc2jWVykVws9uYiyEpPbyRjO5xMuQi5evoQ3VwVVZLksvylcsdvqTgnPXH+etWVt7ukd2ySON3A5bGOgPHBYZx69ql0Idh88jl7H4P/CuKRWj+HfhZQoJUro1uDx2J2f5xV61+Gvw+tyzr4H8NqCcAx6dbjA98J1/w/CuhhHyoXiIVMcds9OCfbPPSnpOxePag4GSdwAZcDv+Pr/jS9hStsNzaMq38C+DbclY/CujKv3RiziAzxxjbx3Pf/DUTwz4egtxnStOj2/dYQIuT3I4HqauR3QBAWFSRjgdz9f4jyPwp7tCqEMFWRgXCscOcAHgHBxyP8kVlWw9PkdojU9TEuNNV3CxQPtjXYBG2AuO2MUVvWxQxcuoIJBDscj+fFFfDVeEqOMm8RKVnLU1ddwfKjiNT8f/AA2nGo+GdUvd8cGmXc99aT6bcmJrOLfHOx/d4aLKsmVOC3yAkkCvJl8J/CW9stT8O2/xC8etp2qaJFcXt1bI8gv47uL7ISxFsxN0Da3LvFtDCS6vGZGO5YvULqDxsmt3EuleBdGeO3t0mtbu6aISTTPdziVAUO+PbbEsCV+drnBK4fOJ4iv/AIuXSa3Hpfw10xXt7O6S2uHa2eS7k8yUxIm+YBBkRPulXBLMxQEbD93hpXpRb6pHNLR2Kvi/TPhDrnimDVtR17XrO/0Oyk1vykhuokkt9O1O3u5JWaSIpOI50VVQs2Emk8pVzuXD0HQPhXZX1n4dl+JXjDV7+G+0vTrO61SEXEw1BWu9Rj27rUKkkkUz75NoXy44FUqyjPQnxF8SL+e5t9H+F9msP9tmwEt3bRwr/ZhuLfzJ9kkyO+YftR4GCRC2D88QWxvvi/Dq0Vxqvw40oaRBZXVzci0kglvriZGWOG3TMiIjNGTLvO5fvRYQBZX6ObW5PQhvPDvw28UaZefE+78S6xcW9laWVnPfPEYvLXS7i5MjeU8CsGkF1dwzfKA8MrogVZG35eiaD8KLlP8AhGtM+JviOZf7W8S+HpLaZTN5uotJNc3wZprZizxBpgkpJR1LKzTB2D9T4kj+I1xq0lv4aFrZ6fFdwPBcx6fBMWjeKVnbMs4Bw5Q8xoQSQN4+Y5kt/wDGaPSUtofCOnXdyuh5UXEUCBdUWzDKDtugrxPOXRmCxlCoCiRJDLEQaQN3ZV8W6b8NNR02w8Ta38QNctLWbQ4J4b23TM32K3YwtKjLbtJE7vqMO5kCSZWMqFCPRcaF8N9B1TxRY6n4qub6XTLfQ4dStBZW0b6f5kiRWku+KFM/PbxyhATsMZ2qFKRi34tvvj4nhyS28LaRpI1YyXsUc8bpjKSqLVtk0hVUlXzS43MyHYgBBMi7Ot3nxeleaXSNC0hWSO6EcVzISjyGWRbaTzElB5RInliMY2rK22R2TypKvoCbOW8WD4c2enW07anc30Vh8QYLhBbQ2kKjVlvYoPsxcRKreU85PJ811t5AZGCuay/HXhL4IWkXiq713UbW2iuL+Cx195NLtJ/NnurmO9EZBj8ze6vBHv5Gxod25oQY/SbO6+Jqa04vrbRhp7xxeU9tbu7bhcbJGdmuAQGhHmKoRthdlLPszMW83xTTQtUf7HoL6pHqF2bBJHkS2eyaWRbYSSIWZZFQRu+EOcFRgsWQuO5ws+j/AA28L+JdI8UaZYLe6pceJbjTby+nnt86VeW+n3TMLmXYxVRHbrG2Sc74pcsxDtoWOpfDeC18R6WbK/kfWm1ey1PbLblrhrOH7PdeW7MrkqsYj+YbztWWRf3gkfuXk+IcmlwRR2Xh+fVwl4JpJJZo7bgSfZiuGZuSIN4I4BkIJKqH5+XTPjBCm3R7fwnptuuq6vetDaQODPbSQStarKMn9+1zIslw0ZQMVYhjubdjUl7rHdM6b4fNpM3gXw83hGVrTRBpdoNPhuN3mJbeSnlhuvIXGeTzmitbSV1VrCH7W9u84UCUxoVXfgbsBmyBnOM9sUV5NNJxTubN6lK/8KxX2j3GkXGv6ugu/tJW7iuStzbCYTA+U64KGNZWEbD7vlx53bTnA1f4eR3i3VtP8QvFkazwxwBo9VkVodtnLa716gORKJWJHM0cb4+XbXwf8Xv21/jf4U+Jfi/wtpN1oa2Wia3faXbrJYKWMUU7xrknknaBk98muKi/b5+PsRMi6vo8ZdcFPsEeDngEdfr/AJJrkdfOEl9Xow5bL4pu/wByX6sUoK+5+m1v4Vj0/XZvEEHiTV2WTzv9Aa7X7IPMjtkOIyMgKbYOuCCHnuT0lwNpJ47Yh5JJXwMNu/h565PHavyll/b2/aKlgZl8UWI8vBP/ABLYCT9MqRVRv28P2i5EwPGNrGcfMy6Vakrz6FPf881lUnxHU+CNKPzkyVTR+r51SGSUqiBGDY3OexFK13tGWJG35mCt93vz+HP/AOuvz++FvxO/aW+Jng3SfF9x8ZW02LUvEkeiC2h8J2M0sNrKBHFqGWKAw/amW3ODkMWOTjae40KD9pnxRoS+JLP9o29u7S4sLXUbW1g8E6S99LHPYW92qGE3CiOQfaChR3AOzeGIZSOOOF4pX/L6n9z/APkSW6a0Z9lfbEnI+ZSV7luDgdc9sf8A16a0+4s5j6AjcXyMZ7E9OvqK+EL7xr8dNH0nRdY1n9pnW7SPVNIutTNvD8PNLlmha20WPV5YWUThVIglZcTNE5k2bY2jZpU19Ouf2p9Q1nT9IP7TVtaSX1lHdJc3HhHTls7qQyaWg+xyuuLmGQ6sqRTYjEk0Ji2oG8xdoYXidu061NLyX/2orwR9uJPGm+Zk+9yDkDbj1I/KntI7APEdpyX6/e54yT9K/Iu4/bi/aojfyovikw8l3XB0PTAxC5PT7NjtUM37eH7VPRvigcsoAZdA0slic4xi2Ixn8eKmvlOe4lWljLf4Vb8kmaWR+vW11j5cvjqSORjqSeg5prXo8lyTGZFjYqhOAcDjjjvX5Fn9vD9qxhuX4ls3IyT4f04ZHHJxbcA5H/6qVf26/wBq4YkX4mozdNv9g6YTnvj/AEf+Y61wLIeIIS0xd0+8pX/JlJLsfrvYTq0J+0KEdWx97qMDnrRXD/ArxDqvi/4N+DPFPieUXuratolneXtx5Qj82Z4lZ22xgKMkngAD0GMUV6UMpx8IqPt3p5//AGpftIdUcD4p/YW+APi3xJq/izXtK1efUNb1GS9uyupyIjSzMZHIUdBuY4HpWZ/wwZ+zeoCy+GtUlMiry+rzk+gzzzjFFFfULZnM5NkSfsGfsyuUkm8FX0m1A6htYuuMgHH36jh/YP8A2X1cxn4f3JIcAt/bV7k9D/z1oor5fNMxxOHhF05W+S/yKu72Fh/Yd/ZcEyiH4aSpg4Odbvznp/029TmnRfsP/stXLtG/wtIwrDI1zUeQP+2/fHNFFfN/21j5pN1X+H+QLewL+wr+yosm7/hVWWc7d513UiQBz/z8Y9ffJok/Yi/ZVig3n4TBuAR/xPdSGMqT/wA/GPbpRRWMs5x6dvasm7tuRr+xH+yrCYxH8JFyxWPJ13Uj8pJ4/wCPj27YqQfsM/sppKSPhLHv3n5jrmpk9M/8/PtRRS/t7MYxbVV/h/kEW2h1z+xJ+ykiRyt8I977lRSfEOqHHKgHm47f0FWk/YZ/ZRc4b4THJbcSdf1M8/jce9FFdeCz3MKsmp1L6dl5eQNtdT2/Q/DOi+D9D07wr4bsvsWlaTbJZ2duJHk8uJBtVdzkscAdSSaKKK7ZZvjU/j/Bf5Bc/9k=";beforeEach(function(){jQuery.fx.off=!0;var a='<div class="thumbnail-container">\n        <div class="preview">\n          <div class="dismiss">\n            <i class="close"></i>\n          </div>\n          <span class="filename"></span>\n        </div>\n        <div class="preview-message">Image will appear as a link</div>\n      </div>\n    ';this.$node=$(a),this.$tweetbox=$('<div class="tweet-form" />'),this.$tweetbox.append(this.$node),this.component=(new this.Component).initialize(this.$node[0])}),it("triggers event to remove image when dismiss is clicked",function(){spyOnEvent(this.$node,"uiTweetBoxRemoveImage"),this.component.select("dismissSelector").trigger("click"),expect("uiTweetBoxRemoveImage").toHaveBeenTriggeredOn(this.$node)}),it("expands the thumbnail container when uiTweetBoxShowPreview is triggered",function(){this.$tweetbox.trigger("uiTweetBoxShowPreview",{fileName:"file.jpg"}),expect(this.component.select("filenameSelector")).toHaveText("file.jpg")}),it("hides the thumbnail container when uiTweetBoxHidePreview is triggered",function(){this.$tweetbox.trigger("uiTweetBoxShowPreview",{fileName:"file.jpg"}),expect(this.component.select("filenameSelector")).toHaveText("file.jpg"),this.$tweetbox.trigger("uiTweetBoxHidePreview"),expect(this.component.select("filenameSelector")).toHaveText("")})})
});
define("test/app/ui/with_card_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_card",function(){var a='<div>\n      <div id="tweet1" class="tweet" data-tweet-id="4"><div class="js-macaw-cards-iframe-container" data-src="/i/cards/tfw/v1/4"></div></div>\n      <div id="tweet2" class="tweet" data-tweet-id="20"><div class="js-macaw-cards-iframe-container" data-src="/i/cards/tfw/v1/20"></div></div>\n      <div id="tweet3" class="tweet" data-tweet-id="30" data-impression-id="some_id" data-disclosure-type="some_type"><div class="js-macaw-cards-iframe-container" data-src="/i/cards/tfw/v1/30"></div></div>\n    </div>\n  ',b,c;beforeEach(function(){setupComponent(a),b=this.$node.find("#tweet1"),c=this.$node.find(".tweets"),$promotedTweet=this.$node.find("#tweet3")}),describe("#createCard",function(){it("adds the card in an iframe",function(){this.component.createCard(b);var a=b.find("iframe");expect(b).toContain("iframe"),expect(a).toHaveAttr("width","100%"),expect(a.attr("src")).toContain("/i/cards/tfw/v1/4")}),it("gets revenueData for promotedTweet",function(){var a=this.component.createCard($promotedTweet);expect(a.impressionId).toEqual("some_id"),expect(a.disclosureType).toEqual("some_type")}),it("sets revenueData fields to undefined for non-promoted tweets",function(){var a=this.component.createCard(b);expect(a.impressionId).not.toBeDefined(),expect(a.disclosureType).not.toBeDefined()})}),describe("#destroyCard",function(){it("removes the card iframe",function(){this.component.createCard(b),this.component.destroyCard(b),expect(b).not.toContain("iframe")})}),describe("#destroyAllCards",function(){it("removes all card iframes",function(){c.each(function(a){this.component.createCard(a)}),this.component.destroyAllCards(),expect(this.$node).not.toContain("iframe")})})})
});
define("test/app/ui/list_follow_card_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/list_follow_card",function(){beforeEach(function(){var a='<div class="subscribed js-unfollow-list-action" data-list-id="13">\n          <div class="js-edit-list-action"></div>\n          <div class="js-delete-list-action"></div>\n          <div class="subscribe-btn"></div>\n        </div>\n        <div class="not-subscribed js-follow-list-action" data-list-id="13">\n          <div class="js-edit-list-action"></div>\n          <div class="js-delete-list-action"></div>\n          <div class="subscribe-btn"></div>\n        </div>\n    ';setupComponent(a,{win:{location:""},screenName:"chatty",list_id:13})}),describe("event dataDidUpdateList",function(){it("redirects to the right list url",function(){this.component.trigger("dataDidUpdateList",{slug:"Test"}),expect(this.component.attr.win.location).toBe("/chatty/lists/Test")})}),describe("event dataGotFollowCard",function(){it("updates the UI with follow card html",function(){this.component.trigger("dataGotFollowCard",{follow_card_html:"Test"}),expect(this.component.$node.html()).toBe("Test")})}),describe("event dataDidSubscribeToList",function(){it("updates the UI when subscribed",function(){spyOnEvent(document,"uiRefreshFollowCard"),this.component.trigger("dataDidSubscribeToList",{sourceEventData:{action:"subscribe"}}),expect(this.component.select("subscribeSelector")).toHaveClass("subscribed js-unfollow-list-action"),expect("uiRefreshFollowCard").toHaveBeenTriggeredOnAndWith(document,{sourceEventData:{action:"subscribe"}})}),it("updates the UI when unsubscribed",function(){spyOnEvent(document,"uiRefreshFollowCard"),this.component.trigger("dataDidSubscribeToList",{sourceEventData:{action:"unsubscribe"}}),expect(this.component.select("subscribeSelector")).toHaveClass("not-subscribed js-follow-list-action"),expect("uiRefreshFollowCard").toHaveBeenTriggeredOnAndWith(document,{sourceEventData:{action:"unsubscribe"}})})}),describe("event dataDidDeleteList",function(){it("redirects to the lists url",function(){this.component.trigger("dataDidDeleteList"),expect(this.component.attr.win.location).toBe("/chatty/lists")})}),describe("event uiDeleteListConfirm",function(){it("triggers uiDeleteList on uiDeleteListConfirm",function(){spyOnEvent(document,"uiDeleteList"),this.component.trigger("uiDeleteListConfirm"),expect("uiDeleteList").toHaveBeenTriggeredOnAndWith(document,{list_id:13})})}),describe("method triggerEditListDialog",function(){it("triggers a update list dialog",function(){spyOnEvent(document,"uiOpenUpdateListDialog"),this.component.triggerEditListDialog(),expect("uiOpenUpdateListDialog").toHaveBeenTriggeredOnAndWith(document,{})})}),describe("method triggerDeleteListDialog",function(){it("triggers uiOpenConfirmDialog",function(){spyOnEvent(document,"uiOpenConfirmDialog"),this.component.triggerDeleteListDialog(),expect("uiOpenConfirmDialog").toHaveBeenTriggeredOnAndWith(document,{action:"DeleteList",titleText:"Are you sure you want to delete this List?",cancelText:"No",submitText:"Yes"})})}),describe("method subscribeToList",function(){it("triggers uiSubscribeToList when subscribing",function(){spyOnEvent(document,"uiSubscribeToList"),this.component.subscribeToList(null,{el:this.component.$node.get(2)}),expect("uiSubscribeToList").toHaveBeenTriggeredOnAndWith(document,{action:"subscribe",list_id:"13"})}),it("triggers uiSubscribeToList when unsubscribing",function(){spyOnEvent(document,"uiSubscribeToList"),this.component.subscribeToList(null,{el:this.component.$node.get(0)}),expect("uiSubscribeToList").toHaveBeenTriggeredOnAndWith(document,{action:"unsubscribe",list_id:"13"})})})})
});
define("test/app/ui/with_item_actions_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_item_actions",function(){var a='<li tabindex="-1">\n      <div class="view-more-container">\n        <a href="#somelocation" class="js-nav view-more-link">View more in conversation</a>\n      </div>\n    </li>\n  ',b=function(a,b){b=b||{};var c=[],g=[],h,i,j,o;c.push("tweet"),g.push(d("tweet-id",a)),b.impressionId&&(c.push("promoted-tweet"),g.push(d("impression-id",b.impressionId))),b.hasUrlAndCard&&(g.push(d("has-cards",!0)),c.push("has-cards"));var p=['<div class="'+c.join(" ")+'" '+g.join(" ")+" >",b.userHtml||"",'<p class="js-tweet-text">',"I will win",'<s>@</s><a class="twitter-atreply pretty-link" data-screen-name="chatty" href="/chatty" rel="nofollow"><b>chatty</b></a>',"</p>","</div>"].join("");return b.hasUrlAndCard&&(h=n,i=m,b.hasPromotionCard&&(h=l,i=k),j=['<a href="'+h+'" rel="nofollow" dir="ltr" data-expanded-url="'+i+'" class="twitter-timeline-link" ','target="_blank" title="'+i+'"><span class="invisible">https://</span>','<span class="js-display-url">'+i+'</span><span class="invisible">','</span><span class="tco-ellipsis"><span class="invisible">&nbsp;</span></span></a>'].join(""),o=['<div class="js-tweet-details-fixer tweet-details-fixer"><div class="cards-media-container ">','<div data-card-url="'+h+'" data-card-type="promotions" class="cards-base cards-promotion"','data-element-context="platform_promotion_card"><div class="media">','<iframe src="https://'+i+'/thankyou?embed=true" scrolling="no" width="100%" height="0">','</iframe></div></div></div><div class="js-tweet-media-container "></div>','<div class="js-machine-translated-tweet-container"></div>','<div class="js-tweet-stats-container tweet-stats-container already-open"></div>','<div class="client-and-actions"><span class="metadata"><span title="7:30 AM - 12 Jun 13">7:30 AM - 12 Jun 13</span>','&middot; <a class="permalink-link js-permalink js-nav" href="/'+f+"/status/"+e+'" >Details</a>',"</span></div></div>"].join("").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/["']/g,"&quot;"),b.hasPromotionCard||(o=o.replace(/cards-promotion/g,"").replace(/promotion/g,"")),p=p.replace("I will win","I want this "+j+" deal!"),p=p.replace("data-has-cards=",'data-expanded-footer="'+o+'" data-has-cards='),p='<div class="stream-item">'+p+"</div>"),p},c=function(a,b){b=b||{};var c=[],e=[];c.push("js-user-profile-link"),e.push(d("user-id",a)),b.impressionId&&(c.push("promoted-tweet"),e.push(d("impression-id",b.impressionId))),b.feedbackToken&&e.push(d("feedback-token",b.feedbackToken));var f=['<a class="'+c.join(" ")+'" '+e.join(" ")+" >",'<img class="js-action-profile-avatar">','<strong class="fullname js-action-profile-name show-popup-with-id">I. M. Chatty</strong>',"</img>","</a>"].join("");return f},d=function(a,b){return b?"data-"+a+"='"+b+"'":""},e="3",f="6",g="9",h="1000",i=33,j="tweet",k="cards.twitter.com/cards/test/foo",l="https://t.co/TEST",m="example.com/test/foo",n="https://t.co/SOMEURL",o={promoted_user:{html:c(f,{impressionId:g,feedbackToken:h}),target:".js-user-profile-link",expectedEventData:{userId:f,containerUserId:f,targetUserId:f,profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1,tweetHasCard:!1,interactionInsideCard:!1,isPromotedBadgeClick:!1,feedbackToken:h,impressionId:g,itemType:j}},non_promoted_user:{html:c(f,{feedbackToken:h}),target:".js-user-profile-link",expectedEventData:{userId:f,containerUserId:f,targetUserId:f,profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1,tweetHasCard:!1,interactionInsideCard:!1,isPromotedBadgeClick:!1,feedbackToken:h,itemType:j}},user_avatar:{html:c(f,{feedbackToken:h}),target:".js-action-profile-avatar",expectedEventData:{userId:f,containerUserId:f,targetUserId:f,profileClickTarget:"avatar",isReplyTo:!1,isMentionClick:!1,interactionInsideCard:!1,tweetHasCard:!1,isPromotedBadgeClick:!1,feedbackToken:h,itemType:j}},at_reply_promoted_user:{html:b(e,{impressionId:g}),target:".twitter-atreply",expectedEventData:{screenName:"chatty",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!0,tweetHasCard:!1,interactionInsideCard:!1,isPromotedBadgeClick:!1,tweetId:e,impressionId:g,itemType:j}},at_reply_non_promoted_user:{html:b(e),target:".twitter-atreply",expectedEventData:{screenName:"chatty",profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!0,tweetHasCard:!1,interactionInsideCard:!1,isPromotedBadgeClick:!1,tweetId:e,itemType:j}},stream_user_avatar:{html:b(e,{userHtml:c(f),impressionId:g}),target:".js-action-profile-avatar",expectedEventData:{userId:f,containerUserId:f,targetUserId:f,profileClickTarget:"avatar",isReplyTo:!1,isMentionClick:!1,tweetHasCard:!1,interactionInsideCard:!1,isPromotedBadgeClick:!1,tweetId:e,impressionId:g,itemType:j}},stream_user_name:{html:b(e,{userHtml:c(f),impressionId:g}),target:".js-user-profile-link",expectedEventData:{userId:f,containerUserId:f,targetUserId:f,profileClickTarget:"screen_name",isReplyTo:!1,isMentionClick:!1,tweetHasCard:!1,interactionInsideCard:!1,isPromotedBadgeClick:!1,tweetId:e,impressionId:g,itemType:j}}},p={stream_url_link_for_lead_gen_card:{html:b(e,{hasPromotionCard:!0,hasUrlAndCard:!0}),target:".twitter-timeline-link",expectedEventData:{scribeContext:{},scribeData:{},tweetId:e,isReplyTo:!1,position:i,isMentionClick:!1,isPromotedBadgeClick:!1,itemType:j,profileClickTarget:"screen_name",url:k,tcoUrl:l,text:"https://"+k+" ",tweetHasCard:!0,interactionInsideCard:!1,cardType:"promotions",cardUrl:l,publisherUserId:null,creatorUserId:null}},stream_url_link:{html:b(e,{hasUrlAndCard:!0}),target:".twitter-timeline-link",expectedEventData:{scribeContext:{},scribeData:{},tweetId:e,isReplyTo:!1,position:i,isMentionClick:!1,isPromotedBadgeClick:!1,itemType:j,profileClickTarget:"screen_name",url:m,tcoUrl:n,text:"https://"+m+" ",tweetHasCard:!1,interactionInsideCard:!1}}};beforeEach(function(){var a="";Object.keys(o).forEach(function(b){a+='<div id="'+b+'">'+o[b].html+"</div>"}),Object.keys(p).forEach(function(b){a+='<div id="'+b+'">'+p[b].html+"</div>"}),setupComponent(a),this.component.getItemPosition=function(a){return i},this.component.attr.itemType=j}),describe("#itemSelected",function(){it("triggers the event with the custom data",function(){var a={tweetHasCard:!0,cardType:"summary"},b={foo:"bar"},c={target:"foo",stopPropagation:function(){}};spyOn(this.component,"getCardDataFromTweet").andReturn(a),spyOn(this.component,"interactionData").andReturn(b),spyOn(this.component,"trigger"),this.component.itemSelected(c,{organicExpansion:!0}),expect(this.component.trigger).toHaveBeenCalledWith("uiItemSelected",{foo:"bar",tweetHasCard:!0,cardType:"summary"})}),it("does not trigger the event with organicExpansion false",function(){var a={tweetHasCard:!0,cardType:"summary"},b={foo:"bar"},c={target:"foo",stopPropagation:function(){}};spyOn(this.component,"getCardDataFromTweet").andReturn(a),spyOn(this.component,"interactionData").andReturn(b),spyOn(this.component,"trigger"),this.component.itemSelected(c,{organicExpansion:!1}),expect(this.component.trigger).not.toHaveBeenCalled()})}),describe("#itemDeselected",function(){it("triggers the event with the custom data",function(){var a={tweetHasCard:!0,cardType:"summary"},b={foo:"bar"},c={target:"foo",stopPropagation:function(){}};spyOn(this.component,"getCardDataFromTweet").andReturn(a),spyOn(this.component,"interactionData").andReturn(b),spyOn(this.component,"trigger"),this.component.itemDeselected(c,{}),expect(this.component.trigger).toHaveBeenCalledWith("uiItemDeselected",{foo:"bar",tweetHasCard:!0,cardType:"summary"})})}),describe("clicking a user link",function(){var a=function(a,b,c){it("triggers uiShowProfilePopup with the correct data when clicking a "+a.replace(/_/g," ")+" link",function(){spyOnEvent(this.$node,"uiShowProfilePopup"),$("#"+a).find(b).click(),expect("uiShowProfilePopup").toHaveBeenTriggeredOnAndWith(this.$node,$.extend(c,{position:i}))}),describe("with profile hovers enabled",function(){beforeEach(function(){var a="";Object.keys(o).forEach(function(b){a+='<div id="'+b+'">'+o[b].html+"</div>"}),Object.keys(p).forEach(function(b){a+='<div id="'+b+'">'+p[b].html+"</div>"}),setupComponent(a,{profileHoversEnabled:!0}),this.component.getItemPosition=function(a){return i},this.component.attr.itemType=j}),it("triggers uiShowProfileHover with the correct data when mousing over a "+a.replace(/_/g," ")+" link",function(){this.component.attr.profileHoversEnabled=!0,spyOnEvent(this.$node,"uiShowProfileHover");var d=jQuery.Event("mouseover");$("#"+a).find(b).trigger(d),expect("uiShowProfileHover").toHaveBeenTriggeredOnAndWith(this.$node,$.extend(c,{position:i})),this.component.attr.profileHoversEnabled=!1}),it("triggers uiShowProfileNewWindow with the correct data when clicking a "+a.replace(/_/g," ")+" link",function(){this.component.attr.profileHoversEnabled=!0,spyOnEvent(this.$node,"uiShowProfileNewWindow");var d=jQuery.Event("click");$("#"+a).find(b).trigger(d),expect("uiShowProfileNewWindow").toHaveBeenTriggeredOnAndWith(this.$node,$.extend(c,{position:i})),this.component.attr.profileHoversEnabled=!1})}),it("triggers uiShowProfileNewWindow with the correct data when cmd+clicking a "+a.replace(/_/g," ")+" link",function(){spyOnEvent(this.$node,"uiShowProfileNewWindow");var d=jQuery.Event("click");d.ctrlKey=!0,$("#"+a).find(b).trigger(d),expect("uiShowProfileNewWindow").toHaveBeenTriggeredOnAndWith(this.$node,$.extend(c,{position:i}))}),it("triggers uiShowProfileNewWindow with the correct data when middle-clicking a "+a.replace(/_/g," ")+" link",function(){spyOnEvent(this.$node,"uiShowProfileNewWindow");var d=jQuery.Event("click");d.which=2,$("#"+a).find(b).trigger(d),expect("uiShowProfileNewWindow").toHaveBeenTriggeredOnAndWith(this.$node,$.extend(c,{position:i}))})};Object.keys(o).forEach(function(b){var c=o[b];a.call(this,b,c.target,c.expectedEventData)},this)}),describe("clicking a tweet url link",function(){function g(g){a=p[g],b=a.target,c=a.expectedEventData,d=$("#"+g),e=d.find(".stream-item"),f=d.find(b)}var a,b,c,d,e,f;it("triggers uiPromotionCardUrlClick event if tweet contains lead gen card",function(){g("stream_url_link_for_lead_gen_card"),spyOnEvent(e,"uiPromotionCardUrlClick"),f.click(),expect("uiPromotionCardUrlClick").toHaveBeenTriggeredOn(e)}),it("does not trigger uiPromotionCardUrlClick event if tweet does not contain lead gen card",function(){g("stream_url_link"),spyOnEvent(e,"uiPromotionCardUrlClick"),f.click(),expect("uiItemLinkClick").not.toHaveBeenTriggeredOn(e)})}),describe('Pressing the Enter key while focused on the parent item of a "View more in conversation" link',function(){beforeEach(function(){setupComponent(a),spyOnEvent(this.component.$node.find(".view-more-link"),"uiNavigate")}),it("triggers the uiNavigate event to the specified href",function(){this.component.node.focus(),this.component.trigger(this.component.node,"uiShortcutEnter"),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.component.$node.find(".view-more-link"),{href:"#somelocation"})})}),describe("clicking a user link when toggling the disable_profile_popup decider",function(){afterEach(function(){using("app/data/user_info",function(a){a.reset()})});var a=function(a,b,c){var d=[{disablePopup:!1,event:"uiShowProfilePopup"},{disablePopup:!0,event:"uiShowProfileNewWindow"}],e=function(d){return function(){spyOnEvent(this.$node,d.event),using("app/data/user_info",function(a){a.set({deciders:{disable_profile_popup:d.disablePopup}})}),$("#"+a).find(b).click(),expect(d.event).toHaveBeenTriggeredOnAndWith(this.$node,$.extend(c,{position:i}))}};d.forEach(function(b){it("triggers "+b.event+" when disable_profile_popup is "+b.disablePopup+" and clicking a "+a.replace(/_/g," ")+" link",e(b))})};Object.keys(o).forEach(function(b){var c=o[b];a.call(this,b,c.target,c.expectedEventData)},this)})})
});
define("test/app/ui/with_timestamp_updating_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_timestamp_updating",function(){var a=1328745410;beforeEach(function(){var b='<div><div id="timestamp" class="js-relative-timestamp" data-time="'+a+'"></div>';setupComponent(b)}),describe("triggering event uiWantsToRefreshTimestamps or dataPageRefresh",function(){var b=[[0,"now",!0],[1,"now",!0],[2,"now",!0],[3,"3s",!0],[25,"25s",!0],[59,"59s",!0],[60,"1m",!0],[1680,"28m",!0],[3540,"59m",!0],[3600,"1h",!0],[46800,"13h",!0],[82800,"23h",!0],[86400,"8 Feb",!1],[1296e4,"8 Feb",!1],[31449600,"8 Feb",!1],[62899200,"8 Feb 12",!1]],c=function(c,d){var e=b[c][0],f=b[c][1],g=b[c][2];it("sets the timestamp label correctly for "+e+" seconds ago",function(){spyOn(this.component,"currentTimeSecs").andReturn(a+e),$(document).trigger(d),expect($("#timestamp").html()).toEqual(f),g?expect($("#timestamp")).toHaveClass("js-relative-timestamp"):expect($("#timestamp")).not.toHaveClass("js-relative-timestamp")})};for(var d=0;d<b.length;d++)c(d,"uiWantsToRefreshTimestamps");for(var d=0;d<b.length;d++)c(d,"uiPageChanged")})})
});
define("test/app/ui/navigation_links_spec",["module","require","exports"],function(module, require, exports) {
describeComponentWithDataComponents("app/ui/navigation_links",["app/data/navigation_scribe"],function(){function a(){return'<div class="component"><ul class="js-nav-links"><li><a href="/mrtall" data-nav="profile">Tweets<i class="chev-right"></i></a></li><li><a href="/mrtall/following" data-nav="following">Following<i class="chev-right"></i></a></li><li><a href="/mrtall/followers" data-nav="followers">Followers<i class="chev-right"></i></a></li><li><a href="/mrtall/favorites" data-nav="favorites">Favorites<i class="chev-right"></i></a></li><li><a href="/mrtall/lists" data-nav="all_lists">Lists<i class="chev-right"></i></a></li><li><a href="/mrtall/lists" class="whatever-dashboard-nav">Whatever<i class="chev-right"></i></a></li></ul></div>'}beforeEach(function(){jasmine.Clock.useMock()}),describe("dashboard navigation links",function(){beforeEach(function(){setupComponent(a())}),it("scribes when dashboard navigation is clicked",function(){this.$node.find('ul a[data-nav="profile"]').trigger("click"),expect(this.navigationScribe).toScribe({element:"profile",action:"navigate"},{url:"/mrtall"}),this.$node.find('ul a[data-nav="following"]').trigger("click"),expect(this.navigationScribe).toScribe({element:"following",action:"navigate"},{url:"/mrtall/following"}),this.$node.find('ul a[data-nav="followers"]').trigger("click"),expect(this.navigationScribe).toScribe({element:"followers",action:"navigate"},{url:"/mrtall/followers"})}),it("doesn't scribe when a link is missing the data-nav attribute",function(){this.$node.find("ul a.whatever-dashboard-nav").trigger("click"),expect(this.navigationScribe).not.toScribe({action:"navigate"})})})})
});
define("test/app/ui/with_hover_card_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_hover_card",function(){var a='<div>\n      <div>\n        <a href="#somelocation" class="js-nav">Link</a>\n      </div>\n    </div>\n  ',b="test",c="something_else",d="<div class='class'></div>";beforeEach(function(){jasmine.Clock.useMock(),setupComponent(a,{containerForHoverSelector:"div"})}),describe("#prepareHover",function(){it("starts a timer and when done updates okToOpen",function(){this.component.prepareHover(b),jasmine.Clock.tick(this.component.attr.showDelay-1),expect(this.component.okToOpen).toBeFalsy(),jasmine.Clock.tick(2),expect(this.component.okToOpen).toBeTruthy()}),it("calls a queued open function if set at timer expiration",function(){var a=jasmine.createSpy();this.component.prepareHover(b),this.component.queuedOpen=a,jasmine.Clock.tick(this.component.attr.showDelay+1),expect(a).toHaveBeenCalled()})}),describe("#showHTML",function(){beforeEach(function(){this.component.currentKey=c}),it("creates and shows the element",function(){this.component.okToOpen=!0,spyOn(this.component,"adjacent").andReturn({top:1,left:2}),this.component.showHTML(b,d,this.$node.find("a"));var a=this.component.select("hoverContentSelector");expect(a.length).toBe(1)}),it("calls forceHide, queuedOpen and sets the new current key",function(){this.component.okToOpen=!0,this.component.queuedOpen=!0,spyOn(this.component,"forceHide"),this.component.showHTML(b,d,this.$node.find("a")),expect(this.component.forceHide).toHaveBeenCalled(),expect(this.component.currentKey).toBe(b),expect(this.component.queuedOpen).toBe(null)}),it("clears hide timeout if set and open key is the same",function(){var a=jasmine.createSpy();this.component.timeout=setTimeout(a,1),expect(a).not.toHaveBeenCalled(),this.component.showHTML(c,d,this.$node.find("a")),jasmine.Clock.tick(2),expect(a).not.toHaveBeenCalled()}),it("does not touch timeout if keys mismatch",function(){var a=jasmine.createSpy();this.component.timeout=setTimeout(a,1),expect(a).not.toHaveBeenCalled(),this.component.showHTML(b,d,this.$node.find("a")),jasmine.Clock.tick(2),expect(a).toHaveBeenCalled()}),it("queues itself to open if the open timer has not finished yet",function(){this.component.okToOpen=!1,spyOn(this.component,"forceHide"),this.component.showHTML(b,d,"test",{a:"b"}),expect(this.component.forceHide).not.toHaveBeenCalled(),spyOn(this.component,"showHTML"),this.component.queuedOpen(),expect(this.component.showHTML).toHaveBeenCalledWith(b,d,"test",{a:"b",id:"test"})})}),describe("#hide",function(){it("resets okToOpen, queuedOpen func, and the openTimer",function(){this.component.okToOpen=!0,this.component.queuedOpen=!0,spyOn(this.component,"forceHide");var a=jasmine.createSpy();this.component.openTimer=setTimeout(a,1),expect(a).not.toHaveBeenCalled(),this.component.hide(),jasmine.Clock.tick(2),expect(this.component.okToOpen).toBe(!1),expect(this.component.queuedOpen).toBe(null),expect(a).not.toHaveBeenCalled(),expect(this.component.forceHide).not.toHaveBeenCalled()}),it("calls forceHide after a time period",function(){spyOn(this.component,"forceHide"),this.component.hide(),jasmine.Clock.tick(this.component.attr.hideDelay-1),expect(this.component.forceHide).not.toHaveBeenCalled(),jasmine.Clock.tick(2),expect(this.component.forceHide).toHaveBeenCalled()})}),describe("#forceHide",function(){it("is called on esc",function(){this.component.currentKey=b,this.component.trigger(document,"uiShortcutEsc"),expect(this.component.currentKey).toBe(null)}),it("is called on page change",function(){this.component.currentKey=b,this.component.trigger(document,"uiBeforePageChanged"),expect(this.component.currentKey).toBe(null)}),it("resets currentKey and destroys the hover",function(){var a=jasmine.createSpy();this.component.$hoverContent={remove:a},this.component.currentKey=b,this.component.forceHide(),expect(a).toHaveBeenCalled(),expect(this.component.currentKey).toBe(null)}),it("clears the close and open timeouts immediately",function(){var a=jasmine.createSpy(),b=jasmine.createSpy();this.component.timeout=setTimeout(a,1),this.component.openTimer=setTimeout(b,1),expect(a).not.toHaveBeenCalled(),expect(b).not.toHaveBeenCalled(),this.component.forceHide(),jasmine.Clock.tick(2),expect(a).not.toHaveBeenCalled(),expect(b).not.toHaveBeenCalled()})})})
});
define("test/app/ui/search_actions_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/search_actions",function(){var a='<div>\n      <a role="button" class="with-icn js-toggle-saved-search-link unfavorite js-unsaved-search" href="#" data-id="5" data-query="rose tyler" title="Save search">\n        <span class="icon sm-fav"></span>\n      </a>\n    </div>\n  ',b='<div>\n      <a role="button" class="js-toggle-saved-search-link js-saved-search favorite" href="#" data-query="rose tyler" title="Remove saved search">\n        <span class="icon sm-fav"></span>\n      </a>\n    </div>\n  ';describe("event uiSavedSearchRemoveConfirm",function(){beforeEach(function(){setupComponent(b)}),it("should not fire next event if savedSearchId not defined",function(){spyOnEvent(this.$node,"uiRemoveSavedSearch"),this.component.trigger("uiSavedSearchRemoveConfirm"),expect("uiRemoveSavedSearch").not.toHaveBeenTriggeredOn(this.$node)}),it("if savedSearchId defined, fire next event",function(){spyOnEvent(this.$node,"uiRemoveSavedSearch"),this.component.savedSearchId="1234",this.component.trigger("uiSavedSearchRemoveConfirm"),expect("uiRemoveSavedSearch").toHaveBeenTriggeredOn(this.$node)})}),describe("event dataAddedSavedSearch",function(){beforeEach(function(){setupComponent(a)}),it("should set the proper class for the favorite icon",function(){var a;this.component.trigger("dataAddedSavedSearch",{id:"1234"}),a=this.$node.find(".js-toggle-saved-search-link"),expect(a).toHaveClass("unfavorite"),expect(a).not.toHaveClass("favorite")})}),describe("event dataRemovedSavedSearch",function(){beforeEach(function(){setupComponent(b)}),it("should set the proper class for the favorite icon",function(){var a;this.component.trigger("dataRemovedSavedSearch",{id:"1234"}),a=this.$node.find(".js-toggle-saved-search-link"),expect(a).not.toHaveClass("unfavorite"),expect(a).toHaveClass("favorite")})}),describe("event click unsavedSearchSelector",function(){beforeEach(function(){setupComponent(a)}),it("will trigger saved search",function(){spyOnEvent(this.$node,"uiAddSavedSearch"),this.$node.find(".js-unsaved-search").trigger("click"),expect("uiAddSavedSearch").toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/with_tweetbox_initialization_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_tweetbox_initialization",function(){var a='<div class="profile-tweet-box">\n    <form class="tweet-form" method="post" target="tweet-post-iframe" action="/i/tweet/create_with_media.iframe" enctype="multipart/form-data"></form>\n  </div>\n\n  ';describe("#initTweetbox",function(){it("triggers a uiInitTweetBox event",function(){spyOnEvent(document,"uiInitTweetbox"),setupComponent(a),this.component.initTweetbox({condensedText:"Tweet to Chatty Guy",defaultText:"@chatty "}),expect("uiInitTweetbox").toHaveBeenTriggeredOnAndWith(document,{condensable:!0,condensedText:"Tweet to Chatty Guy",defaultText:"@chatty "})})})})
});
define("test/app/ui/with_dropdown_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/with_dropdown",function(){var a='<div id="dropdown" class="dropdown">\n      <a href="#" class="js-dropdown-toggle dropdown-toggle"></a>\n      <div class="dropdown-menu" tabindex="-1">\n        <button type="button" id="inside-node">Click Me</button>\n      </div>\n    </div>\n  ',b='<div id="dropdown2">\n      <div id="first-dropdown" class="dropdown">\n        <button type="button" class="js-dropdown-toggle dropdown-toggle"></button>\n        <div class="dropdown-menu"></div>\n      </div>\n      <div id="second-dropdown" class="dropdown">\n        <button type="button" class="js-dropdown-toggle dropdown-toggle"></button>\n        <div class="dropdown-menu"></div>\n      </div>\n    </div>\n  ';describe("When the page is loaded",function(){beforeEach(function(){setupComponent(a),this.component.trigger(document,"uiSwiftLoaded")}),describe("and the toggler is an anchor",function(){it('sets the "role" attribute on the toggler to "button"',function(){expect(this.component.select("togglerSelector").attr("role")).toBe("button")})}),it('sets the "aria-haspopup" attribute on the toggler to "true"',function(){expect(this.component.select("togglerSelector").attr("aria-haspopup")).toBe("true")})}),describe("When the toggle is clicked",function(){beforeEach(function(){setupComponent(a)}),describe("and the toggler is an anchor",function(){it("prevents the browser from navigating to the specified URL",function(){var a=window.location.href;this.component.select("togglerSelector")[0].click(),expect(a).toBe(window.location.href)})}),it("prevents the click event from propagating",function(){var a=jasmine.createSpy();$("#fixture_parent").on("click",a),this.component.select("togglerSelector").trigger("click"),expect(a).not.toHaveBeenCalled(),$("#fixture_parent").off("click",a)}),describe("and the dropdown is closed",function(){beforeEach(function(){$("#fixture_parent").append('<div id="doc"></div>'),spyOnEvent($("#dropdown"),"uiDropdownOpened"),spyOnEvent(document,"uiCloseDropdowns"),this.component.select("togglerSelector").trigger("click")}),it("creates a reference to the dropdown associated with the trigger that was clicked",function(){var a=this.component.select("togglerSelector").closest(this.component.attr.dropDownSelector);expect(this.component.$dropdown).toBe(a)}),it("hides all other open dropdowns",function(){expect("uiCloseDropdowns").toHaveBeenTriggeredOn(document)}),it("adds a tab stop before the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.firstTabStopSelector)).toExist()}),it("adds a tab stop after the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.lastTabStopSelector)).toExist()}),it("adds the open class",function(){expect($("#dropdown")).toHaveClass(this.component.attr.openClass)}),it('triggers the "uiDropdownOpened" event',function(){expect("uiDropdownOpened").toHaveBeenTriggeredOn($("#dropdown"))})}),describe("and the dropdown is open",function(){beforeEach(function(){$("#fixture_parent").append('<div id="doc"></div>'),this.component.select("togglerSelector").trigger("click"),spyOnEvent($("#dropdown"),"uiDropdownClosed"),spyOnEvent($("#dropdown"),"uiDropdownCloseRequested")}),it('triggers "uiDropdownCloseRequested" event',function(){this.component.select("togglerSelector").trigger("click"),expect("uiDropdownCloseRequested").toHaveBeenTriggeredOn($("#dropdown"))}),describe('and the "uiDropdownCloseRequested" event is not prevented',function(){beforeEach(function(){this.component.select("togglerSelector").trigger("click")}),it("removes the tab stop before the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.firstTabStopSelector)).not.toExist()}),it("removes the tab stop after the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.lastTabStopSelector)).not.toExist()}),it("removes the open class",function(){expect($("#dropdown")).not.toHaveClass(this.component.attr.openClass)}),it('triggers the "uiDropdownClosed" event',function(){expect("uiDropdownClosed").toHaveBeenTriggeredOn($("#dropdown"))}),it("removes the reference to the current dropdown",function(){expect(this.component.$dropdown).toBe(null)})}),describe('and the "uiPageChanged" event is triggered',function(){beforeEach(function(){this.component.trigger(document,"uiPageChanged")}),it('does not trigger the "uiDropdownCloseRequested" event',function(){this.component.select("togglerSelector").trigger("click"),expect("uiDropdownCloseRequested").not.toHaveBeenTriggeredOn($("#dropdown"))}),it("removes the tab stop before the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.firstTabStopSelector)).not.toExist()}),it("removes the tab stop after the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.lastTabStopSelector)).not.toExist()}),it("removes the open class",function(){expect($("#dropdown")).not.toHaveClass(this.component.attr.openClass)}),it('triggers the "uiDropdownClosed" event',function(){expect("uiDropdownClosed").toHaveBeenTriggeredOn($("#dropdown"))}),it("removes the reference to the current dropdown",function(){expect(this.component.$dropdown).toBe(null)})}),describe('and the "uiNavigate" event is triggered',function(){beforeEach(function(){this.component.trigger(document,"uiNavigate")}),it('does not trigger the "uiDropdownCloseRequested" event',function(){this.component.select("togglerSelector").trigger("click"),expect("uiDropdownCloseRequested").not.toHaveBeenTriggeredOn($("#dropdown"))}),it("removes the tab stop before the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.firstTabStopSelector)).not.toExist()}),it("removes the tab stop after the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.lastTabStopSelector)).not.toExist()}),it("removes the open class",function(){expect($("#dropdown")).not.toHaveClass(this.component.attr.openClass)}),it('triggers the "uiDropdownClosed" event',function(){expect("uiDropdownClosed").toHaveBeenTriggeredOn($("#dropdown"))}),it("removes the reference to the current dropdown",function(){expect(this.component.$dropdown).toBe(null)})}),describe('and the "uiForceDropdownClosed" event is triggered',function(){beforeEach(function(){this.component.trigger(document,"uiForceDropdownClosed")}),it('does not trigger the "uiDropdownCloseRequested" event',function(){this.component.select("togglerSelector").trigger("click"),expect("uiDropdownCloseRequested").not.toHaveBeenTriggeredOn($("#dropdown"))}),it("removes the tab stop before the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.firstTabStopSelector)).not.toExist()}),it("removes the tab stop after the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.lastTabStopSelector)).not.toExist()}),it("removes the open class",function(){expect($("#dropdown")).not.toHaveClass(this.component.attr.openClass)}),it('triggers the "uiDropdownClosed" event',function(){expect("uiDropdownClosed").toHaveBeenTriggeredOn($("#dropdown"))}),it("removes the reference to the current dropdown",function(){expect(this.component.$dropdown).toBe(null)})}),describe('and the "uiDropdownCloseRequested" event is prevented',function(){beforeEach(function(){this.component.on("uiDropdownCloseRequested",function(a){a.preventDefault()}),this.component.select("togglerSelector").trigger("click")}),it("does not remove the tab stop before the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.firstTabStopSelector)).toExist()}),it("does not remove the tab stop after the dropdown menu",function(){expect($("#dropdown").find(this.component.attr.lastTabStopSelector)).toExist()}),it("does not remove the open class",function(){expect($("#dropdown")).toHaveClass(this.component.attr.openClass)}),it('does not trigger the "uiDropdownClosed" event',function(){expect("uiDropdownClosed").not.toHaveBeenTriggeredOn($("#dropdown"))}),it("does not remove the reference to the current dropdown",function(){expect(this.component.$dropdown).toBe($("#dropdown"))})})})}),describe("When the dropdown is open",function(){beforeEach(function(){setupComponent(a),this.component.select("togglerSelector").trigger("click"),spyOnEvent($("#dropdown"),"uiDropdownClosed"),spyOnEvent($("#dropdown"),"uiDropdownCloseRequested")}),describe("and a node outside the dropdown is clicked",function(){beforeEach(function(){$("#fixture_parent").append('<button type="button" id="outside-node">Outside</div>'),$("#outside-node").trigger("click")}),it("removes the open class",function(){expect($("#dropdown")).not.toHaveClass(this.component.attr.openClass)}),it('triggers "uiDropdownCloseRequested" event',function(){expect("uiDropdownCloseRequested").toHaveBeenTriggeredOn($("#dropdown"))}),it('triggers the "uiDropdownClosed" event',function(){expect("uiDropdownClosed").toHaveBeenTriggeredOn($("#dropdown"))})}),describe("and a node inside the dropdown is clicked",function(){beforeEach(function(){$("#inside-node").trigger("click")}),it("does not remove the open class",function(){expect($("#dropdown")).toHaveClass(this.component.attr.openClass)}),it('does not trigger "uiDropdownCloseRequested" event',function(){expect("uiDropdownCloseRequested").not.toHaveBeenTriggeredOn($("#dropdown"))}),it('does not trigger the "uiDropdownClosed" event',function(){expect("uiDropdownClosed").not.toHaveBeenTriggeredOn($("#dropdown"))})}),describe("and a node specified not to close the dropdown is clicked",function(){beforeEach(function(){$("#fixture_parent").append('<button type="button" id="outside-node">Outside</div>'),$("#outside-node").addClass("js-dropdown-prevent-close"),$("#outside-node").trigger("click")}),it("does not remove the open class",function(){expect($("#dropdown")).toHaveClass(this.component.attr.openClass)}),it('does not trigger "uiDropdownCloseRequested" event',function(){expect("uiDropdownCloseRequested").not.toHaveBeenTriggeredOn($("#dropdown"))}),it('does not trigger the "uiDropdownClosed" event',function(){expect("uiDropdownClosed").not.toHaveBeenTriggeredOn($("#dropdown"))})})}),describe("When the user presses the Esc key when the dropdown is open",function(){it("closes the dropdown and returns focus the previously focused element",function(){setupComponent(a),this.component.select("togglerSelector")[0].focus(),expect(this.component.select("togglerSelector")).toBeFocused(),this.component.select("togglerSelector").trigger("click"),$("#dropdown").find(this.component.attr.dropDownMenuSelector)[0].focus(),expect($("#dropdown")).toHaveClass("open"),expect($("#dropdown").find(this.component.attr.dropDownMenuSelector)).toBeFocused(),this.component.trigger(document,"uiShortcutEsc"),expect($("#dropdown")).not.toHaveClass("open"),expect(this.component.select("togglerSelector")).toBeFocused()})}),describe("When the component is used to manage multiple dropdowns within the same node",function(){beforeEach(function(){setupComponent(b)}),describe("and one of the triggers is clicked",function(){beforeEach(function(){spyOnEvent($("#first-dropdown"),"uiDropdownOpened"),spyOnEvent($("#second-dropdown"),"uiDropdownOpened"),$("#first-dropdown").find(this.component.attr.togglerSelector).trigger("click")}),describe("but another dropdown managed by the instance is open",function(){beforeEach(function(){spyOnEvent($("#first-dropdown"),"uiDropdownClosed"),$("#second-dropdown").find(this.component.attr.togglerSelector).trigger("click")}),it("removes the open class from the currently open dropdown",function(){expect($("#first-dropdown")).not.toHaveClass(this.component.attr.openClass)}),it('triggers the "uiDropdownClosed" on the currently open dropdown',function(){expect("uiDropdownClosed").toHaveBeenTriggeredOn($("#first-dropdown"))}),it("removes the tab stop before the currently open dropdown menu",function(){expect($("#first-dropdown").find(this.component.attr.firstTabStopSelector)).not.toExist()}),it("removes the tab stop after the currently open dropdown menu",function(){expect($("#first-dropdown").find(this.component.attr.lastTabStopSelector)).not.toExist()})}),it("adds the open class to the dropdown for the trigger that was clicked",function(){expect($("#first-dropdown")).toHaveClass(this.component.attr.openClass)}),it("does not add the open class to the other triggers",function(){expect($("#second-dropdown")).not.toHaveClass(this.component.attr.openClass)}),it("adds a tab stop before the dropdown menu for the trigger that was clicked",function(){expect($("#first-dropdown").find(this.component.attr.firstTabStopSelector)).toExist()}),it("adds a tab stop after the dropdown menu for the trigger that was clicked",function(){expect($("#first-dropdown").find(this.component.attr.lastTabStopSelector)).toExist()}),it("does not add a tab stop before the other dropdown menus",function(){expect($("#second-dropdown").find(this.component.attr.firstTabStopSelector)).not.toExist()}),it("does not add a tab stop after the other dropdown menus",function(){expect($("#second-dropdown").find(this.component.attr.lastTabStopSelector)).not.toExist()}),it('triggers the "uiDropdownOpened" event on the dropdown for the trigger that was clicked',function(){expect("uiDropdownOpened").toHaveBeenTriggeredOn($("#first-dropdown"))}),it('does not trigger the "uiDropdownOpened" event on the other dropdowns',function(){expect("uiDropdownOpened").not.toHaveBeenTriggeredOn($("#second-dropdown"))})})}),describe("When the dropdown is triggered to open and the uiDropdownOpenRequested event is prevented",function(){it("does not open",function(){setupComponent(a),this.component.on("uiDropdownOpenRequested",function(a){a.preventDefault()}),this.component.trigger($("#dropdown"),"uiShouldShowDropdown"),expect(this.component.isOpen()).toBe(!1)})}),describe('When the "uiShouldShowDropdown" event is triggered',function(){beforeEach(function(){setupComponent(b)}),describe("and the target of the event is a dropdown",function(){describe("and the dropdown is not open",function(){beforeEach(function(){$("#fixture_parent").append('<div id="doc"></div>'),spyOnEvent($("#first-dropdown"),"uiDropdownOpened"),this.component.trigger($("#first-dropdown"),"uiShouldShowDropdown")}),it("adds the open class",function(){expect($("#first-dropdown")).toHaveClass(this.component.attr.openClass)}),it("adds a tab stop before the dropdown menu for the trigger that was clicked",function(){expect($("#first-dropdown").find(this.component.attr.firstTabStopSelector)).toExist()}),it("adds a tab stop after the dropdown menu for the trigger that was clicked",function(){expect($("#first-dropdown").find(this.component.attr.lastTabStopSelector)).toExist()}),it('triggers the "uiDropdownOpened" event',function(){expect("uiDropdownOpened").toHaveBeenTriggeredOn($("#first-dropdown"))})}),describe("and the dropdown is open",function(){beforeEach(function(){$("#fixture_parent").append('<div id="doc"></div>'),this.component.trigger($("#first-dropdown"),"uiShouldShowDropdown"),spyOnEvent($("#first-dropdown"),"uiDropdownOpened"),this.component.trigger($("#first-dropdown"),"uiShouldShowDropdown")}),it("does not remove the tab stop before the dropdown menu",function(){expect($("#first-dropdown").find(this.component.attr.firstTabStopSelector)).toExist()}),it("does not remove the tab stop after the dropdown menu",function(){expect($("#first-dropdown").find(this.component.attr.lastTabStopSelector)).toExist()}),it("does not remove the open class",function(){expect($("#first-dropdown")).toHaveClass(this.component.attr.openClass)}),it('does not trigger the "uiDropdownOpened" event',function(){expect("uiDropdownOpened").not.toHaveBeenTriggeredOn($("#first-dropdown"))})})}),describe("and the event triggered with a selector",function(){describe("and the dropdown is not open",function(){beforeEach(function(){$("#fixture_parent").append('<div id="doc"></div>'),spyOnEvent($("#first-dropdown"),"uiDropdownOpened"),this.component.trigger("uiShouldShowDropdown",{selector:"#first-dropdown"})}),it("adds the open class",function(){expect($("#first-dropdown")).toHaveClass(this.component.attr.openClass)}),it("adds a tab stop before the dropdown menu for the trigger that was clicked",function(){expect($("#first-dropdown").find(this.component.attr.firstTabStopSelector)).toExist()}),it("adds a tab stop after the dropdown menu for the trigger that was clicked",function(){expect($("#first-dropdown").find(this.component.attr.lastTabStopSelector)).toExist()}),it('triggers the "uiDropdownOpened" event',function(){expect("uiDropdownOpened").toHaveBeenTriggeredOn($("#first-dropdown"))})}),describe("and the dropdown is open",function(){beforeEach(function(){$("#fixture_parent").append('<div id="doc"></div>'),this.component.trigger($("#first-dropdown"),"uiShouldShowDropdown"),spyOnEvent($("#first-dropdown"),"uiDropdownOpened"),this.component.trigger("uiShouldShowDropdown",{selector:"#first-dropdown"})}),it("does not remove the tab stop before the dropdown menu",function(){expect($("#first-dropdown").find(this.component.attr.firstTabStopSelector)).toExist()}),it("does not remove the tab stop after the dropdown menu",function(){expect($("#first-dropdown").find(this.component.attr.lastTabStopSelector)).toExist()}),it("does not remove the open class",function(){expect($("#first-dropdown")).toHaveClass(this.component.attr.openClass)}),it('does not trigger the "uiDropdownOpened" event',function(){expect("uiDropdownOpened").not.toHaveBeenTriggeredOn($("#first-dropdown"))})})})})})
});
define("test/app/ui/signin_dropdown_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/signin_dropdown",function(){var a='<div class="dropdown js-session">\n    <a href="/login" class="dropdown-toggle js-dropdown-toggle dropdown-signin" id="signin-link" data-nav="login">\n      <small>Have an account?</small> Sign in<span class="caret"></span>\n    </a>\n    <div class="dropdown-menu dropdown-form" id="signin-dropdown">\n      <div class="dropdown-caret right">\n        <span class="caret-outer"></span>\n        <span class="caret-inner"></span>\n      </div>\n      <div class="signin-dialog-body">\n        <form action="{{sessions_path}}" class="js-signin signin" method="post">\n          <fieldset>\n            <legend id="signin-form-legend" class="visuallyhidden">Sign In</legend>\n            <fieldset class="textbox">\n              <label class="username js-username">\n                <span>Username or email</span>\n                <input class="js-username-field email-input js-initial-focus" type="text" name="session[username_or_email]" autocomplete="on">\n              </label>\n              <label class="password js-password">\n                <span>Password</span>\n                <input class="js-password-field" type="password" value="" name="session[password]">\n              </label>\n            </fieldset>\n          </fieldset>\n        </form>\n      </div>\n    </div>\n  </div>\n  ';beforeEach(function(){setupComponent(a),this.component.trigger(document,"uiSwiftLoaded")}),describe("When the dropdown is opened",function(){beforeEach(function(){this.component.select("togglerSelector").trigger("click")}),it("focuses on username",function(){expect(this.component.select("usernameSelector")).toBeFocused()}),it('sets the "role" attribute of the dropdown menu element to "dialog"',function(){expect(this.component.select("dropDownMenuSelector").attr("role")).toBe("dialog")}),it('sets the "aria-labelledby" attribute of the dropdown menu element to "signin-form-legend"',function(){expect(this.component.select("dropDownMenuSelector").attr("aria-labelledby")).toBe("signin-form-legend")}),it('sets the "aria-hidden" attribute of the dropdown menu element to "false"',function(){expect(this.component.select("dropDownMenuSelector").attr("aria-hidden")).toBe("false")})}),describe("When the dropdown is hidden",function(){beforeEach(function(){this.component.select("togglerSelector").trigger("click"),this.component.select("togglerSelector").trigger("click")}),it('sets the "aria-hidden" attribute of the dropdown menu element to "false"',function(){expect(this.component.select("dropDownMenuSelector").attr("aria-hidden")).toBe("true")})})})
});
define("test/app/ui/inline_profile_editing_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/inline_profile_editing",{fixture:"test/fixtures/own_profile_header"},function(){beforeEach(function(){setupComponent(this.fixture,{profileEditingClass:"profileEditingClass"})}),afterEach(function(){$(".tooltip").remove(),$("body").removeClass("profileEditingClass")}),it("tooltips are enabled by default",function(){$(".js-tooltip").tooltip("show"),expect($(".tooltip")).toExist(),$(".js-tooltip").tooltip("hide")}),describe("on uiEditProfileStart",function(){beforeEach(function(){jasmine.Clock.useMock(),spyOnEvent(document,"uiEnableCanopyScroll"),spyOnEvent(document,"uiDisableCanopyScroll"),this.component.trigger("uiEditProfileStart")}),it("disables tooltips",function(){$(".js-tooltip").tooltip("show"),expect($(".tooltip")).not.toExist()}),it("adds profileEditingClassClass to body",function(){expect($("body")).toHaveClass("profileEditingClass")}),it("triggers uiDisableCanopyScroll",function(){expect("uiDisableCanopyScroll").toHaveBeenTriggeredOn(document)}),describe("on uiEditProfileEnd",function(){beforeEach(function(){this.component.trigger("uiEditProfileEnd")}),it("enables tooltips",function(){$(".js-tooltip").tooltip("show"),expect($(".tooltip")).toExist()}),it("removed profileEditingClassClass from body",function(){expect($("body")).not.toHaveClass("profileEditingClass")}),it("triggers uiEnableCanopyScroll",function(){expect("uiEnableCanopyScroll").toHaveBeenTriggeredOn(document)})})})})
});
define("test/app/ui/keyboard_shortcuts_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/keyboard_shortcuts",function(){function a(a){var b={E:13,X:27,"/":191},c=b[a]||a.toUpperCase().charCodeAt();return jQuery.Event("keydown",{keyCode:c,which:c})}beforeEach(function(){var a='<div>\n        <div class="foo">\n          <input type="email" class="text-field">\n          <input type="password" class="text-field">\n          <input type="text" class="text-field">\n          <textarea class="text-field"></textarea>\n          <input type="submit" class="not-text-field">\n          <input type="range" class="not-text-field">\n          <button class="not-text-field"></button>\n          <a class="not-text-field"></a>\n          <input class="search-input" type="text" id="search-query" placeholder="Search" name="q">\n        </div>\n      </div>\n    ';setupComponent(a),spyOn(this.component,"navigateTo")}),it("triggers custom events in response to key events",function(){var b=this.component.shortcutEvents;Object.keys(b).forEach(function(c){var d=b[c],e,f=typeof d=="string"?d:d.type;spyOnEvent(this.component.node,f);for(var g=0;g<c.length;g++)e=c[g],this.component.$node.trigger(a(e));expect(f).toHaveBeenTriggeredOn(this.component.node)}.bind(this))}),it("should time out key stroke after 5 seconds",function(){jasmine.Clock.useMock(),spyOnEvent(this.component.node,"uiShortcutNavigateHome"),this.component.$node.trigger(a("g")),jasmine.Clock.tick(5001),this.component.$node.trigger(a("h")),expect("uiShortcutNavigateHome").not.toHaveBeenTriggeredOn(this.component.node)}),it("handles events if they are triggered on non-text fields",function(){spyOnEvent(this.component.node,"uiShortcutRetweet");var b=this.$node.find(".not-text-field").toArray();b.forEach(function(b){var c=a("t");c.target=b,this.component.$node.trigger(c),expect("uiShortcutRetweet").toHaveBeenTriggeredOn(this.component.node)}.bind(this))}),it("ignores events if they are triggered on text fields",function(){var b=this.$node.find(".text-field").toArray();b.forEach(function(b){spyOnEvent(b,"uiShortcutRetweet"),b.focus();var c=a("t");$(b).trigger(c),expect("uiShortcutRetweet").not.toHaveBeenTriggeredOn(b)})}),it("does not ignore Esc key if it is triggered on text fields",function(){var b=this.$node.find(".text-field").toArray();b.forEach(function(b){spyOnEvent(b,"uiShortcutEsc"),b.focus();var c=a("X");$(b).trigger(c),expect("uiShortcutEsc").toHaveBeenTriggeredOn(b)})}),it("blurs the target when Esc key is pressed",function(){jasmine.Clock.useMock();var b=this.$node.find(".text-field").toArray();b.forEach(function(b,c){var d=$(b);d.focus();var e=a("X");d.trigger(e),expect($(b)).not.toBeFocused(),jasmine.Clock.tick(5001)})}),it("does not blur the target when Esc key is pressed and the default behavior has been preventend",function(){jasmine.Clock.useMock();var b=this.$node.find(".text-field").toArray();this.$node.find(".foo").on("uiShortcutEsc",function(a){a.preventDefault()}),b.forEach(function(b){var c=$(b);c.focus();var d=a("X");c.trigger(d),expect(c).toBeFocused(),jasmine.Clock.tick(5001)})}),it("focuses on the search field when uiShortcutGotoSearch is triggered on the component",function(){var b=a("/");this.component.$node.trigger(b),expect($(this.component.attr.globalSearchBoxSelector)).toBeFocused()}),it("ignores function key (f1-f12) events",function(){var a=[112,113,114,115,116,117,118,119,120,121,122,123];a.forEach(function(a){var b=jQuery.Event("keydown",{keyCode:a,which:a});this.component.$node.trigger(b),expect(b.isDefaultPrevented()).toBe(!1)},this)})})
});
define("test/app/helpers/describe_module_spec",["module","require","exports"],function(module, require, exports) {
describeModule("test/app/helpers/test_module",function(){it("automatically instantiates a Module object",function(){expect(this.Module).toBeDefined(),expect(this.Module.some_method).toBeDefined()})})
});
define("test/app/helpers/global_after_each_spec",["module","require","exports"],function(module, require, exports) {
module.exports={},describe("global afterEach",function(){it("resets CoreStorage between tests",function(){expect(window.__swift_storage.getItem("testValue")).toBeNull(),window.__swift_storage.setItem("testValue",!0)}),it("resets CoreStorage between tests",function(){expect(window.__swift_storage.getItem("testValue")).toBeNull(),window.__swift_storage.setItem("testValue",!0)})})
});
define("test/app/helpers/describe_component_with_data_components_spec",["module","require","exports"],function(module, require, exports) {
describeComponentWithDataComponents("test/app/helpers/test_component",["test/app/helpers/first_data_component","test/app/helpers/second_data_component"],function(){describe("setupComponent()",function(){beforeEach(setupComponent),it("instantiates the components",function(){expect(this.component).toBeDefined(),expect(this.Component).toBeDefined(),expect(this.component instanceof this.Component).toBeTruthy()}),it("instantiates the data components and names then after their file name",function(){expect(this.firstDataComponent).toBeDefined(),expect(this.FirstDataComponent).toBeDefined(),expect(this.firstDataComponent instanceof this.FirstDataComponent).toBeTruthy(),expect(this.secondDataComponent).toBeDefined(),expect(this.SecondDataComponent).toBeDefined(),expect(this.secondDataComponent instanceof this.SecondDataComponent).toBeTruthy()}),it("stores a map of data component names to classes",function(){expect(this.dataComponentMap.FirstDataComponent).toBeDefined(),expect(this.dataComponentMap.SecondDataComponent).toBeDefined()}),it("creates a $node object",function(){expect(this.$node).toBeDefined()}),describe("calling setupComponent() with a new node",function(){beforeEach(function(){var a=$('<div class="my-override"></div>');setupComponent(a)}),it("respects overwritten definitions of this.$node",function(){expect(this.$node.hasClass("my-override")).toBeTruthy(),expect(this.component.$node.hasClass("my-override")).toBeTruthy(),expect(this.firstDataComponent.$node.hasClass("my-override")).toBeTruthy(),expect(this.secondDataComponent.$node.hasClass("my-override")).toBeTruthy()})}),describe("calling setupComponent() with options",function(){beforeEach(function(){setupComponent({myOption:"foo"})}),it("respects overwritten definitions of this.component",function(){expect(this.firstDataComponent).toBeDefined(),expect(this.component.attr.myOption).toBe("foo")})})})})
});
define("test/app/helpers/test_scribing_component",["module","require","exports","core/component","app/data/with_scribe"],function(module, require, exports) {
function testScribingComponent(){}var defineComponent=require("core/component"),withScribe=require("app/data/with_scribe");module.exports=defineComponent(testScribingComponent,withScribe)
});
define("test/app/helpers/describe_mixin_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("test/app/helpers/test_mixin",function(){beforeEach(setupComponent),it("adds this.Mixin to the scope",function(){expect(this.Mixin).toBeDefined()}),it("automatically instantiates a component with that mixin",function(){expect(this.component).toBeDefined(),expect(this.Component).toBeDefined(),expect(this.component instanceof this.Component).toBeDefined(),expect(this.component.mixinFunction).toBeDefined()}),it("automatically creates a $node object",function(){expect(this.$node).toBeDefined()}),describe("overwriting this.$node",function(){beforeEach(function(){var a=$('<div class="my-override"></div>');setupComponent(a)}),it("respects overwritten definitions of this.$node",function(){expect(this.$node.hasClass("my-override")).toBeTruthy(),expect(this.component.$node.hasClass("my-override")).toBeTruthy()})}),describe("overwriting this.component",function(){beforeEach(function(){setupComponent({myOption:"foo"})}),it("respects overwritten definitions of this.component",function(){expect(this.component.attr.myOption).toBe("foo")})})})
});
define("test/app/helpers/second_data_component",["module","require","exports","core/component"],function(module, require, exports) {
function secondDataComponent(){}var defineComponent=require("core/component");module.exports=defineComponent(secondDataComponent)
});
define("test/app/helpers/extra_jquery_helpers_spec",["module","require","exports"],function(module, require, exports) {
module.exports={},describe("toHaveBeenTriggeredOnAndWith",function(){it("checks to see if an argument was passed through an event on a DOM node",function(){spyOnEvent(document,"myCustomEvent"),$(document).trigger("myCustomEvent","Foo"),expect("myCustomEvent").toHaveBeenTriggeredOnAndWith(document,"Foo")}),it("matches one of the arguments when multiple arguments are passed",function(){spyOnEvent(document,"myCustomEvent"),$(document).trigger("myCustomEvent",["Foo","Bar","Baz"]),expect("myCustomEvent").toHaveBeenTriggeredOnAndWith(document,"Bar")})}),describe("toHaveCss",function(){beforeEach(function(){this.$div=$("<div>").appendTo("#fixture_parent"),attachFixtureToDom(this.$div)}),it("tests that a given node has a given CSS attribute name and value",function(){this.$div.css("margin-top","5px"),expect(this.$div).toHaveCss("margin-top","5px")}),it("can take a regex for the value",function(){this.$div.css("margin-right","100px"),expect(this.$div).toHaveCss("margin-right",/100px/)}),it("converts colors to rgb format",function(){spyOn(this.$div,"css").andReturn("#0000ff"),expect(this.$div).toHaveCss("background-color","rgb(0, 0, 255)")})}),describe("toScribe",function(){var a={client:"web",page:"foo",section:"bar",component:"baz",element:"biz",action:"click"},b={client:"web",page:"big",section:"ba",component:"da",element:"boom",action:"retweet"};describe("with an empty log",function(){beforeEach(function(){this.component={_clientEventLog:[]}}),it("doesn't find the scribe event",function(){expect(this.component).not.toScribe("click",{message:"foobar"}),expect(this.component).not.toScribe("retweet"),expect(this.component).not.toScribe(a,{message:"foobar"}),expect(this.component).not.toScribe(b)})}),describe("with a full log",function(){beforeEach(function(){this.component={_clientEventLog:[{event_namespace:{client:"web",page:"foo",section:"bar",component:"baz",element:"biz",action:"click"},message:"foobar",item_ids:[1,2,3,4,5],_category_:"client_event"},{event_namespace:{client:"web",page:"big",section:"ba",component:"da",element:"boom",action:"retweet"},item_details:{target_id:1234,item_type:3,item_name:"blah"},user_id:1234,_category_:"client_event"}]}}),it("tests with exactly matching expected data",function(){expect(this.component).toScribe("click",{message:"foobar",item_ids:[1,2,3,4,5]}),expect(this.component).toScribe("retweet",{item_details:{target_id:1234,item_type:3,item_name:"blah"},user_id:1234}),expect(this.component).toScribe(a,{message:"foobar",item_ids:[1,2,3,4,5]}),expect(this.component).toScribe(b,{item_details:{target_id:1234,item_type:3,item_name:"blah"},user_id:1234})}),it("tests with partially matching expected data",function(){expect(this.component).toScribe("click",{item_ids:[1,2,3],_category_:"client_event"}),expect(this.component).toScribe("retweet",{item_details:{item_name:"blah"},user_id:1234}),expect(this.component).toScribe(a,{item_ids:[1,2,3],_category_:"client_event"}),expect(this.component).toScribe(b,{item_details:{item_name:"blah"},user_id:1234})}),it("must have a matching event name",function(){expect(this.component).not.toScribe("not_an_action",{message:"foobar",item_ids:[1,2,3,4,5]}),expect(this.component).not.toScribe({client:"web",page:"wtf",section:"bar",component:"baz",element:"biz",action:"click"},{message:"foobar",item_ids:[1,2,3,4,5]})}),it("must have matching data",function(){expect(this.component).not.toScribe("click",{message:"foobar",item_ids:[1,2,3,4,6]}),expect(this.component).not.toScribe("click",{message:"barfoo",item_ids:[1,2,3,4,5]}),expect(this.component).not.toScribe("click",{event_info:"not present",message:"foobar",item_ids:[1,2,3,4,5]}),expect(this.component).not.toScribe(a,{message:"foobar",item_ids:[1,2,3,4,6]}),expect(this.component).not.toScribe(a,{message:"barfoo",item_ids:[1,2,3,4,5]}),expect(this.component).not.toScribe(a,{event_info:"not present",message:"foobar",item_ids:[1,2,3,4,5]})}),it("can have a partially matching event name",function(){expect(this.component).toScribe({client:"web",action:"click"},{message:"foobar"}),expect(this.component).toScribe({page:"foo",element:"biz",action:"click"},{message:"foobar"})}),it("throws an error without an action term in the event_namespace",function(){var a=function(){expect(this.component).not.toScribe({client:"web",page:"foo",section:"bar",component:"baz",element:"biz"},{message:"foobar"})};expect(a).toThrow(),a=function(){expect(this.component).not.toScribe({},{message:"foobar"})},expect(a).toThrow(),a=function(){expect(this.component).not.toScribe(undefined,{message:"foobar"})},expect(a).toThrow(),a=function(){expect(this.component).not.toScribe(!1,{message:"foobar"})},expect(a).toThrow()})})})
});
define("test/app/helpers/describe_component_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("test/app/helpers/test_component",function(){it("loads the Component",function(){expect(this.Component).toBeDefined()}),describe("setupComponent()",function(){beforeEach(setupComponent),it("instantiates the component",function(){expect(this.component).toBeDefined(),expect(this.component instanceof this.Component).toBeTruthy()}),it("creates a $node object",function(){expect(this.$node).toBeDefined()}),describe("calling setupComponent() with a new node",function(){beforeEach(function(){var a=$('<div class="my-override"></div>');setupComponent(a)}),it("respects overwritten definitions of this.$node",function(){expect(this.$node.hasClass("my-override")).toBeTruthy(),expect(this.component.$node.hasClass("my-override")).toBeTruthy()})}),describe("calling setupComponent() with options",function(){beforeEach(function(){setupComponent({myOption:"foo"})}),it("respects overwritten definitions of this.component",function(){expect(this.component.attr.myOption).toBe("foo")})})})})
});
define("test/app/helpers/first_data_component",["module","require","exports","core/component"],function(module, require, exports) {
function firstDataComponent(){}var defineComponent=require("core/component");module.exports=defineComponent(firstDataComponent)
});
define("test/app/helpers/log_client_events_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("test/app/helpers/test_scribing_component",function(){var a;beforeEach(function(){setupComponent()}),it("creates the log array for recording events on the component",function(){expect(this.component._clientEventLog).toBeDefined(),expect(this.component._clientEventLog.length).toBe(0)}),it("copies events to the test log",function(){expect(this.component._clientEventLog.length).toBe(0),this.component.scribe({component:"stream",element:"tweet",action:"results"},{message:"foobar"}),expect(this.component._clientEventLog.length).toBe(1);var a=this.component._clientEventLog[0];expect(a.event_namespace).toEqual({component:"stream",element:"tweet",action:"results"}),expect(a.message).toBe("foobar")})})
});
define("test/app/helpers/test_component",["module","require","exports","core/component"],function(module, require, exports) {
function testingDescribeComponent(){}var defineComponent=require("core/component");module.exports=defineComponent(testingDescribeComponent)
});
define("test/app/helpers/test_module",["module","require","exports"],function(module, require, exports) {
function TestModule(){}TestModule.prototype={some_method:function(){}},module.exports=new TestModule
});
define("test/app/helpers/ajax_respond_with_spec",["module","require","exports"],function(module, require, exports) {
module.exports={},beforeEach(function(){this.successSpy=jasmine.createSpy("Success"),this.errorSpy=jasmine.createSpy("Error"),this.completeSpy=jasmine.createSpy("Complete"),this.triggerAjaxRequest=function(){$.ajax({success:this.successSpy,error:this.errorSpy,complete:this.completeSpy})}}),describe("ajaxRespondWithSuccess",function(){beforeEach(function(){ajaxRespondWithSuccess({foo:"bar"}),this.triggerAjaxRequest()}),it("calls the success handler with the data passed",function(){expect(this.successSpy).toHaveBeenCalledWith({foo:"bar"})}),it("doesn't call the error handler",function(){expect(this.errorSpy).not.toHaveBeenCalled()}),it("calls the complete handler",function(){expect(this.completeSpy).toHaveBeenCalled()})}),describe("ajaxRespondWithError",function(){beforeEach(function(){ajaxRespondWithError({bar:"baz"}),this.triggerAjaxRequest()}),it("calls the error handler with the data passed",function(){expect(this.errorSpy).toHaveBeenCalledWith({bar:"baz"})}),it("doesn't call the success handler",function(){expect(this.successSpy).not.toHaveBeenCalled()}),it("calls the error handler",function(){expect(this.completeSpy).toHaveBeenCalled()})}),describe("not calling either ajaxRespondWithSuccess or ajaxRespondWithFailure",function(){beforeEach(function(){this.triggerAjaxRequest()}),it("does not call the success or error handlers",function(){expect(this.successSpy).not.toHaveBeenCalled(),expect(this.errorSpy).not.toHaveBeenCalled()}),it("calls the complete handler",function(){expect(this.completeSpy).toHaveBeenCalled()})}),describe("calling ajaxRespondWithSuccess *and* ajaxRespondWithError",function(){it("throws an error",function(){expect(function(){ajaxRespondWithSuccess({woo:"hoo!"}),ajaxRespondWithError({boo:"hoo :("})}).toThrow()})})
});
define("test/app/helpers/test_mixin",["module","require","exports"],function(module, require, exports) {
module.exports=function(){this.mixinFunction=function(){}}
});
define("test/app/data/media_thumbnails_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/media_thumbnails_scribe",function(){beforeEach(function(){setupComponent()}),describe("event uiMediaThumbnailsVisible",function(){it("scribes results",function(){var a=["http://yfrog.com/h0q3fdbj","https://p.twimg.com/AoZgjXQCIAEEH6p.jpg"];this.component.trigger("uiMediaThumbnailsVisible",{thumbnails:a,scribeContext:{component:"x"}}),expect(this.component).toScribe({action:"results",component:"x"},{item_count:2,item_names:a})}),it("scribes no_results",function(){this.component.trigger("uiMediaThumbnailsVisible",{thumbnails:[],scribeContext:{component:"x"}}),expect(this.component).toScribe({action:"no_results",component:"x"},{item_count:0})})}),describe("event uiMediaThumbnailClick",function(){describe("when a photo is clicked",function(){it("scribes click with element:photo and url data",function(){this.component.trigger("uiMediaThumbnailClick",{url:"http://test.host/photo.jpg",mediaType:"photo",scribeContext:{component:"x"}}),expect(this.component).toScribe({action:"click",element:"photo",component:"x"},{url:"http://test.host/photo.jpg"})})}),describe("when a video is clicked",function(){it("scribes click with element:video and url data",function(){this.component.trigger("uiMediaThumbnailClick",{url:"http://test.host/video.mpg",mediaType:"video",scribeContext:{component:"x"}}),expect(this.component).toScribe({action:"click",element:"video",component:"x"},{url:"http://test.host/video.mpg"})})})}),describe("event uiMediaViewAllClick",function(){it("scribes a view_all event",function(){this.component.trigger("uiMediaViewAllClick"),expect(this.component).toScribe({action:"view_all"})})})})
});
define("test/app/data/with_interaction_data_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/data/with_interaction_data_scribe",function(){beforeEach(function(){setupComponent({userId:666})}),describe("interactionItem and interactionTarget methods",function(){it("generates an item and target objects for a tweet profile click",function(){var a={itemType:"tweet",tweetId:"1003",targetUserId:"103",feedbackToken:"feedback"},b=this.component.interactionItem(a),c=this.component.interactionTarget(a,{action:"profile_click"});expect(b.id).toEqual("1003"),expect(b.item_type).toEqual(0),expect(b.position).toBeUndefined(),expect(b.promoted_id).toBeUndefined(),expect(b.token).toBeUndefined(),expect(c.id).toEqual("103"),expect(c.item_type).toEqual(3)}),it("generates an item and no target object for a tweet favorite ",function(){var a={itemType:"tweet",tweetId:"1003",targetUserId:"103",feedbackToken:"feedback"},b=this.component.interactionItem(a),c=this.component.interactionTarget(a,{action:"favorite"});expect(b.id).toEqual("1003"),expect(b.item_type).toEqual(0),expect(b.token).toBeUndefined(),expect(b.position).toBeUndefined(),expect(b.promoted_id).toBeUndefined(),expect(c).toBeUndefined()}),it("generates an item for a promoted tweet",function(){var a={itemType:"tweet",impressionId:"aaa",position:4,tweetId:"1003",userId:"103",feedbackToken:"feedback"},b=this.component.interactionItem(a);expect(b.id).toEqual("1003"),expect(b.token).toBeUndefined(),expect(b.item_type).toEqual(0),expect(b.promoted_id).toEqual("aaa"),expect(b.position).toEqual(4)}),it("generates an item for a retweet",function(){var a={itemType:"tweet",position:4,tweetId:"1003",retweetId:"10003",userId:"103",feedbackToken:"feedback"},b=this.component.interactionItem(a);expect(b.id).toEqual("1003"),expect(b.token).toBeUndefined(),expect(b.item_type).toEqual(0),expect(b.promoted_id).toBeUndefined(),expect(b.position).toEqual(4),expect(b.retweeting_tweet_id).toEqual("10003")}),it("generates an item for a retweet that's promoted",function(){var a={itemType:"tweet",impressionId:"aaa",position:4,tweetId:"1003",retweetId:"10003",userId:"103",feedbackToken:"feedback"},b=this.component.interactionItem(a);expect(b.id).toEqual("1003"),expect(b.token).toBeUndefined(),expect(b.item_type).toEqual(0),expect(b.promoted_id).toEqual("aaa"),expect(b.position).toEqual(4),expect(b.retweeting_tweet_id).toEqual("10003")}),it("returns an item for a user and target for targetted user",function(){var a={itemType:"user",position:2,tweetId:"1003",userId:"103",targetUserId:"104",feedbackToken:"feedback"},b=this.component.interactionItem(a),c=this.component.interactionTarget(a,{action:"profile_click"});expect(b.id).toEqual("103"),expect(b.token).toEqual("feedback"),expect(b.position).toEqual(2),expect(b.item_type).toEqual(3),expect(b.promoted_id).toBeUndefined(),expect(c.id).toEqual("104"),expect(c.position).toBeUndefined(),expect(c.promoted_id).toBeUndefined(),expect(c.item_type).toEqual(3)}),it("returns an item and target for the targetted user for a promoted account",function(){var a={itemType:"user",impressionId:"aaa",position:2,tweetId:"1003",userId:"103",targetUserId:"104",feedbackToken:"feedback"},b=this.component.interactionItem(a),c=this.component.interactionTarget(a,{action:"profile_click"});expect(b.id).toEqual("103"),expect(b.token).toEqual("feedback"),expect(b.position).toEqual(2),expect(b.item_type).toEqual(3),expect(b.promoted_id).toEqual("aaa"),expect(c.id).toEqual("104"),expect(c.position).toBeUndefined(),expect(c.promoted_id).toBeUndefined(),expect(c.item_type).toEqual(3)}),it("returns an item for a favorite activity item",function(){var a={itemType:"activity",position:9,tweetId:"1003",userId:"103",feedbackToken:"feedback",activityType:"favorite"},b=this.component.interactionItem(a),c=this.component.interactionTarget(a,{action:"favorite"});expect(b.id).toEqual("1003"),expect(b.token).toBeUndefined(),expect(b.position).toEqual(9),expect(b.item_type).toEqual(0),expect(b.activity_type).toEqual("favorite"),expect(b.promoted_id).toBeUndefined(),expect(c).toBeUndefined()}),it("returns an item and target for a follow activity item on your activity timeline",function(){var a={itemType:"activity",position:9,tweetId:"1003",userId:"103",targetUserId:"203",isMentionClick:!0,feedbackToken:"feedback",activityType:"follow",actingUserIds:["104","105","106"]},b=this.component.interactionItem(a),c=this.component.interactionTarget(a,{action:"profile_click"});expect(b.id).toEqual(666),expect(b.token).toEqual("feedback"),expect(b.position).toEqual(9),expect(b.item_type).toEqual(3),expect(b.activity_type).toEqual("follow"),expect(b.promoted_id).toBeUndefined(),expect(b.acting_user_ids).toEqual(["104","105","106"]),expect(c.id).toEqual("103"),expect(c.position).toBeUndefined(),expect(c.promoted_id).toBeUndefined(),expect(c.item_type).toEqual(3)}),it("returns an item and target for a follow activity item on network activity timeline",function(){var a={itemType:"activity",position:9,tweetId:"1003",userId:"103",feedbackToken:"feedback",activityType:"follow",actingUserIds:["104","105","106"],isNetworkActivity:!0},b=this.component.interactionItem(a),c=this.component.interactionTarget(a,{action:"profile_click"});expect(b.id).toEqual("103"),expect(b.token).toEqual("feedback"),expect(b.position).toEqual(9),expect(b.item_type).toEqual(3),expect(b.activity_type).toEqual("follow"),expect(b.promoted_id).toBeUndefined(),expect(b.acting_user_ids).toEqual(["104","105","106"]),expect(c.id).toEqual("103"),expect(c.position).toBeUndefined(),expect(c.promoted_id).toBeUndefined(),expect(c.item_type).toEqual(3)}),it("returns an item for a story item tweet action",function(){var a={itemType:"story",position:2,tweetId:"1003",userId:"103",storyType:"news",storySource:"trends",socialProofType:"social"},b=this.component.interactionItem(a),c=this.component.interactionTarget(a,{action:"favorite"});expect(b.id).toEqual("1003"),expect(b.token).toBeUndefined(),expect(b.position).toEqual(2),expect(b.item_type).toEqual(0),expect(b.story_type).toEqual("news"),expect(b.story_source).toEqual("trends"),expect(b.social_proof_type).toEqual("social"),expect(b.promoted_id).toBeUndefined(),expect(c).toBeUndefined()}),it("returns an item details hash for a story item action",function(){var a={itemType:"story",position:6,storyType:"news",storySource:"trends",storySource:"trends",userId:"103",socialProofType:"social"},b=this.component.interactionItem(a),c=this.component.interactionTarget(a,{element:"article",action:"open_link"});expect(b.id).toEqual("103"),expect(b.token).toBeUndefined(),expect(b.position).toEqual(6),expect(b.item_type).toEqual(3),expect(b.story_type).toEqual("news"),expect(b.story_source).toEqual("trends"),expect(b.social_proof_type).toEqual("social"),expect(b.promoted_id).toBeUndefined(),expect(c).toBeUndefined()})}),describe("scribeInteraction method",function(){it("scribes an interaction event",function(){this.component.scribeInteraction({action:"profile_click"},{tweetId:"1001",targetUserId:"101",position:7,impressionId:"aaa",itemType:"tweet",feedbackToken:"feedback",profileClickTarget:"avatar",isMentionClick:!1,scribeContext:{component:"tweet"},scribeData:{event_info:"foobar"}}),expect(this.component).toScribe({component:"tweet",element:"avatar",action:"profile_click"},{items:[{id:"1001",promoted_id:"aaa",item_type:0,position:7}],targets:[{id:"101",item_type:3}],event_info:"foobar",promoted:!0})}),describe("when saveProfileClickContext should get called",function(){var a={foo:"bar"};beforeEach(function(){spyOn(this.component,"saveProfileClickContext")}),it("gets called on profile_click",function(){this.component.scribeInteraction({action:"profile_click"},a),expect(this.component.saveProfileClickContext).toHaveBeenCalledWith(a)}),it("gets called on mention_click",function(){this.component.scribeInteraction({action:"mention_click"},a),expect(this.component.saveProfileClickContext).toHaveBeenCalledWith(a)})}),describe("when getUserActionAssociations returns data",function(){var a={0:{associated_id:42}},b={targetUserId:"101",itemType:"user",userId:"5"},c={items:[{id:"5",item_type:3}],targets:[{id:"101",item_type:3}],associations:a};beforeEach(function(){spyOn(this.component,"getUserActionAssociations").andReturn(a)}),it("scribes saved user action associations on report_as_spam",function(){this.component.scribeInteraction({action:"report_as_spam"},b),expect(this.component).toScribe({action:"report_as_spam"},c)}),it("scribes saved user action associations on block",function(){this.component.scribeInteraction({action:"block"},b),expect(this.component).toScribe({action:"block"},c)}),it("does not scribes saved user action associations on other_action",function(){this.component.scribeInteraction({action:"other_action"},b),expect(this.component).not.toScribe({action:"other_action"},c)})})}),describe("#associationNamespace",function(){var a={page:"a_page",section:"a_section",extra:"junk"};it("returns the page & section & component when component is conversation",function(){expect(this.component.associationNamespace(a,"conversation")).toEqual({page:"a_page",section:"a_section",component:"conversation"})}),it("returns the page & section & component when component is replies",function(){expect(this.component.associationNamespace(a,"replies")).toEqual({page:"a_page",section:"a_section",component:"replies"})}),it("returns the page & section & component when component is in_reply_to",function(){expect(this.component.associationNamespace(a,"in_reply_to")).toEqual({page:"a_page",section:"a_section",component:"in_reply_to"})}),it("returns just the page & section when component is unknown",function(){expect(this.component.associationNamespace(a),"foo").toEqual({page:"a_page",section:"a_section"})})}),describe("#getProfileUserAssociations",function(){beforeEach(function(){spyOn(this.component,"associationNamespace").andReturn({page:"a_page"})}),it("returns null when there is no profile user defined",function(){this.component.attr.profile_user=undefined,expect(this.component.getProfileUserAssociations()).toBe(null)}),it("returns associations when there is a profile user",function(){this.component.attr.profile_user={id_str:"42"},expect(this.component.getProfileUserAssociations()).toEqual({5:{association_id:"42",association_type:3,association_namespace:{page:"a_page"}}})})}),describe("#getProfileClickContextAssociations",function(){var a,b="42",c=6e7,d={yay:!0};beforeEach(function(){spyOn(this.component,"getSessionObject").andCallFake(function(){return a}),a={userId:b,expires:(new Date).getTime()+c,associations:d}}),it("calls getSessionObject with profileClickContextSessionKey",function(){this.component.getProfileClickContextAssociations(b),expect(this.component.getSessionObject).toHaveBeenCalledWith(this.component.attr.profileClickContextSessionKey)}),it("returns associations when the context is valid",function(){expect(this.component.getProfileClickContextAssociations(b)).toEqual(d)}),it("returns null when sessionItem is undefined",function(){a=undefined,expect(this.component.getProfileClickContextAssociations(b)).toBe(null)}),it("returns null when the context is valid but has a different userId",function(){a.userId=b+"1",expect(this.component.getProfileClickContextAssociations(b)).toBe(null)}),it("returns null when the context is valid but has expired",function(){a.expires-=c,expect(this.component.getProfileClickContextAssociations(b)).toBe(null)})}),describe("#saveProfileClickContext",function(){var a,b,c;beforeEach(function(){spyOn(this.component,"setSessionObject").andCallFake(function(c,d){a=c,b=d}),spyOn(this.component,"associationNamespace").andReturn({page:"a_page"}),c={userId:"5",tweetId:"101",scribeContext:{}}}),it("saves a tweet association with namespace when eventData has tweetId",function(){this.component.saveProfileClickContext(c),expect(a).toEqual(this.component.attr.profileClickContextSessionKey),expect(b.userId).toEqual("5"),expect(b.expires).toBeGreaterThan((new Date).getTime()),expect(b.associations).toEqual({1:{association_id:"101",association_type:0,association_namespace:{page:"a_page"}}})}),it("saves a conversation and tweet association when eventData has conversationOriginTweetId",function(){c.conversationOriginTweetId="100",this.component.saveProfileClickContext(c),expect(b.associations).toEqual({1:{association_id:"101",association_type:0,association_namespace:{page:"a_page"}},4:{association_id:"100",association_type:0}})}),it("saves a user association when eventData does not have a tweetId",function(){var a={5:{association_id:"42",association_type:3,association_namespace:{page:"a_page"}}};spyOn(this.component,"getProfileUserAssociations").andReturn(a),c.tweetId=undefined,this.component.saveProfileClickContext(c),expect(b.associations).toEqual(a)})}),describe("#getUserActionAssociations",function(){beforeEach(function(){spyOn(this.component,"getProfileClickContextAssociations").andReturn("ProfileClickContextAssociations"),spyOn(this.component,"getProfileUserAssociations").andReturn("ProfileUserAssociations")}),it("returns ProfileClickContextAssociations when the component is profile_dialog",function(){expect(this.component.getUserActionAssociations({scribeContext:{component:"profile_dialog"}})).toEqual("ProfileClickContextAssociations")}),it("returns ProfileClickContextAssociations when the component is profile_follow_card",function(){expect(this.component.getUserActionAssociations({scribeContext:{component:"profile_follow_card"}})).toEqual("ProfileClickContextAssociations")}),it("returns ProfileClickContextAssociations when the component is user",function(){expect(this.component.getUserActionAssociations({scribeContext:{component:"user"}})).toEqual("ProfileUserAssociations")}),it("returns ProfileClickContextAssociations when the component is unknown",function(){expect(this.component.getUserActionAssociations({scribeContext:{component:"foo"}})).toBe(null)})})})
});
define("test/app/data/promptbird_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/promptbird",function(){beforeEach(setupComponent),describe("event uiPromptbirdDismissPrompt",function(){it("triggers dataPromptbirdPromptDismissed when uiPromptbirdDismissPrompt called, success",function(){spyOnEvent(this.$node,"dataPromptbirdPromptDismissed"),ajaxRespondWithSuccess({}),this.component.trigger("uiPromptbirdDismissPrompt",{prompt_id:8}),expect("dataPromptbirdPromptDismissed").toHaveBeenTriggeredOn(this.component)}),it("triggers dataPromptbirdPromptDismissalError when uiPromptbirdDismissPrompt called, failure",function(){spyOnEvent(this.$node,"dataPromptbirdPromptDismissalError"),ajaxRespondWithError({}),this.component.trigger("uiPromptbirdDismissPrompt",{prompt_id:8}),expect("dataPromptbirdPromptDismissalError").toHaveBeenTriggeredOn(this.component)}),it("makes the ajax call to the correct url with the correct params",function(){ajaxRespondWithSuccess({}),this.component.trigger("uiPromptbirdDismissPrompt",{prompt_id:8});var a=$.ajax.mostRecentOptions;expect(a.url).toEqual("/users/dismiss_prompt"),expect(a.data.prompt_id).toEqual(8)})}),describe("event uiPromptbirdClick",function(){it("triggers dataPromptbirdPromptClick when uiPromptbirdClick called, success",function(){spyOnEvent(this.$node,"dataPromptbirdPromptClicked"),ajaxRespondWithSuccess({}),this.component.trigger("uiPromptbirdClick",{prompt_id:8}),expect("dataPromptbirdPromptClicked").toHaveBeenTriggeredOn(this.component)}),it("triggers dataPromptbirdPromptClickError when uiPromptbirdClick called, failure",function(){spyOnEvent(this.$node,"dataPromptbirdPromptClickError"),ajaxRespondWithError({}),this.component.trigger("uiPromptbirdClick",{prompt_id:8}),expect("dataPromptbirdPromptClickError").toHaveBeenTriggeredOn(this.component)}),it("makes the ajax call to the correct url with the correct params",function(){ajaxRespondWithSuccess({}),this.component.trigger("uiPromptbirdClick",{prompt_id:8});var a=$.ajax.mostRecentOptions;expect(a.url).toEqual("/users/click_prompt"),expect(a.data.prompt_id).toEqual(8)})}),describe("event uiPromptbirdSetLanguage",function(){it("triggers dataPromptbirdLanguageChangeSuccess when uiPromptbirdSetLanguage called, success",function(){this.component.off("dataPromptbirdLanguageChangeSuccess"),spyOnEvent(this.$node,"dataPromptbirdLanguageChangeSuccess"),ajaxRespondWithSuccess({}),this.component.trigger("uiPromptbirdSetLanguage",{lang:"pl"}),expect("dataPromptbirdLanguageChangeSuccess").toHaveBeenTriggeredOn(this.component)}),it("triggers dataPromptbirdLanguageChangeFailure when uiPromptbirdSetLanguage called, failure",function(){spyOnEvent(this.$node,"dataPromptbirdLanguageChangeFailure"),ajaxRespondWithError({}),this.component.trigger("uiPromptbirdSetLanguage",{lang:"pl"}),expect("dataPromptbirdLanguageChangeFailure").toHaveBeenTriggeredOn(this.component)}),it("makes the ajax call to the correct url with the correct parameters",function(){this.component.off("dataPromptbirdLanguageChangeSuccess"),ajaxRespondWithSuccess({}),this.component.trigger("uiPromptbirdSetLanguage",{lang:"es"});var a=$.ajax.mostRecentOptions;expect(a.url).toEqual("/settings/account/set_language"),expect(a.data.lang).toEqual("es")})}),describe("event uiPromptbirdDoOneClickImport",function(){it("triggers dataPromptbirdDidOneClickImport when uiPromptbirdDoOneClickImport called",function(){spyOnEvent(this.$node,"dataPromptbirdDidOneClickImport"),this.component.trigger("uiPromptbirdDoOneClickImport",{url:"http://exmaple.com"}),expect("dataPromptbirdDidOneClickImport").toHaveBeenTriggeredOn(this.component)})})})
});
define("test/app/data/search_input_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/search_input_scribe",function(){beforeEach(function(){setupComponent()}),describe("event uiTypeaheadItemSelected",function(){describe("when an account is selected",function(){it("scribes the account, index and fetch type, and is categorized as a profile_click",function(){this.component.trigger("uiTypeaheadItemSelected",{index:0,source:"account",item:{origin:"remote"},query:"1001",input:"gaga",scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead",action:"profile_click"},{message:"gaga",items:[{id:"1001",item_type:3,position:0}],event_info:"remote"})})}),describe("when a topic is selected",function(){it("scribes the topic and index and is categorized as a topic search",function(){this.component.trigger("uiTypeaheadItemSelected",{index:0,source:"topics",query:"test",input:"test",scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead",action:"search"},{message:"test",items:[{item_query:"test",item_type:12,position:0}]})})}),describe("when a topic is autocompleted",function(){it("scribes the topic and 0 index and is categorized as a topic search",function(){this.component.trigger("uiTypeaheadItemComplete",{index:0,source:"topics",query:"test",input:"test",scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),this.component.trigger("uiSearchQuery",{query:"test",source:"search",scribeContext:{component:"top_bar_searchbox",element:""}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead",action:"search"},{message:"test",items:[{item_query:"test",item_type:12,position:0}]})}),it("scribes as a typed-in query and is NOT categorized as a topic search after editing autocompletion",function(){this.component.trigger("uiTypeaheadItemComplete",{index:0,source:"topics",query:"test",input:"test",scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),this.component.trigger("uiSearchQuery",{query:"tests",source:"search",scribeContext:{component:"top_bar_searchbox",element:""}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"",action:"search"},{items:[{item_query:"tests",item_type:12}]})})}),describe("when a search is typed in (not selected)",function(){it("scribes the search and index, and is categorized as search",function(){this.component.trigger("uiSearchQuery",{query:"test",source:"search",scribeContext:{component:"top_bar_searchbox",element:""}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"",action:"search"},{items:[{item_query:"test",item_type:12}]})})}),describe("when a saved search is selected",function(){it("scribes the search, typed search and index, and is categorized as search",function(){this.component.trigger("uiTypeaheadItemSelected",{index:0,source:"saved_search",query:"test",input:"te",scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead",action:"search"},{message:"te",items:[{item_query:"test",item_type:13,position:0}]})})}),describe("when a recent search is selected",function(){it("scribes the search, typed search and index, and is categorized as search",function(){this.component.trigger("uiTypeaheadItemSelected",{index:0,source:"recent_search",query:"test",input:"te",scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead",action:"search"},{message:"te",items:[{item_query:"test",item_type:12,position:0}]})})}),describe("when the search box is focused",function(){it("scribes a focus_field event",function(){this.component.trigger("uiSearchInputFocused",{scribeContext:{component:"top_bar_searchbox",element:""}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"",action:"focus_field"})})})})})
});
define("test/app/data/oembed_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/oembed_scribe",function(){beforeEach(function(){setupComponent()}),it("transforms dataOembedError into request_failed scribe",function(){this.component.trigger("dataOembedError",{}),expect(this.component).toScribe({component:"oembed",action:"request_failed"})}),it("transforms dataOembedRetry into retry scribe",function(){this.component.trigger("dataOembedRetry",{}),expect(this.component).toScribe({component:"oembed",action:"retry"})}),it("transforms dataOembedRequest into request scribe",function(){this.component.trigger("dataOembedRequest",{}),expect(this.component).toScribe({component:"oembed",action:"request"})}),it("transforms dataOembedSuccess into success scribe",function(){this.component.trigger("dataOembedSuccess",{}),expect(this.component).toScribe({component:"oembed",action:"success"})})})
});
define("test/app/data/tweet_box_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/tweet_box_scribe",function(){function a(a,b){a.attr.eventData={scribeContext:{component:"tweet_box",element:b}}}function b(a){return{component:"tweet_box",element:"lifeline_alerts",action:a}}function c(a){return{component:"tweet_box",element:"geo_picker",action:a}}function d(a){return{component:"tweet_box",element:"image_picker",action:a}}function e(a){return{component:"tweet_box",element:"tweet_box",action:a}}beforeEach(function(){setupComponent()}),it("scribes offer on a uiLifelineAlertsSelect event",function(){a(this.component,"lifeline_alerts"),this.component.trigger("uiLifelineAlertsSelect"),expect(this.component).toScribe(b("select"))}),it("scribes offer on a uiLifelineAlertsImpression event",function(){a(this.component,"lifeline_alerts"),this.component.trigger("uiLifelineAlertsImpression"),expect(this.component).toScribe(b("impression"))}),it("scribes offer on a uiLifelineAlertsTweet event",function(){a(this.component,"lifeline_alerts"),this.component.trigger("uiLifelineAlertsTweet"),expect(this.component).toScribe(b("tweet"))}),it("scribes offer on a uiLifelineAlertsCancel event",function(){a(this.component,"lifeline_alerts"),this.component.trigger("uiLifelineAlertsCancel"),expect(this.component).toScribe(b("cancel"))}),it("scribes offer on a uiGeoPickerOffer event",function(){a(this.component,"geo_picker"),this.component.trigger("uiGeoPickerOffer"),expect(this.component).toScribe(c("offer"))}),it("scribes enable on a uiGeoPickerEnable event",function(){a(this.component,"geo_picker"),this.component.trigger("uiGeoPickerEnable"),expect(this.component).toScribe(c("enable"))}),it("scribes open on a uiGeoPickerOpen event",function(){a(this.component,"geo_picker"),this.component.trigger("uiGeoPickerOpen"),expect(this.component).toScribe(c("open"))}),it("scribes on on a uiGeoPickerTurnOn event",function(){a(this.component,"geo_picker"),this.component.trigger("uiGeoPickerTurnOn"),expect(this.component).toScribe(c("on"))}),it("scribes off on a uiGeoPickerTurnOff event",function(){a(this.component,"geo_picker"),this.component.trigger("uiGeoPickerTurnOff"),expect(this.component).toScribe(c("off"))}),it("scribes focus_field on a uiGeoPickerInteraction event",function(){a(this.component,"geo_picker"),this.component.trigger("uiGeoPickerInteraction"),expect(this.component).toScribe(c("focus_field"))}),it("scribes select on a uiGeoPickerChange event",function(){a(this.component,"geo_picker"),this.component.trigger("uiGeoPickerChange",{scribeData:{item_names:["yo"],query:"foo"}}),expect(this.component).toScribe(c("select"),{item_names:["yo"],query:"foo"})}),it("scribes click on a uiImagePickerClick event",function(){a(this.component,"image_picker"),this.component.trigger("uiImagePickerClick"),expect(this.component).toScribe(d("click"))}),it("scribes click on a uiImagePickerAdd event",function(){a(this.component,"image_picker"),this.component.trigger("uiImagePickerAdd"),expect(this.component).toScribe(d("add"))}),it("scribes click on a uiImagePickerRemove event",function(){a(this.component,"image_picker"),this.component.trigger("uiImagePickerRemove"),expect(this.component).toScribe(d("remove"))}),it("scribes click on a uiImagePickerError event",function(){a(this.component,"image_picker"),this.component.trigger("uiImagePickerError",{scribeData:{message:"blah"}}),expect(this.component).toScribe(d("error"),{message:"blah"})}),it("scribes a drag and drop event",function(){a(this.component,"image_picker"),this.component.trigger("uiDrop"),expect(this.component).toScribe(d("drag_and_drop"))}),it("scribes click on a uiTweetboxTweetError event",function(){a(this.component,"tweet_box"),this.component.trigger("uiTweetboxTweetError"),expect(this.component).toScribe(e("failure"))}),it("scribes click on a uiTweetboxTweetSuccess event",function(){a(this.component,"tweet_box"),this.component.trigger("uiTweetboxTweetSuccess"),expect(this.component).toScribe(e("send_tweet"))}),it("scribes click on a uiTweetboxReplySuccess event",function(){a(this.component,"tweet_box"),this.component.trigger("uiTweetboxReplySuccess"),expect(this.component).toScribe(e("send_reply"))}),it("scribes click on a uiTweetboxDMSuccess event",function(){a(this.component,"tweet_box"),this.component.trigger("uiTweetboxDMSuccess"),expect(this.component).toScribe(e("send_dm"))})})
});
define("test/app/data/with_auth_token_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/data/with_auth_token",function(a){describe("without an auth token",function(){it("throws an error",function(){setupComponent({formAuthenticityToken:null}),expect(function(){component.addAuthToken({})}).toThrow()})}),describe("#addAuthToken",function(){it("adds the auth token to the passed object",function(){setupComponent();var a={foo:"bar"};expect(this.component.addAuthToken(a)).toEqual({foo:"bar",authenticity_token:"AUTHORIZED"})})}),describe("#addPHXAuthToken",function(){it("adds post_auth token if X-PHX header is set",function(){setupComponent();var a={foo:"bar"};expect(this.component.addPHXAuthToken(a)).toEqual({foo:"bar",post_authenticity_token:"AUTHORIZED"})})})})
});
define("test/app/data/signup_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponentWithDataComponents("app/ui/signup/signup_form",["app/data/signup_data","app/data/signup_scribe"],function(){describe("init",function(){it("reports bq checkbox state",function(){setupComponent(),expect(this.signupScribe).toScribe({component:"personalization",element:"checkbox",action:"off"})}),it("scribes javascript impression",function(){setupComponent(),expect(this.signupScribe).toScribe({component:"javascript",action:"impression"})})}),describe("responds to events",function(){beforeEach(function(){var a='<form id="phx-signup-form" method="POST">\n          <a id="bq-learn-more" href="#">bq learn more</a>\n          <input id="bq-checkbox" type="checkbox"/>\n          <button id="suggest"></button>\n          <span class="holding" data-fieldname="bananas"><input id="banana"></button>\n          <input type="submit" class="signup-btn" value="Create my account">\n        </form>\n      ';setupComponent(a,{bqLearnMoreSelector:"#bq-learn-more",bqSelector:"#bq-checkbox",suggestionSelector:"button#suggest",signupContext:"context"})}),it("scribes bq link clicks",function(){$("#bq-learn-more").click(),expect(this.signupScribe).toScribe({component:"personalization",element:"support_link",action:"click"})}),it("scribes bq checkbox clicks",function(){$("#bq-checkbox").click(),expect(this.signupScribe).toScribe({component:"personalization",element:"checkbox",action:"deselect"}),$("#bq-checkbox").click(),expect(this.signupScribe).toScribe({component:"personalization",element:"checkbox",action:"select"})}),it("scribes validation failures",function(){this.component.trigger("uiValidated",{field:"username",valid:!0,quick:!0}),expect(this.signupScribe).not.toScribe({component:"personalization",element:"screen_name",action:"validation_error"}),this.component.trigger("uiValidated",{field:"username",valid:!1,quick:!1}),expect(this.signupScribe).toScribe({component:"personalization",element:"screen_name",action:"validation_error"})}),it("scribes suggestion clicks",function(){$("button#suggest").click(),expect(this.signupScribe).toScribe({component:"form",element:"suggestion",action:"click"})}),it("scribes captcha shows",function(){this.component.trigger("uiCaptchaShown"),expect(this.signupScribe).toScribe({component:"form",element:"captcha",action:"impression"})}),it("scribes field touches",function(){this.$node.find("#banana").trigger("uiFieldTouched"),expect(this.signupScribe).toScribe({component:"form",element:"bananas",action:"focus_field"})}),it("scribes email autocorrect impressions",function(){this.component.trigger("uiShowingEmailCorrection"),expect(this.signupScribe).toScribe({component:"form",element:"email_autocorrect",action:"impression"})}),it("scribes email autocorrect clicks",function(){this.component.trigger("uiCorrectEmailClicked"),expect(this.signupScribe).toScribe({component:"form",element:"email_autocorrect",action:"click"})}),it("scribes signup button clicks",function(){this.$node.find(".signup-btn").click(),expect(this.signupScribe).toScribe({component:"form",element:"signup_button",action:"click"})})})})
});
define("test/app/data/profile_popup_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/profile_popup_scribe",function(){var a="5",b="6";beforeEach(function(){setupComponent(),this.triggerProfilePopupOpen=function(b){this.component.trigger("dataProfilePopupSuccess",{user_id:a,sourceEventData:b})},this.triggerProfilePopupClose=function(b){this.component.trigger("uiCloseProfilePopup",{user_id:a,sourceEventData:b})}}),afterEach(function(){delete this.component.clientEvent.profile_id}),it("scribes the opening of the profile popup dialog",function(){this.triggerProfilePopupOpen({}),expect(this.component).toScribe({component:"profile_dialog",action:"open"}),expect(this.component.clientEvent.scribeData.profile_id).toBe(a)}),it("handles the closing of the profile popup dialog",function(){this.triggerProfilePopupClose({}),expect(this.component.clientEvent.scribeData.profile_id).not.toBeDefined()}),it("scribes a profile page profile_id rather than the popup profile_id",function(){this.component.clientEvent.scribeContext.page="profile",this.component.clientEvent.scribeData.profile_id=b,this.triggerProfilePopupOpen({}),expect(this.component).toScribe({component:"profile_dialog",action:"open"}),expect(this.component.clientEvent.scribeData.profile_id).toBe(b)})})
});
define("test/app/data/notification_listener_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/notification_listener",function(){describe("NotificationListener",function(){beforeEach(function(){setupComponent({notifications_dm:!0})}),it("is initialized",function(){var a=this.component.notifications;expect(a).toBeDefined(),expect(a.initialized).toBe(!0),expect(a.entries.length).toBe(3),expect(a.dm.active).toBe(!0)}),it("responds to uiResetDMPoll",function(){var a=this.component.notifications,b=a.dm.timestamp;this.$node.trigger("uiResetDMPoll",{}),expect(b<a.dm.timestamp).toBe(!0)}),it("responds to uiPollForNotifications",function(){spyOnEvent(document,"uiDMPoll"),this.component.trigger("uiPollForNotifications"),expect("uiDMPoll").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/notifications_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/data/notifications",function(){describe("common cases",function(){beforeEach(function(){this.notifications=this.Module,this.notifications.init({notifications_dm:!0})}),it("adds DM data",function(){var a={};this.notifications.addDMData(a),expect(a.hasOwnProperty("oldest_unread_id")).toBe(!0)}),it("updates poll state",function(){var a=this.notifications.dm.timestamp;this.notifications.updateNotificationState({d:{status:"ok",response:"1"},notCached:!0}),expect(this.notifications.dm.timestamp>a).toBe(!0)}),it("does not update poll state for canceled responses",function(){var a=this.notifications.dm.timestamp;this.notifications.updateNotificationState({d:{status:"canceled",response:{}},notCached:!0}),expect(this.notifications.dm.timestamp==a).toBe(!0)}),it("does not update poll state for null responses",function(){var a=this.notifications.dm.timestamp;this.notifications.updateNotificationState({d:{status:"ok",response:null},notCached:!0}),expect(this.notifications.dm.timestamp==a).toBe(!0)}),it("does not update poll state for stale responses",function(){var a=this.notifications.dm.timestamp;this.notifications.updateNotificationState({d:{status:"ok",response:"1"},notCached:!1}),expect(this.notifications.dm.timestamp==a).toBe(!0)}),it("adds DM request parameters",function(){function a(a){var b=this.notifications.extraParameters(a);expect(b.hasOwnProperty("oldest_unread_id")).toBe(!0)}["/i/timeline","/i/connect/timeline","/i/discover/timeline","/i/search/timeline?type=relevance&q=hmm","/i/users/recommendations","/i/profiles/show/jack/timeline","/messages"].forEach(a.bind(this))}),it("does not add DM request parameters for any URL",function(){var a=this.notifications.extraParameters("/i/foo");expect(a.hasOwnProperty("oldest_unread_id")).toBe(!1)}),it("triggers a poll if the first response it gets has failed",function(){spyOnEvent(document,"uiDMPoll"),this.notifications.dm.update({d:{status:"canceled"},notCached:!0}),expect("uiDMPoll").toHaveBeenTriggeredOn(document)}),it("does not trigger a poll if the first response it gets is ok",function(){spyOnEvent(document,"uiDMPoll"),this.notifications.dm.update({d:{status:"ok",response:{}},notCached:!0}),expect("uiDMPoll").not.toHaveBeenTriggeredOn(document)}),it("has a default poll scale",function(){expect(this.notifications.getPollDelay()).toBe(2e4)})}),describe("overridden poll delay",function(){beforeEach(function(){this.notifications=this.Module,this.notifications.init({notifications_dm:!0,notifications_dm_poll_scale:90})}),it("has an overridden poll scale",function(){expect(this.notifications.getPollDelay()).toBe(9e4)})})})
});
define("test/app/data/promoted_logger_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/promoted_logger",function(){function a(a,b,c,d){var e=["promoted","earned"];for(var f=0;f<e.length;f++){var g=e[f];c.disclosureType=g,a[b]({},c),expect($.ajax.mostRecentOptions.data.impression_id).toBe(c.impressionId),expect($.ajax.mostRecentOptions.data.earned).toBe(g=="earned"),expect($.ajax.mostRecentOptions.data.event).toBe(d)}}function b(a,b,c,d,e,f){var g=[[c,!1],[d,!0]];for(var h=0;h<g.length;h++){var i=g[h][0],j=g[h][1];a[b]({target:i.find(".expand-link")[0]}),expect($.ajax.mostRecentOptions.async).toBe(!1),expect($.ajax.mostRecentOptions.data.event).toBe(f),expect($.ajax.mostRecentOptions.data.impression_id).toBe(e),expect($.ajax.mostRecentOptions.data.earned).toBe(j)}}beforeEach(function(){setupComponent()}),describe("logPromotedTrendImpression()",function(){it("does not log an event when there is no promoted trend",function(){this.component.logPromotedTrendImpression({},{items:[]}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("sends a promoted trend id with event i",function(){var a={items:[{name:"#promotedtrend",promotedTrendId:1},{name:"normal trend"}]};this.component.logPromotedTrendImpression({},a),expect($.ajax.mostRecentOptions.data.promoted_trend_id).toBe(a.items[0].promotedTrendId),expect($.ajax.mostRecentOptions.data.event).toBe("i")}),it("does not log an event when the source of the impression was a clock event",function(){var a={items:[{name:"#promotedtrend",promotedTrendId:1},{name:"normal trend"}],source:"clock"};this.component.logPromotedTrendImpression({},a),expect($.ajax.mostRecentOptions).toBeUndefined()})}),describe("logPromotedTrendClick()",function(){var a;beforeEach(function(){a={name:"#promotedtrend",promotedTrendId:1}}),it("sends a promoted trend id with event c",function(){this.component.logPromotedTrendClick({},a),expect($.ajax.mostRecentOptions.data.promoted_trend_id).toBe(a.promotedTrendId),expect($.ajax.mostRecentOptions.data.event).toBe("c")}),it("makes a synchronous request",function(){this.component.logPromotedTrendClick({},a),expect($.ajax.mostRecentOptions.async).toBe(!1)})}),describe("logPromotedTweetImpression()",function(){var a;beforeEach(function(){a={tweets:[{text:"setting up my twttr"}]}}),it("does not log an event if there are no promoted tweets",function(){this.component.logPromotedTweetImpression({},a),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs an impression if there is a promoted tweet",function(){var b={impressionId:"an impression id"};a.tweets.push(b),this.component.logPromotedTweetImpression({},a),expect($.ajax.mostRecentOptions.data.impression_id).toBe(b.impressionId),expect($.ajax.mostRecentOptions.data.earned).toBe(!1),expect($.ajax.mostRecentOptions.data.event).toBe("impression")}),it("logs multiple impressions if there are multiple promoted tweets",function(){var b=[{impressionId:"an impression id 1"},{impressionId:"an impression id 2"}];a.tweets=a.tweets.concat(b);var c=spyOn(this.component,"logEvent");this.component.logPromotedTweetImpression({},a),expect(c.callCount).toBe(2)}),it("logs impression as earned if the tweet is earned",function(){var b={impressionId:"an impression id",disclosureType:"earned"};a.tweets.push(b),this.component.logPromotedTweetImpression({},a),expect($.ajax.mostRecentOptions.data.impression_id).toBe(b.impressionId),expect($.ajax.mostRecentOptions.data.earned).toBe(!0),expect($.ajax.mostRecentOptions.data.event).toBe("impression")})}),describe("logPromotedUserImpression()",function(){var a;beforeEach(function(){a={users:[{id:12}]}}),it("does not log an event if there are no promoted users",function(){this.component.logPromotedUserImpression({},a),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs an impression if there is a promoted user",function(){var b={impressionId:"an impression id"};a.users.push(b),this.component.logPromotedUserImpression({},a),expect($.ajax.mostRecentOptions.data.impression_id).toBe(b.impressionId),expect($.ajax.mostRecentOptions.data.event).toBe("impression")}),it("logs multiple impressions if there are multiple promoted users",function(){var b=[{impressionId:"an impression id 1"},{impressionId:"an impression id 2"}];a.users=a.users.concat(b);var c=spyOn(this.component,"logEvent");this.component.logPromotedUserImpression({},a),expect(c.callCount).toBe(2)})}),describe("logPromotedUserClick()",function(){var b;beforeEach(function(){b={isAvatarClick:!1,isAtReplyClick:!1,impressionId:"an impression id"}}),it("does not log an event if there is no impressionId",function(){b.impressionId=undefined,this.component.logPromotedUserClick({},b),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs a profile_image_click event if profileClickTarget == 'avatar'",function(){b.profileClickTarget="avatar",a(this.component,"logPromotedUserClick",b,"profile_image_click")}),it("logs a user_mention_click event if isMentionClick is true",function(){b.isMentionClick=!0,a(this.component,"logPromotedUserClick",b,"user_mention_click")}),it("logs a footer_profile event if isPromotedBadgeClick is true",function(){b.isPromotedBadgeClick=!0,this.component.logPromotedUserClick({},b),a(this.component,"logPromotedUserClick",b,"footer_profile")}),it("logs a screen_name_click event if all other click types are false",function(){this.component.logPromotedUserClick({},b),a(this.component,"logPromotedUserClick",b,"screen_name_click")})}),describe("logPromotedTweetDetails()",function(){it("does not log an event if there is no impressionId",function(){this.component.logPromotedTweetDetails({},{impressionId:undefined}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs a show_details event if the element's parent has a data-impression-id",function(){var b="an impression id";a(this.component,"logPromotedTweetDetails",{impressionId:b},"view_details")})}),describe("logPromotedTweetShareViaEmail()",function(){it("does not log an event if there is no impressionId",function(){this.component.logPromotedTweetShareViaEmail({},{impressionId:undefined}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs a email_tweet event if sharing a promoted tweet",function(){var b="an impression id";a(this.component,"logPromotedTweetShareViaEmail",{impressionId:b},"email_tweet")})}),describe("logPromotedTweetDismiss()",function(){it("does not log an event if there is no impressionId",function(){this.component.logPromotedTweetDismiss({},{impressionId:undefined}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs a dismiss event if there is an impressionId",function(){var a="an impression id";this.component.logPromotedTweetDismiss({},{impressionId:a}),expect($.ajax.mostRecentOptions.data.event).toBe("dismiss"),expect($.ajax.mostRecentOptions.data.impression_id).toBe(a)})}),describe("logPromotedUserDismiss()",function(){it("does not log an event if there is no impressionId",function(){this.component.logPromotedUserDismiss({},{impressionId:undefined}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs a dismiss event if there is an impressionId",function(){var a="an impression id";this.component.logPromotedUserDismiss({},{impressionId:a}),expect($.ajax.mostRecentOptions.data.event).toBe("dismiss"),expect($.ajax.mostRecentOptions.data.impression_id).toBe(a)})}),describe("logPromotedTweetLinkClick()",function(){var a,c,d,e;beforeEach(function(){e="an impression id",linkAddr="http://t.co/foobar/",c=$(["<div class='tweet' data-impression-id='",e,"'>","<div class='expand-link'>Expand</div>","<a href='",linkAddr,"' class='twitter-timeline-link'>","</div>"].join("")),d=$("<div data-disclosure-type='earned' data-impression-id='"+e+"'><div class='expand-link'>Expand</div></div>"),a=$("<div><div class='expand-link'>Expand</div></div>")}),it("does not log an event if there is no impressionId",function(){this.component.logPromotedTweetLinkClick({target:a.find(".expand-link")[0]}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs a url_click event if the element's parent has a data-impression-id",function(){b(this.component,"logPromotedTweetLinkClick",c,d,e,"url_click")}),it("logs the target url for PTw",function(){this.component.logPromotedTweetLinkClick({target:c.find(".twitter-timeline-link")[0]}),expect($.ajax.mostRecentOptions.data.url).toBe(linkAddr)})}),describe("logPromotedTweetCardUrlClick()",function(){it("does not log an event if there is no impressionId",function(){this.component.logPromotedTweetCardUrlClick({},{impressionId:undefined}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs a card_url_click event if the element's parent has a data-impression-id",function(){var b="an impression id";a(this.component,"logPromotedTweetCardUrlClick",{impressionId:b},"card_url_click")})}),describe("logPromotedTweetEmbeddedMedia()",function(){it("does not log an event if there is no impressionId",function(){this.component.logPromotedTweetEmbeddedMedia({},{impressionId:undefined}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs a embedded_media event if the element's parent has a data-impression-id",function(){var b="an impression id";a(this.component,"logPromotedTweetEmbeddedMedia",{impressionId:b},"embedded_media")})}),describe("logPromotedTweetHashtagClick()",function(){var a,c,d,e;beforeEach(function(){e="an impression id",c=$("<div data-impression-id='"+e+"'><div class='expand-link'>Expand</div></div>"),d=$("<div data-disclosure-type='earned' data-impression-id='"+e+"'><div class='expand-link'>Expand</div></div>"),a=$("<div><div class='expand-link'>Expand</div></div>")}),it("does not log an event if there is no impressionId",function(){this.component.logPromotedTweetHashtagClick({target:a.find(".expand-link")[0]}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("logs a hashtag_click event if the element's parent has a data-impression-id",function(){b(this.component,"logPromotedTweetHashtagClick",c,d,e,"hashtag_click")})}),describe("logEvent()",function(){it("makes an AJAX request to the logging endpoint with the provided params",function(){var a={name:"Larry",type:"bird"};this.component.logEvent(a),expect($.ajax.mostRecentOptions.data.name).toBe(a.name),expect($.ajax.mostRecentOptions.data.type).toBe(a.type),expect($.ajax.mostRecentOptions.headers["X-PHX"]).toBe(!0)}),it("triggers dataLogEventSuccess after a successful request",function(){spyOnEvent(document,"dataLogEventSuccess"),this.component.logEvent(),$.ajax.mostRecentOptions.success({}),expect("dataLogEventSuccess").toHaveBeenTriggeredOn(document)}),it("doesn't allow cancellation on pushstate navigation",function(){spyOnEvent(document,"dataLogEventSuccess");var a=jasmine.createSpy('"Abort XHR on pushstate navigation"');ajaxReturnXHRObject({abort:a}),this.component.logEvent(),this.component.abortAllXHR(),expect(a).not.toHaveBeenCalled(),$.ajax.mostRecentOptions.success({}),expect("dataLogEventSuccess").toHaveBeenTriggeredOn(document)}),it("triggers dataLogEventError after a failed request",function(){spyOnEvent(document,"dataLogEventError"),this.component.logEvent(),$.ajax.mostRecentOptions.error({responseText:"{}"}),expect("dataLogEventError").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/lists_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/lists",function(){beforeEach(function(){setupComponent()}),describe("event uiNeedsListMembershipContent",function(){it("makes ajax request to list membership endpoint",function(){this.component.trigger("uiNeedsListMembershipContent",{userId:12}),expect($.ajax.mostRecentOptions.url).toBe("/i/12/lists"),expect($.ajax.mostRecentOptions.type).toEqual("GET")}),it("triggers dataGotListMembershipContent, success case",function(){spyOnEvent(document,"dataGotListMembershipContent"),ajaxRespondWithSuccess({html:"html"}),this.component.trigger("uiNeedsListMembershipContent",{userId:12}),expect("dataGotListMembershipContent").toHaveBeenTriggeredOnAndWith(document,{html:"html"})}),it("triggers dataFailedToGetListMembershipContent, error case",function(){spyOnEvent(document,"dataFailedToGetListMembershipContent"),ajaxRespondWithError({}),this.component.trigger("uiNeedsListMembershipContent",{userId:12}),expect("dataFailedToGetListMembershipContent").toHaveBeenTriggeredOn(document)})}),describe("event uiAddUserToList",function(){it("makes ajax request to add list endpoint",function(){this.component.trigger("uiAddUserToList",{userId:12,listId:13}),expect($.ajax.mostRecentOptions.url).toBe("/i/12/lists/13/members"),expect($.ajax.mostRecentOptions.type).toEqual("POST")}),it("triggers dataDidAddUserToList, success case",function(){spyOnEvent(document,"dataDidAddUserToList"),ajaxRespondWithSuccess({}),this.component.trigger("uiAddUserToList",{userId:12,listId:13}),expect("dataDidAddUserToList").toHaveBeenTriggeredOn(document)}),it("triggers dataFailedToAddUserToList, error case",function(){spyOnEvent(document,"dataFailedToAddUserToList"),ajaxRespondWithError({}),this.component.trigger("uiAddUserToList",{userId:12}),expect("dataFailedToAddUserToList").toHaveBeenTriggeredOn(document)})}),describe("event uiRemoveUserFromList",function(){it("makes ajax request to remove list endpoint",function(){this.component.trigger("uiRemoveUserFromList",{userId:12,listId:13}),expect($.ajax.mostRecentOptions.url).toEqual("/i/12/lists/13/members"),expect($.ajax.mostRecentOptions.data._method).toEqual("DELETE"),expect($.ajax.mostRecentOptions.type).toEqual("POST")}),it("triggers dataDidRemoveUserFromList, success case",function(){spyOnEvent(document,"dataDidRemoveUserFromList"),ajaxRespondWithSuccess({}),this.component.trigger("uiRemoveUserFromList",{userId:12,listId:13}),expect("dataDidRemoveUserFromList").toHaveBeenTriggeredOn(document)}),it("triggers dataFailedToRemoveUserFromList, error case",function(){spyOnEvent(document,"dataFailedToRemoveUserFromList"),ajaxRespondWithError({}),this.component.trigger("uiRemoveUserFromList",{userId:12,listId:13}),expect("dataFailedToRemoveUserFromList").toHaveBeenTriggeredOn(document)})}),describe("event uiCreateList",function(){it("makes ajax request to create list endpoint",function(){var a={name:"list",description:"description",mode:"public"};this.component.trigger("uiCreateList",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/lists/create"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.data).toEqual(this.authToken.addTo(a))}),it("triggers dataDidCreateList, success case",function(){spyOnEvent(document,"dataDidCreateList"),ajaxRespondWithSuccess({}),this.component.trigger("uiCreateList",{name:"list"}),expect("dataDidCreateList").toHaveBeenTriggeredOn(document)}),it("triggers dataFailedToCreateList, error case",function(){spyOnEvent(document,"dataFailedToCreateList"),ajaxRespondWithError({}),this.component.trigger("uiCreateList",{name:"list"}),expect("dataFailedToCreateList").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/frontpage_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/frontpage_scribe",function(){var a="42",b={item_count:1,item_ids:[a]};beforeEach(function(){var a='<div>\n  <form class="signin">\n    <input type="submit">\n  </form>\n  <form class="signup">\n    <input type="submit">\n  </form>\n  <form class="language">\n    <input type="submit">\n  </form>\n  <form class="search">\n    <input type="submit">\n  </form>\n  <a class="signup-welcome-link"></a>\n  <a class="store-button app-store"></a>\n  <a class="store-button google-play"></a>\n</div>\n    ';setupComponent(a),this.$node.on("submit",function(a){a.preventDefault()})}),it("scribes signin form submit",function(){this.$node.find(".signin input").click(),expect(this.component).toScribe({component:"login_callout",element:"form",action:"login_click"})}),it("scribes signup form submit",function(){this.$node.find(".signup input").click(),expect(this.component).toScribe({component:"signup_callout",element:"form",action:"signup_click"})}),it("scribes language form submit",function(){this.$node.find(".language input").click(),expect(this.component).toScribe({component:"footer",element:"language_selector",action:"select"})}),it("scribes search form submit",function(){this.$node.find(".search input").click(),expect(this.component).toScribe({component:"main",element:"search_field",action:"search"})}),it("scribes signup welcome link",function(){this.$node.find(".signup-welcome-link").click(),expect(this.component).toScribe({component:"lifeline",element:"welcome_text",action:"signup_click"})}),it("scribes app store link",function(){this.$node.find(".app-store").click(),expect(this.component).toScribe({page:"ddg",section:"lohp_mobile_callout_redux2_1004",element:"app_store_button_click",action:"track"})}),it("scribes google play link",function(){this.$node.find(".google-play").click(),expect(this.component).toScribe({page:"ddg",section:"lohp_mobile_callout_redux2_1004",element:"google_play_button_click",action:"track"})})})
});
define("test/app/data/gallery_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/gallery_scribe",function(){beforeEach(function(){setupComponent()}),describe("event uiGalleryOpened",function(){it("scribes gallery being opened",function(){this.component.trigger("uiGalleryOpened"),expect(this.component).toScribe({action:"open",element:"gallery"})})}),describe("event uiGalleryClosed",function(){it("scribes gallery being closed",function(){this.component.trigger("uiGalleryClosed"),expect(this.component).toScribe({action:"close",element:"gallery"})})}),describe("event uiGalleryMediaLoaded",function(){it("scribes gallery media loaded",function(){this.component.trigger("uiGalleryMediaLoaded",{url:"http://blah",id:"1234"}),expect(this.component).toScribe({action:"impression",element:"photo"},{url:"http://blah",item_ids:["1234"]})})}),describe("event uiGalleryMediaFailed",function(){it("scribes gallery media failed to load",function(){this.component.trigger("uiGalleryMediaFailed",{url:"http://blah",id:"1234"}),expect(this.component).toScribe({action:"error",element:"photo"},{url:"http://blah",item_ids:["1234"]})})}),describe("event uiGalleryNavigateNext",function(){it("scribes gallery being navigated next",function(){this.component.trigger("uiGalleryNavigateNext"),expect(this.component).toScribe({action:"click",element:"next"})})}),describe("event uiGalleryNavigatePrev",function(){it("scribes gallery being navigated prev",function(){this.component.trigger("uiGalleryNavigatePrev"),expect(this.component).toScribe({action:"click",element:"prev"})})}),describe("event uiGridPaged",function(){it("scribes grid being paged",function(){this.component.trigger("uiGridPaged"),expect(this.component).toScribe({action:"page",element:"grid"})})}),describe("event uiGridOpened",function(){it("scribes grid being opened",function(){this.component.trigger("uiGridOpened"),expect(this.component).toScribe({action:"impression",element:"grid"})})})})
});
define("test/app/data/who_to_follow_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/who_to_follow_scribe",function(){var a=[{id:"1",feedbackToken:"token",impressionId:"p"},{id:"2",feedbackToken:"token1"},{id:"3",feedbackToken:"token2"}],b;beforeEach(function(){var c=function(a,b){return b=b||{},"<div class='js-actionable-user' data-user-id='"+a+"' "+d(b)+" "+e(b)+"></div>"},d=function(a){return a.impressionId?"data-impression-id='"+a.impressionId+"'":""},e=function(a){return a.feedbackToken?"data-feedback-token='"+a.feedbackToken+"'":""},f=function(a){var b="";return a.each(function(a,c){b+=$(c).clone().wrap("<div>").parent().html()}),b};this.triggerDismissEvent=function(a,b){var c=$(".js-actionable-user").index($(".js-actionable-user[data-user-id='"+a.id+"']"));this.component.trigger("uiDidDismissUserRecommendation",{scribeContext:{component:"user_recommendations"},oldUser:{userId:a.id,feedbackToken:a.feedbackToken,impressionId:a.impressionId,position:c,itemType:"user"},newUser:b&&{userId:b.id,feedbackToken:b.feedbackToken,impressionId:b.impressionId,position:c,itemType:"user"}})},this.triggerRefreshEvent=function(a){this.component.trigger("uiDidGetRecommendations",{initialResults:a,sourceEventData:{refreshType:"click",scribeContext:{component:"user_recommendations"}}})},b="",a.forEach(function(a){b+=c(a.id,a)}),b="<div class='js-recommended-followers'>"+b+"<div>"}),describe("on load/dismiss/refresh",function(){var c,d;beforeEach(function(){setupComponent(b),c=a[0],d=a[1]}),it("scribes impression",function(){this.triggerRefreshEvent(!0),expect(this.component).toScribe({action:"impression"})}),it("scribes on dismissing a promoted user recommendation from the wtf dashboard",function(){this.triggerDismissEvent(c);var a={items:[{id:c.id,item_type:3,promoted_id:c.impressionId,token:c.feedbackToken,position:0}],promoted:!0};expect(this.component).toScribe({action:"dismiss"},a)}),it("scribes on dismissing a non-promoted user recommendation from the wtf dashboard",function(){this.triggerDismissEvent(d);var a={items:[{id:d.id,item_type:3,position:1,token:d.feedbackToken}]};expect(this.component).toScribe({action:"dismiss"},a)}),it("scribes on getting the next promoted user recommendation on the wtf dashboard ",function(){this.triggerDismissEvent(d,c);var a={items:[{id:c.id,item_type:3,promoted_id:c.impressionId,token:c.feedbackToken,position:1}],referring_event:"replace",promoted:!0};expect(this.component).toScribe({action:"results"},a)}),it("scribes on getting the next non-promoted recommendation on the wtf dashboard ",function(){this.triggerDismissEvent(c,d);var a={items:[{id:d.id,item_type:3,token:d.feedbackToken,position:0}],referring_event:"replace"};expect(this.component).toScribe({action:"results"},a)}),it("scribes on refreshing user recommendations from the wtf dashboard",function(){this.triggerRefreshEvent();var b={referring_event:"newer",promoted:!0},c=[];a.forEach(function(a,b){var d={id:a.id,item_type:3,token:a.feedbackToken,position:b};a.impressionId&&(d.promoted_id=a.impressionId),c.push(d)}),b.items=c,expect(this.component).toScribe({component:"user_recommendations",element:"newer",action:"results"},b),expect(this.component).toScribe({component:"user_recommendations",action:"refresh"},{event_info:"click"})}),it("scribes on getting no recommendations initially",function(){this.component.trigger("uiGotEmptyRecommendationsResponse",{initialResults:!0}),expect(this.component).toScribe({action:"no_results",element:"initial"})}),it("scribes on getting no recommendations on refresh",function(){this.component.trigger("uiGotEmptyRecommendationsResponse",{initialResults:!1}),expect(this.component).toScribe({action:"no_results",element:"newer"}),expect(this.component).toScribe({action:"refresh"})}),it("does not scribe an impression on getting no recommendations",function(){this.component.trigger("uiGotEmptyRecommendationsResponse",{initialResults:!0}),expect(this.component).not.toScribe({action:"impression"})})})})
});
define("test/app/data/with_conversation_metadata_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/data/with_conversation_metadata",function(){var a="<div></div>\n  ",b="<div class='conversation-module' data-ancestors='123,456,789'>\n    <div class='tweet has-conversation-module'>\n    </div>\n  </div>\n  ";describe("getConversationAttrs",function(){var c;describe("without conversation module",function(){beforeEach(function(){setupComponent(a)}),it("returns an empty object",function(){c=this.component.getConversationAttrs(this.$node),expect(c).toEqual({})})}),describe("with conversation module",function(){beforeEach(function(){setupComponent(b);var a=this.$node.find(".has-conversation-module");c=this.component.getConversationAttrs(a)}),it("returns an object with isConversation true",function(){expect(c.isConversation).toBe(!0)}),it("returns an object with an array of conversation ancestors",function(){expect(c.conversationAncestors).toEqual(["123","456","789"])})})})})
});
define("test/app/data/related_tweets_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/related_tweets",function(){beforeEach(setupComponent),describe('event "uiGetRelatedTweets"',function(){it("does not make a GET request if no ID is specified",function(){this.component.trigger("uiGetRelatedTweets"),expect($.ajax).not.toHaveBeenCalled()}),it("makes the GET request if an id is specified",function(){this.component.trigger("uiGetRelatedTweets",{id:5}),expect($.ajax.mostRecentOptions.url).toEqual("/i/related_tweets?id=5")}),it("triggers 'dataGotRelatedTweets' on success",function(){spyOnEvent(document,"dataGotRelatedTweets"),ajaxRespondWithSuccess({items_html:"<div>Giggity</div>"}),this.component.trigger("uiGetRelatedTweets",{id:5}),expect("dataGotRelatedTweets").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/list_members_dashboard_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/list_members_dashboard",function(){function a(a){beforeEach(function(){spyOnEvent(document,"dataGotNewListMembers"),spyOnEvent(document,"dataFailedToGetNewListMembers"),this.triggerEvent=function(b){this.component.trigger(a,{sourceEventData:{listId:b}})}}),describe("on dashboard list",function(){beforeEach(function(){}),it("makes an ajax call",function(){this.triggerEvent(13),expect($.ajax.mostRecentOptions.url).toBe("/suggesteduserli/sports/members/newest")}),it("triggers dataGotNewListMembers on success",function(){ajaxRespondWithSuccess({newest_members_html:"html",follow_card_html:"html"}),this.triggerEvent(13),expect("dataGotNewListMembers").toHaveBeenTriggeredOnAndWith(document,{newest_members_html:"html",follow_card_html:"html"})}),it("triggers dataFailedToGetNewListMembers on failure",function(){ajaxRespondWithError({}),this.triggerEvent(13),expect("dataFailedToGetNewListMembers").toHaveBeenTriggeredOn(document)})}),describe("on other list",function(){it("does not make an ajax call",function(){this.triggerEvent(12),expect($.ajax.mostRecentOptions).toBeUndefined()})})}beforeEach(function(){setupComponent({list_id:13,newest_members_url:"/suggesteduserli/sports/members/newest"})}),describe("event dataDidAddUserToList",function(){a("dataDidAddUserToList")}),describe("event dataDidRemoveUserFromList",function(){a("dataDidRemoveUserFromList")})})
});
define("test/app/data/profile_canopy_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/profile_canopy_scribe",function(){it("scribes the display of the profile canopy bar",function(){setupComponent(),this.component.trigger("uiShowProfileCanopy"),expect(this.component).toScribe({component:"profile_canopy",action:"impression"})})})
});
define("test/app/data/permalink_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/permalink_scribe",function(){beforeEach(function(){setupComponent('<div><div class="tweet"></div></div>')}),describe("#scribePermalinkImpression",function(){beforeEach(function(){spyOn(this.component,"scribeCardInteraction")}),it("should not do anything if a card is not present",function(){var a={tweetHasCard:!1};spyOn(this.component,"getCardDataFromTweet").andReturn(a),this.component.scribePermalinkImpression(),expect(this.component.scribeCardInteraction).not.toHaveBeenCalled()}),it("should scribe if a card is present",function(){var a={tweetHasCard:!0,cardType:"photo"};spyOn(this.component,"getCardDataFromTweet").andReturn(a),this.component.scribePermalinkImpression(),expect(this.component.scribeCardInteraction).toHaveBeenCalledWith("show",a)})})})
});
define("test/app/data/login_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/login_scribe",function(){beforeEach(function(){setupComponent()}),it("scribes signup footer link clicks",function(){this.component.trigger("uiSignupLinkClicked"),expect(this.component).toScribe({component:"signup_callout",element:"signup_link",action:"click"})})})
});
define("test/app/data/search_assistance_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/search_assistance_scribe",function(){beforeEach(function(){setupComponent()}),describe("event uiSearchAssistanceAction",function(){it("scribes action",function(){this.component.trigger("uiSearchAssistanceAction",{component:"spelling_corrections",action:"dismiss",query:"obamma",item_names:["barack obama"]}),expect(this.component).toScribe({section:"universal_top",component:"spelling_corrections",action:"dismiss"},{query:"obamma",item_names:["barack obama"]})})})})
});
define("test/app/data/temporary_password_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/temporary_password",function(){beforeEach(function(){setupComponent()}),describe("event uiGenerateTemporaryPassword",function(){it("makes ajax request to temporary password endpoint",function(){this.component.trigger("uiGenerateTemporaryPassword"),expect($.ajax.mostRecentOptions.url).toBe("/account/login_verification/temporary_password.json"),expect($.ajax.mostRecentOptions.type).toEqual("POST")}),it("triggers dataTemporaryPasswordGenerated, success case",function(){spyOnEvent(document,"dataTemporaryPasswordGenerated"),ajaxRespondWithSuccess({html:"html"}),this.component.trigger("uiGenerateTemporaryPassword"),expect("dataTemporaryPasswordGenerated").toHaveBeenTriggeredOnAndWith(document,{html:"html"})}),it("triggers dataFailedToGenerateTemporaryPassword, error case",function(){spyOnEvent(document,"dataFailedToGenerateTemporaryPassword"),ajaxRespondWithError({}),this.component.trigger("uiGenerateTemporaryPassword"),expect("dataFailedToGenerateTemporaryPassword").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/item_actions_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/item_actions_scribe",function(){var a="5",b="6",c="1000",d="42",e=0,f=1,g=3,h=4;beforeEach(function(){setupComponent(),this.triggerProfilePopupOpen=function(b){b.userId="12345",this.component.trigger("dataProfilePopupSuccess",{user_id:a,sourceEventData:b})}}),describe("#scribeCardAction",function(){beforeEach(function(){spyOn(this.component,"scribeCardInteraction")}),it("is triggered only if a card exists",function(){var a={tweetHasCard:!0,tweetId:1234,publisherUserId:1111,creatorAttribution:2222,cardType:"photo"},b="show";spyOn(this.component,"cardAssociationsForData").andReturn(a),this.component.scribeCardAction(b,null,a),expect(this.component.scribeCardInteraction).toHaveBeenCalledWith(b,a)}),it("is not triggered if a card does not exist",function(){var a={tweetHasCard:!1};this.component.scribeCardAction("show",null,a),expect(this.component.scribeCardInteraction).not.toHaveBeenCalled()})}),describe("#handleProfilePopup",function(){it("triggers one action if card does not exist",function(){var a={sourceEventData:{tweetHasCard:!1,isMentionClick:!1}};spyOn(this.component,"scribeInteraction"),this.component.handleProfilePopup(null,a),expect(this.component.scribeInteraction).toHaveBeenCalledWith({action:"profile_click"},a.sourceEventData)}),it("triggers regular action if card is not present",function(){var a={sourceEventData:{tweetHasCard:!1,interactionInsideCard:!1,isMentionClick:!1,tweetId:1234,publisherUserId:1111,creatorAttribution:2222,cardType:"photo",userId:4444}};spyOn(this.component,"scribeInteraction"),this.component.handleProfilePopup(null,a),expect(this.component.scribeInteraction).toHaveBeenCalledWith({action:"profile_click"},a.sourceEventData)}),it("triggers the card action if card is present",function(){var a={sourceEventData:{tweetHasCard:!0,interactionInsideCard:!0,isMentionClick:!1,tweetId:1234,publisherUserId:1111,creatorAttribution:2222,cardType:"photo",userId:4444}};spyOn(this.component,"scribeCardAction"),this.component.handleProfilePopup(null,a),expect(this.component.scribeCardAction).toHaveBeenCalledWith("profile_click",null,a.sourceEventData)})}),describe("#scribeLinkClick",function(){it("scribes link data properly",function(){$(document).trigger("uiItemLinkClick",{userId:a,tweetId:d,position:3,itemType:"tweet",url:"http://example.com",tcoUrl:"http://t.co/abcdefg"}),expect(this.component).toScribe({action:"open_link"},{items:[{id:d,item_type:e,position:3}],url:"http://example.com",message:"http://t.co/abcdefg"})})}),describe("#scribeSearchTagClick",function(){it("scribes a hashtag click properly",function(){$(document).trigger("uiHashtagClick",{userId:a,tweetId:d,position:3,itemType:"tweet",query:"#twitter"}),expect(this.component).toScribe({element:"hashtag",action:"search"},{items:[{id:d,item_type:e,position:3}],query:"#twitter"})}),it("scribes a cashtag click properly",function(){$(document).trigger("uiCashtagClick",{userId:a,tweetId:d,position:3,itemType:"tweet",query:"$TWTR"}),expect(this.component).toScribe({element:"cashtag",action:"search"},{items:[{id:d,item_type:e,position:3}],query:"$TWTR"})})}),describe("selecting an item",function(){it("scribes when a tweet is selected",function(){$(document).trigger("uiItemSelected",{userId:a,tweetId:d,position:2,itemType:"tweet"});var b={items:[{id:d,item_type:e,position:2}]};expect(this.component).toScribe({action:"select"},b)}),it("scribes when a promoted tweet is deselected",function(){this.component.trigger("uiItemDeselected"),$(document).trigger("uiItemDeselected",{userId:a,tweetId:d,impressionId:b,position:2,itemType:"tweet"});var c={items:[{id:d,item_type:e,position:2,promoted_id:b}],promoted:!0};expect(this.component).toScribe({action:"deselect"},c)})}),describe("clicking on a profile link to open a profile popup",function(){it("scribes on a profile popup open from the wtf dashboard - promoted, clicking on screen name",function(){this.triggerProfilePopupOpen({profileClickTarget:"screen_name",impressionId:b,feedbackToken:c,position:3,itemType:"user",scribeContext:{component:"user_recommendations"}});var d={items:[{id:a,token:c,promoted_id:b,item_type:g}],promoted:!0};expect(this.component).toScribe({component:"user_recommendations",element:"screen_name",action:"profile_click"},d)}),it("scribes on a profile popup open from the wtf dashboard - promoted, clicking on avatar",function(){this.triggerProfilePopupOpen({profileClickTarget:"avatar",impressionId:b,feedbackToken:c,itemType:"user",position:3,scribeContext:{component:"user_recommendations"}});var d={items:[{id:a,token:c,promoted_id:b,item_type:g,position:3}],targets:[{id:a,item_type:g}],promoted:!0};expect(this.component).toScribe({component:"user_recommendations",element:"avatar",action:"profile_click"},d)}),it("scribes on a profile popup open from the wtf dashboard - nonpromoted, clicking on screen name",function(){this.triggerProfilePopupOpen({profileClickTarget:"screen_name",feedbackToken:c,itemType:"user",position:3,scribeContext:{component:"user_recommendations"}});var b={items:[{id:a,token:c,item_type:g,position:3}],targets:[{id:a,item_type:g}]};expect(this.component).toScribe({component:"user_recommendations",element:"screen_name",action:"profile_click"},b)}),it("scribes on a profile popup open from the wtf dashboard - nonpromoted, clicking on avatar",function(){this.triggerProfilePopupOpen({profileClickTarget:"avatar",feedbackToken:c,itemType:"user",position:3,scribeContext:{component:"user_recommendations"}});var b={items:[{id:a,token:c,item_type:g,position:3}],targets:[{id:a,item_type:g}]};expect(this.component).toScribe({component:"user_recommendations",element:"avatar",action:"profile_click"},b)}),it("scribes on a profile popup open from a timeline, clicking on profile screen name",function(){this.triggerProfilePopupOpen({profileClickTarget:"screen_name",tweetId:d,userId:a,itemType:"tweet",position:3,scribeContext:{component:"tweet"}});var b={items:[{id:d,item_type:e,position:3}],targets:[{id:a,item_type:g}]};expect(this.component).toScribe({component:"tweet",element:"screen_name",action:"profile_click"},b)}),it("scribes on a profile popup open from a timeline, clicking on profile avatar",function(){this.triggerProfilePopupOpen({tweetId:d,userId:a,profileClickTarget:"avatar",itemType:"tweet",position:3,scribeContext:{component:"tweet"}});var b={items:[{id:d,item_type:e,position:3}],targets:[{id:a,item_type:g}]};expect(this.component).toScribe({component:"tweet",element:"avatar",action:"profile_click"},b)}),it("scribes on a profile popup open from a timeline, clicking on at reply",function(){this.triggerProfilePopupOpen({tweetId:d,userId:a,position:3,isMentionClick:!0,itemType:"tweet",scribeContext:{component:"tweet"}});var b={items:[{id:d,item_type:e,position:3}],targets:[{id:a,item_type:g}]};expect(this.component).toScribe({component:"tweet",action:"mention_click"},b)}),it("scribes on a profile popup open from a timeline, when the tweet is promoted",function(){this.triggerProfilePopupOpen({profileClickTarget:"screen_name",tweetId:d,userId:a,position:3,impressionId:b,itemType:"tweet",scribeContext:{component:"tweet"}});var c={items:[{id:d,item_type:e,position:3}],targets:[{id:a,item_type:g}],promoted:!0};expect(this.component).toScribe({component:"tweet",element:"screen_name",action:"profile_click"},c)})})})
});
define("test/app/data/timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/timeline",function(){beforeEach(setupComponent),describe("event uiWantsMoreTimelineItems",function(){it("has correct default attrs",function(){expect(this.component.attr.defaultAjaxData.include_entities).toEqual(1),expect(this.component.attr.defaultAjaxData.include_available_features).toEqual(1),expect(this.component.attr.noShowError).toBeTruthy()}),it("triggers dataGotMoreTimelineItems when uiWantsMoreTimelineItems called, success case",function(){spyOnEvent(this.component.$node,"dataGotMoreTimelineItems"),ajaxRespondWithSuccess({items_html:"some html"}),this.component.trigger("uiWantsMoreTimelineItems",{}),expect("dataGotMoreTimelineItems").toHaveBeenTriggeredOn(this.component)}),it("triggers dataGotMoreTimelineItemsError when uiWantsMoreTimelineItems called, error case",function(){spyOnEvent(this.component.$node,"dataGotMoreTimelineItemsError"),ajaxRespondWithError({}),this.component.trigger("uiWantsMoreTimelineItems",{}),expect("dataGotMoreTimelineItemsError").toHaveBeenTriggeredOn(this.component)}),it("passes parameters to the API in the success case",function(){ajaxRespondWithSuccess({items_html:"some html"});var a={since_id:20,max_id:10,is_forward:!0,timeline_empty:!0};this.component.trigger("uiWantsMoreTimelineItems",a),expect($.ajax.mostRecentOptions.data.since_id).toEqual(20),expect($.ajax.mostRecentOptions.data.max_id).toEqual(10),expect($.ajax.mostRecentOptions.data.is_forward).toEqual(!0),expect($.ajax.mostRecentOptions.data.timeline_empty).toEqual(!0)}),it("sets the X-Twitter-Polling header on polling requests",function(){ajaxRespondWithSuccess({items_html:"some html"});var a={since_id:20,fromPolling:!0};this.component.trigger("uiWantsMoreTimelineItems",a),expect($.ajax.mostRecentOptions.headers["X-Twitter-Polling"]).toBeTruthy()}),it("does not set the X-Twitter-Polling header without polling option",function(){ajaxRespondWithSuccess({items_html:"some html"});var a={since_id:20};this.component.trigger("uiWantsMoreTimelineItems",a),expect($.ajax.mostRecentOptions.headers["X-Twitter-Polling"]).not.toBeDefined()}),it("does not set the X-Twitter-Polling header when fetching older items",function(){ajaxRespondWithSuccess({items_html:"some html"});var a={max_id:20};this.component.trigger("uiWantsMoreTimelineItems",a),expect($.ajax.mostRecentOptions.headers["X-Twitter-Polling"]).not.toBeDefined()}),it("does not set the X-Twitter-Polling header when triggering newer items via a keyboard shortcut",function(){ajaxRespondWithSuccess({items_html:"some html"});var a={since_id:20,fromShortcut:!0};this.component.trigger("uiWantsMoreTimelineItems",a),expect($.ajax.mostRecentOptions.headers["X-Twitter-Polling"]).not.toBeDefined()}),it("passes the original request object as part of the error response",function(){var a=jasmine.createSpy();this.component.$node.on("dataGotMoreTimelineItemsError",a),ajaxRespondWithError({});var b={since_id:1e3};this.component.trigger("uiWantsMoreTimelineItems",b),expect(a.mostRecentCall.args[1].sourceEventData).toBe(b),this.component.$node.off("dataGotMoreTimelineItemsError")})})})
});
define("test/app/data/page_visibility_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/page_visibility_scribe",function(){beforeEach(function(){setupComponent(),this.component.attr.eventData={scribeContext:{component:"page_visibility"}}}),it("scribe when a page is visible",function(){this.component.trigger("uiPageVisible"),expect(this.component).toScribe({component:"page_visibility",action:"show"})}),it("scribe when a page is hidden",function(){this.component.trigger("uiPageHidden"),expect(this.component).toScribe({component:"page_visibility",action:"hide"})}),it("scribe when a page is unloaded",function(){this.component.trigger("uiPageUnload"),expect(this.component).toScribe({component:"page_visibility",action:"complete"})})})
});
define("test/app/data/embed_stats_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/embed_stats_scribe",function(){beforeEach(function(){setupComponent()}),it("transforms uiClickedEmbeddedTweetLink into link:click scribe",function(){this.component.trigger("uiClickedEmbeddedTweetLink",{tweetId:"1234",url:"http://example.com"}),expect(this.component).toScribe({component:"embed_stats",element:"link",action:"click"},{item_ids:["1234"],url:"http://example.com"})}),it("transforms uiExpandedMoreEmbeddedTweetLinks into more:click scribe",function(){this.component.trigger("uiExpandedMoreEmbeddedTweetLinks",{tweetId:"1234"}),expect(this.component).toScribe({component:"embed_stats",element:"more",action:"click"},{item_ids:["1234"]})})})
});
define("test/app/data/with_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/data/with_scribe",function(a){var b={event_ids:[1,2,3,4,5],message:"hello world"};beforeEach(setupComponent),describe("#scribe",function(){it("scribes client_event data",function(){this.component.scribe({action:"impression"},b),expect(this.component).toScribe("impression",b)}),it("sets the user_id to zero if the user is logged out",function(){var a=$.extend({},b,{user_id:123});this.component.scribe({action:"impression"},a),expect(this.component).toScribe("impression",b)}),it("scribes client_event data",function(){this.component.scribe({component:"test_component",action:"impression"},b),expect(this.component).toScribe({component:"test_component",action:"impression"},b)}),it("overwrites default client_event terms",function(){this.component.scribe({page:"foo",section:"bar",component:"baz",element:"biz",action:"results"},b),expect(this.component).toScribe({page:"foo",section:"bar",component:"baz",element:"biz",action:"results"},b)}),it("scribes with an action term string as the first argument",function(){this.component.scribe("click",{query:"#foobar"}),expect(this.component).toScribe({action:"click"},{query:"#foobar"})})}),describe("#scribeOnEvent",function(){beforeEach(function(){this.component.attr.eventData={scribeContext:{component:"best_component"}},this.component.scribeOnEvent("myAwesomeEvent","click"),this.component.scribeOnEvent("myLameEvent","retweet",{context:"hello",profile_id:111}),this.component.scribeOnEvent("myEventWithData",{component:"blah_component",element:"blah_element",action:"reply"},{event_info:"foobar",item_count:42})}),it("sets handlers for events that scribe those events",function(){this.component.trigger("myAwesomeEvent"),expect(this.component).toScribe({component:"best_component",action:"click"}),expect(this.component).not.toScribe({action:"retweet"}),expect(this.component).not.toScribe({action:"reply"}),this.component.trigger("myAwesomeEvent",{scribeContext:{element:"best_element"}}),expect(this.component).toScribe({component:"best_component",element:"best_element",action:"click"})}),it("passes scribe data if specified",function(){this.component.trigger("myLameEvent"),expect(this.component).toScribe({component:"best_component",action:"retweet"},{context:"hello",profile_id:111})}),it("overrides the triggered event's scribeContext",function(){this.component.trigger("myEventWithData"),expect(this.component).toScribe({component:"blah_component",element:"blah_element",action:"reply"},{event_info:"foobar",item_count:42})})})})
});
define("test/app/data/signup_click_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/signup_click_scribe",function(){var a="0";beforeEach(function(){setupComponent(),this.triggerSignupClick=function(b){this.component.trigger("uiSignupButtonClicked",{user_id:a,sourceEventData:b})}}),it("scribes the signup click on the logged out user page",function(){this.triggerSignupClick({}),expect(this.component).toScribe({action:"signup_click"})})})
});
define("test/app/data/contact_import_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/contact_import",function(){beforeEach(function(){setupComponent()}),describe("event uiInviteContacts",function(){it("puts together a nice addresses param",function(){$(document).trigger("uiInviteContacts",{contacts:[{name:'John "The Forty-Third" 43',email:"john43@twitter.com"},{email:"john41@twitter.com"}]}),expect($.ajax.mostRecentOptions.url).toEqual("/users/send_invites_by_email"),expect($.ajax.mostRecentOptions.data).toEqual({addresses:'"John \\"The Forty-Third\\" 43" <john43@twitter.com>,john41@twitter.com',source:"contact_import",authenticity_token:"AUTHORIZED"})})})})
});
define("test/app/data/embed_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/embed_scribe",function(){beforeEach(function(){setupComponent()}),it("transforms uiOembedError into request_failed scribe",function(){this.component.trigger("uiOembedError",{}),expect(this.component).toScribe({component:"embed_tweet_dialog",action:"request_failed"})}),it("transforms uiNeedsEmbedTweetDialog into open scribe",function(){this.component.trigger("uiNeedsEmbedTweetDialog",{}),expect(this.component).toScribe({component:"embed_tweet_dialog",action:"open"})}),it("transforms uiUserCopiedEmbedCode into copy scribe",function(){this.component.trigger("uiUserCopiedEmbedCode",{}),expect(this.component).toScribe({component:"embed_tweet_dialog",action:"copy"})}),it("transforms uiEmbedRequestFailed into embed_request_failed",function(){this.component.trigger("uiEmbedRequestFailed",{}),expect(this.component).toScribe({component:"embed_tweet_dialog",action:"embed_request_failed"})})})
});
define("test/app/data/typeahead_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/typeahead_scribe",function(){function a(a,b,c){this.component.trigger("uiTypeaheadItemComplete",{index:0,source:a,query:"1001",input:"gaga",item:{origin:"EA"},scribeContext:{component:"top_bar_searchbox",element:"typeahead"}});var d={id:c?"1001":undefined,item_query:c?undefined:"1001",item_type:b,position:0,description:"autocomplete"};expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead_"+a,action:"select"},{message:"gaga",items:[d],event_info:"EA"})}beforeEach(function(){var a='<div id="tweet_box">\n        <textarea class="tweet-box-shadow" />\n      </div>\n    ',b=$(a);setupComponent(b)}),describe("scribing from various datasources",function(){describe("account",function(){it("scribes the account, index and fetch type, and is categorized as a profile_click",function(){a.call(this,"account",3,!0)})}),describe("topics",function(){it("scribes the topic and index and is categorized as a topic search",function(){a.call(this,"topics",12)})}),describe("recent_search",function(){it("scribes the search, typed search and index, and is categorized as search",function(){a.call(this,"recent_search",12)})}),describe("trend_location",function(){function a(a){return{index:0,source:"trend_location",query:a.name,input:a.query,item:a,scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}}it("scribes the trend_location and index and is categorized as a trend_location search",function(){var b={woeid:1,name:"Worldwide",query:"worldwide",input:"EA"},c={item_query:1,item_type:8,position:0,description:"autocomplete"};this.component.trigger("uiTypeaheadItemComplete",a(b)),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead_trend_location",action:"select"},{message:"worldwide",items:[c]})}),it('scribes the trend_location and index for the "no results" trend_location search',function(){var b={woeid:-1,name:"no results",query:"",input:"EA"},c={item_query:-1,item_type:8,position:0,description:"autocomplete"};this.component.trigger("uiTypeaheadItemComplete",a(b)),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead_trend_location",action:"no_results"},{message:"",items:[c]})})}),describe("when a search is typed in (not selected)",function(){it("simply does not care",function(){this.component.trigger("uiSearchQuery",{query:"test",source:"search",scribeContext:{component:"top_bar_searchbox",element:""}}),expect(this.component).not.toScribe({component:"top_bar_searchbox",element:"",action:"search"})})}),describe("saved_search",function(){it("scribes the search, typed search and index, and is categorized as search",function(){a.call(this,"saved_search",13)})}),describe("logging typeahead completions on final tweet sending",function(){it("appends items to its accumulator regardless of source or event",function(){this.component.trigger("uiTypeaheadItemSelected",{index:0,source:"account",query:"1001",input:"gaga",item:{origin:"remote"},display:"gaga",scribeContext:{component:"tweet_box",element:"typeahead"}}),this.component.trigger("uiTypeaheadItemComplete",{index:0,source:"topics",query:"$test",input:"test",item:{origin:"remote"},display:"$test",scribeContext:{component:"tweet_box",element:"typeahead"}}),expect(this.component.completions).toEqual(["@gaga","$test"])}),it("ignores events from typeaheads other than tweet_box",function(){this.component.trigger("uiTypeaheadItemSelected",{index:0,source:"account",query:"1001",input:"gaga",item:{origin:"remote"},display:"gaga",scribeContext:{component:"top_bar",element:"typeahead"}}),expect(this.component.completions).toEqual([])}),it("checks completed tweets for stored entities, triggers an event, and resets",function(){this.component.completions=["@gaga","$test"],this.component.$node.find(".tweet-box-shadow").val("Oh @gaga let's $test and then #it"),this.component.$node.trigger("uiTweetboxTweetSuccess",{scribeContext:{component:"tweet_box",element:"typeahead"}}),expect(this.component).toScribe({action:"entities",component:"tweet_box",element:"typeahead"},{message:3,event_info:2}),expect(this.component.completions).toEqual([])}),it("does not match completed tweets from non tweet_boxes",function(){this.component.completions=["@gaga","$test"],this.component.$node.find(".tweet-box-shadow").val("Oh @gaga let's $test and then #it"),this.component.$node.trigger("uiTweetboxTweetSuccess",{scribeContext:{component:"other",element:"typeahead"}}),expect(this.component).not.toScribe({action:"typeahead_completions",component:"tweet_box",element:"typeahead"}),expect(this.component.completions).toEqual(["@gaga","$test"])}),it("does not scribe if there are no entities in the final tweet (still resets)",function(){this.component.completions=["@gaga","$test"],this.component.$node.find(".tweet-box-shadow").val("No entities for me, please!"),this.component.$node.trigger("uiTweetboxTweetSuccess",{scribeContext:{component:"tweet_box",element:"typeahead"}}),expect(this.component).not.toScribe({action:"typeahead_completions",component:"tweet_box",element:"typeahead"}),expect(this.component.completions).toEqual([])})})}),describe("event uiTypeaheadItemSelected",function(){it("scribes completionType as a click if isClick true",function(){this.component.trigger("uiTypeaheadItemSelected",{index:5,source:"topics",query:"test",input:"t",item:{origin:"EA"},isClick:!0,scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead_topics",action:"select"},{message:"t",items:[{item_query:"test",item_type:12,position:5,description:"click"}],event_info:"EA"})}),it("scribes completionType as a key_select if isClick false",function(){this.component.trigger("uiTypeaheadItemSelected",{index:5,source:"topics",query:"test",input:"t",item:{origin:"EA"},isClick:!1,scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead_topics",action:"select"},{message:"t",items:[{item_query:"test",item_type:12,position:5,description:"key_select"}],event_info:"EA"})})}),describe("event uiTypeaheadItemComplete",function(){it("does not scribe the event if marked as fromSelectionEvent",function(){this.component.trigger("uiTypeaheadItemComplete",{index:5,source:"topics",query:"test",input:"t",item:{origin:"EA"},fromSelectionEvent:!0,scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),expect(this.component).not.toScribe({component:"top_bar_searchbox",element:"typeahead_topics",action:"select"})}),it("scribes the completionType as autocomplete",function(){this.component.trigger("uiTypeaheadItemComplete",{index:5,source:"topics",query:"test",input:"t",item:{origin:"there"},fromSelectionEvent:!1,scribeContext:{component:"top_bar_searchbox",element:"typeahead"}}),expect(this.component).toScribe({component:"top_bar_searchbox",element:"typeahead_topics",action:"select"},{message:"t",items:[{item_query:"test",item_type:12,position:5,description:"autocomplete"}],event_info:"there"})})})})
});
define("test/app/data/simple_event_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/simple_event_scribe",function(){function b(b,c){b.trigger(c,{userId:a,sourceEventData:{scribeContext:{component:"my_component"}}})}var a=5;beforeEach(setupComponent),it("scribes when user enables email follow",function(){b(this.component,"uiEnableEmailFollowAction"),expect(this.component).toScribe({action:"enable",component:"my_component"})}),it("scribes when user disables email follow",function(){b(this.component,"uiDisableEmailFollowAction"),expect(this.component).toScribe({action:"disable",component:"my_component"})}),it("scribes when user submits the email follow form",function(){b(this.component,"uiEmailFollowFormSubmitAction"),expect(this.component).toScribe({action:"submit",component:"my_component"})})})
});
define("test/app/data/user_completion_module_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/user_completion_module_scribe",function(){var a='<div id="user-completion-module">\n      <a id="step" class="user-completion-step" data-scribe-element="scribe_element_123">\n    </div>\n  ';beforeEach(function(){setupComponent(a),this.$stepLink=this.$node.find("#step")}),describe("click on user completion step link",function(){it("scribes click event with element term set to link's data-scribe-element",function(){this.$stepLink.click(),expect(this.component).toScribe({component:"user_completion",element:"scribe_element_123",action:"click"})}),it("does not scribe click event when step is complete",function(){this.$stepLink.addClass("completed"),this.$stepLink.click(),expect(this.component).not.toScribe({component:"user_completion",element:"scribe_element_123",action:"click"})})})})
});
define("test/app/data/with_card_metadata_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/data/with_card_metadata",function(){var a,b;beforeEach(function(){var c='<div>\n        <div class="tweet"></div>\n      </div>\n     ',d='<div>\n        <div class="js-tweet-details-fixer tweet-details-fixer">\n          <div class="card2" data-card2-name="summary">\n            <div class="card2-summary card2-holder" data-card2-url="http://t.co/AHdJFD5c">\n              <div class="card2-attribution">\n                <a class="js-user-profile-link" data-user-id="19" href="/mrtall">\n                </a>\n              </div>\n              <div>\n                <p class="card2-byline">\n                  <a class="js-user-profile-link" data-user-id="3" href="https://twitter.com/jack">\n                  </a>\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n        </div>\n    ',e='<div>\n         <div class="cards-base" data-card-url="http://foo.com" data-card-type="summary"></div>\n       </div>\n     ';b=$(e).prop("outerHTML"),a=$(d).prop("outerHTML"),setupComponent(c)}),describe("#cardAssociationsForData",function(){it("reformats incoming data into the appropriate format",function(){var a={tweetId:1234,publisherUserId:1111,creatorUserId:2222,cardUrl:"http://foo.com"};expect(this.component.cardAssociationsForData(a)).toEqual({associations:{2:{association_id:1111,association_type:3},3:{association_id:2222,association_type:3}},message:"http://foo.com"})})}),describe("#getCardDataFromTweet",function(){beforeEach(function(){spyOn(this.component,"getUserIdFromElement").andReturn(1234),spyOn(this.component,"interactionInsideCard").andReturn(!0)}),it("should return card data if card is present",function(){var a=$('<div class="tweet has-cards"></div>');a.attr("data-expanded-footer",b),expect(this.component.getCardDataFromTweet(a)).toEqual({tweetHasCard:!0,interactionInsideCard:!0,cardType:"summary",cardUrl:"http://foo.com",publisherUserId:1234,creatorUserId:1234})}),it("should return tweetHasCard=false if no card present",function(){var a=$('<div class="tweet"><div class="somethingelse"></div></div>');expect(this.component.getCardDataFromTweet(a)).toEqual({tweetHasCard:!1,interactionInsideCard:!1})}),it("should return tweetHasCard2=true if cards++ exist",function(){var b=$('<div class="tweet has-cards"></div>').attr("data-expanded-footer",a);expect(this.component.getCardDataFromTweet(b).tweetHasCard2).toEqual(!0)}),it("should return promoted-id and item-id",function(){var b=$('<div class="tweet has-cards" data-item-id=1234 data-impression-id=3456></div>').attr("data-expanded-footer",a),c=this.component.getCardDataFromTweet(b);expect(c.promotedId).toEqual("3456"),expect(c.itemId).toEqual("1234")})}),describe("#interactionInsideCard",function(){it("should return true if element is inside a card",function(){var a=$('<div class="has-cards"><div class="cards-base" data-card-url="http://foo.com" data-card-type="summary"><div class="inside"></div></div></div>'),b=a.find(".inside");expect(this.component.interactionInsideCard(b)).toEqual(!0)}),it("should return false if element is not inside card",function(){var a=$('<div class="has-cards"><div class="outside"><div class="cards-base" data-card-url="http://foo.com" data-card-type="summary"></div></div></div>'),b=a.find(".outside");expect(this.component.interactionInsideCard(b)).toEqual(!1)})}),describe("#scribeCardInteraction",function(){it("gets the custom data and scribes the interaction",function(){var a={tweetHasCard:!0,interactionInsideCard:!0,cardType:"summary",publisherUserId:1234,creatorUserId:1234,cardUrl:"http://foo.com"},b={foo:"bar"},c="show";spyOn(this.component,"scribeInteraction"),spyOn(this.component,"cardAssociationsForData").andReturn(b),this.component.scribeCardInteraction(c,a),expect(this.component.scribeInteraction).toHaveBeenCalledWith({element:"platform_summary_card",action:c},a,b)})})})
});
define("test/app/data/resend_password_help_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/resend_password_help_scribe",function(){beforeEach(setupComponent),describe("uiResendPasswordHelpNoButtonClicked event",function(){it("scribes a client event",function(){this.component.trigger("uiResendPasswordHelpNoButtonClicked",{helpState:"phone_hint"}),expect(this.component).toScribe({component:"phone_hint",element:"no_button",action:"click"})})}),describe("uiShowContactSupport event",function(){it("scribes a client event",function(){this.component.trigger("uiShowContactSupport"),expect(this.component).toScribe({component:"contact_support",action:"impression"})})})})
});
define("test/app/data/topic_pivots_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/topic_pivots_scribe",function(){beforeEach(function(){setupComponent('<div><div class="tweet"></div></div>')}),describe("#scribeTopicLabelClick",function(){beforeEach(function(){spyOn(this.component,"scribeInteraction")}),it("should scribe on 'uiTopicLabelClick' event",function(){var a={scribeContext:"news_story"};this.component.trigger("uiTopicLabelClick",a),expect(this.component.scribeInteraction).toHaveBeenCalledWith({element:"topic",action:"click"},a)})}),describe("#scribeTopicBackNavClick",function(){beforeEach(function(){spyOn(this.component,"scribe")}),it("should scribe on 'uiTopicBackNavClick' event",function(){this.component.trigger("uiTopicBackNavClick"),expect(this.component.scribe).toHaveBeenCalledWith({element:"back_nav",action:"click"})})})})
});
define("test/app/data/follower_request_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/follower_request",function(){beforeEach(setupComponent),describe("event uiDidFollowerAccept",function(){it("triggers dataFollowerAcceptSuccess, success case",function(){spyOnEvent(document,"dataFollowerAcceptSuccess"),ajaxRespondWithSuccess({}),this.component.trigger("uiDidFollowerAccept",{userId:42}),expect("dataFollowerAcceptSuccess").toHaveBeenTriggeredOnAndWith(document,{userId:42})}),it("triggers dataFollowerAcceptFailure, error case",function(){spyOnEvent(document,"dataFollowerAcceptFailure"),ajaxRespondWithError({}),this.component.trigger("uiDidFollowerAccept",{userId:43}),expect("dataFollowerAcceptFailure").toHaveBeenTriggeredOnAndWith(document,{userId:43})})}),describe("event uiDidFollowerDecline",function(){it("triggers dataFollowerDeclineSuccess, success case",function(){spyOnEvent(document,"dataFollowerDeclineSuccess"),ajaxRespondWithSuccess({}),this.component.trigger("uiDidFollowerDecline",{userId:44}),expect("dataFollowerDeclineSuccess").toHaveBeenTriggeredOnAndWith(document,{userId:44})}),it("triggers dataFollowerDeclineFailure, error case",function(){spyOnEvent(document,"dataFollowerDeclineFailure"),ajaxRespondWithError({}),this.component.trigger("uiDidFollowerDecline",{userId:45}),expect("dataFollowerDeclineFailure").toHaveBeenTriggeredOnAndWith(document,{userId:45})})})})
});
define("test/app/data/scribing_context_spec",["module","require","exports"],function(module, require, exports) {
describeComponentWithDataComponents("test/app/helpers/test_component",["test/app/helpers/first_data_component","test/app/helpers/test_scribing_component"],function(){describe("event processing",function(){beforeEach(function(){setupComponent(),this.component.attr.eventData={},this.component.attr.eventData.scribeContext={component:"earth",element:"north_america"}}),it("automatically scribes with the scribeContext of the triggeringComponent",function(){this.testScribingComponent.on("myEvent",function(a,b){this.scribe("click",b,{item_ids:[1,2,3,4],message:b.foobar})}.bind(this.testScribingComponent)),this.component.trigger("myEvent",{foobar:"foobar"}),expect(this.testScribingComponent).toScribe({component:"earth",element:"north_america",action:"click"},{item_ids:[1,2,3,4],message:"foobar"})}),it("allows scribe call to override context values",function(){this.testScribingComponent.on("myEvent",function(a,b){this.scribe("click",{scribeContext:{component:"foo",element:"bar",action:"click"}},{item_ids:[1,2,3,4],message:b.foobar})}.bind(this.testScribingComponent)),this.component.trigger("myEvent",{foobar:"foobar"}),expect(this.testScribingComponent).toScribe({component:"foo",element:"bar",action:"click"},{item_ids:[1,2,3,4],message:"foobar"})})})})
});
define("test/app/data/with_widgets_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/data/with_widgets",function(a){function b(){window.twttr=function(a,b,c){var d,e,f=a.getElementsByTagName(b)[0];if(a.getElementById(c))return;return e=a.createElement(b),e.id=c,window.twttr||(d={_e:[],ready:function(a){d._e.push(a)}})}(document,"script","twitter-wjs")}beforeEach(function(){window.twttr=undefined,setupComponent(),this.spyOn(this.component,"asyncWidgetsLoader").andCallFake(b)}),it("calls asyncWidgetsLoader when window.twttr undefined",function(){this.component.getWidgets(),expect(this.component.asyncWidgetsLoader).toHaveBeenCalled()}),it("does not call asyncWidgetsLoad when window.twttr is defined",function(){window.twttr={ready:function(){}},this.component.getWidgets(),expect(this.component.asyncWidgetsLoader).not.toHaveBeenCalled()}),it("sets widgetsAreLoaded based on window.twttrs presence",function(){this.component.widgets={},expect(this.component.widgetsAreLoaded()).toEqual(!1),this.component.widgets.init=!0,expect(this.component.widgetsAreLoaded()).toEqual(!0)}),it("only returns true from widgetsProvidesNewEmbed when this.component.widgets.widgets.createTweetEmbed is defined",function(){this.component.widgets={},expect(this.component.widgetsProvidesNewEmbed()).toEqual(!1),this.component.widgets.init=!0,expect(this.component.widgetsProvidesNewEmbed()).toEqual(!1),this.component.widgets.widgets={},expect(this.component.widgetsProvidesNewEmbed()).toEqual(!1),this.component.widgets.widgets.createTweetEmbed=function(){},expect(this.component.widgetsProvidesNewEmbed()).toEqual(!0)}),it("calls widgetsReady from _widgetsReady",function(){this.component.widgetsReady=function(){},spyOn(this.component,"widgetsReady"),this.component._widgetsReady(),expect(this.component.widgetsReady).toHaveBeenCalled()})})
});
define("test/app/data/user_actions_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/user_actions_scribe",function(){function c(b,c){$(document).trigger("dataFollowStateChange",$.extend({userId:a,requestUrl:b,itemType:"user",position:5,sourceEventData:{scribeContext:{component:"profile_dialog"},associatedTweetId:10}},c))}function d(b){$(document).trigger("dataUserActionSuccess",{userId:a,requestUrl:b,itemType:"user",position:5,sourceEventData:{scribeContext:{component:"profile_dialog"},associatedTweetId:10}})}function e(b){$(document).trigger(b,{userId:a,itemType:"user",position:5,associatedTweetId:10,sourceEventData:{scribeContext:{component:"profile_dialog"}}})}var a=5,b={items:[{id:a,item_type:3,position:5}],associations:{1:{association_id:10,association_type:0}}};beforeEach(function(){setupComponent()}),it("scribes on a follow action",function(){c("/i/user/follow"),expect(this.component).toScribe({action:"follow",component:"profile_dialog"},b)}),it("scribes follow and follow back on a follow back action",function(){c("/i/user/follow",{isFollowBack:!0}),expect(this.component).toScribe({action:"follow",component:"profile_dialog"},b),expect(this.component).toScribe({action:"follow_back",component:"profile_dialog"},b)}),it("scribes on an unfollow action",function(){c("/i/user/unfollow"),expect(this.component).toScribe({action:"unfollow",component:"profile_dialog"},b)}),it("scribes on a block action",function(){spyOn(this.component,"getUserActionAssociations").andReturn(null),c("/i/user/block"),expect(this.component).toScribe({action:"block",component:"profile_dialog"},b)}),it("scribes on an unblock action",function(){c("/i/user/unblock"),expect(this.component).toScribe({action:"unblock",component:"profile_dialog"},b)}),it("scribes on a report spam action",function(){spyOn(this.component,"getUserActionAssociations").andReturn(null),d("/i/user/report_spam"),expect(this.component).toScribe({action:"report_as_spam",component:"profile_dialog"},b)}),it("scribes on a hide suggestion action",function(){d("/i/user/hide"),expect(this.component).toScribe({action:"dismiss",component:"profile_dialog"},b)}),it("scribes on a mention action",function(){e("uiMentionAction"),expect(this.component).toScribe({action:"reply",component:"profile_dialog"},b)}),it("scribes on a dm action",function(){e("uiDmAction"),expect(this.component).toScribe({action:"dm",component:"profile_dialog"},b)}),it("scribes on an add to list action",function(){e("uiListAction"),expect(this.component).toScribe({action:"add_to_list",component:"profile_dialog"},b)}),it("scribes on turning on rts action",function(){e("uiRetweetOnAction"),expect(this.component).toScribe({action:"on",element:"allow_retweets",component:"profile_dialog"},b)}),it("scribes on turning off rts action",function(){e("uiRetweetOffAction"),expect(this.component).toScribe({action:"off",element:"allow_retweets",component:"profile_dialog"},b)}),it("scribes on turning on mobile notifications action",function(){e("uiDeviceNotificationsOnAction"),expect(this.component).toScribe({action:"on",element:"mobile_notifications",component:"profile_dialog"},b)}),it("scribes on turning off mobile notifications action",function(){e("uiDeviceNotificationsOffAction"),expect(this.component).toScribe({action:"off",element:"mobile_notifications",component:"profile_dialog"},b)}),it("scribes when user tries to mobile notify and they dont have a phone setup",function(){e("uiShowMobileNotificationsConfirm"),expect(this.component).toScribe({action:"failure",element:"mobile_notifications",component:"profile_dialog"},b)}),it("scribes when user gets kicked to the help center",function(){e("uiShowMobileNotificationsConfirm"),expect(this.component).toScribe({action:"failure",element:"mobile_notifications",component:"profile_dialog"},b)}),it("scribes on email follow action",function(){e("uiEmailFollowAction"),expect(this.component).toScribe({action:"email_follow",element:"email_follow",component:"profile_dialog"},b)}),it("scribes on email unfollow action",function(){e("uiEmailUnfollowAction"),expect(this.component).toScribe({action:"email_unfollow",element:"email_follow",component:"profile_dialog"},b)})})
});
define("test/app/data/contact_import_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/contact_import_scribe",function(){beforeEach(function(){var a='<div>\n     <a class="find-friends-btn"></a>\n     </div>\n     ';setupComponent(a,{sectionName:"import",eventData:{scribeContext:{component:"import_service_stream"}}})}),it("scribes a launch service event",function(){this.component.trigger("uiImportServiceLaunched",{service:"gmail"}),expect(this.component).toScribe({component:"import_service_stream",action:"launch_service"},{query:"gmail"})}),it("scribes an invitation preview link click",function(){this.component.trigger("uiPreviewInviteOpened"),expect(this.component).toScribe({component:"invite_friends",element:"preview_invite_link",action:"click"})}),describe("invitations data success",function(){beforeEach(function(){var a={invitable:10,contacts:["john1@twitter.com","john2@twitter.com","john3@twitter.com"],scribeContext:{component:"invite_contacts_spec"}};this.$node.trigger("dataInviteContactsSuccess",{invited:["john1@twitter.com"],sourceEventData:a})}),it("scribes the invitable user count",function(){expect(this.component).toScribe({component:"invite_contacts_spec",action:"invitable"},{item_count:10})}),it("scribes the invited user count",function(){expect(this.component).toScribe({component:"invite_contacts_spec",action:"invited"},{event_value:3,item_count:3})})}),describe("invitations data failure",function(){it("scribes an error",function(){var a={invitable:10,contacts:["john1@twitter.com","john2@twitter.com","john3@twitter.com"],scribeContext:{component:"invite_contacts_spec"}};this.$node.trigger("dataInviteContactsFailure",{sourceEventData:a,errors:[{code:71,message:"There was an error delivering one or more of your emails"}]}),expect(this.component).toScribe({component:"invite_contacts_spec",action:"error"},{item_count:3,status_code:71})})}),describe("link clicks",function(){it("scribes click on find friends link",function(){this.$node.find(".find-friends-btn").click(),expect(this.component).toScribe({component:"empty_timeline",element:"find_friends_link",action:"click"})})})})
});
define("test/app/data/activity_popup_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/activity_popup",function(){beforeEach(setupComponent),describe("on uiFetchActivityPopup",function(){describe("with retweeted true",function(){it("makes an ajax call to retrieve the HTML",function(){this.$node.trigger("uiFetchActivityPopup",{tweetId:1,isRetweeted:!0}),expect(jQuery.ajax.mostRecentOptions).toEqual(jasmine.objectContaining({url:"/i/activity/retweeted_popup",data:{id:1}}))})}),describe("with retweeted false",function(){it("makes an ajax call to retrieve the HTML",function(){this.$node.trigger("uiFetchActivityPopup",{tweetId:1,isRetweeted:!1}),expect(jQuery.ajax.mostRecentOptions).toEqual(jasmine.objectContaining({url:"/i/activity/favorited_popup",data:{id:1}}))})})}),describe("a successful request",function(){beforeEach(function(){spyOnEvent(document,"dataActivityPopupSuccess"),this.htmlContent='<div class="activity-modal-header">Retweeted popup</div>',this.htmlTitle="<i></i>Retweeted 1 time",ajaxRespondWithSuccess({htmlTitle:this.htmlTitle,htmlContent:this.htmlContent})}),it("triggers a dataActivityPopupSuccess event with the HTML",function(){this.$node.trigger("uiFetchActivityPopup",{tweetId:1,isRetweeted:!0}),expect("dataActivityPopupSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({htmlTitle:this.htmlTitle,htmlContent:this.htmlContent}))})}),describe("an unsuccessful request",function(){beforeEach(function(){ajaxRespondWithError({})}),it("triggers a dataActivityPopupError event with an error message",function(){spyOnEvent(document,"dataActivityPopupError"),this.$node.trigger("uiFetchActivityPopup",{tweetId:1,isRetweeted:!0}),expect("dataActivityPopupError").toHaveBeenTriggeredOnAndWith(document,{xhr:{},message:"Internal server error."})})})})
});
define("test/app/data/suggested_users_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/suggested_users",function(){beforeEach(setupComponent),describe("on uiFollowAction",function(){describe("with isReplacement set",function(){beforeEach(function(){this.$node.trigger("uiGetClusterFollowReplacementSuggestion",{isReplacement:!0,userId:100})}),it("fetches the HTML",function(){expect($.ajax.mostRecentOptions.url).toBe("/i/users/suggested_users")}),it("sends the correct user id and limit",function(){expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({user_id:100,limit:1}))})})}),describe("on uiFollowAction",function(){describe("with profileHead set",function(){beforeEach(function(){this.$node.trigger("uiFollowAction",{profileHead:!0,userId:100})}),it("fetches the HTML",function(){expect($.ajax.mostRecentOptions.url).toBe("/i/users/suggested_users")}),it("sends the correct user id, limit, pc, and display_location",function(){expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({user_id:100,limit:3,pc:!0,display_location:"cluster-follow"}))})}),describe("without profileHead set",function(){beforeEach(function(){this.$node.trigger("uiFollowAction")}),it("does nothing",function(){expect($.ajax.mostRecentOptions).toBeUndefined()})}),describe("with a successful ajax response",function(){beforeEach(function(){this.html="<div>Sample HTML</div>",ajaxRespondWithSuccess({html:this.html}),spyOnEvent(document,"dataSuggestedUsersSuccess")}),it("triggers a dataSuggestedUsersSuccess event with the HTML",function(){this.$node.trigger("uiFollowAction",{profileHead:!0,userId:100}),expect("dataSuggestedUsersSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.html}))}),it("triggers a dataSuggestedUsersSuccess event with isReplacement set to true if replacement response",function(){this.$node.trigger("uiFollowAction",{profileHead:!0,userId:100,isReplacement:!0}),expect("dataSuggestedUsersSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.html,isReplacement:!0}))})}),describe("with a successful ajax response with no users",function(){beforeEach(function(){ajaxRespondWithSuccess({}),spyOnEvent(document,"dataSuggestedUsersSuccess"),this.$node.trigger("uiFollowAction",{profileHead:!0,userId:100})}),it("does not trigger a dataSuggestedUsersSuccess event",function(){expect("dataSuggestedUsersSuccess").not.toHaveBeenTriggeredOn(document)})}),describe("with an unsuccessful ajax response",function(){beforeEach(function(){ajaxRespondWithError({}),spyOnEvent(document,"dataSuggestedUsersFailure"),this.$node.trigger("uiFollowAction",{profileHead:!0,userId:100})}),it("triggers a dataSuggestedUsersFailure event",function(){expect("dataSuggestedUsersFailure").toHaveBeenTriggeredOn(document)})})}),describe("scribeSuggestedUsersResults",function(){it("should scribe the user id specified in the event data",function(){var a={items:[1,2,3],user_id:5};this.$node.trigger("uiSuggestedUsersRendered",a),expect(this.component).toScribe({action:"results"},{profile_id:a.user_id},{referring_event:"initial"})}),it("should scribe the user id specified in the event data",function(){var a={items:[1,2,3],user_id:5,isReplacement:!0};this.$node.trigger("uiSuggestedUsersRendered",a),expect(this.component).toScribe({action:"results"},{profile_id:a.user_id},{referring_event:"newer"})})})})
});
define("test/app/data/tweet_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/tweet",function(){var a='<form id="tweet-form">\n      <input type="hidden" name="post_authenticity_token" class="auth-token">\n      <input type="hidden" name="iframe_callback" class="iframe-callback">\n      <input type="hidden" name="in_reply_to_status_id" class="in-reply-to-status-id">\n      <input type="hidden" name="impression_id" class="impression-id">\n    </form>\n  ';beforeEach(function(){setupComponent({formAuthenticityToken:"dummy token"})}),describe("event uiSendTweet",function(){it("fires dataTweetSuccess on uiSendTweet",function(){spyOnEvent(document,"dataTweetSuccess"),ajaxRespondWithSuccess({tweet_id:1}),this.component.trigger("uiSendTweet",{status:"hello",tweetboxId:2,tweetData:{}}),expect("dataTweetSuccess").toHaveBeenTriggeredOnAndWith(document,{tweet_id:1,tweetboxId:2})}),it("fires dataGotProfileStats",function(){var a=[{user_id:3}];spyOnEvent(document,"dataGotProfileStats"),ajaxRespondWithSuccess({tweet_id:1,profile_stats:a}),this.component.trigger("uiSendTweet",{status:"hello",tweetboxId:2,tweetData:{}}),expect("dataGotProfileStats").toHaveBeenTriggeredOnAndWith(document,{stats:a})}),it("fires dataTweetSuccess with replied to",function(){spyOnEvent(document,"dataTweetSuccess"),ajaxRespondWithSuccess({tweet_id:1,in_reply_to_status_id:5}),this.component.trigger("uiSendTweet",{status:"hello",tweetboxId:2,tweetData:{in_reply_to_status_id:5}}),expect("dataTweetSuccess").toHaveBeenTriggeredOnAndWith(document,{tweet_id:1,in_reply_to_status_id:5,tweetboxId:2})}),it("triggers form submit on uiSendTweetWithMedia",function(){var b=$(a);attachFixtureToDom(b);var c=jasmine.createSpy().andCallFake(function(a,b){a.preventDefault()});b.on("submit",c),tweetContext={status:"hello",tweetboxId:"tweet-form",tweetData:{in_reply_to_status_id:5,impression_id:"impression"}},this.component.trigger("uiSendTweetWithMedia",tweetContext),expect(c).toHaveBeenCalled(),expect(b.find(".auth-token")).toHaveValue("dummy token"),expect(b.find(".iframe-callback")).toHaveValue("window.top."+tweetContext.tweetboxId),expect(b.find(".in-reply-to-status-id")).toHaveValue(tweetContext.tweetData.in_reply_to_status_id),expect(b.find(".impression-id")).toHaveValue(tweetContext.tweetData.impression_id),expect(b.find('[name="status"]')).toHaveValue(tweetContext.tweetData.status)}),it("fires dataDirectMessageSuccess on uiSendDirectMessage",function(){spyOnEvent(document,"dataDirectMessageSuccess"),this.component.trigger("uiSendDirectMessage",{text:"hello",user_id:4}),expect("dataDirectMessageSuccess").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/with_data_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/data/with_data",function(a){beforeEach(function(){setupComponent()}),describe("#createSuccessHandler",function(){var a={getResponseHeader:function(a){return"xyz"}};afterEach(function(){window.DEBUG.enable(!0)}),it("creates a success handler",function(){spyOnEvent(document,"dataFoobarSuccess");var a=this.component.createSuccessHandler("dataFoobarSuccess",{});expect(typeof a).toBe("function"),a({secretNumber:42}),expect("dataFoobarSuccess").toHaveBeenTriggeredOnAndWith(document,{secretNumber:42})}),it("handles null success data",function(){spyOnEvent(document,"dataNullSuccess");var a={sourceId:77},b=this.component.createSuccessHandler("dataNullSuccess",{eventData:a});expect(typeof b).toBe("function"),b(null),expect("dataNullSuccess").toHaveBeenTriggeredOnAndWith(document,{sourceEventData:a})}),it("triggers dataSetDebugData if debug is in the data obj",function(){spyOnEvent(document,"dataSetDebugData");var a=this.component.createSuccessHandler("dataEvent",{}),b={debug:{key1:{data:"123",html:""}}};a(b),expect("dataSetDebugData").toHaveBeenTriggeredOnAndWith(document,b.debug)}),it("doesn't trigger dataSetDebugData if it's not in the data object",function(){spyOnEvent(document,"dataSetDebugData");var a=this.component.createSuccessHandler("dataEvent",{});a({}),expect("dataSetDebugData").not.toHaveBeenTriggeredOn(document)}),it("extracts notification data",function(){spyOnEvent(document,"dataNotificationsReceived");var b=this.component.createSuccessHandler("dataEvent",{});b({note:{n:{}},inner:{}},200,a),expect("dataNotificationsReceived").toHaveBeenTriggeredOnAndWith(document,{n:{},notCached:!0})}),it("triggers dataSetDebugData inside a notification envelope",function(){spyOnEvent(document,"dataSetDebugData");var b=this.component.createSuccessHandler("dataEvent",{}),c={note:{n:{}},inner:{debug:{key1:{data:"123",html:""}}}};b(c,200,a),expect("dataSetDebugData").toHaveBeenTriggeredOn(document)})}),describe("#createErrorHandler",function(){it("creates a error handler for a JSON error string",function(){spyOnEvent(document,"dataFoobarError");var a=this.component.createErrorHandler("dataFoobarError",{});expect(typeof a).toBe("function"),a({responseText:JSON.stringify({message:"Something went wrong"})}),expect("dataFoobarError").toHaveBeenTriggeredOnAndWith(document,{message:"Something went wrong"})}),it("creates an error handler that returns a generic message when response cannot be parsed",function(){spyOnEvent(document,"dataFoobarError");var a=this.component.createErrorHandler("dataFoobarError",{});a({responseText:"",statusText:"timeout"}),expect("dataFoobarError").toHaveBeenTriggeredOnAndWith(document,{xhr:{statusText:"timeout"},message:"Internal server error."})})}),describe("#extractParams",function(){it("creates hash of selected params",function(){expect(this.component.extractParams({copy_this:!0,and_this:!0,but_not_this:!1},{search:"?not_this=hey&copy_this=a+b&and_this=What%3F&but_not_this=BOO"})).toEqual({copy_this:"a b",and_this:"What?"})})}),describe("#JSONRequest",function(){it("calls addAuthToken for POSTs",function(){spyOn(this.component,"addAuthToken").andCallThrough(),this.component.JSONRequest({eventData:{},data:{formData:"hello"},url:"my/url",success:"dummySuccessEvent",error:"dummyErrorEvent"},"POST"),expect(this.component.addAuthToken).toHaveBeenCalledWith({formData:"hello"}),expect($.ajax.mostRecentOptions.data).toEqual({formData:"hello",authenticity_token:"AUTHORIZED"})}),it("fires the dataPageMutated event by default for POSTs",function(){spyOnEvent(document,"dataPageMutated"),this.component.JSONRequest({eventData:{},data:{formData:"hello"},url:"my/url",success:"dummySuccessEvent",error:"dummyErrorEvent"},"POST"),expect("dataPageMutated").toHaveBeenTriggeredOn(document)}),it("fires the dataPageMutated event by default for DELETEs",function(){spyOnEvent(document,"dataPageMutated"),this.component.JSONRequest({eventData:{},data:{formData:"hello"},url:"my/url",success:"dummySuccessEvent",error:"dummyErrorEvent"},"DELETE"),expect("dataPageMutated").toHaveBeenTriggeredOn(document)}),it("does not fire the dataPageMutated event for GETs",function(){spyOnEvent(document,"dataPageMutated"),this.component.JSONRequest({eventData:{},data:{formData:"hello"},url:"my/url",success:"dummySuccessEvent",error:"dummyErrorEvent"},"GET"),expect("dataPageMutated").not.toHaveBeenTriggeredOn(document)}),it("does not fire the dataPageMutated event when the isMutation option is set to false",function(){spyOnEvent(document,"dataPageMutated"),this.component.JSONRequest({eventData:{},data:{formData:"hello"},url:"my/url",success:"dummySuccessEvent",error:"dummyErrorEvent",isMutation:!1},"POST"),expect("dataPageMutated").not.toHaveBeenTriggeredOn(document)}),it("calls addPHXAuthToken for POSTs when X-PHX header is present",function(){spyOn(this.component,"addPHXAuthToken").andCallThrough(),this.component.JSONRequest({eventData:{},data:{formData:"hello"},headers:{"X-PHX":!0},url:"my/url",success:"dummySuccessEvent",error:"dummyErrorEvent"},"POST"),expect(this.component.addPHXAuthToken).toHaveBeenCalledWith({formData:"hello",authenticity_token:"AUTHORIZED"}),expect($.ajax.mostRecentOptions.data).toEqual({formData:"hello",authenticity_token:"AUTHORIZED",post_authenticity_token:"AUTHORIZED"})}),it("cancels ajax calls on pushstate navigation",function(){var a=jasmine.createSpy('"Abort XHR on pushstate navigation"');ajaxReturnXHRObject({abort:a}),this.component.JSONRequest({eventData:{},data:{},url:"my/url",success:"dummySuccessEvent",error:"dummyErrorEvent"},"POST"),this.component.abortAllXHR(),expect(a).toHaveBeenCalled()}),it("doesn't cancel ajax calls if excluded from abort",function(){var a=jasmine.createSpy('"Abort XHR on pushstate navigation"');ajaxReturnXHRObject({abort:a}),this.component.JSONRequest({eventData:{},data:{},url:"my/url",success:"dummySuccessEvent",error:"dummyErrorEvent",noAbortOnNavigate:!0},"POST"),this.component.abortAllXHR(),expect(a).not.toHaveBeenCalled()})}),describe("cachedAjax",function(){var a={mock:"yeah"},b={ing:"yeah"},c={bird:"yeah"},d=36e5,e="/urls/1",f="/urls/2",g="/urls/3";it("hits the server if nothing is cached",function(){ajaxRespondWithSuccess(a),this.component.get({url:e,cache_ttl:d,success:function(b){expect(b).toEqual(a)}})}),it("uses the cached version after hitting the server",function(){ajaxRespondWithSuccess(a),this.component.get({url:e,cache_ttl:d,success:function(b){expect(b).toEqual(a)}}),ajaxRespondWithSuccess(b),this.component.get({url:e,cache_ttl:d,success:function(b){expect(b).toEqual(a)}})}),it("it uses data from cache if it hasn't expired",function(){var c=+(new Date);ajaxRespondWithSuccess(a),this.component.get({url:e,cache_ttl:d,success:function(b){expect(b).toEqual(a)}}),spyOn(Date.prototype,"valueOf").andReturn(c),ajaxRespondWithSuccess(b),this.component.get({url:e,cache_ttl:d,success:function(b){expect(b).toEqual(a)}})}),it("it hits the server if cached data has expired",function(){var c=+(new Date);ajaxRespondWithSuccess(a),this.component.get({url:e,cache_ttl:d,success:function(b){expect(b).toEqual(a)}}),spyOn(Date.prototype,"valueOf").andReturn(c+2*d),ajaxRespondWithSuccess(b),this.component.get({url:e,cache_ttl:d,success:function(a){expect(a).toEqual(b)}})}),it("calls correct callback if an error occurs",function(){var a=jasmine.createSpy(),b=jasmine.createSpy();ajaxRespondWithError({}),this.component.get({url:e,cache_ttl:d,success:a,error:b}),expect(a).not.toHaveBeenCalled(),expect(b).toHaveBeenCalled()}),it("keeps track of multiple URLs properly",function(){ajaxRespondWithSuccess(a),this.component.get({url:e,cache_ttl:d,success:function(b){expect(b).toEqual(a)}}),ajaxRespondWithSuccess(b),this.component.get({url:f,cache_ttl:d,success:function(a){expect(a).toEqual(b)}}),ajaxRespondWithSuccess(c),this.component.get({url:e,cache_ttl:d,success:function(b){expect(b).toEqual(a)}})})}),describe("XHR responses cached by the browser",function(){var a={getResponseHeader:function(a){return"abc"}},b={getResponseHeader:function(a){return"def"}};it("does not send notifications for cached responses",function(){var c=spyOnEvent(document,"dataNotificationsReceived"),d=this.component.createSuccessHandler("dataEvent",{});d({note:{n:{}},inner:{}},200,a),expect("dataNotificationsReceived").toHaveBeenTriggeredOn(document),c.reset(),d({note:{n:{}},inner:{}},200,a),expect("dataNotificationsReceived").not.toHaveBeenTriggeredOn(document),d({note:{n:{}},inner:{}},200,b),expect("dataNotificationsReceived").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/signup_data_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/signup_data",function(){function a(a,b,c,d){switch(a){case"username":this.component.trigger("uiSignupValidate",{name:"user[screen_name]",username:b,fullname:"fullname",email:"email",value:b,quick:c});break;case"email":this.component.trigger("uiSignupValidate",{name:"user[email]",username:"username",fullname:"fullname",email:b,value:b,quick:c});break;case"confirmEmail":this.component.trigger("uiSignupValidate",{name:"user[confirm_email]",username:"username",fullname:"fullname",email:"gron@gron.com",value:b,quick:c});break;case"name":this.component.trigger("uiSignupValidate",{name:"user[name]",username:"username",fullname:b,email:"email",value:b,quick:c});break;case"password":this.component.trigger("uiSignupValidate",{name:"user[user_password]",username:"username",fullname:"fullname",email:"email",value:b,quick:c});break;case"confirmPassword":this.component.trigger("uiSignupValidate",$.extend({name:"user[user_confirm_password]",username:"username",fullname:"fullname",email:"email",value:b,quick:c},d));break;case"mobileNumber":this.component.trigger("uiSignupValidate",{name:"device[address]",username:"username",fullname:"fullname",email:"email",value:b,quick:c})}}beforeEach(function(){var a='<form id="phx-signup-form" method="POST">\n  <fieldset class="textbox">\n    <div class="prompt name">\n      <div class="holding" data-fieldname="name">\n        <div class="sidetip">\n          <p class="ok isaok">Name looks great.</p>\n          <p class="tip">Enter your first and last name.</p>\n          <p class="blank invalid error" role="alert">A name is required!</p>\n        </div>\n        <input type="text" autocomplete="off" value="" name="user[name]" maxlength="20" aria-required="true" />\n        <span class="holder">Full name</span>\n      </div>\n    </div>\n  </fieldset>\n</form>\n    ';jasmine.Clock.useMock(),setupComponent(a,{bannedPasswords:["cnffjbeq"]})}),describe("quick username validation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowTip"),spyOnEvent(this.$node,"uiValidated"),this.expectValidatedEventFail=function(){expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.$node,{field:"username",valid:null,quick:!0})}}),it("quick validates blank",function(){a.call(this,"username","",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"blank"),this.expectValidatedEventFail()}),it("quick validates @",function(){a.call(this,"username","@",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"tip"),expect("uiValidated").not.toHaveBeenTriggeredOn(this.$node)}),it("quick validates invalid chars",function(){a.call(this,"username","!@#$%^&*()",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"invalid"),this.expectValidatedEventFail()}),it("quick validates too long",function(){a.call(this,"username",(new Array(17)).join("a"),!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"invalid"),this.expectValidatedEventFail()}),it("quick validates valid",function(){a.call(this,"username","flange",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"tip"),expect("uiValidated").not.toHaveBeenTriggeredOn(this.$node)})}),describe("full username validation",function(){beforeEach(function(){spyOnEvent(this.$node,"dataValidateUsername"),this.ajaxDataForUser=function(a,b){return{suggest:1,username:a,full_name:"fullname",email:"email",context:"signup",custom:!0,suggest_on_username:b}}}),it("full validates blank",function(){a.call(this,"username","",!1),expect("dataValidateUsername").toHaveBeenTriggeredOnAndWith(this.$node,this.ajaxDataForUser("",!1))}),it("full validates @",function(){a.call(this,"username","@",!1),expect("dataValidateUsername").not.toHaveBeenTriggeredOn(this.$node)}),it("full validates invalid chars",function(){a.call(this,"username","!@#$%^&*()",!1),expect("dataValidateUsername").toHaveBeenTriggeredOnAndWith(this.$node,this.ajaxDataForUser("!@#$%^&*()",!0))}),it("full validates too long",function(){var b=(new Array(17)).join("a");a.call(this,"username",b,!1),expect("dataValidateUsername").toHaveBeenTriggeredOnAndWith(this.$node,this.ajaxDataForUser(b,!0))}),it("full validates valid",function(){a.call(this,"username","flange",!1),expect("dataValidateUsername").toHaveBeenTriggeredOnAndWith(this.$node,this.ajaxDataForUser("flange",!0))})}),describe("quick email validation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowTip"),spyOnEvent(this.$node,"uiValidated"),this.expectValidatedEventFail=function(a){expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.$node,{field:"email",valid:a,quick:!0})}}),it("quick validates blank",function(){a.call(this,"email","",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"tip"),this.expectValidatedEventFail(!0)}),it("quick validates @",function(){a.call(this,"email","@",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"tip"),this.expectValidatedEventFail(!0)}),it("quick validates invalid chars",function(){a.call(this,"email","!@#$%^&*()",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"tip"),this.expectValidatedEventFail(!0)}),it("quick validates too long",function(){a.call(this,"email",(new Array(17)).join("a"),!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"tip"),this.expectValidatedEventFail(!0)}),it("quick validates valid",function(){a.call(this,"email","maple@example.com",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"tip"),this.expectValidatedEventFail(!0)})}),describe("full email validation",function(){beforeEach(function(){spyOnEvent(this.$node,"dataValidateEmail"),spyOnEvent(this.$node,"dataValidateUsername"),this.ajaxDataForEmail=function(a){return{email:a}},this.ajaxDataForUsername=function(a){return{suggest:1,username:"username",full_name:"fullname",email:a,context:"signup",custom:0,suggest_on_username:!1}}}),it("full validates blank",function(){a.call(this,"email","",!1),expect("dataValidateEmail").not.toHaveBeenTriggeredOnAndWith(this.$node)}),it("full validates @",function(){a.call(this,"email","@",!1),expect("dataValidateEmail").not.toHaveBeenTriggeredOnAndWith(this.$node)}),it("full validates invalid chars",function(){a.call(this,"email","!@#$%^&*()",!1),expect("dataValidateEmail").not.toHaveBeenTriggeredOnAndWith(this.$node)}),it("full validates too long",function(){var b=(new Array(17)).join("a");a.call(this,"email",b,!1),expect("dataValidateEmail").not.toHaveBeenTriggeredOnAndWith(this.$node)}),it("full validates valid",function(){a.call(this,"email","maple@example.com",!1),expect("dataValidateEmail").toHaveBeenTriggeredOnAndWith(this.$node,this.ajaxDataForEmail("maple@example.com")),expect("dataValidateUsername").toHaveBeenTriggeredOnAndWith(this.$node,this.ajaxDataForUsername("maple@example.com"))})}),describe("quick fullname validation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowTip"),spyOnEvent(this.$node,"uiValidated"),this.expectValidatedEventFail=function(a){expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.$node,{field:"name",valid:a,quick:!0})}}),it("quick validates blank",function(){a.call(this,"name","",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"blank"),this.expectValidatedEventFail(!1)}),it('quick validates " "',function(){a.call(this,"name"," ",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"invalid"),this.expectValidatedEventFail(!1)}),it("quick validates valid",function(){a.call(this,"name","bob",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"tip"),this.expectValidatedEventFail(!0)})}),describe("full fullname validation",function(){beforeEach(function(){spyOnEvent(this.$node,"dataValidateUsername")}),it("full validates blank",function(){a.call(this,"name","",!1),expect("dataValidateUsername").not.toHaveBeenTriggeredOnAndWith(this.$node)}),it('full validates " "',function(){a.call(this,"name"," ",!1),expect("dataValidateUsername").not.toHaveBeenTriggeredOnAndWith(this.$node)})}),describe("quick password validation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowTip"),spyOnEvent(this.$node,"uiValidated"),this.expectValidatedEventFail=function(a){expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.$node,{field:"password",valid:a,quick:!0})}}),it("quick validates blank",function(){a.call(this,"password","",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"blank"),this.expectValidatedEventFail(!1)}),it("quick validates less than 6 chars",function(){a.call(this,"password","12345",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"invalid"),this.expectValidatedEventFail(!1)}),it("quick validates valid",function(){a.call(this,"password","ponyhouseboatmango",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"tip"),this.expectValidatedEventFail(!0)})}),describe("full password validation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowTip"),spyOnEvent(this.$node,"dataPasswordStrength"),this.ajaxDataForName=function(a){return{suggest:1,username:"username",full_name:"fullname",password:"ponyhouseboatmango",email:"email",context:"signup",custom:0,suggest_on_username:!0}}}),it("full validates blank",function(){a.call(this,"password","",!1),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"invalid"),expect("dataPasswordStrength").not.toHaveBeenTriggeredOnAndWith(this.$node)}),it('full validates "password"',function(){a.call(this,"password","password",!1),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"obvious"),expect("dataPasswordStrength").not.toHaveBeenTriggeredOnAndWith(this.$node)}),it("full validates valid",function(){a.call(this,"password","ponyhouseboatmango",!1),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"ok"),expect("dataPasswordStrength").toHaveBeenTriggeredOnAndWith(this.$node,62)}),it('full validates "password" is "username"',function(){a.call(this,"password","UsErNaMe",!1),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"obvious"),expect("dataPasswordStrength").not.toHaveBeenTriggeredOnAndWith(this.$node)}),it('full validates "password" is "fullname"',function(){a.call(this,"password","FuLlNaMe",!1),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"obvious"),expect("dataPasswordStrength").not.toHaveBeenTriggeredOnAndWith(this.$node)})}),describe("confirmEmail validation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowTip"),spyOnEvent(this.$node,"uiValidated"),this.expectValidatedEventFail=function(a){expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.$node,{field:"confirmEmail",valid:a,quick:!0})}}),it("validates email mismatch",function(){a.call(this,"confirmEmail","derp@derp.net",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"no-match"),this.expectValidatedEventFail(!1)}),it("validates email match",function(){a.call(this,"confirmEmail","gron@gron.com",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"match"),this.expectValidatedEventFail(!0)})}),describe("confirmPassword validation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowTip"),spyOnEvent(this.$node,"uiValidated"),this.expectValidatedEventFail=function(a){expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.$node,{field:"confirmPassword",valid:a,quick:!0})}}),it("validates password mismatch",function(){a.call(this,"confirmPassword","ponyhouseboatmango",!0,{password:"notponyhouse"}),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"no-match"),this.expectValidatedEventFail(!1)}),it("validates password match",function(){a.call(this,"confirmPassword","ponyhouseboatmango",!0,{password:"ponyhouseboatmango"}),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"match"),this.expectValidatedEventFail(!0)})}),describe("quick mobile number validation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowTip"),spyOnEvent(this.$node,"uiValidated")}),it("quick does not validate blank",function(){a.call(this,"mobileNumber","",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,""),expect("uiValidated").not.toHaveBeenTriggeredOn(this.$node)}),it("quick does not validate valid",function(){a.call(this,"mobileNumber","415-867-5309",!0),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,""),expect("uiValidated").not.toHaveBeenTriggeredOn(this.$node)})}),describe("full mobile number validation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowTip"),spyOnEvent(this.$node,"uiValidated"),this.expectMobileNumberToBeValid=function(a){expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.$node,{field:"mobileNumber",valid:a,quick:!1})}}),it("full does not validate blank",function(){a.call(this,"mobileNumber","",!1),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,""),this.expectMobileNumberToBeValid(!1)}),it("full does not validate invalid number",function(){a.call(this,"mobileNumber","867-5309",!1),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"invalid"),this.expectMobileNumberToBeValid(!1)}),it("full validates valid",function(){a.call(this,"mobileNumber","415-867-5309",!1),expect("uiShowTip").toHaveBeenTriggeredOnAndWith(this.$node,"ok"),this.expectMobileNumberToBeValid(!0)})})})
});
define("test/app/data/login_verification_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/login_verification",function(){beforeEach(setupComponent),describe("event uiCheckLoginVerification",function(){it("makes ajax request to check login verification",function(){this.component.trigger("uiCheckLoginVerification"),expect($.ajax.mostRecentOptions.url).toBe("/account/login_verification/is_verified"),expect($.ajax.mostRecentOptions.type).toEqual("GET")}),it("triggers dataLoginVerificationSuccess, success case",function(){spyOnEvent(document,"dataLoginVerificationSuccess"),ajaxRespondWithSuccess({html:"html"}),this.component.trigger("uiCheckLoginVerification"),expect("dataLoginVerificationSuccess").toHaveBeenTriggeredOnAndWith(document,{html:"html"})}),it("triggers dataLoginVerificationError, error case",function(){spyOnEvent(document,"dataLoginVerificationError"),ajaxRespondWithError({}),this.component.trigger("uiCheckLoginVerification"),expect("dataLoginVerificationError").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/resend_password_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/resend_password",function(){beforeEach(setupComponent),describe("email or phone validation event",function(){it("clears error messages on empty string",function(){spyOnEvent(document,"dataEmailOrPhoneResult"),this.component.trigger("uiEmailOrPhoneChange",{emailorphone:""}),expect("dataEmailOrPhoneResult").toHaveBeenTriggeredOnAndWith(document,{valid:!0,msg:" "})}),it("does not accept spaces",function(){spyOnEvent(document,"dataEmailOrPhoneResult"),this.component.trigger("uiEmailOrPhoneChange",{emailorphone:"email@ space.com"}),expect("dataEmailOrPhoneResult").toHaveBeenTriggeredOnAndWith(document,{valid:!1,msg:"Email or phone cannot include spaces"})}),it("returns valid if email exists",function(){spyOnEvent(document,"dataEmailOrPhoneResult"),ajaxRespondWithSuccess({valid:!0,msg:"Looks good!"}),this.component.trigger("uiEmailOrPhoneChange",{emailorphone:"jack@twitter.com"}),expect("dataEmailOrPhoneResult").toHaveBeenTriggeredOnAndWith(document,{valid:!0,msg:"Looks good!"})}),it("returns invalid if email does not exist",function(){spyOnEvent(document,"dataEmailOrPhoneResult"),ajaxRespondWithSuccess({valid:!1,msg:"Email or phone is invalid"}),this.component.trigger("uiEmailOrPhoneChange",{emailorphone:"jack1234@twitter.com"}),expect("dataEmailOrPhoneResult").toHaveBeenTriggeredOnAndWith(document,{valid:!1,msg:"Email or phone is invalid"})}),it("returns valid if phone number is in correct format",function(){spyOnEvent(document,"dataEmailOrPhoneResult"),ajaxRespondWithSuccess({valid:!0,msg:"Looks good!"}),this.component.trigger("uiEmailOrPhoneChange",{emailorphone:"4159999875"}),expect("dataEmailOrPhoneResult").toHaveBeenTriggeredOnAndWith(document,{valid:!0,msg:"Looks good!"})}),it("returns invalid if phone number is not in correct format",function(){spyOnEvent(document,"dataEmailOrPhoneResult"),ajaxRespondWithSuccess({valid:!1,msg:"Email or phone is invalid"}),this.component.trigger("uiEmailOrPhoneChange",{emailorphone:"004159999875"}),expect("dataEmailOrPhoneResult").toHaveBeenTriggeredOnAndWith(document,{valid:!1,msg:"Email or phone is invalid"})})}),describe("phone number validation event",function(){it("clears error messages on empty string",function(){spyOnEvent(document,"dataUsernameResult"),this.component.trigger("uiUsernameChange",{username:""}),expect("dataUsernameResult").toHaveBeenTriggeredOnAndWith(document,{valid:!0,msg:" "})}),it("does not accept spaces",function(){spyOnEvent(document,"dataUsernameResult"),this.component.trigger("uiUsernameChange",{username:"jack space"}),expect("dataUsernameResult").toHaveBeenTriggeredOnAndWith(document,{valid:!1,msg:"Username cannot include spaces"})}),it("does not accept malformed input",function(){spyOnEvent(document,"dataUsernameResult"),this.component.trigger("uiUsernameChange",{username:"@!#%!@%"}),expect("dataUsernameResult").toHaveBeenTriggeredOnAndWith(document,{valid:!1,msg:"Username is invalid"})}),it("returns valid if username exists",function(){spyOnEvent(document,"dataUsernameResult"),ajaxRespondWithSuccess({valid:!0,msg:"Looks good!"}),this.component.trigger("uiUsernameChange",{username:"jack"}),expect("dataUsernameResult").toHaveBeenTriggeredOnAndWith(document,{valid:!0,msg:"Looks good!"})}),it("returns invalid if username does not exist",function(){spyOnEvent(document,"dataUsernameResult"),ajaxRespondWithSuccess({valid:!1,msg:"Username is invalid"}),this.component.trigger("uiUsernameChange",{username:"jackjack"}),expect("dataUsernameResult").toHaveBeenTriggeredOnAndWith(document,{valid:!1,msg:"Username is invalid"})})})})
});
define("test/app/data/profile_social_proof_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/profile_social_proof_scribe",function(){it("scribes the rendering of the social proof module",function(){setupComponent(),this.component.trigger("uiHasProfileSocialProof"),expect(this.component).toScribe({component:"profile_follow_card",element:"social_proof",action:"impression"})})})
});
define("test/app/data/user_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/user",function(){beforeEach(function(){setupComponent({formAuthenticityToken:"dummy auth token"})}),describe("on uiFollowAction",function(){it("makes an ajax call to the follow action of the user actions controller, passing the user id",function(){ajaxRespondWithSuccess({}),$(document).trigger("uiFollowAction",{userId:174958347,originalFollowState:"not-following",impressionId:187,disclosureType:"promoted"}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/follow"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({user_id:174958347,impression_id:187,earned:!1}))}),it("makes an ajax call to the follow action of the user actions controller, with an earned disclosure type",function(){ajaxRespondWithSuccess({}),$(document).trigger("uiFollowAction",{userId:174958347,originalFollowState:"not-following",impressionId:187,disclosureType:"earned"}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/follow"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({user_id:174958347,impression_id:187,earned:!0}))}),describe("with a success response",function(){beforeEach(function(){ajaxRespondWithSuccess({new_state:"following"}),spyOnEvent(document,"dataFollowStateChange"),$(document).trigger("uiFollowAction",{userId:174958347,originalFollowState:"not-following"})}),it("triggers a dataFollowStateChange",function(){expect("dataFollowStateChange").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({userId:174958347,newState:"following"}))})}),describe("with a success follow back response",function(){beforeEach(function(){ajaxRespondWithSuccess({new_state:"following",is_follow_back:!0}),spyOnEvent(document,"dataFollowStateChange"),$(document).trigger("uiFollowAction",{userId:174958347,originalFollowState:"not-following"})}),it("triggers a dataFollowStateChange with isFollowBack",function(){expect("dataFollowStateChange").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({userId:174958347,newState:"following",isFollowBack:!0}))})}),describe("with an error response",function(){beforeEach(function(){ajaxRespondWithError({}),spyOnEvent(document,"dataFollowStateChange"),$(document).trigger("uiFollowAction",{userId:174958347,originalFollowState:"not-following"})}),it("triggers a dataFollowStateChange",function(){expect("dataFollowStateChange").toHaveBeenTriggeredOn(document)}),it("passes the user id and new state with the event",function(){expect("dataFollowStateChange").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({userId:174958347,newState:"not-following"}))})}),describe("with an error response containing the new state",function(){describe("where the new state is pending",function(){beforeEach(function(){ajaxRespondWithError({responseText:JSON.stringify({new_state:"pending"})}),spyOnEvent(document,"dataFollowStateChange"),$(document).trigger("uiFollowAction",{userId:174958347,originalFollowState:"not-following"})}),it("should trigger a state change with the state returned by the server",function(){expect("dataFollowStateChange").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({userId:174958347,newState:"pending"}))})}),describe("where the new state is blocked",function(){beforeEach(function(){ajaxRespondWithError({responseText:JSON.stringify({new_state:"blocked"})}),spyOnEvent(document,"dataFollowStateChange"),$(document).trigger("uiFollowAction",{userId:174958347,originalFollowState:"not-following"})}),it("should trigger a state change with the state returned by the server",function(){expect("dataFollowStateChange").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({userId:174958347,newState:"blocked"}))})})})}),describe("on uiUnfollowAction",function(){it("makes an ajax call to the unfollow action of the user actions controller",function(){$(document).trigger("uiUnfollowAction",{userId:174958347,originalFollowState:"following",impressionId:187}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/unfollow"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({user_id:174958347,impression_id:187}))})}),describe("on uiCancelFollowRequestAction",function(){it("makes an ajax call to the cancel action of the user actions controller",function(){$(document).trigger("uiCancelFollowRequestAction",{userId:174958347,originalFollowState:"pending"}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/cancel")})}),describe("on uiBlockAction",function(){it("makes an ajax call to the block action of the user actions controller",function(){$(document).trigger("uiBlockAction",{userId:174958347,originalFollowState:"not-following",impressionId:187}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/block"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({user_id:174958347,impression_id:187}))})}),describe("on uiUnblockAction",function(){it("makes an ajax call to the unblock action of the user actions controller",function(){$(document).trigger("uiUnblockAction",{userId:174958347,originalFollowState:"blocked",impressionId:187}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/unblock"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({user_id:174958347,impression_id:187}))})}),describe("on uiReportSpamAction",function(){it("makes an ajax call to the report_spam action of the user actions controller",function(){$(document).trigger("uiReportSpamAction",{userId:174958347,impressionId:187}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/report_spam"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({user_id:174958347,impression_id:187}))})}),describe("on uiHideSuggestionAction",function(){it("makes an ajax call to the hide action of the user actions controller",function(){$(document).trigger("uiHideSuggestionAction",{userId:174958347}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/hide")})}),describe("on uiRetweetOnAction",function(){it("makes an ajax call to the retweets_on action of the user actions controller",function(){$(document).trigger("uiRetweetOnAction",{userId:174958347}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/retweets_on")}),describe("with an error response",function(){it("triggers a dataRetweetsOffAction",function(){ajaxRespondWithError({}),spyOnEvent(document,"dataRetweetOffAction"),$(document).trigger("uiRetweetOnAction",{userId:174958347}),expect("dataRetweetOffAction").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({userId:174958347}))})})}),describe("on uiRetweetOffAction",function(){it("makes an ajax call to the retweets_off action of the user actions controller",function(){$(document).trigger("uiRetweetOffAction",{userId:174958347}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/retweets_off")}),describe("with an error response",function(){it("triggers a dataRetweetsOnAction",function(){ajaxRespondWithError({}),spyOnEvent(document,"dataRetweetOnAction"),$(document).trigger("uiRetweetOffAction",{userId:174958347}),expect("dataRetweetOnAction").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({userId:174958347}))})})}),describe("on uiDeviceNotificationsOnAction",function(){it("makes an ajax call to the device_notifications_on action of the user actions controller",function(){$(document).trigger("uiDeviceNotificationsOnAction",{userId:174958347}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/device_notifications_on")})}),describe("on uiDeviceNotificationsOffAction",function(){it("makes an ajax call to the device_notifications_off action of the user actions controller",function(){$(document).trigger("uiDeviceNotificationsOffAction",{userId:174958347}),expect($.ajax.mostRecentOptions.url).toEqual("/i/user/device_notifications_off")})}),describe("updateFollowStatus",function(){describe("when the server returns no profile stats phrases",function(){it("does not trigger dataGotProfileStat",function(){spyOnEvent(document,"dataGotProfileStat"),ajaxRespondWithSuccess({}),this.component.updateFollowStatus({userId:1},"/i/user/follow"),expect("dataGotProfileStat").not.toHaveBeenTriggeredOn(document)})}),describe("when the server returns profile stats phrases",function(){it("triggers dataGotProfileStat for each stat returned",function(){var a=[],b=[{user_id:3,stat:"following",html:"3 Following"},{user_id:707,stat:"follower",html:"3 Followers"}];spyOnEvent(document,"dataGotProfileStats"),ajaxRespondWithSuccess({profile_stats:b}),this.component.updateFollowStatus({userId:1},"/i/user/follow"),expect("dataGotProfileStats").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({stats:b}))})})})})
});
define("test/app/data/settings_spec",["module","require","exports"],function(module, require, exports) {
describeComponentWithDataComponents("app/data/settings",["app/data/settings/account_scribe"],function(){beforeEach(setupComponent),it("fires dataUsernameResult on uiUsernameChange",function(){spyOnEvent(document,"dataUsernameResult"),ajaxRespondWithSuccess({valid:!0,msg:"username available"}),this.component.trigger("uiUsernameChange",{username:"chatty"}),expect("dataUsernameResult").toHaveBeenTriggeredOnAndWith(document,{valid:!0,msg:"username available"}),expect(this.accountScribe).toScribe({action:"success"})}),it("fires dataEmailResult on uiEmailChange",function(){spyOnEvent(document,"dataEmailResult"),ajaxRespondWithSuccess({valid:!0,msg:"email available"}),this.component.trigger("uiEmailChange",{username:"chatty@example.com"}),expect("dataEmailResult").toHaveBeenTriggeredOnAndWith(document,{valid:!0,msg:"email available"}),expect(this.accountScribe).toScribe({action:"success"})}),describe("enhanced profile events",function(){beforeEach(function(){setupComponent({formAuthenticityToken:"dummy auth token"}),this.scribeContext={component:"profile_banner"},this.component.attr.eventData={scribeContext:this.scribeContext}}),describe("on uiImageSave",function(){beforeEach(function(){setupComponent({pageName:"settings",sectionName:"profile"}),spyOnEvent(document,"dataImageEnqueued"),spyOnEvent(document,"dataImageFailedToEnqueue")}),describe("with 'header' uploadType",function(){it("triggers dataImageEnqueued on success with the proper url and data",function(){ajaxRespondWithSuccess({}),this.component.trigger("uiImageSave",{uploadType:"header"}),expect(jQuery.ajax.mostRecentOptions.url).toBe("/settings/profile/upload_profile_header"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({page_context:"settings",section_context:"profile"})),expect("dataImageEnqueued").toHaveBeenTriggeredOn(document)}),it("triggers dataImageFailedToEnqueue on error",function(){ajaxRespondWithError({}),this.component.trigger("uiImageSave",{uploadType:"header"}),expect("dataImageFailedToEnqueue").toHaveBeenTriggeredOn(document)})}),describe("with 'avatar' uploadType",function(){it("triggers dataImageEnqueued on success with the proper url and data",function(){ajaxRespondWithSuccess({}),this.component.trigger("uiImageSave",{uploadType:"avatar"}),expect(jQuery.ajax.mostRecentOptions.url).toBe("/settings/profile/profile_image_update"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({page_context:"settings",section_context:"profile"})),expect("dataImageEnqueued").toHaveBeenTriggeredOn(document)}),it("triggers dataImageFailedToEnqueue on error",function(){ajaxRespondWithError({}),this.component.trigger("uiImageSave",{uploadType:"avatar"}),expect("dataImageFailedToEnqueue").toHaveBeenTriggeredOn(document)})})}),describe("on uiDeleteImage",function(){beforeEach(function(){setupComponent({pageName:"settings",sectionName:"profile"}),spyOnEvent(document,"dataDeleteImageSuccess"),spyOnEvent(document,"dataDeleteImageFailure")}),describe("with 'header' uploadType",function(){it("triggers dataDeleteImageSuccess on success with the proper url and data",function(){ajaxRespondWithSuccess({}),this.component.trigger("uiDeleteImage",{uploadType:"header"}),expect(jQuery.ajax.mostRecentOptions.url).toBe("/settings/profile/destroy_profile_header"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({page_context:"settings",section_context:"profile"})),expect("dataDeleteImageSuccess").toHaveBeenTriggeredOn(document)}),it("triggers dataDeleteImageFailure on error",function(){ajaxRespondWithError({}),this.component.trigger("uiDeleteImage",{uploadType:"header"}),expect("dataDeleteImageFailure").toHaveBeenTriggeredOn(document)})}),describe("with 'avatar' uploadType",function(){it("triggers dataImageEnqueued on success with the proper url and data",function(){ajaxRespondWithSuccess({}),this.component.trigger("uiDeleteImage",{uploadType:"avatar"}),expect(jQuery.ajax.mostRecentOptions.url).toBe("/settings/profile/destroy_avatar"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({page_context:"settings",section_context:"profile"})),expect("dataDeleteImageSuccess").toHaveBeenTriggeredOn(document)}),it("triggers dataDeleteImageFailure on error",function(){ajaxRespondWithError({}),this.component.trigger("uiDeleteImage",{uploadType:"avatar"}),expect("dataDeleteImageFailure").toHaveBeenTriggeredOn(document)})})})})})
});
define("test/app/data/tweet_actions_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/tweet_actions_scribe",function(){beforeEach(function(){setupComponent(undefined,{itemType:"tweet"})}),it("scribes when a retweet is sent",function(){this.component.trigger("uiDidRetweetSuccess",{tweetId:1,retweetId:2,itemType:"tweet",position:3}),expect(this.component).toScribe({action:"retweet"},{items:[{id:1,item_type:0,position:3,retweeting_tweet_id:2}]})}),it("scribes when a delete happens",function(){this.component.trigger("uiDidDeleteTweet",{sourceEventData:{tweetId:2,impressionId:"aaa",itemType:"tweet",position:3}}),expect(this.component).toScribe({action:"delete"},{items:[{id:2,item_type:0,position:3,promoted_id:"aaa"}],promoted:!0})}),it("scribes when an unretweet happens",function(){this.component.trigger("dataDidUnretweet",{sourceEventData:{tweetId:3,retweetId:4,itemType:"tweet",position:3}}),expect(this.component).toScribe({action:"unretweet"},{items:[{id:3,item_type:0,position:3,retweeting_tweet_id:4}]})}),it("scribes when a favorite happens",function(){this.component.trigger("dataDidFavoriteTweet",{sourceEventData:{tweetId:2,impressionId:"aaa",itemType:"tweet",position:3}}),expect(this.component).toScribe({action:"favorite"},{items:[{id:2,item_type:0,position:3,promoted_id:"aaa"}]})}),it("scribes when a unfavorite happens",function(){this.component.trigger("dataDidUnfavoriteTweet",{sourceEventData:{tweetId:1,itemType:"tweet",position:3}}),expect(this.component).toScribe({action:"unfavorite"},{items:[{id:1,item_type:0,position:3}]})}),it("scribes when a translation happens",function(){this.component.trigger("dataTweetTranslationSuccess",{sourceEventData:{tweetId:1,itemType:"tweet",position:3,dest:"en"}}),expect(this.component).toScribe({action:"translate"},{items:[{id:1,item_type:0,position:3,dest:"en"}]})}),it("scribes when a pin happens",function(){this.component.trigger("dataDidUserPinTweet",{sourceEventData:{tweetId:1,itemType:"tweet",position:3,dest:"en"}}),expect(this.component).toScribe({action:"pin"},{items:[{id:1,item_type:0,position:3,dest:"en"}]})}),it("scribes when an unpin happens",function(){this.component.trigger("dataDidUserUnpinTweet",{sourceEventData:{tweetId:1,itemType:"tweet",position:3,dest:"en"}}),expect(this.component).toScribe({action:"unpin"},{items:[{id:1,item_type:0,position:3,dest:"en"}]})})})
});
define("test/app/data/trends_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/trends",function(){var a;beforeEach(function(){this.mockResponse={dialog_html:"",update_module_html:!1,woeid:1},ajaxRespondWithSuccess(this.mockResponse),jasmine.Clock.useMock(),a=$("<div></div>"),setupComponent({$backoffNode:a,trendsCacheKey:"abc"})}),describe("event uiWantsTrendsDialog",function(){it("makes a GET request to /trends/dialog",function(){this.component.trigger("uiWantsTrendsDialog"),expect($.ajax.mostRecentOptions.url).toBe("/trends/dialog"),expect($.ajax.mostRecentOptions.type).toBe("GET"),expect($.ajax.mostRecentOptions.data.pc).toBe(!0)}),it("does not trigger uiRefreshTrends if update_module_html is not returned",function(){spyOnEvent(document,"uiRefreshTrends"),this.component.trigger("uiWantsTrendsDialog"),expect("uiRefreshTrends").not.toHaveBeenTriggeredOn(document)}),it("does not update the currentCacheKey if none is returned",function(){this.component.trigger("uiWantsTrendsDialog"),expect(this.component.currentCacheKey).toBe("abc")})}),describe("event uiChangeTrendsLocation",function(){it("makes a POST request to change trends location",function(){this.component.trigger("uiChangeTrendsLocation",{woeid:123}),expect($.ajax).toHaveBeenCalledWith(jasmine.objectContaining({url:"/trends/dialog",data:jasmine.objectContaining({woeid:123}),type:"POST"}))}),it("makes a POST request to change trends to personalized",function(){this.component.trigger("uiChangeTrendsLocation",{personalized:!0}),expect($.ajax).toHaveBeenCalledWith(jasmine.objectContaining({url:"/trends/dialog",data:jasmine.objectContaining({personalized:!0}),type:"POST"}))}),it("triggers dataTrendsRefreshed on success",function(){spyOnEvent(document,"uiRefreshTrends"),this.mockResponse.update_module_html="<div></div>",this.component.trigger("uiChangeTrendsLocation",{woeid:123}),expect("uiRefreshTrends").toHaveBeenTriggeredOnAndWith(document,this.mockResponse)}),it("updates the currentCacheKey when given",function(){this.mockResponse.trends_cache_key="xyz",this.component.trigger("uiChangeTrendsLocation",{woeid:123}),expect(this.component.currentCacheKey).toBe("xyz"),this.component.trigger("uiRefreshTrends"),expect($.ajax.mostRecentOptions.data.k).toBe("xyz")}),it("triggers dataPageMutated if the cache key is found in the response",function(){this.mockResponse.trends_cache_key="xyz",spyOnEvent(document,"dataPageMutated"),this.component.trigger("uiChangeTrendsLocation",{woeid:123}),expect("dataPageMutated").toHaveBeenTriggeredOn(document)})}),describe("event uiRefreshTrends",function(){it("makes ajax request with the current trends cache key",function(){this.component.trigger("uiRefreshTrends"),expect($.ajax).toHaveBeenCalled(),expect($.ajax.mostRecentOptions.data.k).toBe("abc"),expect($.ajax.mostRecentOptions.data.pc).toBe(!0)}),it("triggers dataTrendsRefreshed",function(){spyOnEvent(document,"dataTrendsRefreshed"),this.component.trigger("uiRefreshTrends"),expect("dataTrendsRefreshed").toHaveBeenTriggeredOnAndWith(document,this.mockResponse)}),it("triggers dataTrendsRefreshed with source: clock when triggered by a timer",function(){spyOnEvent(document,"dataTrendsRefreshed"),this.component.trigger("uiRefreshTrends",{source:"clock"}),expect("dataTrendsRefreshed").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({source:"clock"}))}),it("does not reset the cache key if not found in the response",function(){this.component.trigger("uiRefreshTrends"),expect(this.component.currentCacheKey).toBe("abc"),this.component.trigger("uiRefreshTrends"),expect($.ajax.mostRecentOptions.data.k).toBe("abc")}),it("does not trigger dataPageMutated if the cache key is not found in the response",function(){spyOnEvent(document,"dataPageMutated"),this.component.trigger("uiRefreshTrends"),expect("dataPageMutated").not.toHaveBeenTriggeredOn(document)})}),describe("event dataTrendsLocationChanged",function(){it("is not triggered when there is no change on location",function(){spyOnEvent(document,"dataTrendsLocationChanged"),this.component.trigger("uiChangeTrendsLocation",{woeid:123}),expect("dataTrendsLocationChanged").not.toHaveBeenTriggeredOn(document),this.component.trigger("uiChangeTrendsLocation",{woeid:123}),expect("dataTrendsLocationChanged").not.toHaveBeenTriggeredOn(document)}),it("should be triggered when the location has changed",function(){spyOnEvent(document,"dataTrendsLocationChanged"),this.component.trigger("uiChangeTrendsLocation",{woeid:123}),this.mockResponse.woeid="123",this.component.trigger("uiChangeTrendsLocation",{woeid:123}),expect("dataTrendsLocationChanged").toHaveBeenTriggeredOn(document)})}),describe("polling backoff",function(){var b;beforeEach(function(){jasmine.Clock.useMock(),b=jasmine.createSpy(this.component.refreshTrends),$(document).on("uiRefreshTrends",b)}),it("triggers uiRefreshTrends at focusedInterval when node focused",function(){a.focus(),expect(b.callCount).toBe(0),jasmine.Clock.tick(this.component.attr.trendsPollingOptions.focusedInterval),expect(b.callCount).toBe(1),jasmine.Clock.tick(this.component.attr.trendsPollingOptions.focusedInterval*4),expect(b.callCount).toBe(5)}),it("triggers uiRefreshTrends at unfocusedInterval when node blurred",function(){var c=this.component.attr.trendsPollingOptions.focusedInterval;a.blur(),expect(b.callCount).toBe(0),jasmine.Clock.tick(c),expect(b.callCount).toBe(1),jasmine.Clock.tick(c*2),expect(b.callCount).toBe(2),jasmine.Clock.tick(c*4),expect(b.callCount).toBe(3),jasmine.Clock.tick(c*8),expect(b.callCount).toBe(5)})})})
});
define("test/app/data/activity_popup_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/activity_popup_scribe",function(){var a="42",b={item_count:1,item_ids:[a]};beforeEach(function(){setupComponent(),this.triggerProfilePopupOpen=function(a){this.component.trigger("dataActivityPopupSuccess",{sourceEventData:a})}}),it("scribes on a retweeted popup open",function(){this.triggerProfilePopupOpen({tweetId:a,scribeContext:{component:"retweeted_dialog"}}),expect(this.component).toScribe({action:"open",component:"retweeted_dialog"},b)}),it("scribes on a favorited popup open",function(){this.triggerProfilePopupOpen({tweetId:a,scribeContext:{component:"favorited_dialog"}}),expect(this.component).toScribe({action:"open",component:"favorited_dialog"},b)})})
});
define("test/app/data/conversations_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/conversations",function(){var a;beforeEach(function(){setupComponent(),spyOnEvent(document,"dataTweetConversationResult"),spyOnEvent(document,"dataTweetSocialProofResult"),a=$('<div data-tweet-id="45"></div>'),this.component.$node.append(a)}),describe("event uiNeedsTweetExpandedContent",function(){it("triggers three data events after a successful ajax call",function(){ajaxRespondWithSuccess({descendants:"",ancestors:"",social_proof:""}),a.trigger("uiNeedsTweetExpandedContent",{}),expect($.ajax.mostRecentOptions.url).toBe("/i/expanded/batch/45");var b={descendants:"",ancestors:"",social_proof:""};expect("dataTweetConversationResult").toHaveBeenTriggeredOnAndWith(document,b),expect("dataTweetSocialProofResult").toHaveBeenTriggeredOnAndWith(document,b)}),it("does not ask for ancestors and descendants when loadAncestors and loadDescendants aren't specified",function(){ajaxRespondWithSuccess({}),a.trigger("uiNeedsTweetExpandedContent",{loadSocialProof:!0}),expect($.ajax.mostRecentOptions.data.include).toEqual(["social_proof"])}),it("asks for ancestors when loadAncestors is true",function(){ajaxRespondWithSuccess({}),a.trigger("uiNeedsTweetExpandedContent",{loadAncestors:!0}),expect($.ajax.mostRecentOptions.data.include).toEqual(["ancestors"])}),it("asks for descendants when loadSocialProof is true",function(){ajaxRespondWithSuccess({}),a.trigger("uiNeedsTweetExpandedContent",{loadSocialProof:!0}),expect($.ajax.mostRecentOptions.data.include).toEqual(["social_proof"])}),it("asks for ancestors, descendants, and social proof when appropriate flags are set",function(){ajaxRespondWithSuccess({}),a.trigger("uiNeedsTweetExpandedContent",{loadAncestors:!0,loadDescendants:!0,loadSocialProof:!0}),expect($.ajax.mostRecentOptions.data.include).toEqual(["social_proof","ancestors","descendants"])})})})
});
define("test/app/data/profile_alerts_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/profile_alerts_scribe",function(){beforeEach(function(){var a='<div>\n  <form class="signinfrm">\n    <input type="submit">\n  </form>\n  <form class="signup">\n    <input type="submit">\n  </form>\n</div>\n    ';setupComponent(a),this.$node.on("submit",function(a){a.preventDefault()})}),it("scribes signin form submit",function(){this.$node.find(".signinfrm input").click(),expect(this.component).toScribe({page:"profile",section:"alerts",component:"login_callout",element:"form",action:"login_click"})}),it("scribes signup form submit",function(){this.$node.find(".signup input").click(),expect(this.component).toScribe({page:"profile",section:"alerts",component:"signup_callout",element:"form",action:"signup_click"})})})
});
define("test/app/data/navigation_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/navigation",function(){var a='<div>\n      <div id="doc">\n        <a id="newplace" href="/newplace" class="js-nav">PUSHSTATE</a>\n        <div class="js-global-actions"><a id="somewhere" href="/somewhere" class="js-nav">PUSHSTATE</a></div>\n        <a href="#thing" class="normal">NOT PUSHSTATE</a>\n        <div id="page-container"><div>some content</div></div>\n      </div>\n    </div>\n  ',b=location.pathname+location.search,c=document.title;describe("deploy timestamps",function(){beforeEach(function(){setupComponent(),this.component.trigger("uiSwiftLoaded")}),it("correctly detects timestamp change",function(){this.component.attr.assetsBasePath="http://abs.twimg.com/a/1360265048";var a={init_data:{assetsBasePath:"http://abs.twimg.com/a/139999999"}};expect(this.component.hasDeployTimestampChanged(a)).toBe(!0)}),it("ignores cdn change",function(){this.component.attr.assetsBasePath="http://abs.twimg.com/a/1360265048";var a={init_data:{assetsBasePath:"http://some.other.cdn/a/1360265048"}};expect(this.component.hasDeployTimestampChanged(a)).toBeFalsy()}),it("returns false for no change at all",function(){this.component.attr.assetsBasePath="http://abs.twimg.com/a/1360265048";var a={init_data:{assetsBasePath:this.component.attr.assetsBasePath}};expect(this.component.hasDeployTimestampChanged(a)).toBeFalsy()}),it("ignores detritus after path",function(){this.component.attr.assetsBasePath="http://abs.twimg.com/a/1360265048/sfhjhvnc";var a={init_data:{assetsBasePath:"http://abs.twimg.com/a/1360265048/jdhfghjdsgf"}};expect(this.component.hasDeployTimestampChanged(a)).toBeFalsy()}),it("is happy with empty path on dev",function(){this.component.attr.assetsBasePath="/";var a={init_data:{assetsBasePath:"/"}};expect(this.component.hasDeployTimestampChanged(a)).toBeFalsy()}),it("is happy with staging urls",function(){this.component.attr.assetsBasePath="https://staging-assets.local.twitter.com/82/1360265048/a/1360265048/";var a={init_data:{assetsBasePath:"https://staging-assets.local.twitter.com/82/1360265048/a/1360265048/"}};expect(this.component.hasDeployTimestampChanged(a)).toBeFalsy()}),it("correctly detects timestamp change on staging",function(){this.component.attr.assetsBasePath="https://staging-assets.local.twitter.com/82/1360265048/a/1360265048/";var a={init_data:{assetsBasePath:"https://staging-assets.local.twitter.com/82/139999999/a/139999999/"}};expect(this.component.hasDeployTimestampChanged(a)).toBe(!0)})}),history.pushState&&(afterEach(function(){history.replaceState({},c,b)}),describe("when the user navigates via pushState for the first time",function(){beforeEach(function(){history.replaceState(null,"The Initial Page","/"),setupComponent(a,{pushState:!0,pushStateSupported:!0}),this.component.attr.init_data={initialState:{}},spyOn(this.component,"swiftTeardownAll"),this.component.trigger("uiSwiftLoaded")}),it("creates a cache entry for the current page",function(){this.component.trigger("uiNavigate",{href:"/newplace"}),expect(this.component.pageCache["/"]).toBeDefined()}),it("does not add the HTML for the current page to the cache when createInitialState is called",function(){spyOn(this.component,"createInitialState"),this.component.trigger("uiNavigate",{href:"/newplace"}),expect(this.component.pageCache["/"].page).not.toBeDefined(),expect(this.component.createInitialState).toHaveBeenCalled()}),it("adds the HTML for the current page to the cache in response to the uiTeardown event",function(){this.component.pageCache["/"]={},this.component.trigger("uiTeardown",{href:"/oldplace"}),expect(this.component.pageCache["/"].page).toBeDefined()}),it("modifies the history entry for the current page using replaceState",function(){this.component.trigger("uiNavigate",{href:"/newplace"}),expect(history.state).not.toBeNull()})}),describe("when initial state is not supplied",function(){it("should not create initial state",function(){setupComponent({pushState:!0,pushStateSupported:!0}),spyOn(this.component,"createInitialState"),this.component.trigger("uiNavigate",{href:"/newplace"}),expect(this.component.createInitialState).not.toHaveBeenCalled()})}),describe("when uiTeardown is fired",function(){beforeEach(function(){history.pushState({},"cachedPage","/newplace"),setupComponent({pushState:!0,pushStateSupported:!0}),spyOn(this.component,"updatePageState"),spyOn(this.component,"swiftTeardownAll"),this.component.trigger("uiSwiftLoaded")}),it("tears down all components",function(){this.component.trigger("uiTeardown",{href:"/oldplace"}),expect(this.component.swiftTeardownAll).toHaveBeenCalled()}),it("updates the cache when navigating to a different page",function(){this.component.trigger("uiTeardown",{href:"/oldplace"}),expect(this.component.updatePageState).toHaveBeenCalled()}),it("does not update the cache when a request is made for the current page",function(){this.component.trigger("uiTeardown",{href:"/newplace"}),expect(this.component.updatePageState).not.toHaveBeenCalled()})}),describe("X-Referrer-Stack header",function(){describe("push-state requests from pages rendered by the monorail",function(){beforeEach(function(){setupComponent({pushState:!0,pushStateSupported:!0,init_data:{isMonorail:!0}}),this.component.trigger("uiSwiftLoaded")}),it('should add a "X-Referrer-Stack" header containing "monorail"',function(){ajaxRespondWithSuccess({forceStandardBrowserNavigation:!0}),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"#newplace"}),expect($.ajax.mostRecentOptions.headers["X-Referrer-Stack"]).toBe("monorail"),expect($.ajax.mostRecentOptions.headers["X-Push-State-Request"]).toBe(!0),expect("dataPageRefresh").not.toHaveBeenTriggeredOn(document),expect(location.hash).toBe("#newplace")})}),describe("push-state requests from pages not rendered by the monorail",function(){beforeEach(function(){setupComponent({pushState:!0,pushStateSupported:!0,init_data:{isMonorail:!1}}),this.component.trigger("uiSwiftLoaded")}),it('should not add a "X-Referrer-Stack" header',function(){ajaxRespondWithSuccess({init_data:{pushState:!0,viewContainer:"#page-container"},module:"path",href:"/newplace1",page:"<html>"}),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"/newplace1"}),expect($.ajax.mostRecentOptions.headers["X-Referrer-Stack"]).toBeUndefined(),expect($.ajax.mostRecentOptions.headers["X-Push-State-Request"]).toBe(!0),expect("dataPageRefresh").toHaveBeenTriggeredOn(document)})})}),describe("when uiNavigate is fired",function(){describe("and pushState is supported or decidered on",function(){beforeEach(function(){setupComponent({pushState:!0,pushStateSupported:!0}),this.component.trigger("uiSwiftLoaded")}),it("fetches page data and fires dataPageRefresh",function(){ajaxRespondWithSuccess({init_data:{pushState:!0,viewContainer:"#page-container"},module:"path",href:"/newplace1",page:"<html>"}),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"/newplace1"}),expect("dataPageRefresh").toHaveBeenTriggeredOn(document),expect($.ajax.mostRecentOptions.headers["X-Push-State-Request"]).toBe(!0)}),it("handles errors by redirecting to the specified URL",function(){ajaxRespondWithError({error:!0}),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"#newplace"}),expect("dataPageRefresh").not.toHaveBeenTriggeredOn(document),expect(location.hash).toBe("#newplace")}),it("attempts to fetch the page data but gets a non-pushState JSON response",function(){ajaxRespondWithSuccess({foo:!0}),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"#newplace"}),expect("dataPageRefresh").not.toHaveBeenTriggeredOn(document),expect(location.hash).toBe("#newplace")}),it("attempts to fetch the page data but gets a non-pushState response with a server-side redirect",function(){ajaxRespondWithSuccess({href:"#redirected"}),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"#newplace"}),expect("dataPageRefresh").not.toHaveBeenTriggeredOn(document),expect(location.hash).toBe("#redirected")}),it("reloads the page if pushState has been decidered off",function(){spyOn(this.component,"navigateTo"),ajaxRespondWithSuccess({init_data:{pushState:!1,viewContainer:"#page-container"},href:"/newplace2",module:"path",page:"<html>"}),this.component.trigger("uiNavigate",{href:"/newplace2"}),expect(this.component.navigateTo).toHaveBeenCalled()})}),describe("and pushState is not supported or decidered off",function(){beforeEach(function(){setupComponent({pushState:!1,pushStateSupported:!0}),this.component.trigger("uiSwiftLoaded")}),it("reloads the page",function(){spyOn(this.component,"navigateTo"),this.component.trigger("uiNavigate",{href:"/newplace2"}),expect(this.component.navigateTo).toHaveBeenCalled()})})}),describe("when the target page is cached",function(){beforeEach(function(){setupComponent({pushState:!0,pushStateSupported:!0}),this.component.trigger("uiSwiftLoaded"),this.cachedPage={title:"cachedPage",page:"Hello, Foo"},this.component.pageCache["/cachedpage"]=this.cachedPage}),it("should pull from the cache instead of hitting Ajax",function(){spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"/cachedpage"}),expect("dataPageRefresh").toHaveBeenTriggeredOnAndWith(document,this.cachedPage),expect("dataPageRefresh").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({fromCache:!0}))}),it("should pull from the cache instead of making an XHR if the user hits the back button or forward button",function(){history.replaceState({},"cachedPage","/cachedpage"),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{isPopState:!0,href:"/cachedpage"}),expect("dataPageRefresh").toHaveBeenTriggeredOnAndWith(document,this.cachedPage),expect("dataPageRefresh").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({fromCache:!0}))}),it("should not fire the dataPageRefresh event if the request is to the URL of the current page",function(){history.replaceState({},"cachedPage","/cachedpage"),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"/cachedpage"}),expect("dataPageRefresh").not.toHaveBeenTriggeredOn(document)}),it("should fire the dataPageRefresh event if the request is to the URL of the current page but the cache was busted",function(){history.replaceState({},"cachedPage","/cachedpage"),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"/cachedpage"}),expect("dataPageRefresh").not.toHaveBeenTriggeredOn(document),delete this.component.pageCache["/cachedpage"],this.fromServer={init_data:{pushState:!0,href:"/cachedpage",viewContainer:"#page-container"},module:"from_server",page:"from server"},ajaxRespondWithSuccess(this.fromServer),spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"/cachedpage"}),expect("dataPageRefresh").toHaveBeenTriggeredOnAndWith(document,this.fromServer)})}),describe("when the target page is past TTL",function(){beforeEach(function(){setupComponent({pushState:!0,pushStateSupported:!0}),this.component.trigger("uiSwiftLoaded"),this.cachedPage={page:"cachedPage"},this.component.pageCache["/cachedpage"]=this.cachedPage,this.component.pageCacheTTLs["/cachedpage"]=(new Date).getTime()-3e3,this.fromServer={init_data:{pushState:!0,href:"/cachedpage",viewContainer:"#page-container"},module:"from_server",page:"from server"},ajaxRespondWithSuccess(this.fromServer)}),it("should pull from the server via Ajax",function(){spyOnEvent(document,"dataPageRefresh"),this.component.trigger("uiNavigate",{href:"/cachedpage"}),expect("dataPageRefresh").toHaveBeenTriggeredOnAndWith(document,this.fromServer)}),it("update the URL if the server responds with a different href",function(){spyOnEvent(document,"dataPageRefresh"),this.fromServer.init_data.href="#otherplace",this.component.trigger("uiNavigate",{href:"/cachedpage"}),expect("dataPageRefresh").toHaveBeenTriggeredOnAndWith(document,this.fromServer),expect(location.hash).toBe("#otherplace")}),it("does not update the URL if the server responds with the same href",function(){spyOnEvent(document,"dataPageRefresh"),this.fromServer.init_data.href="/cachedpage",this.component.trigger("uiNavigate",{href:"/cachedpage"}),expect("dataPageRefresh").toHaveBeenTriggeredOnAndWith(document,this.fromServer),expect(location.hash).toBe("")})}),describe("when the page is cached and a dataPageMutated event fires",function(){beforeEach(function(){setupComponent({pushState:!0,pushStateSupported:!0}),this.component.trigger("uiSwiftLoaded"),this.cachedPage={page:"cachedPage"},this.component.pageCache["/cachedpage"]=this.cachedPage,this.component.pageCacheTTLs["/cachedpage"]=(new Date).getTime()-3e3}),it("should clear the cache",function(){this.component.trigger("dataPageMutated"),expect(this.component.pageCache["/cachedpage"]).not.toBeDefined(),expect(this.component.pageCacheTTLs["/cachedpage"]).not.toBeDefined()})}),describe("when the page is cached and a uiPromotedLinkClick event fires referencing the cached page",function(){beforeEach(function(){setupComponent({pushState:!0,pushStateSupported:!0}),this.component.trigger("uiSwiftLoaded"),this.cachedPage={page:"cachedPage"},this.component.pageCache["/cachedpage"]=this.cachedPage,this.component.pageCacheTTLs["/cachedpage"]=(new Date).getTime()-3e3}),it("should clear the page from cache",function(){this.component.trigger("uiPromotedLinkClick",{href:"/cachedpage"}),expect(this.component.pageCache["/cachedpage"]).not.toBeDefined(),expect(this.component.pageCacheTTLs["/cachedpage"]).not.toBeDefined()})}),describe("when the user navigates away from twitter.com to another domain",function(){beforeEach(function(){setupComponent({pushState:!0,pushStateSupported:!0}),this.component.trigger("uiSwiftLoaded"),history.replaceState({},"The Connect Page","/connect")}),it("removes the state object for the current page from the history",function(){$(window).trigger("beforeunload"),expect(history.state).toBeNull()})}),describe("when the viewContainer specified in the response is different than the viewContainer attr on the instance",function(){beforeEach(function(){setupComponent({pushState:!0,pushStateSupported:!0,viewContainer:"#foo"}),spyOn(this.component,"navigateTo"),this.component.trigger("uiSwiftLoaded"),this.fromServer={init_data:{pushState:!0,viewContainer:"#bar"},module:"foo",page:"<div></div>"},ajaxRespondWithSuccess(this.fromServer)}),it("reloads the page",function(){this.component.trigger("uiNavigate",{href:"/newplace2"}),expect(this.component.navigateTo).toHaveBeenCalled()}),it("sets the viewContainer attr to the value specified in the init_data",function(){this.component.trigger("uiNavigate",{href:"/newplace2"}),expect(this.component.attr.viewContainer).toBe(this.fromServer.init_data.viewContainer)})}))})
});
define("test/app/data/direct_messages_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/direct_messages_scribe",function(){beforeEach(function(){setupComponent()}),it("scribes when the new conversation view is opened",function(){this.component.trigger("uiDMDialogOpenedNewConversation"),expect(this.component).toScribe({action:"open"})}),it("scribes when the conversation view is opened",function(){this.component.trigger("uiDMDialogOpenedConversation"),expect(this.component).toScribe({action:"open"})}),it("scribes when the conversation list view is opened",function(){this.component.trigger("uiDMDialogOpenedConversationList"),expect(this.component).toScribe({action:"open"})}),it("scribes when a message is sent",function(){this.component.trigger("uiDMDialogSendMessage"),expect(this.component).toScribe({action:"send_dm"})}),it("scribes when a message is deleted",function(){this.component.trigger("uiDMDialogDeleteMessage"),expect(this.component).toScribe({action:"delete"})}),it("scribes when marking all messages as read",function(){this.component.trigger("uiDMDialogMarkMessage"),expect(this.component).toScribe({element:"mark_all_as_read",action:"click"})})})
});
define("test/app/data/who_to_follow_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/who_to_follow",function(){beforeEach(function(){setupComponent()}),describe("on uiGetUserRecommendations",function(){it("makes an ajax request to the correct endpoint",function(){$(document).trigger("uiGetUserRecommendations"),expect($.ajax.mostRecentOptions.url).toEqual("/i/users/recommendations"),expect($.ajax.mostRecentOptions.type).toEqual("GET")}),it("accumulates excluded user ids across requests",function(){$(document).trigger("uiGetUserRecommendations",{excluded:[1,2,3]}),expect($.ajax.mostRecentOptions.data.excluded).toEqual("1,2,3"),$(document).trigger("uiGetUserRecommendations",{excluded:[4,5,6]}),expect($.ajax.mostRecentOptions.data.excluded).toEqual("1,2,3,4,5,6"),$(document).trigger("uiGetUserRecommendations"),expect($.ajax.mostRecentOptions.data.excluded).toEqual("1,2,3,4,5,6")}),it("passes visible user ids along with excluded user ids",function(){$(document).trigger("uiGetUserRecommendations",{excluded:[1,2,3],visible:[4,5]}),expect($.ajax.mostRecentOptions.data.excluded).toEqual("1,2,3,4,5")}),it("caps excluded user ids at 100 when more than 100 are sent at once",function(){var a=[];for(var b=0;b<150;b++)a.push(b);$(document).trigger("uiGetUserRecommendations",{excluded:a}),expect($.ajax.mostRecentOptions.data.excluded.split(",").length).toEqual(100)}),it("caps excluded user ids at 100 when more than 100 are sent over multiple requests",function(){var a=[];for(var b=0;b<50;b++)a.push(b);$(document).trigger("uiGetUserRecommendations",{excluded:a}),expect($.ajax.mostRecentOptions.data.excluded.split(",").length).toEqual(50),a=[];for(var b=51;b<150;b++)a.push(b);$(document).trigger("uiGetUserRecommendations",{excluded:a}),expect($.ajax.mostRecentOptions.data.excluded.split(",").length).toEqual(100)}),it("filters out duplicate excluded user ids",function(){var a=[];for(var b=0;b<20;b++)a.push(b%4);$(document).trigger("uiGetUserRecommendations",{excluded:a}),expect($.ajax.mostRecentOptions.data.excluded).toEqual("0,1,2,3")})}),describe("on uiDismissUserRecommendation",function(){it("makes an ajax request to the correct endpoint",function(){$(document).trigger("uiDismissUserRecommendation"),expect($.ajax.mostRecentOptions.url).toEqual("/i/users/recommendations/hide"),expect($.ajax.mostRecentOptions.type).toEqual("POST")}),it("passes visible user ids along with excluded user ids",function(){$(document).trigger("uiDismissUserRecommendation",{excluded:[1,2,3]}),expect($.ajax.mostRecentOptions.data.excluded).toEqual("1,2,3"),$(document).trigger("uiDismissUserRecommendation",{excluded:[1,2,3],visible:[4,5]}),expect($.ajax.mostRecentOptions.data.excluded).toEqual("1,2,3,4,5")})}),describe("on uiDidDismissEmptyTimelineRecommendations",function(){it("adds excluded user IDs to storage",function(){expect(this.component.storage.getArray("excluded").length).toBe(0),$(document).trigger("uiDidDismissEmptyTimelineRecommendations",{userIds:["1","2","3"]}),expect(this.component.storage.getArray("excluded")).toEqual(["1","2","3"])}),it("triggers dataDidExcludeUserRecommendations",function(){spyOnEvent(document,"dataDidExcludeUserRecommendations"),$(document).trigger("uiDidDismissEmptyTimelineRecommendations",{userIds:["1","2","3"]}),expect("dataDidExcludeUserRecommendations").toHaveBeenTriggeredOnAndWith(document,{userIds:["1","2","3"]})})}),describe("on dataFollowStateChange",function(){it("adds followed user ID to storage",function(){expect(this.component.storage.getArray("excluded").length).toBe(0),$(document).trigger("dataFollowStateChange",{newState:"following",userId:"5"}),expect(this.component.storage.getArray("excluded")).toEqual(["5"])}),it("does not add to storage when newState is not equal to following",function(){expect(this.component.storage.getArray("excluded").length).toBe(0),$(document).trigger("dataFollowStateChange",{newState:"blocked",userId:"5"}),expect(this.component.storage.getArray("excluded")).not.toEqual(["5"])})})})
});
define("test/app/data/saved_searches_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/saved_searches",function(){beforeEach(function(){this.mockResponse={},ajaxRespondWithSuccess(this.mockResponse),setupComponent()}),describe("event uiAddSavedSearch",function(){it("calls the API",function(){this.component.trigger("uiAddSavedSearch",{query:"test"}),expect($.ajax.mostRecentOptions.url).toEqual("/i/saved_searches/create.json"),expect($.ajax.mostRecentOptions.data.query).toEqual("test")}),it("triggers dataAddedSavedSearch on success",function(){spyOnEvent(document,"dataAddedSavedSearch"),this.component.trigger("uiAddSavedSearch",{query:"test"}),expect("dataAddedSavedSearch").toHaveBeenTriggeredOn(document)}),it("can pass parameters to the API",function(){this.component.trigger("uiAddSavedSearch",{query:"hello"}),expect($.ajax).toHaveBeenCalled(),expect($.ajax.mostRecentOptions.data.query).toEqual("hello")})})})
});
define("test/app/data/async_profile_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/async_profile",function(){beforeEach(function(){setupComponent({formAuthenticityToken:"dummy auth token",pageName:"profile",sectionName:"followers"})}),describe("on uiInlineEditSave",function(){it("saves the fields into the fields hash",function(){this.$node.trigger("uiInlineEditSave",{field:"user[bio]",newValue:"All around awesome dude"}),this.$node.trigger("uiInlineEditSave",{field:"user[url]",newValue:"twitter.com"}),expect(this.component.fields).toEqual({"user[bio]":"All around awesome dude","user[url]":"twitter.com"})})}),describe("on uiEditProfileSave",function(){it("makes an ajax request to the correct endpoint",function(){this.component.fields={"user[url]":"twitter.com"},this.component.trigger("uiEditProfileSave"),expect($.ajax.mostRecentOptions.url).toEqual("/i/profiles/update"),expect($.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({page_context:"profile",section_context:"followers","user[url]":"twitter.com"})),expect($.ajax.mostRecentOptions.type).toEqual("POST")}),it("fires dataInlineEditSaveStarted when fields are present",function(){spyOnEvent(document,"dataInlineEditSaveStarted"),this.component.fields={"user[url]":"twitter.com"},this.component.trigger("uiEditProfileSave"),expect("dataInlineEditSaveStarted").toHaveBeenTriggeredOn(document)}),it("doesn't fire dataInlineEditSaveStarted when fields are not present",function(){spyOnEvent(document,"dataInlineEditSaveStarted"),this.component.fields={},this.component.trigger("uiEditProfileSave"),expect("dataInlineEditSaveStarted").not.toHaveBeenTriggeredOn(document)}),it("clears field on success",function(){spyOnEvent(document,"dataAjaxSuccess"),ajaxRespondWithSuccess({}),this.component.fields={"user[url]":"twitter.com"},this.component.trigger("uiEditProfileSave"),expect(this.component.fields).toEqual({})}),it("clears field on error",function(){spyOnEvent(document,"dataAjaxFailure"),ajaxRespondWithError({}),this.component.fields={"user[url]":"twitter.com"},this.component.trigger("uiEditProfileSave"),expect(this.component.fields).toEqual({})}),it("clears field on success with error=true",function(){spyOnEvent(document,"dataAjaxSuccess"),ajaxRespondWithSuccess({error:!0}),this.component.fields={"user[url]":"twitter.com"},this.component.trigger("uiEditProfileSave"),expect(this.component.fields).toEqual({})})})})
});
define("test/app/data/user_info_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/data/user_info",function(){var a;beforeEach(function(){a=this.Module}),afterEach(function(){}),describe("setup",function(){it("starts empty",function(){expect(a.user.screenName).toBeNull(),expect(a.user.deciders).toEqual({})}),it("can be set",function(){a.set({screenName:"fakeAngus",deciders:{lol:!0}}),expect(a.user.screenName).toBe("fakeAngus"),expect(a.user.deciders).toEqual({lol:!0})}),it("can be reset",function(){a.set({screenName:"fakeAngus",deciders:{lol:!0}}),a.reset(),expect(a.user.screenName).toBeNull(),expect(a.user.deciders).toEqual({})})}),describe("getsDeciders",function(){it("fetches a decider value",function(){a.set({screenName:"fakeAngus",deciders:{lol:!0}}),expect(a.getDecider("lol")).toBe(!0)})})})
});
define("test/app/data/tweet_translation_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/tweet_translation",function(){var a;beforeEach(function(){setupComponent(),a={twitterId:42,dest:"ja"}}),describe("dataTweetTranslationSuccess",function(){it("triggers dataTweetTranslationSuccess on success",function(){var b={id:42,dest:"ja",translation:"translation"};ajaxRespondWithSuccess(b),spyOnEvent(document,"dataTweetTranslationSuccess"),this.component.getTweetTranslation({},a),expect("dataTweetTranslationSuccess").toHaveBeenTriggeredOnAndWith(document,b)}),it("triggers uiShowMessage on success if message is present",function(){var b={translation:"translation",message:"hooray"};ajaxRespondWithSuccess(b),spyOnEvent(document,"uiShowMessage"),this.component.getTweetTranslation({},a),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:b.message})}),it("does not trigger uiShowMessage if message is not present",function(){var b={translation:"translation"};ajaxRespondWithSuccess(b),spyOnEvent(document,"uiShowMessage"),this.component.getTweetTranslation({},a),expect("uiShowMessage").not.toHaveBeenTriggeredOn(document)}),it("triggers dataTweetTranslationError on error",function(){ajaxRespondWithError({},{},{}),spyOnEvent(document,"dataTweetTranslationError"),this.component.getTweetTranslation({},a),expect("dataTweetTranslationError").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/saved_searches_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/saved_searches_scribe",function(){beforeEach(function(){setupComponent()}),describe("dataAddedSavedSearch",function(){it("scribes a saved search event",function(){this.component.trigger("dataAddedSavedSearch"),expect(this.component).toScribe({element:"saved_search",component:"stream",action:"add"})})}),describe("dataRemovedSavedSearch",function(){it("scribes a removed search event",function(){this.component.trigger("dataRemovedSavedSearch"),expect(this.component).toScribe({element:"saved_search",component:"stream",action:"remove"})})})})
});
define("test/app/data/trends_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/trends_scribe",function(){beforeEach(function(){setupComponent(),this.component.attr.eventData={scribeContext:{component:"trends"}}}),describe("event uiTrendsDialogOpened",function(){it("scribes the open action",function(){this.component.trigger("uiTrendsDialogOpened"),expect(this.component).toScribe({action:"open"})})}),describe("event uiTrendSelected",function(){it("scribes search action on normal trend",function(){this.component.trigger("uiTrendSelected",{isPromoted:!1,scribeContext:{element:"trend"},scribeData:{promoted:!1}}),expect(this.component).toScribe({component:"trends",element:"trend",action:"search"},{promoted:!1})}),it("scribes search action on promoted trend",function(){this.component.trigger("uiTrendSelected",{isPromoted:!0,scribeContext:{element:"trend"},scribeData:{promoted:!0}}),expect(this.component).toScribe({component:"trends",element:"trend",action:"search"},{promoted:!0})})}),describe("event uiTrendsDisplayed",function(){var a,b,c,d;beforeEach(function(){a=[{name:"one"},{name:"two"},{name:"three",promotedTrendId:"10001"}],d=a.map(function(a){return a.name}),b={component:"trends",element:"initial",action:"results"},c={component:"trends",element:"newer",action:"results"}}),describe("on initial results",function(){beforeEach(function(){this.component.trigger("uiTrendsDisplayed",{initial:!0,items:a,scribeContext:{element:"initial"},scribeData:{woeid:42}})}),it("scribes results",function(){expect(this.component).toScribe(b,{items:[{name:"one",item_type:8,item_query:"one",position:0},{name:"two",item_type:8,item_query:"two",position:1},{name:"three",item_type:8,item_query:"three",position:2,promoted_id:"10001"}],promoted:!0,woeid:42,referring_event:"initial"})}),it("scribes impression",function(){expect(this.component).toScribe({action:"impression"})})}),describe("on not initial results",function(){beforeEach(function(){this.component.trigger("uiTrendsDisplayed",{initial:!1,items:a,scribeContext:{element:"newer"},scribeData:{woeid:42}})}),it("scribes results",function(){expect(this.component).toScribe(c,{items:[{name:"one",item_type:8,item_query:"one",position:0},{name:"two",item_type:8,item_query:"two",position:1},{name:"three",item_type:8,item_query:"three",position:2,promoted_id:"10001"}],promoted:!0,woeid:42,referring_event:"newer"})}),it("does not scribe impression",function(){expect(this.component).not.toScribe({action:"impression"})})}),describe("on auto-refresh results",function(){beforeEach(function(){this.component.trigger("uiTrendsDisplayed",{initial:!1,items:a,scribeContext:{element:"newer"},scribeData:{woeid:42},source:"clock"})}),it("scribes results",function(){expect(this.component).toScribe(c,{items:[{name:"one",item_type:8,item_query:"one",position:0},{name:"two",item_type:8,item_query:"two",position:1},{name:"three",item_type:8,item_query:"three",position:2,promoted_id:"10001"}],promoted:!0,woeid:42,referring_event:"newer",event_initiator:2})}),it("does not scribe impression",function(){expect(this.component).not.toScribe({action:"impression"})})})})})
});
define("test/app/data/oembed_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/oembed",function(){beforeEach(setupComponent),describe("event uiNeedsOembed",function(){it("calls the oembed api",function(){spyOn(this.component,"useMacawSyndication").andCallFake(function(){return!1}),this.$node.trigger("uiNeedsOembed",{data:{},tweetId:"20",screenName:"jack"}),expect(jQuery.ajax.mostRecentOptions).toEqual(jasmine.objectContaining({url:"/jack/oembed/20.json"}))}),it("calls macaw syndication",function(){spyOn(this.component,"useMacawSyndication").andCallFake(function(){return!0}),this.$node.trigger("uiNeedsOembed",{data:{},tweetId:"20",screenName:"jack"}),expect(jQuery.ajax.mostRecentOptions).toEqual(jasmine.objectContaining({url:"//api.twitter.com/1/statuses/oembed.json",data:{id:"20"}}))}),it("triggers dataOembedSuccess",function(){ajaxRespondWithSuccess({foo:"bar"}),spyOnEvent(this.$node,"dataOembedSuccess"),this.$node.trigger("uiNeedsOembed",{}),expect("dataOembedSuccess").toHaveBeenTriggeredOn(this.$node)})}),describe("retries failed requests",function(){it("triggers dataOembedError",function(){this.$node.trigger("uiNeedsOembed",{retry:!1}),ajaxRespondWithError({}),spyOnEvent(this.$node,"dataOembedError"),spyOnEvent(this.$node,"dataOembedRetry"),this.$node.trigger("uiNeedsOembed",{}),expect("dataOembedRetry").not.toHaveBeenTriggeredOn(this.$node),expect("dataOembedError").toHaveBeenTriggeredOn(this.$node)}),it("retries on failure and triggers dataOembedRetry",function(){ajaxRespondWithError({}),spyOnEvent(this.$node,"dataOembedError"),spyOnEvent(this.$node,"dataOembedRetry"),this.$node.trigger("uiNeedsOembed",{retry:!0}),expect("dataOembedRetry").toHaveBeenTriggeredOn(this.$node),expect("dataOembedError").toHaveBeenTriggeredOn(this.$node)})}),describe("caches responses",function(){it("places the ajax response into the cache",function(){var a={retry:!1,screenName:"jack",data:{hide_parent:!0}},b=this.component.cacheKeyForOptions(a);ajaxRespondWithSuccess({html:"oembed"}),this.$node.trigger("uiNeedsOembed",a),expect(this.component.cachedEmbedCodes[b]).toEqual(jasmine.objectContaining({html:"oembed"}))}),it("returns the cached response",function(){var a={retry:!1,screenName:"jack",data:{hide_parent:!0}},b=this.component.cacheKeyForOptions(a);this.component.cachedEmbedCodes[b]={html:"cached"},ajaxRespondWithSuccess({html:"notcached"}),spyOnEvent(this.$node,"dataOembedSuccess"),this.$node.trigger("uiNeedsOembed",a),expect("dataOembedSuccess").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({data:{html:"cached"}}))})})})
});
define("test/app/data/who_to_tweet_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/who_to_tweet",function(){beforeEach(function(){setupComponent()}),describe("on uiWantsWhoToTweetModule",function(){it("makes an ajax request to the correct endpoint",function(){$(document).trigger("uiWantsWhoToTweetModule",{screen_name:"grimezsz"}),expect($.ajax.mostRecentOptions.url).toEqual("/grimezsz/following/users"),expect($.ajax.mostRecentOptions.type).toEqual("GET"),expect($.ajax.mostRecentOptions.data).toEqual({who_to_tweet:!0})})})})
});
define("test/app/data/inline_edit_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/inline_edit_scribe",function(){beforeEach(function(){setupComponent()}),describe("Inline edit client events",function(){it("should scribe entering edit mode",function(){this.component.trigger("uiEditProfileStart"),expect(this.component).toScribe({component:"inline_edit",action:"edit"})}),it("should scribe the target element when entering edit mode",function(){this.component.trigger("uiEditProfileStart",{scribeContext:{element:"target-element-scribe-name"}}),expect(this.component).toScribe({component:"inline_edit",action:"edit",element:"target-element-scribe-name"})}),it("should scribe canceling edit mode",function(){this.component.trigger("uiEditProfileCancel"),expect(this.component).toScribe({component:"inline_edit",action:"cancel"})}),it("should scribe a successful save",function(){this.component.trigger("dataInlineEditSaveSuccess"),expect(this.component).toScribe({component:"inline_edit",action:"success"})}),it("should scribe an unsuccessful save",function(){this.component.trigger("dataInlineEditSaveError"),expect(this.component).toScribe({component:"inline_edit",action:"error"})})})})
});
define("test/app/data/email_banner_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/email_banner",function(){beforeEach(setupComponent),describe("event uiResendConfirmationEmail",function(){it("makes an ajax request to the correct endpoint",function(){this.component.trigger("uiResendConfirmationEmail"),expect($.ajax.mostRecentOptions.url).toEqual("/account/resend_confirmation_email"),expect($.ajax.mostRecentOptions.type).toEqual("POST")}),it("fires uiShowMessage with a success message when resend is successful",function(){spyOnEvent(document,"uiShowMessage"),ajaxRespondWithSuccess({messageForFlash:"foo"}),this.component.trigger("uiResendConfirmationEmail"),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"foo"})}),it("fires uiShowMessage with a failure message when resend is not successful",function(){spyOnEvent(document,"uiShowMessage"),ajaxRespondWithError({}),this.component.trigger("uiResendConfirmationEmail"),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"Oops!  There was an error sending the confirmation email."})})}),describe("event uiResetBounceLink",function(){it("makes an ajax request to the correct endpoint",function(){this.component.trigger("uiResetBounceLink"),expect($.ajax.mostRecentOptions.url).toEqual("/bouncers/reset"),expect($.ajax.mostRecentOptions.type).toEqual("POST")}),it("fires uiShowMessage with a success message when reset is successful",function(){spyOnEvent(document,"uiShowMessage"),ajaxRespondWithSuccess({}),this.component.trigger("uiResetBounceLink"),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"Your email notifications should resume shortly."})}),it("fires uiShowMessage with a failure message when reset is not successful",function(){spyOnEvent(document,"uiShowMessage"),ajaxRespondWithError({}),this.component.trigger("uiResetBounceLink"),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"Oops! There was an error sending email notifications."})})})})
});
define("test/app/data/media_settings_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/media_settings",function(){beforeEach(function(){setupComponent({formAuthenticityToken:"dummy auth token"})}),it("triggers uiShowMessage on succesful media settings update",function(){spyOnEvent(this.component.$node,"uiShowMessage"),ajaxRespondWithSuccess({}),this.component.trigger("uiUpdateViewPossiblySensitive"),expect("uiShowMessage").toHaveBeenTriggeredOn(this.component.$node)})})
});
define("test/app/data/profile_popup_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/profile_popup",function(){beforeEach(function(){jasmine.Clock.useMock(),setupComponent()}),describe("on uiWantsProfilePopup",function(){describe("with a user id",function(){it("makes an ajax call to retrieve the HTML",function(){this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect(jQuery.ajax.mostRecentOptions).toEqual(jasmine.objectContaining({url:"/i/profiles/popup"}))}),it("passes the user id to the ajax call",function(){this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect(jQuery.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({user_id:1}))}),it("passes an option denoting if it wants a hover instead",function(){this.component.attr.profileHoversEnabled=!0,this.$node.trigger("uiWantsProfilePopup",{userId:1}),jasmine.Clock.tick(this.component.attr.hoverFetchDelay+1),expect(jQuery.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({wants_hovercard:!0}))}),it("delays call to retrieve the HTML when using profile hover",function(){this.component.attr.profileHoversEnabled=!0,this.$node.trigger("uiWantsProfilePopup",{userId:1}),jasmine.Clock.tick(this.component.attr.hoverFetchDelay-1),expect(jQuery.ajax.argsForCall.length).toEqual(0),jasmine.Clock.tick(2),expect(jQuery.ajax.mostRecentOptions).toEqual(jasmine.objectContaining({url:"/i/profiles/popup"}))}),it("cancels call to retrieve the HTML when using profile hover and hide is called",function(){this.component.attr.profileHoversEnabled=!0,this.$node.trigger("uiWantsProfilePopup",{userId:1}),jasmine.Clock.tick(this.component.attr.hoverFetchDelay-1),expect(jQuery.ajax.argsForCall.length).toEqual(0),this.$node.trigger("uiHideProfileHover"),jasmine.Clock.tick(2),expect(jQuery.ajax.argsForCall.length).toEqual(0)})}),describe("with a screen name",function(){it("passes the screen name to the ajax call",function(){this.$node.trigger("uiWantsProfilePopup",{screenName:"hank"}),expect(jQuery.ajax.mostRecentOptions.data).toEqual(jasmine.objectContaining({screen_name:"hank"}))}),describe("with async_social_proof",function(){describe("logged in",function(){beforeEach(function(){setupComponent({loggedIn:!0,asyncSocialProof:!0})}),it("makes ajax calls for the popup and social proof separately",function(){this.$node.trigger("uiWantsProfilePopup",{userId:1});var a=jQuery.ajax.argsForCall;expect(a.length).toEqual(2),expect(a[0][0].url).toEqual("/i/profiles/social_proof"),expect(a[1][0].url).toEqual("/i/profiles/popup")}),it("doesnt call social proof if using hovercards",function(){this.component.attr.profileHoversEnabled=!0,this.$node.trigger("uiWantsProfilePopup",{userId:1}),jasmine.Clock.tick(this.component.attr.hoverFetchDelay+1);var a=jQuery.ajax.argsForCall;expect(a.length).toEqual(1),expect(a[0][0].url).toEqual("/i/profiles/popup")})}),describe("logged out",function(){beforeEach(function(){setupComponent({loggedIn:!1,asyncSocialProof:!0})}),it("makes an ajax call only for the popup",function(){this.$node.trigger("uiWantsProfilePopup",{userId:1});var a=jQuery.ajax.argsForCall;expect(a.length).toEqual(1),expect(a[0][0].url).toEqual("/i/profiles/popup")})})})}),describe("a successful request",function(){beforeEach(function(){$(document).trigger("dataFollowStateChange",{userId:1}),spyOnEvent(document,"dataProfilePopupSuccess"),this.html='<div class="profile-modal-header">Profile popup</div>',ajaxRespondWithSuccess({html:this.html,user_id:1,screen_name:"name"})}),it("triggers a dataProfilePopupSuccess event with the HTML",function(){this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect("dataProfilePopupSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.html}))}),describe("cached requests",function(){beforeEach(function(){this.html='<div class="profile-modal-header">Profile popup</div>',this.newHtml='<div class="profile-modal-header">Different content</div>',spyOnEvent(document,"dataProfilePopupSuccess")}),it("returns the results of the first request on subsequent requests",function(){ajaxRespondWithSuccess({html:this.html,user_id:1,screen_name:"name"}),this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect("dataProfilePopupSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.html})),ajaxRespondWithSuccess({html:this.newHtml,user_id:1,screen_name:"name"}),this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect("dataProfilePopupSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.html})),ajaxRespondWithSuccess({html:this.newHtml,user_id:1,screen_name:"name"}),this.$node.trigger("uiWantsProfilePopup",{screenName:"name"}),expect("dataProfilePopupSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.html}))}),it("invalidates the cache on dataFollowStateChange",function(){ajaxRespondWithSuccess({html:this.html,user_id:1,screen_name:"name"}),this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect("dataProfilePopupSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.html})),$(document).trigger("dataFollowStateChange",{userId:1}),ajaxRespondWithSuccess({html:this.newHtml,user_id:1,screen_name:"name"}),this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect("dataProfilePopupSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.newHtml}))}),it("invalidates the cache on dataUserActionSuccess",function(){ajaxRespondWithSuccess({html:this.html,user_id:1,screen_name:"name"}),this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect("dataProfilePopupSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.html})),$(document).trigger("dataUserActionSuccess",{userId:1}),ajaxRespondWithSuccess({html:this.newHtml,user_id:1,screen_name:"name"}),this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect("dataProfilePopupSuccess").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:this.newHtml}))})})}),describe("an unsuccessful request",function(){beforeEach(function(){$(document).trigger("dataFollowStateChange",{userId:1}),this.html='<div class="profile-modal-header">Profile popup</div>',ajaxRespondWithError({})}),it("triggers a dataProfilePopupFailure event with an error message",function(){spyOnEvent(document,"dataProfilePopupFailure"),this.$node.trigger("uiWantsProfilePopup",{userId:1}),expect("dataProfilePopupFailure").toHaveBeenTriggeredOnAndWith(document,{xhr:{},message:"Internal server error."})})})})})
});
define("test/app/data/archive_navigator_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/archive_navigator_scribe",function(){beforeEach(function(){setupComponent()}),describe("uiArchiveRangeClick",function(){it("scribes a search event",function(){this.component.trigger("uiArchiveRangeClick",{monthsInPast:10,scribeContext:{component:"archive_navigation"}}),expect(this.component).toScribe({component:"archive_navigation",element:"graph_segment",action:"search"},{event_info:10})})}),describe("uiArchiveHighlightClick",function(){it("scribes a search event",function(){this.component.trigger("uiArchiveHighlightClick",{monthsInPast:10,scribeContext:{component:"archive_navigation"}}),expect(this.component).toScribe({component:"archive_navigation",element:"peak",action:"search"},{event_info:10})})}),describe("uiArchiveNavFuture",function(){it("scribes a navigate event",function(){this.component.trigger("uiArchiveNavFuture",{monthsInPast:10,scribeContext:{component:"archive_navigation"}}),expect(this.component).toScribe({component:"archive_navigation",element:"future_nav",action:"navigate"},{event_info:10})})}),describe("uiArchiveNavPast",function(){it("scribes a navigate event",function(){this.component.trigger("uiArchiveNavPast",{monthsInPast:10,scribeContext:{component:"archive_navigation"}}),expect(this.component).toScribe({component:"archive_navigation",element:"past_nav",action:"navigate"},{event_info:10})})}),describe("uiArchiveShown",function(){it("scribes an impression event",function(){this.component.trigger("uiArchiveShown",{monthsDisplayed:10,scribeContext:{component:"archive_navigation"}}),expect(this.component).toScribe({component:"archive_navigation",element:null,action:"impression"},{event_info:10})})})})
});
define("test/app/data/report_tweet_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/report_tweet_scribe",function(){var a={itemType:"tweet",tweetId:"1",userId:"2"},b={items:[{id:"1",item_type:0}],associations:{1:{association_type:0,association_id:"1"}}},c={items:[{id:"1",item_type:0}],associations:{1:{association_type:0,association_id:"1"}},targets:[{id:"2",item_type:3}]};beforeEach(function(){setupComponent("<div />")}),describe("on uiNeedsReportTweetDialog",function(){it("scribes an impression",function(){this.component.trigger("uiNeedsReportTweetDialog",a),expect(this.component).toScribe({component:"report_tweet",action:"impression"},b)})}),describe("on uiDidShowReportAbusiveTweetDialog",function(){it("scribes an impression",function(){this.component.trigger("uiDidShowReportAbusiveTweetDialog",a),expect(this.component).toScribe({component:"report_tweet_abusive",action:"impression"},b)})}),describe("on uiDidCancelReportTweet",function(){it("scribes a report_tweet::cancel event",function(){this.component.trigger("uiDidCancelReportTweet",a),expect(this.component).toScribe({component:"report_tweet",action:"cancel"},b)})}),describe("on uiDidCancelReportTweetAbusive",function(){it("scribes a report_tweet_abusive::cancel event",function(){this.component.trigger("uiDidCancelReportTweetAbusive",a),expect(this.component).toScribe({component:"report_tweet_abusive",action:"cancel"},b)})}),describe("on uiDidReportTweet",function(){beforeEach(function(){this.submit=function(b,c){this.component.trigger("uiDidReportTweet",{blockUser:b,reportType:c,tweetData:a})}}),it("scribes a block event when blockUser is true",function(){this.submit(!0),expect(this.component).toScribe({component:"report_tweet",action:"block"},c)}),it("scribes a report_as_spam event when blockUser is false",function(){this.submit(!1),expect(this.component).toScribe({component:"report_tweet",action:"report_as_spam"},c)}),it("scribes the expected element when a report type is selected",function(){this.submit(!1,"spam"),expect(this.component).toScribe({component:"report_tweet",element:"spam",action:"report_as_spam"},c)})}),describe("on uiDidReportTweetToSupport",function(){it("scribes the click with the given abuse type as the element",function(){this.component.trigger("uiDidReportTweetToSupport",{tweetData:a,abuseType:"impersonation"}),expect(this.component).toScribe({component:"report_tweet_abusive",element:"impersonation",action:"click"},b)})})})
});
define("test/app/data/ttft_navigation_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/ttft_navigation",function(){var a;beforeEach(function(){setupComponent(),this.component.transportLog=[],spyOn(this.component.scribeTransport,"send").andCallFake(function(a,b){var c=$.extend({_category_:"client_event",event_namespace:a},b);this.component&&this.component.transportLog.push(c)}.bind(this)),a=window.location.pathname}),describe("event uiBeforeNewPageLoad",function(){it("records the current time",function(){this.component.trigger("uiBeforeNewPageLoad",{}),expect(+(new Date)-this.component.time().beforeNewPageLoad).toBeLessThan(10)}),it("preserves that time",function(){expect(+(new Date)-this.component.time().beforeNewPageLoad).toBeLessThan(100)})}),describe("event uiPageChanged",function(){it("records the current time",function(){this.component.trigger("uiPageChanged",{fromCache:!1}),expect(+(new Date)-this.component.time().afterPageChanged).toBeLessThan(10)}),it("doesn't listen for uiTimelineShouldRefresh",function(){expect(this.component.listeningForTimeline).toBeFalsy(),this.component.trigger("uiTimelineShouldRefresh",{navigated:!0}),expect(this.component.listeningForTimeline).toBeFalsy()}),it("listens for uiTimelineShouldRefresh during uiPageChanged",function(){expect(this.component.listeningForTimeline).toBeFalsy(),this.component.trigger("uiPageChanged",{fromCache:!1}),this.component.trigger("uiTimelineShouldRefresh",{navigated:!0}),expect(this.component.listeningForTimeline).not.toBeFalsy()}),it("scribes afterwards",function(){jasmine.Clock.useMock();var b=+(new Date);this.component.trigger("uiBeforeNewPageLoad",{}),this.component.trigger("uiPageChanged",{fromCache:!1});var c=+(new Date);jasmine.Clock.tick(10),expect(this.component.listeningForTimeline).toBeFalsy();var d=this.component.transportLog.pop().event_namespace;expect(d).toEqual(jasmine.objectContaining({event_name:"route_time",source_path:a,dest_path:a,cached:!1,ajax_count:0})),expect(Math.abs(b-d.start_time)).toBeLessThan(10),expect(Math.abs(c-d.stream_switch_time)).toBeLessThan(10),expect(Math.abs(c-d.stream_complete_time)).toBeLessThan(10)}),it("scribes successful timeline refresh",function(){var b=+(new Date);this.component.trigger("uiBeforeNewPageLoad",{}),this.component.trigger("uiPageChanged",{fromCache:!1});var c=+(new Date);this.component.trigger("uiTimelineShouldRefresh",{navigated:!0}),this.component.trigger("dataGotMoreTimelineItems",{});var d=+(new Date),e=this.component.transportLog.pop().event_namespace;expect(e).toEqual(jasmine.objectContaining({event_name:"route_time",source_path:a,dest_path:a,cached:!1,ajax_count:0})),expect(Math.abs(b-e.start_time)).toBeLessThan(10),expect(Math.abs(c-e.stream_switch_time)).toBeLessThan(10),expect(Math.abs(d-e.stream_complete_time)).toBeLessThan(10)}),it("doesn't scribe the timeline refresh on error",function(){jasmine.Clock.useMock(),this.component.trigger("uiBeforeNewPageLoad",{}),this.component.trigger("uiPageChanged",{fromCache:!1}),this.component.trigger("uiTimelineShouldRefresh",{navigated:!0}),this.component.trigger("dataGotMoreTimelineItemsError",{});var b=this.component.transportLog.pop().event_namespace;expect(b).toEqual(jasmine.objectContaining({event_name:"route_time",source_path:a,dest_path:a,cached:!1,ajax_count:0})),expect(b.stream_complete_time).toEqual(b.stream_switch_time)}),it("logs ajax times",function(){this.component.trigger("uiBeforeNewPageLoad",{}),$.active=3,this.component.trigger("uiPageChanged",{fromCache:!1}),this.component.trigger("ajaxComplete",{}),this.component.trigger("ajaxComplete",{}),this.component.trigger("ajaxComplete",{});var a=this.component.transportLog.pop().event_namespace;expect(a).toEqual(jasmine.objectContaining({ajax_count:3}))})})})
});
define("test/app/data/media_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/media_timeline",function(){beforeEach(setupComponent),describe("event uiWantsMoreMediaTimelineItems",function(){it("triggers dataGotMoreTimelineItems when uiWantsMoreMediaTimelineItems called, success case",function(){spyOnEvent(document,"dataGotMoreMediaTimelineItems"),ajaxRespondWithSuccess({items_html:"some html"}),this.component.trigger(document,"uiWantsMoreMediaTimelineItems",{}),expect("dataGotMoreMediaTimelineItems").toHaveBeenTriggeredOn(document)}),it("triggers dataGotMoreTimelineItemsError when uiWantsMoreMediaTimelineItems called, error case",function(){spyOnEvent(document,"dataGotMoreMediaTimelineItemsError"),ajaxRespondWithError({}),this.component.trigger(document,"uiWantsMoreMediaTimelineItems",{}),expect("dataGotMoreMediaTimelineItemsError").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/dm_poll_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/dm_poll",function(){beforeEach(function(){setupComponent()}),describe("DM Poll",function(){it("responds to uiDMPoll",function(){spyOn(this.component,"makeRequest").andCallFake(function(){}),this.$node.trigger("uiDMPoll",{foo:"bar"}),expect(this.component.makeRequest).toHaveBeenCalled()}),it("calls the API",function(){this.component.trigger("uiDMPoll"),expect($.ajax.mostRecentOptions.url).toEqual("/i/notifications")}),it("invokes dataNotificationsReceived",function(){spyOnEvent(document,"dataNotificationsReceived"),ajaxRespondWithSuccess({note:{d:2}}),this.component.trigger("uiDMPoll"),expect("dataNotificationsReceived").toHaveBeenTriggeredOnAndWith(document,{d:2})})})})
});
define("test/app/data/share_via_email_dialog_data_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/share_via_email_dialog_data",function(){var a;beforeEach(function(){setupComponent(),a={tweetId:45,screenName:"sjain",name:"swapnil"},spyOnEvent(document,"dataShareViaEmailDialogSuccess")}),describe("event uiNeedsShareViaDialogData",function(){it("triggers dataShareViaEmailDialogSuccess after a successful ajax call",function(){var b={cursor:"",has_more_items:!1,items_html:""};ajaxRespondWithSuccess(b),this.component.getDialogData({},a),expect($.ajax.mostRecentOptions.url).toBe("/i/sjain/conversation/45"),expect("dataShareViaEmailDialogSuccess").toHaveBeenTriggeredOnAndWith(document,{tweets:"",name:"swapnil"})})})})
});
define("test/app/data/list_follow_card_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/list_follow_card",function(){beforeEach(function(){setupComponent({list_id:13,follow_card_url:"/suggesteduserli/sports/followcard"})}),describe("event uiRefreshFollowCard",function(){beforeEach(function(){spyOnEvent(document,"dataGotFollowCard"),spyOnEvent(document,"dataFailedToGetFollowCard"),this.triggeruiRefresh=function(){this.component.trigger("uiRefreshFollowCard",{sourceEventData:{listId:13}})}}),it("makes an ajax call",function(){this.triggeruiRefresh(),expect($.ajax.mostRecentOptions.url).toBe("/suggesteduserli/sports/followcard")}),it("triggers dataGotFollowCard on success",function(){ajaxRespondWithSuccess({follow_card_html:"html"}),this.triggeruiRefresh(),expect("dataGotFollowCard").toHaveBeenTriggeredOnAndWith(document,{follow_card_html:"html"})}),it("triggers dataFailedToGetFollowCard on failure",function(){ajaxRespondWithError({}),this.triggeruiRefresh(),expect("dataFailedToGetFollowCard").toHaveBeenTriggeredOn(document)})}),describe("event uiEditList",function(){it("makes ajax request to edit list endpoint",function(){var a={name:"list",description:"description",mode:"public",list_id:15};this.component.trigger("uiUpdateList",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/lists/update"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.data).toEqual(this.authToken.addTo(a))}),it("triggers dataDidUpdateList, success case",function(){spyOnEvent(document,"dataDidUpdateList"),ajaxRespondWithSuccess({}),this.component.trigger("uiUpdateList",{name:"list",list_id:15}),expect("dataDidUpdateList").toHaveBeenTriggeredOn(document)}),it("triggers dataFailedToUpdateList, error case",function(){spyOnEvent(document,"dataFailedToUpdateList"),ajaxRespondWithError({}),this.component.trigger("uiUpdateList",{name:"list"}),expect("dataFailedToUpdateList").toHaveBeenTriggeredOn(document)})}),describe("event uiSubscribeToList",function(){it("makes ajax request to subscribe list endpoint",function(){var a={action:"subscribe",list_id:15};this.component.trigger("uiSubscribeToList",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/lists/subscribe.json"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.data).toEqual(this.authToken.addTo(a,!0))}),it("makes ajax request to unsubscribe list endpoint",function(){var a={action:"unsubscribe",list_id:15};this.component.trigger("uiSubscribeToList",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/lists/unsubscribe.json"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.data).toEqual(this.authToken.addTo(a,!0))}),it("triggers dataDidSubscribeToList, success case",function(){spyOnEvent(document,"dataDidSubscribeToList"),ajaxRespondWithSuccess({}),this.component.trigger("uiSubscribeToList",{list_id:15}),expect("dataDidSubscribeToList").toHaveBeenTriggeredOn(document)}),it("triggers dataFailedToSubscribeToList, error case",function(){spyOnEvent(document,"dataFailedToSubscribeToList"),ajaxRespondWithError({}),this.component.trigger("uiSubscribeToList",{list_id:15}),expect("dataFailedToSubscribeToList").toHaveBeenTriggeredOn(document)})}),describe("event uiDeleteList",function(){it("makes ajax request to delete list endpoint",function(){var a={list_id:15};this.component.trigger("uiDeleteList",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/lists/destroy.json"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.data).toEqual(this.authToken.addTo(a,!0))}),it("triggers dataDidDeleteList, success case",function(){spyOnEvent(document,"dataDidDeleteList"),ajaxRespondWithSuccess({}),this.component.trigger("uiDeleteList",{list_id:15}),expect("dataDidDeleteList").toHaveBeenTriggeredOn(document)}),it("triggers dataFailedToDeleteList, error case",function(){spyOnEvent(document,"dataFailedToDeleteList"),ajaxRespondWithError({}),this.component.trigger("uiDeleteList",{list_id:15}),expect("dataFailedToDeleteList").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/geo_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/geo",function(){function d(b,d){it("triggers dataGeoState as locating/changing",function(){expect("dataGeoState").toHaveBeenTriggeredOnAndWith(document,{state:b})}),it("calls api",function(){expect($.ajax.mostRecentOptions.url).toEqual("/account/geo_locate"),expect($.ajax.mostRecentOptions.type).toEqual("POST")}),it("triggers dataGeoState as located on success",function(){$.ajax.mostRecentOptions.success(a),expect("dataGeoState").toHaveBeenTriggeredOnAndWith(document,c)}),it("triggers dataGeoState as enableUnavailable on unknown state",function(){$.ajax.mostRecentOptions.success({}),expect("dataGeoState").toHaveBeenTriggeredOnAndWith(document,{state:d})}),it("triggers dataGeoState as enableUnavailable on error",function(){$.ajax.mostRecentOptions.error(),expect("dataGeoState").toHaveBeenTriggeredOnAndWith(document,{state:d})})}function e(){it("does not set geo_webclient cookie",function(){expect(this.Component.webclientCookie).not.toHaveBeenCalled()}),it("does not call api",function(){expect($.ajax.mostRecentOptions).toBeUndefined()}),it("does not trigger dataGeoState",function(){expect("dataGeoState").not.toHaveBeenTriggeredOn(document)})}function f(){describe("event uiGeoPickerTurnOn",function(){beforeEach(function(){this.component.trigger("uiGeoPickerTurnOn")}),it("sets geo_webclient cookie to 1",function(){expect(this.Component.webclientCookie).toHaveBeenCalledWith("1")}),d("locating","locateIsUnavailable")})}function g(){describe("event uiGeoPickerTurnOff",function(){beforeEach(function(){this.component.trigger("uiGeoPickerTurnOff")}),it("deletes geo_webclient cookie",function(){expect(this.Component.webclientCookie).toHaveBeenCalledWith(null)}),it("does not call api",function(){expect($.ajax.mostRecentOptions).toBeUndefined()}),it("triggers dataGeoState as enabledTurnedOff",function(){expect("dataGeoState").toHaveBeenTriggeredOnAndWith(document,{state:"enabledTurnedOff"})})})}function h(){describe("event uiGeoPickerChange",function(){beforeEach(function(){this.component.trigger("uiGeoPickerChange",{placeId:"5ef5b7f391e30aff"})}),it("calls api with place_id",function(){expect($.ajax.mostRecentOptions.data.override_place_id).toEqual("5ef5b7f391e30aff")}),d("changing","locateIsUnavailable")})}function i(){describe("event uiGeoPickerSearch",function(){describe("query San Francisco",function(){beforeEach(function(){spyOnEvent(document,"dataGeoSearchResults"),this.component.trigger("uiGeoPickerSearch",{query:"San Francisco",placeId:"5ef5b7f391e30aff",isPrefix:!1})}),it("calls api",function(){expect($.ajax.mostRecentOptions.url).toEqual("/account/geo_search"),expect($.ajax.mostRecentOptions.type).toEqual("GET"),expect($.ajax.mostRecentOptions.data.query).toEqual("San Francisco"),expect($.ajax.mostRecentOptions.data.place_id).toEqual("5ef5b7f391e30aff"),expect($.ajax.mostRecentOptions.data.is_prefix).toEqual("0")}),it("triggers dataGeoSearchResults on success",function(){$.ajax.mostRecentOptions.success(b),expect("dataGeoSearchResults").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:b.html}))}),it("triggers dataGeoSearchResultsUnavailable on error",function(){spyOnEvent(document,"dataGeoSearchResultsUnavailable"),$.ajax.mostRecentOptions.error(),expect("dataGeoSearchResultsUnavailable").toHaveBeenTriggeredOn(document)})}),describe("worldwide prefix query San Francisco",function(){beforeEach(function(){spyOnEvent(document,"dataGeoSearchResults"),this.component.trigger("uiGeoPickerSearch",{query:"San",isPrefix:!0})}),it("calls api",function(){expect($.ajax.mostRecentOptions.url).toEqual("/account/geo_search"),expect($.ajax.mostRecentOptions.type).toEqual("GET"),expect($.ajax.mostRecentOptions.data.query).toEqual("San"),expect($.ajax.mostRecentOptions.data.place_id).toBeUndefined(),expect($.ajax.mostRecentOptions.data.is_prefix).toEqual("1")}),it("triggers dataGeoSearchResults on success",function(){$.ajax.mostRecentOptions.success(b),expect("dataGeoSearchResults").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:b.html}))}),it("triggers dataGeoSearchResultsUnavailable on error",function(){spyOnEvent(document,"dataGeoSearchResultsUnavailable"),$.ajax.mostRecentOptions.error(),expect("dataGeoSearchResultsUnavailable").toHaveBeenTriggeredOn(document)})}),describe("empty query",function(){beforeEach(function(){spyOnEvent(document,"dataGeoSearchResults"),this.component.trigger("uiGeoPickerSearch",{query:" "})}),it("does not call api",function(){expect($.ajax.mostRecentOptions).toBeUndefined()}),it("triggers dataGeoSearchResults with empty results",function(){expect("dataGeoSearchResults").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:""}))})}),describe("cached query",function(){beforeEach(function(){this.component.trigger("uiGeoPickerSearch",{query:"San",isPrefix:!0}),$.ajax.mostRecentOptions.success(b)}),it("does not call api a 2nd time",function(){delete $.ajax.mostRecentOptions,this.component.trigger("uiGeoPickerSearch",{query:"San",isPrefix:!0}),expect($.ajax.mostRecentOptions).toBeUndefined()}),it("triggers dataGeoSearchResults with success results",function(){spyOnEvent(document,"dataGeoSearchResults"),this.component.trigger("uiGeoPickerSearch",{query:"San",isPrefix:!0}),expect("dataGeoSearchResults").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:b.html}))})}),describe("Prefix query for Berk while Ber is fetching",function(){beforeEach(function(){spyOnEvent(document,"dataGeoSearchResults"),this.component.trigger("uiGeoPickerSearch",{query:"Ber",isPrefix:!0}),this.component.trigger("uiGeoPickerSearch",{query:"Berk",isPrefix:!0})}),it("calls api both times",function(){expect($.ajax.mostRecentOptions.url).toEqual("/account/geo_search"),expect($.ajax.mostRecentOptions.type).toEqual("GET"),expect($.ajax.mostRecentOptions.data.query).toEqual("Ber"),$.ajax.mostRecentOptions.success({status:"ok",html:"Ber results"}),expect($.ajax.mostRecentOptions.url).toEqual("/account/geo_search"),expect($.ajax.mostRecentOptions.type).toEqual("GET"),expect($.ajax.mostRecentOptions.data.query).toEqual("Berk")}),it("triggers dataGeoSearchResults only once",function(){$.ajax.mostRecentOptions.success({status:"ok",html:"Ber results"}),expect("dataGeoSearchResults").not.toHaveBeenTriggeredOn(document),$.ajax.mostRecentOptions.success({status:"ok",html:"Berk results"}),expect("dataGeoSearchResults").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:"Berk results"}))})}),describe("Prefix query for Berke while Ber is fetching and Berk is pending",function(){beforeEach(function(){spyOnEvent(document,"dataGeoSearchResults"),this.component.trigger("uiGeoPickerSearch",{query:"Ber",isPrefix:!0}),this.component.trigger("uiGeoPickerSearch",{query:"Berk",isPrefix:!0}),this.component.trigger("uiGeoPickerSearch",{query:"Berke",isPrefix:!0})}),it("calls api only two times (skips Berk)",function(){expect($.ajax.mostRecentOptions.url).toEqual("/account/geo_search"),expect($.ajax.mostRecentOptions.type).toEqual("GET"),expect($.ajax.mostRecentOptions.data.query).toEqual("Ber"),$.ajax.mostRecentOptions.success({status:"ok",html:"Ber results"}),expect($.ajax.mostRecentOptions.url).toEqual("/account/geo_search"),expect($.ajax.mostRecentOptions.type).toEqual("GET"),expect($.ajax.mostRecentOptions.data.query).toEqual("Berke")}),it("triggers dataGeoSearchResults only once",function(){$.ajax.mostRecentOptions.success({status:"ok",html:"Ber results"}),expect("dataGeoSearchResults").not.toHaveBeenTriggeredOn(document),$.ajax.mostRecentOptions.success({status:"ok",html:"Berke results"}),expect("dataGeoSearchResults").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({html:"Berke results"}))})})})}var a={status:"ok",place_id:"5a110d312052166f",place_name:"San Francisco, CA",html:'<li class="geo-place-result geo-focusable" data-place-id="5a110d312052166f"><i class="geo-check"></i>San Francisco, CA</li><li class="geo-place-result geo-focusable" data-place-id="5ef5b7f391e30aff">Berkeley, CA</li><li class="geo-place-result geo-focusable" data-place-id="6a71821001635bbd">Daly City, CA</li>'},b={status:"ok",html:'<li class="geo-search-result geo-focusable" data-place-id="5a110d312052166f">San Francisco, CA</li>'},c={state:"located",place_name:a.place_name,place_id:a.place_id,places_html:a.html};beforeEach(function(){spyOnEvent(document,"dataGeoState"),spyOn(this.Component,"webclientCookie")}),describe("geo disabled",function(){beforeEach(function(){setupComponent({geoEnabled:!1,formAuthenticityToken:"dummy auth token"})}),describe("event uiRequestGeoState",function(){it("triggers dataGeoState as disabled",function(){this.component.trigger("uiRequestGeoState"),expect("dataGeoState").toHaveBeenTriggeredOnAndWith(document,{state:"disabled"})})}),describe("event uiGeoPickerEnable",function(){beforeEach(function(){this.component.trigger("uiGeoPickerEnable")}),d("enabling","enableIsUnavailable"),it("calls api with enable=1",function(){expect($.ajax.mostRecentOptions.data.enable).toEqual("1")})}),describe("event uiGeoPickerTurnOn",function(){beforeEach(function(){this.Component.webclientCookie.reset(),this.component.trigger("uiGeoPickerTurnOn")}),e()}),describe("event uiGeoPickerTurnOff",function(){beforeEach(function(){this.Component.webclientCookie.reset(),this.component.trigger("uiGeoPickerTurnOff")}),e()}),describe("event uiGeoPickerChange",function(){beforeEach(function(){this.Component.webclientCookie.reset(),this.component.trigger("uiGeoPickerChange")}),e()}),i()}),describe("geo enabled",function(){describe("geo off, webclient_geo cookie undefined",function(){beforeEach(function(){setupComponent({geoEnabled:!0,formAuthenticityToken:"dummy auth token"})}),describe("event uiRequestGeoState",function(){beforeEach(function(){this.component.trigger("uiRequestGeoState")}),it("triggers dataGeoState as enabledTurnedOff",function(){expect("dataGeoState").toHaveBeenTriggeredOnAndWith(document,{state:"enabledTurnedOff"})})}),describe("event uiGeoPickerEnable",function(){beforeEach(function(){this.component.trigger("uiGeoPickerEnable")}),it("does not call api",function(){expect($.ajax.mostRecentOptions).toBeUndefined()}),it("does not triggers dataGeoState",function(){expect("dataGeoState").not.toHaveBeenTriggeredOn(document)})}),f(),g(),h(),i()}),describe("geo on, webclient_geo cookie = 1",function(){beforeEach(function(){this.Component.webclientCookie.andReturn("1"),setupComponent({geoEnabled:!0,formAuthenticityToken:"dummy auth token"})}),describe("event uiRequestGeoState",function(){beforeEach(function(){this.component.trigger("uiRequestGeoState")}),d("locating","locateIsUnavailable")}),describe("event uiGeoPickerEnable",function(){beforeEach(function(){this.component.trigger("uiGeoPickerEnable")}),it("does not call api",function(){expect($.ajax.mostRecentOptions).toBeUndefined()}),it("does not triggers dataGeoState",function(){expect("dataGeoState").not.toHaveBeenTriggeredOn(document)})}),f(),g(),h(),i()})})})
});
define("test/app/data/direct_messages_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/direct_messages",function(){beforeEach(setupComponent),describe("event dataRefreshDMs",function(){it("calls the API",function(){this.component.trigger("uiNeedsDMConversationList"),expect($.ajax.mostRecentOptions.url).toEqual("/messages")})}),describe("event uiDMDialogSendMessage",function(){var a={text:"Hi",screen_name:"Talkative"};it("calls the API",function(){this.component.trigger("uiDMDialogSendMessage",a),expect($.ajax.mostRecentOptions.url).toEqual("/direct_messages/new"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.data.text).toEqual(a.text),expect($.ajax.mostRecentOptions.data.screen_name).toEqual(a.screen_name)}),it("invokes dataDMSendSuccess",function(){spyOnEvent(document,"dataDMSendSuccess"),this.component.trigger("uiDMDialogSendMessage",a),$.ajax.mostRecentOptions.success({}),expect("dataDMSendSuccess").toHaveBeenTriggeredOn(document)})}),describe("event uiDMDialogDeleteMessage",function(){var a={id:10};it("calls the API",function(){this.component.trigger("uiDMDialogDeleteMessage",a),expect($.ajax.mostRecentOptions.url).toEqual("/direct_messages/destroy"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.data.id).toEqual(a.id)}),it("invokes dataDMDeleteSuccess",function(){spyOnEvent(document,"dataDMDeleteSuccess"),this.component.trigger("uiDMDialogDeleteMessage",a),$.ajax.mostRecentOptions.success({}),expect("dataDMDeleteSuccess").toHaveBeenTriggeredOn(document)})}),describe("event uiNeedsDmConversationList",function(){it("calls the API",function(){this.component.trigger("uiNeedsDMConversationList"),expect($.ajax.mostRecentOptions.url).toEqual("/messages")}),it("triggers dataDMConversationListResult on success",function(){ajaxRespondWithSuccess({foo:"bar"}),spyOnEvent(document,"dataDMConversationListResult"),this.component.trigger("uiNeedsDMConversationList"),expect("dataDMConversationListResult").toHaveBeenTriggeredOnAndWith(document,{foo:"bar"})}),it("can pass parameters to the API",function(){this.component.trigger("uiNeedsDMConversationList",{since_id:20,count:10}),expect($.ajax).toHaveBeenCalled(),expect($.ajax.mostRecentOptions.data.since_id).toEqual(20),expect($.ajax.mostRecentOptions.data.count).toEqual(10)})}),describe("event uiNeedsDMConversation",function(){it("calls the /messages/with API",function(){this.component.trigger("uiNeedsDMConversation",{screen_name:"jcummins"}),expect($.ajax).toHaveBeenCalled(),expect($.ajax.mostRecentOptions.url).toEqual("/messages/with/jcummins")}),it("triggers dataDMConversationResult when there is no msgAction",function(){spyOnEvent(document,"dataDMConversationResult"),this.component.trigger("uiNeedsDMConversation",{screen_name:"chatty"}),$.ajax.mostRecentOptions.success({}),expect("dataDMConversationResult").toHaveBeenTriggeredOn(document)}),it("triggers dataDM{{msgAction}}Success when there is a msgAction",function(){spyOnEvent(document,"dataDMDeleteSuccess"),this.component.trigger("uiNeedsDMConversation",{screen_name:"chatty",msgAction:"Delete"}),$.ajax.mostRecentOptions.success({}),expect("dataDMDeleteSuccess").toHaveBeenTriggeredOn(document)})}),describe("method possiblyOpenDMDialog",function(){beforeEach(function(){spyOnEvent(document,"uiNeedsDMDialog")}),it("does not trigger uiNeedsDMDialog if dm_options is not set",function(){this.component.trigger("uiSwiftLoaded"),expect("uiNeedsDMDialog").not.toHaveBeenTriggeredOn(document)}),it("triggers uiNeedsDMDialog when dm_options is set",function(){this.component.attr.dm_options={show_dm_dialog:!0},this.component.trigger("uiSwiftLoaded"),expect("uiNeedsDMDialog").toHaveBeenTriggeredOn(document)}),it("triggers uiOpenDMConversation when recipient is set",function(){spyOnEvent(document,"uiOpenDMConversation"),this.component.attr.dm_options={show_dm_dialog:!0,recipient:"chatty"},this.component.trigger("uiSwiftLoaded"),expect("uiNeedsDMDialog").toHaveBeenTriggeredOnAndWith(document,{screen_name:"chatty",fromInitData:!0})})}),describe("dataDMConversationListResult",function(){beforeEach(function(){spyOnEvent(document,"dataUserHasNoUnreadDMs"),spyOn(this.component.storage,"setItem")}),describe("when there is only last_message_id",function(){beforeEach(function(){this.component.trigger("dataDMConversationListResult",{last_message_id:"101"})}),it("does not save last_message_id in localStorage",function(){expect(this.component.storage.setItem).not.toHaveBeenCalled()}),it("does not trigger dataUserHasNoUnreadDMs",function(){expect("dataUserHasNoUnreadDMs").not.toHaveBeenTriggeredOn(document)})})}),describe("event dataMarkDMsAsRead",function(){var a={last_message_id:1,recipient_id:2};it("calls the API",function(){this.component.trigger("dataMarkDMsAsRead",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/messages/mark_read"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.data.last_message_id).toEqual(a.last_message_id),expect($.ajax.mostRecentOptions.data.recipient_id).toEqual(a.recipient_id)}),it("throws an error if last_message_id is missing",function(){expect(function(){this.component.trigger("dataMarkDMsAsRead",{})}).toThrow()}),it("ignores random parameters",function(){var b={ignoreMe:"some value"};this.component.trigger("dataMarkDMsAsRead",$.extend(b,a)),expect($.ajax.mostRecentOptions.data.ignoreMe).not.toEqual(b.ignoreMe),expect($.ajax.mostRecentOptions.data.ignoreMe).toEqual(undefined)}),it("invokes dataDMReadSuccess",function(){spyOnEvent(document,"dataDMReadSuccess"),this.component.trigger("dataMarkDMsAsRead",a),$.ajax.mostRecentOptions.success({text:"success"}),expect("dataDMReadSuccess").toHaveBeenTriggeredOnAndWith(document,{text:"success",lastMessageId:a.last_message_id})}),describe("failures",function(){beforeEach(function(){this.data={last_message_id:1,recipient_id:2},spyOnEvent(document,"dataMarkDMsAsRead")}),it("retries once if the response is invalid",function(){spyOnEvent(document,"dataDMReadSuccess"),this.component.markDMsAsRead(null,this.data),$.ajax.mostRecentOptions.success({text:"failure"}),expect("dataDMReadSuccess").not.toHaveBeenTriggeredOn(document),expect("dataMarkDMsAsRead").toHaveBeenTriggeredOnAndWith(document,this.data)}),it("retries once if there's an error",function(){spyOnEvent(document,"dataDMReadError"),this.component.markDMsAsRead(null,this.data),$.ajax.mostRecentOptions.error({}),expect("dataDMReadError").not.toHaveBeenTriggeredOn(document),expect("dataMarkDMsAsRead").toHaveBeenTriggeredOnAndWith(document,this.data)})})}),describe("dm notifications",function(){it("triggers dataUserHasUnreadDMsWithCount when there's a dm notification",function(){spyOnEvent(document,"dataUserHasUnreadDMsWithCount"),this.component.trigger("dataNotificationsReceived",{d:{response:3,status:"ok"}}),expect("dataUserHasUnreadDMsWithCount").toHaveBeenTriggeredOnAndWith(document,{msgCount:3})}),it("triggers dataUserHasNoUnreadDMsWithCount when there's no dm notification",function(){spyOnEvent(document,"dataUserHasNoUnreadDMsWithCount"),this.component.trigger("dataNotificationsReceived",{d:{response:0,status:"ok"}}),expect("dataUserHasNoUnreadDMsWithCount").toHaveBeenTriggeredOn(document)}),it("does not trigger any event when there's empty response",function(){spyOnEvent(document,"dataUserHasNoUnreadDMsWithCount"),this.component.trigger("dataNotificationsReceived"),expect("dataUserHasUnreadDMsWithCount").not.toHaveBeenTriggeredOn(document),expect("dataUserHasNoUnreadDMsWithCount").not.toHaveBeenTriggeredOn(document)}),it("does not trigger any event when there's an error",function(){spyOnEvent(document,"dataUserHasNoUnreadDMsWithCount"),this.component.trigger("dataNotificationsReceived",{d:{status:"error"}}),expect("dataUserHasUnreadDMsWithCount").not.toHaveBeenTriggeredOn(document),expect("dataUserHasNoUnreadDMsWithCount").not.toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/form_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/form_scribe",function(){beforeEach(function(){var a='<form>\n        <input type="checkbox" id="checkbox1">\n        <input type="radio" id="radio1" name="radio_group" value="foo">\n        <input type="radio" id="radio2" name="radio_group" value="bar">\n        <select id="select1">\n          <option value="one">one</option>\n          <option value="two">two</option>\n        </select>\n        <input type="text" id="text1"/>\n        <input type="password" id="password1"/>\n        <textarea id="textarea1">TextArea One</textarea>\n        <input type="file" id="file1">\n        <input type="button" id="button1" value="input_button"/>\n        <button type="button" id="button2" value="button_tag">Button Tag</button>\n        <a href="#" id="link1">Link One</a>\n      </form>\n    ';setupComponent(a,{eventData:{scribeContext:{component:"test_form"}},formElements:{checkbox_uno:"#checkbox1",radio_uno:"#radio1",radio_dos:"#radio2",select_uno:"#select1",text_uno:"#text1",password_uno:"#password1",textarea_uno:"#textarea1",file_uno:"#file1",button_uno:"#button1",button_dos:"#button2",link_uno:"#link1"}})}),it("scribes events on checkboxes",function(){var a=this.component.$node.find("#checkbox1");a.click(),expect(this.component).toScribe({component:"test_form",element:"checkbox_uno",action:"select"}),a.click(),expect(this.component).toScribe({component:"test_form",element:"checkbox_uno",action:"deselect"})}),it("scribes events on radio buttons",function(){var a=this.component.$node.find("#radio1"),b=this.component.$node.find("#radio2");a.click(),expect(this.component).toScribe({component:"test_form",element:"radio_uno",action:"select"},{item_names:["foo"]}),a.click(),expect(this.component).not.toScribe({component:"test_form",element:"radio_uno",action:"deselect"}),b.click(),expect(this.component).toScribe({component:"test_form",element:"radio_dos",action:"select"},{item_names:["bar"]}),a.click(),expect(this.component).not.toScribe({component:"test_form",element:"radio_dos",action:"deselect"})}),it("triggers events on select boxes",function(){var a=this.component.$node.find("#select1");a.val("two"),a.trigger("change"),expect(this.component).toScribe({component:"test_form",element:"select_uno",action:"change"},{item_names:["two"]})}),it("triggers events on text fields",function(){var a=this.component.$node.find("#text1");a.val("hello!"),a.trigger("change"),expect(this.component).toScribe({component:"test_form",element:"text_uno",action:"change"},{item_names:["hello!"]})}),it("triggers events on password fields",function(){var a=this.component.$node.find("#password1");a.val("hello!"),a.trigger("change"),expect(this.component).not.toScribe({component:"test_form",element:"password_uno",action:"change"},{item_names:["hello!"]}),expect(this.component).toScribe({component:"test_form",element:"password_uno",action:"change"})}),it("triggers events on textareas",function(){var a=this.component.$node.find("#textarea1");a.val("hello!"),a.trigger("change"),expect(this.component).toScribe({component:"test_form",element:"textarea_uno",action:"change"},{item_names:["hello!"]})}),it("triggers events on buttons",function(){var a=this.component.$node.find("#button1"),b=this.component.$node.find("#button2");a.click(),expect(this.component).toScribe({component:"test_form",element:"button_uno",action:"click"}),b.click(),expect(this.component).toScribe({component:"test_form",element:"button_dos",action:"click"})}),it("triggers events on links",function(){var a=this.component.$node.find("#link1");a.click(),expect(this.component).toScribe({component:"test_form",element:"link_uno",action:"click"},{url:urlForAssertion("#")})})})
});
define("test/app/data/tweet_actions_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/tweet_actions",function(){var a;beforeEach(function(){setupComponent(),a={id:42,retweetId:52,impressionId:"an_impression_id",disclosureType:"promoted"}}),describe("takeAction",function(){var b="retweet";it("sends the impressionId as impression_id if it is present",function(){this.component.takeAction(b,{},a),expect($.ajax.mostRecentOptions.data.impression_id).toEqual("an_impression_id"),expect($.ajax.mostRecentOptions.data.earned).toEqual(!1)}),it("does not include the impression_id field if no impressionId was present",function(){delete a.impressionId,this.component.takeAction(b,{},a),expect($.ajax.mostRecentOptions.data.impression_id).toBeUndefined(),expect($.ajax.mostRecentOptions.data.earned).toBeUndefined()}),it("does not include the impression_id field if impressionId is false-ish",function(){a.impressionId=null,this.component.takeAction(b,{},a),expect($.ajax.mostRecentOptions.data.impression_id).toBeUndefined()}),it("sets earned=true if disclosureType is earned",function(){a.disclosureType="earned",this.component.takeAction(b,{},a),expect($.ajax.mostRecentOptions.data.impression_id).toEqual("an_impression_id"),expect($.ajax.mostRecentOptions.data.earned).toEqual(!0)}),it("triggers dataGotProfileStats on success",function(){var c=[{user_id:3}];ajaxRespondWithSuccess({profile_stats:c}),spyOnEvent(document,"dataGotProfileStats"),this.component.takeAction(b,{},a),expect("dataGotProfileStats").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({stats:c}))})}),describe("event uiDidRetweet",function(){it("calls $.ajax with the correct arguments",function(){this.component.trigger("uiDidRetweet",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/tweet/retweet"),expect($.ajax.mostRecentOptions.data.authenticity_token).toEqual("AUTHORIZED"),expect($.ajax.mostRecentOptions.data.impression_id).toEqual("an_impression_id")}),it("triggers dataDidRetweet when uiDidRetweet called, success case",function(){spyOnEvent(this.component.$node,"dataDidRetweet"),ajaxRespondWithSuccess({tweet_id:"42"}),this.component.trigger("uiDidRetweet",a),expect("dataDidRetweet").toHaveBeenTriggeredOnAndWith(this.component.$node,{tweet_id:"42"})}),it("triggers dataFailedToRetweet when uiDidRetweet called, error case",function(){spyOnEvent(this.component.$node,"dataFailedToRetweet"),ajaxRespondWithError({}),this.component.trigger("uiDidRetweet",a),expect("dataFailedToRetweet").toHaveBeenTriggeredOn(this.component.$node)}),it("sends retweet id when a retweet is retweeted",function(){this.component.trigger("uiDidRetweet",a),expect($.ajax.mostRecentOptions.data.id).toEqual(52)}),it("sends tweet id when a tweet is retweeted",function(){delete a.retweetId,this.component.trigger("uiDidRetweet",a),expect($.ajax.mostRecentOptions.data.id).toEqual(42)})}),describe("event uiDidUnretweet",function(){it("calls $.ajax with the correct arguments",function(){this.component.trigger("uiDidUnretweet",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/tweet/unretweet"),expect($.ajax.mostRecentOptions.data.authenticity_token).toEqual("AUTHORIZED"),expect($.ajax.mostRecentOptions.data.impression_id).toEqual("an_impression_id")}),it("triggers dataDidUnretweet when uiDidUnretweet called, success case",function(){spyOnEvent(this.component.$node,"dataDidUnretweet"),ajaxRespondWithSuccess({}),this.component.trigger("uiDidUnretweet",a),expect("dataDidUnretweet").toHaveBeenTriggeredOn(this.component.$node)}),it("triggers dataFailedToUnretweet when uiDidUnretweet called, error case",function(){spyOnEvent(this.component.$node,"dataFailedToUnretweet"),ajaxRespondWithError({}),this.component.trigger("uiDidUnretweet",a),expect("dataFailedToUnretweet").toHaveBeenTriggeredOn(this.component.$node)})}),describe("event uiDidDeleteTweet",function(){it("calls $.ajax with the correct arguments",function(){this.component.trigger("uiDidDeleteTweet",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/tweet/destroy"),expect($.ajax.mostRecentOptions.data.authenticity_token).toEqual("AUTHORIZED"),expect($.ajax.mostRecentOptions.data.impression_id).toEqual("an_impression_id")}),it("triggers dataDidDeleteTweet when uiDidDeleteTweet called, success case",function(){spyOnEvent(this.component.$node,"dataDidDeleteTweet"),ajaxRespondWithSuccess({}),this.component.trigger("uiDidDeleteTweet",a),expect("dataDidDeleteTweet").toHaveBeenTriggeredOn(this.component.$node)}),it("triggers dataFailedToDeleteTweet when uiDidDeleteTweet called, error case",function(){spyOnEvent(this.component.$node,"dataFailedToDeleteTweet"),ajaxRespondWithError({}),this.component.trigger("uiDidDeleteTweet",a),expect("dataFailedToDeleteTweet").toHaveBeenTriggeredOn(this.component.$node)})}),describe("event uiDidFavoriteTweet",function(){it("calls $.ajax with the correct arguments",function(){this.component.trigger("uiDidFavoriteTweet",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/tweet/favorite"),expect($.ajax.mostRecentOptions.data.authenticity_token).toEqual("AUTHORIZED"),expect($.ajax.mostRecentOptions.data.impression_id).toEqual("an_impression_id")}),it("triggers dataDidFavoriteTweet when uiDidFavoriteTweet called, success case",function(){spyOnEvent(this.component.$node,"dataDidFavoriteTweet"),ajaxRespondWithSuccess({}),this.component.trigger("uiDidFavoriteTweet",a),expect("dataDidFavoriteTweet").toHaveBeenTriggeredOn(this.component.$node)}),it("triggers dataFailedToFavoriteTweet when uiDidFavoriteTweet called, error case",function(){spyOnEvent(this.component.$node,"dataFailedToFavoriteTweet"),ajaxRespondWithError({}),this.component.trigger("uiDidFavoriteTweet",a),expect("dataFailedToFavoriteTweet").toHaveBeenTriggeredOn(this.component.$node)}),it("sends retweet id when a retweet is favorited",function(){this.component.trigger("uiDidFavoriteTweet",a),expect($.ajax.mostRecentOptions.data.id).toEqual(52)}),it("sends tweet id when a tweet is favorited",function(){delete a.retweetId,this.component.trigger("uiDidFavoriteTweet",a),expect($.ajax.mostRecentOptions.data.id).toEqual(42)})}),describe("event uiDidUnfavoriteTweet",function(){it("calls $.ajax with the correct arguments",function(){this.component.trigger("uiDidUnfavoriteTweet",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/tweet/unfavorite"),expect($.ajax.mostRecentOptions.data.authenticity_token).toEqual("AUTHORIZED"),expect($.ajax.mostRecentOptions.data.impression_id).toEqual("an_impression_id")}),it("triggers dataDidUnfavoriteTweet when uiDidUnfavoriteTweet called, success case",function(){spyOnEvent(this.component.$node,"dataDidUnfavoriteTweet"),ajaxRespondWithSuccess({}),this.component.trigger("uiDidUnfavoriteTweet",a),expect("dataDidUnfavoriteTweet").toHaveBeenTriggeredOn(this.component.$node)}),it("triggers dataFailedToUnfavoriteTweet when uiDidUnfavoriteTweet called, error case",function(){spyOnEvent(this.component.$node,"dataFailedToUnfavoriteTweet"),ajaxRespondWithError({}),this.component.trigger("uiDidUnfavoriteTweet",a),expect("dataFailedToUnfavoriteTweet").toHaveBeenTriggeredOn(this.component.$node)})}),describe("event uiDidReportTweet",function(){it("calls $.ajax with the correct arguments",function(){this.component.trigger("uiDidReportTweet",{userId:1,tweetId:2,screenName:"jack",blockUser:!0,reportType:"abusive"}),expect($.ajax.mostRecentOptions.url).toEqual("/i/tweet/report"),expect($.ajax.mostRecentOptions.data.user_id).toEqual(1),expect($.ajax.mostRecentOptions.data.tweet_id).toEqual(2),expect($.ajax.mostRecentOptions.data.screen_name).toEqual("jack"),expect($.ajax.mostRecentOptions.data.block_user).toEqual(!0),expect($.ajax.mostRecentOptions.data.report_type).toEqual("abusive")}),it("triggers dataDidReportTweet on success",function(){spyOnEvent(this.component.$node,"dataDidReportTweet"),ajaxRespondWithSuccess({}),this.component.trigger("uiDidReportTweet",a),expect("dataDidReportTweet").toHaveBeenTriggeredOn(this.component.$node)}),it("triggers dataFailedToReportTweet on failure",function(){spyOnEvent(this.component.$node,"dataFailedToReportTweet"),ajaxRespondWithError({}),this.component.trigger("uiDidReportTweet",a),expect("dataFailedToReportTweet").toHaveBeenTriggeredOn(this.component.$node)})}),describe("event uiDidUserPinTweet",function(){it("calls $.ajax with the correct arguments",function(){this.component.trigger("uiDidUserPinTweet",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/tweet/pin"),expect($.ajax.mostRecentOptions.data.authenticity_token).toEqual("AUTHORIZED")}),it("triggers dataDidUserPinTweet when uiDidUserPinTweet called, success case",function(){spyOnEvent(this.component.$node,"dataDidUserPinTweet"),ajaxRespondWithSuccess({}),this.component.trigger("uiDidUserPinTweet",a),expect("dataDidUserPinTweet").toHaveBeenTriggeredOn(this.component.$node)}),it("triggers dataFailedToUserPinTweet when uiDidUserPinTweet called, error case",function(){spyOnEvent(this.component.$node,"dataFailedToUserPinTweet"),ajaxRespondWithError({}),this.component.trigger("uiDidUserPinTweet",a),expect("dataFailedToUserPinTweet").toHaveBeenTriggeredOn(this.component.$node)}),it("sends tweet id (not the retweet id) when a retweet is pinned",function(){this.component.trigger("uiDidUserPinTweet",a),expect($.ajax.mostRecentOptions.data.id).toEqual(42)})}),describe("event uiDidUserUnpinTweet",function(){it("calls $.ajax with the correct arguments",function(){this.component.trigger("uiDidUserUnpinTweet",a),expect($.ajax.mostRecentOptions.url).toEqual("/i/tweet/unpin"),expect($.ajax.mostRecentOptions.data.authenticity_token).toEqual("AUTHORIZED")}),it("triggers dataDidUserUnpinTweet when uiDidUserUnpinTweet called, success case",function(){spyOnEvent(this.component.$node,"dataDidUserUnpinTweet"),ajaxRespondWithSuccess({}),this.component.trigger("uiDidUserUnpinTweet",a),expect("dataDidUserUnpinTweet").toHaveBeenTriggeredOn(this.component.$node)}),it("triggers dataFailedToUserUnpinTweet when uiDidUserUnpinTweet called, error case",function(){spyOnEvent(this.component.$node,"dataFailedToUserUnpinTweet"),ajaxRespondWithError({}),this.component.trigger("uiDidUserUnpinTweet",a),expect("dataFailedToUserUnpinTweet").toHaveBeenTriggeredOn(this.component.$node)}),it("sends tweet id (not the retweet id) when a retweet is unpinned",function(){this.component.trigger("uiDidUserUnpinTweet",a),expect($.ajax.mostRecentOptions.data.id).toEqual(42)})})})
});
define("test/app/utils/cookie_spec",["module","require","exports","app/utils/cookie"],function(module, require, exports) {
function clearTestCookies(){var a,b,c="=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",d=["_undef_","_null_","_str_","_num_","_bool_","_date_","_expired_","_to_expire_"];for(a=0,b=d.length;a<b;a+=1)document.cookie=d[a]+c}var cookie=require("app/utils/cookie");module.exports={},beforeEach(clearTestCookies),afterEach(clearTestCookies),describe("cookie",function(){it("reads an non-existing key and returns null",function(){expect(cookie("_non_existing_")).toBeNull()}),it("writes an undefined value and returns null",function(){cookie("_undef_",undefined),expect(cookie("_undef_")).toBeNull()}),it("writes and reads a null value",function(){cookie("_null_",null),expect(cookie("_null_")).toBeNull()}),it("writes and reads a String value",function(){cookie("_str_","foo"),expect(cookie("_str_")).toBe("foo")}),it("writes and reads a Number value",function(){cookie("_num_",123),expect(cookie("_num_")).toBe("123")}),it("writes and reads a Boolean value",function(){cookie("_bool_",!0),expect(cookie("_bool_")).toBe("true")}),it("writes and reads a Date value",function(){var a=new Date,b=a.toString();cookie("_date_",a),expect(cookie("_date_")).toBe(b)}),it("writes a cookie expired in the past returns null",function(){cookie("_expired_","foo",{expires:-1}),expect(cookie("_expired_")).toBeNull()}),it("writes a cookie expiring in 1.5s returns value in .5s then null after 1.5s",function(){var a;cookie("_to_expire_","foo",{expires:1.5/86400}),waitsFor(function(){return cookie("_to_expire_")==="foo"},"cookie to be set",1e3),waitsFor(function(){return cookie("_to_expire_")!=="foo"},"cookie to be unset",2e3),runs(function(){expect(cookie("_to_expire_")).toBeNull()})})})
});
define("test/app/utils/with_session_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/utils/with_session",function(){var a="with_session_spec";beforeEach(setupComponent),describe("#setSessionItem",function(){it("saves an item to sessionStorage",function(){this.component.setSessionItem(a,"foo"),expect(window.sessionStorage[a]).toEqual("foo")})}),describe("#removeSessionItem",function(){it("removes an item from sessionStorage",function(){window.sessionStorage[a]="bar",this.component.removeSessionItem(a),expect(window.sessionStorage[a]).toBeUndefined()})}),describe("#getSessionItem",function(){it("gets an item from sessionStorage",function(){window.sessionStorage[a]="bar",expect(this.component.getSessionItem(a)).toEqual("bar")})}),describe("#setSessionObject",function(){it("calls setSessionItem with stringified object",function(){spyOn(this.component,"setSessionItem"),this.component.setSessionObject(a,{foo:"bar"}),expect(this.component.setSessionItem).toHaveBeenCalledWith(a,'{"foo":"bar"}')}),it("calls removeSessionItem when object is undefined",function(){spyOn(this.component,"removeSessionItem"),this.component.setSessionObject(a,undefined),expect(this.component.removeSessionItem).toHaveBeenCalledWith(a)})}),describe("#getSessionObject",function(){it("calls getSessionItem and returns the object when it exists",function(){spyOn(this.component,"getSessionItem").andReturn('{"foo":"bar"}'),expect(this.component.getSessionObject(a)).toEqual({foo:"bar"}),expect(this.component.getSessionItem).toHaveBeenCalledWith(a)}),it("returns undefined when the key does not exist",function(){spyOn(this.component,"getSessionItem").andReturn(undefined),expect(this.component.getSessionObject(a)).toBeUndefined()})})})
});
define("test/app/utils/typeahead_helpers_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/utils/typeahead_helpers",function(){beforeEach(function(){this.helpers=this.Module}),describe("Query helpers mixin",function(){it("tokenizes basic queries correctly",function(){expect(this.helpers.tokenizeText("asdf").length).toBe(1)}),it("tokenizes multi-term queries correctly",function(){expect(this.helpers.tokenizeText("asdf fdsa").length).toBe(2)}),it("tokenizes punctuated queries correctly",function(){var a=this.helpers.tokenizeText("J.P. Cummins,Twitter-SF_CA");expect(a[0]).toBe("j"),expect(a[1]).toBe("p"),expect(a[2]).toBe("cummins"),expect(a[3]).toBe("twitter"),expect(a[4]).toBe("sf"),expect(a[5]).toBe("ca")}),it("properly gets the first char when multi-byte",function(){expect(this.helpers.getFirstChar("𝌆f")).toBe("𝌆"),expect(this.helpers.getFirstChar("𝌆𝌆")).toBe("𝌆"),expect(this.helpers.getFirstChar("𝌆")).toBe("𝌆")}),it("properly gets the first char when normal string",function(){expect(this.helpers.getFirstChar("f𝌆")).toBe("f"),expect(this.helpers.getFirstChar("f")).toBe("f")})})})
});
deferred('$lib/easyXDM.js', function() {
/*! easyxdm.net (c) 2009-2011, Øyvind Sean Kinsey oyvind@kinsey.no https://raw.github.com/oyvindkinsey/easyXDM/master/MIT-license.txt */(function(a,b,c,d,e,f){function s(a,b){var c=typeof a[b];return c=="function"||c=="object"&&!!a[b]||c=="unknown"}function t(a,b){return typeof a[b]=="object"&&!!a[b]}function u(a){return Object.prototype.toString.call(a)==="[object Array]"}function v(a){try{var b=new ActiveXObject(a);return b=null,!0}catch(c){return!1}}function B(){B=i,y=!0;for(var a=0;a<z.length;a++)z[a]();z.length=0}function D(a,b){if(y){a.call(b);return}z.push(function(){a.call(b)})}function E(){var a=parent;if(m!=="")for(var b=0,c=m.split(".");b<c.length;b++)a=a[c[b]];return a.easyXDM}function F(b){return a.easyXDM=o,m=b,m&&(p="easyXDM_"+m.replace(".","_")+"_"),n}function G(a){return a.match(j)[3]}function H(a){var b=a.match(j),c=b[2],d=b[3],e=b[4]||"";if(c=="http:"&&e==":80"||c=="https:"&&e==":443")e="";return c+"//"+d+e}function I(a){a=a.replace(l,"$1/");if(!a.match(/^(http||https):\/\//)){var b=a.substring(0,1)==="/"?"":c.pathname;b.substring(b.length-1)!=="/"&&(b=b.substring(0,b.lastIndexOf("/")+1)),a=c.protocol+"//"+c.host+b+a}while(k.test(a))a=a.replace(k,"");return a}function J(a,b){var c="",d=a.indexOf("#");d!==-1&&(c=a.substring(d),a=a.substring(0,d));var e=[];for(var g in b)b.hasOwnProperty(g)&&e.push(g+"="+f(b[g]));return a+(r?"#":a.indexOf("?")==-1?"?":"&")+e.join("&")+c}function L(a){return typeof a=="undefined"}function M(){var a={},b={a:[1,2,3]},c='{"a":[1,2,3]}';return typeof JSON!="undefined"&&typeof JSON.stringify=="function"&&JSON.stringify(b).replace(/\s/g,"")===c?JSON:(Object.toJSON&&Object.toJSON(b).replace(/\s/g,"")===c&&(a.stringify=Object.toJSON),typeof String.prototype.evalJSON=="function"&&(b=c.evalJSON(),b.a&&b.a.length===3&&b.a[2]===3&&(a.parse=function(a){return a.evalJSON()})),a.stringify&&a.parse?(M=function(){return a},a):null)}function N(a,b,c){var d;for(var e in b)b.hasOwnProperty(e)&&(e in a?(d=b[e],typeof d=="object"?N(a[e],d,c):c||(a[e]=b[e])):a[e]=b[e]);return a}function O(){var c=b.createElement("iframe");c.name=p+"TEST",N(c.style,{position:"absolute",left:"-2000px",top:"0px"}),b.body.appendChild(c),q=c.contentWindow!==a.frames[c.name],b.body.removeChild(c)}function P(a){L(q)&&O();var c;q?c=b.createElement("<iframe name='"+a.props.name+"' frameborder='0' allowtransparency='false' tabindex='-1', role='presentation' scrolling='no' />"):(c=b.createElement("IFRAME"),c.name=a.props.name,c.setAttribute("frameborder","0"),c.setAttribute("allowtransparency","false"),c.setAttribute("tabindex","-1"),c.setAttribute("role","presentation"),c.setAttribute("scrolling","no")),c.id=c.name=a.props.name,delete a.props.name,a.onLoad&&w(c,"load",a.onLoad),typeof a.container=="string"&&(a.container=b.getElementById(a.container)),a.container||(c.style.position="absolute",c.style.top="-2000px",a.container=b.body);var d=a.props.src;return delete a.props.src,N(c,a.props),c.border=c.frameBorder=0,a.container.appendChild(c),c.src=d,a.props.src=d,c}function Q(a,b){typeof a=="string"&&(a=[a]);var c,d=a.length;while(d--){c=a[d],c=new RegExp(c.substr(0,1)=="^"?c:"^"+c.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$");if(c.test(b))return!0}return!1}function R(d){var e=d.protocol,f;d.isHost=d.isHost||L(K.xdm_p),r=d.hash||!1,d.props||(d.props={});if(!d.isHost){d.channel=K.xdm_c,d.secret=K.xdm_s,d.remote=K.xdm_e,e=K.xdm_p;if(d.acl&&!Q(d.acl,d.remote))throw new Error("Access denied for "+d.remote)}else d.remote=I(d.remote),d.channel=d.channel||"default"+h++,d.secret=Math.random().toString(16).substring(2),L(e)&&(H(c.href)==H(d.remote)?e="4":s(a,"postMessage")||s(b,"postMessage")?e="1":s(a,"ActiveXObject")&&v("ShockwaveFlash.ShockwaveFlash")?e="6":navigator.product==="Gecko"&&"frameElement"in a&&navigator.userAgent.indexOf("WebKit")==-1?e="5":d.remoteHelper?(d.remoteHelper=I(d.remoteHelper),e="2"):e="0");switch(e){case"0":N(d,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0);if(d.isHost){if(!d.local){var g=c.protocol+"//"+c.host,i=b.body.getElementsByTagName("img"),j,k=i.length;while(k--){j=i[k];if(j.src.substring(0,g.length)===g){d.local=j.src;break}}d.local||(d.local=a)}var l={xdm_c:d.channel,xdm_p:0};d.local===a?(d.usePolling=!0,d.useParent=!0,d.local=c.protocol+"//"+c.host+c.pathname+c.search,l.xdm_e=d.local,l.xdm_pa=1):l.xdm_e=I(d.local),d.container&&(d.useResize=!1,l.xdm_po=1),d.remote=J(d.remote,l)}else N(d,{channel:K.xdm_c,remote:K.xdm_e,useParent:!L(K.xdm_pa),usePolling:!L(K.xdm_po),useResize:d.useParent?!1:d.useResize});f=[new n.stack.HashTransport(d),new n.stack.ReliableBehavior({}),new n.stack.QueueBehavior({encode:!0,maxLength:4e3-d.remote.length}),new n.stack.VerifyBehavior({initiate:d.isHost})];break;case"1":f=[new n.stack.PostMessageTransport(d)];break;case"2":f=[new n.stack.NameTransport(d),new n.stack.QueueBehavior,new n.stack.VerifyBehavior({initiate:d.isHost})];break;case"3":f=[new n.stack.NixTransport(d)];break;case"4":f=[new n.stack.SameOriginTransport(d)];break;case"5":f=[new n.stack.FrameElementTransport(d)];break;case"6":d.swf||(d.swf="../../tools/easyxdm.swf"),f=[new n.stack.FlashTransport(d)]}return f.push(new n.stack.QueueBehavior({lazy:d.lazy,remove:!0})),f}function S(a){var b,c={incoming:function(a,b){this.up.incoming(a,b)},outgoing:function(a,b){this.down.outgoing(a,b)},callback:function(a){this.up.callback(a)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var d=0,e=a.length;d<e;d++)b=a[d],N(b,c,!0),d!==0&&(b.down=a[d-1]),d!==e-1&&(b.up=a[d+1]);return b}function T(a){a.up.down=a.down,a.down.up=a.up,a.up=a.down=null}var g=this,h=Math.floor(Math.random()*1e4),i=Function.prototype,j=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,k=/[\-\w]+\/\.\.\//,l=/([^:])\/\//g,m="",n={},o=a.easyXDM,p="easyXDM_",q,r=!1,w,x;if(s(a,"addEventListener"))w=function(a,b,c){a.addEventListener(b,c,!1)},x=function(a,b,c){a.removeEventListener(b,c,!1)};else{if(!s(a,"attachEvent"))throw new Error("Browser not supported");w=function(a,b,c){a.attachEvent("on"+b,c)},x=function(a,b,c){a.detachEvent("on"+b,c)}}var y=!1,z=[],A;"readyState"in b?(A=b.readyState,y=A=="complete"||~navigator.userAgent.indexOf("AppleWebKit/")&&(A=="loaded"||A=="interactive")):y=!!b.body;if(!y){if(s(a,"addEventListener"))w(b,"DOMContentLoaded",B);else{w(b,"readystatechange",function(){b.readyState=="complete"&&B()});if(b.documentElement.doScroll&&a===top){var C=function(){if(y)return;try{b.documentElement.doScroll("left")}catch(a){d(C,1);return}B()};C()}}w(a,"load",B)}var K=function(a){a=a.substring(1).split("&");var b={},c,d=a.length;while(d--)c=a[d].split("="),b[c[0]]=e(c[1]);return b}(/xdm_e=/.test(c.search)?c.search:c.hash);N(n,{version:"2.4.12.108",query:K,stack:{},apply:N,getJSONObject:M,whenReady:D,noConflict:F}),n.DomHelper={on:w,un:x,requiresJSON:function(c){t(a,"JSON")||b.write('<script type="text/javascript" src="'+c+'"><'+"/script>")}},function(){var a={};n.Fn={set:function(b,c){a[b]=c},get:function(b,c){var d=a[b];return c&&delete a[b],d}}}(),n.Socket=function(a){var b=S(R(a).concat([{incoming:function(b,c){a.onMessage(b,c)},callback:function(b){a.onReady&&a.onReady(b)}}])),c=H(a.remote);this.origin=H(a.remote),this.destroy=function(){b.destroy()},this.postMessage=function(a){b.outgoing(a,c)},b.init()},n.Rpc=function(a,b){if(b.local)for(var c in b.local)if(b.local.hasOwnProperty(c)){var d=b.local[c];typeof d=="function"&&(b.local[c]={method:d})}var e=S(R(a).concat([new n.stack.RpcBehavior(this,b),{callback:function(b){a.onReady&&a.onReady(b)}}]));this.origin=H(a.remote),this.destroy=function(){e.destroy()},e.init()},n.stack.SameOriginTransport=function(a){var b,e,f,g;return b={outgoing:function(a,b,c){f(a),c&&c()},destroy:function(){e&&(e.parentNode.removeChild(e),e=null)},onDOMReady:function(){g=H(a.remote),a.isHost?(N(a.props,{src:J(a.remote,{xdm_e:c.protocol+"//"+c.host+c.pathname,xdm_c:a.channel,xdm_p:4}),name:p+a.channel+"_provider"}),e=P(a),n.Fn.set(a.channel,function(a){return f=a,d(function(){b.up.callback(!0)},0),function(a){b.up.incoming(a,g)}})):(f=E().Fn.get(a.channel,!0)(function(a){b.up.incoming(a,g)}),d(function(){b.up.callback(!0)},0))},init:function(){D(b.onDOMReady,b)}}},n.stack.FlashTransport=function(a){function l(a){d(function(){e.up.incoming(a,h)},0)}function o(d){var e=a.swf,f="easyXDM_swf_"+Math.floor(Math.random()*1e4),g=k+'easyXDM.Fn.get("flash_'+f+'_init")';n.Fn.set("flash_"+f+"_init",function(){n.stack.FlashTransport.__swf=i=j.firstChild,d()}),j=b.createElement("div"),N(j.style,{height:"1px",width:"1px",postition:"abosolute",left:0,top:0}),b.body.appendChild(j);var h="proto="+c.protocol+"&domain="+G(c.href)+"&init="+g;j.innerHTML="<object height='1' width='1' type='application/x-shockwave-flash' id='"+f+"' data='"+e+"'>"+"<param name='allowScriptAccess' value='always'></param>"+"<param name='wmode' value='transparent'>"+"<param name='movie' value='"+e+"'></param>"+"<param name='flashvars' value='"+h+"'></param>"+"<embed type='application/x-shockwave-flash' FlashVars='"+h+"' allowScriptAccess='always' wmode='transparent' src='"+e+"' height='1' width='1'></embed>"+"</object>"}var e,f,g,h,i,j,k=m?m+".":"";return e={outgoing:function(b,c,d){i.postMessage(a.channel,b),d&&d()},destroy:function(){try{i.destroyChannel(a.channel)}catch(b){}i=null,f&&(f.parentNode.removeChild(f),f=null)},onDOMReady:function(){h=H(a.remote),i=n.stack.FlashTransport.__swf;var b=function(){a.isHost?n.Fn.set("flash_"+a.channel+"_onMessage",function(b){b==a.channel+"-ready"&&(n.Fn.set("flash_"+a.channel+"_onMessage",l),d(function(){e.up.callback(!0)},0))}):n.Fn.set("flash_"+a.channel+"_onMessage",l),i.createChannel(a.channel,a.remote,a.isHost,k+'easyXDM.Fn.get("flash_'+a.channel+'_onMessage")',a.secret),a.isHost?(N(a.props,{src:J(a.remote,{xdm_e:H(c.href),xdm_c:a.channel,xdm_s:a.secret,xdm_p:6}),name:p+a.channel+"_provider"}),f=P(a)):(i.postMessage(a.channel,a.channel+"-ready"),d(function(){e.up.callback(!0)},0))};i?b():o(b)},init:function(){D(e.onDOMReady,e)}}},n.stack.PostMessageTransport=function(b){function i(a){if(a.origin)return H(a.origin);if(a.uri)return H(a.uri);if(a.domain)return c.protocol+"//"+a.domain;throw"Unable to retrieve the origin of the event"}function j(a){var c=i(a);c==h&&a.data.substring(0,b.channel.length+1)==b.channel+" "&&e.up.incoming(a.data.substring(b.channel.length+1),c)}var e,f,g,h;return e={outgoing:function(a,c,d){g.postMessage(b.channel+" "+a,c||h),d&&d()},destroy:function(){x(a,"message",j),f&&(g=null,f.parentNode.removeChild(f),f=null)},onDOMReady:function(){h=H(b.remote),b.isHost?(w(a,"message",function i(c){c.data==b.channel+"-ready"&&(g="postMessage"in f.contentWindow?f.contentWindow:f.contentWindow.document,x(a,"message",i),w(a,"message",j),d(function(){e.up.callback(!0)},0))}),N(b.props,{src:J(b.remote,{xdm_e:H(c.href),xdm_c:b.channel,xdm_p:1}),name:p+b.channel+"_provider"}),f=P(b)):(w(a,"message",j),g="postMessage"in a.parent?a.parent:a.parent.document,g.postMessage(b.channel+"-ready",h),d(function(){e.up.callback(!0)},0))},init:function(){D(e.onDOMReady,e)}}},n.stack.FrameElementTransport=function(e){var f,g,h,i;return f={outgoing:function(a,b,c){h.call(this,a),c&&c()},destroy:function(){g&&(g.parentNode.removeChild(g),g=null)},onDOMReady:function(){i=H(e.remote),e.isHost?(N(e.props,{src:J(e.remote,{xdm_e:H(c.href),xdm_c:e.channel,xdm_p:5}),name:p+e.channel+"_provider"}),g=P(e),g.fn=function(a){return delete g.fn,h=a,d(function(){f.up.callback(!0)},0),function(a){f.up.incoming(a,i)}}):(b.referrer&&H(b.referrer)!=K.xdm_e&&(a.top.location=K.xdm_e),h=a.frameElement.fn(function(a){f.up.incoming(a,i)}),f.up.callback(!0))},init:function(){D(f.onDOMReady,f)}}},n.stack.NixTransport=function(e){var f,h,i,j,k;return f={outgoing:function(a,b,c){i(a),c&&c()},destroy:function(){k=null,h&&(h.parentNode.removeChild(h),h=null)},onDOMReady:function(){j=H(e.remote);if(e.isHost){try{s(a,"getNixProxy")||a.execScript("Class NixProxy\n    Private m_parent, m_child, m_Auth\n\n    Public Sub SetParent(obj, auth)\n        If isEmpty(m_Auth) Then m_Auth = auth\n        SET m_parent = obj\n    End Sub\n    Public Sub SetChild(obj)\n        SET m_child = obj\n        m_parent.ready()\n    End Sub\n\n    Public Sub SendToParent(data, auth)\n        If m_Auth = auth Then m_parent.send(CStr(data))\n    End Sub\n    Public Sub SendToChild(data, auth)\n        If m_Auth = auth Then m_child.send(CStr(data))\n    End Sub\nEnd Class\nFunction getNixProxy()\n    Set GetNixProxy = New NixProxy\nEnd Function\n","vbscript"),k=getNixProxy(),k.SetParent({send:function(a){f.up.incoming(a,j)},ready:function(){d(function(){f.up.callback(!0)},0)}},e.secret),i=function(a){k.SendToChild(a,e.secret)}}catch(l){throw new Error("Could not set up VBScript NixProxy:"+l.message)}N(e.props,{src:J(e.remote,{xdm_e:H(c.href),xdm_c:e.channel,xdm_s:e.secret,xdm_p:3}),name:p+e.channel+"_provider"}),h=P(e),h.contentWindow.opener=k}else{b.referrer&&H(b.referrer)!=K.xdm_e&&(a.top.location=K.xdm_e);try{k=a.opener}catch(m){throw new Error("Cannot access window.opener")}k.SetChild({send:function(a){g.setTimeout(function(){f.up.incoming(a,j)},0)}}),i=function(a){k.SendToParent(a,e.secret)},d(function(){f.up.callback(!0)},0)}},init:function(){D(f.onDOMReady,f)}}},n.stack.NameTransport=function(a){function k(b){var d=a.remoteHelper+(c?"#_3":"#_2")+a.channel;e.contentWindow.sendMessage(b,d)}function l(){c?(++g===2||!c)&&b.up.callback(!0):(k("ready"),b.up.callback(!0))}function m(a){b.up.incoming(a,i)}function o(){h&&d(function(){h(!0)},0)}var b,c,e,f,g,h,i,j;return b={outgoing:function(a,b,c){h=c,k(a)},destroy:function(){e.parentNode.removeChild(e),e=null,c&&(f.parentNode.removeChild(f),f=null)},onDOMReady:function(){c=a.isHost,g=0,i=H(a.remote),a.local=I(a.local),c?(n.Fn.set(a.channel,function(b){c&&b==="ready"&&(n.Fn.set(a.channel,m),l())}),j=J(a.remote,{xdm_e:a.local,xdm_c:a.channel,xdm_p:2}),N(a.props,{src:j+"#"+a.channel,name:p+a.channel+"_provider"}),f=P(a)):(a.remoteHelper=a.remote,n.Fn.set(a.channel,m)),e=P({props:{src:a.local+"#_4"+a.channel},onLoad:function b(){var c=e||this;x(c,"load",b),n.Fn.set(a.channel+"_load",o),function f(){typeof c.contentWindow.sendMessage=="function"?l():d(f,50)}()}})},init:function(){D(b.onDOMReady,b)}}},n.stack.HashTransport=function(b){function o(a){if(!l)return;var c=b.remote+"#"+j++ +"_"+a;(f||!m?l.contentWindow:l).location=c}function q(a){i=a,c.up.incoming(i.substring(i.indexOf("_")+1),n)}function r(){if(!k)return;var a=k.location.href,b="",c=a.indexOf("#");c!=-1&&(b=a.substring(c)),b&&b!=i&&q(b)}function s(){g=setInterval(r,h)}var c,e=this,f,g,h,i,j,k,l,m,n;return c={outgoing:function(a,b){o(a)},destroy:function(){a.clearInterval(g),(f||!m)&&l.parentNode.removeChild(l),l=null},onDOMReady:function(){f=b.isHost,h=b.interval,i="#"+b.channel,j=0,m=b.useParent,n=H(b.remote);if(f){b.props={src:b.remote,name:p+b.channel+"_provider"};if(m)b.onLoad=function(){k=a,s(),c.up.callback(!0)};else{var e=0,g=b.delay/50;(function o(){if(++e>g)throw new Error("Unable to reference listenerwindow");try{k=l.contentWindow.frames[p+b.channel+"_consumer"]}catch(a){}k?(s(),c.up.callback(!0)):d(o,50)})()}l=P(b)}else k=a,s(),m?(l=parent,c.up.callback(!0)):(N(b,{props:{src:b.remote+"#"+b.channel+new Date,name:p+b.channel+"_consumer"},onLoad:function(){c.up.callback(!0)}}),l=P(b))},init:function(){D(c.onDOMReady,c)}}},n.stack.ReliableBehavior=function(a){var b,c,d=0,e=0,f="";return b={incoming:function(a,g){var h=a.indexOf("_"),i=a.substring(0,h).split(",");a=a.substring(h+1),i[0]==d&&(f="",c&&c(!0)),a.length>0&&(b.down.outgoing(i[1]+","+d+"_"+f,g),e!=i[1]&&(e=i[1],b.up.incoming(a,g)))},outgoing:function(a,g,h){f=a,c=h,b.down.outgoing(e+","+ ++d+"_"+a,g)}}},n.stack.QueueBehavior=function(a){function m(){if(a.remove&&c.length===0){T(b);return}if(g||c.length===0||i)return;g=!0;var e=c.shift();b.down.outgoing(e.data,e.origin,function(a){g=!1,e.callback&&d(function(){e.callback(a)},0),m()})}var b,c=[],g=!0,h="",i,j=0,k=!1,l=!1;return b={init:function(){L(a)&&(a={}),a.maxLength&&(j=a.maxLength,l=!0),a.lazy?k=!0:b.down.init()},callback:function(a){g=!1;var c=b.up;m(),c.callback(a)},incoming:function(c,d){if(l){var f=c.indexOf("_"),g=parseInt(c.substring(0,f),10);h+=c.substring(f+1),g===0&&(a.encode&&(h=e(h)),b.up.incoming(h,d),h="")}else b.up.incoming(c,d)},outgoing:function(d,e,g){a.encode&&(d=f(d));var h=[],i;if(l){while(d.length!==0)i=d.substring(0,j),d=d.substring(i.length),h.push(i);while(i=h.shift())c.push({data:h.length+"_"+i,origin:e,callback:h.length===0?g:null})}else c.push({data:d,origin:e,callback:g});k?b.down.init():m()},destroy:function(){i=!0,b.down.destroy()}}},n.stack.VerifyBehavior=function(a){function f(){c=Math.random().toString(16).substring(2),b.down.outgoing(c)}var b,c,d,e=!1;return b={incoming:function(e,g){var h=e.indexOf("_");h===-1?e===c?b.up.callback(!0):d||(d=e,a.initiate||f(),b.down.outgoing(e)):e.substring(0,h)===d&&b.up.incoming(e.substring(h+1),g)},outgoing:function(a,d,e){b.down.outgoing(c+"_"+a,d,e)},callback:function(b){a.initiate&&f()}}},n.stack.RpcBehavior=function(a,b){function g(a){a.jsonrpc="2.0",c.down.outgoing(d.stringify(a))}function h(a,b){var c=Array.prototype.slice;return function(){var d=arguments.length,h,i={method:b};d>0&&typeof arguments[d-1]=="function"?(d>1&&typeof arguments[d-2]=="function"?(h={success:arguments[d-2],error:arguments[d-1]},i.params=c.call(arguments,0,d-2)):(h={success:arguments[d-1]},i.params=c.call(arguments,0,d-1)),f[""+ ++e]=h,i.id=e):i.params=c.call(arguments,0),a.namedParams&&i.params.length===1&&(i.params=i.params[0]),g(i)}}function j(a,b,c,d){if(!c){b&&g({id:b,error:{code:-32601,message:"Procedure not found."}});return}var e,f;b?(e=function(a){e=i,g({id:b,result:a})},f=function(a,c){f=i;var d={id:b,error:{code:-32099,message:a}};c&&(d.error.data=c),g(d)}):e=f=i,u(d)||(d=[d]);try{var h=c.method.apply(c.scope,d.concat([e,f]));L(h)||e(h)}catch(j){f(j.message)}}var c,d=b.serializer||M(),e=0,f={};return c={incoming:function(a,c){var e=d.parse(a);if(e.method)b.handle?b.handle(e,g):j(e.method,e.id,b.local[e.method],e.params);else{var h=f[e.id];e.error?h.error&&h.error(e.error):h.success&&h.success(e.result),delete f[e.id]}},init:function(){if(b.remote)for(var d in b.remote)b.remote.hasOwnProperty(d)&&(a[d]=h(b.remote[d],d));c.down.init()},destroy:function(){for(var d in b.remote)b.remote.hasOwnProperty(d)&&a.hasOwnProperty(d)&&delete a[d];c.down.destroy()}}},g.easyXDM=n})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent)
});
define("app/utils/easy_xdm",["module","require","exports","$lib/easyXDM.js"],function(module, require, exports) {
require("$lib/easyXDM.js"),module.exports=window.easyXDM.noConflict()
});
define("app/utils/sandboxed_ajax",["module","require","exports","core/utils","app/utils/easy_xdm"],function(module, require, exports) {
function remoteUrl(a,b){var c=a.split("/").slice(-1);return/localhost/.test(window.location.hostname)?"http://localhost.twitter.com:"+(window.cdnGoosePort||"1867")+"/"+c:b?a:a.replace("https:","http:")}function generateSocket(a){return new easyXDM.Socket({remote:a,onMessage:function(a,b){var c=JSON.parse(a),d=requests[c.id];d&&d.callbacks[c.callbackName]&&d.callbacks[c.callbackName].apply(null,c.callbackArgs),c.callbackName==="complete"&&delete requests[c.id]}})}function generateSandboxRequest(a){var b=++nextRequestId;a=utils.merge({},a);var c={id:b,callbacks:{success:a.success,error:a.error,before:a.before,complete:a.complete},request:{id:b,data:a}};return delete a.success,delete a.error,delete a.complete,delete a.before,requests[b]=c,c.request}var utils=require("core/utils"),easyXDM=require("app/utils/easy_xdm"),TIMEOUT=5e3,nextRequestId=0,requests={},sockets=[null,null],sandbox={send:function(a,b){var c=!!/^https:|^\/\//.test(b.url)||!!$.browser.msie,d=c?0:1;sockets[d]||(sockets[d]=generateSocket(remoteUrl(a,c)));var e=generateSandboxRequest(b);sockets[d].postMessage(JSON.stringify(e))},easyXDM:easyXDM};module.exports=sandbox
});
define("test/app/utils/sandboxed_ajax_spec",["module","require","exports","app/utils/sandboxed_ajax"],function(module, require, exports) {
var sandboxedAjax=require("app/utils/sandboxed_ajax");module.exports={},describe("sandboxedAjax",function(){it("sets up the sandbox correctly",function(){var a,b,c=0,d=window.$.browser.msie?1:2;spyOn(sandboxedAjax.easyXDM,"Socket").andCallFake(function(d){return c++,a=d,{postMessage:function(a){b=JSON.parse(a)}}}),sandboxedAjax.send("http://example.com/sandbox.html",{url:"http://milesdavis.com",arbitraryKey:"birth of the cool"},"https:"),expect(a.remote).toMatch("sandbox.html"),expect(b.data.url).toBe("http://milesdavis.com"),expect(b.data.arbitraryKey).toBe("birth of the cool"),expect(c).toBe(1),sandboxedAjax.send("https://example.com/sandbox.html",{url:"https://milesdavis.com",arbitraryKey:"birth of the cool"},"https:"),expect(c).toBe(d),sandboxedAjax.send("https://example.com/sandbox.html",{url:"https://milesdavis.com",arbitraryKey:"birth of the cool"},"https:"),expect(c).toBe(d)})})
});
define("test/app/utils/event_proxy_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/utils/event_proxy",function(){var a="source",b="target",c={actor:"Brent Spiner"};beforeEach(function(){setupComponent({sourceEvent:a,targetEvent:b})}),it("should proxy event data from the source to the target",function(){spyOnEvent(document,b),$(document).trigger(a,c),expect(b).toHaveBeenTriggeredOnAndWith(this.component,c)}),it("should not proxy other events",function(){spyOnEvent(document,b),$(document).trigger("someOtherEvent",c),expect(b).not.toHaveBeenTriggeredOn(this.component)})})
});
define("test/app/utils/drag_drop_helper_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/utils/drag_drop_helper",function(){describe("hasFiles",function(){it("is falsy when the event does not contain dataTransfer",function(){var a={};expect(this.Module.hasFiles(a)).toBeFalsy()}),it("is falsy when the event contains dataTransfer with a non-matching types array",function(){var a={dataTransfer:{types:["Foo","bar"]}};expect(this.Module.hasFiles(a)).toBeFalsy()}),it("is true when the event contains Files in a types array",function(){var a={dataTransfer:{types:["Files","foo","bar"]}};expect(this.Module.hasFiles(a)).toBe(!0)}),it("is true when the original event contains Files in a types array",function(){var a={originalEvent:{dataTransfer:{types:["Files","foo","bar"]}}};expect(this.Module.hasFiles(a)).toBe(!0)}),it("is true when the event contains Files in a simulated DOMStringList",function(){var a={dataTransfer:{types:{contains:function(a){return a=="Files"}}}};expect(this.Module.hasFiles(a)).toBe(!0)}),it("is falsy when the event does not contain Files in a simulated DOMStringList",function(){var a={dataTransfer:{types:{contains:function(){return!1}}}};expect(this.Module.hasFiles(a)).toBeFalsy()})}),describe("onlyHandleEventsWithFiles",function(){var a,b,c,d;beforeEach(function(){a={that:!0},b={data:!0},c={event:!0},d=jasmine.createSpy().andCallFake(function(){return expect(this).toBe(a),"return from callback"})}),it("calls event handler with proper arguments when event has files",function(){spyOn(this.Module,"hasFiles").andReturn(!0);var e=this.Module.onlyHandleEventsWithFiles(d).call(a,c,b);expect(d).toHaveBeenCalledWith(c,b),expect(e).toBe("return from callback")}),it("does not call event handler when event does not have files",function(){spyOn(this.Module,"hasFiles").andReturn(!1);var e=this.Module.onlyHandleEventsWithFiles(d).call(a,c,b);expect(d).not.toHaveBeenCalled(),expect(e).toBeUndefined()})})})
});
define("test/app/utils/auth_token_spec",["module","require","exports","app/utils/auth_token"],function(module, require, exports) {
var authToken=require("app/utils/auth_token");module.exports={},describe("auth token",function(){it("throws an error when accessing an auth token if not set",function(){authToken.set(),expect(function(){authToken.get()}).toThrow()}),it("saves an auth token",function(){authToken.set("abc123"),expect(authToken.get()).toBe("abc123")})})
});
define("test/app/utils/with_keyboard_modality_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/utils/with_keyboard_modality",function(){var a='<div>\n      <button id="button-1" type="button">Button 1</button>\n      <button id="button-2" type="button">Button 2</button>\n      <button id="button-3" type="button">Button 3</button>\n      <button id="button-4" type="button">Button 4</button>\n    </div>\n  ';beforeEach(function(){setupComponent(a)}),describe("When createFirstLastTabStop is called",function(){beforeEach(function(){this.component.createFirstLastTabStop(this.component.$node)}),it("adds a tab stop before the content",function(){expect(this.component.select("firstTabStopSelector")).toExist()}),it("adds a tab stop after the content",function(){expect(this.component.select("lastTabStopSelector")).toExist()})}),describe("When removeFirstLastTabStop is called",function(){beforeEach(function(){this.component.createFirstLastTabStop(this.component.$node),this.component.removeFirstLastTabStop(this.component.$node)}),it("removes the tab stop before the content",function(){expect(this.component.select("firstTabStopSelector")).not.toExist()}),it("removes the tab stop after the content",function(){expect(this.component.select("lastTabStopSelector")).not.toExist()})}),describe("When focusNextAvailableControl is called",function(){beforeEach(function(){this.component.createFirstLastTabStop(this.component.$node)}),describe("and is specified to start with the first focusable element",function(){it("focuses the first focusable descendant",function(){this.component.focusNextAvailableControl("first",this.component.$node),expect($("#button-1")).toBeFocused()}),describe("and the first element is disabled",function(){it("focuses the next enabled control",function(){$("#button-1").attr("disabled",!0),this.component.focusNextAvailableControl("first",this.component.$node),expect($("#button-2")).toBeFocused()})}),describe('and the first element is disabled using the "aria-disabled" attribute',function(){it("focuses the next enabled control",function(){$("#button-1").attr("aria-disabled",!0),this.component.focusNextAvailableControl("first",this.component.$node),expect($("#button-2")).toBeFocused()})}),describe('and the first element is hidden via setting the CSS display property to "none"',function(){it("focuses the next enabled control",function(){$("#button-1").css("display","none"),this.component.focusNextAvailableControl("first",this.component.$node),expect($("#button-2")).toBeFocused()})}),describe('and the first element is hidden via setting the CSS visibility property to "hidden"',function(){it("focuses the next enabled control",function(){$("#button-1").css("visibility","hidden"),this.component.focusNextAvailableControl("first",this.component.$node),expect($("#button-2")).toBeFocused()})}),describe("and the first element is not fully opaque",function(){it("focuses the next enabled control",function(){$("#button-1").css("opacity",".1"),this.component.focusNextAvailableControl("first",this.component.$node),expect($("#button-2")).toBeFocused()})})}),describe("and is specified to start with the last focusable element",function(){it("focuses the last focusable descendant",function(){this.component.focusNextAvailableControl("last",this.component.$node),expect($("#button-4")).toBeFocused()})})})})
});
define("test/app/utils/hide_or_show_divider_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/utils/hide_or_show_divider",function(){var a,b,c,d,e,f;beforeEach(function(){var g='<ul>\n        <li class="left">Left</li>\n        <li class="divider">&middot;</li>\n        <li class="right">Right</li>\n      </ul>\n    ';a=$(g),f=".divider",d=".left",e=".right",b=a.find(".left"),c=a.find(".right"),attachFixtureToDom(a)}),describe("divider",function(){it("is visible when right and left are present",function(){b.text("San Francisco, CA"),c.text("http://example.com"),this.Module(a,f,d,e),expect(a.find(".divider")).toBeVisible()}),describe("is not visible when",function(){it("right and left are not present",function(){b.text(""),c.text(""),this.Module(a,f,d,e),expect(a.find(".divider")).not.toBeVisible()}),it("only right is present",function(){b.text(""),c.text("http://example.com"),this.Module(a,f,d,e),expect(a.find(".divider")).not.toBeVisible()}),it("only left is present",function(){b.text("San Francisco, CA"),c.text("    "),this.Module(a,f,d,e),expect(a.find(".divider")).not.toBeVisible()})})})})
});
define("test/app/utils/string_spec",["module","require","exports","app/utils/string"],function(module, require, exports) {
var string=require("app/utils/string");module.exports={},describe("string",function(){describe("#isWhitespaceChar",function(){xit("",function(){expect("").toBe("")})}),describe("#isDigitChar",function(){xit("",function(){expect("").toBe("")})}),describe("#compareRight",function(){xit("",function(){expect("").toBe("")})}),describe("#compare",function(){var a=string.compare;it("works on simple things",function(){expect(a("1","2")).toBe(-1),expect(a("1","1")).toBe(0),expect(a("2","1")).toBe(1),expect(a("10","100")).toBe(-1),expect(a("10","10")).toBe(0),expect(a("100","10")).toBe(1)}),it("compares ints that would fail a string comparison",function(){expect(a("100","12")).toBe(1)}),it("compares ints that would fail an int comparison",function(){expect(a("314531938260094976","314531938260094977")).not.toBe(0)}),it("compares strings with leading zeroes",function(){expect(a("01","2")).toBe(-1),expect(a("1","02")).toBe(-1),expect(a("01","1")).toBe(0)}),it("compares zeroes",function(){expect(a("0","2")).toBe(-1),expect(a("1","0")).toBe(1)}),it("compares mixed strings and ints",function(){expect(a("1",2)).toBe(-1)})}),describe("#parseBigInt",function(){it("recognises short ints",function(){expect(string.parseBigInt(12)).toBe("12")}),it("recognises big ints",function(){expect(string.parseBigInt("123456789123456789")).toBe("123456789123456789")}),it("returns NaN for non-ints",function(){expect(isNaN(string.parseBigInt("abc"))).toBe(!0)})}),describe("#subtractOne",function(){it("works for edge cases",function(){expect(string.subtractOne("1")).toBe("0"),expect(string.subtractOne("2")).toBe("1"),expect(string.subtractOne("9")).toBe("8"),expect(string.subtractOne("10")).toBe("9"),expect(string.subtractOne("100")).toBe("99"),expect(string.subtractOne("101")).toBe("100")}),it("works for big ints",function(){expect(string.subtractOne("123456789123456789")).toBe("123456789123456788"),expect(string.subtractOne("123456789123456000")).toBe("123456789123455999")})})})
});
define("test/app/utils/setup_polling_with_backoff_spec",["module","require","exports","app/utils/setup_polling_with_backoff"],function(module, require, exports) {
var setupPollingWithBackoff=require("app/utils/setup_polling_with_backoff");module.exports={},describe("setupPollingWithBackoff",function(){var a,b,c;beforeEach(function(){jasmine.Clock.useMock(),c=$("<div>"),a=jasmine.createSpy(),$(document).on("uiWantsUnitTest",a)}),afterEach(function(){b.clear()}),it("sets-up polling with specified backoff",function(){b=setupPollingWithBackoff("uiWantsUnitTest",c,{focusedInterval:2e3,blurredInterval:8e3,backoffFactor:2}),expect(a.callCount).toBe(0),jasmine.Clock.tick(1e3),expect(a.callCount).toBe(0),jasmine.Clock.tick(1e3),expect(a.callCount).toBe(1),jasmine.Clock.tick(2e3),expect(a.callCount).toBe(2),jasmine.Clock.tick(2e3),expect(a.callCount).toBe(3),c.blur(),jasmine.Clock.tick(2e3),expect(a.callCount).toBe(4),jasmine.Clock.tick(2e3),expect(a.callCount).toBe(4),jasmine.Clock.tick(2e3),expect(a.callCount).toBe(5),jasmine.Clock.tick(4e3),expect(a.callCount).toBe(5),jasmine.Clock.tick(4e3),expect(a.callCount).toBe(6),jasmine.Clock.tick(32e3),expect(a.callCount).toBe(10),c.focus(),jasmine.Clock.tick(2e3),expect(a.callCount).toBe(11),jasmine.Clock.tick(2e3),expect(a.callCount).toBe(12)}),it("sets-up polling with an unspecified backoff",function(){b=setupPollingWithBackoff("uiWantsUnitTest",c),expect(a.callCount).toBe(0),jasmine.Clock.tick(2e4),expect(a.callCount).toBe(0),jasmine.Clock.tick(3e4),expect(a.callCount).toBe(1),jasmine.Clock.tick(3e4),expect(a.callCount).toBe(2),jasmine.Clock.tick(3e4),expect(a.callCount).toBe(3),c.blur(),jasmine.Clock.tick(3e4),expect(a.callCount).toBe(4),jasmine.Clock.tick(6e4),expect(a.callCount).toBe(5),jasmine.Clock.tick(45e4),expect(a.callCount).toBe(10),c.focus(),jasmine.Clock.tick(3e4),expect(a.callCount).toBe(11)})})
});
provide("test/app/utils/params_spec",function(a){using("app/utils/params",function(b){function c(a,b){var c=(a?"?"+a:"")+(b?"#"+b:"");return"/swift/test/app/empty.html"+c}function n(){var a="";try{a=d.contentWindow.location;var b=a.toString()}catch(c){a=""}return a}if(document.domain=="twitter.com")return a();var d,e=c(),f=c("foo=bar"),g=c("foo=bar&baz=qux"),h=c("","foo=bar"),i=c("","foo=bar&baz=qux"),j=c("a=b","foo=bar"),k=c("a=b&c=d","foo=bar&baz=qux"),l=c("foo=bar","foo=bar"),m=c("foo=bar&baz=qux","foo=bar&baz=qux");beforeEach(function(){d=document.createElement("iframe"),document.body.appendChild(d)}),afterEach(function(){d&&d.parentNode.removeChild(d)}),describe("params",function(){describe("#fromQuery",function(){it("returns empty object {} from a location without query",function(){runs(function(){d.src=e}),waitsFor(function(){return n()&&n().toString().indexOf(e)>-1},"location to be set",1e3),runs(function(){expect(b.fromQuery(n())).toEqual({})})}),it("returns 1 param from a location with 1 query param",function(){runs(function(){d.src=f}),waitsFor(function(){return n()&&n().toString().indexOf(f)>-1},"location to be set",1e3),runs(function(){expect(b.fromQuery(n())).toEqual({foo:"bar"})})}),it("returns 2 params from a location with 2 query params",function(){runs(function(){d.src=g}),waitsFor(function(){return n()&&n().toString().indexOf(g)>-1},"location to be set",1e3),runs(function(){expect(b.fromQuery(n())).toEqual({foo:"bar",baz:"qux"})})}),it("returns empty object {} from a locations with fragment params only",function(){runs(function(){d.src=h}),waitsFor(function(){return n()&&n().toString().indexOf(h)>-1},"location to be set",1e3),runs(function(){expect(b.fromQuery(n())).toEqual({})}),runs(function(){d.src=i}),waitsFor(function(){return n()&&n().toString().indexOf(i)>-1},"location to be set",1e3),runs(function(){expect(b.fromQuery(n())).toEqual({})})})}),describe("#fromFragment",function(){it("returns empty object {} from a location without fragment",function(){runs(function(){d.src=e}),waitsFor(function(){return n()&&n().toString().indexOf(e)>-1},"location to be set",1e3),runs(function(){expect(b.fromFragment(n())).toEqual({})})}),it("returns 1 param from a location with 1 fragment param",function(){runs(function(){d.src=h}),waitsFor(function(){return n()&&n().toString().indexOf(h)>-1},"location to be set",1e3),runs(function(){expect(b.fromFragment(n())).toEqual({foo:"bar"})})}),it("returns 2 params from a location with 2 fragment params",function(){runs(function(){d.src=i}),waitsFor(function(){return n()&&n().toString().indexOf(i)>-1},"location to be set",1e3),runs(function(){expect(b.fromFragment(n())).toEqual({foo:"bar",baz:"qux"})})}),it("returns empty object {} from a locations with query params only",function(){runs(function(){d.src=f}),waitsFor(function(){return n()&&n().toString().indexOf(f)>-1},"location to be set",1e3),runs(function(){expect(b.fromFragment(n())).toEqual({})}),runs(function(){d.src=g}),waitsFor(function(){return n()&&n().toString().indexOf(g)>-1},"location to be set",1e3),runs(function(){expect(b.fromFragment(n())).toEqual({})})})}),describe("#combined",function(){it("returns empty object {} from a location without query/fragment",function(){runs(function(){d.src=e}),waitsFor(function(){return n()&&n().toString().indexOf(e)>-1},"location to be set",1e3),runs(function(){expect(b.combined(n())).toEqual({})})}),it("returns 1 param from a locations with 1 param",function(){runs(function(){d.src=f}),waitsFor(function(){return n()&&n().toString().indexOf(f)>-1},"location to be set",1e3),runs(function(){expect(b.combined(n())).toEqual({foo:"bar"})}),runs(function(){d.src=h}),waitsFor(function(){return n()&&n().toString().indexOf(h)>-1},"location to be set",1e3),runs(function(){expect(b.combined(n())).toEqual({foo:"bar"})})}),it("returns 2 params from a locations with 2 params",function(){runs(function(){d.src=g}),waitsFor(function(){return n()&&n().toString().indexOf(g)>-1},"location to be set",1e3),runs(function(){expect(b.combined(n())).toEqual({foo:"bar",baz:"qux"})}),runs(function(){d.src=i}),waitsFor(function(){return n()&&n().toString().indexOf(i)>-1},"location to be set",1e3),runs(function(){expect(b.combined(n())).toEqual({foo:"bar",baz:"qux"})})}),it("returns 1 query and 1 fragment params from a location with 1 query and 1 fragment params",function(){runs(function(){d.src=j}),waitsFor(function(){return n()&&n().toString().indexOf(j)>-1},"location to be set",1e3),runs(function(){expect(b.combined(n())).toEqual({a:"b",foo:"bar"})})}),it("returns 2 query and 2 fragment params from a location with 2 query and 2 fragment params",function(){runs(function(){d.src=k}),waitsFor(function(){return n()&&n().toString().indexOf(k)>-1},"location to be set",1e3),runs(function(){expect(b.combined(n())).toEqual({a:"b",c:"d",foo:"bar",baz:"qux"})})}),it("returns 1 param from a location with 1 repeated query and fragment params",function(){runs(function(){d.src=l}),waitsFor(function(){return n()&&n().toString().indexOf(l)>-1},"location to be set",1e3),runs(function(){expect(b.combined(n())).toEqual({foo:"bar"})})}),it("returns 2 params from a location with 2 repeated query and fragment params",function(){runs(function(){d.src=m}),waitsFor(function(){return n()&&n().toString().indexOf(m)>-1},"location to be set",1e3),runs(function(){expect(b.combined(n())).toEqual({foo:"bar",baz:"qux"})})})})}),a()})})
provide("test/app/utils/querystring_spec",function(a){using("app/utils/querystring",function(b){describe("querystring",function(){var a={";":"%3B",":":"%3A","@":"%40","&":"%26","=":"%3D","+":"%2B",$:"%24",",":"%2C","/":"%2F","?":"%3F","#":"%23","[":"%5B","]":"%5D"};describe("#encodeQueryPart",function(){it("percent encodes reserved characters",function(){Object.keys(a).forEach(function(c){expect(b.encodePart(c)).toBe(a[c])})}),it("encodes spaces as %20",function(){expect(b.encodePart("string with spaces")).toBe("string%20with%20spaces")}),it("leaves non-encoded strings characters alone",function(){var a="no_reserved_characters";expect(b.encodePart(a)).toBe(a)})}),describe("#decodeQueryPart",function(){it("decodes percent encoded characters",function(){Object.keys(a).forEach(function(c){var d=a[c];expect(b.decodePart(d)).toBe(c)})}),it("decodes %20 back to spaces",function(){expect(b.decodePart("foo%20bar")).toBe("foo bar")}),it("decodes + back to spaces",function(){expect(b.decodePart("foo+bar")).toBe("foo bar")}),it("leaves non-encoded strings alone",function(){var a="no_reserved_characters";expect(b.decodePart(a)).toBe(a)})}),describe("#queryEncode",function(){it("encodes objects",function(){var a={p1:"v1",p2:"v2"};expect(b.encode(a)).toBe("p1=v1&p2=v2")}),it("uses the last instance of a key if it happens multiple times",function(){var a={p1:"v1",p2:"v2",p1:"v1a"};expect(b.encode(a)).toBe("p1=v1a&p2=v2")}),it("encodes special characters in keys",function(){expect(b.encode({"my key":"v1"})).toBe("my%20key=v1"),expect(b.encode({"args[]":"value"})).toBe("args%5B%5D=value")}),it("encodes special characters in values",function(){expect(b.encode({key:"my value"})).toBe("key=my%20value"),expect(b.encode({key:"value[]"})).toBe("key=value%5B%5D")})}),describe("#queryDecode",function(){it("decodes objects",function(){expect(b.decode("p1=v1&p2=v2")).toEqual({p1:"v1",p2:"v2"})}),it("uses the last instance of a key if it happens multiple times",function(){expect(b.decode("p1=v1&p2=v2&p1=v1a")).toEqual({p1:"v1",p2:"v2",p1:"v1a"})}),it("decodes special characters in keys",function(){expect(b.decode("my%20key=v1")).toEqual({"my key":"v1"}),expect(b.decode("args%5B%5D=value")).toEqual({"args[]":"value"})}),it("decodes special characters in values",function(){expect(b.decode("key=my%20value")).toEqual({key:"my value"}),expect(b.decode("key=value%5B%5D")).toEqual({key:"value[]"})})})}),a()})})
define("test/app/utils/image_spec",["module","require","exports","app/utils/image"],function(module, require, exports) {
var image=require("app/utils/image");module.exports={},describe("image utility functions",function(){describe("validate image files",function(){it("should only allow files that end in jpg/jpeg/png/gif",function(){var a=["photo.jpg","photo.jpeg","photo.png","photo.gif","photo.txt","photo"];expect(image.validateFileName(a[0])).toBeTruthy(),expect(image.validateFileName(a[1])).toBeTruthy(),expect(image.validateFileName(a[2])).toBeTruthy(),expect(image.validateFileName(a[3])).toBeTruthy(),expect(image.validateFileName(a[4])).toBeFalsy(),expect(image.validateFileName(a[5])).toBeFalsy()})}),describe("getFileName()",function(){it("should work for Windows file paths",function(){expect(image.getFileName("C:\\Users\\Public\\Pictures\\Sample Pictures\\larry-bird.jpg")).toEqual("larry-bird.jpg"),expect(image.getFileName("C:\\Users\\Public\\Pictures\\Sample Pictures\\larry-bird.JPEG")).toEqual("larry-bird.JPEG")}),it("should work for OSX and Unix file paths",function(){expect(image.getFileName("/home/user/Pictures/larry-bird.gif")).toEqual("larry-bird.gif"),expect(image.getFileName("/home/user/Pictures/larry-bird.PNG")).toEqual("larry-bird.PNG")}),it("should work without a file extension",function(){expect(image.getFileName("C:\\Users\\Public\\Pictures\\Sample Pictures\\larry-bird")).toEqual("larry-bird"),expect(image.getFileName("/home/user/Pictures/larry-bird")).toEqual("larry-bird")}),it("should work with multiple file extensions",function(){expect(image.getFileName("C:\\Users\\Public\\Pictures\\Sample Pictures\\larry-bird.png.gif")).toEqual("larry-bird.png.gif"),expect(image.getFileName("/home/user/Pictures/larry-bird.png.gif")).toEqual("larry-bird.png.gif")})}),describe("html5 mode",function(){beforeEach(function(){window._FileReader=window.FileReader,window.FileReader=function(){}}),afterEach(function(){window.FileReader=window._FileReader,window._FileReader=undefined}),it("should default to html5 mode when FileReader is available",function(){expect(image.hasFileReader()).toBeTruthy(),expect(image.mode()).toEqual("html5")})}),describe("flash mode",function(){beforeEach(function(){window._FileReader=window.FileReader,window.FileReader=undefined}),afterEach(function(){window.FileReader=window._FileReader,window._FileReader=undefined}),it("should use flash mode when FileReader is not available but flash is",function(){spyOn($.flash,"available").andReturn(!0),spyOn($.flash,"hasVersion").andReturn(!0),expect(image.hasFileReader()).toBeFalsy(),expect(image.hasFlash()).toBeTruthy(),expect(image.mode()).toEqual("flash")})}),describe("html4 mode",function(){beforeEach(function(){window._FileReader=window.FileReader,window.FileReader=undefined}),afterEach(function(){window.FileReader=window._FileReader,window._FileReader=undefined}),it("should use html4 mode when neither FileReader nor Flash is available",function(){spyOn($.flash,"available").andReturn(!1),spyOn($.flash,"hasVersion").andReturn(!1),expect(image.hasFileReader()).toBeFalsy(),expect(image.hasFlash()).toBeFalsy(),expect(image.mode()).toEqual("html4")})})})
});
define("test/app/utils/html_text_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/utils/html_text",function(){var a=function(a){return $.browser.msie?a.toLowerCase():a},b=[{description:"empty",text:"",html:"<div><br></div>",msieHtml:"<p></p>",mozillaHtml:"<br>",operaHtml:"<p><br></p>"},{description:"one space",text:" ",html:"<div>&nbsp;</div>",msieHtml:"<p>&nbsp;</p>",mozillaHtml:"&nbsp;<br>",operaHtml:"<p>&nbsp;</p>"},{description:"two spaces",text:"  ",html:"<div>&nbsp;&nbsp;</div>",msieHtml:"<p>&nbsp; </p>",mozillaHtml:"&nbsp; <br>",operaHtml:"<p>&nbsp;&nbsp;</p>"},{description:"three spaces",text:"   ",html:"<div>&nbsp; &nbsp;</div>",msieHtml:"<p>&nbsp;&nbsp; </p>",mozillaHtml:"&nbsp;&nbsp; <br>",operaHtml:"<p>&nbsp; &nbsp;</p>"},{description:"one line feed",text:"\n",html:"<div><br></div><div><br></div>",msieHtml:"<p></p><p></p>",mozillaHtml:"<br><br>",operaHtml:"<p><br></p><p><br></p>"},{description:"two line feeds",text:"\n\n",html:"<div><br></div><div><br></div><div><br></div>",msieHtml:"<p></p><p></p><p></p>",mozillaHtml:"<br><br><br>",operaHtml:"<p><br></p><p><br></p><p><br></p>"},{description:"one space and line feed",text:" \n",html:"<div>&nbsp;</div><div><br></div>",msieHtml:"<p>&nbsp;</p><p></p>",mozillaHtml:"&nbsp;<br><br>",operaHtml:"<p>&nbsp;</p><p><br></p>"},{description:"one line feed and space and line feed",text:"\n \n",html:"<div><br></div><div>&nbsp;</div><div><br></div>",msieHtml:"<p></p><p>&nbsp;</p><p></p>",mozillaHtml:"<br>&nbsp;<br><br>",operaHtml:"<p><br></p><p>&nbsp;</p><p><br></p>"},{description:"Text with link markup",text:"Hi @tw",textWithMarkup:'Hi <a href="#"><s>@</s>tw</a>',html:'<div>Hi <a href="#"><s>@</s>tw</a></div>',msieHtml:'<p>Hi <a href="#"><s>@</s>tw</a></p>',mozillaHtml:'Hi <a href="#"><s>@</s>tw</a><br>',operaHtml:'<p>Hi <a href="#"><s>@</s>tw</a></p>'},{description:"Text with link markup and return",text:"Hi @tw\n",textWithMarkup:'Hi <a href="#"><s>@</s>tw</a>\n',html:'<div>Hi <a href="#"><s>@</s>tw</a></div><div><br></div>',msieHtml:'<p>Hi <a href="#"><s>@</s>tw</a></p><p></p>',mozillaHtml:'Hi <a href="#"><s>@</s>tw</a><br><br>',operaHtml:'<p>Hi <a href="#"><s>@</s>tw</a></p><p><br></p>'},{description:"Text with link markup and two returns",text:"Hi \n@tw\n",textWithMarkup:'Hi \n<a href="#"><s>@</s>tw</a>\n',html:'<div>Hi&nbsp;</div><div><a href="#"><s>@</s>tw</a></div><div><br></div>',msieHtml:'<p>Hi </p><p><a href="#"><s>@</s>tw</a></p><p></p>',mozillaHtml:'Hi <br><a href="#"><s>@</s>tw</a><br><br>',operaHtml:'<p>Hi&nbsp;</p><p><a href="#"><s>@</s>tw</a></p><p><br></p>'},{description:"Text with leading space, two links and a trailing space",text:" Hi @tw #yo ",textWithMarkup:' Hi <a href="#"><s>@</s>tw</a> <a href="#"><s>#</s>yo</a> ',html:'<div>&nbsp;Hi <a href="#"><s>@</s>tw</a> <a href="#"><s>#</s>yo</a>&nbsp;</div>',msieHtml:'<p>&nbsp;Hi <a href="#"><s>@</s>tw</a>&nbsp;<a href="#"><s>#</s>yo</a>&nbsp;</p>',mozillaHtml:'&nbsp;Hi <a href="#"><s>@</s>tw</a>&nbsp;<a href="#"><s>#</s>yo</a>&nbsp;<br>',operaHtml:'<p>&nbsp;Hi <a href="#"><s>@</s>tw</a> <a href="#"><s>#</s>yo</a>&nbsp;</p>'}],c;beforeEach(function(){var a=$('<div contentEditable="true" style="width:100px;height:100px"/>');attachFixtureToDom(a),c=a[0],this.addMatchers({toEqualWithMessage:function(a,b){var c=this.actual,d=this.isNot?" not":"";return this.message=function(){return'Expected "'+c+'"'+d+' to be equal to "'+a+'" for '+b},c==a}})}),describe("in all browsers",function(){function d(a){b.forEach(function(b){["normal","msie","mozilla","opera"].forEach(function(c){var d=b[c+"Html"]||b.html,e=b.textWithMarkup||b.text,f={};f[c]=!0,a(f,b.text,e,d,b.description+" in "+c)})})}describe("htmlText.getHtml (and setHtml)",function(){d(function(b,d,e,f,g){it("returns the correct html for "+g,function(){var d=this.Module(c,b);d.setHtml(f),expect(a(d.getHtml())).toEqual(a(f))})})}),describe("htmlText.getText",function(){d(function(a,b,d,e,f){it("returns the correct text for "+f,function(){var d=this.Module(c,a);d.setHtml(e),expect(d.getText()).toEqual(b)})})}),describe("htmlText.setTextWithMarkup",function(){d(function(b,d,e,f,g){it("returns the correct html from markup for "+g,function(){var d=this.Module(c,b);d.setTextWithMarkup(e),expect(a(d.getHtml())).toEqual(a(f))})})})}),describe("in this browser",function(){var a;beforeEach(function(){a=this.Module(c,$.browser)}),describe("htmlText.getSelectionOffsets",function(){b.forEach(function(b){var c=b.text.length;if(!c)return;it("returns the correct offsets when cursoring through "+b.description,function(){a.setTextWithMarkup(b.textWithMarkup||b.text);for(var d=0;d<=c;d++)a.setSelectionOffsets([d]),expect(a.getSelectionOffsets()+"").toEqual([d]+"");for(var d=1;d<=c;d++)a.setSelectionOffsets([0,d]),expect(a.getSelectionOffsets()+"").toEqual([0,d]+"");for(var d=1;d<c;d++)a.setSelectionOffsets([d,c]),expect(a.getSelectionOffsets()+"").toEqual([d,c]+"")})})})})})
});
define("test/app/utils/image_resize_spec",["module","require","exports","app/utils/image_resize","app/utils/image"],function(module, require, exports) {
var imageResize=require("app/utils/image_resize"),image=require("app/utils/image");module.exports={},describe("image resize utility functions",function(){describe("resize()",function(){var a="/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCADoAU4DAREAAhEBAxEB/8QAHAAAAgIDAQEAAAAAAAAAAAAAAgMBBAAFBgcI/8QAThAAAgEDAwIEAwUFBQUEBwkBAQIDBAURAAYSITEHEyJBCFFhFDJxgZEVI0KhwRZSYrHRFxgkkrKi0uHwJSYzNEPC8TVEU1RVY2RlcoL/xAAbAQADAQEBAQEAAAAAAAAAAAAAAQIDBAUGB//EADIRAAICAQMDAwMDBAICAwAAAAABAhEhAxIxBEFRBRMiFDJhFUJxBoGRoSNSFvAzsfH/2gAMAwEAAhEDEQA/APdPE613O92ShazKslxpLlT1EJkx+64v1b8hnprCSrvk7ODWbf2Zcqbc99pqks9iuMtNVSyu+XqpVQBxxP3RyA1Wyn+GZt4VGque0Nw1Nq3vdxZHkvd7qRSU8RZcrRqQvJeuBleR+fXUVcX5L3ZWeDK7bV8G9Iaiaz3RrJBaoqSiioqhFEDD76vnqM9PUuperFP5PgVXGu5tF2lNLvC0VDWpKaz2G3t9hpg4Mb1L98/PAA6n56zl1ei5XuQmvg15LXhhartaNoJTXy3vS101VJUTjzgzFnYsT07ewA+Q04dZo7UlL+RtNuzSWmsuNz8RNzXu12iW4S0YjtNtqpOAhgKdZCWPX7ze3y0l1+kmwmk3GK/ki3bLuO2r9t9o6GS+2230NSxEEipwr5ZOTSlW6YIJAI6jWf6jowWGKdt2ipednbgmsVylFJFWXG/XqCrukMdQFSOnjxhFZvvdFXPz66zh6no7LlyNqmdDVWvdVR4iftU0dOKCOytR0lSakFYJpMlyqfe9kGemlH1jRbeRJVCrF+GVBuay7Ytu27pYYKQ0gJqKqWoSRZZORIlVR1YknOT1Gs16tpqNUNpOTlZq/DjaF5t8gi3JYBU1K3KSsmr5rl5sEjFiVkSIDPLGO/bGsp+qw2LbyVTb/B2u+ae7XHaN2o7CiG5VFO0NO8kpQKW9JbPzAJONc/6rJ/cCSTRyO8fD2u/sLtvb+2IVqKK1VkU1bbxOtO1Wiqc8XPQNy9XXodVD1TctupwQk6bkFunaF7rtpQw2+x0lPUi701fVUUtb5ktbFGeqSzdix+Q6al+oJybLprv2LniLZt1bu2DWW2nt9LbauWpgf7K1bh5qdGBaJpVGFJ9umNKHWyjPa3hkKoKgLht6/PsS/wBNZ7TR2y7XCkWmiWW4+fOQejB5yMYCkgAdNH1Teo2nguEEqsbeNr3uq2xtSjtUttoq6yV0E3FiXiijjRkIB7s2CPz016i38X2CkjX7z2PdqjcG3K62Ui3eitzVElXTmsNM8k0gGJ+YBydOHqkm7aFLKSDue1b7+39rV9stFmektRqGqLeZ3jjimkxwmDYPmMBnr0JJ0oepO22shwmi94cWDc1oa/T7glt0tTc7i1Q09NIzM64wgOccQqgDHU6U/UpPEENRW6yzWbcvdT4l27cEZoHttDb5IIxLKwkSZ26sFA91AGfx1UPVdRJ3yFJnPN4cX+HZ9vooZbXLcpbz+0ry0jsY51Ds2BjqcHh0+mheqVHZzY6Vj5NiXUb6vV7elsl1pbm0LRy1rzKaYIoHEwj0yDPUZOtNX1RqFJCq2l4O/udPLV2mqoWqBD51M8HmIMBCyFQQB2xntrH9Z1F2HJJLBzezbFuq0bMptqS1dmpoaW3vRRVVKXeSY8SFkwQOHU5PfrqtT1jdWCYxW5yOYg8Ot5nb+zLTJcNvxUm3KtZZoI4ZHFWVB4yt1+9yJbHbOttP1mEF9vBM4ZtdzYS7G3E0W/livdBHJudiKeQwPzQGMIokOTgABsBf72s5+tfL4rBpBVhlq7bTvVbs1NqvJY6q2ta/scsE0bp5cq9I5YiM54dCAepI1H6xJN0mTCLV2b602++2ytt0FTfoam1U1tSnME1P/wARJOoAMpk/ukDtoXq8lnaCijfnqeKqWA6/T8tav1x1VFOgGJYcRGeWOmT2Gnp+sJLMRUNDSjCqiLkd/c/Q61h6zBumhqNjWaVEVvKiAJ6jGTnWq9X07FtFSSdyqryPcY7a3j6hoyV2LayYJAIgJFRyf7oOtodXpy4YU0ZJEoPMqSh6Y59tae5GXDFkJAuQgWQgL2z2/PVrKAKQgEKAFJHuNNrAuB6Z6FiwBHTj7jTX4CLZnHkxdOAHfv11lrSjCO6RTBjliOSydD/h6Z14k/XNHTe1FLRcytSyiVeIRWU9VK68L071LW1tf5s1nFbbQSJyHLiAe5Df+e+vs5Sl7eDmSbyxBdm6ICq/xAtr5jqdfqVI1TSCZ3RcuxUEj0g41xvV1nyDaDKyuSOGQeo5HB1g9RpjsGdFMWHQvj26jU+5JcOgWDX2OxWWzwTR2u2R0iTymaVULYaQ92OT3Oqeu5KmxJfK2bReLLmRSemCv00lqRKbsExxBAOK9Oox21b1ES02Q5jLcldPUMEE/wBNR7yGQCivjKZx7DOn76E0hUhy5VEBPc9MDOn768DrFBox4hWK8sZzgqNT9SQZJUBYmbiH4j+Fu+q+oRSwAZBlDzZAB0DacupRNOwmKquVnTmR1C9/00fULkqrCb0xgB1Z/YsO2nHqIcjIUYkDhzyA9RUAg60j1EKAGfiw4l2Vu54+4+Wr92D4AkIcYWbgnzY8Tn5acZxTDuGsax5BkBP3hnu2q3QZLAY8SSV5deoDH31S0YPNgZnDCIAAdCG5Z5apaMOzH/JjSxqpWZiuDgZ/pqvpfyFrkIyqfRx4hvcEddN9NkluyMxEBRxKqMZB66a6Z2NYDBAjIjLBW9w2Dq5dFN5SJbA9XEtz/HGNJdFqeAvICsJArO2FcYA5Z0n0c/8AqW2iFCoGMZYDGeR65+g1D6TU8E2Y0ikgebxk7hep/wAtRLo5LsAzkrLgY6fIaf0kuaAmNXy2Sz8u38P66JdO64GnQ1BxcglwcZ/vaz9j8FLIRjLRqPNMfX2OC2pWnIbwCsMUb+Ykg44wATkZ/LVKMruxchRtGE5xj0+6r0GdV7mpHKYEGQsSQOI+XXI1pDrNaPcmhDuVIB5cR1xgnOto9dq1yJommXjN53FlVgBgHA/8NbR9S1FkSVBVEkxTjGxiIyMcNeX6h6tqSjteDSK7lSd51TCYkwepHTXzmlPdJs202xtGzfeYFvop6DW3pMn7yJk/iPPAA5STr/eboPwOv03Qyso5k7RgZT3HQA5yM6etCEYttAAjAp0HJPYAa+M6zqVupFpWGwYgkqpyPcjtrzpzsdUQ0bEchMePspOTjTqwtBKF5EEyA9vmDrRaYk7BCqqkZkLdx1x/LTWjY2RIp5MRyHz9z+mq9iRJnl5bIQN7EjQ+nlXA06JdAcsqyAjucYGr+mlfAWQEclcEGMd85zn2OdafSSrgNyDVRhT5ILY6EnWf0rfZitBspCAEAgn3PXU/Rz8CFNEhx6y3zU99NdHNLKKsCGFC0jEKcnpx1H0s/AMkwiNiUQEEZAPfQula5TGngxDxHAY+vpGM6PpZdkMHDYYAHicE/QaJaE49gdCZXGVUJIMe/HodHtyJwZEPcowwCe+M/lqHpTQ21YTScSWXlnPy7aWyYWQ0xKLzbkCemAM5+f4aaU0F2LPkowJ45bvjLZ1SnqeQwODQK6s2OWOhPTOn7up5CKGQzgKCR6R1JIGkuo1k/uGzHnwcxRsU75AH660j1utF8k4ZBqB1YmU/MlcDXRH1LXQnEFp09o+obpn062/V9egUSad8OW6FuoJz0+mNWvWdRLgdIdIZCSXJz8h011x9eaWUGxAtIuWVk7EE9xq/1rTayg2Bc8EBkLK56AHoNWvWNDuv9BsHI/IghuP90HoRrZepdG+SWmhcyf8AxSBKfl7nSfW9C3yFSFxI4Ysjn1fwk5C/hjQ+p6NK00Um0NDSFOXEn26jBH5aHq9DLLkLLMZ2PEnmX9srrJro5PEgyif3svRlbr1UHWkOh0p/aybyTFGY/vM/T+8OmdX+lxfcbYU+eJy3QDsOx+mvK670rZBuw31g18uZAFZZHAAwYx018nHS9vUaOpRSyai47u29YqmOC9Xijt5kQsqzvxJX5jp89P0vR1ZaiemiZ3t4Kp8S/DpgWG8rKuPf7R1P66/Uemb9tbjlp8UKbxP8OUcj+2lnyR90VAb+Q1rKMWqsW2XgweKPhtgom8rWAegBkYD/AC150/Sumk7NI7l2FDxS8NckLvS0+jvguT/06S9L6Xuge7wAvi94dmTB3faCADkl5APr/Dq4+n9Kv2oWRa+L3hiFA/tnbOIP8LOcfj0661XSdOv2oKYweMXhjxBG9qDIXI4xuR/lqvp+n8BTAPjV4XBuI3nRKxA6+RL/AN3rqn0+guwtr8FeTxu8LIpMJvKhDZxgQy/1XR7Oj4G4y8GN44eGHLDb0pMe/wC5kP8ATVe3pPIbZVwBD42eFrs//rpTMpHtSy/z6aPb06JaaJk8b/CmnKq271kBA/8AucvXr/8A509sUNRfgX/t28KDzVd2wsQP/wAnKCP5aHDT/A1Flebx18Mcc/7WSBlOMJRuSe2lsg+wbWHF46+Fj+kbjn5kZK/YZM/y0e1pCafgCbxz8MP4dyzcT0P/AKPm/l00PS0+yDbLwKPjp4Zkoqbjqmx7CglGfp1GktHS7j2yFv49eFpUrLfK2RkJHSgf0gaT6bRfMROMiW8fPDAsFa+XFCcccUDkfj9NR9J0/eIU1yiuvjr4ZJNI8VzucokIZsUMrDOMdM9ug9tZy6LQb4opO+w1/Hzw4EpLVV0PHA4mhYEayfp+iDt8Ax+PPh0/IR1F0dvbFF+vc6h+l6MsgkyG8fPD7keMt3bA6cLd1PTOPvaz/R9F5WB5Ft4/7Bx6Re1bHXND2/nrJejw5TC3dCT8QWxeflGnvbhD1/4TH9dZS9Fk+GglaA/3gtgNJhKS/kdlY06jBH0zrGXomreGJWA3xFbGaPh9i3FIU7qKWPr9er6S9F1L5Q8lep+IrZwkic2i/ZJOB9mjw2e3Xnpr0XU8/wDv+CrZA+JPaoPEWG+OTkghEA/z1P6LqVliwL/3ltrOGY2C+nHTPKMH+ehei63doG6RCfEztlQrPt2+NyBClpIfbpgde+pfos/JSYs/E3t4ZC7UvLjtyE0IP+eqfos2stEtoiL4lrFy9O07y64zhqlMj8O+pXoup/2QKVhD4mbCGdBtC9hm9/tacvy6al+izf7iuO5n+83alUrBs+7tkdENbECfx6dDpP0STdbhbsgN8TdIFYJsa6K59zWRkD8NJ+iNfvHYa/FJQQgCXYtx7ZBNagJ6dfbW2n6JK7UxNgp8VdskTrsiswx9INzXl/0dNfQaGk9KNXZm42I/3q6YDjHsKo6khRJc16j/AJNbuTsFHNWdh4Q+NieI25ayyx7Ze1tDSGo8xqoScsMBxxgY7nrrg9R1XHTdIHGnlnqMMkfMKyPjifu9AO2vzx627Vbo6XI+bPivKncFnClnLUj5DjAHr+evf/p2L4FqNuB4k1O8kHJcSHBwAfUOvbHy19pkw4ZXp2aOTnJTL5gwOgH66kHZdPkBgssUbqw6sSQw/DT3UCfkqqAZZDEjKBk+gj8umjcngGwZZzwQnmzBsgFuPLp26dtOqGLkMnlcTAUJXk3XqPz0W+BUIiRyVcqUbA6cR20UMTMgQco6nqPVjj179u+nyiXyWIPNdCViVlBBJGQyH89DdDZ2HhXsCp8RrrWUBv0VqNLCsxlkiMgky2MdO2mo7lyTKexr8m4qPBa7x+K1PsNr3HK1TSfaluApmCmMD+7n2PTTxF7SZSSW4V4j+Dt02ddrHbae9RXmrvEjRRRx05h4Fcd8kg/jrOeHRW742dZF8PcBqYLbV7+s9LuCeEyR0IiJOP1yw/xYxqtrZLni6Od2X4QXa8b9u+zbrdktFfboBK0wi85ZlZsAr/hPfRHOOAm6rua7ZPhi+4/EO77S/bf2KW1eYTVmm8wScG49sjGe+pXy4YSlsrBv/DjwZqt5beuNypdy/ZZ6KsmpY4DSgrI0fbLcunL+WtIruxue2VNGj2v4cNedlbnvVxu81DPY5jDNStBlmKgZyc/X5e2nKKpuxOT3UjtbV4CWC4Wd7rb/ABNpZqKBczzpSq0aHiCeRz0wDpOMa5J3vho5naPhVS7m8Rrrt227rjqrbQQCU3OnpllEmeyqucD30oxTZUpVWDW7+8Ppdpb9o9tPcHqqSpaFoqpohGcOwU+gHHQk++lLDofKs6neXhFSWXf+2NtRbmnmhvbuskxpArQlPkMnOcaulxfIX8WL354RnbW9rDav2hNU229VC07VqRBWjkJ+7x7aIwt1ZKb2tnI+KO2I9mb1rLDT3Fqr7PGnGV1VSwYZIOOmfbU6iqVDhbyb/wAHPDizeIG1LzVPfa+jutulZFpljRkb05Rie/U9NG2xye1lTw52LQbi2rufcV+udZb6SxqwYQRqRNKqkkEnt1AGmoqtzCTadI2m9/C+0WTw921uuC810s92npUaJ1ULEJvvcffI+uhNLKBNt0dRufwn8LNnmCHcfiLd7a1an7pZET96B37IR0zqWknbJW6uDR7Y8Pdg7pG549ubjudx/ZKA0MiqipODHnLgqD98EdNLlOmDlJNFTZ/hNRXnwdrN6zz10d1SOaSnp4iBCUjOOoPX2bWqW1WxuTi6Oe3PsqzWfwbsO6aqoqhfL1J+5i5jyRH168e/bGs2uGwTlJ14POGikRSWYYx198nPTSkjWwYIQrYlkGT2AbHv3OpoToNecbP+/PHOMxnOR9NNKuQw+CWeRS3Kd3GT6j0K598++k9NIKGQVMyODHUuzKepIGPyJ76j27dgnRjV8gXgJFkx09XTtqXptA5Ii41klZN5pVUZUCKijt0641emqbbBUytCWkLljGAR/d6/lrWWF/I6SLEndTA7BQvFiDnJ/PBH+WlwS0ewfBzyHiVdJnjjkUWhgfV1BDg64+vpwf8AAP7cn1fT1ETTgc0RgmTybkfb21+b6ka13Rs2nG6Pnv4t5zDf7DCVGBSS8gy+n72vtfRun2RTFPKPDmcxiPiOBY9SCABr3mZdyrUujuY48JjJJx/loGQ5aRAGy8y4C8e3H5/XR/IWColkcBh9zox5ZGP9dNsGJLcST5oYLnkCMZ+XQ+/4aLE7C5ZXiWPEJ15HGPz0DTSFU8jog5hubDCnPbV0FgSRgs7NIFYnqg79NSlhgFIivCvIhmYBVYnqv00qHZ698LylLruuJpHVzZ2AKHIyCSOvsdVF0mZamZI9QkvlNUeEVL4lvO4uS2Vrcjg9QzShWPzJyNZymmrHVzcS74j3CiofE/wxnr5f3GJYjM+Bh2iGCfz1LpaiROfbbRp9x7Q3PP8AE5Y9wUlLUyWuOOItVIgKRAKQyk+2enT31opKOoXqJVSOgtl4pav4h7pDRsHkgsSQz4xksJOXQDuQPbRu+bZMk1GMnycz4Sbbvlo8bd0366WqohtTx1BiqZMKkgZgwP11GnOI9WKdOyl4eXaq2/4G7tvVqZvPpb7NVQgMcOvmZIB+RGtd1QwElu1f7HXboFluXhVundFjR40v9vM9QiY4rKqYOQOzex0m1H+4oLP8HCeBEePh33TGpkDc5iSI/S37nsdNzWwG3vyO8E7NQUHghcbncL9SbVkv7iKOvliwiquOIGcZJOe2nBf8f8jfyn5o3nj3aKW6ba2lu63163EUNdTwSVUZBRoS6rzUgf3h89Fp/cEWqou+MAhPj74aspeb99MAQuB0PYfrpOt6SJi6i2WrNuKgv/iFuHYN9WQTUlelwtEmf3i4UEqPfIPX8M6NzyvA5LCfk8S+Jkk+MdzgdMyeRA3EpxyCp640mrz5Gl8UT8Lu4hYfFGKiqTinuyfZSTgL5gOUJ/PThNWkOStnoXxIQUuyvC2p2/b5Eik3Dd5KyXCYZVPVgfp00XlxYR5tjvFsSN4DbGkkj4D7VbjlQcHr01U1VImL5PRfEZt9UlRRNtHaFkvcWG89roSvkt0wFz89JOS4RPxfLPE/CaW+bb+Iy5WjcVBS0FXfI2FRT08oaFGYc04n5dNKk+SnlWmemxXOmtHivafDSkPGhnstR+69jLIxYY+uOQ0TpvaOTvLPG/imqaWHdNm2lRgxUtitiosUn8LOSfb3wP56LWE+w13a7nkzxFnyUYHuhx0A0qHRWnhaJzxRyTkk5z+OdU6GqY2VYyqSLCsZWPpxPRj/AK6UssHS4K+G9TgMABg56g/nptp8iWTOBISPGFYE5Vfl3yffUMAnjUANlu3pIXA06BKzHi5SRsPMwRlflqboaw6DMWA7Oyq5U8QSG6/X5HTvASIhBZcuWC4wxxjGpA9l+D2OFPEi4vOUfna34kDIHqGubrlcH/BMuD6rEKrnjxUE5Hpx/PX5zO/fZpJfE+evjKbG4NvKJsE00w9sn1L0x31+jdND20ooa+1ng3mKkcnLCgH+Iggj8NdbMmsihNEWVmceWvvnov5f00bkgobTVcKz9JAx9mBCgD8NNTyCQxnozOwWeBeXVSzgHP8ATUtpsoBpInYCWaEPghShDA50tyEJqZKbK8ph6RhjjGMdhj5aHIWURDU25eLSz4JyOh6D66tSrsGQuVryreeWkbPcrjofnqLwx5oxqiAjjw6lsH0hv5apuu4+C3ZN23Xbs9VLZLs1DJVwmGYxxjDqfmD20ZfDJpPLCTd98/swu3GvLfsiOcTrSrjjzznl9Oozo2Kssru2XN1b1vW546YbgvhuRo2/ccwnoBAHcYP89J05WxR+KpIt0Xidv2ntYtsO8rmlJxwoJBKjtxDkZH66htcNgoo0lvvFbS1iXKmu1XBWpIWSoidg5J6nJ7nOnca5Hl8o6O6eJ27rxbntNz3TcJqdhxZGbhy+hIAznU7IvuCWeDU0m6bxS7fqdvUl4qY7VVHlPRqw4N8zgjPtptqqsGks0TS33ctBaqi00d7qYrfUhhJRI2Y3JHU9vcfLVXZNd0ZbN0X21UFRZqW6XKkts/WamiDCOQkY+Xy6aUmuLHV5BrtxXautEFnrLvXz26kXlT00inhGAP4Rj2yf1098aSbCKa4QuDd25obL+w4r5dRaQQRRxuQi+rPRcfPrp3Hmw2UuC3cNz7sudzo7tV3i9VNZSNypKiRyZYCe5UgdM40nNN2PZiqKE9wvs19a/PcL1+1uYcVipJ5vLGAeQGR8tG5PuFdjLvNd7zcnuNzlu1ZUsqiSaohkd3A6YyRk6u4pVYknwIhpKuKpWrpIq6GeNw8bJTSIykdiD7Y1DaWR7WrLN0/tJeHSe7VF7ufDPAVMcsjIPfBI6A6FPuyZXQU0m66qhSiqDfZqWADyaeSKZo48fdKjHt/LTcvyCS8F4XDfTTDz7nusMQOwqvVjUb/yHHYqzUm46m4LcJ4twTV6jpUvDN5gI7Ycj+unhZTGrQ02zdclca1LfuaWoHaoMcryDvjDHrobSHyKksG555XkqrXfppSMM8tFI7EfiRnUxmkhXYQ2vuQxBY9vX91APUW+Uf5rpqaHlANsndErddt7hIAyGFE56/jjrqvdSC3+ARsbdiyMP7Kbhckjjyom0vdQZHR7F3nIOL7N3FxIJUpRNj8DjSeoicruGvh9vfjwg2XuMJnLD7Ex/p89T7iAavhvvx2RBs2+MT/C9KwUgfT21S1UNVfIaeGviDIPKXYl8QgHp5OAf1Oh6sW8sLSd2Pj8L/EQSEvsG8DpgN9nBx/2tS9SPkFJN8lql8K9/FcHY954OCDmDpj8c6j34XVj/g9I+HLYe7Nr+IFfX3ra1wo6OS2vEkksfEeZyUgDr+P6ax6vUi9N0Q/kj6FllHl8JUIdW6hs/LXwPUV7zNUqjk5+z2Sl3Pt20V+9LZZ7rdmpQ8jfYxwUt1wobqB2/TX6HquOnVYMtKTp0W6fw72RH1/slYVz/wDwU6/y1h7r5s0ryOOy9lwsqLs+wnByAKJOml7kuUOkMG0tnkAf2YsYx3xSJ3+Wj3ZNkqrJG0NpBwv9lbJntk0SHI/TQ5tluuwo7U2shyu1bFjsQaCI4/VdHy8kNLyTHtnbjZ/9WrB9P/R6Z/UDVXLkVWOh2rtonLbdsvTuRRp1/lobkxbTP7L7cCBo9v2lVHZRQR9f5apqTQJJASbd2+pBWxWUkdeLUEWR/wBnroW98ipCls1hQ4/YNoKn+IUMeD+HTWmzUa5C14HxWmzOpMdkt68R6gKNBj+XXSUJeROaCjtNpVABbbdj5mijAB/HGtYwn5C14HG12vhya220dPUrUcXU/wDLq/bbyFiorVbpE5LaaCLqcD7JHn5Z6DS2MTRYitdAkWWoqTB6/wDu69P5aHp0rJoIUVvBz9kpc9iWp06fy01CT4ZVKiJ7dSeSONHRn6imjH9NJ6F8itAvQUS8QlLTH5g0ydPw6azejXA00WVo6EqOENMARg/uFyDj26ajY0NUS9FHGoYQRkZBH7pTj+XbR7U6HcSBAUbHkwEHrgImP8tQ9LUi7se5BSKgDEww8j7LEpP+WnskwVPsIEgiU8Hwx6YKDUOE0N7VwORyGUq/qz0IP66TUxKmxjyTIhBcMQehJH8+mltnyNxiUpZmJIWRQwODkDP5atuTCooMPFhn8x8noCTnULcFICSeXiAsrqB0wWbr8unbT+Q3BUHTz1DR5EuSucdTgapxbQYoHnNyATiTj+8eukoMQyN6lQVDMuepIcgH+epem2JNXwWY56pYwvOQcc92IGj2HXJe5eBYmn5NmoY57es9dV7c+EG6IEckzTFSW6HqSemjZKxOS7Dk5sDhWBB6Z6Z/H56zlpysE77EuXcdMsR2xk6uGiwoahdh+9aQnGDzbGqeiwtdzAh4+px6sYyc6ylot8itIR5EPGRiSvH+ItjP5a5fYpmsJgETkF42GAOoLZ5DS1FcGjPU4ECKSSrJcKSVyQB27a+T6uO3VZd/BAbbC1NgtlbHGP8AiKWKQBmzgFRr9H6vTtpnLoYWTZrE2A3AFh2yucD6a4fae42crF1EDygkM6MDjrg4/LV+07od5M+zHOQcZ6ZH+eq+nbE2kStNIilZJGlTv2A6flrSOgClYuGgBcM7O5/xt0/Ia19hEuRaamVWUJF2GDk9Dq/bVDsWIRGVVfQAenLrn56ftxEyUh6DIHDlkEe35aaiqFTETQxqg4pxHXrx7nUpfgnNGPHIyqwBOCAOIGNaJ4BcEtFIQQVQP7k9caEKiGhbyyspHI/xKoxpjGpGwiGOvUY0wBMUmT0Uew9WoGHEJf8ADjOOo6nUNtiFOo7MoJX59euqjY+xwW+fEpdq7stW2KrbFbWT3hwlvlgqYwkhJweQPVcH56tS3YYRgmm2y7NvO70lwq7bWbKq0ngo5auJhXxPFUCI+tVcZ4sO+DrOUmpbaJjtebOdtvjdS12zZt6Jsy7Gx08/kVEqVcTyxt2J8vAyo+edWktt0W4u6TNnvPxat229l0e8qOz1V4s1ayBZYahInQt2BRhnv+mpUlZMflZS3x4rVW1KCyV112bNJDeWVabyblGzI5wVVh8sEddGo2sNBGmsM21w8RILPuig27u6zzWKoufS31azrPTTv7pzX7rfQ6Sj2YXi0WvEzdlt2Ltlr1dlZkSeOBYlOJGZmAOD9B11SitrGnu4B31uWtsO1pNx2exx3+CFFmkjhquD+URkMuQeXQ9QNTtr5NWgxWTUWzxCqrt4Y0+8aG1UU9RUziGC3Gs6yOWxw546P7kaVwj8mv7AnZ3VAs70iNVxRU9VxBljjbmqN7qG98aKW5iTsYKdSVdOJOc44k5+f4alQRTJQMsjHLA+65/prTahWywquIGwuM5AyuNPbEYl4WdAQIsKO2e50KKFkKNZI+PJcZAyEPQfidTtiNJjg7njyCY9jyGnGKYMxoVZ0LdBnIwP89OMVYkwS0ij1RIw9mBAJ0nFAHDI0qMruxY9uvb89TsTGHxl4lFBwf4lfv8ATRtSGAVZB5DZPJevXt+eqSXcS5DhjI4qOTIgAy65bUyikNkyKHmz68/3T215+vzguLKzZMw4jy269AO/9Nc3OGOawHSSutSyOpBCnqcH3Gvl+vh/ytgvtPHvhF3e+4/DBbZUzySVlol+zlpH9QjP3ev07a/SJxuByq4zPaUaUsY/SVHQkjr+usFFbjWzBGwAJ45ORge366dK7FbbCjDrxAC9fYd8apyQ2hkrcD911UD27aaBIgSjGCoJI6dOuhsBXmyjpgr8yTk6kTyD5wSQI68l7hu+dO0ARKlyw7/Nc9NCaByFVM4TieBIBAwgOevudFMEsC0KmQrJ0Geh00mkSCH8t8s4bl0UA5OgpGPGxbkhYAfxdNCdhYatOCBlXA7Dsf10OVCbAMkxCtHGi98gnOp3YHQ7kxRWKdWHz99K0FCy/lNyZU/n11okJptngXj3XUtV44eHUBuRomhmYSzxFVkgBcYb1DA7++of3JJjae14PQaSzDamyLzBd719sLT1tT9unlUF0lGVLEfxfhq1KviSsu0j5s22t4PgB9st9w+22KC7M98s8QVZ2h6HmGA5gHRFqK/BeXJ/6PQfHq9bOu3w82v+yVTRLRy1dOKWlVx5kQDepCuc5HXJOpkqyhQg488iviBudoqNt+Hf2e4wSmOWnMgjYOAvlLknHYAjGibTkmxaSpO0bvx6+yb+3Btbae1p4q6op677RU1NOCYqWMAd37ZPy0UnIcVUWbTftLS+I9zv1ppayx1Fvs9CaXlVyOrRzuuTOpXp6QMZPudJPNxCqpCvhq3bDdNkttu91cJuFnL07LKvWWmGQGHYFe4z+GlOa2qISjLucz4Cw2qi8aN02qmqS1tpZnns0MhJi5kjk0eehYAkaaSTYXR9CiRe3Y4yP/HS4VAiUkjlfJfGOoXtqopUNjVDh/TgDHQKNO6QhscknrRwB88nPT8NReAIeYBCECs+cdunTVgFGyv3jyCMFuvTRVlIFkhflFkOOnUDqNCWRJNvkmNY0ctklc4Of9NCiFUMRVVSGDlcZzx6aTYrMKoJBhnBbtkk6EikvISeXjJLch0IAOpaHgJAxOAfbPFu+NLgnke3NMlll7dPT00ZBLBXlaE/fV1JwT6SR/4a4eo8lRYicqX4AlT8uh6fhrii8mrEM80IMioDk49bcc68/qem3yszjJVR80/ATK3l7oUBmjjWFiSABnkf119osxZy6v8A8iPqGOWPJKKg5HJ9WNccZPk3Q0iPHJjgv16HONat2h8EMuchQpx2C++ofAuSWHJukL4UZIbrjVxkJ2Gi5YtzKr8+PQaHJCEsIuXFy+e4IGmhmBSGJyrnocrpUPaE3Hhn75HT72f8tArFTLxwwyMgYUdSNXaoLER88iSNjgt94nPUj5aTkTZBTmPVIWP8XEYH4Z0ILCiRU9XAEfJj/wCRqeGOxqhTgAhBnRTYqAyhICSEH+8OudS6KTG+gHoBz9/cjUunwFmc4VALTFTj+9jP/jrWGBXZTktdslkaWot1FM8gHOSWljZmH1JBJ/XVd7DIyeCkmjEJpoZYwRxjaMFQB9D01L8jQqOho4g7JTUUYcYfhCq8h7A9OulbFSQK0NtiAK2uiDZ6f8NH0+Z+7q8vkXOBiUtFw9FspFB7caWPAH/LqXSYJKgYo4YIylPDHGOWeMUKoPzwNDf5LSRKR04aR1igQSAZwoHL+WlbsnbQNQgLcBAOGABy4np8vw05KyuCABGVQpFEV+4I4lPH+XTQ1RnSuzDjizKFPsT2b8NJM0QyDzsjLFQMYwmP56tcCoY3MZOSOIBHHBI1m8gDAr8eBZ2PHDEjDN+Oqi8UFjEcISvGTAOCcabGZxJfmsxEWCPLKDqe+c+2lTZNjImCgDgScZ6EH+WlxgOGR6g4yvEcupA6jVFLIyONc5WZsnJ6voYrpkp5pwWIPTqew0kXusz94gIZ1wT7e/TSbViqyFwxBK8mOCPVqXl4FVErwEvENIPfi2Qp+udS2xpC5S6sWYuehHz/AKa5daLBYYCHixyFct0Zweo152VM25BqUuE0KihFEs2ct56sV4/THv211aPT+5yYS+LyfNvwHtO+3NySLAHpjVxxiXtgqucAe/3te5J1pOjCSvVR9MyGNY8MhIA7EZA1yJHSyfLUT+YA2WHYdtMi8DYyQDkBsnrkdtUNEOp+8SM9uOdNiyBwUSHlxPtkNjUARIArlsZOfn7aq6GTkJlgr8cdwcapDyJZ+WFVeK57hs9NFEgLGAVKjl17Z9tIW4luCsDEgTvkfPSHSBREZWZmfoM9PfV8ITRIETAfeVvqcE6gEMWIjAPHGOh7dfrpp0FgO7ofuggewGs+cgQ+G4iSQJH7gdG0KrAF+PBgvbJ6dM/z1qsMCAct5ixkMOoGc6bYWQjZkHL1Hp1H+mk02BkksoLIiAkd2ZMfz0qdgwI2lbOSORHRgCunJ0KjACJcBwCzdeJ6n6ddOSGSRIAVDAgLnLHr/LUtBYMYkUqSsjniAM9VH4alCbYbEjPnFQT3IGMa1aoSYLxs5Lc0LA+nkfY/XUzWLKoBz5Y5GKI8fdV6jr2zoVDWBo85QAV9RHRQSMDUytcD5JYKW4GPAHfB99NqhNYHKV78h0U+lTnUpiXAKHkGzJxyeg65xqojIdlVOJ59RjOcZ/XWj4oQtZI1JDRspyBkdc6z25BsdHKzTYJdVUAgFcZHy0WCdD3eQrkMCSPSD7ad2NPILzRJMqtyZiM+k9Do7jXJKSEv5ilz3ypbofy0VY2YzoIuRiLZ9s4OptJ4JeQxLyUoAQVHTPXOo5YkmRKEWEsCQ/uAMAn66y1VgpPIsMjyBuGCO/Q686UblZui1SMFlPPocdyx669DpFgw1zwf4LLRNbvCEzPF5MNZcJJo2JB81QAM/Ttrvm17eDni92rg9yaPorrIgB+7kd9c50SYJiLMGEzNnrgDP66fcVoPiUUsqv07kjvqrANifL5cOQI+XbT2gJUlQCZIhnvkYxqX4DkJg4AJK49yR7/LSyxOl3FySqozIcAkAYB6n5apchTZjFVIzKyq/TDDGDpWDRAPrbkegHt0H66EIH935menHGqtC3ApGkrF+SAZ6qD307RSeBpkCy/+xK+nAJ65H5al8lLItj/8MLgEdf8ACPz1LYqAeNhyPrkHuqjJx+WklaaQcBuriM8qYoeOfWOvT8dG1rkQuNWMasZmz8gegHy1osu0ARVFUCRGbPQFf6jRd8CBnZFUxAMGHXqPb6nVWOzIiQp5OUz1OBkY/HQ35BkAh4jheQ7L6ux+epkrBYMbJ4qkhZ8926j8vlpsMskLLksTg5+730ZYMyJ2V8D1BRjoCBpYsKFtM/ORZUHDAx8z+Py03K3QKAYQsq8VVQehz1z+GpbGKaNXQjBAPtnp+Y07DuOiQlCp83iO59//AKaTlgdUGFGfvOCB7+/6aayN1QtFTzeS4jB6kgddG4SQfQhuTjvjt/LQr7ieGCJnIEZw5VSMhQMnTE3fBEUbOVaQqAT0yeo0m8iQ90cHiXBJOR8z+epGA3pco6txJ7k9RoVJj4ChwkbYOWHQHGD+Xz07bYWAWLkOyFyvbBwc6HFsTHc0ZMvyQf8A7g6nU0CQqorrbSzxxVNwpKR5CBHHPULGX9hgMep0sJ5GkxtWpXAdiAG/HH01jqpbWVeAHkRXYNJj6DvjXmydGqLlHPAozKR2wCVzr0OkbtnPqI4rwn28NueHNlsbRy000FKPOilxyEh6t21tq6itRTJ0VTcjp3iRBzQs+ehGc4008F7rIraWSqt9RTRVM9K80ZjWWA8WjJHRh9dPLQYR4V4f7iv/APZ/fO2dx7ovU+4rTUf8LOswWVgTiMIMe545/HTgnKDV5Q38dRPsxnhbufcO4dgV1juV/vS7uju60Es32kiZCT1Ix2AAOdXF3FVyRKoan4Z2d08Wdu2qmrZno7zParTcEtlXdGjVgk5AAJUsHYf4gMaFJPJUVJLPLNbWXi6U/wAStntEF3rzZ66zvUyUTS5hkfBIcAjK9NVCPypkza9pSo7neca1e0rkUq2UwU7yxvR1nGRGVSQcqc99Z03HBafB5V4F7w3Bb7nedp7+vFRcKqCjiulFVVDYeaBow5Az3wD/AC1Sk38WTO0048FDYlz3NcviGrbZe79czbVojcIaFKh4oogy8kUr74GCQfno00nKmVrSajaR2f8AthsEEdNXS2m5x2equjWuKvcoP36nqTFnmEz/ABY1O3uTnh8lu/8AihS2nelbtQbUv9yuMFI1WiUIjkEsYHsSQV7e+iEfk0yHwpI0MXiNuW5eLe39uUO2Kujt1ZbWrZoJ5YxOQQcF84ChSM8R1Orit0qoqVRha5O3se7qS77uu2247XdqaW1Kpkq5YONPUZx9w9/fUfFWVbUU/JzfxGPUUnhlU3aguVdbq2nqIRHLSzmIlWkUMDjvkE6lpLnkqOOxQp7rU0niVao9s3K7VW1hSyybgNdzkpIOKAqUeQZ55z0XWjSU6Tx3Msyh+ToX8QKGnorVda+0V1JY7tKkVLXmRSBzOEaSL7yKx7HJ7jQnawNptYNFb6pLdcPFU1Zu9VRUU8DLHT1vKWNTAzP5TOfT89XJKMWCk3tOms+6YJqKy2+0W2suNdVWmOvjinqArJTlRgyv7sSQPqdJ1VBdcsVWeIlDSW62LJaaiiudyWZlt1wmFO0QiOHLvxYAfI465GlfxVlJNt/g2Wxdy0m6bB+1aShrKL968LxVUeGjZTg4JA5Ke4IGjhYJbdmtr941ybvq9q2/aldcaikpYqyWUVEUcflO/HkMnPTBOO/TS3PwN1zZr6LxStVZXUC0lrnqLbX1hpI6qB2eRSGK+Y8YXpGWBGc6cpVVrkVO9ptU3bVzQfbbRt6ouNsFe1CZYagCX0vweVUIwUVs5Oc9DotSeEWo9nyam+eKFJSV9abdZpLpT0Fd9inandjUOwIDtHHwIZVz19QOilVgnay6L9FdfN8QtwW+ktFV+0aa2U9SkktZ+6qkZiECp2jPQ5PfRwhXYvbW+pr5arDV0lqRam4101JU0hmPKiMXLzWJA64Az+Y0mrpLkX23b4KlH4otW11BJbbDW19pq640nnQRTGeNQ5QzMCnl+WGU9mzqVlWDO9udRU0lDUVNPRNXSwo7pBF6XnIBwoJOBpppclJWss5bbG7ZbvuttvVlHRwVi2tbiHpKkzJHlwjQt0HrUkdRkd9U4JqzN/Fj9/7iqtr0tvqKG1Jc3r7jBRMkkxiAaVgqsDgnudP49y6T5NNdN9X6muktgG3aGS9UlKaurjpxU1UKqzlYkV405BmwTlhgaiUXuwJKKVmVe99ypU7VpKXa1NSVO4Ked5Ke6VLwNRPEnJlYBTkdOh7/AE1c9NpccslNNvPBraPxSuMkbWyosFHDuBbzFakhWoZ4GaQFhIG6HiFBOO+s01eS7Xbg3NTvq62243q0V9sttRX0dokutFLFK6RVkSHDhgclGB/XTeXRLdKzSbg3T4gy7a21eKdLBZ4b1XW5YuDzTOEnwWWQnAA6jqvXvpablpyuXBbavJ6fUVr0Nukq6oYEKs85hXKniMnjnrjp76pSUmJ4i6R5/N4i32n2Nbd/VNuts1hrXiZqNFbz4IJJOCS8+zNnBK/XVRbeEJ12AtVurbr4xbugvgs1zoqaKg/dTULMQhMjLwJbCEFRk49tZSp0mi44r8nZ70uNXb7Ga22C3CT7RHHLJWScY40ZgCw7c2A7KO51OpFODozcq5NXsK/VO4a/cNDXKge0160yTJA0PnxvEJAxjbJU9fn115urp1Z0QkppHYwKOyGQjHuBjXT0skm7MdbhUTTkspYxxEnqCx651loz3MuSUcIW2TkkLE5GSynprtjzZH8ExGWOMqxZsjPJu+tN3YR55VeHcc/jbT76RglJHRYmj5ep6heiEj3HXP5DSg6nY5ZhRFi2BFa/GG9b14xRxV8EfkgN6knPR3I/ADr9TpwjTIkrS/BxG5/CXxC3JDuGK519huFRV3BKihrp6mUPFCjZ8oIF4p0wM9T00nujaNHJbk0dVLsPc1X4p2PdtUtnNBSWr9nVUCVb+Y3JCrMuVHQZ/HWlp6jl+KM9r9rZ35NrT+G23trWe7rsazwU9xuNK1O4qa2QxkNnqSc4/LWVxrDNbcpJyeDTXTwuN+umy71d46anrbFElPcI4JWK1USIAqg4H8Q7H2J1p3TIxlLuTbNjbtpvGOs32WskNNVwfZvs61DtLEnHiHB4YJA68dKE6nuHScVFM5K5eDO/bpbwtyvm3q24RXoV63CdpTLLGO0eMcUHXsO+lLcqBOO50d1SbL3JH40vvuWa0ijkoRRvBE0gkAwcsD27+2nGT3biHFOG3wZfdk39/F+2b3s92tkcMdG1JVQ1kUjyYPIZXjgE9ffVN/Lci7Uo0zobPbt3Uu77zWXfcNPXbeqAottvjpuMlOemSW9/f3OoUlJtCVYxk1/i/tO5702fNYLXV0NE88kUkk9YWwgRwwAC984xqJXyWpJZZ0VRQNcrJLQXZYgamAwzrA54ZK8SVz+vXV25uzKCUeDiKTYV6l2bZtlXmvoai0WuWLFTCsgqaiKF+aIQfSp6AFgT+Gqgn3KxlrksS7Mvj/25Y1dlxucq0IIlxTERGPJGOvQ56e+m3ad9yVSq+win2TuS1TWK67fvdnguVDZ0tNdDVQNJS1kSYKsuMMrAjOk93YVRkmvyXLttDclRebRuS1bkoDuGgjmgnkrqVnpqiGXBZAikFQCowc6cd3Pc0k45TOosdHdIaN5b5dhW10rc5DFH5UCDGAkaEkgAfM5Oo23Pc2TSvHBp6XbNxi8QrhuSavopKOtooqM0qxuJFVHLcuR6HJPUapxbG1dFDa+z90bdo/2HR7xpv7OwzMYFFBitSJnL+SJe3HJIz3xpq44vA2o3dA2LZ24bHPVW+17tij29NVy1iUr0StUwGRy7RpNnHEknqQSM613tPHAbsttZEU+1Nxbdqr1LY95mjsdxq3r5qIW1pqiCR8c/JcN0z9VONY6n2u+5CinyjdW3a1VQ7+uO53vEUkNXb4KH7P5DF0ETFg5f+JiWOdTpqMLaRfbgOxbOtlk3fetxUjvI11Cs8HaKF8Ydl+RfC5/DVppRqsvuJu1TRqbDsi+WNWtVFvasi2z5zyxUK0afaIQ782iWo7hCSfbOD30tlRaTwNUndZOj3lZhuHbtzsslxqqOOvpmi86nxzh5DGRnvqKvkFJpp0aXbey6i1bgoL5Nuf7U9Na/2XJTrb1gjeIMGBUAnicjqffVue6KSQOpN4L+9Nstuqjt9PHc2oBRXCCuDiASM7RMGUdewJGkohgqXvZ1dUbsXdNk3PXWG5vSCjrGhpUqIqmMMWXlHJ0DAk4YfPVXb5EqrbRy29bVX0u/diUNDdrkJYmr5JrhNSmowzxADzOyryJwAMAapOUk23wJqk3RvH8NLZLRyI1dWw3Jq9Ln+0ljVZBVKAFYDtxAGOPyJ1jGFodU+DZVGxRXG51NwvU01zrre1uFXHAi/Z6djlgiYwCT1JOdaNWwxy0BWbDWq2hZ9uyXyti/ZE1NJRVkcCeYGgx5ZZSOJ7ddTV2g5dnRpTVMdI0U0s1USvGZpFA8wEYJIHQZz7fPRWbBt8HM23w7oaax023v2rcJ9v0tSJ4ba/HgmG5rGX7sgbqBpTWKQk82zdWva8Nu3Ndty/tGunnuyxLPBIF4Yj5cCMDII5H3651L/krnCJ3rta37otdJR1lVW0ho6qOtpqimkCtFLGcqfUCpH0I1mpUg22ipYdt0djvN1r6W53SqlurpNUrVTKymRVCeZ0AOcDt2+WuGc99mkElHg6S3RKX4oCoILZAJJ6jW2hmWBT+0EVVHTSBqispoFb0jzplQMfkOR1hoXdBN2ZBVW+uhkqrfcKOqpo2KvLDUpIikdwSpwMfXXpQRi3SFU9ytdTSzVVNerfNTQdJ5IqhWSM/4iDhfz1TVWP8AAv8AaFpEkFOK6haSpXnTL54LSj5oB94fhq9N0K21fg5zeW6RY6qx/ZntVRR1t1W3V0slQQ1KeJbI64BGOvL56LV0N8M6G13SzXNHq7ZeKK4Qxkh5qaqSRFx35EdB+em6yKLdZF0O5bDWzmnortSVUy5LJDMH4Adycdh9dRH5Mqq5ENu/aiycW3JZFKoZQGq0BCg4J/I9NWpwq2HA63X7b92q3pLdfLXcKmJQ8kNPUh3VT2OB7fXUtJukxLGQL3cZKCstsMdXaoUq6oRutZMUeRSCcQgfefPtqVDc8FJYyJr907Xt8ssNbuG2UU0bKJY3qACjHsGHsdVLjLEm6Oe3tvOG0bhtW36K4W6KuuaSyfaKoM8UKomVyq9+RI7abukl3FaXyNzS7oo6KOlt24L1ZEu3BFnjhLBBI3YAt93PsGIOm47e5Kd8GXbem0bXVTUty3PaqSop8ebE1QA0fLtyA7amUU+5VurK903rt62X+02OqrkNVdYmmpiilkKLjDZGehyMaUYrhjbpWM8Sd2Uey9n117nKu8UX7mJlYiRyQADgHA651MaTyEPkJs+4vs1uNyvt+tVTS1UgFDLS0kkMhAUFkKZJcg+4HbWrShyxJWX4927Yahp7hFfKN6SecU0cvmZVpicCP6Nn2OlabC80WJdw2GOa408l2gjktiCWsVs8qdD2ZhjsevUaaabpMG0qRUs+89oXu4Q220bkoq2sqIzJBHHy/fKO/AlQGI+QOmlkVuPKOV8UPEGnsthlbb19t5utPXQU8kctK0yNzlVGQP0QOAScZJ+mlazRSy7Z2m5rnHarHcLjPcaS2rBAzLU1UZaGE4yGYDqR9NTL4uyYtuKooT7w21aKK1reL9RLNcqdZaYpA5FV6clo1AJ+uO+mqmO5PsX7DeLPf7d+07DcY6ykMjRsUjYMrr0KMrDkpHyIGhBbumU7lvPbdsrpqOsuyxtTSxw1LiJ2SmeTHBZHAwhOegJ1Wo0o8gmX9zXyl25t24X6sWZ4LfC0zrGnJmAHYD6/PSqsAvk1Rp08Q9pLbbXV3Osqba9zi8ympXpZDJIQvJgAB6sD5d9TJq8MfGUTVeIW0oIml+3TtHFBFUzutJIwpo5D6GmGMx5+ujT3SltZTTqy1d92WW210lLJLVSPFFHNUmlp3mSBJDhGkKj0g6tabbkm+P8AYo/JWcnLv4WDxH3dbr/dKupttHT0c9JDBQGU06OhaRiYx933ydRKTjgMOqPQaGvpK6jpq6injnpqiJZ4pk+68ZGQQdWt0qXcUsZNNBvexvcrdSQTVyLc5Who6xqY+RUSL3VX/qQAdS63UU1y/AVF4h2GWtp6RKirEVZXSW+CqancU8tSmcxhv73Q/Tp00oy8Ao2au5eJ+1KFrmtQbtJFaqkUtykFucx0rkjBc+w6jrotPA0rWTsYmQxIV5EEBlBGAQRkHP4aa5aBpVaPOvF+tvdv3NsmK0X+6W6K7Xb7FVQ00sYWSPgW6cgeLEjvpRk2iHhM3m+5Kn7XtpKK83W3fabqlNUJFIvGaMo5IbIPXIHUY0suN8C/FFOv8S7Fb3u8X7G3NULY5FjuUsFvykGRnkSSMjHXp7afxqm8lTxlUbiTe9oerggtFJWXqrnolrVjo1Hpp2+67FiAM+y9zrN4klyJL42a+o8TdufsS13KCjutalyrjQRJTUhaSOoXvFIpIKMManUjLbSHdOzYbX3TQ7imudMturLbW2yYQ1VNWxhJFJHJSMEggjr0OvNnpuKo6IzTOvsqwl+XL+AgKD2GRro6a02ZamUeXeMNHBXUe26apt5rU/btO7RJAZMRjOS2B0X551hoyjaTLfDOV3dbK5bl4kUu2rRViNzb5VgpKcxCaNCPNEPpCs2B1x316kat0Y1iLbOl2XR7VvF+qa+32zcFSa23/Y7jPcaU08Ai9omQogdxnuAfx1pOcZvKJkpJps5Ube3tQWymqaO1RvUbCrGFpGByucDn7gOMqqqcfiNZxcV/YtqPyXZm93zt6oobNtKeropa9FvyXC8COlMwQuGLOygEkDIHY9tFVJMhW068Go3ltS5Xufel42ZbZqShuFupoFgSA0/7Qkjk5SFIyAeq+nJAzqr3W0Um1tUmbu5RQ7g3ns272i3T0tPZo5Wukr0LQ+VCYuP2cggczy/h66ptb1JcENNQaZz9ks1Ivw7X6kO151uzisRI2t2KhvMlJULkZwRqE09OqKV+4kbyioWpPETYlVR2WqgggsUsFTLHRlI4WZV4o5xgHIPz01Jb+OxC3PTdm18VBPJdNnNFb6qpNPe46iaWKmaTyI+JBYsB6R1038aZedr/AINFeLdIb/4oTtYZ6n7dQRQ0khoORnbyipCEjvkjRuTckDTe1i7dBXR37wukmtN1xQWqWKvlNIWFM7RqqrIfnkflrSHKf4JcLjJLzZp/ECk3DdKfeVsh2peIpnuFNNTrbaRTDXJGyEzSSE5dgARxGMY1CwKC4dnQijqJt5b/ALp/Z24eRcLBBT0sstv6yuI2VkXIPXJ7aalbkCT2pX3Klgor5bazwwr2sd1lp7fZJ6GtWOmDSU0rAcQ6n7o6d9TbjVltKSab7nTeNFJV1vhteLXb6SrrrhVRxrDBBGGZiHVj7gDoDrPVzSKjSK17gulP4i7X3fT264VtpprXLR1aQQlqijdwpD+X3PUYPHrrVy+W6iFFbK7nL33al9mte67xbrNUr+0dx0V0p7XHGFqDFDjzJOGejt349zobcrSQ2spfg2jQ3+t3fvq8ybWvdLR3TbsdNQvURKGlkVWHArnoevvoUsSdUTKLbWeCrZrZdYo/CWneyVlObTBKle6wIBRs8JQcuvX1Y7apJNRHKNqRqDad6R+Dx2ENm3uW501wRzVRND9jqUFR5nmhmfPIj2IzqW9qpA/uvser78Str9hXuiorZU1NTW0EsEdPHh3LsmMH27++iTvKFCkkjl0tN7N48LHew13lWWnZbkxCf8KxgCdcnr6h7acZfJCptOjaeFFsutsfdj3K21FD9sv81XTGUL+9idRhhxPTqPfUvKHX/wBHGeIVm8QL8u67eu2Zpo5KynmtjUlTDBTTQoVLGQcg0kvTpy6atRTg0xppUek71oa2+7Au9upYfKuFfbHgjgkcAq7JjiSOn59tDtNtdw03j5HFCg3RUXDwznk2rcYDt4stwDzRs0Y8gR8l69ev8tSo7acQwotWVvE+w75v1Vu+209lgq6C4UMUdqqIq+OBOa9W89eju+egzlRpfLc2Vpva7G7j23uS4VKXiz2q42TcFPQUsFJcqOsiMcvFQJIq2Mni6gg4IHv01Tb34FHEaZt4LRuSLce/65rY5ivNsgp6R0nQLPKkJRzjOVXJ6Z9tCvJMYpJJm62Jaqym8K7VYLrEKGuitP2KdEkDeW/Fl5Ajv3zodMbpYWTV+GkO+bTZbXte72G0xU9sUQ/tYVokFTGpPErCAGVyMZJONKDd8DcY8o5UbW8Raqts1ZdbXQVdxte4/t71K3RAstNlgFijACphT1yM50qk3gINbnXg2d22luus2v4kWtKSI1G4a/7TbwKxeJQhRiQjt1Xtqt6pxQ4q6b7Hd21L+LlHS1lHQw2dKCJRIs5ao+0BQGUr93h076l3uwNKo0aLxR23XbgistdZTTNcrBckroIajMcVQoGGjLDJXI7HB66mP45JclRbFJfL5c7PLX2qGz0FvqPtZhFas8s0mCFA4jAUZPfrqoYVUOldHH2o36t3X4n2ez0dLOtXWwwNUzVfAU5enwSYx1YY7acmtxG3iza7a2Vcdl3+judheC40gskNsqqernMDl4jlZY2wQASTkH21na3bkUqvwVV8O7zR0dl+zTW+WaPcr3248pmjQc8jyouh5YB7nGdZamr55Kjm7Oh2nty5W7d+57pM1J9ku9RDLTokxZ0CJxPLoME/TXDralrBWlhna0IMRKxELgHJXrrp0FkJ5NVcq+mtzwz1ryBZplhhEMTSHLdBkL26+56a8+CakX2NoA/VWB6DpjPQ/wBderpvyYtrFktJJMQJmdgvzJzrRu8Ml1ZIV42Vo+fq6A99PahvhkjkDzHSQZHUYYflqo4WRCamSKNBJLIiqGALzHj3OB1OqUZbnRWaEftQS3qS2vFWCWOETCV42MJGcYD9uX01DTa2sVIe5YnzXaQ/IsGOqS3ZErVsJC7rzQsyYxnBA0pUsiV2V5Z1UzGKVpJo4w7xR5L4Pb05zk46fPVcqyv5F2yplr6CCtSCtphKnMRTIY5gPkynqDoWUmkFoNi/ZYXV88ihzy0SdIXPcGdQj+c8bx8l6M4I6abjSTQ7QMTRcC3mlR3JBPTPy1NqIu+RnWSMoxIT2+v1xqHJsTkjR3zcYt1xjtNNa668XE0r1f2WjC8/JUgFhy+rAAaIp3Q77oqru5aiqkjoNrXu4QwVBp6menjRvs8ojDlGUsDkZA/E6tJW3RMZN84N/BOa2kimFLLTvKiu0Uo4SR5GcN8iNOu5RYaGQOockkD1Kx6402wTAEUqoEMUihfbBPTUxUuKDcuxLRueOZCpDdgvfHscjRNO6C00ZxxIeirzHReXc6pVFZBNVZorjuRrVu6x7dqrVM5u7SpHVpMvCNo0LlWXv2GnSi/5IcsXE2dHLPWrJJU2mtoXinZUjmcEuq//ABPSccTnseulJOik+w/kQjufKOTnBwMj8e2rUWgz2IjSVl5SE8TkrwIxjHtrJy8iTxYUfLgGWpp3TsXEqlfzIOAdVFcUU32JXBBXMIXOAMj1f66OXRV0rbJ/cq6xGRFcDJQsCcfh30UkTuQIMCSBY3p1d/SF5gEnvjGcnSc0h3fcW9RWrX0dOlNFNTz8/OqPtATycLlcIer5+nbTaTygyhNlu1nvElQbbX0VY9JO1PMY5FZkkUDI7+2e/bSws2GassmrgV2jFXTF4+simcekfM9eg1KV5G+cDI6mmaSIrNAWkyIysq/vPfC/3u3tptbmkK8GU9VS1FQ9NHcKczoxLwRzozAf4lBzpxd8FK2hUNTb6iqekgulBNOmfMiFSrSKfkQDkY0k+5Dj2DrKikoIPtFxqoKaNAA0skgC/qdU6qwcihTQ7Xo1lvFFNaacVLZmrIpERZyO3Js4J/noaTlgdtPIyW80k1or5rNcbXXVdLGxKLUiREfGQsnA5XONZ2uUDTXBqNtbspLrs/b94u89Hbaq80qyrTidVDOxI4oGPJu3tnXHqbXyVup4N7TV0EsslLDUw+fAqmWE45xhuxZe4BxrglSuzaKqVF5JoY1/eyAAdAFGvS0DCbaijiPFeuuVsobLU265VFvZ7zSwSiIj97G8gVg2R8tcelJWmavEXeTV38Xu6eJe5rMu6L/Q2+ks8VZBBRVKx8JC7jIPEkD0jp769CCuTzwYtpRjjk1c24bzF4dbJ8RKy7Vzw06RyX2GNsR1MRyrOVx1YdD0+utr2pS/yNK3OFccD9yXa7U1js9TFeJaKl3NfFUz1U7ItJTMpMcYYdU54GT/AItTOTb/AAyYtu8cIZXpuigsd1tNLve3VlfLW07UVJ9rYGJGIDU32nJIMmDgntnWja+wEk1bRz266unvW0o6aqG4LfNRbrooKy33CtYyUjM6ZRZVOHQjqCTnrrL3nF/3DKs7OmrbhD42PaYbvXTW/wDs+Z0pZ6nzIlkE4UP9TjPU510J4lJkTcYQizl9pC/bhrbV9nvd1iucN7njvNUlwQU9RSqz4SMZz24AAD56zglJJo11a02747CN5bmNPUXS8WXcs0s9FuOlojNVVohaEeZGkkEcAOGTBOWbvk/LQ0lFtPuQ7xa7G6stJRf7VfEqSKtqYZlSlaIx3Bk4hoHYlQTj65xgatpK6FubjGzTWm/3Op2V4Ww3S71n2C7yGO7VrVBDzMFdkjeT+HkcDUftj2KaalKkI3pU3Kz0/iPbKG61cdpobLFX0sy1hL0dSxIMay5z2GeOffUt8jcXhrk31kRbH4nWKKjvdY9Bdduz1VelZcGnEskflFZfU3pxluoxraTVpIztuNtZs9Ms9bb7xQx1tuq6eupps+VLA/NGIOOjDprCk8lu0zxbz5Lj4Y7p3FcbnWUm8LdXVXlstSySQPHIfIiWPOOLDiMYOc6bnUfyNR/5K7Gzp7Zba/xptrXmkWK4VG0xVVUX2oqROZUzgA5Hv01Sjtu+aM93xSNZtKjs9NsvxIuFFUinmp7nc0SeGvYMiqilOobp1Xv3OnBVpun/ALBxbmlRco75To3h9Q7puQFkuG3fNE8s5WKesAjAWRwe4XkQCe+m5XKN+P4K+StR8lfcdTbrZLtSzRblmbatXV1qy3G58poXmABjiZumYwWYKScdBonOpbI8BFtp0slPclPbKLbVjoYt61V2pP7X0sYqEmMEKxSkl4I2BBdBgdeoGe+hJOmmNLn+C/v+0UVgr3p7QlHcKG22iSWosdbcpIZ1jkkZzUUkxbrIOJGD8wB31G352/8AAQi9ttnX79uN2h8GrjfNtJVis/ZKTQcoyZ0Qhc/XkFJ6/MavWy7XAo5wzjo5Nip4g+HNVtito5fOWsWd46p5GJamwDLnPFyxI64096w0HyayVbL5FTsO92+G/wBFQON6zx00lY7TUzsrho4Z+ufKYKRnt11Hxcee4SVy/sYt/hpLZaJb7ZobJt+DcdRT377JO09D5vkAxMjjtAXI6YwCNPfcrXH/AL+CdsrpMvbsNqpdotXbRqK6bb0+5KWW8mmld4BTMQJPJ9xF0HLj06nUxaV35NaaSvmjaUdstk/ixUUdhjSbbddYHW7RU5Y0olLjySvtzKlu3tjVUoukJSaz3KnhvZbgaxdoXegAg2XUymkqpF9NX5mTTsD/ABcVY8vqBpRj/oWp8m/yc3sP9g162Sa73y6xbzoLi01RboKJVrHmMjcgz8cvAQe5OANEIpySk8jaq6WDsPCSybdn3du+4pRwy11HuWaWjcs5aJGiUZTJxxJ59umdGpppP+BJtpWbHfn2ePxe8P5W5LO7V0UpHJgEMGF5YGACx6Z1SajTLtpOiv4Km10dXuu2GliprtFuGtdohTGOTyGZeBzx6qfbB1E/lgVNv8UL8Q7PPbd9UW4rJZILib9SSWK6Q+WMEsOUU75/hUggn8NXwrSBO1QPhfZrpa5UsF6twlptliamt1RGmPt5deSOg9iEYr+J+mojGSkmSlznnJy+zK+jfcPh5WUltrKCnjqq+KqpFt82aQyRthJpivJ3LHOT0GiMoyl4oTbal5Nx4dPPbd0WmipY1vVolFXJDJU0LRXKys2WZJmxxkRi2ATg6JNOpDUpWrOi8QzPBvrZ98raZ6rblK1THV8YDItNM6AQyunXKj1DljpnUtY/AKKs4betkeXbniNV2+2SvZLrV297bSpSswlmVl8+SNMZCkdyAB0OrnJOLa/A3e9JHVTQ0dB4s1tRb7c9LQy7ReNmpaFliklEpYJkDDOFx9dNbWmTJOlFlG2bamvPw/bepPJejvlno4qqjeqgMb09RBlxyyMqDgg+2DrllVYKSwm2db4dwVVwsj7juVElLcr0q1MsaHJiXjhE5e+Bk/8A/WuPWSlL8GybtNHUx0nlwryaNfly6kjW2nJkOnyBebJaLx5KXijhuMcDiSJJRng4OQ34j565dNfLJUm0sASbc28LhUXA2imeqqohDUTlDzlj9kY56jXqacVf8md9iLfbtv0tKbFR0dvWjjiKmhVwURD7FMnodXmqJbrJZultorla5LbcaKiqqF1CmnlQNHgdvT9NDV4YorbwUqba+24LK1mjsNsit5YOYFgHBmHZvxHz9tJpWU0TLt2xNapba9ht8lukYPJTNCHWRh2Zge56d851Kjm0FsSNv7fgq2mtlDbbfdvspihqIoV86FCCBgZ6qD1x21Up4f5FVrOTh7X4YVEcEVJdaDaKyREH9pUdHItZKQcl+pCq5PUkfM6Te2O0cnh80dxJtzbM81RNUbdtU01T/wC9SS0aM02OxbI6nRtuNPgiMXSyWHsVhqawVktltsk/lCHzmpU5+WBgJkDPHHTGniqLob+xbIts/Zv7Jtq27ln7IsA8oH6L2U/UaaleAbd2CLLY46B6NLXRrRufXA0IMb/iD3/PU/gLbd9yUtNuWpSqS1UYnij8uKRYV5oh/hUkdB9NU5MmQrbtrpbHQfs63EQRGR5Coj4gszZJ6dM9dU6wkNvyFU2+gnr/ALdNQUclWrA/aGp1L9Ox5Hv+OspO2AU1upDUiqaio/tZHWd4Q0hHyBOqbtACLXaYo5Io7RbxHN1kU0qBX/EY9R/HVOSqh2EbfQyUn2Wa20RpCfRA1Ohi/JCMD8tNU8MHfJk1JST0QppqSJ4Pu/Z/LVosDthSMDUrGBdzI6Kj8mGNrVTeXD0jXyV4oPoMYGqTfYnYgqqio6moiFRQUc7KMx+ZToxT8CQcabSb3DulRaLlGAMjIewz7fXU4BUVUoqCORmhoaSIs2WaOmRSSffoM9fnqnJLCHS5C+y06qYmo6Xy2wcCNTzb6jGD+Oktq5QfkasUCRJDHDHHD2MYReJHyIxjR3wCp5YajgojRMIcrxRRxwfp2x9Maqg/LFLFTwIscMaxID0WOMKufwGpYPLsPozH0np2wwxozJheAi5IVVJYn3YY/L8NPvgMEHOeDGNwejKUxgflqXkeBcqIVwyMiN3ZRjTduO0LHsuSvrLcRgh/9ToVpoEyECqOKqhX5r1Gk7uie5icVUAqXCnCsQemmt0VYGGSUKMsT+B9tTb7AgvtJlRkDdxnqcD89CbWAyYreU5MWI3JGTy6kfLSryOrCFQ3mkKXeTrjj3P0+mixh83Ur1dWxkKeoz+GocmgeTR7t25Tbg+yLXVd0hhhZsw0dY0MVQDjKzKPvr9MjWM2k7CrVF6FDTqqqnBFAVVRMAADGMDtrz7bbo2WFRepUiIPLiVznONd2kzNqzQ7quNxs1vpZqGloylRUrDLU1kuI6ZD/FxBBc/4R11joR3ZKml3KnhxumfdFsuU0sUdPLQXCSiZogypLxHRwjepcg9jr0oP434M5NKRx9XHex47Xv8AszS2Na5rBDKxruSozCQj+AdSfmdKMneBajSirH7Z8Sbndqjai/sejp5brcaq23CMlmME0AJJQ9ip+uqq2mE/g2jLx4i7hoNo7wuyWm0z1W3rmKRYmMgjmQgENgdQ3q/DUuknJoIq5JPuTfNzb/tNw29QVFBtSWe+13kQlHqAkSmLmOQPc5+Wq4kku4rTi34HUV2vf+0Caz3G22GO5rtySq+30iyM3JXI4+rrwzjpppLKY6xH8s0u0t7bhpPDPbFXcqikuV33DcfsVJI8bKkRZ2BaT+8AB0A0WntjzYpK5SXZHV2m/wB2g8RZdmXuOjq5ZaFq6hraaAxh0RuLo6ZPUHsRqdvzcRNpwUkdi7Njj5TfILjGhqgTtJgmVCPRDgg9ckdNCawOiJXc54jip/hIznRiwyhydlLEYHu2gEw3LEhg2WByCD/5GpbY6Qko0hJGC/zz11KeRcMF049Xkyf4QR21VlGGXOcMuR26dNAjFlYKwdgxb/F20WATMEVead+2BqnhADBKyqR7Z6nGdEZANZ2bkVwx7eoYOiTEQ6tluRBz04t7aSAQMCQ8gSV6gjp+WtcDDkbA5GAlgR79RrPdTAx+ZwTAMA9SrYOtE7AjKL6lJDDJ5Mckn5aLAJWDMEw3QdWIwNS5KwFnk7jicnuQPfVXQBxHuUd/rjJ0raeQGoXjQs3mHHZj1yNEWmwoGSV5HVCRgn59Mf66bBkAY8w8kKD0qWOT+Z1nLUhF02AXMhuqhQOnHlgHGol1Gkne5A8AmokIAjKqv+E9v10vrNHjcCVg8yPTIwyO51X1GlX3INpChY26iPI7Ee2pevCXDHtGBFZV5yYAH3sjQ5xFwNUISwjAc475xnVWmgoFzggAPgj2Gcj5ad2AqTzCi8SFXOcDJx9dc+tJUOKMQyBiGPIntg9ca8/h4NrssUa5YqQcAfPXdopvgib2o57eG04dzyWqpF4rrVV2qq+000sCq45Yx6lYEHXL08dsrLbM2btOLa0l1MN2uVxFxrDVyir4ZjkYYYrxAznHY9tenFva0zGSTaJrdntJuuXcVqvlXbK6po1o5+ESSq8YbkMBvutn3/lqIqu4X2ZRuPhzbPsFopbZXXCz1NoqnqqasgZXkeWTPmM/IYYtk51deAxl+TXVPhlTzWW/WmTcN7MN9qFqK2RmRnLjHVSRgZwNC+2mVatOuDbX7agutxsddPe66KWzSiamWJI+LyBeHJ8jr0+WrbbnuM6w4+QjtWmO9G3ZJcK5quSha3tThFEPkk5PbrnPvoV22+47eF4NZB4Y2WHaibalud3qqOlqftVulklVZKBwxcGMj5EnvpU8U+AXLfk2A2lBNU1ldXXS41lzq6Q0X25ZRFLHEepEfEYQk9SR303bdhwkkbu10kVvt9NboKqonWnhWMSVMvmSPj3Zu7N9TpciocBEfUY8E5z0OCdDSQ0G0WMnihIHXBPTSQ7JQKqgs7dO47artbDkJzggLzI9tc0uo0ovMgYqOZCcdEAz0PfULqNKXcTRnNGfLuCMZ7ZOdWtbT/7L/IwRI5B9SY+g1b1tNL7kKmQpXk2JC2OmCBo+o0q+5C2kqVJCtOB7Ace+h9Roef8AY6J4RqDycZ+QbpqX1GklygolGHU+kDGej9f56X1Oj5QAkoxVsHkfu5bIP460WvpvKkFMxiDI3LAYdzkYxpfUwv7hbSVm6dWAHbr/AK6r6jSX7kG1kmSJ8KzquezAk51k+t0k8yQUAwjkHENlgcdNP63Ra+5f5GCnHPR2Zc/LrrP6zQ7tDpkyMoPRSw+YGNZy9T6aKzINrDh6Z6sPVkEDAA/DU6nq/S9pD2kmdVLMykrk9eOM65tT1zp9NYVhtsxZg/EqeIx2PTH114nUev6mo6hhDUKIlyUKgn6n568fV6nU1HcpFpClCFckfy1HvslqyVUOwPlqSvQMDk6X1DQ6wSeectnHz44/XT+plYkgyzY9cYVffOq+pnfI6FjCjrkg9gxAxrWPUy7MKC89SvpHX2AGBrb63VS+5jpBt+64+Szlh1YZ1rH1TqF+8naKq5pIoORldcsB6h2+gxpS9Q1pLLLjFC6eoCyg8QBnB5e41l+o6kWaKPYv07s6EgKOvfvr1uj9Um8fgzksBxnOFPQ+wOve0XbJZLRFg2Hz16ANjGu9KNGdi0kki9DqQB2f56G4xWQGqyH1ByQ2e/trD6zprzNCoW0ihh1br+WRoXUaUsqS/wAjFSPG+QyykKfYE50fVaSxuQUHFLGyjPJCBkfTU/WaK5micoW7JIAAxjAxlT1z11lL1Hpo8zRSvuG4jBz5gVz2z93Ufq/SJZmgaEuEDFhKSp+QwCNc8vXelhw7FQDuFZXX18vbBwNYS/qHQ/amPaH5yMZPS2cdTg655f1JBfbBhtEtJKpAYtwJ6Fh115nVev6utHbwhpBSdAObSDl24j2/HXiy6iTe6x0VQJI5TnzOA7HjnP10l1MmqsY0tibqcEDo3HI0LVku4UGDGx9Lpy+fv+h1UdaXdlNE5yxLFGBHdRg5+eNU9aSJ7ANIhRgCuFPUYydJzb7gsGE4K5fj8vT76vdjkAg0RPViX+mDj8Rpb5+QMyinqS3TtnvrVa0+ExEqqSA8uIXHQYyMaylqzvkTMUQLlAyKg7YOP89WtedU2NIS3IzIOfJAPdu5+v00OchjhhugPv7dv199EZpcoDCkrAsGAI+XYa0c74QroyMjKq8g8w5wM4OknfJSdhM0idfN7HsMnOitrsMEEqqDsfYj5/XUzVhgweZNOC6KFxjPfOs9lsG0MBwSpHqbtx6j/wAND03YAEgqrBlTiDkN0bUvSfIImIOCuAOOc+n/AD1L02DkhoWMcmIYkglQScHWbTXYNwtjG6ZQN+I6dNVFOhkCPyuqliCcgZ6gfhqlkVmZY5bJUAdyPfWiiMPzIVKtKwQ9Fy4AB/8AHT2YsKsyp4NEEV3wOxVeX8tbQ07wCwVJYFZSS2BnHQYOrl0M3k0i3ZdoiYqZU5Nn35e/116vQdI48hJ2QJpRgqA59xntr1On6pLlkz02LkqJkYs3GM4yp5dx+Gsur9c09JfFme0UlXNybipIPYgf+ca+X6v1XqNe6lgtRAWtqGRkEKhu/p6k681ar78jcRQrBHL5TxMfdmLdB9NaR1ZdhbSzHPE3UdvlyOP10PUk8htBaWOOQliVz2GSdF3/APobQvPi5cSwDd+uq37RUiDMAxZT6s45ex+mhzyKhLVClnUdDnGMHA1Lm/wUoMMVMnBQCCB3Y+2nHPIqaMepZj+7iBUDGT/njVO2qG4+RfmtKSysCoGO3QH8TqPbvIUkK5ujgeoqB689Qfp89KWmwYPM8iAxDY6KMgAaT02goiR5BjjhgOrAnVrTfcKJgkcjLcVwfTxXPTTrDAbI5PAyMy8epBABbUMKQE05iPmBfSRkHIwunF4BxTF1dRLJGp5AqDkkHBbpq6bQmkSpckcsIxxn1ZOPrqPl4EiwZD5ioQhiC4yzdc6FGdjtUVxW5cpFI4dfSwGDx1asKQ4EvHyDCQZ+hxotsTQS1BUiNWQ+xHz1rDTnJ4QBiWUrxXBjPQoCO/012R6TU8BhgeZICVCsDjuW6Y1oul1W6odIND5n7zzOI9s47/jql0WtJ8CoMmQYLP3xlsfy1qvT9RcjpGSZdiUbgPco3XV/QagVQY5lOaTKB/FnVL06ZFUzGlkYeiRSc9uX9NVL09lJEyFuPLmjKf1Gpl6bKg7hq0giJDBE9wB/PWL9M1ExNWCJzFn0kr7s2stTodSPYaoxapkJw/v06AjXH7Mlyi6SFmVJJTIA2fcqO+sXGgaBPmgsrGQxv2HHSeCQGEROZEBUdRnPQ/PGqjUlRQ5SSAF8we2Vzk67dDSldlSSqwpS5Qt+8z7seg172npXC2QpUyIyrdXzj5fXVpbGqNLrB5j4x+KFx2B+zoqCz0lYKtXL/aJHXiV+XHXn9Lpe9aka6lSVnms/xI7i8vzItr2T/EWnlwP563f9Ow1Xmb/0ctiz8Su4m4+Zt2xlAPUPPkA/y1qv6Z0azNhufkTH8SO4D6U25YlU57zSdtQ/6Y0X+5g3fJKfEVfSmIrBYBJ3wGkwfzzqX/TGlF4kw3MwfEjujkEG3LLzJwTmQf11P/jGnX3MW5gVHxJbuQME29YVGeuZZGx+OrX9NaPeT/0G4VB8Rm78l3sdgKdTjLkn8Naf+N6H/ZitmTfEpuwqrLtywDHfksn/AHtNf07o3hsMi5fiP3mEHGxbdYN1yElHX8eWtV/T2h5Yc9wD8SO8ApYWfbqsWxjhJ0+vfVfoHT3yxoJfiQ3uzFFtW3BxOP8A2LYP4ddUvQumeMhXcGT4k98cP/srbmM4P/DMev8AzY1T9B6YTvyUpfiM365YfYdu5IyGWncEf9rTXoXTeBZeAF+I/fvdqOwqvHp+4Y9frk6teh9K1bQOLXckfEh4gO4KUu2gC2OX2XOB+vfQvQ+lf7RvDAl+I3fkbf8AsdtgkkKTRZb/AKtNei9J4/2FMQnxD+IKpmNrAfUfT9lbH/V31D9D6S+4NsxfiQ8Rk9KiwMMdVNF3/npL0Do8qmL5Av8AEhv2RuUg2+EPcCiQnP166F6H0ld/8j2fyYPiJ37OFb7TZFVSCmKBQPrk8uuj9D6SKyn/AJChf+8L4hyTKVrLOxGcBaADI+o5a0j6N0dcC20R/vF+IcVSoe42ZFJzgUK9/wAzql6P0q7Dp1ySfiC8RanCi42spy+8tAmcacfSOmj+0loW3xCeIMjPBFd7WOJx/wC4xfPWy6DQjwqG4dxtR4/eJYZCt+tsZIxxNAmc629jTXYWxdjJfiA8UVeOBtw0SZIClaJMH8dP2IPsXSrgmHx78USpifccDMD7UMX+eNP2IkbbyJqPHjxPB9O4qdj7hqCLp/Lvo9mI9qFr48+Kz54bmhB+7+7oowP8tV9Pb4BpEJ48+K8ijyt2lSAQf+FjA+vtqfYiuwlGNhz+O3ilhWO8myejD7LF0Hzzx0e0g2orf7bfFSSGUrvOoKKMnjTQ/wDd1T01wPavAEXjP4oDMcm9K3GTyAgjB/y1PsR8C2sx/GnxODhf7Y3AAjsFT/TSehBjUURU+MviYyIJN83NFPyVPy/h1Eui0ZP5xRNLwV4/F7xHdSBvm7Hr84yR+i6y/TdC/sRd4B/2t+JTYEe+bqwOSTyXI/QaUvTunfEUC/IJ8XvEUoYxvi8KwI6Bx1H441lD03QjnYgSTMPiz4jEhBv6+8gM488Hp8uo116fSaUP2j2rweq/CvvbdW4/EmroL/uK5XSkS3SyrFUuGAYYwwwPbVzhppNJBFUfT0EayqRJG4wcj199Zx6aMshJvk+bvjP5JcttGMpkpORzHftrj6TpowaflFwb2tM+d5EkdyzoQrDu2cD69PbXqKKXBN4FVEAUqIJDIQMF+vE/hnVCsU8fB+CxAk4wQdCwHJZbhGvDyyAwzkjBP00OmNIKREZmIJKfVclfz0UAkvOkWTKHXJIGAQQP66BMCN1YmSVcZPZehGjkTLHCRlV1lAIJIDfT5aVBZW82UkIspkT2UdMH6Z1VjqgY5naMMPVx7qFGpQmS8tXgSCT0MegK4P4jVWhkSSvHgyRofSCQw+enSasCVqkLlhFGzdAWAwVH0GpwFUeofDVYLXe933C6Xijgksdnt8lRVLKnJGJ6KGHv7n8tXtjtZlqN4SO08X6HZez9x7T8QqLadtue3q2ldJKGGPhFIzR8436g9cH+WozFpvuO5Ti13R0niNXbF2p4c2rdEfhlYqkXeONViaOMNAZIy4PLic4/LVOKXYISc07fBR3R4encHw+7dXaW0KGpvc9PSTSyU8KxzMucuSxxnI0TSaSiTCXybbD8X9q2ezbK2Sp2zbKGra6W+lrBHAvNmK+tXI75I6/PQ4rshRk8u/J3G+LCLRcIItq+CVm3LA6uZZVMcIiPLAXBBz79dOSt0kCdxts4zwIobHum+b7rK/YtogmhrYIYrfLTpIKd0Rw8anAAyy+2m8xtDk2pJXg3tu2va9y7Puzb78LrPsvygRBIoRZOBBJkDADjggd++dRGaUqaK3bX8XZqPh6vW3d6bdrKKp2HY4ZrFTwRGpMSuak4Yc2GOhIXP56prcskTcos5nwnt+3PF7xOrtx3DbNstVts1HFDHbICfKlnaR8SP069B2+g0mk6spycccnUbGvu0PFi47l2Zdtm2ukp7YGFJNDCokZBIY+YYAFTnr0OmnGsolOSlgjwNsG3bDsndFu3Lb6GqhotwS26SqqKZHkCngg9RHQeoHI+enutVXccm7tGutmyItk7A8U7HPQpN9kjaagqXgDN5LRMV4uexBGDj3Gls2txByUmpeT5hV1jUExjIILEdD9dKdrk1WSWTkrCN2BKjivuSev/AJOpz2E2ZPFP5KzNGTIvTIGAcdOv109zeAorh2NMsHpwQSRx64z7nVUqAxYmkc8VCIoyAT0AxpFdg6fC04lWPmGOCMk501gkJHLKwJZj3OR1P01MucFK2GoYk5CqQBxbPb6aaYfgT6fQpjQy9SwJ64+h02rIaYHZ8QycRjIB6n9calw8FodFIIyHk6lu6gdz89LgZioxV1C9M9Djr9dFMDIubM/DHq6EBRk/r20A7Pa/g1/d+K1UHU4W1T9h1PqTppSSoHaR9gr61DcAhx0B+Wle0jJ83/GlGWrdukAkmOck5A9176nZFNJGsOGfOqTSEqreY5HpHI5AH01pZEuCJTJ5gDS5C9/TnP66QJoBGmeVVSMcMgA4z1+WmFhTRyCUo0bRSggcT1x7d/noFeSJUqIQY/3RXGSxPX8+uixtoWxlBR2UFlx6CemihWhRV5VXipGfUp/1+mhqhhgiGQGV+WDnp0A+umlYGSoPKYq8WSfSAfUPqNFCQEcixsQka+oYZz7j6aToHwCXeSMKXCgDA69hn56aoY1o/UHMyt0xljjP4afYndQhuSHiQMhR1BGe+paYXg928Id2bO2D4O3OorJ6C8Xe61nGezmXDNB9wBz7DHI/npxfxafJnJNywbnd2+9jb78CKu1CW3beuFEM0FsZy2DEfSEOOzL0/PSkt9Zqhx3Rfk1XjNunbF68FNo2W3Xakqq6j8g1NNExLxlYCpJ6Adzq5q6yRpWrs2G6fES2UvgNYrbtbeDU25IKaliljpXxMgVTyUgjt20YpNchFO3awW/Ejf21L1sfZlLHuqnq7pSXKhnrxkiSPgvrd+mDg9/x0SSrDyOKaTtG+8RNy+G27rjTVz+M9xsLQI8bR2x3VJCTnk3p7+2irTyKG7bVGg8HN2eHmxrvvagl3w09FV1MMlBXVCMZKk+UxZ8he/Nj8tKOI1Yam51SKW3PETae6/BK57N8QNz+XeSZVgqKosWkwecMhOPn0Orik455KaancUab4Wd5bW2hDuaPct8hoftnkLAzIzCTiHBwAO3UaNPa18hakZNnO+AHiDReHm8a17oGltFwCrM0S8mQqxKOBnt1OffrpLa1bRco7na5PTbPvHwa8Oa+/bk2xfK283a78itGYmAjy5fjkgBRk5JJJ0kleGRc28nHbf8AECxVPgvvWz3i6eTuC+V8tXT06I2WLlDyB7YyD7+2pX2/Jjp2mjp6Pxt2/evAu7WLc9xeDcn7OmolUxFlqW44RsjoCR06++dWqnnuLY4vHB83rCS3NZepAHQ/PQ1RrZnFWPkmYKFH8QwQR01F/EaGeU3kAGZgY365fqw+nz7aS+WB12EuSkJElRwJP3eHXBPz0VYqyKcRCcsJWlQYzg9NaLAmTGqtKE85Acg8uOO2k+BFtIY+SDn5iNnHEEMM6iPJSYJp/JcrhyMYZSeumkxrkUVpZSI3jnjHXJjOev1B0wyTHB5kSvAWkAI6IOq475GqtAsEtlCw58lK5Jx11mBHr5kyO7hgMsRj6YOqfYBo8nio80sMEABc+/udJjR7T8ICJ/tXqBIThbVJ0B6/eXUTyqQcrB9flsY7EgAflpOJnHlniXxQ7F3VvSosn9mrSa1qVJRLmVVxkjHfTnaao1i0rTPFh4F+K3IE7aVWAAx9uix/1adtcolbH3Hf7CPFapcs23lBPbFbFgn5ZzovuDcRA8AvFOJ/MG34lAbv9uQdf10W3wJbfJZPgR4nswZ7LSuGOSXuCYz8+umk32C4ruSvgP4m8Cf2BQKP4ibjH/U6Mj3J9wv9gHiY5Aa0UAI65FfGeP6HQ77ITa8iz8PniiAM2q3sCMDNev8ATQm12BOIKfDv4nEsgoLaAOnA3Af1GhzaG3Fjl+HTxIA4m32s56dbomB+BxpbnQriL/3cvE/oBS2wMvYm4oQPpo+TDdGhn+7d4p5HKnsaITk/8eDn8gNJNsW6IB+HLxJXCGGxEL0UGv7/APZ6adtIdxGxfDd4lGTy4/2APcZuIyp+YwuqUmS5QJPw1+IoBP8A6vO/sTXYYfy1Mnke+KJh+HDxF5Kjvt9VbqVerPQ/MdNCknhlKcAh8NXiE0gUVO2lwc8lrHzn/l0nOu4nKP5LY+HDxEMaxvcNtArnr9sJJP8AyjUPXilygtPgSfhp8Rf/ANQ235hGMtVN2/TUR14Plg5Iib4Z/EQN6rhtoj2Pnuf/AJdV9TBLknfFEL8Me/xyd7rt92x7TyAY/wCXULq9NdwUkw4vhe35wEiXvbqKRgqahv6rpfW6afIXHwPX4Zt908ABve2yCf8A8Rz/AE049ZB5spOLyxY+Gfe7Bg18242B1PKQ/r00fVxT5FcfAwfDNu9iEk3JttCevTz/APunR9ZF9xRlHsho+F7eJDKdz7eAPUHErf8Ay6F1UEqsFJN4QqX4ZN0SBmG5rFzJAbisgU/lpfVx8lNpdhg+F/dEeRFuiwjPqyYpcj8NUupjLuLchifDJuhKdBLu2wuR1JEUpY/icap6sbqwHf7su4ZYjCd02NVJ5Lyp5cj+Wtt6vDHaQqT4Xdy+p/7Y2j1Lx4fZXOP56e4nDCX4Vb0mQd52dFyM5oZCf+rRuByiPj+FqtERMm9bcT/hoZCP8+mmmLevA1vhfqkCj+3luUr7fYnGB+fXUNryCmvAxfhXrZQsh3/TEluuKE4/L1aLe3DDfHwQnwqVTMRJvqDkfcW3ln/t6E6K3rwWYvhUkjcMniBwlXBUpbiuD8vvHTpPuG/8ED4WPMLlt/kSMQXIoMn/AD01/IbvwPHwsxOT52+2fI6qLeMqPYj1alq3hisyD4WYEb1b7qAp/wD6xc/9Wk7Xce78Hb+EvgnR+HW6ZL/Huma4SPStTmB6Ty19RB5Zyfl21O1vKDfeKPW5AFIzIeoz0XI0TwkTFBgI38fJsdvfVNCIUQr1ZeH0Izn/AF0ngYrkgdjwOPY9sacRGSrE6qFjQY6hiO35aTkk8jQKqgUBVD8jnt/MZ1cJJgY7gKBwBUnByAf11E9SEfuYiGVVjyIAwP8ACOmuTU6/ShwNC2eJU5qoGB932Go/UtJjSMWQKUCoWbtnI6Z99S/UtFcsXeyTURjmEPJh7Aayfq2l2DIpWHIlVIIHuDnOsZerxX2jyECwjRnjx1wOvXWP6zJdgYTOyEKwKgntnRP1ibWEHItZXRiyc3HtkDp+mud+q63YNqAklky8piCMBjqgIP8ApqJepazy2LahVM4qJ+c6t5g+9/dB+Wk+v1XncJvaWVf0nGSx+XtrL6rUl+5i3WIeVlV2MLO5bCgHP5ah9U6yVSrka7S815wyMcYIAyM6a15LuJRvuYj4csfMY/3WTGP9dJ66tAqIZ3Ylck+4yv8ATTWvgmyW5FBKA65GM476h69svvQUaSPGCI2ZAenHqPz0LqGngOCYlczFPs4EeMZ49SdX9S39pNd2KZmOFkXiQcLkEdNT9TJ9hppkq8gJVSrAEZ6cf/rpvXleVYJAyyyh8JEhx16At+gGq959kS0myQlQsnNomAZfucTnQup1IhaRPmShCpjw46hTnOpXVavNjtCGaZpW9flhh6lxk5+Q1our113ZSGsGxxLNkgflpfWa77sZkUciEGQcyBjlxGf10PrdZcNieQI1wXU5X1Z9QDdPx0fX9T2bJ2/kaI0EjgRoSf4u5Omuv6nux0MjaXkHYYUHvjpq36n1CDakY806CRVhaXI6KCOo+mrj6vrrlD24EpK3FS0bqVAyoYH/AC76mXq+reAofGJAhKR4J75Azru6b1DqJ9gGMsqsZFRQTgFlPf6a7Xr9T4EMUsSQ2ACOxwAdZPX6lcoCCRxb94pB6dV/r76uPV9QlVFWkCrJzOeTD29tZ6nU9R/1CNn/2Q==";if(image.mode()!="html5"||!image.hasCanvas())it("dummy assertion",function(){expect(!0).toBeTruthy()});else{var b,c,d,e,f;beforeEach(function(){b=jasmine.createSpy(),c=jasmine.createSpy().andCallFake(function(a,c){d=a,e=c,f=new Image,f.onload=b,f.src="data:image/jpeg;base64,"+e})}),it("resizes an image to the correct max dimension",function(){runs(function(){imageResize.resize("filename.jpg","data:image/jpeg;base64,"+a,100,c)}),waitsFor(function(){return b.callCount>0},"imgData was loaded",500),runs(function(){expect(d).toEqual("filename.jpg"),expect(f.height).toEqual(69),expect(f.width).toEqual(100)})}),it("does not resize an image smaller than max dimension",function(){runs(function(){imageResize.resize("filename.jpg","data:image/jpeg;base64,"+a,500,c)}),waitsFor(function(){return b.callCount>0},"imgData was loaded",500),runs(function(){expect(d).toEqual("filename.jpg"),expect(e).toEqual(a),expect(f.height).toEqual(232),expect(f.width).toEqual(334)})}),it("invokes callback with false if image data is invalid",function(){runs(function(){imageResize.resize("filename.jpg","data:image/jpeg;base64,xxx",500,c)}),waitsFor(function(){return c.callCount>0},"resizeCallback was called",200),runs(function(){expect(d).toEqual("filename.jpg"),expect(e).toBeFalsy()})})}})})
});
define("test/app/utils/tweet_helper_spec",["module","require","exports","app/utils/tweet_helper","app/data/user_info"],function(module, require, exports) {
var tweetHelper=require("app/utils/tweet_helper"),userInfo=require("app/data/user_info");module.exports={},describe("extractMentionsForReply",function(){afterEach(function(){userInfo.reset()}),it("if only single screenname, return array with that screenname",function(){var a=$('<div data-screen-name="user1"/>');expect(tweetHelper.extractMentionsForReply(a)).toEqual(["user1"])}),it("if mentions exists, return array of all screennames with creator first",function(){var a=$('<div data-screen-name="user1" data-mentions="user2 user3 user4"/>');expect(tweetHelper.extractMentionsForReply(a)).toEqual(["user1","user2","user3","user4"])}),it("if mentions contain creator, return array of all screennames with creator first",function(){var a=$('<div data-screen-name="user1" data-mentions="user2 user3 user1"/>');expect(tweetHelper.extractMentionsForReply(a)).toEqual(["user1","user2","user3"])}),it("if mentions contain current user, return array of all screennames without current user",function(){var a=$('<div data-screen-name="user1" data-mentions="user2 user3 user1"/>');expect(tweetHelper.extractMentionsForReply(a,"user2")).toEqual(["user1","user3"])}),it("if current user is tweet author in thread, return array of all screennames without current user",function(){var a=$('<div data-screen-name="user1" data-mentions="user2 user3 user1"/>');expect(tweetHelper.extractMentionsForReply(a,"user1")).toEqual(["user2","user3"])}),it("if current user is tweet author without thread, return array of current user",function(){var a=$('<div data-screen-name="user1" data-mentions=""/>');expect(tweetHelper.extractMentionsForReply(a,"user1")).toEqual(["user1"])}),it("if tweet is a retweet, return array of tweet author and retweeter",function(){var a=$('<div data-screen-name="user1" data-retweeter="user2" data-mentions=""/>');expect(tweetHelper.extractMentionsForReply(a)).toEqual(["user1","user2"])}),it("if tweet is a retweet with mentions, return array of tweet author, retweeter, and mentions",function(){var a=$('<div data-screen-name="user1" data-retweeter="user2" data-mentions="user3 user4"/>');expect(tweetHelper.extractMentionsForReply(a)).toEqual(["user1","user2","user3","user4"])}),it("if tweet is retweeted by current user, return just the tweet author",function(){var a=$('<div data-screen-name="user1" data-retweeter="user2" data-mentions=""/>');expect(tweetHelper.extractMentionsForReply(a,"user2")).toEqual(["user1"])})}),describe("linkify",function(){it("linkifies urls without domains",function(){expect(tweetHelper.linkify("example.com")).toMatch(/^<a.*href="http:\/\/example\.com".*>example\.com<\/a>$/)})})
});
define("test/app/utils/request_logger_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/utils/request_logger",function(){function b(a){a.forEach(function(a){$(document).trigger("ajaxSend",[{},{url:a.url,data:a.data,type:a.type}])})}function c(a,b){return{status:a,responseText:b&&JSON.stringify(b)}}function d(a,b){$(document).trigger("ajaxComplete",[b,a])}var a=[{url:"test",data:"param1=value1&param2=value2",type:"GET"},{url:"test1",data:"param3=value3&param4=value4",type:"POST"},{url:"test2",data:"param5=value5&param6=value6",type:"GET"}];beforeEach(function(){this.logger=this.Module,this.logger.initialize()}),afterEach(function(){$(document).off("ajaxSend"),$(document).off("ajaxComplete"),localStorage.clear()}),describe("#initialize",function(){it("starts logging requests",function(){b(a.slice(0,2));var c=this.logger.requests();expect(c.length).toEqual(2),expect(c[0].data).toEqual(a[0].data),expect(c[0].type).toEqual(a[0].type),expect(c[0].url).toEqual(a[0].url),expect(c[1].data).toEqual(a[1].data),expect(c[0].type).toEqual(a[0].type),expect(c[1].url).toMatch(a[1].url)}),it("does not log responses by default",function(){d(a[0],c(200)),expect(this.logger.getResponse("test1")).toBe(null)})}),describe("#stopLogging",function(){it("stops logging requests",function(){b(a.slice(0,2)),this.logger.stopLogging(),b(a.slice(2,3)),expect(this.logger.requests().length).toEqual(2)})}),describe("#clearLog",function(){it("clears previously logged requests",function(){b(a.slice(0,2)),expect(this.logger.requests().length).toEqual(2),this.logger.clearLog(),expect(this.logger.requests().length).toEqual(0)})}),describe("#startResponseLogging",function(){it("logs ajax responses",function(){this.logger.startResponseLogging(),d(a[0],c(200,{x:1})),d(a[1],c(500));var b=JSON.parse(this.logger.getResponse("test")),e=JSON.parse(this.logger.getResponse("test1"));expect(b.status).toBe(200),expect(b.responseText).toBe('{"x":1}'),expect(e.status).toBe(500)})}),describe("#stopResponseLogging",function(){beforeEach(function(){this.logger.startResponseLogging(),d(a[0],c(200)),this.logger.stopResponseLogging()}),it("stops logging ajax respsonses",function(){d(a[1],c(200)),expect(this.logger.getResponse("test1")).toBe(null)}),it("clears the response log",function(){expect(this.logger.responseLog.keys().length).toBe(0)})})})
});
define("test/app/utils/image_thumbnail_spec",["module","require","exports","app/utils/image_thumbnail"],function(module, require, exports) {
var imageThumbnail=require("app/utils/image_thumbnail");module.exports={},describe("image thumbnail utility functions",function(){describe("createThumbnail()",function(){var a=["/9j/4AAQSkZJRgABAQEASABIAAD/2wCDEAAcABwAHAAeAB4AHgAmACYAJgAm","ADIAMgAyADIAMgBEAEQARABEAEQARABaAFoAWgBaAFoAWgBaAHYAdgB2AHYA","dgB2AHYAdgDpAOkA6QDpAOkA6QDpAc8BzwHPAc8BzwHPA5sDmwObA5sDmwcz","BzMHMwczDmMOYw5jHMMcwzmD/8EACwgAEAAMAQERAP/EABYAAQEBAAAAAAAA","AAAAAAAAAAYBBP/EACAQAAIBBAEFAAAAAAAAAAAAAAEDAgAEESIFEiExUYH/","2gAIAQEAAD8A1chya0CaobMIwfQqWCnuQGSYdiSO8vH2jjEXJZIyVPqJydTT","O0yLZQMDEiIGK//Z"].join("");it("invokes a callback with the rendered image and correct dimensions",function(){var b=jasmine.createSpy();runs(function(){imageThumbnail.createThumbnail("filename.jpg",a,b)}),waitsFor(function(){return b.callCount>0},"imgData was loaded",1e3),runs(function(){var c=b.mostRecentCall.args[0],d=b.mostRecentCall.args[1],e=b.mostRecentCall.args[2],f=b.mostRecentCall.args[3];expect(c).toEqual("filename.jpg"),expect($(d).attr("src")).toEqual("data:image/jpeg;base64,"+a),expect(e).toEqual(16),expect(f).toEqual(12)})})}),describe("getThumbnailOffset()",function(){it("should return correct offset for thumbnail",function(){expect(imageThumbnail.getThumbnailOffset(100,100,80)).toEqual({position:"absolute",height:80,width:80,left:0,top:0}),expect(imageThumbnail.getThumbnailOffset(200,100,80)).toEqual({position:"absolute",height:160,width:80,left:0,top:-40}),expect(imageThumbnail.getThumbnailOffset(100,200,80)).toEqual({position:"absolute",height:80,width:160,left:-40,top:0}),expect(imageThumbnail.getThumbnailOffset(40,40,80)).toEqual({position:"absolute",height:40,width:40,left:20,top:20}),expect(imageThumbnail.getThumbnailOffset(80,40,100)).toEqual({position:"absolute",height:80,width:40,left:30,top:10}),expect(imageThumbnail.getThumbnailOffset(160,40,100)).toEqual({position:"absolute",height:160,width:40,left:30,top:-30})})})})
});
deferred('$lib/jquery_autoellipsis.js', function() {
/*! Autoellipsis (c) 2011 Peter van der Spek https://raw.github.com/pvdspek/jquery.autoellipsis/master/MIT-LICENSE.txt */(function($){function e(a,b){var c=a.data("jqae");c||(c={});var d=c.wrapperElement;d||(d=a.wrapInner("<div/>").find(">div"));var e=d.data("jqae");e||(e={});var i=e.originalContent;i?d=e.originalContent.clone(!0).data("jqae",{originalContent:i}).replaceAll(d):d.data("jqae",{originalContent:d.clone(!0)}),a.data("jqae",{wrapperElement:d,containerWidth:a.innerWidth(),containerHeight:a.innerHeight()});var j=!1,k=d;b.selector&&(k=$(d.find(b.selector).get().reverse())),k.each(function(){var c=$(this),e=c.text(),i=!1;if(d.innerHeight()-c.innerHeight()>a.innerHeight())c.remove();else{h(c);if(c.contents().length){j&&(g(c).get(0).nodeValue+=b.ellipsis,j=!1);while(d.innerHeight()>a.innerHeight()){i=f(c);if(!i){j=!0,c.remove();break}h(c);if(!c.contents().length){j=!0,c.remove();break}g(c).get(0).nodeValue+=b.ellipsis}b.setTitle=="onEllipsis"&&i||b.setTitle=="always"?c.attr("title",e):b.setTitle!="never"&&c.removeAttr("title")}}})}function f(a){var b=g(a);if(b.length){var c=b.get(0).nodeValue,d=c.lastIndexOf(" ");return d>-1?(c=$.trim(c.substring(0,d)),b.get(0).nodeValue=c):b.get(0).nodeValue="",!0}return!1}function g(a){if(a.contents().length){var b=a.contents(),c=b.eq(b.length-1);return c.filter(i).length?c:g(c)}a.append("");var b=a.contents();return b.eq(b.length-1)}function h(a){if(a.contents().length){var b=a.contents(),c=b.eq(b.length-1);if(c.filter(i).length){var d=c.get(0).nodeValue;return d=$.trim(d),d==""?(c.remove(),!0):!1}while(h(c));return c.contents().length?!1:(c.remove(),!0)}return!1}function i(){return this.nodeType===3}function j(c,d){a[c]=d,b||(b=window.setInterval(function(){l()},200))}function k(c){a[c]&&(delete a[c],a.length||b&&(window.clearInterval(b),b=undefined))}function l(){if(!c){c=!0;for(var b in a)$(b).each(function(){var c,d;c=$(this),d=c.data("jqae"),(d.containerWidth!=c.innerWidth()||d.containerHeight!=c.innerHeight())&&e(c,a[b])});c=!1}}var a={},b,c=!1,d={ellipsis:"...",setTitle:"never",live:!1};$.fn.ellipsis=function(a,b){var c,f;return c=$(this),typeof a!="string"&&(b=a,a=undefined),f=$.extend({},d,b),f.selector=a,c.each(function(){var a=$(this);e(a,f)}),f.live?j(c.selector,f):k(c.selector),this}})(jQuery)
});
define("app/utils/ellipsis",["module","require","exports","$lib/jquery_autoellipsis.js"],function(module, require, exports) {
require("$lib/jquery_autoellipsis.js");var isTextOverflowEllipsisSupported="textOverflow"in $("<div>")[0].style,isEllipsisSupported=function(a){return typeof a.forceEllipsisSupport=="boolean"?a.forceEllipsisSupport:isTextOverflowEllipsisSupported},singleLineEllipsis=function(a,b){return isEllipsisSupported(b)?!1:($(a).each(function(){var a=$(this);if(a.hasClass("ellipsify-container")){if(!b.force)return!0;var c=a.find("span.ellip-content");c.length&&a.html(c.html())}a.addClass("ellipsify-container").wrapInner($("<span>").addClass("ellip-content"));var d=a.find("span.ellip-content");if(d.width()>a.width()){var e=$('<div class="ellip">&hellip;</div>');a.append(e),d.width(a.width()-e.width()).css("margin-right",e.width())}}),!0)},multilineEllipsis=function(a,b){$(a).each(function(a,c){var d=$(c);d.ellipsis(b.multilineSelector,b.multilineOptions);var e=d.find(">div"),f=e.contents();d.append(f),e.remove()})},ellipsify=function(a,b){b=b||{};var c=b.multiline?b.multilineFunction||multilineEllipsis:b.singlelineFunction||singleLineEllipsis;return c(a,b)};module.exports=ellipsify
});
define("test/app/utils/ellipsis_spec",["module","require","exports","app/utils/ellipsis"],function(module, require, exports) {
var ellipsify=require("app/utils/ellipsis");module.exports={},describe("single line ellipsis",function(){beforeEach(function(){this.$needEllipsisFixture=$("<div>").html("This is a long text that will need ellipsis").css({width:"10px","font-size":"15px"}),this.$noNeedEllipsisFixture=$("<div>").html("Foo").css({width:"100px","font-size":"15px"}),this.$both=$().add(this.$needEllipsisFixture).add(this.$noNeedEllipsisFixture),$("body").append(this.$both)}),afterEach(function(){this.$both.detach()}),it("should ignore the request when text-overflow ellipsis is available",function(){var a=ellipsify(this.$both,{forceEllipsisSupport:!0});expect(a).toBeFalsy(),expect(this.$both).not.toBe(".ellipsify-container")}),it("should add ellipsis if text-overflow ellipsis is available",function(){var a=ellipsify(this.$both,{forceEllipsisSupport:!1});expect(a).toBeTruthy(),expect(this.$noNeedEllipsisFixture).toBe(".ellipsify-container"),expect(this.$noNeedEllipsisFixture).toContain("span.ellip-content"),expect(this.$noNeedEllipsisFixture).not.toContain("div.ellip"),expect(this.$needEllipsisFixture).toBe(".ellipsify-container"),expect(this.$needEllipsisFixture).toContain("span.ellip-content"),expect(this.$needEllipsisFixture).toContain("div.ellip")}),it("should not add double ellipsis if called more than once",function(){ellipsify(this.$both,{forceEllipsisSupport:!1}),expect(this.$needEllipsisFixture.find(".ellip-content").length).toBe(1),expect(this.$needEllipsisFixture.find(".ellip").length).toBe(1),ellipsify(this.$both,{forceEllipsisSupport:!1}),expect(this.$needEllipsisFixture.find(".ellip-content").length).toBe(1),expect(this.$needEllipsisFixture.find(".ellip").length).toBe(1)}),it("should re-ellipsify if forced",function(){ellipsify(this.$both,{forceEllipsisSupport:!1}),expect(this.$needEllipsisFixture.find(".ellip-content").length).toBe(1),expect(this.$needEllipsisFixture.find(".ellip").length).toBe(1),this.$needEllipsisFixture.find(".ellip").remove(),ellipsify(this.$both,{forceEllipsisSupport:!1,force:!0}),expect(this.$needEllipsisFixture.find(".ellip-content").length).toBe(1),expect(this.$needEllipsisFixture.find(".ellip").length).toBe(1)})}),describe("multiline ellipsis called when flag is used",function(){beforeEach(function(){this.$fixture=$("<div>"),this.fakeFunction=jasmine.createSpy(),this.options={multiline:!0,multilineFunction:this.fakeFunction,multilineOptions:{option1:1,option2:2}}}),it("should use the jquery plugin for multiline",function(){ellipsify(this.$fixture,this.options),expect(this.fakeFunction).toHaveBeenCalledWith(this.$fixture,this.options)})})
});
define("test/app/utils/time_spec",["module","require","exports","app/utils/time"],function(module, require, exports) {
var time=require("app/utils/time");module.exports={},describe("time",function(){it("returns an object with durations",function(){expect(time(5e3).seconds).toBeDefined(),expect(time(5e3).minutes).toBeDefined(),expect(time(5e3).hours).toBeDefined(),expect(time(5e3).days).toBeDefined()}),describe("Duration",function(){beforeEach(function(){this.duration=time(5).days,this.now=(new Date).getTime(),spyOn(time,"now").andReturn(this.now)}),describe("fromNow()",function(){it("returns a Date that is the duration from now",function(){expect(this.duration.fromNow()).toEqual(new Date(this.now+432e6))})}),describe("ago()",function(){it("returns a Date that is the duration in the past",function(){expect(this.duration.ago()).toEqual(new Date(this.now-432e6))})}),describe("getTime()",function(){"returns the number of ms representing the duration",!function(){expect(this.duration.getTime()).toBe(432e6)}}),describe("valueOf()",function(){it("returns the same as getTime",function(){expect(this.duration.valueOf()).toBe(this.duration.getTime())}),it("will be called to implicitly cast to a number for numeric calculations",function(){expect(this.duration+10).toBe(432e6+10)})})})})
});
define("app/utils/blend_hex_color",["module","require","exports"],function(module, require, exports) {
function hexColorToIntArray(a){if(!a)return null;var b=a.replace(THREE_GROUPS_OF_ONE_CHAR_REGEX,"$1$1$2$2$3$3");return b.match(SIX_HEX_DIGITS_REGEX)?b.match(GLOBAL_MATCH_TWO_CHARS_REGEX).map(function(a){return parseInt(a,16)}):null}function blendHexColor(a,b,c){var d=hexColorToIntArray(a),e=hexColorToIntArray(c),f=1-b;return d&&e&&d.map(function(a,c){var d=Math.floor(a*b+e[c]*f);return(d+256).toString(16).slice(1)}).join("")}var THREE_GROUPS_OF_ONE_CHAR_REGEX=/^(.)(.)(.)$/,SIX_HEX_DIGITS_REGEX=/^[0-9a-f]{6}$/i,GLOBAL_MATCH_TWO_CHARS_REGEX=/.{2}/g;module.exports=blendHexColor
});
provide("test/app/utils/blend_hex_color_spec",function(a){using("app/utils/blend_hex_color",function(a){describe("blendHexColor",function(){describe("when input colors are 3 digits",function(){it("returns correct blended colors",function(){expect(a("000",0,"fff")).toEqual("ffffff"),expect(a("000",.5,"fff")).toEqual("7f7f7f"),expect(a("000",1,"fff")).toEqual("000000"),expect(a("fff",1,"000")).toEqual("ffffff"),expect(a("FFF",1,"000")).toEqual("ffffff"),expect(a("E83",.5,"2F1")).toEqual("88c322")})}),describe("when inputs colors are 6 digits",function(){it("returns correct blended colors",function(){expect(a("000000",0,"ffffff")).toEqual("ffffff"),expect(a("000000",.5,"ffffff")).toEqual("7f7f7f"),expect(a("000000",1,"ffffff")).toEqual("000000")})}),describe("when input colors are malformed",function(){it("returns null",function(){expect(a("#000000",0,"ffffff")).toEqual(null),expect(a("g00000",.5,"ffffff")).toEqual(null),expect(a("0000000",.5,"ffffff")).toEqual(null),expect(a("",1,"ffffff")).toEqual(null),expect(a(null,1,"ffffff")).toEqual(null)})})})}),a()})
define("test/app/utils/with_event_params_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/utils/with_event_params",function(){var a;beforeEach(function(){a=jasmine.createSpy(),setupComponent()}),it("parameterizes event names with data from the component's params hash",function(){var a="",b=function(b){a=b};this.component.attr.eventParams={parameter:"Davis"},this.component.rewriteEventName(b,"miles{{parameter}}"),expect(a).toBe("milesDavis")}),it("parameterizes event names passed to #on",function(){this.component.attr.eventParams={number:"One"},this.component.on("uiTestEvent{{number}}",a),this.component.trigger("uiTestEventOne"),expect(a).toHaveBeenCalled()}),it("parameterizes event names passed to #off",function(){this.component.attr.eventParams={number:"One"},this.component.on("uiTestEventOne",a),this.component.trigger("uiTestEventOne"),expect(a.callCount).toBe(1),this.component.off("uiTestEvent{{number}}"),this.component.trigger("uiTestEventOne"),expect(a.callCount).toBe(1)}),it("parameterizes event names passed to #trigger",function(){this.component.on("uiTestEventOne",a),this.component.attr.eventParams={number:"One"},this.component.trigger("uiTestEvent{{number}}"),expect(a).toHaveBeenCalled()}),it("parameterizes event names passed to #trigger when #trigger is passed a hash to configure the event",function(){this.component.on("uiTestEventOne",a),this.component.attr.eventParams={number:"One"},this.component.trigger({type:"uiTestEvent{{number}}",defaultBehavior:function(){}}),expect(a).toHaveBeenCalled()})})
});
define("test/app/utils/oauth_popup_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/utils/oauth_popup",function(){var a;beforeEach(function(){a=this.Module}),describe("oauth popup",function(){it("opens a new window with the correct parameters",function(){spyOn(window,"open").andReturn({focus:$.noop});var b={url:"/invitations/oauth_launch?email=testemail@twitter.com",callbackUrl:"/fake_callback_url"},c=$(window),d=window.screenY||window.screenTop||0,e=window.screenX||window.screenLeft||0,f=(c.height()-500)/2+d,g=(c.width()-500)/2+e;a(b),expect(window.open).toHaveBeenCalled(),expect(window.open.mostRecentCall.args[0]).toEqual(b.url+"&callback_hash="+encodeURIComponent(b.callbackUrl)),expect(window.open.mostRecentCall.args[1]).toEqual("twitter_oauth");var h={};window.open.mostRecentCall.args[2].split(",").map(function(a,b){var c=a.split("="),d=c[0],e=c[1];h[d]=e}),expect(h.width).toEqual("500"),expect(h.height).toEqual("500"),expect(h.top).toEqual(f.toString()),expect(h.left).toEqual(g.toString()),expect(h.toolbar).toEqual("no"),expect(h.location).toEqual("yes")})})})
});
define("test/app/utils/chrome_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/utils/chrome",function(){var a;beforeEach(function(){a=this.Module}),afterEach(function(){a.globalYOffset=null}),describe("chrome.getGlobalYOffset",function(){beforeEach(function(){var a='<div class="global-nav" style="height: 1234px"></div>';setFixtures(a)}),it("returns the height of the global nav",function(){expect(a.getGlobalYOffset()).toEqual(1234)})}),describe("chrome.getCanvasYOffset",function(){beforeEach(function(){var a='<html>\n          <body>\n            <div class="global-nav" style="height: 100px">\n              <div style="height: 50px">Some stuff</div>\n              <div class="el-to-check">Find my canvas offset</div>\n            </div>\n          </body>\n        </html>\n      ';setFixtures(a)}),it("returns the Y offset of the element within the app canvas",function(){var b=$(".el-to-check");spyOn(b,"offset").andReturn({top:150,left:0}),expect(a.getCanvasYOffset(b)).toEqual(50)})})})
});
define("test/app/ui/vit/verification_step_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/vit/verification_step",function(){beforeEach(function(){var a='<div id="vit-onboarding">\n        <ul class="page-canvas verification-list">\n          <li class="verification-item active" data-step="0">\n            <div class="section-header">\n              <h2 class="title">\n              <span class="step-status" id="verification-badge">0</span>\n            </div>\n            <div class="section-footer">\n              <button class="btn primary-btn next" type="submit">Next step</button>\n            </div>\n          </li>\n          <li class="verification-item" data-step="1">\n            <div class="section-header">\n              <h2 class="title">\n              <span class="step-status" id="verification-badge">1</span>\n            </div>\n            <div class="section-footer">\n              <button class="btn primary-btn next" type="submit">Next step</button>\n            </div>\n          </li>\n          <li class="verification-item" data-step="2">\n            <div class="section-header">\n              <h2 class="title">\n              <span class="step-status" id="verification-badge">2</span>\n            </div>\n            <div class="section-footer">\n              <button class="btn primary-btn next" type="submit">Next step</button>\n            </div>\n          </li>\n          <li class="verification-item" data-step="3">\n            <div class="section-header">\n              <h2 class="title">\n              <span class="step-status" id="verification-badge">3</span>\n            </div>\n            <div class="section-footer">\n              <button class="btn primary-btn next" type="submit">Next step</button>\n            </div>\n          </li>\n        </ul>\n      </div>\n    ',b=$(a);setupComponent(b)}),it("check verification transition flow",function(){expect(this.$node.find(".active").data("step")).toBe(0),this.$node.find(".active .btn").trigger("click"),expect(window.location.hash).toBe("#step1"),this.component.hashChange(),expect(this.$node.find(".active").data("step")).toBe(1),this.$node.find(".active .btn").trigger("click"),expect(window.location.hash).toBe("#step2"),this.component.hashChange(),expect(this.$node.find(".active").data("step")).toBe(2),this.$node.find(".active .btn").trigger("click"),expect(window.location.hash).toBe("#step3"),this.component.hashChange(),expect(this.$node.find(".active").data("step")).toBe(3)}),it("should be able to save and retrieve the information about the saved step and question",function(){var a="step3",b="2";this.component.saveStepAndQuestion(a,b);var c=this.component.retrieveSavedStepAndQuestion();expect(c[0]).toBe(a),expect(c[1]).toBe(b)})})
});
define("test/app/ui/vit/mobile_topbar_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/vit/mobile_topbar",function(){beforeEach(function(){var a='<ul class="nav" id="nav">\n        <li>\n          <button class="nav-btn btn cancel skip hidden">{{_i}}Skip{{/i}}</button>\n          <button class="nav-btn btn primary-btn next">{{_i}}Next{{/i}}</button>\n        </li>\n      </ul>\n    ',b=$(a);setupComponent(b)}),it("check verification transition flow",function(){expect(this.$node.find(".skip")).toHaveClass("hidden"),expect(this.$node.find(".next")).not.toHaveClass("hidden"),this.$node.trigger("uiTopbarNextStep",{step:0,showQuestion:!1,isLastQuestion:!1}),expect(this.$node.find(".skip")).toBeHidden(),expect(this.$node.find(".next")).toBeHidden(),this.$node.trigger("uiTopbarNextStep",{step:1,showQuestion:!0,isLastQuestion:!1}),expect(this.$node.find(".skip")).toBeVisible(),expect(this.$node.find(".skip")).toHaveText("Skip"),expect(this.$node.find(".next")).toBeHidden(),this.$node.trigger("uiTopbarNextStep",{step:1,showQuestion:!1,isLastQuestion:!1}),expect(this.$node.find(".skip")).toBeVisible(),expect(this.$node.find(".skip")).toHaveText("Next"),expect(this.$node.find(".next")).toBeHidden(),this.$node.trigger("uiTopbarNextStep",{step:1,showQuestion:!1,isLastQuestion:!0}),expect(this.$node.find(".skip")).toBeHidden(),expect(this.$node.find(".next")).toBeVisible(),this.$node.trigger("uiTopbarNextStep",{step:2,showQuestion:!1,isLastQuestion:!1}),expect(this.$node.find(".skip")).toBeHidden(),expect(this.$node.find(".next")).toBeVisible(),this.$node.trigger("uiTopbarNextStep",{step:3,showQuestion:!1,isLastQuestion:!1}),expect(this.$node.find(".skip")).toBeHidden(),expect(this.$node.find(".next")).toBeVisible()})})
});
define("test/app/ui/signup/signup_form_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/signup/signup_form",function(){beforeEach(function(){var a='<form id="phx-signup-form" method="POST">\n  <fieldset class="textbox">\n    <div class="prompt name">\n      <div class="holding" data-fieldname="name">\n        <div class="sidetip">\n          <p class="ok isaok">Name looks great.</p>\n          <p class="tip">Enter your first and last name.</p>\n          <p class="blank invalid error" role="alert">A name is required!</p>\n        </div>\n        <input type="text" autocomplete="off" value="" name="user[name]" maxlength="20" aria-required="true" />\n        <span class="holder">Full name</span>\n      </div>\n    </div>\n\n    <div class="prompt email">\n      <div class="holding" data-fieldname="email">\n        <div class="sidetip">\n          <p class="tip">What’s your email address?</p>\n          <p class="ok isaok">We will email you a confirmation.</p>\n          <p class="checking">Validating...</p>\n          <p class="invalid error" role="alert">Doesn\'t look like a valid email.</p>\n          <p class="blank error" role="alert">An email is required!</p>\n          <p class="taken error" role="alert">This email is already registered. Want to <a href="">login</a> or <a href="">recover your password</a>?</p>\n        </div>\n        <input class="email-input" type="text" autocomplete="off" value="" name="user[email]" aria-required="true" />\n        <span class="holder">Email</span>\n      </div>\n    </div>\n\n    <div class="prompt password">\n      <div class="holding" data-fieldname="password">\n        <div class="sidetip">\n\n            <p class="active error"></p>\n\n          <p class="tip">6 characters or more! Be tricky.</p>\n          <p class="perfect isaok">Password is perfect!</p>\n          <p class="ok isaok">Password is okay.</p>\n          <p class="weak isaok">Password could be more secure.</p>\n          <p class="weak error" role="alert">Password is not secure enough.</p>\n          <p class="obvious error" role="alert">Password is too obvious.</p>\n          <p class="invalid error" role="alert">Password must be at least 6 characters.</p>\n          <p class="blank error" role="alert">Password cannot be blank!</p>\n        </div>\n        <input type="password" value="" name="user[user_password]" aria-required="true" />\n        <span class="holder">Password</span>\n      </div>\n\n      <div class="score"><span><b></b></span></div>\n\n    </div>\n\n    <div class="prompt username">\n      <div class="holding" data-fieldname="username">\n        <div class="sidetip">\n          <p class="ok isaok">Username is available.</p>\n          <p class="tip">Don\'t worry, you can change it later.</p>\n          <p class="checking">Validating...</p>\n          <p class="taken error" role="alert">This username is already taken!</p>\n          <p class="invalid error" role="alert">Invalid username! Alphanumerics only.</p>\n          <p class="blank error" role="alert">A username is required!</p>\n        </div>\n        <input type="text" autocomplete="off" value="" name="user[screen_name]" maxlength="15" aria-required="true" />\n        <span class="holder">Username</span>\n      </div>\n      <div class="suggestions">Suggestions:&#32;<ul>\n        <li><button class="btn-link" data-sugg-sources="sauce" data-sugg-technik="tech">fixture_user</button></li>\n      </ul></div>\n    </div>\n  </fieldset>\n\n  <fieldset class="doit">\n    <div class="sign-up-box"><input class="submit button promotional" type="submit" value="Create my account" /></div>\n    <div class="befound">\n      <p>\n        Note: Others will be able to find you by name, username or email. Your email will not be shown publicly. You can change your privacy settings at any time.\n      </p>\n      <input type="hidden" name="user[discoverable_by_email]" value="1" />\n    </div>\n    <input type="hidden" name="user[send_email_newsletter]" value="1" />\n  </fieldset>\n</form>\n    ';jasmine.Clock.useMock(),setupComponent(a),this.$inputName=this.$node.find('input[name="user[name]"]'),this.$inputEmail=this.$node.find('input[name="user[email]"]'),this.$inputPassword=this.$node.find('input[name="user[user_password]"]'),this.$inputUsername=this.$node.find('input[name="user[screen_name]"]')}),describe("uiSwiftLoaded",function(){it("focuses the first field",function(){$(document).trigger("uiSwiftLoaded"),expect(this.$inputName).toBeFocused()})}),describe("password score",function(){it("displays the password score",function(){this.component.$score.hide(),expect(this.component.$score).not.toBeVisible(),this.component.trigger("dataPasswordStrength",10),jasmine.Clock.tick(100),expect(this.component.$score).toBeVisible(),expect(this.component.$score.find("b")).toHaveCss("width","5px")})}),describe("uiSignupValidationFail",function(){it("focuses first field with validation error",function(){this.$inputPassword.focus(),$(document).trigger("uiSignupValidationFail"),expect(this.$inputName).toBeFocused()})})})
});
define("test/app/ui/signup/with_captcha_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/signup/with_captcha",function(){beforeEach(function(){var a='<form class="validated captcha-tryagain">\n      <fieldset class="textbox">\n      </fieldset>\n      <div id="captcha" class="captcha-container">\n        <h6>Are you human?</h6>\n        <div class="embed">\n          <noscript>\n            <p>You will need to enable JavaScript to answer the CAPTCHA and complete signup.</p>\n          </noscript>\n        </div>\n      </div>\n    </form>\n    ';jasmine.Clock.useMock(),setupComponent(a,{environment:"production",captchaAvailable:!0,recaptcha:{srcUrl:"",publicKey:"public-key-dummy"}})}),describe("initialize",function(){it("binds to form submit",function(){expect(this.$node).toHandleWith("submit",this.component.checkCaptcha)}),it("hides the fields if try-again",function(){expect(this.$node.find("fieldset")).not.toBeVisible()})}),describe("checkCaptcha",function(){it("does nothing if not validated",function(){expect(this.component.checkCaptcha()).toBeFalsy()}),it("hides if already submitting",function(){this.$node.addClass("captcha-active"),expect(this.$node.find(".captcha-container")).toBeVisible(),this.component.validated=function(){return!0},expect(this.component.checkCaptcha()).toBeFalsy(),expect(this.$node.find(".captcha-container")).not.toBeVisible()}),it("calls Recaptcha.create with appropriate args",function(){window.Recaptcha={create:function(){}};var a=spyOn(Recaptcha,"create");expect(this.$node.find(".captcha-container")).toBeVisible(),this.component.validated=function(){return!0},expect(this.component.checkCaptcha()).toBeFalsy(),expect(a).toHaveBeenCalledWith("public-key-dummy",this.$node.find("div.embed")[0],{lang:"en",theme:"white",callback:undefined}),expect(this.$node).toBe(".captcha-active")}),it("triggers uiCaptchaShown",function(){window.Recaptcha={create:function(){}},this.component.validated=function(){return!0},spyOnEvent(this.$node,"uiCaptchaShown"),this.component.checkCaptcha(),expect("uiCaptchaShown").toHaveBeenTriggeredOn(this.$node)}),it("sets submitting",function(){window.Recaptcha={create:function(){}},this.component.validated=function(){return!0};var a=spyOn(this.component,"setSubmitting");this.component.checkCaptcha(),expect(a).toHaveBeenCalledWith(!1)})})})
});
define("test/app/ui/signup/with_signup_validation_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/signup/with_signup_validation",function(){var a='<form id="phx-signup-form" method="POST">\n  <fieldset class="textbox">\n  <div class="prompt name">\n  <div class="holding" data-fieldname="name">\n  <div class="sidetip">\n  <p class="ok isaok">Name looks great.</p>\n  <p class="tip">Enter your first and last name.</p>\n  <p class="blank invalid error" role="alert">A name is required!</p>\n  </div>\n  <input type="text" autocomplete="off" value="" name="user[name]" maxlength="20" aria-required="true" />\n  <span class="holder">Full name</span>\n  </div>\n  </div>\n\n  <div class="prompt email">\n  <div class="holding" data-fieldname="email">\n  <div class="sidetip">\n  <p class="tip">What’s your email address?</p>\n  <p class="ok isaok">We will email you a confirmation.</p>\n  <p class="checking">Validating...</p>\n  <p class="invalid error" role="alert">Doesn\'t look like a valid email.</p>\n  <p class="blank error" role="alert">An email is required!</p>\n  <p class="taken error" role="alert">This email is already registered. Want to <a href="">login</a> or <a href="">recover your password</a>?</p>\n  </div>\n  <input class="email-input" type="text" autocomplete="off" value="" name="user[email]" aria-required="true" />\n  <span class="holder">Email</span>\n  </div>\n  </div>\n\n  <!-- confirm_signup_fields_538 -->\n  <div class="prompt confirm-email">\n  <div class="holding" data-fieldname="confirm-email">\n  <div class="sidetip">\n  <p class="tip">Retype your email address.</p>\n  <p class="match isaok">Email addresses match!</p>\n  <p class="no-match error" role="alert">Email addresses don\'t match. Try again!</p>\n  </div>\n  <input type="text" value="" name="user[confirm_email]" aria-required="true">\n  <span class="holder">Confirm email address</span>\n  </div>\n  </div>\n\n  <div class="prompt password">\n  <div class="holding" data-fieldname="password">\n  <div class="sidetip">\n\n  <p class="active error"></p>\n\n  <p class="tip">6 characters or more! Be tricky.</p>\n  <p class="perfect isaok">Password is perfect!</p>\n  <p class="ok isaok">Password is okay.</p>\n  <p class="weak isaok">Password could be more secure.</p>\n  <p class="weak error" role="alert">Password is not secure enough.</p>\n  <p class="obvious error" role="alert">Password is too obvious.</p>\n  <p class="invalid error" role="alert">Password must be at least 6 characters.</p>\n  <p class="blank error" role="alert">Password cannot be blank!</p>\n  </div>\n  <input type="password" value="" name="user[user_password]" aria-required="true" />\n  <span class="holder">Password</span>\n  </div>\n\n  <div class="score"><span><b></b></span></div>\n\n  </div>\n\n  <!-- confirm_signup_fields_538 -->\n  <div class="prompt confirm-password">\n  <div class="holding" data-fieldname="confirm-password">\n  <div class="sidetip">\n  <p class="tip">Retype your password.</p>\n  <p class="match isaok">Passwords match!</p>\n  <p class="no-match error" role="alert">Passwords don\'t match. Try again!</p>\n  </div>\n  <input type="password" value="" name="user[user_confirm_password]" aria-required="true">\n  <span class="holder">Confirm password</span>\n  </div>\n  </div>\n\n  <div class="prompt username">\n  <div class="holding" data-fieldname="username">\n  <div class="sidetip">\n  <p class="ok isaok">Username is available.</p>\n  <p class="tip">Don\'t worry, you can change it later.</p>\n  <p class="checking">Validating...</p>\n  <p class="taken error" role="alert">This username is already taken!</p>\n  <p class="invalid error" role="alert">Invalid username! Alphanumerics only.</p>\n  <p class="blank error" role="alert">A username is required!</p>\n  </div>\n  <input type="text" autocomplete="off" value="" name="user[screen_name]" maxlength="15" aria-required="true" />\n  <span class="holder">Username</span>\n  </div>\n  <div class="suggestions">Suggestions:&#32;<ul>\n  <li><button class="btn-link" data-sugg-sources="sauce" data-sugg-technik="tech">fixture_user</button></li>\n  </ul></div>\n  </div>\n  </fieldset>\n\n  <fieldset class="doit">\n  <div class="sign-up-box"><input class="submit button promotional" type="submit" value="Create my account" /></div>\n  <div class="befound">\n  <p>\n  Note: Others will be able to find you by name, username or email. Your email will not be shown publicly. You can change your privacy settings at any time.\n  </p>\n  <input type="hidden" name="user[discoverable_by_email]" value="1" />\n  </div>\n  <input type="hidden" name="user[send_email_newsletter]" value="1" />\n  </fieldset>\n  </form>\n  ';describe("under normal conditions (no device signup)",function(){beforeEach(function(){jasmine.Clock.useMock(),setupComponent(a,{forceConfirmPasswordField:!0,forceConfirmEmailField:!0}),this.$inputName=this.$node.find('input[name="user[name]"]'),this.$inputEmail=this.$node.find('input[name="user[email]"]'),this.$inputConfirmEmail=this.$node.find('input[name="user[confirm_email]"]'),this.$inputPassword=this.$node.find('input[name="user[user_password]"]'),this.$inputConfirmPassword=this.$node.find('input[name="user[user_confirm_password]"]'),this.$inputUsername=this.$node.find('input[name="user[screen_name]"]'),this.fillEmailField=function(){this.$inputEmail.focus(),this.$inputEmail.val("penguins"),this.$inputEmail.keydown(),jasmine.Clock.tick(1)}.bind(this)}),describe("initialize",function(){it("sets a clock",function(){spyOnEvent(document,"uiCheckAllFields"),spyOnEvent(this.$inputName,"uiInputFieldChanged"),spyOnEvent(this.$inputEmail,"uiInputFieldChanged"),spyOnEvent(this.$inputPassword,"uiInputFieldChanged"),spyOnEvent(this.$inputUsername,"uiInputFieldChanged"),jasmine.Clock.tick(5e3),expect("uiCheckAllFields").toHaveBeenTriggeredOn(document),expect("uiInputFieldChanged").toHaveBeenTriggeredOn(this.$inputName),expect("uiInputFieldChanged").toHaveBeenTriggeredOn(this.$inputEmail),expect("uiInputFieldChanged").toHaveBeenTriggeredOn(this.$inputPassword),expect("uiInputFieldChanged").toHaveBeenTriggeredOn(this.$inputUsername)})}),describe("showTip",function(){it("starts with the tip at 'tip'",function(){this.$node.find(".name input").trigger("uiShowTip","tip"),expect(this.$node.find(".name .sidetip .tip")).toBe(".active")}),it("sets the tip to 'ok'",function(){this.$node.find(".name input").trigger("uiShowTip","ok"),expect(this.$node.find(".name .sidetip .tip")).not.toBe(".active"),expect(this.$node.find(".name .sidetip .ok")).toBe(".active")})}),describe("suggestions",function(){it("starts with blank username",function(){expect(this.$inputUsername).toBeEmpty()}),it("sets the username",function(){spyOnEvent(document,"uiValidated"),expect(this.$node.find(".username .sidetip .ok")).not.toBe(".active"),this.component.$node.find(".suggestions button").click(),expect(this.$node.find(".username .sidetip .ok")).toBe(".active"),expect(this.$inputUsername).toHaveValue("fixture_user"),expect("uiValidated").toHaveBeenTriggeredOn(document)})}),describe("confirm email field",function(){it("revalidates when email is changed",function(){spyOnEvent(this.$inputConfirmEmail,"uiInputFieldChanged"),this.$inputEmail.trigger("uiInputFieldChanged"),expect("uiInputFieldChanged").toHaveBeenTriggeredOn(this.$inputConfirmEmail)})}),describe("confirm password field",function(){it("revalidates when password is changed",function(){spyOnEvent(this.$inputConfirmPassword,"uiInputFieldChanged"),this.$inputPassword.trigger("uiInputFieldChanged"),expect("uiInputFieldChanged").toHaveBeenTriggeredOn(this.$inputConfirmPassword)})}),describe("input field events",function(){it("shows the tip when focused",function(){this.$inputName.focus(),expect(this.$inputName).toBeFocused(),expect(this.$node.find(".email .sidetip .tip")).not.toBe(".active"),expect(this.$inputEmail).toBeEmpty(),this.$inputEmail.focus(),expect(this.$node.find(".email .sidetip .tip")).toBe(".active"),expect(this.$inputEmail).toBeFocused(),expect(this.$inputEmail).toBe(".focused")}),it("validates on keydown",function(){spyOnEvent(this.$inputEmail,"uiFieldTouched"),spyOnEvent(this.$inputEmail,"uiInputFieldChanged"),this.$inputEmail.focus(),this.$inputEmail.val("penguins"),this.$inputEmail.keydown(),jasmine.Clock.tick(1),expect("uiFieldTouched").toHaveBeenTriggeredOn(this.$inputEmail),expect("uiInputFieldChanged").toHaveBeenTriggeredOn(this.$inputEmail),expect(this.$inputEmail).toBeFocused()}),it("validates on blur",function(){spyOnEvent(this.$inputEmail,"uiInputFieldChanged"),this.$inputEmail.focus(),this.$inputEmail.val("penguins"),this.$inputEmail.blur(),expect("uiInputFieldChanged").toHaveBeenTriggeredOn(this.$inputEmail),expect(this.$inputEmail).not.toBeFocused(),expect(this.$inputEmail).not.toBe(".focused")})}),describe("uiInputFieldChanged",function(){it("does not validate if value is unchanged",function(){var a=spyOn(this.component,"validate");this.$inputEmail.trigger("uiInputFieldChanged"),expect(a.calls.length).toEqual(1)}),it("validates if the value changes",function(){var a=spyOn(this.component,"validate");this.$inputEmail.val("penguins"),this.$inputEmail.trigger("uiInputFieldChanged"),expect(a).toHaveBeenCalledWith(this.$inputEmail,"user[email]","penguins",!0),jasmine.Clock.tick(750),expect(a).toHaveBeenCalledWith(this.$inputEmail,"user[email]","penguins")}),it("validates if forced",function(){var a=spyOn(this.component,"validate");this.$inputEmail.trigger("uiInputFieldChanged",{forceValidate:!0}),expect(a).toHaveBeenCalledWith(this.$inputEmail,"user[email]","")})}),describe("dataUsernameResult",function(){it("triggers uiValidated",function(){spyOnEvent(this.component.$node,"uiValidated"),$(document).trigger("dataUsernameResult",{valid:!0,sourceEventData:{custom:!0}}),expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.component.$node,{field:"username",quick:!1,valid:!0}),$(document).trigger("dataUsernameResult",{valid:!1,sourceEventData:{custom:!0}}),expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.component.$node,{field:"username",quick:!1,valid:!1})}),it("sets the tip",function(){$(document).trigger("dataUsernameResult",{valid:!0,sourceEventData:{custom:!0}}),expect(this.$node.find(".username .sidetip .ok")).toBe(".active"),$(document).trigger("dataUsernameResult",{valid:!1,sourceEventData:{custom:!0},reason:"improper_format"}),expect(this.$node.find(".username .sidetip .invalid")).toBe(".active"),$(document).trigger("dataUsernameResult",{valid:!1,sourceEventData:{custom:!0},reason:"blank"}),expect(this.$node.find(".username .sidetip .blank")).toBe(".active"),$(document).trigger("dataUsernameResult",{valid:!1,taken:!0,sourceEventData:{custom:!0}}),expect(this.$node.find(".username .sidetip .taken")).toBe(".active")})}),describe("dataEmailResult",function(){it("triggers uiValidated",function(){spyOnEvent(this.component.$node,"uiValidated"),$(document).trigger("dataEmailResult",{valid:!0}),expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.component.$node,{field:"email",quick:!1,valid:!0}),$(document).trigger("dataEmailResult",{valid:!1}),expect("uiValidated").toHaveBeenTriggeredOnAndWith(this.component.$node,{field:"email",quick:!1,valid:!1})}),it("sets the tip",function(){$(document).trigger("dataEmailResult",{valid:!0}),expect(this.$node.find(".email .sidetip .ok")).toBe(".active"),$(document).trigger("dataEmailResult",{valid:!1,taken:!0}),expect(this.$node.find(".email .sidetip .taken")).toBe(".active")})}),describe("form",function(){it("cancels if the form doesn't validate",function(){expect(this.component.formSubmit()).toBe(!1)}),it("submits if the form validates",function(){this.component.trigger("uiValidated",{field:"name",quick:!1,valid:!0}),this.component.trigger("uiValidated",{field:"email",quick:!1,valid:!0}),this.component.trigger("uiValidated",{field:"confirmEmail",quick:!1,valid:!0}),this.component.trigger("uiValidated",{field:"password",quick:!1,valid:!0}),this.component.trigger("uiValidated",{field:"confirmPassword",quick:!1,valid:!0}),this.component.trigger("uiValidated",{field:"username",quick:!1,valid:!0});var a=jasmine.createSpy().andCallFake(function(a){a.preventDefault()});$("form").on("submit",a),this.component.trigger("submit"),expect(this.component.$node).toBe(".submitting"),expect(this.component.$submit).toBeDisabled()}),it("submits if validation is disabled",function(){this.component.trigger("uiDisableSignupValidation");var a=jasmine.createSpy().andCallFake(function(a){a.preventDefault()});$("form").on("submit",a),this.component.trigger("submit"),expect(this.component.$node).toBe(".submitting"),expect(this.component.$submit).toBeDisabled()})}),describe("uiDisableSignupValidation",function(){it("disables validation on fields",function(){spyOnEvent(document,"uiSignupValidate"),$(document).trigger("uiDisableSignupValidation"),this.fillEmailField(),expect("uiSignupValidate").not.toHaveBeenTriggeredOn(document),expect(this.component.$node).toBe(".validation-disabled")})}),describe("uiEnableSignupValidation",function(){it("enables validation on fields",function(){spyOnEvent(document,"uiSignupValidate"),$(document).trigger("uiDisableSignupValidation"),$(document).trigger("uiEnableSignupValidation"),this.fillEmailField(),expect("uiSignupValidate").toHaveBeenTriggeredOn(document),expect(this.component.$node).not.toBe(".validation-disabled")})})}),describe("with isDeviceCompletion on",function(){beforeEach(function(){setupComponent(a,{isDeviceCompletion:!0}),this.$inputUsername=this.$node.find('input[name="user[screen_name]"]')}),it("disables the username field",function(){expect(this.$inputUsername).toBeDisabled()}),it("sets username as valid",function(){expect(this.component.fields.username).toBe(!0)})})})
});
define("test/app/ui/signup/stream_end_signup_module_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/signup/stream_end_signup_module",function(){beforeEach(setupComponent),describe("on click",function(){it("triggers uiSignupButtonClicked",function(){spyOnEvent(this.$node,"uiSignupButtonClicked"),this.$node.click(),expect("uiSignupButtonClicked").toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/signup/suggestions_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/signup/suggestions",function(){beforeEach(function(){var a='<div class="suggestions">Suggestions:&#32;<ul>\n        <li></li>\n      </ul></div>\n    ';jasmine.Clock.useMock(),setupComponent(a)}),describe("dataUsernameResult",function(){it("displays the suggestions",function(){$(document).trigger("dataUsernameResult",{suggestions:[{sources:["astral","earthly"],technique:"psychic",suggestion:"bob1234"},{sources:["astral","earthly"],technique:"psychic",suggestion:"ted1234"},{sources:["astral","earthly"],technique:"psychic",suggestion:"fred1234"}]}),expect(this.component.$node).toHaveHtml('Suggestions: <ul><li><button class="btn-link" data-sugg-sources="astral,earthly" data-sugg-technik="psychic">bob1234</button></li>\n<li><button class="btn-link" data-sugg-sources="astral,earthly" data-sugg-technik="psychic">ted1234</button></li>\n<li><button class="btn-link" data-sugg-sources="astral,earthly" data-sugg-technik="psychic">fred1234</button></li></ul>')})})})
});
define("test/app/ui/banners/eu_cookie_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/banners/eu_cookie",function(){beforeEach(function(){var a='<div class="module module-banner eu-cookie-notice"><div class="flex-module"><div class="first-banner-row"><span class="title">By using Twitter you are agreeing to our use of cookies.</span><a href="https://support.twitter.com/articles/20170514">Learn more</a><button type="button"><span class="icon close-medium"><span class="visuallyhidden">Close</span></span></button></div></div></div>';document.cookie="eu_cn=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",jasmine.Clock.useMock(),setupComponent(a)}),describe("click close",function(){it("removes the banner",function(){spyOn(this.component,"teardown"),expect(document.cookie).not.toMatch("eu_cn=1"),this.$node.find("button").trigger("click"),expect(document.cookie).toMatch("eu_cn=1"),expect(this.component.teardown).toHaveBeenCalled(),expect(this.component.$node.parents("body").length).toEqual(0)})}),describe("after five seconds",function(){it("sets a cookie",function(){expect(document.cookie).not.toMatch("eu_cn=1"),jasmine.Clock.tick(5e3),expect(document.cookie).toMatch("eu_cn=1")})})})
});
define("test/app/ui/banners/email_banner_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/banners/email_banner",function(){beforeEach(function(){var a='<div><a href="#" class="resend-confirmation-email-link">Resend confirmation</a><a href="#" class="reset-bounce-link">try sending a message again</a></div>';setupComponent(a)}),describe("click resendConfirmationEmailLinkSelector",function(){it("fires event uiResendConfirmationEmail",function(){spyOnEvent(document,"uiResendConfirmationEmail"),this.component.select("resendConfirmationEmailLinkSelector").trigger("click"),expect("uiResendConfirmationEmail").toHaveBeenTriggeredOn(document)})}),describe("click resetBounceLinkSelector",function(){it("fires event uiResetBounceLink",function(){spyOnEvent(document,"uiResetBounceLink"),this.component.select("resetBounceLinkSelector").trigger("click"),expect("uiResetBounceLink").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/trends/trends_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/trends/trends_dialog",{fixture:"test/fixtures/trends_api"},function(){beforeEach(function(){var a=$('      <div>        <div class="trends-dialog-error"><p></p></div>        <div id="trends_dialog_content"><div class="loading"></div></div>      </div>    ');this.setupComponent(a)}),describe("event uiShowTrendsLocationDialog",function(){beforeEach(function(){spyOn(this.component,"open"),spyOn(this.component,"selectActiveView"),spyOnEvent(document,"uiWantsTrendsDialog"),spyOnEvent(this.$node,"uiTrendsDialogOpened")}),it("opens the dialog",function(){$(document).trigger("uiShowTrendsLocationDialog"),expect(this.component.open).toHaveBeenCalled()}),it("triggers uiWantsTrendsDialog when there is no content",function(){$(document).trigger("uiShowTrendsLocationDialog"),expect("uiWantsTrendsDialog").toHaveBeenTriggeredOn(document),expect(this.component.selectActiveView).not.toHaveBeenCalled()}),it("triggers uiWantsTrendsDialog when there is an error",function(){this.component.$node.find(".loading").remove(),$(document).trigger("dataGotTrendsDialogError",{message:"Falafel"}),$(document).trigger("uiShowTrendsLocationDialog"),expect("uiWantsTrendsDialog").toHaveBeenTriggeredOn(document),expect(this.component.selectActiveView).not.toHaveBeenCalled()}),it("does not trigger uiWantsTrendsDialog when there is content",function(){this.component.$node.find(".loading").remove(),$(document).trigger("uiShowTrendsLocationDialog"),expect(this.component.selectActiveView).toHaveBeenCalled(),expect("uiWantsTrendsDialog").not.toHaveBeenTriggeredOn(document)}),it("triggers uiTrendsDialogOpened",function(){$(document).trigger("uiShowTrendsLocationDialog"),expect("uiTrendsDialogOpened").toHaveBeenTriggeredOn(this.$node)})}),describe("event dataGotTrendsDialog",function(){it("sets the dialog content",function(){$(document).trigger("dataGotTrendsDialog",this.fixture),expect(this.$node).toContain(".js-trend-link[data-woeid=2487956]"),expect(this.$node).toContain(".js-trend-link[data-woeid=2442047]")}),it("selects the current location element",function(){$(document).trigger("dataGotTrendsDialog",this.fixture),expect(this.$node).toContain(".js-trend-link[data-woeid=2487956].selected"),expect(this.$node).not.toContain(".js-trend-link[data-woeid=2442047].selected")})}),describe("event dataGotTrendsDialogError",function(){it("displays the error message",function(){$(document).trigger("dataGotTrendsDialogError",{message:"Falafel"}),expect(this.$node).toHaveClass("has-error"),expect(this.component.$node.find(".trends-dialog-error p").text()).toBe("Falafel")})}),describe("click on location element",function(){beforeEach(function(){this.component.trigger("dataGotTrendsDialog",this.fixture)}),describe("already selected element",function(){it("maintains the current selected element",function(){this.$node.find(".selected").click(),expect(this.$node).toContain(".js-trend-link[data-woeid=2487956].selected"),expect(this.$node).not.toContain(".js-trend-link[data-woeid=2442047].selected")}),it("does not trigger uiChangeTrendsLocation",function(){spyOnEvent(this.$node,"uiChangeTrendsLocation"),this.$node.find(".selected").click(),expect("uiChangeTrendsLocation").not.toHaveBeenTriggeredOn(this.$node)})}),describe("not currently selected element",function(){it("changes selected item",function(){this.$node.find(".js-trend-link[data-woeid=2442047]").click(),expect(this.$node).not.toContain(".js-trend-link[data-woeid=2487956].selected"),expect(this.$node).toContain(".js-trend-link[data-woeid=2442047].selected")}),it("triggers uiChangeTrendsLocation",function(){spyOnEvent(this.$node,"uiChangeTrendsLocation"),this.$node.find(".js-trend-link[data-woeid=2442047]").click(),expect("uiChangeTrendsLocation").toHaveBeenTriggeredOnAndWith(this.$node,{woeid:2442047})})})}),describe("personalized_trends decidered on (logged out)",function(){beforeEach(function(){var a='<div id="trends_dialog" style="display: none;" class="trends-dialog modal-container">\n  <div class="close-modal-background-target"></div>\n  <div class="modal draggable">\n    <div class="modal-content">\n      <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n      <div class="modal-header">\n        <h3 class="modal-title">\n          Trends\n          </h3>\n      </div>\n\n      <div class="modal-body">\n\n\n        <div class="trends-personalized content-placeholder">\n          <h2 class="title">Trends tailored just for you.</h2>\n          <p>Trends offer a unique way to get closer to what you care about. Trends are tailored for you based on your location and who you follow.</p>\n          <p class="placeholder-actions">\n            <button type="button" class="btn customize-by-location">Change</button>\n            <button type="button" class="btn primary-btn done">Keep tailored Trends</button>\n          </p>\n        </div>\n\n        <div class="trends-wrapper" id="trends_dialog_content">\n\n        </div>\n      </div>\n\n      <div class="modal-footer trends-by-location">\n        <button type="button" class="btn select-default">Get Worldwide Trends</button>\n        <button type="button" class="btn primary-btn done">Done</button>\n      </div>\n\n    </div>\n  </div>\n</div>\n      ';setupComponent($(a),{deciderPersonalizedTrends:!0}),this.component.trigger("dataGotTrendsDialog",this.fixture),this.component.trigger("uiShowTrendsLocationDialog")}),describe("click on User Worldwide trends button",function(){it("fires uiChangeTrendsLocation location to set to Worldwide",function(){spyOnEvent(this.$node,"uiChangeTrendsLocation"),this.$node.find(".select-default").click(),expect("uiChangeTrendsLocation").toHaveBeenTriggeredOnAndWith(this.$node,{woeid:1})})})}),describe("personalized_trends decidered on",function(){beforeEach(function(){var a='<div id="trends_dialog" style="display: none;" class="trends-dialog modal-container">\n  <div class="close-modal-background-target"></div>\n  <div class="modal draggable">\n    <div class="modal-content">\n      <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n      <div class="modal-header">\n        <h3 class="modal-title">\n          Trends\n          </h3>\n      </div>\n\n      <div class="modal-body">\n\n\n        <div class="trends-personalized content-placeholder">\n          <h2 class="title">Trends tailored just for you.</h2>\n          <p>Trends offer a unique way to get closer to what you care about. Trends are tailored for you based on your location and who you follow.</p>\n          <p class="placeholder-actions">\n            <button type="button" class="btn customize-by-location">Change</button>\n            <button type="button" class="btn primary-btn done" id="keep-tailored-button">Keep tailored Trends</button>\n          </p>\n        </div>\n\n        <div class="trends-wrapper" id="trends_dialog_content">\n\n        </div>\n      </div>\n\n      <div class="modal-footer trends-by-location">\n        <button type="button" class="btn select-default" data-personalized="true">Get tailored Trends</button>\n        <button type="button" class="btn primary-btn done" id="done-button">Done</button>\n      </div>\n\n    </div>\n  </div>\n</div>\n      ';setupComponent($(a),{deciderPersonalizedTrends:!0}),this.component.trigger("dataGotTrendsDialog",this.fixture),this.component.trigger("uiShowTrendsLocationDialog")}),it("opens with the locations view",function(){expect(this.$node.find(".trends-personalized")).toBeHidden(),expect(this.$node.find(".trends-by-location")).toBeVisible(),expect(this.$node.find(".modal-header h3").text().trim()).toBe("Trends")}),it("sets focus within the dialog",function(){expect($("#done-button")).toBeFocused()}),describe("click on Done button",function(){it("closes the dialog",function(){this.$node.find(".modal-footer .btn.done").click(),expect(this.$node).toBeHidden()})}),describe("click on User personalized trends button",function(){it("fires uiChangeTrendsLocation location",function(){spyOnEvent(this.$node,"uiChangeTrendsLocation"),this.$node.find(".select-default").click(),expect("uiChangeTrendsLocation").toHaveBeenTriggeredOnAndWith(this.$node,{personalized:!0})})}),describe("user with personalized trends",function(){beforeEach(function(){var a=$.merge({personalized:!0},this.fixture);this.component.trigger("dataGotTrendsDialog",a),this.component.trigger("uiShowTrendsLocationDialog")}),it("opens with the personalized trends view",function(){expect(this.$node.find(".trends-personalized")).toBeVisible(),expect(this.$node.find(".trends-by-location")).toBeHidden(),expect(this.$node.find(".modal-header h3").text().trim()).toBe("Trends")}),it("shows locations view on Change location click",function(){this.$node.find(".customize-by-location").click(),expect(this.$node.find(".trends-personalized")).toBeHidden(),expect(this.$node.find(".trends-by-location")).toBeVisible(),expect(this.$node.find(".modal-header h3").text().trim()).toBe("Trends")}),it("sets focus within the dialog",function(){expect($("#keep-tailored-button")).toBeFocused()}),it("closes on Back to Twitter click",function(){this.$node.find(".trends-personalized .btn.done").click(),expect(this.$node).toBeHidden()})})})})
});
define("test/app/ui/trends/trends_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/trends/trends",{fixture:"test/fixtures/trends_api"},function(){var a=[{name:"#ts3",promotedTrendId:1,trendingEvent:!1},{name:"Trend D",promotedTrendId:undefined,trendingEvent:!1},{name:"Trend E",promotedTrendId:undefined,trendingEvent:!1}];beforeEach(function(){var a='<div class="module trends hidden">\n        <div class="flex-module trends-inner">\n        </div>\n      </div>\n    ';this.setupComponent(a)}),describe("event dataTrendsRefreshed",function(){it("updates the ui with given html",function(){expect(this.$node).not.toContain(".js-trend-location"),this.component.trigger("dataTrendsRefreshed",this.fixture),expect(this.$node).toContain(".js-trend-location"),expect(this.$node.find(".js-trend-location").text().trim()).toBe("San Francisco Trends")})}),describe("event uiTrendSelected",function(){beforeEach(function(){this.component.trigger("dataTrendsRefreshed",this.fixture)}),it("is triggered on normal trend click",function(){spyOnEvent(this.$node,"uiTrendSelected"),this.$node.find('[data-trend-name="Trend E"] a').click(),expect("uiTrendSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isPromoted:!1})}),it("is not triggered on click to the li",function(){spyOnEvent(this.$node,"uiTrendSelected"),this.$node.find('[data-trend-name="Trend E"]').click(),expect("uiTrendSelected").not.toHaveBeenTriggeredOn(this.$node)}),it("is triggered on promoted trend click",function(){spyOnEvent(this.$node,"uiTrendSelected"),this.$node.find('[data-trend-name="#ts3"] a').click(),expect("uiTrendSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isPromoted:!0,promotedTrendId:1})})}),describe("event uiTrendsDisplayed",function(){it("is triggered on initial load",function(){spyOnEvent(this.$node,"uiTrendsDisplayed"),this.component.trigger("dataTrendsRefreshed",this.fixture),expect("uiTrendsDisplayed").toHaveBeenTriggeredOnAndWith(this.$node,{items:a,initial:!0})}),it("is triggered on refresh",function(){spyOnEvent(this.$node,"uiTrendsDisplayed"),this.component.trigger("dataTrendsRefreshed",this.fixture),this.component.trigger("dataTrendsRefreshed",this.fixture),expect("uiTrendsDisplayed").toHaveBeenTriggeredOnAndWith(this.$node,{items:a,initial:!1,scribeData:{woeid:2487956}})}),it("includes the source of the event",function(){spyOnEvent(this.$node,"uiTrendsDisplayed");var a=this.fixture;a.source="clock",this.component.trigger("dataTrendsRefreshed",a),expect("uiTrendsDisplayed").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({source:"clock"}))})})})
});
define("test/app/ui/expando/expando_helpers_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/ui/expando/expando_helpers",function(){var a="<div class='js-stream-item' data-item-type=\"tweet\">\n    <div class='js-stream-tweet original-tweet'>\n      <div class='expanded-content js-tweet-details-dropdown'></div>\n    </div>\n  </div>\n  ",b="<div class='js-stream-item' data-item-type=\"tweet\">\n    <div class='in-reply-to'>\n      <div>\n        <div class='js-stream-tweet'></div>\n      </div>\n    </div>\n    <div class='expansion-container'>\n      <div class='js-stream-tweet original-tweet opened-tweet'></div>\n      <div class='replies'>\n        <div class='replies-to'>\n          <div class='tweets-wrapper'>\n            <div class='js-stream-tweet'></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  ",c,d=$(a),e=$(b),f;describe("sundry expando helpers",function(){describe("if tweet has auto-expanded class",function(){it("expando has auto_expanded attribute",function(){c=d.find(".original-tweet.js-stream-tweet").eq(0).addClass("auto-expanded"),f=this.Module.buildExpandoStruct({$tweet:c,openedTweetClass:"opened-tweet",inReplyToSelector:".in-reply-to",repliesSelector:".replies",expansionSelector:".expansion-container",originalClass:"original-tweet",containingSelector:"div.js-stream-item"}),expect(f.auto_expanded).toBe(!0)})}),describe("tweet with data-item-type attribute",function(){it("expando has itemType attribute",function(){c=d.find(".original-tweet.js-stream-tweet").eq(0).addClass("auto-expanded"),f=this.Module.buildExpandoStruct({$tweet:c,openedTweetClass:"opened-tweet",inReplyToSelector:".in-reply-to",repliesSelector:".replies",expansionSelector:".expansion-container",originalClass:"original-tweet",containingSelector:"div.js-stream-item"}),expect(f.itemType).toBe("tweet")})}),describe("when buildExpandoStruct is called with a collapsed tweet that has never been expanded",function(){beforeEach(function(){c=d.find(".original-tweet.js-stream-tweet").eq(0),f=this.Module.buildExpandoStruct({$tweet:c,openedTweetClass:"opened-tweet",inReplyToSelector:".in-reply-to",repliesSelector:".replies",expansionSelector:".expansion-container",originalClass:"original-tweet",containingSelector:".js-stream-item"})}),it("the jQuery reference for the top-most DOM element for the tweet should not be empty",function(){expect(f.$container.length).toBe(1)}),it("the jQuery reference for the animation scaffolding should be empty",function(){expect(f.$scaffold.length).toBe(0)}),it("the jQuery references for replies should be empty",function(){expect(f.$ancestors.length).toBe(0),expect(f.$descendants.length).toBe(0)}),it('the initial value of the "open" property should be determined by the prescence of the "opened-tweet" class',function(){expect(f.open).toBe(!1)})}),describe("#guessGoodSpeed",function(){it("calculates based on the largest number",function(){var a=this.Module.guessGoodSpeed(100,200,300),b=this.Module.guessGoodSpeed(300,299,298),c=this.Module.guessGoodSpeed(300,400,500);expect(a).toEqual(b),expect(b).not.toEqual(c)})}),describe("#getNaturalHeight",function(){it("can get the natural height of a dom element without disrupting its height",function(){var a=$("<div style='height:0px'><div style='height: 35px'>Birth of the Cool</div></div>");attachFixtureToDom(a),expect(a).toHaveCss("height","0px");var b=this.Module.getNaturalHeight(a);expect(b).toBe(35),expect(a).toHaveCss("height","0px")})}),describe("#closeAllButPreserveScroll",function(){it("quits quickly if nothing worth closing is found",function(){var a=$("<div><div></div></div>");attachFixtureToDom(a);var b=jasmine.createSpy(),c=this.Module.closeAllButPreserveScroll({$scope:a,openSelector:".open",callback:b});expect(c).toBe(!1),expect(b).not.toHaveBeenCalled()}),it("returns false if a buoy to test against is not found",function(){var a=jasmine.createSpy(),b=$('<div><div class="open">Miles Davis</div><div>Miles Davos</div></div>');attachFixtureToDom(b);var c=this.Module.closeAllButPreserveScroll({$scope:b,openSelector:".open",itemSelector:"div",callback:a});expect(c).toBe(!1),expect(a).not.toHaveBeenCalled()})})})})
});
define("test/app/ui/expando/expanding_tweets_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/expando/expanding_tweets",function(){function d(a,b){return c.replace(/{{id}}/g,a).replace(/{{ancestors}}/g,b.join(","))}var a='<li class=\'js-stream-item\'>\n    <div class=\'js-stream-tweet original-tweet js-original-tweet\'  data-tweet-id=\'3\' data-expanded-footer=\'<h1>Whatup</h1>\'>\n      <div class="stream-item-header">\n          <button type="button" class="btn-link js-translate-tweet expand-stream-item" data-nav="translate_tweet">\n          <span class="translate-label">View Translation</span></button>\n      </div>\n      <a class=\'js-open-close-tweet\'>\n        <span></span>\n      </a>\n      <p class=\'js-tweet-text\'>Miles Davis.</p>\n      <a class="details with-icn js-details" href="#">\n        <span class="details-icon js-icon-container"></span>\n        <b>\n          <span class="expand-stream-item js-view-details">\n            <span class="expand-action-wrapper">Expand</span>\n          </span>\n          <span class="collapse-stream-item js-hide-details">\n            Collapse\n          </span>\n        </b>\n      </a>\n      <div class="expanded-content js-tweet-details-dropdown"></div>\n    </div>\n  </li>\n  ',b='<li class=\'js-stream-item\'>\n      <ol class="activity-supplement has-hidden-supplements">\n        <li class="stream-item supplement visible-supplement"><div class="tweet original-tweet js-stream-tweet"></div></li>\n        <li class="stream-item supplement hidden-supplement"><div class="tweet original-tweet js-stream-tweet"></div></li>\n        <li class="stream-item supplement hidden-supplement"><div class="tweet original-tweet js-stream-tweet"></div></li>\n      </ol>\n    </li>\n  ',c='<li class="js-stream-item stream-item" id="stream-item-tweet-{{id}}">\n    <ol class="conversation-module" data-ancestors="{{ancestors}}">\n      <li class="conversation-header" style="display: none">\n        <a href="/" class="uncollapse">User started this conversation</a>\n      </li>\n      <li class="conversation-root conversation-tweet-item"><div class="tweet simple-tweet"></div></li>\n      <li class="missing-tweets-bar">\n        <a href="/" class="missing-tweets-link">View more tweets</a>\n      </li>\n      <li class="conversation-ancestor conversation-tweet-item"><div class="tweet simple-tweet"></div></li>\n      <li class="original-tweet-item"><div class="tweet original-tweet"></div></li>\n    </ol>\n  </li>\n  ';describe("when the stream item contains a semi-expanded item",function(){beforeEach(function(){this.clickTweet=function(){this.component.select("expandingTweetSelector").trigger("click")},setupComponent(a),this.component.$node.addClass("semi-expanded"),spyOn(this.component,"resetCard"),spyOn(this.component,"createCard"),spyOn(this.component,"destroyCard")}),describe("when tweet opens",function(){it("should not call createCard",function(){this.clickTweet(),expect(this.component.createCard).not.toHaveBeenCalled()})}),describe("when tweet closes",function(){beforeEach(function(){this.clickTweet(),this.clickTweet()}),it("should not call resetCard",function(){expect(this.component.resetCard).not.toHaveBeenCalled()}),it("should not call destroyCard",function(){expect(this.component.destroyCard).not.toHaveBeenCalled()})})}),describe("when the stream item contains a single expando",function(){beforeEach(function(){this.clickTweet=function(){this.component.select("expandingTweetSelector").trigger("click")},setupComponent(a),spyOn(this.component,"resetCard"),spyOn(this.component,"createCard"),spyOn(this.component,"destroyCard")}),describe("when tweet opens",function(){it("should call createCard",function(){this.clickTweet(),expect(this.component.createCard).toHaveBeenCalled()})}),describe("when tweet closes",function(){beforeEach(function(){this.clickTweet(),this.clickTweet()}),it("should call resetCard",function(){expect(this.component.resetCard).toHaveBeenCalled()}),it("should call destroyCard",function(){expect(this.component.destroyCard).toHaveBeenCalled()})}),describe("#resizePlayerCard",function(){it("resizes a player card that is too big",function(){var a=$('<iframe width="500" height="500" />');this.component.resizePlayerCard(0,a),expect(a.attr("width")).toEqual("435"),expect(a.attr("height")).toEqual("435")}),it("ignores a player card that is just the right size",function(){var a=$('<iframe width="435" height="200" />');this.component.resizePlayerCard(0,a),expect(a.attr("width")).toEqual("435"),expect(a.attr("height")).toEqual("200")}),it("ignores a player card that is small",function(){var a=$('<iframe width="200" height="200" />');this.component.resizePlayerCard(0,a),expect(a.attr("width")).toEqual("200"),expect(a.attr("height")).toEqual("200")})}),describe("#resizePlayerCards",function(){it("loops through all player cards and resizes them",function(){var a=spyOn(this.component,"resizePlayerCard"),b=$('<div><div class="cards-base cards-multimedia"><iframe></iframe><iframe></iframe><iframe></iframe></div></div>');this.component.resizePlayerCards(b),expect(a.callCount).toBe(3)})}),it("expands tweets only when click target should result in expansion",function(){var a=spyOn(this.component,"expandTweet");this.component.select("expandingTweetSelector").trigger("click"),expect(a.callCount).toBe(1),this.$node.find(".js-open-close-tweet span").trigger("click"),expect(a.callCount).toBe(2),this.component.select("jsTranslateTweetSelector").trigger("click"),expect(a.callCount).toBe(3),this.$node.find(".js-tweet-text a").trigger("click"),expect(a.callCount).not.toBe(4)}),it("does not expand tweets when selecting text",function(){var a=spyOn(this.component,"expandTweet");spyOn(this.component,"selectedText").andReturn("text"),this.clickTweet(),expect(a.callCount).toBe(0)}),it("expands stream-items only when called as argument to expandItem method",function(){var a=spyOn(this.component,"expandTweet");this.$node.trigger("click"),expect(a.callCount).toBe(0),this.component.expandItem(this.$node),expect(a.callCount).toBe(1)}),it("calls load tweet on click of element",function(){var a=spyOn(this.component,"loadTweet").andCallThrough(),b=spyOn(this.component,"openTweet").andCallThrough(),c=spyOn(this.component,"closeTweet").andCallThrough();this.clickTweet(),expect(a.callCount).toBe(1),expect(b.callCount).toBe(1),this.clickTweet(),expect(a.callCount).toBe(1),expect(c.callCount).toBe(1),this.clickTweet(),expect(a.callCount).toBe(2),expect(b.callCount).toBe(2)}),describe("when the animation of the original Tweet is complete",function(){it("sets expando.open to true",function(){this.clickTweet();var a=this.component.select("expandingTweetSelector"),b=a.data("expando");expect(b.open).toBe(!0)}),it('removes the "animating" class from the scaffold',function(){this.clickTweet();var a=this.component.select("expandingTweetSelector"),b=a.data("expando");expect(b.$scaffold).not.toHaveClass(this.component.attr.animating)}),it('sets the height of the scaffold to "auto"',function(){this.clickTweet();var a=this.component.select("expandingTweetSelector"),b=a.data("expando");expect(b.$scaffold[0].style.height).toBe("auto")}),it('triggers the "uiTimelineNeedsTranslation" event',function(){var a=this.component.select("expandingTweetSelector");spyOnEvent(a,"uiTimelineNeedsTranslation"),this.clickTweet(),expect("uiTimelineNeedsTranslation").toHaveBeenTriggeredOn(a)})}),it("focuses the inline reply tweetbox when expanding a tweet via reply",function(){var a=this.component.select("expandingTweetSelector"),b=function(){this.component.trigger(a,"expandTweetByReply",{})}.bind(this);spyOn(this.component,"focusReplyTweetbox"),b(),expect(this.component.focusReplyTweetbox.callCount).toBe(0),this.clickTweet(),b(),expect(this.component.focusReplyTweetbox.callCount).toBe(0),b(),expect(this.component.focusReplyTweetbox.callCount).toBe(1)}),it("inserts HTML from the data-expanded-footer attribute into the expanded content section",function(){this.clickTweet(),expect(this.component.select("detailsSelector")).toHaveHtml("<h1>Whatup</h1>")}),it("triggers the uiWantsMediaForTweet event",function(){var a=this.component.select("expandingTweetSelector");spyOnEvent(a,"uiWantsMediaForTweet"),this.clickTweet(),expect("uiWantsMediaForTweet").toHaveBeenTriggeredOn(a)}),it("does not insert HTML from the data-expanded-footer attribute into the expanded content section if the expanded content element already has children",function(){this.component.select("detailsSelector").html("<div>CHILD NODE</div>"),this.clickTweet(),expect(this.component.select("detailsSelector")).not.toHaveHtml("<h1>Whatup</h1>")}),it("does not trigger the uiWantsMediaForTweet event if the expanded content section already has children",function(){var a=this.component.select("expandingTweetSelector");this.component.select("detailsSelector").html("<div>CHILD NODE</div>"),spyOnEvent(a,"uiWantsMediaForTweet"),this.clickTweet(),expect("uiWantsMediaForTweet").not.toHaveBeenTriggeredOn(a)}),describe("when the details link has focus prior to expansion",function(){it("restores focus to the details link after expansion",function(){this.component.select("jsDetailsSelector").focus(),this.component.select("jsDetailsSelector").trigger("click");var a=this.$node.find(".js-expansion-container");expect(a).toExist(),expect(this.component.select("jsDetailsSelector")).toBeFocused()})}),it('adds the "js-navigable-stream" to the scaffold',function(){this.component.select("jsDetailsSelector").trigger("click"),expect(this.$node.find(".js-navigable-stream").length).toBe(1)}),it('adds the "js-has-navigable-stream" to the parent stream item',function(){this.component.select("jsDetailsSelector").trigger("click"),expect(this.$node).toHaveClass("js-has-navigable-stream")}),describe("when the expando is closed",function(){var a;beforeEach(function(){a=this.component.select("expandingTweetSelector"),runs(function(){this.clickTweet()}.bind(this)),waitsFor(function(){return a.hasClass(this.component.attr.openedTweetClass)}.bind(this),"tweet to be expanded",1e3),runs(function(){this.clickTweet()}.bind(this)),waitsFor(function(){return!a.hasClass(this.component.attr.openedTweetClass)}.bind(this),"tweet to be collapsed",1e3)}),it('removes the "js-has-navigable-stream" class from the parent stream item',function(){expect(this.component.$node).not.toHaveClass("js-has-navigable-stream")})}),it("should not collapse content inside of proxy tweet containers",function(){var a=this.component.select("expandingTweetSelector");runs(function(){this.clickTweet()}.bind(this)),waitsFor(function(){return a.hasClass(this.component.attr.openedTweetClass)}.bind(this),"tweet to be expanded",1e3),runs(function(){a.parent().addClass("proxy-tweet-container"),this.component.collapseTweet(0,a),expect(a).toHaveClass(this.component.attr.openedTweetClass)}.bind(this))}),it("looks for preexpanded tweets and fills out their contents / sets them up for animations",function(){var a=this.$node.clone();a.addClass("preexpanded").addClass("js-preexpanded").find(".js-stream-tweet").addClass("opened-tweet"),this.component.$node.prepend(a),spyOnEvent(a,"uiWantsMediaForTweet"),this.component.$node.trigger("uiHasInjectedNewTimeline"),expect(a).not.toHaveClass("preexpanded"),expect(a).not.toHaveClass("animating"),expect(a).toHaveClass("open");var b=a.find(".original-tweet").data("expando");expect(b.originalHeight).not.toEqual(a.height()),expect(b.$container).toBe(a),expect("uiWantsMediaForTweet").toHaveBeenTriggeredOn(a)}),it("stores preexpanded tweets expanded content in data-expanded-footer",function(){var a=this.$node.clone(),b=a.find(".js-stream-tweet");a.addClass("js-preexpanded"),b.addClass("opened-tweet").attr("data-expanded-footer",""),a.find(".expanded-content").html("EXPANDED CONTENT"),this.$node.prepend(a),expect(b).toHaveAttr("data-expanded-footer",""),$(document).trigger("uiSwiftLoaded"),expect(b).toHaveAttr("data-expanded-footer","EXPANDED CONTENT")}),describe("when an expando is closed and the Tweet did not have focus",function(){var a;beforeEach(function(){a=this.component.select("expandingTweetSelector"),runs(function(){this.clickTweet()}.bind(this)),waitsFor(function(){return a.hasClass(this.component.attr.openedTweetClass)}.bind(this),"tweet to be expanded",1e3),runs(function(){spyOnEvent(a.closest(".js-stream-item"),"uiSelectItem"),this.clickTweet()}.bind(this)),waitsFor(function(){return!a.hasClass(this.component.attr.openedTweetClass)}.bind(this),"tweet to be collapsed",1e3)}),it("destroys the expando",function(){expect(this.component.select("expandingTweetSelector").data("expando")).toBeUndefined()}),it("removes the scaffold",function(){expect(this.component.select("expandingTweetSelector").closest(this.component.attr.jsStreamItemSelector).find(this.component.attr.expansionSelector).length).toBe(0)}),it('does not focus the "link to expand"',function(){expect(a.find(this.component.attr.jsDetailsSelector)).not.toBeFocused()}),it('triggers the "uiSelectItem" event on the parent stream item without the "setFocus" option',function(){expect("uiSelectItem").toHaveBeenTriggeredOn(a.closest(".js-stream-item"))})}),describe("when an expando is closed and the Tweet has focus",function(){var a;beforeEach(function(){a=this.component.select("expandingTweetSelector"),runs(function(){this.clickTweet()}.bind(this)),waitsFor(function(){return a.hasClass(this.component.attr.openedTweetClass)}.bind(this),"tweet to be expanded",1e3),runs(function(){spyOnEvent(a.closest(".js-stream-item"),"uiSelectItem"),a.find(this.component.attr.jsDetailsSelector).focus(),a.find(this.component.attr.jsDetailsSelector).trigger("click")}.bind(this)),waitsFor(function(){return!a.hasClass(this.component.attr.openedTweetClass)}.bind(this),"tweet to be collapsed",1e3)}),it('focuses the "link to expand" if the Tweet',function(){expect(a.find(this.component.attr.jsDetailsSelector)).toBeFocused()}),it('triggers the "uiSelectItem" event on the parent stream item with "setFocus" set to false',function(){expect("uiSelectItem").toHaveBeenTriggeredOnAndWith(a.closest(".js-stream-item"),{setFocus:!1})})}),describe("when the Tweet's parent LI has focus and the expando is closed",function(){var a;beforeEach(function(){a=this.component.select("expandingTweetSelector"),runs(function(){this.clickTweet()}.bind(this)),waitsFor(function(){return a.hasClass(this.component.attr.openedTweetClass)}.bind(this),"tweet to be expanded",1e3),runs(function(){spyOnEvent(a.closest(".js-stream-item"),"uiSelectItem"),this.clickTweet()}.bind(this)),waitsFor(function(){return!a.hasClass(this.component.attr.openedTweetClass)}.bind(this),"tweet to be collapsed",1e3)}),it('triggers the "uiSelectItem" event on the parent stream item with "setFocus" set to true',function(){expect("uiSelectItem").toHaveBeenTriggeredOnAndWith(a.closest(".js-stream-item"),{setFocus:!0})})})}),describe("when the stream item contains multiple expandos",function(){beforeEach(function(){setupComponent(b)}),describe('and the "uiShouldToggleExpandedState" event is triggered on the a stream item',function(){it("expands the first match",function(){this.component.trigger("uiShouldToggleExpandedState"),expect(this.component.select("expandedConversationSelector").length).toBe(1)})})}),describe("when the stream item contains a conversation",function(){beforeEach(function(){jasmine.Clock.useMock();var a="<ol class='stream-items'>";a+=d(7,[5,4,3,2,1]),a+=d(6,[5,4,3,2,1]),a+="</ol>",setupComponent(a);var b=$("#stream-item-tweet-7");jasmine.Clock.tick(1e3)}),describe("and the users presses Enter while focused on the missing Tweets bar",function(){it('triggers the "uiNeedsConversationAncestors" event on the focal point',function(){var a=$("#stream-item-tweet-7"),b=a.find(".conversation-module .original-tweet");spyOnEvent(b,"uiNeedsConversationAncestors");var c=a.find(".missing-tweets-bar");c.attr("tabindex",-1).focus(),this.component.trigger(c,"uiShortcutEnter"),jasmine.Clock.tick(1e3),expect("uiNeedsConversationAncestors").toHaveBeenTriggeredOn(b)})}),describe("and a Tweet in the conversation is deleted",function(){it('triggers the "uiConversationModuleUpdated" event',function(){var a=$("#stream-item-tweet-7"),b=a.find(".conversation-module");spyOnEvent(b,"uiConversationModuleUpdated"),this.component.trigger(b.find(".original-tweet-item"),"uiBeforeTweetRemoved"),expect("uiConversationModuleUpdated").toHaveBeenTriggeredOn(b)})}),describe("and a Tweet is added to the conversation via an inline reply",function(){it('triggers the "uiConversationModuleUpdated" event',function(){var a=$("#stream-item-tweet-7"),b=a.find(".conversation-module");spyOnEvent(b,"uiConversationModuleUpdated"),b.append('<li id="new-item-one"><div class="tweet"></div></li>');var c=$("#new-item-one");this.component.trigger(c,"uiTweetInserted"),expect("uiConversationModuleUpdated").toHaveBeenTriggeredOn(b)})})})})
});
define("test/app/ui/expando/with_expanding_containers_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/expando/with_expanding_containers",function(){var a;beforeEach(function(){var b="<ol>\n        <li class='js-stream-item'></li>\n        <li class='js-stream-item'></li>\n        <li class='js-stream-item'></li>\n        <li class='js-stream-item'></li>\n        <li class='js-stream-item'></li>\n      </ol>\n    ";setupComponent(b),a=this.component.$node.children()}),it("adds/removes margin to/from a given container when <enter/exit>DetachedState called",function(){var b=a.slice(2,3),c=a.slice(1,2),d=a.slice(3,4);this.component.enterDetachedState(b),expect(b).toHaveClass("open"),expect(c).toHaveClass("before-expanded"),expect(d).toHaveClass("after-expanded"),expect(b).toHaveCss("margin-top",this.component.DETACHED_MARGIN+"px"),expect(b).toHaveCss("margin-bottom",this.component.DETACHED_MARGIN+"px"),this.component.exitDetachedState(b),expect(b).not.toHaveClass("open"),expect(c).not.toHaveClass("before-expanded"),expect(d).not.toHaveClass("after-expanded"),expect(b).toHaveCss("margin-top","0px"),expect(b).toHaveCss("margin-bottom","0px")}),it("does not add top margin to the top-most item, and does not add bottom margin to the bottom-most",function(){var b=a.eq(0),c=a.eq(a.length-1);this.component.enterDetachedState(b),expect(b).toHaveCss("margin-top","0px"),expect(b).toHaveCss("margin-bottom",this.component.DETACHED_MARGIN+"px"),this.component.enterDetachedState(c),expect(c).toHaveCss("margin-top",this.component.DETACHED_MARGIN+"px"),expect(c).toHaveCss("margin-bottom","0px")}),it("add/removes margins by default, but does not when marginBreaking set to true",function(){var b=a.eq(2);this.component.enterDetachedState(b),expect(b).toHaveCss("margin-top",this.component.DETACHED_MARGIN+"px"),expect(b).toHaveCss("margin-bottom",this.component.DETACHED_MARGIN+"px"),this.component.exitDetachedState(b),this.component.attr.marginBreaking=!1,this.component.enterDetachedState(b),expect(b).toHaveCss("margin-top","0px"),expect(b).toHaveCss("margin-bottom","0px")}),it("maintains selected-stream-item class when item opened and closed",function(){var b=a.slice(2,3);b.addClass("selected-stream-item"),this.component.enterDetachedState(b),expect(b).toHaveClass("selected-stream-item"),this.component.exitDetachedState(b),expect(b).toHaveClass("selected-stream-item")}),it("adds top margin to the formerly first stream item when new items inserted at the top",function(){var b=a.slice(0,1);this.component.enterDetachedState(b),expect(b).toHaveCss("margin-top","0px"),b.before('<div class="js-stream-tweet"></div>'),this.component.trigger(b.prev(),"uiHasInjectedTimelineItem"),expect(b).toHaveCss("margin-top",this.component.DETACHED_MARGIN+"px")})})
});
define("test/app/ui/expando/with_expanding_social_activity_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/expando/with_expanding_social_activity",function(){var a,b,c;beforeEach(function(){var d="<li class='js-stream-item stream-item'>\n        <ol class='expansion-container js-expansion-container'>\n          <li>\n            <div class='js-stream-tweet' data-is-reply-to='true' data-expanded-footer='<h1>Whatup</h1>'>\n              <a class='js-open-close-tweet'>\n                <span></span>\n              </a>\n              <p class='js-tweet-text'>Miles Davis.</p>\n              <div class='js-tweet-details-dropdown'></div>\n            </div>\n          </li>\n        </ol>\n      </li>\n    ",e='<div id="inline-reply-tweetbox">\n        <form class="tweet-form"></form>\n      </div>\n    ',f=$(d);b={$scaffold:f.children(),$container:f,$tweet:f.find(".js-stream-tweet")},c={ancestors:'<div class="in-reply-to"><ol class="ancestor-items"><li><div class="tweet ancestor">Miles Davis</div></li></ol></div>',descendants:'<div class="replies"><div class="inline-reply-tweetbox swift"><form class="tweet-form"></form></div><ol class="tweets-wrapper"><li><div class="tweet descendant">Cannonball Adderley</div></li></ol></div>'},a=f.find(".js-stream-tweet"),a.data("expando",b),setupComponent({openClass:"open",loggedIn:!0}),this.component.hasConversationModule=function(){return!1},this.component.$node.append(f),this.$node.append(e)}),describe("when renderInlineTweetbox is called",function(){it("inserts the inline reply Tweet Box as an immediate sibling of the original tweet",function(){this.component.renderInlineTweetbox(b,c),expect(b.$tweet.next()).toHaveClass("inline-reply-tweetbox")})}),describe("when the renderConversation method is called",function(){it("does nothing if the user has already closed the expando",function(){a.data("expando",null),this.component.renderConversation({target:a},c),expect(b.$descendants).toBeUndefined(),expect(b.$ancestors).toBeUndefined()}),it("adds the descendants to expando.$descendants",function(){this.component.renderConversation({target:a},c),expect(b.$descendants.length).toBe(1)}),it("adds the ancestors to expando.$ancestors",function(){this.component.renderConversation({target:a},c),expect(b.$ancestors.length).toBe(1)}),it("sets the height of the scaffold to a fixed height before the animation is triggered",function(){var b=this.component.animateTweetOpen;spyOn(this.component,"animateTweetOpen");var d=a.data("expando");d.$scaffold.css("height","auto"),this.component.renderConversation({target:a},c),expect(d.$scaffold[0].style.height).not.toBe("auto"),this.component.animateTweetOpen=b}),it("sets expando.open to true when the animation is complete",function(){var b=a.data("expando");b.open=!1,this.component.renderConversation({target:a},c),expect(b.open).toBe(!0)}),it('removes the "animating" class from the scaffold when the animation is complete',function(){var b=a.data("expando");b.$scaffold.addClass(this.component.attr.animating),this.component.renderConversation({target:a},c),expect(b.$scaffold).not.toHaveClass(this.component.attr.animating)}),it('sets the height of the scaffold to "auto" when the animation is complete',function(){var b=a.data("expando");b.$scaffold.css("height","100px"),this.component.renderConversation({target:a},c),expect(b.$scaffold[0].style.height).toBe("auto")}),it('triggers the "uiTimelineNeedsTranslation" event after the tweet has been expanded',function(){spyOnEvent(a,"uiTimelineNeedsTranslation"),this.component.renderConversation({target:a},c),expect("uiTimelineNeedsTranslation").toHaveBeenTriggeredOn(a)}),it("queues the animation",function(){var b=a.data("expando");spyOn(this.component,"animateConversationEntrance"),spyOn(b.$scaffold,"queue"),this.component.renderConversation({target:a},c),expect(b.$scaffold.queue).toHaveBeenCalled()}),describe("and the response contains ancestors or descendants",function(){it('triggers the "uiRenderingExpandedConversation" event',function(){spyOnEvent(a,"uiRenderingExpandedConversation"),this.component.renderConversation({target:a},c),expect("uiRenderingExpandedConversation").toHaveBeenTriggeredOn(a)}),it('triggers the "uiExpandedConversationRendered" event',function(){spyOnEvent(a,"uiExpandedConversationRendered"),this.component.renderConversation({target:a},c),expect("uiExpandedConversationRendered").toHaveBeenTriggeredOn(a)})}),describe("and the response does not contain ancestors or descendants",function(){beforeEach(function(){c.ancestors="",c.descendants='<div class="replies"><div class="inline-reply-tweetbox swift"><form class="tweet-form"></form></div></div>'}),it('does not trigger the "uiRenderingExpandedConversation" event',function(){spyOnEvent(a,"uiRenderingExpandedConversation"),this.component.renderConversation({target:a},c),expect("uiRenderingExpandedConversation").not.toHaveBeenTriggeredOn(a)}),it('does not trigger the "uiExpandedConversationRendered" event',function(){spyOnEvent(a,"uiExpandedConversationRendered"),this.component.renderConversation({target:a},c),expect("uiExpandedConversationRendered").not.toHaveBeenTriggeredOn(a)})}),describe('when the Tweet does not have a "focus-reply" attribute',function(){it('does not trigger the "uiExpandFocus" event after the tweet has been expanded',function(){var b=jasmine.createSpy("uiExpandFocusListener");this.component.on("uiExpandFocus",b),this.component.renderConversation({target:a},c),expect(b).not.toHaveBeenCalled()})}),describe('when the Tweet has a "focus-reply" attribute set to "true"',function(){beforeEach(function(){a.attr("focus-reply",!0)}),it('triggers the "uiExpandFocus" event after the Tweet has been expanded',function(){var d=this.component.renderInlineTweetbox(b,{});spyOnEvent(d,"uiExpandFocus"),this.component.renderConversation({target:a},c),expect("uiExpandFocus").toHaveBeenTriggeredOn(d)}),it('removes the "focus-reply" from the Tweet element',function(){this.component.renderConversation({target:a},c),expect(a).not.toHaveAttr("focus-reply")})}),describe('and the response contains a "view more in conversation" link',function(){beforeEach(function(){c.descendants='<div class="replies"><div class="inline-reply-tweetbox swift"></div><ol class="tweets-wrapper"><li><div class="tweet descendant">Cannonball Adderley</div></li></ol><div class="view-more-container"><a href="#" class="view-more-link">View more in conversation</a></div></div>',b.$container.addClass(this.component.attr.openClass),this.component.renderConversation({target:a},c)}),it('extracts the "view more in conversation" container and wraps it in a list item',function(){expect(b.$descendants.last()[0].tagName.toLowerCase()).toBe("li")}),it('adds the "view more in conversation" item to expando.$descendants',function(){expect(b.$descendants.length).toBe(2)})})}),describe("when animateTweetOpen() is called",function(){it("sets expando.animating to true",function(){spyOn(this.component,"animateScaffoldHeight"),this.component.renderConversation({target:a},c);var b=a.data("expando");this.component.animateTweetOpen({expando:b}),expect(b.animating).toBe(!0)}),it("sets margin top of first ancestor",function(){spyOn(this.component,"animateScaffoldHeight"),this.component.renderConversation({target:a},c);var b=a.data("expando");this.component.animateTweetOpen({expando:b}),expect(b.$ancestors.first().css("margin-top")).not.toBe("0px")}),it("sets margin bottom of last descendant",function(){spyOn(this.component,"animateScaffoldHeight"),this.component.renderConversation({target:a},c);var b=a.data("expando");this.component.animateTweetOpen({expando:b}),expect(b.$descendants.last().css("margin-bottom")).not.toBe("0px")}),it("calls the specified callback when the animation is complete",function(){this.component.renderConversation({target:a},c);var b=a.data("expando"),d=jasmine.createSpy("fnComplete");this.component.animateTweetOpen({expando:b,complete:d}),expect(d).toHaveBeenCalled()})}),describe("when animateTweetClosed() is called",function(){it("sets animating property to true",function(){spyOn(this.component,"animateScaffoldHeight"),this.component.renderConversation({target:a},c);var b=a.data("expando");this.component.animateTweetClosed({expando:b}),expect(b.animating).toBe(!0)}),it("calls the specified callback when the animation is complete",function(){this.component.renderConversation({target:a},c);var b=a.data("expando"),d=jasmine.createSpy("fnComplete");this.component.animateTweetClosed({expando:b,complete:d}),expect(d).toHaveBeenCalled()})}),describe("when initTweetsInConversation() is called",function(){describe("and the original tweet is in a timeline",function(){it("attaches the Tweets component to the expando scaffold",function(){var b=loadrunner.Module.exports["app/ui/tweets"],d=b.attachTo;spyOn(b,"attachTo");var e=a.data("expando");this.component.renderInlineTweetbox(e,c),this.component.renderConversation({target:a},c),this.component.animateTweetClosed({expando:e}),expect(b.attachTo).toHaveBeenCalled(),b.attachTo=d})}),describe("and the original tweet is not in a timeline (e.g. permalink tweet)",function(){beforeEach(function(){this.component.$node.find(this.component.attr.parentStreamItemSelector).removeClass("stream-item")}),it("does not attach the Tweets component to the expando scaffold",function(){var b=loadrunner.Module.exports["app/ui/tweets"],d=b.attachTo;spyOn(b,"attachTo"),this.component.renderConversation({target:a},c);var e=a.data("expando");this.component.animateTweetClosed({expando:e}),expect(b.attachTo).not.toHaveBeenCalled(),b.attachTo=d})}),describe("if the user is logged in",function(){beforeEach(function(){this.component.attr.loggedIn=!0}),it("attaches the TweetInjector component to the expando scaffold",function(){var b=loadrunner.Module.exports["app/ui/tweet_injector"],d=b.attachTo;spyOn(b,"attachTo");var e=a.data("expando");this.component.renderInlineTweetbox(e,c),this.component.renderConversation({target:a},c),this.component.animateTweetClosed({expando:e}),expect(b.attachTo).toHaveBeenCalled(),b.attachTo=d})}),describe("if the user is not logged in",function(){beforeEach(function(){this.component.attr.loggedIn=!1}),it("does not attach the TweetInjector component to the expando scaffold",function(){var b=loadrunner.Module.exports["app/ui/tweet_injector"],d=b.attachTo;spyOn(b,"attachTo"),this.component.renderConversation({target:a},c);var e=a.data("expando");this.component.animateTweetClosed({expando:e}),expect(b.attachTo).not.toHaveBeenCalled(),b.attachTo=d})})}),describe("when animateScaffoldHeight() is called",function(){it("animates the height of the scaffold element",function(){this.component.renderConversation({target:a},c);var b=a.data("expando");this.component.animateScaffoldHeight({expando:b,height:100}),expect(b.$scaffold.css("height")).toBe("100px"),b.$scaffold.css("height","auto")}),it("sets expando.animating to false when the animation is complete",function(){this.component.renderConversation({target:a},c);var b=a.data("expando");b.animating=!0,this.component.animateScaffoldHeight({expando:b,height:100}),expect(b.animating).toBe(!1),b.$scaffold.css("height","auto")}),it("calls the specified callback when the animation is complete",function(){this.component.renderConversation({target:a},c);var b=a.data("expando"),d=jasmine.createSpy("fnComplete");this.component.animateScaffoldHeight({expando:b,complete:d}),expect(d).toHaveBeenCalled()}),it("animates the top margin of the first ancestor",function(){this.component.renderConversation({target:a},c);var b=a.data("expando"),d=b.$ancestors.first();spyOn(jQuery.fn,"animate"),this.component.animateScaffoldHeight({expando:b,marginTop:-100}),expect(jQuery.fn.animate).toHaveBeenCalled()}),it("animates the bottom margin of the last descendant",function(){this.component.renderConversation({target:a},c);var b=a.data("expando"),d=b.$descendants.last();spyOn(jQuery.fn,"animate"),this.component.animateScaffoldHeight({expando:b,marginBottom:-100}),expect(jQuery.fn.animate).toHaveBeenCalled()})})})
});
define("test/app/ui/expando/close_all_button_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/expando/close_all_button",function(){var a,b=function(b){a=b,setupComponent({addEvent:"uiHasAddedSomething",subtractEvent:"uiHasSubtractedSomething",where:a,closeAllEvent:"uiWantsEverythingToClose"})};describe("when the page is rendered with one or more open tweets",function(){beforeEach(function(){b($("<div><div class='open'></div></div>"))}),it("shows the button in response to the uiSwiftLoaded event",function(){this.component.trigger(document,"uiSwiftLoaded"),expect(this.component.$node).toBeVisible()}),it("shows the button in response to the uiPageChanged event",function(){this.component.trigger(document,"uiPageChanged"),expect(this.component.$node).toBeVisible()})}),describe("when the page is rendered without open tweets",function(){beforeEach(function(){b($("<div><div></div></div>"))}),it("does not show the button in response to the uiSwiftLoaded event",function(){this.component.trigger(document,"uiSwiftLoaded"),expect(this.component.$node).toBeHidden()}),it("does not show the button in response to the uiPageChanged event",function(){this.component.trigger(document,"uiPageChanged"),expect(this.component.$node).toBeHidden()})}),describe("incrementing and decrementing",function(){it("increments and decrements the openCount when the add and subtract event are fired",function(){b($("<div></div>")),a.trigger("uiHasAddedSomething"),a.trigger("uiHasAddedSomething"),expect(this.component.openCount).toBe(2),a.trigger("uiHasSubtractedSomething"),expect(this.component.openCount).toBe(1),expect(this.component.$node).toBeVisible(),a.trigger("uiHasSubtractedSomething"),expect(this.component.openCount).toBe(0),expect(this.component.$node).toBeHidden()})}),describe("ui cleanup before page change",function(){it("hides the close all button",function(){b($("<div><div class='open'></div></div>")),$(document).trigger("uiBeforePageChanged"),expect(this.component.$node).toBeHidden()})})})
});
define("test/app/ui/search/archive_navigator_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/search/archive_navigator",function(){var a='<div class="module archive-search">\n      <div class="flex-module">\n        <div class="flex-module-header">\n        <h3>{{_i}}History{{/i}}</h3>\n      </div>\n        <div id="archive-drilldown">\n          <div class="past-nav">\n            <i class="chev-left arrow"></i>\n          </div>\n          <div id="archive-drilldown-container" style="width: 500px">\n            <div id="archive-drilldown-content">\n              <canvas>\n              </canvas>\n              <div class="time-ranges clearfix">\n                <a style="position: absolute; left: 0;"><span class=\'date-container\'><span class=\'month\'></span><br /><span class=\'year\'></span></span></a>\n              </div>\n              <div class="highlights">\n                <a class=\'highlight\'><i class=\'dot\'></i></a>\n              </div>\n            </div>\n          </div>\n          <div class="future-nav">\n            <i class="chev-right arrow"></i>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',b=500,c=(new Date).getTimezoneOffset()*60,d=[{timestamp:1249110001,activityScore:.2},{timestamp:1343804400,activityScore:.5},{timestamp:1346482800,activityScore:.8}],e=[{timestamp:1342465200,activityScore:.35,drilldownSince:1342465100,drilldownUntil:1342465300}],f={coordinates:[{x:1249110001,y:.2},{x:1342465200,y:.35},{x:1343804400,y:.5},{x:1346482800,y:.8}],minX:1249084800,minY:0,maxX:1348963200,maxY:.88};describe("factoring out timezones",function(){it("correctly compiles coordinates to view bounds",function(){var b=$(a);setupComponent(b,{query:"test",timeRanges:d,highlights:e}),expect(this.component.compiledCoordinates.minX-c).toBe(1249084800),expect(this.component.compiledCoordinates.minY).toBe(0),expect(this.component.compiledCoordinates.maxX-c).toBe(1348963200),expect(Math.round(this.component.compiledCoordinates.maxY*100)/100).toBe(.88)})}),describe("with data from server",function(){beforeEach(function(){var b=$(a);spyOnEvent(b,"uiArchiveShown"),setupComponent(b,{query:"test",timeRanges:d,highlights:e}),this.component.compiledCoordinates=f,this.component.setupViewFrame(),this.component.drawGraph()}),it("merges and sorts highlights and ranges",function(){var a=this.component.sortedCoordinates();expect(a).toEqual([{x:1249110001,y:.2},{x:1342465200,y:.35},{x:1343804400,y:.5},{x:1346482800,y:.8}])}),it("correctly computes tranformation system",function(){expect(this.component.canvasTransform).toEqual({translateX:-19804.109589041094,translateY:149,scaleX:15854895991882292e-21,scaleY:-168.1818181818182})}),it("ignores data from localStorage and writes new data into localStorage",function(){expect(this.component.storage.getItem("query")).toEqual("test"),expect(this.component.storage.getItem("timeRanges")).toEqual(d),expect(this.component.storage.getItem("highlights")).toEqual(e)}),it("generates a highlight link",function(){var a=this.component.$node.find(".highlights a");expect(a.length).toBe(e.length),expect(a.first()).toHaveClass("js-nav");var b=a.first().attr("href");expect(b).toContain("src=hnav"),expect(b).toContain("since_time="+e[0].drilldownSince),expect(b).toContain("until_time="+e[0].drilldownUntil)}),it("generates the range links",function(){var a=this.component.$node.find(".time-ranges a");expect(a.length).toBe(38);var b=a.first(),c=b.attr("href");expect(c).toContain("src=tnav"),expect(c).toContain("since_time=1249084800"),expect(c).toContain("until_time=1251763200"),expect(b).toHaveClass("js-nav"),expect(b.attr("title")).toBe("Aug 2009"),expect(b.find(".month").text()).toBe("Aug"),expect(b.find(".year").text()).toBe("2009")}),it("fires a uiArchiveShown event after loading",function(){expect("uiArchiveShown").toHaveBeenTriggeredOn(this.$node)}),describe("when pushState page change occurs",function(){it("resets the contents state to the initially loaded templates",function(){expect(this.component.$node.find(this.component.attr.timeRangeLinkSelector).length).toBe(38);var a=this.component.$node.find(this.component.attr.highlightLinkSelector).first().attr("href");expect(a).toContain("since_time="+e[0].drilldownSince),this.component.trigger("uiBeforePageChanged",{}),expect(this.component.$node.find(this.component.attr.timeRangeLinkSelector).length).toBe(1),a=this.component.$node.find(this.component.attr.highlightLinkSelector).first().attr("href"),expect(a).toBeFalsy()})})}),describe("link click handling",function(){beforeEach(function(){var b=$(a);setupComponent(b,{query:"test",timeRanges:d,highlights:e}),this.component.compiledCoordinates=f,this.component.setupViewFrame(),this.component.drawGraph()}),it("fires uiArchiveHighlightClick on highlight click",function(){spyOnEvent(this.$node,"uiArchiveHighlightClick"),this.component.$node.find(".highlights a").first().click(),expect("uiArchiveHighlightClick").toHaveBeenTriggeredOnAndWith(this.$node,{monthsInPast:2})}),it("fires uiArchiveRangeClick on highlight click",function(){spyOnEvent(this.$node,"uiArchiveRangeClick"),this.component.$node.find(".time-ranges a").first().click(),expect("uiArchiveRangeClick").toHaveBeenTriggeredOnAndWith(this.$node,{monthsInPast:37})})}),describe("navigating the graph",function(){beforeEach(function(){var b=$(a);setupComponent(b,{timeRanges:d,highlights:e}),this.component.compiledCoordinates=f,this.component.setupViewFrame(),this.component.drawGraph()}),it("navigates to zero when no selected element",function(){expect(this.component.containerOffset).toBe(0)}),it("limits navigation to the displayable boundry",function(){expect(this.component.containerOffset).toBe(0),this.component.navTime(50),expect(this.component.containerOffset).toBe(50),this.component.navTime(5e3),expect(this.component.containerOffset).toBe(1084),this.component.navTime(-5e3),expect(this.component.containerOffset).toBe(0)}),it("picks appropriate values for navigation increments",function(){var a=spyOn(this.component,"navTime");this.component.navPast(),expect(this.component.navTime).toHaveBeenCalledWith(b*3/4),a.reset(),this.component.navFuture(),expect(this.component.navTime).toHaveBeenCalledWith(-1*b*3/4)})}),describe("navigating the graph with a pre-selected time",function(){beforeEach(function(){var b=$(a);setupComponent(b,{sinceTime:1249084800,untilTime:1251763200,timeRanges:d,highlights:e}),this.component.compiledCoordinates=f,this.component.setupViewFrame(),this.component.drawGraph()}),it("triggers events when navigation arrows are clicked",function(){this.component.navActive();var a=spyOnEvent(this.$node,"uiArchiveNavPast"),b=spyOnEvent(this.$node,"uiArchiveNavFuture"),c=this.$node.find(this.component.attr.pastNavSelector),d=this.$node.find(this.component.attr.futureNavSelector);d.click(),expect("uiArchiveNavFuture").toHaveBeenTriggeredOnAndWith(this.$node,{monthsInPast:17}),b.reset(),d.click(),expect("uiArchiveNavFuture").toHaveBeenTriggeredOnAndWith(this.$node,{monthsInPast:8}),c.click(),expect("uiArchiveNavPast").toHaveBeenTriggeredOnAndWith(this.$node,{monthsInPast:17})}),it("hides appropriate arrows when boundry reached",function(){var a=this.$node.find(this.component.attr.pastNavSelector),b=this.$node.find(this.component.attr.futureNavSelector);this.component.navActive(),this.component.navTime(0),expect(a.css("visibility")).toBe("hidden"),expect(b.css("visibility")).toBe("visible"),this.component.navTime(-500),expect(a.css("visibility")).toBe("visible"),expect(b.css("visibility")).toBe("visible"),this.component.navTime(-5e3),expect(a.css("visibility")).toBe("visible"),expect(b.css("visibility")).toBe("hidden")})}),describe("on a drilldown page (has since and until times)",function(){it("adds active class to highlight and blocks clicks",function(){var b=$(a);setupComponent(b,{query:"test",sinceTime:1342465100,untilTime:1342465300,timeRanges:d,highlights:e}),this.component.compiledCoordinates=f,this.component.setupViewFrame();var c=this.component.$node.find(".highlights a.active");expect(c).toExist(),spyOnEvent(this.$node,"uiArchiveHighlightClick"),c.click(),expect("uiArchiveHighlightClick").not.toHaveBeenTriggeredOn(this.$node)}),it("adds active class to a range and blocks clicks",function(){var b=$(a);setupComponent(b,{sinceTime:1249084800,untilTime:1251763200,timeRanges:d,highlights:e}),this.component.compiledCoordinates=f,this.component.setupViewFrame(),this.component.drawGraph();var c=this.component.$node.find(".time-ranges a.active");expect(c).toExist(),spyOnEvent(this.$node,"uiArchiveRangeClick"),c.click(),expect("uiArchiveRangeClick").not.toHaveBeenTriggeredOn(this.$node)})}),describe("without data from server",function(){var b=$(a);beforeEach(function(){setupComponent(b,{query:"test",timeRanges:[],highlights:[]})}),it("pulls data from localStorage if query matches last query",function(){spyOn(this.component.storage,"now").andReturn((new Date).getTime()+2e3),expect(this.component.attr.timeRanges).toEqual([]),expect(this.component.attr.highlights).toEqual([]),this.component.storage.setItem("query","test",1e4),this.component.storage.setItem("timeRanges",d,1e4),this.component.storage.setItem("highlights",e,1e4),this.component.updateFromCache(),expect(this.component.attr.timeRanges).toEqual(d),expect(this.component.attr.highlights).toEqual(e)}),it("does nothing if queries do not match",function(){spyOn(this.component.storage,"now").andReturn((new Date).getTime()+2e3),expect(this.component.attr.timeRanges).toEqual([]),expect(this.component.attr.highlights).toEqual([]),this.component.storage.setItem("query","michigan",1e4),this.component.storage.setItem("timeRanges",d,1e4),this.component.storage.setItem("highlights",e,1e4),this.component.updateFromCache(),expect(this.component.attr.timeRanges).toEqual([]),expect(this.component.attr.highlights).toEqual([])}),it("hides the entire module if no data to show",function(){expect(this.component.$node).toBeHidden()})})})
});
define("test/app/ui/search/related_queries_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/search/related_queries",function(){beforeEach(function(){var a='<div class="js-related-queries search-assist-related-queries" data-component-term="related_queries">\n          Related:\n            <a class="js-nav related-query" href="/search?q=%23believe&amp;src=rela" rel="nofollow" title="#believe" data-nav="search" data-query="justin bieber" data-search-assistance="#believe" data-query-source="related_query_click">#believe</a>,\n            <a class="js-nav related-query" href="/search?q=alfredo+flores&amp;src=rela" rel="nofollow" title="alfredo flores" data-nav="search" data-query="justin bieber" data-search-assistance="alfredo flores" data-query-source="related_query_click">alfredo flores</a>,\n            <a class="js-nav related-query" href="/search?q=christian%26beadles&amp;src=rela" rel="nofollow" title="christian&amp;beadles" data-nav="search" data-query="justin bieber" data-search-assistance="christian&amp;beadles" data-query-source="related_query_click">christian&amp;beadles</a>\n        </div>\n    ';setupComponent(a)}),describe("click on related query",function(){it("fires uiSearchAssistanceAction",function(){spyOnEvent(this.$node,"uiSearchAssistanceAction"),this.$node.find('.related-query[data-search-assistance="#believe"]').click(),expect("uiSearchAssistanceAction").toHaveBeenTriggeredOnAndWith(this.$node,{component:"related_queries",action:"search",query:"justin bieber",item_names:["#believe"]})})})})
});
define("test/app/ui/search/spelling_corrections_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/search/spelling_corrections",function(){beforeEach(function(){var a='<div class="module js-spelling-corrections search-assist-spelling" data-component-term="spelling_corrections">\n      <div class="flex-module">\n        <div class="flex-module-inner">\n          <div class="dismiss js-action-dismiss-correction" data-query="obamma" data-search-assistance="barack obama">\n            <i class="close"></i>\n          </div>\n          <span class="search-spelling-suggestions">\n            <span class="label">Did you mean:</span>\n            <a href="/search/barack obama" class="corrected-query" data-query="obamma" data-search-assistance="barack obama" data-query-source="spelling_correction_click">\n                barack <em>obama</em>\n            </a>\n          </span>\n        </div>\n      </div>\n    </div>\n    ';setupComponent(a)}),describe("click",function(){it("dismisses spelling correction and fires uiSearchAssistanceAction",function(){spyOnEvent(this.$node,"uiSearchAssistanceAction"),this.component.select("dismissSelector").click(),expect(this.$node).toBeHidden(),expect("uiSearchAssistanceAction").toHaveBeenTriggeredOnAndWith(this.$node,{component:"spelling_corrections",action:"dismiss",query:"obamma",item_names:["barack obama"]})}),describe("spelling correction in universal search",function(){var a='<div id="timeline">\n          <li class="js-stream-item stream-item stream-spelling-corrections separation-module">\n            <div class="related-items spelling">\n              <div class="dismiss js-action-dismiss-correction" data-query="presodents day" data-search-assistance="">\n                <i class="close"></i>\n              </div>\n              <p>\n                <span class="label">Showing results for </span>\n                <a href="/search?q=presidents%20day&amp;src=corr" class="js-nav corrected-query" rel="nofollow" title="presidents day" data-query="presodents day" data-search-assistance="presidents day"><strong><em>presidents</em> day</strong></a>\n              </p>\n              <p>\n                <a href="/search?q=presodents%20day&amp;src=sprv" class="js-nav spelling-revert-query" rel="nofollow" title="presodents day" data-query="presodents day" data-search-assistance="presodents day">Search instead for presodents day</a>\n              </p>\n            </div>\n          </li>\n        </div>\n      ';beforeEach(function(){setupComponent(a,{wrapperNodeSelector:".stream-spelling-corrections"})}),it("dismisses spelling correction for universal search",function(){spyOnEvent(this.$node,"uiSearchAssistanceAction"),this.component.select("dismissSelector").click(),expect(this.$node.find(".stream-spelling-corrections")).toBeHidden(),expect("uiSearchAssistanceAction").toHaveBeenTriggeredOnAndWith(this.$node,{component:"spelling_corrections",action:"dismiss",query:"presodents day",item_names:["presidents day"]})}),it("fires uiSearchAssistanceAction for spelling revert",function(){spyOnEvent(this.$node,"uiSearchAssistanceAction"),this.component.select("spellingRevertSelector").click(),expect("uiSearchAssistanceAction").toHaveBeenTriggeredOnAndWith(this.$node,{component:"spelling_revert",action:"search",query:"presodents day",item_names:["presodents day"]})})}),it("fires uiSearchAssistanceAction",function(){spyOnEvent(this.$node,"uiSearchAssistanceAction"),this.component.select("spellingCorrectionSelector").click(),expect("uiSearchAssistanceAction").toHaveBeenTriggeredOnAndWith(this.$node,{component:"spelling_corrections",action:"search",query:"obamma",item_names:["barack obama"]})})})})
});
define("test/app/ui/typeahead/typeahead_dropdown_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/typeahead/typeahead_dropdown",function(){var a='<form class="form-search js-search-form  has-saved-searches" action="/search" id="global-nav-search">\n      <span class="search-icon js-search-action">\n        <button type="submit" class="icon nav-search"><span class="visuallyhidden">{{_i}}Search{{/i}}</span></button>\n      </span>\n      <div class="dropdown-menu typeahead js-global-nav-dropdown" style="display: none;">\n        <div class="dropdown-caret">\n          <div class="caret-outer"></div>\n          <div class="caret-inner"></div>\n        </div>\n        <div class="dropdown-inner js-typeahead-results">\n          <ul class="typeahead-items typeahead-topics">\n            <li class="typeahead-item typeahead-topic-item">\n              <a href="/search?q=iphone&src=tyah" data-search-query="iphone" data-query-source="typeahead_click" data-ds="topics">\n                <i class="generic-search"></i>\n                <span>iPhone</span>\n              </a>\n            </li>\n          </ul>\n          <div class="typeahead-saved-searches">\n            <div class="saved-searches-title typeahead-category-title"><span>Saved Searches</span></div>\n            <ul class="typeahead-items saved-searches-list">\n              <li class="typeahead-item typeahead-saved-search-item"><a href="/search?q=%40bs&src=savs" data-search-query="@bs" data-query-source="saved_search_click" data-ds="saved_search">@bs</a></li>\n              <li class="typeahead-item typeahead-saved-search-item"><a href="/search?q=%40mrtall&src=savs" data-search-query="@mrtall" data-query-source="saved_search_click" data-ds="saved_search">@mrtall</a></li>\n              <li class="typeahead-item typeahead-saved-search-item"><a href="/search?q=iPhone&src=savs" data-search-query="iPhone" data-query-source="saved_search_click" data-ds="saved_search">iPhone</a></li>\n              <li class="typeahead-item typeahead-saved-search-item"><a href="/search?q=obama&src=savs" data-search-query="obama" data-query-source="saved_search_click" data-ds="saved_search">obama</a></li>\n            </ul>\n          </div>\n          <div class="typeahead-recent-searches">\n            <div class="recent-searches-title typeahead-category-title"><span>Recent Searches</span></div>\n            <ul class="typeahead-items recent-searches-list">\n              <li class="typeahead-item typeahead-recent-search-item">\n                <span class="icon close"><span class="visuallyhidden">Remove</span></span>\n                <a href="/search?q=%40bs&src=rec" data-search-query="@bs" data-query-source="recent_search_click" data-ds="recent_search"><i class="generic-search"></i>@bs</a>\n              </li>\n              <li class="typeahead-item typeahead-recent-search-item"><a href="/search?q=%40mrtall&src=rec" data-search-query="@mrtall" data-query-source="recent_search_click" data-ds="recent_search">@mrtall</a></li>\n              <li class="typeahead-item typeahead-recent-search-item"><a href="/search?q=iPhone&src=rec" data-search-query="iPhone" data-query-source="recent_search_click" data-ds="recent_search">iPhone</a></li>\n              <li class="typeahead-item typeahead-recent-search-item"><a href="/search?q=obama&src=rec" data-search-query="obama" data-query-source="recent_search_click" data-ds="recent_search">obama</a></li>\n            </ul>\n          </div>\n          <ul class="typeahead-items typeahead-context-list">\n            <li class="typeahead-item typeahead-context-item"><a class="js-nav" href="/search?mode=timeline&q=bs&src=tyah" data-ds="context_helper" data-search-query="bs" tabindex="-1">Search your timeline for bs</a>\n            </li>\n          </ul>\n          <ul class="typeahead-items js-typeahead-accounts">\n            <li data-user-id="98" data-user-screenname="twttr_mail" data-remote="true" data-is-local="true" data-score="" class="typeahead-item typeahead-account-item js-selectable">\n              <a data-query-source="typeahead_click" data-search-query="98" data-ds="account" href="/twttr_mail" title="remote user, weight/score: undefined">\n                <img src="/unversioned_dev_assets/sticky/default_profile_images/default_profile_0_mini.png" width="24" height="24" class="avatar size24">\n                <span class="fullname">Mysteriously Unnamed</span>\n                <i class="verified hidden"></i>\n                <span class="username"><s>@</s><b>twttr_mail</b></span>\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n      <input class="search-input" type="text" id="search-query" placeholder="Enter a #hashtag or keyword" name="q" autocomplete="off" spellcheck="false" tabindex="-1">\n      <input disabled="disabled" class="search-input search-hinting-input" type="text" id="search-query-hint" autocomplete="off" spellcheck="false">\n    </form>\n  ',b='<div>\n      <form class="form-search js-search-form has-saved-searches" action="/search" id="search-form-1">\n        <div class="dropdown-menu typeahead js-global-nav-dropdown" style="display: none;"></div>\n        <input class="search-input" type="text" id="search-form-1-search-query" placeholder="Enter a #hashtag or keyword" name="q" autocomplete="off" spellcheck="false" tabindex="-1">\n        <input disabled="disabled" class="search-input search-hinting-input" type="text" id="search-form-1-search-query-hint" autocomplete="off" spellcheck="false">\n      </form>\n      <form class="form-search js-search-form has-saved-searches" action="/search" id="search-form-2">\n        <div class="dropdown-menu typeahead js-global-nav-dropdown" style="display: none;"></div>\n        <input class="search-input" type="text" id="search-form-2-search-query" placeholder="Enter a #hashtag or keyword" name="q" autocomplete="off" spellcheck="false" tabindex="-1">\n        <input disabled="disabled" class="search-input search-hinting-input" type="text" id="search-form-2-search-query-hint" autocomplete="off" spellcheck="false">\n      </form>\n    </div>\n  ',c='<div class="dropdown-menu typeahead js-global-nav-dropdown" style="display: none;">\n      <div class="dropdown-caret">\n        <div class="caret-outer"></div>\n        <div class="caret-inner"></div>\n      </div>\n      <div class="dropdown-inner js-typeahead-results">\n        <div class="typeahead-saved-searches">\n          <div class="saved-searches-title"><span>Saved Searches</span></div>\n          <ul class="typeahead-items saved-searches-list">\n            Random Content\n          </ul>\n        </div>\n        <div class="typeahead-recent-searches">\n          <div class="recent-searches-title"><span>Recent Searches</span></div>\n          <ul class="typeahead-items recent-searches-list">\n            Random Content\n          </ul>\n        </div>\n        <ul class="typeahead-items topics-list"></ul>\n        <ul class="typeahead-items typeahead-topics"></ul>\n        <ul class="typeahead-items js-typeahead-accounts"></ul>\n      </div>\n    </div>\n  ';beforeEach(function(){var b=$(a);this.$input=b.find("#search-query"),this.$templates=b.find(".dropdown-inner").html(),setupComponent(b,{datasourceRenders:[["some_renderer",["some_datasource"]]]}),b.find(".dropdown-inner").html(this.$templates),this.$items=b.find(".typeahead-items li"),this.component.dropdownId=1,this.$input.focus(),spyOn(this.component,"hide").andCallThrough(),spyOn(this.component,"show").andCallThrough(),this.component.show()}),describe("setting up uiComponents and templates on initialize",function(){it("loads templates from default attrs and the given mustache",function(){var a=$(c);setupComponent(a),expect(this.component.$templateContainer).toBe(a.find(".dropdown-inner")),expect(this.component.$accountsTemplate.length).toBe(1),expect(this.component.$topicsTemplate.length).toBe(1),expect(this.component.$savedSearchesTemplate.length).toBe(1),expect(this.component.$recentSearchesTemplate.length).toBe(1)}),it("tries to load templates from given attrs",function(){setupComponent($(c),{savedSearchesListSelector:".notThis",recentSearchesListSelector:".notThis",topicsListSelector:".orThis",accountsListSelector:".orThis"}),expect(this.component.$accountsTemplate.length).toBe(0),expect(this.component.$topicsTemplate.length).toBe(0),expect(this.component.$savedSearchesTemplate.length).toBe(0),expect(this.component.$recentSearchesTemplate.length).toBe(0)}),it("inserts templates in order",function(){var a=$(c);setupComponent(a,{datasourceRenders:[["accounts",["test1","test2"]],["topics",["topics"]],["recentSearches",["recentSearches"]],["savedSearches",["savedSearches"]],["accounts",["test3"]]]});var b=a.find(".dropdown-inner").children();expect(b.length).toBe(5),expect(b[0]).toHaveClass("block0"),expect(b[0]).toHaveClass("js-typeahead-accounts"),expect(b[1]).toHaveClass("block1"),expect(b[1]).toHaveClass("typeahead-topics"),expect(b[2]).toHaveClass("block2"),expect(b[2]).toHaveClass("typeahead-recent-searches"),expect(b[3]).toHaveClass("block3"),expect(b[3]).toHaveClass("typeahead-saved-searches"),expect(b[4]).toHaveClass("block4"),expect(b[4]).toHaveClass("js-typeahead-accounts"),expect(a.find(".dropdown-inner").children(":visible").length).toBe(0)}),it("can late initialize new uiComponents",function(){var a=$(c);setupComponent(a,{datasourceRenders:[["accounts",["test"]]]});var b=a.find(".dropdown-inner");expect(b.children().length).toBe(1),this.component.addRenderer("accounts",["test2"],{}),expect(b.children().length).toBe(2),expect(b.children()[1]).toHaveClass("block1"),expect(b.children()[1]).toBeHidden()}),it('sets the "aria-autocomplete" attribute on the input to "list"',function(){expect(this.component.$input.attr("aria-autocomplete")).toBe("list")}),it('sets the "aria-haspopup" attribute on the input to "true"',function(){expect(this.component.$input.attr("aria-haspopup")).toBe("true")}),it("gives the dropdown a unique id",function(){var a=$(b);setupComponent(a.find("#search-form-1"),{datasourceRenders:[["some_renderer",["some_datasource"]]]}),setupComponent(a.find("#search-form-2"),{datasourceRenders:[["some_renderer",["some_datasource"]]]});var c=$("#search-form-1 .dropdown-menu"),d=$("#search-form-2 .dropdown-menu");expect(c.attr("id")).not.toEqual(d.attr("id"))}),it('sets the "aria-controls" attribute on the input to the id of the dropdown',function(){expect(this.component.$input.attr("aria-controls")).toBe(this.component.select("dropdownSelector").attr("id"))}),describe("when pushState page change occurs",function(){it("resets the dropdown state to the initially loaded templates",function(){var a=".typeahead-items li";expect(this.component.$node.find(a).length).toBe(11),this.component.$node.find(".dropdown-inner").empty(),expect(this.component.$node.find(a).length).toBe(0),this.component.trigger("uiBeforePageChanged",{}),expect(this.component.$node.find(a).length).toBe(11)})})}),describe("when the mouse hovers over a search result",function(){it('adds "selected" class to the list item',function(){var a=this.$items.find("a").first();expect(this.$items).not.toHaveClass("selected");var b=jQuery.Event("mouseover");b.srcElement=a,b.srcElement.parentElement=this.$items.first(),a.trigger(b),expect(this.$items.first()).toHaveClass("selected")})}),describe("mouse selection events",function(){describe("clicking on a saved search result",function(){it("triggers uiTypeaheadItemSelected with the saved search source",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.component.lastQuery="b";var a=this.$items.filter(".typeahead-saved-search-item").first();a.addClass("selected"),a.trigger("click"),expect("uiTypeaheadItemSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isSearchInput:!0,index:0,source:"saved_search",input:"b",query:"@bs",display:"@bs",href:"/search?q=%40bs&src=savs",isClick:!1})})}),describe("clicking on a topic result",function(){it("triggers uiTypeaheadItemSelected with topics",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.component.lastQuery="i";var a=this.$items.filter(".typeahead-topic-item").first();a.addClass("selected"),a.trigger("click"),expect("uiTypeaheadItemSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isSearchInput:!0,index:0,source:"topics",input:"i",query:"iphone",display:"iphone",href:"/search?q=iphone&src=tyah",isClick:!1})}),it("does not trigger uiTypeaheadItemSelected with topics if not search input",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.component.lastQuery="i";var a=this.$items.filter(".typeahead-topic-item").first();a.addClass("selected"),this.$node.find("input").removeClass("search-input"),a.trigger("click"),expect("uiTypeaheadItemSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isSearchInput:!1,index:0,source:"topics",input:"i",query:"iphone",display:"iphone",href:"/search?q=iphone&src=tyah",isClick:!1})})}),describe("clicking on a recent search result",function(){it("triggers uiTypeaheadItemSelected with the recent search source",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.component.lastQuery="b";var a=this.$items.filter(".typeahead-recent-search-item").last();a.addClass("selected"),a.trigger("click"),expect("uiTypeaheadItemSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isSearchInput:!0,index:3,source:"recent_search",query:"obama",input:"b",display:"obama",href:"/search?q=obama&src=rec",isClick:!1})}),it("does not trigger uiTypeaheadItemSelected if deleting a recent search",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.component.lastQuery="b";var a=$(this.$items[4]).find(".close.recent-search");a.trigger("click"),expect("uiTypeaheadItemSelected").not.toHaveBeenTriggeredOn(this.$node)})}),describe("clicking on an account",function(){it("triggers uiTypeaheadItemSelected with the account source",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.component.lastQuery="Mysterious";var a=this.$items.filter(".typeahead-account-item").first(),b={origin:"remote"};spyOn(this.component,"getItemData").andReturn(b),a.addClass("selected"),a.trigger("click"),expect("uiTypeaheadItemSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isSearchInput:!0,index:0,source:"account",input:"Mysterious",query:"98",display:"twttr_mail",href:"/twttr_mail",isClick:!1,item:b})})})}),describe("keyboard selection events",function(){describe("When an item is selected",function(){it('sets the "aria-activedescendant" attribute on the input to the id of the anchor for the selected item',function(){this.$input.trigger("uiTypeaheadInputMoveDown");var a=this.component.select("dropdownSelector"),b=this.component.select("dropdownSelector").find(this.component.attr.selectedItemSelector),c=b.find("a");expect(this.$input.attr("aria-activedescendant")).toBe(c.attr("id"))}),describe("and the browser is Safari",function(){it("triggers the uiShouldSpeakText event",function(){var a=$.browser.safari;$.browser.safari=!0,spyOnEvent(this.component.select("dropdownSelector"),"uiShouldSpeakText"),this.$input.trigger("uiTypeaheadInputMoveDown");var b=this.component.select("dropdownSelector"),c=this.component.select("selectedItemSelector"),d=c.find("a");expect("uiShouldSpeakText").toHaveBeenTriggeredOnAndWith(b,{text:d.text()}),$.browser.safari=a}),describe("and the item is in a category",function(){it("triggers the uiShouldSpeakText event with the category title text",function(){var a=$.browser.safari;$.browser.safari=!0,spyOnEvent(this.component.select("dropdownSelector"),"uiShouldSpeakText");var b=this.component.select("dropdownSelector"),c=this.component.select("itemsSelector").first().addClass(this.component.attr.selectedClass);this.$input.trigger("uiTypeaheadInputMoveDown");var d=this.component.select("selectedItemSelector"),e=d.find("a"),f=d.closest(this.component.attr.itemsContainerSelector).prev(this.component.attr.categoryTitle),g=[e.text(),f.text()].join(" ");expect("uiShouldSpeakText").toHaveBeenTriggeredOnAndWith(b,{text:g}),$.browser.safari=a})})})}),describe("up",function(){it("wraps to bottom when nothing is selected",function(){this.$input.trigger("uiTypeaheadInputMoveUp"),expect(this.$items.last()).toHaveClass("selected")}),describe("when the first item is selected",function(){beforeEach(function(){this.$items.first().addClass("selected"),this.$input.attr("aria-activedescendant","foo"),spyOnEvent(this.component.$node,"uiTypeaheadSelectionCleared"),this.$input.focus(),this.$input.trigger("uiTypeaheadInputMoveUp")}),it("clears the current selection",function(){expect(this.$items).not.toHaveClass("selected")}),it('removes the "aria-activedescendant" attribute from the input',function(){expect(this.$input).not.toHaveAttr("aria-activedescendant")}),it("triggers the uiTypeaheadSelectionCleared event",function(){expect("uiTypeaheadSelectionCleared").toHaveBeenTriggeredOn(this.component.$node)})}),it("selects the previous result if the selection index is > 1",function(){var a=this.$items.eq(2),b=this.$items.eq(1);a.addClass("selected"),this.$input.trigger("uiTypeaheadInputMoveUp"),expect(a).not.toHaveClass("selected"),expect(b).toHaveClass("selected")})}),describe("down",function(){it("selects the first result if nothing else is selected",function(){this.$input.trigger("uiTypeaheadInputMoveDown"),expect(this.$items.eq(0)).toHaveClass("selected")}),it("selects the next result if another result is selected",function(){var a=this.$items.eq(0),b=this.$items.eq(1);a.addClass("selected"),this.$input.trigger("uiTypeaheadInputMoveDown"),expect(a).not.toHaveClass("selected"),expect(b).toHaveClass("selected")}),describe("when the last result is selected",function(){beforeEach(function(){this.$items.last().addClass("selected"),this.$input.attr("aria-activedescendant","foo"),spyOnEvent(this.component.$node,"uiTypeaheadSelectionCleared"),this.$input.trigger("uiTypeaheadInputMoveDown")}),it("clears the current selection",function(){expect(this.$items.last()).not.toHaveClass("selected")}),it('removes the "aria-activedescendant" attribute from the input',function(){expect(this.$input).not.toHaveAttr("aria-activedescendant")}),it("triggers the uiTypeaheadSelectionCleared event",function(){expect("uiTypeaheadSelectionCleared").toHaveBeenTriggeredOn(this.component.$node)})})}),describe("tab/left/right",function(){describe("when something is selected",function(){it("triggers uiTypeaheadItemPossiblyComplete when a result is selected",function(){spyOnEvent(this.$node,"uiTypeaheadItemPossiblyComplete");var a=this.$items.filter(".typeahead-saved-search-item").first();a.addClass("selected"),this.component.lastQuery="",this.$input.trigger("uiTypeaheadInputAutocomplete"),expect("uiTypeaheadItemPossiblyComplete").toHaveBeenTriggeredOnAndWith(this.$node,{value:a.find("a").data("search-query"),source:a.find("a").data("ds"),index:this.$items.index(a),query:a.find("a").data("search-query"),display:"@bs",input:"",href:a.find("a").attr("href")})}),it("triggers uiTypeaheadItemPossiblyComplete autocompleteAccounts is true and result has data source account",function(){spyOnEvent(this.$node,"uiTypeaheadItemPossiblyComplete");var a=this.$items.filter(".typeahead-account-item").first();a.addClass("selected"),this.component.attr.autocompleteAccounts=!0,this.component.lastQuery="",this.$input.trigger("uiTypeaheadInputAutocomplete"),expect("uiTypeaheadItemPossiblyComplete").toHaveBeenTriggeredOnAndWith(this.$node,{value:a.find("a").data("search-query"),source:a.find("a").data("ds"),index:this.$items.index(a),query:a.find("a").data("search-query"),display:"twttr_mail",input:"",href:a.find("a").attr("href")})}),it("does not trigger if autocompleteAccounts is false and result has data source account",function(){spyOnEvent(this.$node,"uiTypeaheadItemPossiblyComplete");var a=$(this.$items[9]);a.addClass("selected"),this.component.attr.autocompleteAccounts=!1,this.component.lastQuery="",this.$input.trigger("uiTypeaheadInputAutocomplete"),expect("uiTypeaheadItemPossiblyComplete").not.toHaveBeenTriggeredOn(this.$node)})}),describe("when nothing is selected",function(){it("triggers uiTypeaheadItemPossiblyComplete on first item",function(){spyOnEvent(this.$node,"uiTypeaheadItemPossiblyComplete");var a=this.$items.filter(".typeahead-topic-item").first();this.component.lastQuery="",this.$input.trigger("uiTypeaheadInputAutocomplete"),expect("uiTypeaheadItemPossiblyComplete").toHaveBeenTriggeredOnAndWith(this.$node,{value:a.find("a").data("search-query"),source:a.find("a").data("ds"),index:this.$items.index(a),query:a.find("a").data("search-query"),display:"iphone",input:"",href:a.find("a").attr("href")})}),it("does nothing if the dropdown is not visible",function(){spyOnEvent(this.$node,"uiTypeaheadItemPossiblyComplete");var a=this.$items.first();this.component.lastQuery="",this.component.hide(),this.$input.trigger("uiTypeaheadInputAutocomplete"),expect("uiTypeaheadItemPossiblyComplete").not.toHaveBeenTriggeredOn(this.$node)})})}),describe("enter",function(){describe("when something is selected",function(){describe("selecting a saved search",function(){beforeEach(function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.component.lastQuery="b";var a=this.$items.filter(".typeahead-saved-search-item").first();a.addClass("selected"),this.$input.attr("aria-activedescendant","foo"),this.$input.trigger("uiTypeaheadInputSubmit")}),it("triggers uiTypeaheadItemSelected with the saved search source",function(){expect("uiTypeaheadItemSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isSearchInput:!0,index:0,source:"saved_search",input:"b",query:"@bs",display:"@bs",href:"/search?q=%40bs&src=savs",isClick:!1})}),it('removes the "aria-activedescendant" attribute from the input',function(){expect(this.$input).not.toHaveAttr("aria-activedescendant")})}),describe("selecting an account",function(){it("triggers uiTypeaheadItemSelected with the account source",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.component.lastQuery="Mysterious";var a={origin:"prefetch"};spyOn(this.component,"getItemData").andReturn(a);var b=this.$items.filter(".typeahead-account-item").first();b.addClass("selected"),this.$input.trigger("uiTypeaheadInputSubmit"),expect("uiTypeaheadItemSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isSearchInput:!0,index:0,source:"account",input:"Mysterious",display:"twttr_mail",query:"98",href:"/twttr_mail",isClick:!1,item:a})})})}),describe("when nothing is selected",function(){it("does nothing when there's no input",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),spyOnEvent(this.$node,"uiTypeaheadSubmitQuery"),this.$input.trigger("uiTypeaheadInputSubmit"),expect("uiTypeaheadItemSelected").not.toHaveBeenTriggeredOn(this.$node),expect("uiTypeaheadSubmitQuery").not.toHaveBeenTriggeredOn(this.$node)}),it("does nothing when the input is all whitespace",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),spyOnEvent(this.$node,"uiTypeaheadSubmitQuery"),this.$input.val("     "),this.$input.trigger("uiTypeaheadInputSubmit"),expect("uiTypeaheadItemSelected").not.toHaveBeenTriggeredOn(this.$node),expect("uiTypeaheadSubmitQuery").not.toHaveBeenTriggeredOn(this.$node)}),it("triggers uiTypeaheadItemSelected with the search source",function(){spyOnEvent(this.$node,"uiTypeaheadSubmitQuery"),spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.$input.val("dsflkdsfdsfdsfjsdf"),this.$input.trigger("uiTypeaheadInputSubmit"),expect("uiTypeaheadSubmitQuery").toHaveBeenTriggeredOnAndWith(this.$node,{query:"dsflkdsfdsfdsfjsdf"}),expect("uiTypeaheadItemSelected").not.toHaveBeenTriggeredOn(this.$node)})})})}),describe("uiTypeaheadInputChanged",function(){beforeEach(function(){spyOnEvent(this.$node,"uiNeedsTypeaheadSuggestions")}),it("triggers uiNeedsTypeaheadSuggestions and sets lastQuery",function(){this.$input.trigger("uiTypeaheadInputChanged",{value:"search"}),expect(this.component.lastQuery).toEqual("search"),expect("uiNeedsTypeaheadSuggestions").toHaveBeenTriggeredOnAndWith(this.$node,{datasources:["some_datasource"],queryData:{query:"search"},id:1})}),it("triggers uiNeedsTypeaheadSuggestions without trimming whitespace",function(){this.$input.trigger("uiTypeaheadInputChanged",{value:"  search  "}),expect("uiNeedsTypeaheadSuggestions").toHaveBeenTriggeredOnAndWith(this.$node,{datasources:["some_datasource"],queryData:{query:"  search  "},id:1})}),it("triggers uiNeedsTypeaheadSuggestions, merging in datasourceOptions",function(){this.component.attr.datasourceOptions={testKey:"testValue"},this.$input.trigger("uiTypeaheadInputChanged",{value:"search"}),expect("uiNeedsTypeaheadSuggestions").toHaveBeenTriggeredOnAndWith(this.$node,{datasources:["some_datasource"],queryData:{query:"search",testKey:"testValue"},id:1})})}),describe("when the show method is called",function(){beforeEach(function(){this.component.hide()}),it("shows the dropdown",function(){this.component.show(),expect(this.component.select("dropdownSelector")).toBeVisible()}),it('sets the "aria-hidden" attribute to "false"',function(){this.component.show(),expect(this.component.select("dropdownSelector").attr("aria-hidden")).toBe("false")}),it("triggers the uiTypeaheadResultsShown event",function(){spyOnEvent(this.component.node,"uiTypeaheadResultsShown"),this.component.show(),expect("uiTypeaheadResultsShown").toHaveBeenTriggeredOn(this.component.node)})}),describe("when the hide method is called",function(){it("hides the dropdown",function(){this.component.hide(),expect(this.component.select("dropdownSelector")).toBeHidden()}),it('sets the "aria-hidden" attribute to "true"',function(){this.component.hide(),expect(this.component.select("dropdownSelector").attr("aria-hidden")).toBe("true")}),it('removes the the "aria-activedescendant" attribute from the input',function(){this.component.hide(),expect(this.component.$input).not.toHaveAttr("aria-activedescendant")}),it("triggers the uiTypeaheadResultsHidden event",function(){spyOnEvent(this.component.node,"uiTypeaheadResultsHidden"),this.component.hide(),expect("uiTypeaheadResultsHidden").toHaveBeenTriggeredOn(this.component.node)})}),describe("uiTypeaheadRenderResults",function(){var a={id:1,suggestions:{},queryData:{query:"test"}};beforeEach(function(){this.component.lastQuery="test",spyOnEvent(this.$node,"uiTypeaheadRenderResults")}),it("does not get triggered if id is different",function(){this.component.dropdownId=2,this.component.trigger("dataTypeaheadSuggestionsResults",a),expect("uiTypeaheadRenderResults").not.toHaveBeenTriggeredOn(this.$node)}),it("does not trigger if the query is outdated",function(){this.component.lastQuery="foo",this.component.trigger("dataTypeaheadSuggestionsResults",a),expect("uiTypeaheadRenderResults").not.toHaveBeenTriggeredOn(this.$node)}),it("is triggered with suggestions",function(){this.component.trigger("dataTypeaheadSuggestionsResults",a),expect("uiTypeaheadRenderResults").toHaveBeenTriggeredOnAndWith(this.$node,a)}),it("maintains selection when an item is previously selected",function(){var b=this.component.$node.find(".typeahead-topics li").first(),c=b.clone(!1);b.addClass("selected"),this.component.on("uiTypeaheadRenderResults",function(){this.$node.find(".typeahead-topics").empty(),this.$node.find(".typeahead-topics").append(c)}),this.component.trigger("dataTypeaheadSuggestionsResults",a),expect(this.component.$node.find(".typeahead-topics li").first()).toHaveClass("selected")}),it("shows dropdown if there are suggestions",function(){this.component.hide();var b=$.extend({},a,{suggestions:{some_datasource:["test"]}});this.component.$input.focus(),this.component.trigger("dataTypeaheadSuggestionsResults",b),expect(this.component.show).toHaveBeenCalled()}),it("hides dropdown if there are no suggestions",function(){var b=$.extend({},a,{suggestions:{some_datasource:[]}});this.component.trigger("dataTypeaheadSuggestionsResults",b),expect(this.component.hide).toHaveBeenCalled()}),it("hides dropdown if page changes (pushstate)",function(){this.component.trigger("uiBeforePageChanged",{}),expect(this.component.hide).toHaveBeenCalled()}),it("hides dropdown if page changes even if the mose is over (pushstate)",function(){this.component.mouseIsOverDropdown=!0,this.component.trigger("uiBeforePageChanged",{}),expect(this.component.hide).toHaveBeenCalled()}),describe("if there are suggestions",function(){beforeEach(function(){spyOnEvent(this.$node,"uiTypeaheadSetPreventDefault"),spyOnEvent(this.$node,"uiTypeaheadResultsShown");var b=$.extend({},a,{suggestions:{some_datasource:["test"]}});this.component.$input.focus(),this.component.trigger("dataTypeaheadSuggestionsResults",b)}),it("triggers uiTypeaheadSetPreventDefault with preventDefault set to true",function(){expect("uiTypeaheadSetPreventDefault").toHaveBeenTriggeredOnAndWith(this.$node,{preventDefault:!0,key:9})}),it("triggers uiTypeaheadResultsShown",function(){expect("uiTypeaheadResultsShown").toHaveBeenTriggeredOn(this.$node)})}),describe("if there is a saved search, but no search query in the input field",function(){beforeEach(function(){spyOnEvent(this.$node,"uiTypeaheadSetPreventDefault"),spyOnEvent(this.$node,"uiTypeaheadResultsShown");var b=$.extend({},a,{queryData:{query:""},suggestions:{some_datasource:["test"]}});this.component.lastQuery="",this.component.$input.focus(),this.component.trigger("dataTypeaheadSuggestionsResults",b)}),it("triggers uiTypeaheadSetPreventDefault with preventDefault set to false",function(){expect("uiTypeaheadSetPreventDefault").toHaveBeenTriggeredOnAndWith(this.$node,{preventDefault:!1,key:9})}),it("triggers uiTypeaheadResultsShown",function(){expect("uiTypeaheadResultsShown").toHaveBeenTriggeredOn(this.$node)})}),describe("if the user entered a search query, but there are no suggestions",function(){beforeEach(function(){spyOnEvent(this.$node,"uiTypeaheadSetPreventDefault"),spyOnEvent(this.$node,"uiTypeaheadResultsHidden");var b=$.extend({},a,{suggestions:{some_datasource:[]}});this.component.$input.focus(),this.component.trigger("dataTypeaheadSuggestionsResults",b)}),it("triggers uiTypeaheadSetPreventDefault to enable default tabbing and results hidden event if there are no suggestions",function(){expect("uiTypeaheadSetPreventDefault").toHaveBeenTriggeredOnAndWith(this.$node,{preventDefault:!1,key:9}),expect("uiTypeaheadResultsHidden").toHaveBeenTriggeredOn(this.$node)}),it("triggers uiTypeaheadSetPreventDefault with preventDefault set to false",function(){expect("uiTypeaheadSetPreventDefault").toHaveBeenTriggeredOnAndWith(this.$node,{preventDefault:!1,key:9})}),it("triggers uiTypeaheadResultsHidden",function(){expect("uiTypeaheadResultsHidden").toHaveBeenTriggeredOn(this.$node)})}),it("triggers uiTypeaheadResultsHidden on hide event",function(){spyOnEvent(this.$node,"uiTypeaheadResultsHidden"),this.component.hide(),expect("uiTypeaheadResultsHidden").toHaveBeenTriggeredOn(this.$node)}),it("hides dropdown if input is not focused",function(){this.$input.blur();var b=$.extend({},a,{suggestions:{some_datasource:["test"]}});this.component.trigger("dataTypeaheadSuggestionsResults",b),expect(this.component.$dropdown).toBeHidden()})}),describe("blur on searchField",function(){beforeEach(function(){this.$input.val("search")}),it("closes the typeahead dropdown",function(){this.$input.blur(),expect(this.component.select("dropdownSelector")).toBeHidden()})}),describe("uiTypeaheadInputSubmit",function(){it("triggers uiTypeaheadItemSelected when something is selected",function(){spyOnEvent(this.$node,"uiTypeaheadItemSelected"),this.component.lastQuery="Mysterious";var a=this.$items.filter(".typeahead-account-item").first(),b={origin:"yup"};spyOn(this.component,"getItemData").andReturn(b),a.addClass("selected"),this.$input.trigger("uiTypeaheadInputSubmit"),expect("uiTypeaheadItemSelected").toHaveBeenTriggeredOnAndWith(this.$node,{isSearchInput:!0,index:0,source:"account",input:"Mysterious",query:"98",display:"twttr_mail",isClick:!1,href:"/twttr_mail",item:b}),expect(this.component.hide).toHaveBeenCalled()}),it("triggers uiTypeaheadSubmitQuery when nothing is selected",function(){spyOnEvent(this.$node,"uiTypeaheadSubmitQuery"),this.$input.val("dsflkdsfdsfdsfjsdf"),this.$input.trigger("uiTypeaheadInputSubmit"),expect("uiTypeaheadSubmitQuery").toHaveBeenTriggeredOnAndWith(this.$node,{query:"dsflkdsfdsfdsfjsdf"}),expect(this.component.hide).toHaveBeenCalled()})}),describe("uiShortcutEsc",function(){beforeEach(function(){this.component.mouseIsOverDropdown=!0,this.$input.val("search"),this.$input.focus(),this.component.trigger(this.$input,"uiShortcutEsc")}),it("sets the mouseIsOverDropdown state property to false",function(){expect(this.component.mouseIsOverDropdown).toBe(!1)}),it("hides the dropdown",function(){expect(this.component.select("dropdownSelector")).toBeHidden(),this.$input.blur()})}),describe("uiTypeaheadInputTab",function(){beforeEach(function(){this.component.mouseIsOverDropdown=!0,this.$input.val("search"),this.$input.focus(),this.$input.trigger("uiTypeaheadInputTab"),this.$input.blur()}),it("sets the mouseIsOverDropdown state property to false",function(){expect(this.component.mouseIsOverDropdown).toBe(!1)}),it("hides the dropdown",function(){expect(this.component.select("dropdownSelector")).toBeHidden()})})})
});
define("test/app/ui/typeahead/accounts_renderer_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/typeahead/accounts_renderer",function(){var a={queryData:{query:"<script>le_query</script>"},suggestions:{dmAccounts:[{profile_use_background_image:!0,created_at:"Sun Jul 18 00:00:00 +0000 2010",location:null,default_profile_image:!0,profile_background_color:"C0DEED",suspended:!1,follow_request_sent:!1,following:!1,show_all_inline_media:!1,contributors_enabled:!1,lang:"en",profile_background_image_url:"/unversioned_dev_assets/images/themes/theme1/bg.png",profile_text_color:"333333",utc_offset:null,url:null,tokens:["designer5","designer","five"],is_translator:!1,notifications:!1,profile_background_image_url_https:"/unversioned_dev_assets/images/themes/theme1/bg.png",time_zone:null,profile_link_color:"0084B4",deactivated_bit:!1,listed_count:1,geo_enabled:!1,followers_count:0,description:null,profile_sidebar_fill_color:"DDEEF6","protected":!1,profile_image_url_https:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_normal.png",screen_name:"designer4",id_str:"503",default_profile:!0,verified:!1,friends_count:0,profile_image_url:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_normal.png",name:"Designer Five",statuses_count:0,favourites_count:0,profile_sidebar_border_color:"C0DEED",id:504,profile_background_tile:!1,rounded_graph_weight:2}],accounts:[{profile_use_background_image:!0,created_at:"Sun Jul 18 00:00:00 +0000 2010",location:null,default_profile_image:!0,profile_background_color:"C0DEED",suspended:!1,follow_request_sent:!1,following:!1,show_all_inline_media:!1,contributors_enabled:!1,lang:"en",profile_background_image_url:"/unversioned_dev_assets/images/themes/theme1/bg.png",profile_text_color:"333333",utc_offset:null,url:null,tokens:["designer4","designer","four"],is_translator:!1,notifications:!1,profile_background_image_url_https:"/unversioned_dev_assets/images/themes/theme1/bg.png",time_zone:null,profile_link_color:"0084B4",deactivated_bit:!1,listed_count:1,geo_enabled:!1,followers_count:0,description:null,profile_sidebar_fill_color:"DDEEF6","protected":!1,profile_image_url_https:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_normal.png",screen_name:"designer4",id_str:"503",default_profile:!0,verified:!1,friends_count:0,profile_image_url:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_normal.png",name:"Designer Four",statuses_count:0,favourites_count:0,profile_sidebar_border_color:"C0DEED",id:503,profile_background_tile:!1,rounded_graph_weight:2},{profile_use_background_image:!0,created_at:"Sun Jul 18 00:00:00 +0000 2010",location:null,default_profile_image:!0,profile_background_color:"C0DEED",suspended:!1,follow_request_sent:!1,following:!1,show_all_inline_media:!1,contributors_enabled:!1,lang:"en",profile_background_image_url:"/unversioned_dev_assets/images/themes/theme1/bg.png",profile_text_color:"333333",utc_offset:null,url:null,tokens:["designer3","mysteriously","unnamed"],is_translator:!1,notifications:!1,profile_background_image_url_https:"/unversioned_dev_assets/images/themes/theme1/bg.png",time_zone:null,profile_link_color:"0084B4",deactivated_bit:!1,listed_count:1,geo_enabled:!1,followers_count:0,description:null,profile_sidebar_fill_color:"DDEEF6","protected":!1,profile_image_url_https:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",screen_name:"designer3",id_str:"502",default_profile:!0,verified:!0,friends_count:0,profile_image_url:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_5_normal.png",name:"Mysteriously Unnamed",statuses_count:0,favourites_count:0,profile_sidebar_border_color:"C0DEED",id:502,profile_background_tile:!1,rounded_score:4},{connecting_user_count:2,social_proof:2,first_connecting_user_name:"Frank Jones",profile_use_background_image:!0,created_at:"Sun Jul 18 00:00:00 +0000 2010",location:null,default_profile_image:!0,profile_background_color:"C0DEED",suspended:!1,follow_request_sent:!1,following:!1,show_all_inline_media:!1,contributors_enabled:!1,lang:"en",profile_background_image_url:"/unversioned_dev_assets/images/themes/theme1/bg.png",profile_text_color:"333333",utc_offset:null,url:null,tokens:["designer4","designer","four"],is_translator:!1,notifications:!1,profile_background_image_url_https:"/unversioned_dev_assets/images/themes/theme1/bg.png",time_zone:null,profile_link_color:"0084B4",deactivated_bit:!1,listed_count:1,geo_enabled:!1,followers_count:0,description:null,profile_sidebar_fill_color:"DDEEF6","protected":!1,profile_image_url_https:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_normal.png",screen_name:"designer4",id_str:"503",default_profile:!0,verified:!1,friends_count:0,profile_image_url:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_normal.png",name:"Designer Four",statuses_count:0,favourites_count:0,profile_sidebar_border_color:"C0DEED",id:503,profile_background_tile:!1,rounded_graph_weight:2},{profile_use_background_image:!0,created_at:"Sun Jul 18 00:00:00 +0000 2010",location:null,default_profile_image:!0,profile_background_color:"C0DEED",suspended:!1,follow_request_sent:!1,following:!1,show_all_inline_media:!1,contributors_enabled:!1,lang:"en",profile_background_image_url:"http://s3.amazonaws.com/twitter_development/profile_background_images/1/custom_bg.jpg",profile_text_color:"333333",utc_offset:null,url:null,tokens:["designer2","mysteriously","unnamed"],is_translator:!1,notifications:!1,profile_background_image_url_https:"http://s3.amazonaws.com/twitter_development/profile_background_images/1/custom_bg.jpg",time_zone:null,profile_link_color:"0084B4",deactivated_bit:!1,listed_count:1,geo_enabled:!1,followers_count:0,description:null,profile_sidebar_fill_color:"DDEEF6","protected":!1,profile_image_url_https:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_4_normal.png",screen_name:"designer2",id_str:"501",default_profile:!0,verified:!1,friends_count:0,profile_image_url:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_4_normal.png",name:"Mysteriously Unnamed",statuses_count:0,favourites_count:0,profile_sidebar_border_color:"C0DEED",id:501,profile_background_tile:!1},{profile_use_background_image:!0,created_at:"Sun Jul 18 00:00:00 +0000 2010",location:null,default_profile_image:!0,profile_background_color:"C0DEED",suspended:!1,follow_request_sent:!1,following:!1,show_all_inline_media:!1,contributors_enabled:!1,lang:"en",profile_background_image_url:"/unversioned_dev_assets/images/themes/theme1/bg.png",profile_text_color:"333333",utc_offset:null,url:null,tokens:["designer1","mysteriously","unnamed"],is_translator:!1,notifications:!1,profile_background_image_url_https:"/unversioned_dev_assets/images/themes/theme1/bg.png",time_zone:null,profile_link_color:"0084B4",deactivated_bit:!1,listed_count:1,geo_enabled:!1,followers_count:1,description:null,profile_sidebar_fill_color:"DDEEF6","protected":!1,profile_image_url_https:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_3_normal.png",screen_name:"designer1",id_str:"500",default_profile:!0,verified:!1,friends_count:1,profile_image_url:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_3_normal.png",name:"Mysteriously Unnamed",statuses_count:0,favourites_count:0,profile_sidebar_border_color:"C0DEED",id:500,profile_background_tile:!1},{profile_use_background_image:!0,created_at:"Wed Jun 06 18:23:04 +0000 2012",location:null,default_profile_image:!0,profile_background_color:"C0DEED",status:{geo:null,created_at:"Tue Feb 03 21:44:25 +0000 2009",truncated:!1,contributors:null,place:null,coordinates:null,in_reply_to_status_id_str:null,retweet_count:2,in_reply_to_screen_name:null,in_reply_to_user_id:null,in_reply_to_user_id_str:null,retweeted:!1,text:"RT @mrtall: foo ...",id_str:"87",source:"web",id:87,retweeted_status:{geo:null,created_at:"Mon Nov 03 23:10:35 +0000 2008",truncated:!1,contributors:null,place:null,coordinates:null,in_reply_to_status_id_str:null,retweet_count:2,in_reply_to_screen_name:null,in_reply_to_user_id:null,in_reply_to_user_id_str:null,retweeted:!1,text:"foo ...",id_str:"48",source:"web",id:48,in_reply_to_status_id:null,favorited:!1},in_reply_to_status_id:null,favorited:!1},suspended:!1,follow_request_sent:!1,following:!1,show_all_inline_media:!1,contributors_enabled:!1,lang:"en",profile_background_image_url:"/unversioned_dev_assets/images/themes/theme1/bg.png",profile_text_color:"333333",utc_offset:null,url:null,tokens:["twitter","dev"],is_translator:!1,notifications:!1,profile_background_image_url_https:"/unversioned_dev_assets/images/themes/theme1/bg.png",time_zone:null,profile_link_color:"0084B4",deactivated_bit:!1,listed_count:0,geo_enabled:!1,followers_count:0,description:"User executing requests from dev.twitter.com (i.e. for accounts syncing)",profile_sidebar_fill_color:"DDEEF6","protected":!1,profile_image_url_https:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_4_normal.png",screen_name:"twitter_dev",id_str:"25",default_profile:!0,verified:!1,friends_count:0,profile_image_url:"/unversioned_dev_assets/sticky/default_profile_images/default_profile_4_normal.png",name:"Twitter dev",statuses_count:1,favourites_count:0,profile_sidebar_border_color:"C0DEED",id:25,profile_background_tile:!1}]}},b='<div class="dropdown-menu typeahead">\n      <div class="dropdown-caret">\n        <div class="caret-outer"></div>\n        <div class="caret-inner"></div>\n      </div>\n      <div class="dropdown-inner js-typeahead-results">\n        <ul class="typeahead-items typeahead-accounts js-typeahead-accounts">\n          {{! data-user-id, data-user-screenname and data-score are filled in js}}\n          <li data-user-id="" data-user-screenname="" data-remote="true" data-score="" class="typeahead-item typeahead-account-item js-selectable">\n            {{! href, img\'s src, name and full name are filled by js}}\n            <a class="js-nav typeahead" data-query-source="typeahead_click" data-search-query="" data-ds="account">\n              <img width="32" height="32" class="avatar size32">\n              <div class="typeahead-user-item-info">\n                <span class="fullname"></span>\n                <span class="js-verified hidden">{{>verified_account_badge}}</span>\n                <span class="username"><s>@</s><b></b></span>\n              </div>\n              <div class="typeahead-social-context"></div>\n            </a>\n          </li>\n          <li class="js-selectable typeahead-accounts-shortcut js-shortcut"><a class="js-nav" href="" data-search-query="" data-query-source="typeahead_click" data-shortcut="true" data-ds="account_search"></a></li>\n        </ul>\n      </div>\n    </div>\n  ';beforeEach(function(){setupComponent($(b),{deciders:{showDebugInfo:!1,showSocialContext:!0}}),this.$node.show()}),describe("uiTypeaheadRenderResults",function(){it("only leaves the shortcut and hides the list if no suggestions",function(){this.component.trigger("uiTypeaheadRenderResults",{suggestions:{}}),expect(this.component.$accountsList.find(this.component.attr.accountsItemSelector).length).toBe(0),expect(this.component.$accountsList.find(this.component.attr.accountsShortcutSelector).length).toBe(1),expect(this.component.$accountsList).toBeHidden()}),it("creates DOM nodes for each account with social context",function(){this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$accountsList.find(this.component.attr.accountsItemSelector);expect(b.length).toBe(6);var c=b.first(),d=a.suggestions.accounts[0];expect(c.attr("data-user-id")).toEqual(""+d.id),expect(c.attr("data-user-screenname")).toEqual(d.screen_name);var e=c.find("a");expect(e.attr("href")).toEqual("/"+d.screen_name),expect(e.attr("data-search-query")).toEqual(d.id.toString()),expect(e.attr("title")).toBeUndefined(),expect(e.find(".avatar").attr("src")).toEqual("/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_normal.png"),expect(e.find(".fullname").text()).toEqual(d.name),expect(e.find(".username b").text()).toEqual(d.screen_name),expect(e.find(".js-verified")).toBe(".hidden"),expect(c.next().find(".js-verified")).not.toBe("hidden");var f=c.next().next();expect(f.find(".typeahead-social-context").text()).toEqual("Followed by Frank Jones and 2 others"),expect(this.component.$accountsList).toBeVisible()}),it("creates DOM nodes for each account correctly without social context",function(){this.component.attr.deciders.showSocialContext=!1,this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$accountsList.find(this.component.attr.accountsItemSelector);expect(b.length).toBe(6);var c=b.first(),d=a.suggestions.accounts[0];expect(c.attr("data-user-id")).toEqual(""+d.id),expect(c.attr("data-user-screenname")).toEqual(d.screen_name);var e=c.find("a");expect(e.attr("href")).toEqual("/"+d.screen_name),expect(e.attr("data-search-query")).toEqual(d.id.toString()),expect(e.attr("title")).toBeUndefined(),expect(e.find(".avatar").attr("src")).toEqual("/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_mini.png"),expect(e.find(".fullname").text()).toEqual(d.name),expect(e.find(".username b").text()).toEqual(d.screen_name),expect(e.find(".js-verified")).toBe(".hidden"),expect(c.next().find(".js-verified")).not.toBe("hidden"),expect(this.component.$accountsList).toBeVisible()}),it("appends dmAccounts too if given dmAccounts as a datasource",function(){this.component.attr.deciders.showSocialContext=!1,this.component.attr.datasources=["accounts","dmAccounts"],this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$accountsList.find(this.component.attr.accountsItemSelector);expect(b.length).toBe(7);var c=b.last(),d=a.suggestions.dmAccounts[0];expect(c.attr("data-user-id")).toEqual(""+d.id),expect(c.attr("data-user-screenname")).toEqual(d.screen_name);var e=c.find("a");expect(e.attr("href")).toEqual("/"+d.screen_name),expect(e.attr("data-search-query")).toEqual(d.id.toString()),expect(e.attr("title")).toBeUndefined(),expect(e.find(".avatar").attr("src")).toEqual("/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_mini.png"),expect(e.find(".fullname").text()).toEqual(d.name),expect(e.find(".username b").text()).toEqual(d.screen_name),expect(e.find(".js-verified")).toBe(".hidden"),expect(this.component.$accountsList).toBeVisible()}),it("correctly returns the social context type for the item",function(){var a={first_connecting_user_name:"Frank Jones",connecting_user_count:4},b={first_connecting_user_name:"Frank Jones",connecting_user_count:1},c={first_connecting_user_name:"Frank Jones",social_proof:9,connecting_user_count:3};expect(this.component.getSocialContext({})).toEqual(!1),expect(this.component.getSocialContext({social_proof:0})).toEqual(!1),expect(this.component.getSocialContext({social_proof:2})).toEqual(!1),expect(this.component.getSocialContext({social_proof:8})).toEqual("Follows you"),expect(this.component.getSocialContext({social_proof:3})).toEqual("Following"),expect(this.component.getSocialContext({social_proof:1})).toEqual("Following"),expect(this.component.getSocialContext({social_proof:9})).toEqual("You follow each other"),expect(this.component.getSocialContext({social_proof:11})).toEqual("You follow each other"),expect(this.component.getSocialContext(a)).toEqual("Followed by Frank Jones and 4 others"),expect(this.component.getSocialContext(b)).toEqual("Followed by Frank Jones"),expect(this.component.getSocialContext(c)).toEqual("You follow each other")}),it("updates the shortcut node and displays when accountsShortcutShow is true",function(){this.component.attr.accountsShortcutShow=!0,this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$accountsShortcut.find("a");expect(b.attr("href")).toEqual("/search/users?q=%3Cscript%3Ele_query%3C%2Fscript%3E"),expect(b.attr("data-search-query")).toEqual(a.queryData.query),expect(b.html()).toEqual("Search all people for <strong>&lt;script&gt;le_query&lt;/script&gt;</strong>"),expect(b).toBeVisible()}),it("hides the shortcut node when accountsShortcutShow is false",function(){this.component.attr.accountsShortcutShow=!1,this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$accountsShortcut.find("a");expect(b).not.toBeVisible()})}),describe("showDebugInfo on",function(){beforeEach(function(){setupComponent($(b),{deciders:{showDebugInfo:!0}})}),it("shows the debug info in the items",function(){this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$accountsList.find(this.component.attr.accountsItemSelector).first(),c="local user, weight/score: 2";expect(b.find("a").attr("title")).toEqual(c);var d=b.next(),e="remote user, weight/score: 4";expect(d.find("a").attr("title")).toEqual(e)})})})
});
define("test/app/ui/typeahead/typeahead_input_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/typeahead/typeahead_input",function(){function a(a,b){return typeof b=="number"&&(b={keyCode:b}),jQuery.Event(a,b)}function b(b,c,d,e,f,g){var h=spyOnEvent(this.component.$input,d),i=spyOnEvent(this.component.$input,"uiTypeaheadInputAutocomplete"),j=a(b,c);spyOn(j,"preventDefault"),this.component.$input.trigger(j),f?(expect(d).not.toHaveBeenTriggeredOn(this.component.$input),expect(this.component.updateCaretPosition).not.toHaveBeenCalled()):(expect(d).toHaveBeenTriggeredOn(this.component.$input),expect(this.component.updateCaretPosition).toHaveBeenCalled()),e?expect(j.preventDefault).toHaveBeenCalled():expect(j.preventDefault).not.toHaveBeenCalled(),g?expect("uiTypeaheadInputAutocomplete").toHaveBeenTriggeredOn(this.component.$input):expect("uiTypeaheadInputAutocomplete").not.toHaveBeenTriggeredOn(this.component.$input),this.component.updateCaretPosition.reset(),h.reset(),i.reset()}function c(a,c,d,e,f){return b.call(this,"keydown",a,c,d,e,f)}function d(a,c,d,e,f){return b.call(this,"keypress",a,c,d,e,f)}beforeEach(function(){var a='<form class="form-search js-search-form" action="/search" id="global-nav-search">\n        <span class="search-icon js-search-action">\n          <button type="submit" class="icon nav-search"><span class="visuallyhidden">{{_i}}Search{{/i}}</span></button>\n        </span>\n        <input class="search-input" type="text" id="search-query" placeholder="Enter a #hashtag or keyword" name="q" autocomplete="off" spellcheck="false">\n      </form>\n    ';setupComponent(a),this.component.supportsInputEvent=!1}),afterEach(function(){this.component.$input.blur()}),describe("uiTypeaheadRecentSearchDeleted event",function(){it("focus function called on input",function(){spyOn(this.component.$input,"focus"),this.component.trigger("uiTypeaheadRecentSearchDeleted"),expect(this.component.$input.focus).toHaveBeenCalled()})}),describe("when the input receives focus",function(){it("triggers the uiTextChanged event",function(){spyOnEvent(this.component.$input,"uiTextChanged"),this.component.$input.focus(),expect("uiTextChanged").toHaveBeenTriggeredOn(this.component.$input)}),it("triggers the uiTypeaheadInputChanged event",function(){spyOnEvent(this.component.$input,"uiTypeaheadInputChanged"),this.component.$input.focus(),expect("uiTypeaheadInputChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{value:""})}),describe("and the Typeahead component has been instructed to ignore the next focus event",function(){it("does not trigger the uiTextChanged event",function(){spyOnEvent(this.component.$input,"uiTextChanged"),this.component.trigger(this.component.$input,"uiTypeaheadIgnoreNextFocus"),this.component.$input.focus(),expect("uiTextChanged").not.toHaveBeenTriggeredOn(this.component.$input)})})}),describe("when the input loses focus",function(){it("it clears the state property that represents the current query",function(){this.component.currentQuery="something",this.component.$input.focus(),this.component.$input.blur(),expect(this.component.currentQuery).toBeNull()})}),describe("key press events",function(){beforeEach(function(){spyOn(this.component,"isValidCompletionAction").andReturn(!0),spyOn(this.component,"updateCaretPosition")}),describe("Enter key",function(){it("does not trigger the uiTypeaheadInputSubmit on keydown",function(){c.bind(this)(13,"uiTypeaheadInputSubmit",!1,!0)}),it("triggers the uiTypeaheadInputSubmit on keypress",function(){d.bind(this)(13,"uiTypeaheadInputSubmit",!0)}),it("does not trigger the uiTypeaheadInputSubmit when enabled false",function(){this.component.KEY_CODE_MAP[13].enabled=!1,d.bind(this)(13,"uiTypeaheadInputSubmit",!1,!0)})}),describe("Tab key",function(){it("triggers the uiTypeaheadInputTab on keydown",function(){c.bind(this)(9,"uiTypeaheadInputTab",!0,!1,!0)}),it("does not trigger the uiTypeaheadInputTab on keydown a second time",function(){c.bind(this)(9,"uiTypeaheadInputTab",!0,!1,!0),expect(this.component.releaseTabKey).toBe(!0),c.bind(this)(9,"uiTypeaheadInputTab",!1,!0,!1)}),it("resets again once an intermediate key is pressed",function(){c.bind(this)(9,"uiTypeaheadInputTab",!0,!1,!0),expect(this.component.releaseTabKey).toBe(!0);var b=a("keypress",17);this.component.$input.trigger(b),expect(this.component.releaseTabKey).toBe(!1),c.bind(this)(9,"uiTypeaheadInputTab",!0,!1,!0)})}),describe("Shift + Tab key",function(){it("does not trigger the uiTypeaheadInputTab on keydown",function(){c.bind(this)({keyCode:9,shiftKey:!0},"uiTypeaheadInputTab",!1,!0)})}),describe("Left arrow key",function(){it("triggers the uiTypeahedInputLeft on keydown",function(){c.bind(this)(37,"uiTypeaheadInputLeft",!1,!1,!0)})}),describe("Right arrow key",function(){it("triggers the uiTypeahedInputRight on keydown",function(){c.bind(this)(39,"uiTypeaheadInputRight",!1,!1,!0)})}),describe("Up arrow key",function(){it("triggers the uiTypeahedInputMoveUp on keydown",function(){c.bind(this)(38,"uiTypeaheadInputMoveUp",!0)}),it("does not trigger the uiTypeahedInputMoveUp when enabled false",function(){this.component.KEY_CODE_MAP[38].enabled=!1,d.bind(this)(38,"uiTypeaheadInputSubmit",!1,!0)})}),describe("Down arrow key",function(){it("triggers the uiTypeahedInputMoveDown on keydown",function(){c.bind(this)(40,"uiTypeaheadInputMoveDown",!0)}),it("does not trigger the uiTypeahedInputMoveDown when enabled false",function(){this.component.KEY_CODE_MAP[40].enabled=!1,d.bind(this)(40,"uiTypeaheadInputSubmit",!1,!0)})})}),describe("Normal text",function(){describe("in a rich text area",function(){beforeEach(function(){this.component.richTextareaMode=!0,spyOnEvent(this.component.$input,"uiTextChanged")}),it("does not trigger uiTextChanged event on keypressed",function(){this.component.$input.val("a"),this.component.$input.trigger(a("keyup",65)),expect("uiTextChanged").not.toHaveBeenTriggeredOn(this.component.$input)})}),describe("in a standard text area",function(){beforeEach(function(){spyOnEvent(this.component.$input,"uiTextChanged"),expect(this.component.$button).toHaveAttr("tabIndex",-1),this.component.$input.focus()}),it("triggers uiTextChanged event (via input event) if browser supports it",function(){this.component.supportsInputEvent=!0,this.component.$input.val("a"),this.component.$input.trigger("input"),expect("uiTextChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:"a",position:1})}),it("does not call handleInputChange on key presses if browser supports input event",function(){this.component.supportsInputEvent=!0,this.component.$input.val("a"),spyOn(this.component,"handleInputChange"),this.component.$input.trigger(a("keyup",65)),expect(this.component.handleInputChange).not.toHaveBeenCalled()}),it("triggers uiTextChanged event on keypressed",function(){this.component.$input.val("a"),this.component.$input.trigger(a("keyup",65)),expect("uiTextChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:"a",position:1}),expect(this.component.$button).toHaveAttr("tabIndex",0)}),it("triggers uiTextChanged event on paste",function(){this.component.$input.val("pasted text"),this.component.$input.trigger(a("paste")),expect("uiTextChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:"pasted text",position:11}),expect(this.component.$button).toHaveAttr("tabIndex",0)}),it("triggers uiTextChanged as is if query is all spaces",function(){this.component.$input.val("    "),this.component.$input.trigger(a("keyup",65)),expect("uiTextChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:"    ",position:4}),expect(this.component.$button).toHaveAttr("tabIndex",-1)}),it("does not trigger uiTextChanged if there is no change",function(){this.component.$input.val("a"),this.component.currentQuery="a",this.component.$input.trigger(a("keyup",65)),expect("uiTextChanged").not.toHaveBeenTriggeredOn()}),it("triggers uiTextChanged if there are leading spaces",function(){this.component.$input.val("a"),this.component.$input.trigger(a("keyup",65)),this.component.$input.val(" a"),this.component.$input.trigger(a("keyup",65)),expect("uiTextChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:" a",position:2}),expect(this.component.$button).toHaveAttr("tabIndex",0)}),it("triggers uiTextChanged if there are trailing spaces",function(){this.component.$input.val("a"),this.component.$input.trigger(a("keyup",65)),this.component.$input.val("a "),this.component.$input.trigger(a("keyup",65)),expect("uiTextChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:"a ",position:2}),expect(this.component.$button).toHaveAttr("tabIndex",0)})})}),describe("#saveTextAndPosition",function(){it("updates text and data when triggered via uiTextChanged",function(){this.component.trigger("uiTextChanged",{text:"test",position:69}),expect(this.component.text).toEqual("test"),expect(this.component.position).toEqual(69)}),it("tries to get the current word and passes it along when called",function(){spyOn(this.component,"getCurrentWord").andReturn("word"),spyOn(this.component,"setQuery"),this.component.trigger("uiTextChanged",{text:"test word",position:5}),expect(this.component.getCurrentWord).toHaveBeenCalled(),expect(this.component.setQuery).toHaveBeenCalledWith("word")})}),describe("#getCurrentWord",function(){describe("in text area mode",function(){beforeEach(function(){this.component.textareaMode=!0,this.component.text="This is just @charlie, with some text for ya"}),it("returns the word at the given position if it matches an entity",function(){this.component.position=21,expect(this.component.getCurrentWord()).toEqual("@charlie")}),it("returns null if the word at the given position does not match an entity",function(){this.component.position=30,expect(this.component.getCurrentWord()).toEqual(null)})}),describe("in text area mode with full name completion on",function(){beforeEach(function(){this.component.textareaMode=!0,this.component.attr.allowAccountsWithoutAtSign=!0,this.component.text="This is @charlie aka Č Č or D C C with some کاوه for ya. Fu Kong"}),it("returns the word at the given position if it matches an entity",function(){this.component.position=16,expect(this.component.getCurrentWord()).toEqual("@charlie")}),it("returns null if the word at the given position is not uppercase or more than 4 letters",function(){this.component.position=38,expect(this.component.getCurrentWord()).toEqual(null)}),it("matches an upper case word of more than 4 letters",function(){this.component.position=4,expect(this.component.getCurrentWord()).toEqual("This")}),it("does not match two uppercase, accented words in a row",function(){this.component.position=24,expect(this.component.getCurrentWord()).toEqual(undefined)}),it("matches two uppercase words in a row when last two of a set of three",function(){this.component.position=33,expect(this.component.getCurrentWord()).toEqual("C C")}),it("matches the last uppercase word when 4 chars over two capitals in a row",function(){this.component.position=64,expect(this.component.getCurrentWord()).toEqual("Kong")}),it("matches script language words at least 4 characters long",function(){this.component.position=48,expect(this.component.getCurrentWord()).toEqual("کاوه")})}),describe("in single-line mode",function(){beforeEach(function(){this.component.textareaMode=!1}),it("matches the whole string by default",function(){this.component.text="Sample Text",expect(this.component.getCurrentWord()).toEqual("Sample Text")}),it("returns an empty string if the input is just space",function(){this.component.text="     ",expect(this.component.getCurrentWord()).toEqual("")})})}),describe("#setQuery",function(){it("includes context when includeTweetContext and tweetContextEnabled true",function(){var a="This is a test tweet";spyOnEvent(this.component.$input,"uiTypeaheadInputChanged"),this.component.attr.includeTweetContext=!0,this.component.attr.tweetContextEnabled=!0,this.component.text=a,this.component.setQuery("test"),expect(this.component.currentQuery).toEqual("test"),expect("uiTypeaheadInputChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{value:"test",tweetContext:a})}),it("doesn't include context when includeTweetContext false",function(){var a="This is a test tweet";spyOnEvent(this.component.$input,"uiTypeaheadInputChanged"),this.component.attr.includeTweetContext=!1,this.component.attr.tweetContextEnabled=!0,this.component.text=a,this.component.setQuery("test"),expect(this.component.currentQuery).toEqual("test"),expect("uiTypeaheadInputChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{value:"test"})}),it("doesn't include context when tweetContextEnabled false",function(){var a="This is a test tweet";spyOnEvent(this.component.$input,"uiTypeaheadInputChanged"),this.component.attr.includeTweetContext=!0,this.component.attr.tweetContextEnabled=!1,this.component.text=a,this.component.setQuery("test"),expect(this.component.currentQuery).toEqual("test"),expect("uiTypeaheadInputChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{value:"test"})}),it("sets the new value and triggers inputChange event when different",function(){spyOnEvent(this.component.$input,"uiTypeaheadInputChanged"),this.component.setQuery("test"),expect(this.component.currentQuery).toEqual("test"),expect("uiTypeaheadInputChanged").toHaveBeenTriggeredOnAndWith(this.component.$input,{value:"test"})}),it("doesn't do anything when query unchanged",function(){spyOnEvent(this.component.$input,"uiTypeaheadInputChanged"),this.component.currentQuery="test",this.component.setQuery("test"),expect(this.component.currentQuery).toEqual("test"),expect("uiTypeaheadInputChanged").not.toHaveBeenTriggered()})}),describe("Right-to-left text",function(){it("appropriately sets the directionality of the text input to RTL",function(){this.component.$input.val("ش"),this.component.$input.trigger(a("keydown",65)),expect(this.component.$input.css("direction")).toEqual("rtl")}),it("appropriately sets the directionality of the text input to RTL with username",function(){this.component.$input.val("ش @esten"),this.component.$input.trigger(a("keydown",65)),expect(this.component.$input.css("direction")).toEqual("rtl")}),it("appropriately sets the directionality of the text input to RTL with URL",function(){this.component.$input.val("http://www.twitter.com شز"),this.component.$input.trigger(a("keydown",77)),expect(this.component.$input.css("direction")).toEqual("rtl")}),it("sets markers when page is loaded",function(){this.component.$input.val("ش @esten"),this.component.trigger(document,"uiPageChanged",{}),expect(this.component.$input.val()).toBe("ش ‎@esten‏")})}),describe("event uiTypeaheadSetPreventDefault",function(){it("toggles preventDefault to true for tab key",function(){this.component.trigger("uiTypeaheadSetPreventDefault",{preventDefault:!0,key:9}),expect(this.component.KEY_CODE_MAP[9].preventDefault).toEqual(!0)}),it("toggles preventDefault to false for tab key",function(){this.component.trigger("uiTypeaheadSetPreventDefault",{preventDefault:!1,key:9}),expect(this.component.KEY_CODE_MAP[9].preventDefault).toEqual(!1)})}),describe("Typeahead results shown and hidden events",function(){describe("when in single-line mode",function(){it("ignores the events",function(){var a=this.component.getDefaultKeycodes();this.component.trigger("uiTypeaheadResultsShown"),expect(this.component.KEY_CODE_MAP).toEqual(a),this.component.trigger("uiTypeaheadResultsHidden"),expect(this.component.KEY_CODE_MAP).toEqual(a)})}),describe("when in textarea mode",function(){beforeEach(function(){var a='<textarea id="search-query"></textarea>\n        ';setupComponent(a)}),it("responds to results shown by changing keyCode map",function(){this.component.trigger("uiTypeaheadResultsShown");var a=this.component.KEY_CODE_MAP;expect(a[13].enabled).toEqual(!0),expect(a[38].enabled).toEqual(!0),expect(a[40].enabled).toEqual(!0)}),it("responds to results hidden by changing keyCode map",function(){this.component.trigger("uiTypeaheadResultsHidden");var a=this.component.KEY_CODE_MAP;expect(a[13].enabled).toEqual(!1),expect(a[38].enabled).toEqual(!1),expect(a[40].enabled).toEqual(!1)})})}),describe("#isValidCompletionAction",function(){describe("right",function(){describe("when ltr",function(){it("does not trigger complete event when cursor not at end",function(){this.component.text="test",this.component.position=0,expect(this.component.isValidCompletionAction("uiTypeaheadInputRight")).toEqual(!1)}),it("does not trigger complete event when textarea",function(){this.component.text="test",this.component.position=4,this.component.textareaMode=!0,expect(this.component.isValidCompletionAction("uiTypeaheadInputRight")).toEqual(!1)}),it("triggers complete event when cursor at end",function(){this.component.text="test",this.component.position=4,expect(this.component.isValidCompletionAction("uiTypeaheadInputRight")).toEqual(!0)})}),describe("when rtl",function(){it("does not trigger complete event",function(){this.component.$input.attr("dir","rtl"),expect(this.component.isValidCompletionAction("uiTypeaheadInputRight")).toEqual(!1)})})}),describe("left",function(){describe("when ltr",function(){it("does not trigger complete event",function(){expect(this.component.isValidCompletionAction("uiTypeaheadInputLeft")).toEqual(!1)})}),describe("when rtl",function(){it("does not trigger complete event if cursor not at end",function(){this.component.$input.attr("dir","rtl"),this.component.text="טוםכ",this.component.position=0,expect(this.component.isValidCompletionAction("uiTypeaheadInputLeft")).toEqual(!1)}),it("does not trigger complete event when textarea",function(){this.component.$input.attr("dir","rtl"),this.component.text="הבךס",this.component.position=4,this.component.textareaMode=!0,expect(this.component.isValidCompletionAction("uiTypeaheadInputRight")).toEqual(!1)}),it("triggers complete event when cursor at end",function(){this.component.$input.attr("dir","rtl"),this.component.text="הבךס",this.component.position=4,this.component.textareaMode=!1,expect(this.component.isValidCompletionAction("uiTypeaheadInputLeft")).toEqual(!0)})})})}),describe("event uiTypeaheadItemPossiblyComplete",function(){beforeEach(function(){this.component.currentQuery="query",spyOnEvent(this.component.$input,"uiTypaheadInputBoring"),spyOnEvent(this.component.$input,"uiTypeaheadItemComplete"),spyOn(this.component,"isValidCompletionAction").andReturn(!0)}),describe("in textarea mode",function(){beforeEach(function(){spyOnEvent(this.component.$input,"uiChangeTextAndPosition"),this.component.textareaMode=!0}),it("should replace the word at current position with the result",function(){this.component.text="hey @you it's me! @c remember?!",this.component.position=3,this.component.trigger("uiTypeaheadItemPossiblyComplete",{value:"hello",input:"hey",source:"topic"}),expect("uiChangeTextAndPosition").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:"hello @you it's me! @c remember?!",position:6}),expect("uiTypeaheadItemComplete").toHaveBeenTriggeredOnAndWith(this.component.$input,{value:"hello",input:"hey",source:"topic",fromSelectionEvent:!1})}),it("should replace the word at current position with the result when an account and tabbed",function(){this.component.text="hey @you it's me! @c remember?!",this.component.position=20;var a={value:"charliecroom",input:"@c",source:"account",item:{screen_name:"charliecroom"}};this.component.trigger("uiTypeaheadItemPossiblyComplete",a),expect("uiChangeTextAndPosition").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:"hey @you it's me! @charliecroom remember?!",position:32}),expect("uiTypeaheadItemComplete").toHaveBeenTriggeredOnAndWith(this.component.$input,a)}),it("should replace the word at current position with the result when an hashtag and tabbed",function(){this.component.text="hey @you it's me! #c remember?!",this.component.position=20;var a={value:"#charliecroom",input:"#c",source:"topic"};this.component.trigger("uiTypeaheadItemPossiblyComplete",a),expect("uiChangeTextAndPosition").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:"hey @you it's me! #charliecroom remember?!",position:32}),expect("uiTypeaheadItemComplete").toHaveBeenTriggeredOnAndWith(this.component.$input,a)}),it("should replace the word at current position with the result when an cashtag and tabbed",function(){this.component.text="hey @you it's me! $c remember?!",this.component.position=20;var a={value:"$charliecroom",input:"$c",source:"topic"};this.component.trigger("uiTypeaheadItemPossiblyComplete",a),expect("uiChangeTextAndPosition").toHaveBeenTriggeredOnAndWith(this.component.$input,{text:"hey @you it's me! $charliecroom remember?!",position:32}),expect("uiTypeaheadItemComplete").toHaveBeenTriggeredOnAndWith(this.component.$input,a)}),it("should not trigger if screen_name is the same",function(){this.component.text="hey @you it's me! @c remember?!",this.component.position=19,this.component.trigger("uiTypeaheadItemPossiblyComplete",{value:"charliecroom",source:"account",item:{screen_name:"query"}}),expect("uiChangeTextAndPosition").not.toHaveBeenTriggered(),expect("uiTypeaheadItemComplete").not.toHaveBeenTriggered()})}),describe("in single-line mode",function(){beforeEach(function(){this.component.textareaMode=!1}),describe("account source",function(){it("should populate the input box with the query",function(){this.component.$input.val("not_test"),this.component.trigger("uiTypeaheadItemPossiblyComplete",{value:"test",source:"account",item:{screen_name:"test"}}),expect(this.component.currentQuery).toEqual("test"),expect(this.component.$input).toHaveValue("not_test"),expect("uiTypeaheadItemComplete").toHaveBeenTriggeredOnAndWith(this.component.$input,{value:"test",source:"account",item:{screen_name:"test"},fromSelectionEvent:!1})})}),describe("non account source",function(){it("should populate the input box with the query",function(){this.component.$input.val("not_test"),this.component.trigger("uiTypeaheadItemPossiblyComplete",{value:"test",source:"saved_search"}),expect(this.component.currentQuery).toEqual("test"),expect(this.component.$input).toHaveValue("test"),expect("uiTypeaheadItemComplete").toHaveBeenTriggeredOnAndWith(this.component.$input,{value:"test",source:"saved_search",fromSelectionEvent:!1})})})})}),describe("event uiTypeaheadItemSelected",function(){it("sets fromSelectionEvent to be true",function(){this.component.currentQuery="query",this.component.textareaMode=!1,spyOnEvent(this.component.$input,"uiTypeaheadItemComplete"),spyOn(this.component,"isValidCompletionAction").andReturn(!0),this.component.trigger("uiTypeaheadItemSelected",{value:"test",source:"saved_search"}),expect(this.component.currentQuery).toEqual("query"),expect(this.component.$input).toHaveValue("test"),expect("uiTypeaheadItemComplete").toHaveBeenTriggeredOnAndWith(this.component.$input,{value:"test",source:"saved_search",fromSelectionEvent:!0})})}),describe("pushState navigation",function(){it("clears the input",function(){this.component.$input.val("test string"),expect(this.component.$input).toHaveValue("test string"),this.component.trigger("uiBeforePageChanged",{}),expect(this.component.$input).toHaveValue("")})})})
});
define("test/app/ui/typeahead/recent_searches_renderer_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/typeahead/recent_searches_renderer",function(){var a=[{name:"@mrtall",query:"@mrtall",recent_search_path:"/search?q=%40mrtall&src=typd",search_query_source:"typed_query"},{name:"iPhone",query:"iPhone",recent_search_path:"/search?q=iPhone&src=typd",search_query_source:"typed_query"},{name:"obama",query:"obama",recent_search_path:"/search?q=obama&src=typd",search_query_source:"typed_query"},{name:"<script>alert('hi')</script>",query:"@bs",recent_search_path:"/search?q=%40bs&src=typd",search_query_source:"typed_query"}],b={queryData:{query:"test"},suggestions:{recentSearches:a}},c={queryData:{query:""},suggestions:{recentSearches:a}};beforeEach(function(){var a='<div class="dropdown-menu typeahead">\n        <div class="dropdown-caret">\n          <div class="caret-outer"></div>\n          <div class="caret-inner"></div>\n        </div>\n        <div class="dropdown-inner js-typeahead-results">\n          <div class="typeahead-recent-searches">\n            <h4 class="recent-searches-title">Recent Searches</h4><button class="btn-link clear-recent-searches">Clear All</button>\n            <ul class="typeahead-items recent-searches-list">\n             <li class="typeahead-item typeahead-recent-search-item"><span class="icon close js-typeahead-ignore-click"><span class="visuallyhidden">Remove</span></span><a class="js-nav" href="" data-search-query="" data-query-source="" data-ds="recent_search" tabindex="-1"><span class="icon generic-search"></span></a></li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    ',b=$(a);setupComponent(b)}),describe("uiTypeaheadRenderResults",function(){it("empties the list",function(){this.component.$recentSearchesList.html("<li class='typeahead-recent-search-item'>Justin</li>"),this.component.trigger("uiTypeaheadRenderResults",{queryData:{query:""},suggestions:{}}),expect(this.component.$recentSearchesList).toBeEmpty(),expect(this.component.$recentSearchesBlock.hasClass("has-results")).toEqual(!1),expect(this.component.$recentSearchesBlock.hasClass("has-items")).toEqual(!1)}),it("creates DOM nodes for each recent search",function(){this.component.trigger("uiTypeaheadRenderResults",b);var a=this.component.$recentSearchesList.children();expect(a.length).toBe(4);var c=$(a[0]).find("a"),d=b.suggestions.recentSearches[0];expect(c.attr("href")).toEqual(d.recent_search_path),expect(c.data("search-query")).toEqual(d.query),expect(c.data("query-source")).toEqual(d.search_query_source),expect(c.text()).toEqual(d.name),expect(this.component.$recentSearchesBlock.hasClass("has-results")).toEqual(!0),expect(this.component.$recentSearchesBlock.hasClass("has-items")).toEqual(!0)}),it("escapes HTML tags for display",function(){this.component.trigger("uiTypeaheadRenderResults",b);var a=this.component.$recentSearchesList.children(),c=$(a[3]).find("a span");expect(c[1].innerHTML).toEqual("&lt;script&gt;alert('hi')&lt;/script&gt;")}),it("deletes a recent search and hides title and clear-all link when no more searches",function(){var a=[{name:"@mrtall",query:"@mrtall",recent_search_path:"/search?q=%40mrtall&src=typd",search_query_source:"typed_query"}],b={queryData:{query:"test"},suggestions:{recentSearches:a}};this.component.trigger("uiTypeaheadRenderResults",b),spyOnEvent(document,"uiTypeaheadDeleteRecentSearch"),$(this.component.$recentSearchesList.children()[0]).find(".close").trigger("click"),expect("uiTypeaheadDeleteRecentSearch").toHaveBeenTriggeredOn(document),expect(this.component.$recentSearchesList.children().length).toEqual(0),expect(this.component.$recentSearchesTitle).toBeHidden(),expect(this.component.$recentSearchesBlock.hasClass("has-results")).toEqual(!1),expect(this.component.$recentSearchesBlock.hasClass("has-items")).toEqual(!1)}),it("deletes all recent search and hides title when clear-all button clicked",function(){var a=[{name:"@mrtall",query:"@mrtall",recent_search_path:"/search?q=%40mrtall&src=typd",search_query_source:"typed_query"},{name:"@mrtall",query:"@mrtall",recent_search_path:"/search?q=%40mrtall&src=typd",search_query_source:"typed_query"}],b={queryData:{query:"test"},suggestions:{recentSearches:a}};this.component.trigger("uiTypeaheadRenderResults",b),spyOnEvent(document,"uiTypeaheadDeleteRecentSearch"),this.component.$recentSearchesClearAll.trigger("click"),expect("uiTypeaheadDeleteRecentSearch").toHaveBeenTriggeredOnAndWith(document,{deleteAll:!0}),expect(this.component.$recentSearchesList.children().length).toEqual(0),expect(this.component.$recentSearchesTitle).toBeHidden(),expect(this.component.$recentSearchesBlock.hasClass("has-results")).toEqual(!1),expect(this.component.$recentSearchesBlock.hasClass("has-items")).toEqual(!1),expect(this.component.$recentSearchesClearAll).toBeHidden()}),it("hides title when query not empty or no recent searches",function(){this.component.trigger("uiTypeaheadRenderResults",b),expect(this.component.$recentSearchesTitle).toBeHidden(),this.component.trigger("uiTypeaheadRenderResults",{queryData:{query:"test"},suggestions:{}}),expect(this.component.$recentSearchesTitle).toBeHidden()}),it("hides section divider line when query empty but recent searches present",function(){this.component.trigger("uiTypeaheadRenderResults",c),expect(this.component.$recentSearchesBlock.hasClass("has-results")).toEqual(!1),expect(this.component.$recentSearchesBlock.hasClass("has-items")).toEqual(!0)})})})
});
define("test/app/ui/typeahead/trend_locations_renderer_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/typeahead/trend_locations_renderer",function(){var a={suggestions:{trendLocations:[{name:"Worldwide",woeid:1,countryName:"",placeTypeCode:19},{name:"San Francisco",woeid:13,countryName:"United States",placeTypeCode:1}]}};beforeEach(function(){var a='<div class="dropdown-menu typeahead">\n        <div class="dropdown-caret">\n          <div class="caret-outer"></div>\n          <div class="caret-inner"></div>\n        </div>\n        <div class="dropdown-inner js-typeahead-results">\n          <ul class="typeahead-items typeahead-trend-locations-list">\n            <li class="typeahead-item typeahead-trend-locations-item">\n              <a class="js-nav" href="" data-ds="trend_location" data-search-query="" tabindex="-1"></a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    ',b=$(a);setupComponent(b)}),describe("uiTypeaheadRenderResults",function(){it("empties the list",function(){this.component.$trendLocationsList.html("<li>Atlanta</li>"),this.component.trigger("uiTypeaheadRenderResults",{suggestions:{}}),expect(this.component.$trendLocationsList).toBeEmpty()}),it("creates DOM nodes for each result",function(){this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$trendLocationsList.children();expect(b.length).toBe(2);var c=$(b[0]),d=a.suggestions.trendLocations[0];expect(c.data("item")).toEqual(d)}),it("renders the not found location",function(){this.component.trigger("uiTypeaheadRenderResults",{suggestions:{trendLocations:[{woeid:-1,placeTypeCode:-1,name:"not found"}]}});var a=this.component.$trendLocationsList.children();expect(a.length).toBe(1);var b=$(a[0]);expect(b.hasClass("typeahead-item")).toEqual(!1),expect(b.find("a").data("search-query")).toEqual("")})})})
});
define("test/app/ui/typeahead/topics_renderer_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/typeahead/topics_renderer",function(){var a={suggestions:{topics:[{tokens:["#altintop"],rounded_score:200,score:"0.2",topic:"#altintop"},{tokens:["another"],rounded_score:200,score:"0.2",topic:"another",location:"San Francisco"},{tokens:["antonio","cromartie"],rounded_score:200,score:"0.2",topic:"antonio cromartie"},{tokens:["ayrton","senna"],rounded_score:200,score:"0.2",topic:"ayrton senna"},{tokens:["apprentice"],rounded_score:200,score:"0.2",topic:"apprentice"},{tokens:["a","6"],rounded_score:200,score:"0.2",topic:"a 6"},{tokens:["arsenal"],rounded_score:200,score:"0.2",topic:"arsenal"},{tokens:["amelia","lily"],rounded_score:200,score:"0.2",topic:"amelia lily"},{tokens:["adam","schefter"],rounded_score:200,score:"0.2",topic:"adam schefter"},{tokens:["adele"],rounded_score:200,score:"0.2",topic:"<script>alert('lulz')</script>"}]},query:"a",id:"swift_typeahead_dropdown_1340239021388"},b='<div class="dropdown-menu typeahead">\n      <div class="dropdown-caret">\n        <div class="caret-outer"></div>\n        <div class="caret-inner"></div>\n      </div>\n      <div class="dropdown-inner js-typeahead-results">\n        <ul class="typeahead-items topics-list">\n        <li class="typeahead-topic-item typeahead-item"><a href="" data-search-query="" data-query-source="" data-ds="topics"><i class="generic-search"></i><div class="typeahead-social-context"></div></a></li>\n        </ul>\n      </div>\n    </div>\n  ';beforeEach(function(){setupComponent($(b),{deciders:{showTypeaheadTopicSocialContext:!0}})}),describe("uiTypeaheadRenderResults",function(){it("empties the list",function(){this.component.$topicsList.html("<li>Justin</li>"),this.component.trigger("uiTypeaheadRenderResults",{suggestions:{}}),expect(this.component.$topicsList).toBeEmpty()}),it("creates DOM nodes for each result",function(){this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$topicsList.children();expect(b.length).toBe(10);var c=$(b[0]).find("a"),d=a.suggestions.topics[0];expect(c.find("i.generic-search").length).toEqual(1),expect(c.attr("href")).toEqual("/search?q=%23altintop&src=tyah"),expect(c.data("search-query")).toEqual(d.topic),expect(c.find("span").html()).toEqual(d.topic);var e=$(b[1]);expect(e.find(".typeahead-social-context").text()).toEqual("Trending in San Francisco")}),it("only adds the search icon if the includeSearchGlass is true",function(){var c=$(b);setupComponent(c,{includeSearchGlass:!1,deciders:{showTypeaheadTopicSocialContext:!0}}),this.component.trigger("uiTypeaheadRenderResults",a);var d=this.component.$topicsList.children();expect(d.length).toBe(10);var e=$(d[0]).find("a");expect(e.find("i.generic-search").length).toEqual(0)}),it("Formats differently if the result is a hashtag or cashtag and parseHashtag true",function(){this.component.attr.parseHashtags=!0,this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$topicsList.children();expect(b.length).toBe(10);var c=$(b[0]).find("a");expect(c.text()).toEqual("#altintop"),expect(c.find("span").html()).toEqual("#<strong>altintop</strong>")})}),it("escapes HTML tags for display",function(){this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$topicsList.children(),c=$(b[9]).find("span");expect(c[0].innerHTML).toEqual("&lt;script&gt;alert('lulz')&lt;/script&gt;")})})
});
define("test/app/ui/typeahead/context_helpers_renderer_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/typeahead/context_helpers_renderer",function(){var a={suggestions:{contextHelpers:[{text:"Search for {{strong_query}}",query:"query",rewrittenQuery:"query2",mode:"timeline"}]},query:"a",id:"swift_typeahead_dropdown_1340239021388"},b='<div class="dropdown-menu typeahead">\n      <div class="dropdown-caret">\n        <div class="caret-outer"></div>\n        <div class="caret-inner"></div>\n      </div>\n      <div class="dropdown-inner js-typeahead-results">\n        <ul class="typeahead-items typeahead-context-list">\n          <li class="typeahead-item typeahead-context-item"><a class="js-nav" href="" data-ds="context_helper" data-search-query="" tabindex="-1"></a></li>\n        </ul>\n      </div>\n    </div>\n  ';beforeEach(function(){setupComponent($(b))}),describe("uiTypeaheadRenderResults",function(){it("empties the list",function(){this.component.$contextItemsList.html("<li>Justin</li>"),this.component.trigger("uiTypeaheadRenderResults",{suggestions:{}}),expect(this.component.$contextItemsList).toBeEmpty()}),it("creates DOM nodes for each result",function(){this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$contextItemsList.children();expect(b.length).toBe(1);var c=$(b[0]).find("a");expect(c.attr("href")).toEqual("/search?q=query2&src=tyah&mode=timeline"),expect(c.data("search-query")).toEqual("query"),expect(c.html()).toEqual("Search for <strong>query</strong>")})})})
});
define("test/app/ui/typeahead/saved_searches_renderer_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/typeahead/saved_searches_renderer",function(){var a={queryData:{query:"test"},suggestions:{savedSearches:[{position:2,user_id:3,name:"@mrtall",query:"@mrtall",saved_search_path:"/search?q=%40mrtall&src=savs",created_at:1335046581,id:633377464,search_query_source:"saved_search_click",id_str:"633377464"},{position:0,user_id:3,name:"iPhone",query:"iPhone",saved_search_path:"/search?q=iPhone&src=savs",created_at:1335219381,id:1351151928,search_query_source:"saved_search_click",id_str:"1351151928"},{position:3,user_id:3,name:"obama",query:"obama",saved_search_path:"/search?q=obama&src=savs",created_at:1334960181,id:1479856740,search_query_source:"saved_search_click",id_str:"1479856740"},{position:1,user_id:3,name:"<script>alert('hi')</script>",query:"@bs",saved_search_path:"/search?q=%40bs&src=savs",created_at:1335132981,id:1999710579,search_query_source:"saved_search_click",id_str:"1999710579"}]}},b={queryData:{query:"test"},suggestions:{savedSearches:[]}};beforeEach(function(){var a='<div class="dropdown-menu typeahead">\n        <div class="dropdown-caret">\n          <div class="caret-outer"></div>\n          <div class="caret-inner"></div>\n        </div>\n        <div class="dropdown-inner js-typeahead-results">\n          <div role="presentation" class="typeahead-saved-searches">\n            <h4 id="saved-searches-heading" class="typeahead-category-title saved-searches-title">Saved Searches</h4>\n            <ul role="presentation" class="typeahead-items saved-searches-list">\n              <li role="presentation" class="typeahead-item typeahead-saved-search-item">\n                <a role="menuitem" aria-describedby="saved-searches-heading" class="js-nav" href="" data-search-query="" data-query-source="" data-ds="saved_search" tabindex="-1"></a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    ',b=$(a);setupComponent(b)}),describe("uiTypeaheadRenderResults",function(){it("empties the list",function(){this.component.$savedSearchesList.html("<li>Justin</li>"),this.component.trigger("uiTypeaheadRenderResults",{suggestions:{},queryData:{query:"test"}}),expect(this.component.$savedSearchesList).toBeEmpty(),expect(this.component.$savedSearchesBlock.hasClass("has-items")).toEqual(!1)}),it("creates DOM nodes for each saved search",function(){this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$savedSearchesList.children();expect(b.length).toBe(4),expect(this.component.$savedSearchesBlock.hasClass("has-items")).toEqual(!0);var c=$(b[0]).find("a"),d=a.suggestions.savedSearches.length-1,e=a.suggestions.savedSearches[d];expect(c.attr("href")).toEqual(e.saved_search_path),expect(c.data("search-query")).toEqual(e.query),expect(c.data("query-source")).toEqual(e.search_query_source),expect(c.text()).toEqual(e.name),expect(this.component.$savedSearchesTitle.css("display")).toBe("none")}),it("does not render if there are no saved searches",function(){this.component.trigger("uiTypeaheadRenderResults",b),expect(this.component.$savedSearchesTitle.css("display")).toBe("none"),expect(this.component.$savedSearchesList).toBeEmpty()}),describe("when the query is empty",function(){beforeEach(function(){var b=a;b.queryData.query="",this.component.trigger("uiTypeaheadRenderResults",b)}),it("shows the title",function(){expect(this.component.$savedSearchesTitle.css("display")).toBe("block")}),it('adds the "aria-describedby" attribute to the link of each item',function(){var a=this.component.select("savedSearchesItemSelector").find("a");expect(a.attr("aria-describedby")).toBe(this.component.$savedSearchesTitle.attr("id"))})}),it("escapes HTML tags for display",function(){this.component.trigger("uiTypeaheadRenderResults",a);var b=this.component.$savedSearchesList.children(),c=$(b[0]).find("span");expect(c[0].innerHTML).toEqual("&lt;script&gt;alert('hi')&lt;/script&gt;")})})})
});
define("test/app/ui/sms/device_verification_banner_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/sms/device_verification_banner",function(){function b(){it("shows the spinner",function(){expect("uiShowGlobalLoadingIndicator").toHaveBeenTriggeredOn(document)}),it("disables the inputs",function(){expect(this.$node.find("#device-verification-pin")).toBeDisabled(),expect(this.$node.find("#device-verification-submit")).toBeDisabled()})}function c(){it("hides the spinner",function(){expect("uiHideGlobalLoadingIndicator").toHaveBeenTriggeredOn(document)}),it("enables the input",function(){expect(this.$node.find("#device-verification-pin")).not.toBeDisabled(),expect(this.$node.find("#device-verification-submit")).not.toBeDisabled()})}var a='<div>\n      <div id="device-verification-banner">\n        <input type="hidden" id="device-verification-id" value="1" />\n        <input type="text" id="device-verification-pin" disabled="disabled" />\n        <button type="button" id="device-verification-submit" disabled="disabled">Submit</button>\n        <a href="#" id="device-verification-resend">Resend</a>\n      </div>\n    </div>\n  ';beforeEach(function(){spyOnEvent(document,"uiShowGlobalLoadingIndicator"),spyOnEvent(document,"uiHideGlobalLoadingIndicator"),spyOnEvent(document,"uiShowMessage"),spyOnEvent(document,"uiDidSubmitDeviceVerification"),spyOnEvent(document,"uiDidResendDownloadLinkRequest"),setupComponent(a)}),describe("on dataDidSubmitDownloadLinkRequest",function(){it("adds the banner to the dom",function(){$(document).trigger("dataDidSubmitDownloadLinkRequest",{banner_html:'<div id="my-new-banner"></div>'}),expect(this.$node.find("#my-new-banner").length).toBe(1)})}),describe("on dataDidVerifyDevice",function(){beforeEach(function(){$(document).trigger("dataDidVerifyDevice")}),c(),it("shows a success message",function(){expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"Your device has been verified!"})}),it("hides the banner",function(){expect(this.$node.find("#device-verification-banner")).toBeHidden()})}),describe("on dataFailedToVerifyDevice",function(){beforeEach(function(){$(document).trigger("dataFailedToVerifyDevice")}),c(),it("shows a failure message",function(){expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"The PIN you entered was not valid. Please try again."})})}),describe("on submit",function(){beforeEach(function(){this.$node.find("#device-verification-pin").val("1234"),this.$node.find("#device-verification-submit").click()}),b(),it("triggers uiDidSubmitDeviceVerification",function(){expect("uiDidSubmitDeviceVerification").toHaveBeenTriggeredOnAndWith(document,{deviceId:"1",pin:"1234"})})}),describe("on resend",function(){beforeEach(function(){this.$node.find("#device-verification-resend").click()}),b(),it("triggers uiDidResendDownloadLinkRequest",function(){expect("uiDidResendDownloadLinkRequest").toHaveBeenTriggeredOnAndWith(document,{deviceId:"1"})})}),describe("on dataDidResendDownloadLinkRequest",function(){beforeEach(function(){$(document).trigger("dataDidResendDownloadLinkRequest")}),c(),it("triggers uiShowMessage with a success message",function(){expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"A new PIN was sent to your device."})})}),describe("when dataFailedToResendDownloadLinkRequest",function(){beforeEach(function(){$(document).trigger("dataFailedToResendDownloadLinkRequest")}),c(),it("triggers uiShowMessage with an error message",function(){expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"There was an error resending your PIN."})})}),describe("on pin keyup",function(){it("enables the submit depending on the value",function(){var a=this.$node.find("#device-verification-pin"),b=this.$node.find("#device-verification-submit");expect(b).toBeDisabled(),a.val("1234"),a.trigger("keyup"),expect(b).not.toBeDisabled(),a.val(""),a.trigger("keyup"),expect(b).toBeDisabled()})})})
});
define("test/app/ui/sms/mobile_download_prompt_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/sms/mobile_download_prompt",function(){var a='<div>\n      <a class="dismiss js-dismiss" href="#"></a>\n      <div class="phone-form" style="display: none">\n        <select id="sms-country-code">\n          <option value="1" selected="selected">US</option>\n        </select>\n        <input id="sms-device-number" type="text" />\n        <button type="button" id="sms-submit" disabled="disabled">Submit</button>\n      </div>\n    </div>\n  ';beforeEach(function(){spyOnEvent(document,"uiDidSubmitDownloadLinkRequest"),spyOnEvent(document,"uiShowGlobalLoadingIndicator"),spyOnEvent(document,"uiHideGlobalLoadingIndicator"),spyOnEvent(document,"uiShowMessage"),spyOnEvent(document,"uiDismissMobileDownloadPrompt"),spyOnEvent(document,"uiMobileDownloadPromptLoaded"),setupComponent(a)}),describe("on uiSwiftLoaded",function(){it("shows the form",function(){var a=this.$node.find(".phone-form");expect(a).toBeHidden(),$(document).trigger("uiSwiftLoaded"),expect(a).not.toBeHidden(),expect("uiMobileDownloadPromptLoaded").toHaveBeenTriggeredOn(document)})}),describe("on uiPageChanged",function(){it("shows the form",function(){var a=this.$node.find(".phone-form");expect(a).toBeHidden(),$(document).trigger("uiPageChanged"),expect(a).not.toBeHidden(),expect("uiMobileDownloadPromptLoaded").toHaveBeenTriggeredOn(document)})}),describe("on device number keyup",function(){it("enables or disables the the submit button based on value",function(){var a=this.$node.find("#sms-device-number"),b=this.$node.find("#sms-submit");expect(b).toBeDisabled(),a.val("1234"),a.trigger("keyup"),expect(b).not.toBeDisabled(),a.val(""),a.trigger("keyup"),expect(b).toBeDisabled()})}),describe("on submit",function(){beforeEach(function(){this.$node.find("#sms-device-number").val("1234"),this.$node.find("#sms-submit").click()}),it("triggers uiDidSubmitDownloadLinkRequest",function(){expect("uiDidSubmitDownloadLinkRequest").toHaveBeenTriggeredOnAndWith(document,{countryCode:"1",deviceNumber:"1234"})}),it("displays the loading indicator",function(){expect("uiShowGlobalLoadingIndicator").toHaveBeenTriggeredOn(document)}),it("disables the inputs",function(){expect(this.$node.find("#sms-country-code")).toBeDisabled(),expect(this.$node.find("#sms-device-number")).toBeDisabled(),expect(this.$node.find("#sms-submit")).toBeDisabled()})}),describe("on dataDidSubmitDownloadLinkRequest",function(){beforeEach(function(){$(document).trigger("dataDidSubmitDownloadLinkRequest")}),it("hides the node",function(){expect(this.$node).toBeHidden()}),it("hides the loading indicator",function(){expect("uiHideGlobalLoadingIndicator").toHaveBeenTriggeredOn(document)})}),describe("on dataFailedToSubmitDownloadLinkRequest",function(){beforeEach(function(){$(document).trigger("dataFailedToSubmitDownloadLinkRequest")}),it("hides the loading indicator",function(){expect("uiHideGlobalLoadingIndicator").toHaveBeenTriggeredOn(document)}),it("shows a failure message",function(){expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"Your device could not be registered."})}),it("reenables the inputs",function(){expect(this.$node.find("#sms-country-code")).not.toBeDisabled(),expect(this.$node.find("#sms-device-number")).not.toBeDisabled(),expect(this.$node.find("#sms-submit")).not.toBeDisabled()})}),describe("on dismiss the prompt",function(){it("triggers uiDismissMobileDownloadPrompt event",function(){this.$node.find(".dismiss").click(),expect("uiDismissMobileDownloadPrompt").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/sms/with_sms_country_selector_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/sms/with_sms_country_selector",function(){var a='<div>\n      <select id="sms-country-code">\n        <option value="1">US</option>\n        <option value="44">UK</option>\n      </select>\n      <div id="sms-country-code-preview">+1</div>\n    </div>\n  ';beforeEach(function(){setupComponent(a)}),describe("when the country selector changes",function(){it("updates the preview",function(){var a=this.$node.find("#sms-country-code"),b=this.$node.find("#sms-country-code-preview");a.val("44"),a.trigger("change"),expect(b.text()).toBe("+44"),a.val("1"),a.trigger("change"),expect(b.text()).toBe("+1")})})})
});
define("test/app/ui/mobile_gallery/gallery_buttons_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/mobile_gallery/gallery_buttons",function(){beforeEach(function(){var a='<div class="mobile-download clearfix">\n        <div class="actions yes-script">\n          <div class="download-info">\n            <a class="promotional download-now btn signup-btn">Download now</a>&nbsp;<a class="btn primary-btn activate-sms has-sms" href="/settings/devices">Use via text message</a>\n          </div>\n        </div>\n        <table class="mobile-footer mobile-footer-home" cellpadding="0">\n          <tbody>\n            <tr>\n              <td>\n                <p>Have your device with you?<br><a href="http://m.twitter.com">Visit m.twitter.com on your device »</a></p>\n              </td>\n              <td>\n                <p>Questions about using Twitter mobile?<br><a href="//support.twitter.com/groups/34-mobile">Visit our Mobile Help Center »</a></p>\n              </td>\n              <td>\n                <p>Privacy controls &amp; notification settings?<br><a href="/devices">Visit our Mobile Settings page »</a></p>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    ';setupComponent(a)}),it("scribes when download dialog button clicked",function(){var a=this.component.$node.find(".download-now").trigger("click");expect(this.component).toScribe({component:"download_button",action:"click"})})})
});
define("test/app/ui/welcome/interests_header_search_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/interests_header_search",function(){var a='<form action="javascript:void(0)">\n      <input type="text" placeholder="Search for people or organizations that you care about" value="" class="js-search-field">\n      <button type="submit" class="btn">Search</button>\n    </form>\n  ';beforeEach(function(){setupComponent(a),spyOnEvent(this.$node,"uiWelcomeUserSearch")}),it("does nothing if the input is blank",function(){this.$node.find("button").click(),expect("uiWelcomeSearch").not.toHaveBeenTriggeredOn(this.$node)}),it("fires an event we can scribe on",function(){this.$node.find("input").val("barack obama"),this.$node.find("button").click(),expect("uiWelcomeUserSearch").toHaveBeenTriggeredOnAndWith(this.$node,{query:"barack obama"})})})
});
define("test/app/ui/welcome/import_services_cards_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/import_services_cards",function(){var a='<div class="stream-item open welcome-card welcome-users-card" data-component-context="contacts_user_stream" data-scribe-context="{}">\n      <div class="welcome-card-header">\n        <span class="js-welcome-card-title">\n            Loading your contacts…\n        </span>\n\n        <div class="control js-dismiss">\n          <i class="close"></i>\n        </div>\n      </div>\n\n      <div class="welcome-results">\n      </div>\n\n      <div class="welcome-card-pagination">\n        <a href="#" class="js-load-more"\n          data-more-placement="append"\n          data-more-type="contacts"\n          data-more-cursor="{&quot;retry&quot;:0}">—-</a>\n      </div>\n    </div>\n  ';beforeEach(function(){var a='<div>\n        <div class="welcome-stream stream-items">\n          <div class="stream-item open welcome-card welcome-import-services-card">\n          </div>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("translates OAuth success into a card request",function(){spyOnEvent(document,"uiWantsWelcomeContactImportResultsCard"),$(document).trigger("uiOauthImportSuccess"),expect("uiWantsWelcomeContactImportResultsCard").toHaveBeenTriggeredOn(document)}),it("loads more when the results card comes in",function(){var b;this.component.on("click",function(a){a.preventDefault(),b=a.target}),this.component.trigger("dataWelcomeContactImportCardSuccess",{html:a}),expect(b).toEqual(this.$node.find(".js-load-more").get(0))}),it("inserts the results card when it comes in",function(){spyOnEvent(document,"click"),expect(this.$node.find(".welcome-users-card").length).toEqual(0),this.$node.trigger("dataWelcomeContactImportCardSuccess",{html:a}),expect("click").toHaveBeenTriggeredOn(document),expect(this.$node.find(".welcome-users-card").length).toEqual(1)}),it("replaces an existing results card if one is there",function(){jasmine.Clock.useMock(),this.$node.find(".stream-items").append(a),expect(this.$node.find(".welcome-users-card").length).toEqual(1),this.$node.trigger("dataWelcomeContactImportCardSuccess",{html:a}),jasmine.Clock.tick(1e3),expect(this.$node.find(".welcome-users-card").length).toEqual(1)})})
});
define("test/app/ui/welcome/invite_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/invite_dialog",function(){beforeEach(function(){var a='<div class="modal-container no-internal-links" id="invites-dialog" style="display: none;">\n        <div class="modal draggable">\n          <div class="modal-content clearfix">\n            <button class="modal-btn modal-close js-close" type="button"><i class="close-medium"><span class="visuallyhidden">Close</span></i></button>\n\n            <div class="modal-header">\n              <h3 class="modal-title">Invite your friends who aren’t on Twitter</h3>\n            </div>\n\n            <div class="contents"></div>\n\n            <div class="loading" style="display: none;">\n            </div>\n\n            <div class="error-message" style="display: none;">\n              Error loading invites.\n              <a class="js-retry" href="#">Try again</a>\n            </div>\n\n            <div class="modal-footer">\n              <a href="#" class="js-preview-invite">See what you’ll send them</a>\n              <button class="btn primary-btn js-submit">Invite these friends</button>\n            </div>\n          </div>\n        </div>\n      </div>\n      ';setupComponent(a)}),it("asks for the invites when opening",function(){spyOnEvent(document,"uiWantsUnmatchedContacts"),$(document).trigger("uiWelcomeShowInviting"),expect(this.component.isOpen()).toEqual(!0),expect("uiWantsUnmatchedContacts").toHaveBeenTriggeredOn(document)}),describe("When the server responds with contacts",function(){beforeEach(function(){this.component.open(),$(document).trigger("dataUnmatchedContactsSuccess",{html:'<div class="contacts"></div>'})}),it("inserts contents from the server",function(){expect(this.$node.find(".contacts").length).toEqual(1)}),it("sets focus within the dialog",function(){expect(this.$node.find(".primary-btn")).toBeFocused()})}),it("closes when the invite was successful",function(){this.component.open(),$(document).trigger("dataInviteContactsSuccess",{invited:[]}),expect(this.component.isOpen()).toEqual(!1)}),it("redirects on closing if it was opened with a url",function(){$(document).trigger("uiWelcomeShowInviting",{successPath:"#done"}),this.component.close(),expect(window.location.hash).toEqual("#done")})})
});
define("test/app/ui/welcome/users_cards_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/users_cards",function(){beforeEach(function(){var a='<div class="welcome-stream">\n        <div class="stream-item welcome-card">\n          <div class="js-dismiss"></div>\n          <button class="js-invite"></button>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("removes a card on dismiss",function(){jasmine.Clock.useMock(),expect(this.$node.find(".stream-item")).toExist(),this.$node.find(".js-dismiss").click(),jasmine.Clock.tick(1e3),expect(this.$node.find(".stream-item")).not.toExist()}),it("removes a card that has invites in it on success",function(){jasmine.Clock.useMock(),expect(this.$node.find(".stream-item")).toExist(),$(document).trigger("dataInviteContactsSuccess",{invited:[]}),jasmine.Clock.tick(1e3),expect(this.$node.find(".stream-item")).not.toExist()})})
});
define("test/app/ui/welcome/with_nav_buttons_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/welcome/with_nav_buttons",function(){beforeEach(function(){var a='<div class="welcome-flow-nav">\n        <div class="welcome-flow-nav-inner clearfix">\n          <a href="javascript:void(0)" class="js-prev-btn btn prev-btn">&laquo; Previous</a>\n          <a href="javascript:void(0)" class="js-next-btn btn next-btn">Next &raquo;</a>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("allows an enabled button to click",function(){spyOnEvent(this.$node,"click"),this.component.select("prevButtonSelector").click(),expect("click").toHaveBeenTriggeredOn(this.$node)}),it("prevents a disabled button from clicking",function(){spyOnEvent(this.$node,"click"),this.component.select("prevButtonSelector").attr("aria-disabled",!0).click(),expect("click").not.toHaveBeenTriggeredOn(this.$node)}),it("sets the href, aria-disabled, and primary state of the prev button",function(){var a=this.component.select("prevButtonSelector");expect(a).not.toHaveAttr("aria-disabled"),expect(a).not.toHaveClass("primary-btn"),expect(a).toHaveAttr("href","javascript:void(0)"),$(document).trigger("uiSetWelcomePrevButton",{href:"/welcome/intro",enabled:!1,primary:!0}),expect(a.attr("aria-disabled")).toBe("true"),expect(a).toHaveClass("primary-btn"),expect(a).toHaveAttr("href","/welcome/intro")}),it("sets the href, aria-disabled, and primary state of the next button",function(){var a=this.component.select("nextButtonSelector");expect(a).not.toHaveClass("disabled"),expect(a).not.toHaveClass("primary-btn"),expect(a).toHaveAttr("href","javascript:void(0)"),$(document).trigger("uiSetWelcomeNextButton",{href:"/welcome/intro",enabled:!1,primary:!0}),expect(a.attr("aria-disabled")).toBe("true"),expect(a).toHaveClass("primary-btn"),expect(a).toHaveAttr("href","/welcome/intro")})})
});
define("test/app/ui/welcome/interests_category_flow_nav_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/interests_category_flow_nav",function(){beforeEach(function(){var a='<div class="welcome-flow-nav">\n        <div class="welcome-flow-nav-inner clearfix">\n          <a href="#" class="js-prev-btn btn prev-btn">&laquo; Previous</a>\n          <a href="#next" class="js-next-btn btn next-btn">Next &raquo;</a>\n        </div>\n      </div>\n    ';setupComponent(a),this.clickNext=function(){this.component.select("nextButtonSelector").click()}}),describe("under normal circumstances",function(){it("lets a click bubble when clicking next",function(){spyOnEvent(document,"click"),this.clickNext(),expect("click").toHaveBeenTriggeredOn(document)})}),describe("after invitable users go by",function(){beforeEach(function(){$(document).trigger("dataWelcomeMoreResultsSuccess",{html:"<div></div>",unmatched_contacts_count:4})}),it("starts trapping next",function(){spyOnEvent(document,"uiWelcomeShowInviting"),this.clickNext(),expect("uiWelcomeShowInviting").toHaveBeenTriggeredOnAndWith(document,{successPath:"#next"})}),it("does not trap if the dialog was shown",function(){spyOnEvent(document,"click"),$(document).trigger("uiWelcomeShowInviting"),this.clickNext(),expect("click").toHaveBeenTriggeredOn(document)}),it("does not trap if another import comes in without contacts",function(){spyOnEvent(document,"click"),$(document).trigger("dataWelcomeMoreResultsSuccess",{html:"<div></div>",unmatched_contacts_count:0}),this.clickNext(),expect("click").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/welcome/with_interests_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/welcome/with_interests",function(){beforeEach(function(){setupComponent()}),describe("selected interests",function(){it("should save selected interests",function(){this.component.addSelectedInterest("music"),this.component.addSelectedInterest("sports"),expect(this.component.loadSelectedInterests()).toEqual(["music","sports"])}),it("should avoid duplication of interests",function(){this.component.addSelectedInterest("music"),this.component.addSelectedInterest("music"),this.component.addSelectedInterest("music"),expect(this.component.loadSelectedInterests()).toEqual(["music"])}),it("can remove interests",function(){this.component.addSelectedInterest("music"),this.component.addSelectedInterest("sports"),this.component.addSelectedInterest("animals"),expect(this.component.loadSelectedInterests()).toEqual(["music","sports","animals"]),this.component.removeSelectedInterest("sports"),expect(this.component.loadSelectedInterests()).toEqual(["music","animals"])})}),describe("custom interests",function(){it("should set custom interests",function(){this.component.setCustomInterest("custom-1","throat singing"),expect(this.component.getCustomInterest("custom-1")).toEqual("throat singing")})})})
});
define("test/app/ui/welcome/learn_dashboard_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/learn_dashboard",function(){beforeEach(function(){var a="<ol>\n      <li class='js-stream-item'>\n        <div class=\"user-actions btn-group following\" data-user-id='162'> </div>\n        </li>\n    </ol>\n    ";setupComponent(a)}),it("device follow one",function(){spyOnEvent(document,"uiDeviceNotificationsOnAction"),this.component.attr.deviceEnabled=!0,this.component.attr.maybeDeviceEnabled=!1,this.component.attr.deviceFollowIds[0]=162,this.component.trigger(document,"uiFollowAction",{newState:"following",userId:162}),expect("uiDeviceNotificationsOnAction").toHaveBeenTriggeredOn(document)}),it("device follow all",function(){spyOnEvent(document,"uiDeviceNotificationsOnAction"),this.component.attr.deviceFollowIds[0]=162,this.component.maybeDeviceNotificationOnAfterDialog({target:{id:"welcome-lifeline-device-follow-dialog"}}),expect("uiDeviceNotificationsOnAction").toHaveBeenTriggeredOn(document)}),describe("on the suggested user list page",function(){beforeEach(function(){var a="<ol>\n        <li class='js-stream-item' data-item-id='businesses'>\n          <div class='interest-category'>\n            <a href=\"/welcome/interests/businesses\" class=\"js-nav\">\n              <strong>Businesses</strong>\n            </a>\n          </div>\n        </li>\n      </ol>\n      ";setupComponent(a)}),it("triggers a uiShowWelcomeInterest event when clicked",function(){spyOnEvent(document,"uiShowWelcomeInterest"),this.$node.find(this.component.attr.interestLinkSelector).click(),expect("uiShowWelcomeInterest").toHaveBeenTriggeredOn(document)}),it("has an open class when expanded",function(){var a=$.Event("click",{target:this.$node.find("a.js-nav")});this.component.toggleCategoryExpand(a),expect(this.$node.find(this.component.attr.streamItemSelector).hasClass("open")).toBe(!0)}),it("does not have an open class when closed",function(){var a=$.Event("click",{target:this.$node.find("a.js-nav")});this.component.toggleCategoryExpand(a),this.component.toggleCategoryExpand(a),expect(this.$node.find(this.component.attr.streamItemSelector).hasClass("open")).toBe(!1)})})})
});
define("test/app/ui/welcome/with_welcome_search_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/welcome/with_welcome_search",function(){var a='<div class="stream-item welcome-card">\n      <div class="welcome-results">\n        <div class="account new-user user-actions not-following" data-user-id="120"></div>\n        <div class="account new-user user-actions not-following" data-user-id="121"></div>\n        <div class="account new-user user-actions not-following" data-user-id="122"></div>\n      </div>\n    </div>\n  ',b='<div class="welcome-search-suggestions"></div>\n  ',c='<div class="stream-item welcome-card">\n      <div class="welcome-results">\n        <div class="account original-user user-actions not-following" data-user-id="110"></div>\n        <div class="account original-user user-actions not-following" data-user-id="111"></div>\n        <div class="account original-user user-actions not-following" data-user-id="112"></div>\n      </div>\n      <div class="welcome-card-pagination">\n        <a class="js-load-more" data-more-cursor="cursor" data-more-placement="" data-more-type="sul"></a>\n      </div>\n    </div>\n\n    <div class="welcome-search-suggestions" style="display: none;"></div>\n  ',d='<div class="stream-item welcome-card js-dynamically-added-search">\n      <div class="welcome-results">\n        <div class="account original-user user-actions not-following" data-user-id="110"></div>\n        <div class="account original-user user-actions not-following" data-user-id="111"></div>\n        <div class="account original-user user-actions not-following" data-user-id="112"></div>\n      </div>\n      <div class="welcome-card-pagination">\n        <a class="js-load-more" data-more-cursor="cursor" data-more-placement="" data-more-type="sul"></a>\n      </div>\n    </div>\n\n    <div class="welcome-search-suggestions" style="display: none;"></div>\n  ',e='<div class="stream-item welcome-card js-dynamically-added-search">\n      <div class="welcome-results">\n        <div class="account original-user user-actions following" data-user-id="110"></div>\n        <div class="account original-user user-actions not-following" data-user-id="111"></div>\n        <div class="account original-user user-actions not-following" data-user-id="112"></div>\n      </div>\n      <div class="welcome-card-pagination">\n        <a class="js-load-more" data-more-cursor="cursor" data-more-placement="" data-more-type="sul"></a>\n      </div>\n    </div>\n\n    <div class="welcome-search-suggestions" style="display: none;"></div>\n  ';beforeEach(function(){var a='<div class="welcome-step">\n        <div class="welcome-step-header">\n          <form class="js-welcome-search" action="javascript:void(0)">\n            <input class="js-search-field" type="text">\n          </form>\n        </div>\n\n        <div>\n          <a href="#" class="js-focus-search focus-search-1" data-placeholder="Your congressperson">Your congressperson</a> •\n          <a href="#" class="js-focus-search focus-search-2">Something else?</a>\n        </div>\n\n        <div class="welcome-stream stream-items">\n        </div>\n      </div>\n    ';setupComponent(a),this.searchForKittens=function(){this.$streamItem=this.$node.find(".stream-item"),spyOnEvent(this.$node,"uiWantsWelcomeSearchResultsCard"),spyOnEvent(this.$node,"uiWelcomeUserSearch"),spyOnEvent(this.$streamItem,"uiWantsWelcomeSearchResultsCard"),this.$node.find(".js-search-field").val("kittens"),this.$node.find(".js-welcome-search").submit()}}),it("does not trigger on empty field",function(){this.$streamItem=this.$node.find(".stream-item"),spyOnEvent(this.$node,"uiWantsWelcomeSearchResultsCard"),spyOnEvent(this.$streamItem,"uiWantsWelcomeSearchResultsCard"),this.$node.find(".js-search-field").val(""),this.$node.find(".js-welcome-search").submit(),expect("uiWantsWelcomeSearchResultsCard").not.toHaveBeenTriggeredOn(this.$node)}),describe("has no results",function(){beforeEach(function(){this.$node.find(".stream-items").html(b)}),it("triggers search on the component",function(){this.searchForKittens(),expect("uiWantsWelcomeSearchResultsCard").toHaveBeenTriggeredOnAndWith(this.$node,{query:"kittens"})}),it("hides suggestions upon receiving results",function(){jasmine.Clock.useMock();var b=this.component.select("searchSuggestionsSelector");expect(b).toBe(":visible"),this.$node.trigger("dataWelcomeSearchResultsCardSuccess",{html:a}),jasmine.Clock.tick(1e3),expect(b).not.toBe(":visible")})}),describe("has an existing card",function(){beforeEach(function(){this.$node.find(".stream-items").html(c)}),it("triggers search on the component",function(){this.searchForKittens(),expect("uiWelcomeUserSearch").toHaveBeenTriggeredOnAndWith(this.$node,{query:"kittens"}),expect("uiWantsWelcomeSearchResultsCard").toHaveBeenTriggeredOnAndWith(this.$node,{query:"kittens"})}),it("prepends search results since the target is the node",function(){expect(this.$node.find(".stream-item").length).toEqual(1),expect(this.$node.find('[data-user-id="110"]')).toExist(),expect(this.$node.find('[data-user-id="120"]')).not.toExist(),this.$node.trigger("dataWelcomeSearchResultsCardSuccess",{html:a}),expect(this.$node.find(".stream-item").length).toEqual(2),expect(this.$node.find('[data-user-id="110"]')).toExist(),expect(this.$node.find('[data-user-id="120"]')).toExist()})}),describe("has a dynamic card without a follow",function(){beforeEach(function(){this.$node.find(".stream-items").html(d)}),it("triggers search on the stream item to replace it",function(){this.searchForKittens(),expect("uiWantsWelcomeSearchResultsCard").toHaveBeenTriggeredOnAndWith(this.$streamItem,{query:"kittens"})}),it("replaces search results since the target is stream item",function(){expect(this.$node.find(".stream-item").length).toEqual(1),expect(this.$node.find('[data-user-id="110"]')).toExist(),expect(this.$node.find('[data-user-id="120"]')).not.toExist(),this.$node.find(".stream-item").trigger("dataWelcomeSearchResultsCardSuccess",{html:a}),expect(this.$node.find(".stream-item").length).toEqual(1),expect(this.$node.find('[data-user-id="110"]')).not.toExist(),expect(this.$node.find('[data-user-id="120"]')).toExist()})}),describe("has a dynamic card with follow",function(){beforeEach(function(){this.$node.find(".stream-items").html(d)}),it("triggers search on the component, leaving the dynamic card",function(){this.searchForKittens(),expect("uiWantsWelcomeSearchResultsCard").toHaveBeenTriggeredOnAndWith(this.$node,{query:"kittens"})})}),describe("focusing",function(){it("copies the placeholder data in",function(){this.$node.find(".focus-search-1").click(),expect(this.$node.find(".js-search-field")).toHaveValue("Your congressperson")})})})
});
define("test/app/ui/welcome/second_session_follow_helper_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/second_session_follow_helper",function(){beforeEach(function(){var a='div class="WelcomeBackBox">\n        <div class="WelcomeBackBox-footer">\n          <button class="btn skip-btn">{{_i}}Continue{{/i}}</button>\n          <button class="btn primary-btn confirm-btn">{{_i}}Follow all & continue{{/i}}</button>\n        </div>\n      </div>\n      <div class="SecondSessionPage-content">\n        <ul class="ProfileCardFollowList">\n          {{#user_views}}\n            <li class="ProfileCardFollowList-item">\n              <div class="ProfileCard">\n                <div class="user-actions btn-group not-following can-dm " data-user-id="1" data-screen-name="a" data-name="a" data-protected="false">\n                </div>\n              </div>\n              <div class="ProfileCard">\n                <div class="user-actions btn-group not-following can-dm " data-user-id="2" data-screen-name="b" data-name="b" data-protected="false">\n                </div>\n              </div>\n              <div class="ProfileCard">\n                <div class="user-actions btn-group not-following can-dm " data-user-id="3" data-screen-name="c" data-name="c" data-protected="false">\n                </div>\n              </div>\n            </li>\n          {{/user_views}}\n        </ul>\n      </div>\n    ';setupComponent(a),this.component.attr.nextPageUrl="next",spyOn(this.component,"goTo").andReturn(!0)}),it("scribes skip clicks and moves to next page",function(){this.$node.find(".skip-btn").click(),expect(this.component).toScribe({action:"skip"}),expect(this.component.goTo).toHaveBeenCalledWith("next")}),it("scribes follow all clicks and triggers an event",function(){spyOnEvent(this.component.$node,"uiFollowAllFriends"),this.$node.find(".confirm-btn").click(),expect(this.component).toScribe({action:"follow_all"}),expect(this.component.goTo).not.toHaveBeenCalled(),expect("uiFollowAllFriends").toHaveBeenTriggeredOnAndWith(this.component.$node,{ids:[1,2,3]})}),it("Goes to the next page on success",function(){this.component.trigger("dataFollowAllSuccess"),expect(this.component.goTo).toHaveBeenCalledWith("next")})})
});
define("test/app/ui/welcome/interests_picker_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/interests_picker",function(){beforeEach(function(){this.initComponent=function(){var a='<ul class="welcome-interest-grid">\n          <li class="interest-cell">\n            <div data-interest="sports" class="interest"><i class="interest-icn category-sports"></i><div class="category-name">Sports</div></div>\n          </li>\n          <li class="interest-cell">\n            <div data-interest="music" class="interest"><i class="interest-icn category-music"></i><div class="category-name">Music</div></div>\n          </li>\n          <li class="interest-cell">\n            <div data-interest="entertainment" class="interest"><i class="interest-icn category-entertainment"></i><div class="category-name">Entertainment</div></div>\n          </li>\n        </ul>\n      ';setupComponent(a)},this.interestButton=function(a){return this.component.$node.find('[data-interest="'+a+'"]')},this.initComponent()}),it("triggers an event with item_position",function(){spyOnEvent(this.$node,"uiWelcomeInterestClicked"),this.interestButton("sports").click(),expect("uiWelcomeInterestClicked").toHaveBeenTriggeredOnAndWith(this.$node,{interest:"sports",pos:0}),this.interestButton("music").click(),expect("uiWelcomeInterestClicked").toHaveBeenTriggeredOnAndWith(this.$node,{interest:"music",pos:1}),this.interestButton("entertainment").click(),expect("uiWelcomeInterestClicked").toHaveBeenTriggeredOnAndWith(this.$node,{interest:"entertainment",pos:2})}),it("restores selected items from Storage on Swift load",function(){this.interestButton("music").click(),this.interestButton("entertainment").click(),this.initComponent();var a=this.interestButton("music"),b=this.interestButton("entertainment");expect(a).not.toHaveClass("selected"),expect(b).not.toHaveClass("selected"),$(document).trigger("uiSwiftLoaded"),expect(a).toHaveClass("selected"),expect(b).toHaveClass("selected")})})
});
define("test/app/ui/welcome/with_similarities_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/welcome/with_similarities",function(){var a='<div class="stream-item welcome-card welcome-card-3">\n      <div class="welcome-results">\n      </div>\n    </div>\n  ';beforeEach(function(){var a='<div class="welcome-stream stream-items">\n        <div class="stream-item welcome-card welcome-card-1">\n          <div class="welcome-results">\n            <div class="account user-actions not-following" data-user-id="110"><div class="js-follow-btn"></div></div>\n            <div class="account user-actions following" data-user-id="111"><div class="js-follow-btn"></div></div>\n          </div>\n        </div>\n\n        <div class="stream-item welcome-card welcome-card-2">\n          <div class="welcome-results">\n            <div class="account user-actions not-following" data-user-id="110"><div class="js-follow-btn"></div></div>\n          </div>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("asks for similarities after following",function(){var a=this.$node.find(".welcome-card");spyOnEvent(a,"uiWantsWelcomeSimilaritiesCard"),this.$node.find(".welcome-card-1 .not-following .js-follow-btn").trigger("mousedown"),expect("uiWantsWelcomeSimilaritiesCard").toHaveBeenTriggeredOnAndWith(a,{userId:"110"})}),it("does not ask for similarities after unfollowing",function(){var a=this.$node.find(".welcome-card");spyOnEvent(a,"uiWantsWelcomeSimilaritiesCard"),this.$node.find(".welcome-card-1 .following .js-follow-btn").trigger("mousedown"),expect("uiWantsWelcomeSimilaritiesCard").not.toHaveBeenTriggeredOn(a)}),it("triggers on the welcome-card containing the following",function(){var a=this.$node.find(".welcome-card-2");spyOnEvent(a,"uiWantsWelcomeSimilaritiesCard"),this.$node.find(".welcome-card-2 .not-following .js-follow-btn").trigger("mousedown"),expect("uiWantsWelcomeSimilaritiesCard").toHaveBeenTriggeredOnAndWith(a,{userId:"110"})}),it("appends new results after the card that is triggered on",function(){this.$node.find(".welcome-card-1").trigger("dataWelcomeSimilaritiesCardSuccess",{html:a});var b=this.$node.find(".welcome-card");expect($(b[0])).toHaveClass("welcome-card-1"),expect($(b[1])).toHaveClass("welcome-card-3"),expect($(b[2])).toHaveClass("welcome-card-2")})})
});
define("test/app/ui/welcome/profile_form_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/profile_form",function(){beforeEach(function(){var a='<div>\n        <form class="welcome-profile-form" method="get" action="javascript:void(0)">\n          <div class="js-bio-count">0</div>\n          <textarea></textarea>\n          <input type="text">\n        </form>\n      </div>\n    ';setupComponent(a)}),it("submits the form when it gets the signal",function(){var a=jasmine.createSpy();this.component.select("profileFormSelector").submit(a),$(document).trigger("uiSubmitWelcomeProfileForm"),expect(a).toHaveBeenCalled()}),it("updates the counter when the bio field changes",function(){this.component.select("bioSelector").val("kittens"),this.component.select("bioSelector").trigger("keyup"),expect(this.component.select("bioCountSelector")).toHaveText("7")}),it("highlights the next button when a value is entered",function(){spyOnEvent(this.$node,"uiSetWelcomeNextButton"),this.component.select("textInputSelector").val("boats"),this.component.select("textInputSelector").trigger("keyup"),expect("uiSetWelcomeNextButton").toHaveBeenTriggeredOn(this.$node,{primary:!0})})})
});
define("test/app/ui/welcome/internal_link_disabler_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/internal_link_disabler",function(){beforeEach(function(){var a='<div>\n        <div class="component">\n          <a href="javascript:void(0)" class="js-nav">click me</a>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("prevents uiNavigates from bubbling up",function(){var a=$("#fixture_parent");spyOnEvent(a,"uiNavigate"),a.on("click","a.js-nav",function(a){gotClick=!0,$(a.target).trigger("uiNavigate")}),this.$node.find(".js-nav").click(),expect(gotClick).toBe(!0),expect("uiNavigate").not.toHaveBeenTriggeredOn(a)})})
});
define("test/app/ui/welcome/profile_flow_nav_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/profile_flow_nav",function(){beforeEach(function(){var a='<div class="welcome-flow-nav">\n        <div class="welcome-flow-nav-inner clearfix">\n          <a href="#" class="js-prev-btn btn prev-btn">&laquo; Previous</a>\n          <a href="#" class="js-next-btn btn next-btn">Next &raquo;</a>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("triggers a submit event on clicking next",function(){spyOnEvent(this.$node,"uiSubmitWelcomeProfileForm");var a=this.component.select("nextButtonSelector");a.click(),expect("uiSubmitWelcomeProfileForm").toHaveBeenTriggeredOn(this.$node)})})
});
define("test/app/ui/welcome/customize_profile_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/customize_profile",function(){it("fires the initialization event when setup",function(){spyOnEvent(document,"uiEditProfileInitialize"),setupComponent(),expect("uiEditProfileInitialize").toHaveBeenTriggeredOn(document)});var a='<div id="container">\n      <div class="c1 c1--remove"></div>\n      <div class="c2 c2--remove"></div>\n      <div id="avatar"></div>\n      <div class="skip-btn"></div>\n    </div>\n   ';describe("main functionality",function(){var b,c={nextPageUrl:"next",avatarSelector:"#avatar",welcomeBoxComponent:"c1",avatarTweeterComponent:"c2",removeMode:"--remove",addMode:"--add"};beforeEach(function(){setupComponent(a,c),b=spyOn(this.component,"goTo")}),describe("click skip button",function(){it("scribes and navigates to the next page",function(){this.component.select("skipSelector").click(),expect(this.component).toScribe({component:"customize_profile",action:"skip"}),expect(b).toHaveBeenCalledWith("next")})}),describe("when uiImageSave is triggered",function(){it("toggles the proper classes",function(){var a=$("."+c.welcomeBoxComponent),b=$("."+c.avatarTweeterComponent);expect(a).toHaveClass(c.welcomeBoxComponent+c.removeMode),expect(b).toHaveClass(c.avatarTweeterComponent+c.removeMode),expect(a).not.toHaveClass(c.welcomeBoxComponent+c.addMode),expect(b).not.toHaveClass(c.avatarTweeterComponent+c.addMode),spyOnEvent(c.avatarSelector,"uiEditProfileEnd"),$("#container").trigger("uiImageSave"),expect(a).not.toHaveClass(c.welcomeBoxComponent+c.removeMode),expect(b).not.toHaveClass(c.avatarTweeterComponent+c.removeMode),expect(a).toHaveClass(c.welcomeBoxComponent+c.addMode),expect(b).toHaveClass(c.avatarTweeterComponent+c.addMode)}),it("triggers 'uiEditProfileEnd'",function(){spyOnEvent(c.avatarSelector,"uiEditProfileEnd"),this.$node.trigger("uiImageSave"),expect("uiEditProfileEnd").toHaveBeenTriggeredOn(c.avatarSelector)})}),describe("attempting to tweet",function(){it("navigates to the next page if the tweet fails",function(){$(document).trigger("dataTweetError"),expect(b).toHaveBeenCalledWith("next")}),it("navigates to the next page if the tweet succeeds",function(){$(document).trigger("dataTweetSuccess"),expect(b).toHaveBeenCalledWith("next")})})})})
});
define("test/app/ui/welcome/lifeline_device_follow_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/lifeline_device_follow_dialog",function(){beforeEach(function(){var a='<div id="lifeline-dialog" style="display: none;" class="modal-container">\n        <div class="modal draggable">\n          <div class="modal-content">\n            <button type="button" class="modal-btn modal-close"><i class="close-medium"></i></button>\n            <div class="modal-header">\n              <h3 class="modal-title"></h3>\n            </div>\n            <div class="modal-body">\n            </div>\n            <div class="modal-footer modal-tweet"></div>\n          </div>\n        </div>\n      </div>\n    ';this.html=a,setupComponent(this.html)}),it("Device Follow Dialog should be opened",function(){spyOnEvent(document,"uiLifelineDeviceFollowDialogOpened"),spyOnEvent(document,"uiDialogClosed"),this.component.attr.deviceEnabled=!1,this.component.attr.deviceFollowIds[0]=162,this.component.trigger(document,"uiFollowAction",{newState:"following",userId:162}),expect("uiLifelineDeviceFollowDialogOpened").toHaveBeenTriggeredOn(document)})})
});
define("test/app/ui/welcome/intro_video_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/intro_video",function(){beforeEach(function(){var a="<div></div>\n    ";setupComponent(a)}),it("adds an iframe tag to itself",function(){this.$node.click(),expect(this.$node.find("iframe")).toExist()}),it("triggers an event we can scribe on",function(){spyOnEvent(this.$node,"uiWelcomeVideoClicked"),this.$node.click(),expect("uiWelcomeVideoClicked").toHaveBeenTriggeredOn(this.$node)}),it("only works once",function(){this.$node.click(),spyOnEvent(this.$node,"uiWelcomeVideoClicked"),this.$node.click(),expect("uiWelcomeVideoClicked").not.toHaveBeenTriggeredOn(this.$node)})})
});
define("test/app/ui/welcome/with_more_results_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/welcome/with_more_results",function(){var a='<div class="account new-user" data-user-id="120"></div>\n    <div class="account new-user" data-user-id="121"></div>\n    <div class="account new-user" data-user-id="122"></div>\n  ';beforeEach(function(){var a='<div class="welcome-stream">\n        <div class="stream-item welcome-card normal-card" data-component-context="sul_user_stream" data-scribe-context="{&quot;query&quot;: &quot;music-country&quot;}">\n          <div class="welcome-card-header">\n            <span class="js-welcome-card-title">Results</span>\n          </div>\n          <div class="welcome-results">\n            <div class="account original-user" data-user-id="110"></div>\n            <div class="account original-user" data-user-id="111"></div>\n            <div class="account original-user" data-user-id="112"></div>\n          </div>\n          <div class="welcome-card-pagination">\n            <a class="js-load-more" data-more-cursor="cursor" data-more-placement="" data-more-type="sul"></a>\n          </div>\n        </div>\n\n        <div class="stream-item welcome-card expand-card" data-component-context="sul_user_stream" data-scribe-context="{&quot;query&quot;: &quot;music-country&quot;}">\n          <div class="welcome-card-header expandable collapsed js-load-more" data-more-cursor="cursor" data-more-placement="expand" data-more-type="sul">\n            <span class="js-welcome-card-title">Results</span>\n          </div>\n        </div>\n\n        <div class="stream-item welcome-card expanded-card" data-component-context="sul_user_stream" data-scribe-context="{&quot;query&quot;: &quot;music-country&quot;}">\n          <div class="welcome-card-header expandable expanded js-load-more" data-more-cursor="cursor" data-more-placement="expand" data-more-type="sul">\n            <span class="js-welcome-card-title">Results</span>\n          </div>\n\n          <div class="welcome-results">\n            <div class="account original-user" data-user-id="110"></div>\n            <div class="account original-user" data-user-id="111"></div>\n            <div class="account original-user" data-user-id="112"></div>\n          </div>\n        </div>\n      </div>\n    ';setupComponent(a)}),describe('placement set to "replace"',function(){beforeEach(function(){this.$node.find(".normal-card .js-load-more").attr("data-more-placement","replace"),this.$streamItem=this.$node.find(".normal-card")}),it("asks for more data and slide up existing results",function(){jasmine.Clock.useMock(),spyOnEvent(this.$streamItem,"uiWantsWelcomeMoreResults"),this.$streamItem.find(".js-load-more").click(),jasmine.Clock.tick(1e3),expect(this.$streamItem).toHaveClass("loading"),expect(this.$streamItem.find(".original-user")).toBeHidden(),expect("uiWantsWelcomeMoreResults").toHaveBeenTriggeredOnAndWith(this.$streamItem,{type:"sul",cursor:"cursor",automatic:!0,componentName:"sul_user_stream",scribeData:{query:"music-country"}})}),it("adds new users and slide down results on success",function(){jasmine.Clock.useMock(),expect(this.$streamItem.find(".original-user")).toExist(),expect(this.$streamItem.find(".new-user")).not.toExist(),this.$streamItem.find(".js-load-more").click(),jasmine.Clock.tick(1e3),this.$streamItem.trigger("dataWelcomeMoreResultsSuccess",{html:a}),expect(this.$streamItem.find(".original-user")).not.toExist(),expect(this.$streamItem.find(".new-user")).toExist(),expect(this.$streamItem.find(".new-user")).toBeVisible(),expect(this.$streamItem.find(".welcome-card-pagination")).not.toExist()}),it("slides down old results when there are no new results",function(){jasmine.Clock.useMock(),this.$streamItem.find(".js-load-more").click(),jasmine.Clock.tick(1e3),this.$streamItem.trigger("dataWelcomeMoreResultsSuccess",{html:""}),jasmine.Clock.tick(1e3),expect(this.$streamItem.find(".original-user")).toExist(),expect(this.$streamItem.find(".original-user")).toBeVisible(),expect(this.$streamItem.find(".welcome-card-pagination")).not.toExist()})}),describe('placement set to "append"',function(){beforeEach(function(){this.$node.find(".normal-card .js-load-more").attr("data-more-placement","append"),this.$streamItem=this.$node.find(".normal-card")}),it("appends new users on success, and also changes the title",function(){jasmine.Clock.useMock(),expect(this.$streamItem.find(".original-user")).toExist(),expect(this.$streamItem.find(".new-user")).not.toExist(),this.$streamItem.find(".js-load-more").click(),jasmine.Clock.tick(1e3),this.$streamItem.trigger("dataWelcomeMoreResultsSuccess",{html:a,title:"new results"}),expect(this.$streamItem.find(".original-user")).toExist(),expect(this.$streamItem.find(".new-user")).toExist(),expect(this.$streamItem.find(".new-user")).toBeVisible(),expect(this.$streamItem.find(".js-welcome-card-title")).toHaveText("new results"),expect(this.$streamItem.find(".welcome-card-pagination")).not.toExist()})}),describe('placement set to "expand"',function(){it("asks for more data when clicked",function(){jasmine.Clock.useMock();var a=this.$node.find(".expand-card");spyOnEvent(a,"uiWantsWelcomeMoreResults"),this.component.select("loadMoreSelector").click(),jasmine.Clock.tick(1e3),expect(a).toHaveClass("loading"),expect("uiWantsWelcomeMoreResults").toHaveBeenTriggeredOnAndWith(a,{type:"sul",cursor:"cursor",automatic:!0,componentName:"sul_user_stream",scribeData:{query:"music-country"}})}),it("adds new results when expanding",function(){var b=this.$node.find(".expand-card"),c=b.find(".welcome-card-header");expect(c).not.toHaveClass("expanded"),expect(c).toHaveClass("collapsed"),b.trigger("dataWelcomeMoreResultsSuccess",{html:a}),expect(c).toHaveClass("expanded"),expect(c).not.toHaveClass("collapsed"),expect(b.find(".welcome-results")).toExist(),expect(b.find(".new-user")).toExist(),expect(b.find(".new-user")).toBeVisible()}),it("collapses results when done",function(){jasmine.Clock.useMock();var a=this.$node.find(".expanded-card"),b=a.find(".welcome-card-header");expect(b).toHaveClass("expanded"),expect(b).not.toHaveClass("collapsed"),spyOnEvent(a,"uiWantsWelcomeMoreResults"),this.component.select("loadMoreSelector").click(),jasmine.Clock.tick(1e3),expect(b).not.toHaveClass("expanded"),expect(b).toHaveClass("collapsed"),expect(a.find(".original-user")).not.toExist(),expect(a.find(".welcome-results")).not.toExist(),expect("uiWantsWelcomeMoreResults").not.toHaveBeenTriggeredOn(a)})})})
});
define("test/app/ui/media/media_thumbnails_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/media/media_thumbnails",function(){function e(a,b){waitsFor(function(){return a.component.hasPublishedVisibleThumbsFlag}),runs(b)}var a=["/9j/4AAQSkZJRgABAQEASABIAAD/2wCDEAAcABwAHAAeAB4AHgAmACYAJgAm","ADIAMgAyADIAMgBEAEQARABEAEQARABaAFoAWgBaAFoAWgBaAHYAdgB2AHYA","dgB2AHYAdgDpAOkA6QDpAOkA6QDpAc8BzwHPAc8BzwHPA5sDmwObA5sDmwcz","BzMHMwczDmMOYw5jHMMcwzmD/8EACwgAEAAMAQERAP/EABYAAQEBAAAAAAAA","AAAAAAAAAAYBBP/EACAQAAIBBAEFAAAAAAAAAAAAAAEDAgAEESIFEiExUYH/","2gAIAQEAAD8A1chya0CaobMIwfQqWCnuQGSYdiSO8vH2jjEXJZIyVPqJydTT","O0yLZQMDEiIGK//Z"].join(""),b=["/9j/4AAQSkZJRgABAQEASABIAAD/2wCDEAAcABwAHAAeAB4AHgAmACYAJgAm","ADIAMgAyADIAMgBEAEQARABEAEQARABaAFoAWgBaAFoAWgBaAHYAdgB2AHYA","this ought to make it invalid.","BzMHMwczDmMOYw5jHMMcwzmD/8EACwgAEAAMAQERAP/EABYAAQEBAAAAAAAA","AAAAAAAAAAYBBP/EACAQAAIBBAEFAAAAAAAAAAAAAAEDAgAEESIFEiExUYH/","2gAIAQEAAD8A1chya0CaobMIwfQqWCnuQGSYdiSO8vH2jjEXJZIyVPqJydTT","O0yLZQMDEiIGK//Z"].join(""),c="data:image/jpeg;base64,"+a,d="data:image/jpeg;base64,"+b;beforeEach(function(){this.stubCallbacks=function(){this.component.publishVisibleThumbs=function(){}},this.baseHtml=['<li class="media-thumbnails">','<a href="#" class="list-link">','<div class="media-header">',"Recent Images",'<i class="chev-right"></i>',"</div>",'<div class="media-row">','<div class="media-row-content photo-list">',"{media_row_content}","</div>","</div>","</a>","</li>"].join("");var a=['<span data-url="http://instagr.am/p/9vd3/" class="media-thumbnail test1"></span>','<span data-url="https://p.twimg.com/AoZgjXQCIAEEH6p.jpg" data-resolved-url-small="https://p.twimg.com/AoZgjXQCIAEEH6p.jpg" class="media-thumbnail test2"></span>','<span data-url="http://instagr.am/p/9vd3/" class="media-thumbnail test3 video"></span>','<span data-url="http://instagr.am/p/9vd3/" class="media-thumbnail test4"></span>','<span data-url="http://instagr.am/p/9vd3/" class="media-thumbnail test5"></span>'].join("");this.newThumbs=['<span data-url="https://p.twimg.com/AoZgjXQCIAEEH6p.jpg" data-resolved-url-small="https://p.twimg.com/AoZgjXQCIAEEH6p.jpg" class="media-thumbnail test6"></span>','<span data-url="https://p.twimg.com/AoZgjXQCIAEEH6p.jpg" data-resolved-url-small="https://p.twimg.com/AoZgjXQCIAEEH6p.jpg" class="media-thumbnail test7"></span>'],this.html=this.baseHtml.replace("{media_row_content}",a),$(this.html).find(".media-thumbnail").attr("data-url",c)});var f={sandboxes:{detailsPane:"http://localhost:3000/details_pane_content_sandbox.html",jsonp:"http://localhost:3000/jsonp_sandbox.html"},thumbnailsVisible:4};describe("on initialize",function(){beforeEach(function(){spyOn(this.Component.prototype,"initThumbs"),setupComponent(this.html,f),this.stubCallbacks()}),it("calls loadThumbs",function(){expect(this.component.initThumbs).toHaveBeenCalled()})}),describe("on uiReloadThumbs",function(){beforeEach(function(){spyOn(this.Component.prototype,"reloadThumbs"),setupComponent(this.html,f),this.stubCallbacks()}),it("calls reloadThumbs",function(){this.$node.trigger("uiReloadThumbs"),expect(this.component.reloadThumbs).toHaveBeenCalled()})}),describe("event uiMediaThumbnailsVisible",function(){var a="uiMediaThumbnailsVisible";beforeEach(function(){spyOnEvent(document,a)}),describe("when there are no thumbnails",function(){beforeEach(function(){var a=this.baseHtml.replace("{media_row_content}","");setupComponent(a,f)}),it("fires with an empty urls array",function(){e(this,function(){expect(a).toHaveBeenTriggeredOnAndWith(document,{thumbnails:[]})})})}),describe("when all thumbnails load successfully",function(){beforeEach(function(){var a=$(this.html);a.find(".media-thumbnail").attr("data-resolved-url-small",c).attr("data-url","http://test.host/test.jpg"),setupComponent(a,f)}),it("fires with data-hrefs of the 4 visible thumbnails",function(){e(this,function(){expect(a).toHaveBeenTriggeredOnAndWith(document,{thumbnails:["http://test.host/test.jpg","http://test.host/test.jpg","http://test.host/test.jpg","http://test.host/test.jpg"]})})})}),describe("when some thumbnails do not load successfully",function(){beforeEach(function(){var a=$(this.html);$spans=a.find(".media-thumbnail"),$($spans[0]).attr("data-resolved-url-small",c).attr("data-url","http://test.host/valid1.jpg"),$($spans[1]).attr("data-resolved-url-small",d).attr("data-url","http://test.host/invalid1.jpg"),$($spans[2]).attr("data-resolved-url-small",c).attr("data-url","http://test.host/valid2.jpg"),$($spans[3]).attr("data-resolved-url-small",d).attr("data-url","http://test.host/invalid2.jpg"),$($spans[4]).attr("data-resolved-url-small",c).attr("data-url","http://test.host/valid3.jpg"),setupComponent(a,f)}),it("fires with only successful urls",function(){e(this,function(){expect(a).toHaveBeenTriggeredOnAndWith(document,{thumbnails:["http://test.host/valid1.jpg","http://test.host/valid2.jpg","http://test.host/valid3.jpg"]})})})})}),describe("loads new thumbnails when available",function(){beforeEach(function(){setupComponent(this.html,{sandboxes:f.sandboxes,shouldUpdateThumbs:!0}),this.stubCallbacks()}),it("renders new thumbs when uiMediaThumbnailGotNewItems is fired",function(){this.component.trigger("uiMediaThumbnailGotNewItems",{thumbnails:this.newThumbs}),expect(this.component.$node.find(".test6").length).toEqual(1),expect(this.component.$node.find(".test7").length).toEqual(1)})}),describe("removes component if no thumbs",function(){it("resolves data-url",function(){var a=$(this.html);a.find(".media-thumbnail").remove();var b=spyOn(this.Component.prototype,"hideThumbs");setupComponent(a,f),this.stubCallbacks(),expect(b).toHaveBeenCalled()})}),describe("removes component if all thumbs fail to load",function(){beforeEach(function(){var a=$(this.html);$spans=a.find(".media-thumbnail"),$($spans[0]).attr("data-resolved-url-small",d).attr("data-url","http://test.host/invalid.jpg"),$($spans[1]).attr("data-resolved-url-small",d).attr("data-url","http://test.host/invalid.jpg"),$($spans[2]).attr("data-resolved-url-small",d).attr("data-url","http://test.host/invalid.jpg"),$($spans[3]).attr("data-resolved-url-small",d).attr("data-url","http://test.host/invalid.jpg"),$($spans[4]).attr("data-resolved-url-small",d).attr("data-url","http://test.host/invalid.jpg"),spyOn(this.Component.prototype,"hideThumbs"),setupComponent(a,f)}),it("hides element after all images fail",function(){waitsFor(function(){return this.component.hasFinishedLoading()}),runs(function(){expect(this.component.hideThumbs).toHaveBeenCalled()})})}),describe("only loads the visible # of thumbs",function(){it("only tries to load 4 thumbs",function(){var a=spyOn(this.Component.prototype,"resolveThumbUrl");setupComponent(this.html,f),this.stubCallbacks(),expect(a.callCount).toEqual(4)}),it("should load additional image when there is image load error",function(){var a=spyOn(this.Component.prototype,"resolveThumbUrl");setupComponent(this.html,f),expect(a.callCount).toEqual(4);var b=this.$node.find(".test1");this.component.thumbFailed(b),expect(a.callCount).toEqual(5)})}),describe("create thumbnail images",function(){beforeEach(function(){var a=$(this.html);a.find(".media-thumbnail").attr("data-resolved-url-small",c),setupComponent(a,f),this.stubCallbacks()}),it("renders images for each media-thumbnail",function(){waitsFor(function(){return this.$node.find("img").length==4}),runs(function(){expect(this.$node.find("img").length).toEqual(4),expect(this.$node.find('.media-thumbnail[data-load-status="loaded"]').length).toEqual(4)})})}),describe("event uiMediaThumbnailClick",function(){var a="uiMediaThumbnailClick";beforeEach(function(){setupComponent(this.html,f),this.stubCallbacks(),this.component.visitLink=function(a){a.preventDefault()}}),describe("when a photo is clicked",function(){it("fires with url and item mediaType: photo",function(){spyOnEvent(this.$node,a),this.$node.find(".test2").click(),expect(a).toHaveBeenTriggeredOnAndWith(this.$node,{url:"https://p.twimg.com/AoZgjXQCIAEEH6p.jpg",mediaType:"photo"})})})}),describe("event uiMediaViewAllClick",function(){beforeEach(function(){setupComponent(this.html,f),this.stubCallbacks()}),it("fires when the list link is clicked",function(){spyOnEvent(document,"uiMediaViewAllClick"),this.$node.on("click",".list-link",function(a){a.preventDefault()}),this.$node.find(".list-link .media-header").click(),expect("uiMediaViewAllClick").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/media/with_flag_action_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/media/with_flag_action",function(){var a;beforeEach(function(){var a='<div class="tweet" data-tweet-id="4">\n        <span class="flag-container">\n          <button class="flaggable btn-link">\n            Flag this media\n          </button>\n          <span class="flagged hidden">\n            Flagged\n            <span>\n              <a target="_blank" href="//support.twitter.com/articles/20069937">\n                (learn more)\n              </a>\n            </span>\n          </span>\n        </span>\n      </div>\n    ';setupComponent(a)}),it("shows flagged text on embed on click",function(){this.component.$node.find(".flag-container").click(),expect(this.component.$node.find(".flaggable")).toHaveClass("hidden"),expect(this.component.$node.find(".flagged")).not.toHaveClass("hidden")}),it("fires event uiFlagMedia on click",function(){spyOnEvent(document,"uiFlagMedia"),this.component.$node.find(".flag-container").click(),expect("uiFlagMedia").toHaveBeenTriggeredOnAndWith(document,{id:"4"})}),it("only fires event uiFlagMedia once, even if clicked multiple times",function(){var a=jasmine.createSpy();this.component.$node.on("uiFlagMedia",a),this.component.$node.find(".flag-container").click(),this.component.$node.find(".flag-container").click(),expect(a.callCount).toBe(1)})})
});
define("test/app/ui/media/card_thumbnails_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/media/card_thumbnails",function(){beforeEach(function(){this.html=['<li class="media-thumbnails">','<a href="#" class="list-link">view all</a>','<div class="media-header">',"Recent Images",'<i class="chev-right"></i>',"</div>",'<div class="media-row">','<div class="media-row-content photo-list">','<span class="thumbnail-placeholder first"></span>',"</div>","</div>","</a>","</li>"].join(""),this.thumbs=['<span data-load-status="not-loaded" data-url="http://yfrog.com/h0q3fdbj" class="media-thumbnail test1"></span>','<span data-load-status="not-loaded" data-url="https://p.twimg.com/AoZgjXQCIAEEH6p.jpg" data-resolved-url-small="https://p.twimg.com/AoZgjXQCIAEEH6p.jpg" class="media-thumbnail test2"></span>','<span data-load-status="not-loaded" data-url="http://yfrog.com/h0q3fdbj" class="media-thumbnail test3 video"></span>','<span data-load-status="not-loaded" data-url="http://yfrog.com/h0q3fdbj" class="media-thumbnail test4"></span>','<span data-load-status="not-loaded" data-url="http://yfrog.com/h0q3fdbj" class="media-thumbnail test5"></span>'],this.prerenderedNode=$(this.html),$(this.thumbs.join("")).insertBefore(this.prerenderedNode.find(".thumbnail-placeholder"))});var a={showAllInlineMedia:!0,sandboxes:{detailsPane:"http://localhost:3000/details_pane_content_sandbox.html",jsonp:"http://localhost:3000/jsonp_sandbox.html"},thumbnailsVisible:4};describe("on initialize",function(){it("calls getMoreItems",function(){spyOn(this.Component.prototype,"getMoreItems"),setupComponent(this.html,a),expect(this.component.getMoreItems).toHaveBeenCalled()}),it("does not calls getMoreItems if showAllInlineMedia is false",function(){spyOn(this.Component.prototype,"getMoreItems"),setupComponent(this.html,$.extend({},a,{showAllInlineMedia:!1})),expect(this.component.getMoreItems).not.toHaveBeenCalled(),this.component.trigger("uiReloadThumbs"),expect(this.component.getMoreItems).toHaveBeenCalled()}),it("calls openGrid if mediaGridOpen and mediaGrid are true",function(){spyOn(this.Component.prototype,"openGrid"),setupComponent(this.prerenderedNode,$.extend({},a,{mediaGrid:!0,mediaGridOpen:!0})),expect(this.component.openGrid).toHaveBeenCalled()})}),describe("rendering thumbs",function(){describe("when thumbnails are rendered",function(){beforeEach(function(){setupComponent(this.html,a),spyOnEvent(document,"uiMediaThumbnailsVisible")}),it("renders with an array of media elements",function(){this.component.trigger(document,"dataGotMoreMediaTimelineItems",{items_html:this.thumbs}),expect("uiMediaThumbnailsVisible").toHaveBeenTriggeredOnAndWith(document,{thumbnails:["http://yfrog.com/h0q3fdbj","https://p.twimg.com/AoZgjXQCIAEEH6p.jpg","http://yfrog.com/h0q3fdbj","http://yfrog.com/h0q3fdbj"]})}),it("renders with a string of media elements",function(){this.component.trigger(document,"dataGotMoreMediaTimelineItems",{items_html:this.thumbs.join("")}),expect("uiMediaThumbnailsVisible").toHaveBeenTriggeredOnAndWith(document,{thumbnails:["http://yfrog.com/h0q3fdbj","https://p.twimg.com/AoZgjXQCIAEEH6p.jpg","http://yfrog.com/h0q3fdbj","http://yfrog.com/h0q3fdbj"]})}),it("is initially hidden",function(){expect(this.component.$node).not.toBeVisible()}),it("becomes visible after successfully loading thumbs",function(){this.component.loadThumbSuccess($("<div/>"),$("<img/>")),expect(this.component.$node).toBeVisible()})})}),describe("clicking the view all link",function(){describe("when mediaGrid is true",function(){it("triggers uiMediaViewAllClick",function(){setupComponent(this.html,$.extend({},a,{mediaGrid:!0})),spyOnEvent(document,"uiMediaViewAllClick"),spyOn(this.component,"openGallery"),this.component.select("viewAllSelector").click(),expect("uiMediaViewAllClick").toHaveBeenTriggeredOn(document),expect(this.component.openGallery).not.toHaveBeenCalled()})}),describe("when mediaGrid is false",function(){it("calls openGallery",function(){setupComponent(this.html,$.extend({},a,{mediaGrid:!1})),spyOnEvent(document,"uiMediaViewAllClick"),spyOn(this.component,"openGallery"),this.component.select("viewAllSelector").click(),expect("uiMediaViewAllClick").not.toHaveBeenTriggeredOn(document),expect(this.component.openGallery).toHaveBeenCalled()})})}),describe("event uiMediaThumbnailClick",function(){var b="uiMediaThumbnailClick";beforeEach(function(){setupComponent(this.html,a)}),describe("when a photo is clicked",function(){it("fires with url",function(){this.component.trigger(document,"dataGotMoreMediaTimelineItems",{items_html:this.thumbs}),spyOnEvent(this.$node,b),this.$node.find(".test2").click(),expect(b).toHaveBeenTriggeredOnAndWith(this.$node,{url:"https://p.twimg.com/AoZgjXQCIAEEH6p.jpg",mediaType:"photo"})})}),describe("when a video is clicked",function(){it("fires with url and item mediaType: video",function(){this.component.trigger(document,"dataGotMoreMediaTimelineItems",{items_html:this.thumbs}),spyOnEvent(this.$node,b),this.$node.find(".test3").click(),expect(b).toHaveBeenTriggeredOnAndWith(this.$node,{url:"http://yfrog.com/h0q3fdbj",mediaType:"video"})})})})})
});
define("test/app/ui/media/sensitive_media_tweets_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/media/sensitive_media_tweets",function(){var a;beforeEach(function(){var a='<div id="tweet-1">\n        <div class="js-tweet-details-fixer">\n          <div class="media-not-displayed">\n            <button type="button" class="btn display-this-media">Display this</button>\n            <button type="button" class="btn-link always-display-media">Always display media like this.</button>\n          </div>\n          <div class="entities-media-container js-media-container hidden"></div>\n          <div class="cards-media-container js-media-container hidden"></div>\n        </div>\n      </div>\n\n      <div id="tweet-2">\n        <div class="js-tweet-details-fixer">\n          <div class="media-not-displayed">\n            <button type="button" class="btn display-this-media">Display this</button>\n            <button type="button" class="btn-link always-display-media">Always display media like this.</button>\n          </div>\n          <div class="entities-media-container js-media-container hidden"></div>\n          <div class="cards-media-container js-media-container hidden"></div>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("shows a tweet's media container on display-this-media click",function(){var a=this.component.$node.find(".entities-media-container")[0];expect(a).toHaveClass(this.component.attr.hiddenClass),this.component.select("displayMediaSelector")[0].click(),expect(a).not.toHaveClass(this.component.attr.hiddenClass)}),it("shows a tweet's cards container on display-this-media click",function(){var a=this.component.$node.find(".cards-media-container")[0];expect(a).toHaveClass(this.component.attr.hiddenClass),this.component.select("displayMediaSelector")[0].click(),expect(a).not.toHaveClass(this.component.attr.hiddenClass)}),it("shows all tweet media containers on always-display-media click",function(){var a=this.component.$node.find(".entities-media-container");expect(a[1]).toHaveClass(this.component.attr.hiddenClass),this.component.select("alwaysDisplaySelector")[0].click(),expect(a[1]).not.toHaveClass(this.component.attr.hiddenClass)}),it("shows all tweet card containers on always-display-media click",function(){var a=this.component.$node.find(".cards-media-container");expect(a[1]).toHaveClass(this.component.attr.hiddenClass),this.component.select("alwaysDisplaySelector")[0].click(),expect(a[1]).not.toHaveClass(this.component.attr.hiddenClass)}),it("fires uiUpdateViewPossiblySensitive on always-display-media click",function(){spyOnEvent(document,"uiUpdateViewPossiblySensitive"),this.component.select("alwaysDisplaySelector")[0].click(),expect("uiUpdateViewPossiblySensitive").toHaveBeenTriggeredOnAndWith(document,{do_show:!0})})})
});
define("test/app/ui/media/media_preview_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/media/media_preview",function(){var a='<div class="js-tweet">\n      <div class="media-preview-container">\n        <div class="js-media-preview"></div>\n      </div>\n      <div class="js-macaw-cards-iframe-container" data-src="/i/cards/tfw/v1/4"><span>fake iframe</span></div>\n    </div>\n  ';beforeEach(function(){jasmine.Clock.useMock()}),describe("clicking media preview selector",function(){describe("once",function(){beforeEach(function(){setupComponent(a),spyOn(this.component,"createCard").andCallFake(function(a,b){b()}),this.component.select("mediaPreviewSelector").click()}),it("calls createCard",function(){expect(this.component.createCard).toHaveBeenCalled()}),it("deletes the preview image",function(){expect(this.component.select("mediaPreviewContainerSelector")).not.toExist()})}),describe("more than once before the iframe has loaded",function(){beforeEach(function(){setupComponent(a),spyOn(this.component,"createCard").andCallFake(function(a,b){setTimeout(b,1)}),this.component.select("mediaPreviewSelector").click(),this.component.select("mediaPreviewSelector").click()}),it("calls createCard once",function(){expect(this.component.createCard.callCount).toBe(1)})})})})
});
define("test/app/ui/profile/inline_edit_user_color_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile/inline_edit_user_color",function(){beforeEach(function(){var a='<div id="js-userColorTest" data-color="#0000ff" name="user[profile_link_color]"></div>\n    ';setupComponent(a),$(document).trigger("uiEditProfileStart")}),describe("on uiColorPicked",function(){beforeEach(function(){spyOnEvent(this.$node,"uiOverrideUserCss")}),describe("when there is a new color",function(){beforeEach(function(){$(document).trigger("uiColorPicked",{targetSelector:"#js-userColorTest",hex:"#808080"})}),it("changes the data-color attr to the new color",function(){expect(this.$node).toHaveAttr("data-color","#808080")}),it("triggers uiOverrideUserCss to change the css",function(){expect("uiOverrideUserCss").toHaveBeenTriggeredOnAndWith(this.$node,{color:"#808080"})})}),describe("when the targetSelector does not match",function(){beforeEach(function(){$(document).trigger("uiColorPicked",{targetSelector:"#lalala",hex:"#808080"})}),it("does not change the data-color attr to the new color",function(){expect(this.$node).not.toHaveAttr("data-color","#808080")}),it("doe snot trigger uiOverrideUserCss to change the css",function(){expect("uiOverrideUserCss").not.toHaveBeenTriggeredOn(this.$node)})})}),describe("on uiEditProfileSaveFields",function(){beforeEach(function(){spyOnEvent(this.$node,"uiInlineEditSave")}),it("triggers uiInlineEditSave when there is a new color",function(){this.$node.attr("data-color","#808080"),$(document).trigger("uiEditProfileSaveFields"),expect("uiInlineEditSave").toHaveBeenTriggeredOnAndWith(this.$node,{field:"user[profile_link_color]",newValue:"#808080"})}),it("does not trigger uiInlineEditSave when there is not a new color",function(){$(document).trigger("uiEditProfileSaveFields"),expect("uiInlineEditSave").not.toHaveBeenTriggeredOnAndWith(this.$node)})}),describe("on uiEditProfileCancel",function(){beforeEach(function(){this.$node.attr("data-color","#808080"),spyOnEvent(this.$node,"uiOverrideUserCss"),$(document).trigger("uiEditProfileCancel")}),it("changes the data-color attr back to the old color",function(){expect(this.$node).toHaveAttr("data-color","#0000ff")}),it("triggers uiOverrideUserCss to change the css back",function(){expect("uiOverrideUserCss").toHaveBeenTriggeredOnAndWith(this.$node,{color:"#0000ff"})})}),describe("on uiBeforePageChanged",function(){beforeEach(function(){this.$node.attr("data-color","#808080"),spyOnEvent(this.$node,"uiOverrideUserCss"),$(document).trigger("uiBeforePageChanged")}),it("changes the data-color attr back to the old color",function(){expect(this.$node).toHaveAttr("data-color","#0000ff")}),it("triggers uiOverrideUserCss to change the css back",function(){expect("uiOverrideUserCss").toHaveBeenTriggeredOnAndWith(this.$node,{color:"#0000ff"})})}),describe("on uiEditProfileSuccess",function(){beforeEach(function(){this.$node.attr("data-color","#808080"),spyOnEvent(this.$node,"uiOverrideUserCss"),$(document).trigger("uiEditProfileSuccess")}),it("prevents the color from getting reset after uiBeforePageChanged",function(){$(document).trigger("uiBeforePageChanged"),expect("uiOverrideUserCss").not.toHaveBeenTriggeredOnAndWith(this.$node)})})})
});
define("test/app/ui/profile/empty_timeline_owner_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile/empty_timeline_owner",function(){beforeEach(function(){setupComponent("<div></div>")}),describe("event uiTweetSent",function(){it("removes the node",function(){$(document).trigger("uiTweetSent"),expect(this.$node).not.toExist()})})})
});
define("test/app/ui/profile/social_proof_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile/social_proof",function(){it("triggers uiHasProfileSocialProof event",function(){spyOnEvent(document,"uiHasProfileSocialProof"),setupComponent(),expect("uiHasProfileSocialProof").toHaveBeenTriggeredOn(document)})})
});
define("test/app/ui/profile/override_user_css_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile/override_user_css",function(){beforeEach(function(){var a='<div class="u-textUserColor"></div>\n    ';setupComponent(a)}),afterEach(function(){$("head").find("#user-style-me").remove()}),it("does not have #user-style-me",function(){expect($("head").find("#user-style-me")).not.toExist()}),describe("on uiOverrideUserCss",function(){beforeEach(function(){this.$node.trigger("uiOverrideUserCss",{color:"#ffff00"})}),it("has exactly one #user-style-me",function(){expect($("head").find("#user-style-me").length).toEqual(1)}),it("the u-textUserColor color is correct",function(){expect(this.$node.css("color")).toEqual("rgb(255, 255, 0)")}),describe("on uiOverrideUserCss with a different color",function(){beforeEach(function(){this.$node.trigger("uiOverrideUserCss",{color:"#00ffff"})}),it("has exactly one #user-style-me",function(){expect($("head").find("#user-style-me").length).toEqual(1)}),it("the u-textUserColor color is correct",function(){expect(this.$node.css("color")).toEqual("rgb(0, 255, 255)")})})})})
});
define("test/app/ui/profile/highline_profile_stats_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile/highline_profile_stats",function(){function b(a,b,c){return{user_id:a,stat:b,highline_stat_phrase:c,highline_stat_value:c}}function c(a){return{stats:[b(a,"tweet",2),b(a,"following",3),b(a,"follower",4),b(a,"media",5),b(a,"favorite",6)]}}var a='<div data-user-id="1">\n      <div class="ProfileNav-item--tweets"><a href="#" class="ProfileNav-stat--link" title="1"><span class="ProfileNav-value" data-is-compact="false">1</span></a></div>\n      <div class="ProfileNav-item--following"><a href="#" class="ProfileNav-stat--link" title="1"><span class="ProfileNav-value" data-is-compact="false">1</span></a></div>\n      <div class="ProfileNav-item--followers"><a href="#" class="ProfileNav-stat--link" title="1"><span class="ProfileNav-value" data-is-compact="false">1</span></a></div>\n      <div class="ProfileNav-item--media"><a href="#" class="ProfileNav-stat--link" title="1"><span class="ProfileNav-value" data-is-compact="false">1</span></a></div>\n      <div class="ProfileNav-item--favorites"><a href="#" class="ProfileNav-stat--link" title="1"><span class="ProfileNav-value" data-is-compact="false">1</span></a></div>\n    </div>\n  ';beforeEach(function(){setupComponent(a),this.expectStat=function(a,b){expect(this.$node.find(".ProfileNav-item--"+a+" .ProfileNav-value").html()).toBe(b)},this.expectStats=function(a,b,c,d,e){this.expectStat("tweets",a),this.expectStat("following",b),this.expectStat("followers",c),this.expectStat("media",d),this.expectStat("favorites",e)},this.expectStatTitle=function(a,b){expect(this.$node.find(".ProfileNav-item--"+a+" .ProfileNav-stat--link").attr("title")).toBe(b)},this.expectStatTitles=function(a,b,c,d,e){this.expectStatTitle("tweets",a),this.expectStatTitle("following",b),this.expectStatTitle("followers",c),this.expectStatTitle("media",d),this.expectStatTitle("favorites",e)}}),describe("on dataGotProfileStats",function(){it("updates the stats and titles for the given user_id",function(){$(document).trigger("dataGotProfileStats",c(1)),this.expectStats("2","3","4","5","6"),this.expectStatTitles("2","3","4","5","6")}),it("does not update the stats or titles for another user_id",function(){$(document).trigger("dataGotProfileStats",c(2)),this.expectStats("1","1","1","1","1"),this.expectStatTitles("1","1","1","1","1")}),it("does not update compact stats",function(){this.$node.find("[data-is-compact]").attr("data-is-compact",!0),$(document).trigger("dataGotProfileStats",c(1)),this.expectStats("1","1","1","1","1"),this.expectStatTitles("2","3","4","5","6")})})})
});
define("test/app/ui/profile/sidebar_tweetbox_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile/sidebar_tweetbox",function(){var a='<div class="profile-tweet-box" data-condensed-text="Tweet to Chatty Guy" data-screen-name="chatty">\n    <form class="tweet-form" method="post" target="tweet-post-iframe" action="/i/tweet/create_with_media.iframe" enctype="multipart/form-data">\n      <div class="tweet-box rich-editor u-textUserColor u-borderUserColorLight u-borderUserColorFocusLight u-boxShadowUserColorFocusLighter"></div>\n      <button class="btn primary-btn tweet-action disabled" type="button"></button>\n    </form>\n  </div>\n\n  ';beforeEach(function(){setupComponent(a)}),describe("#getUserScreenName",function(){it('gets the string in "data-screen-name" attribute',function(){expect(this.component.getUserScreenName()).toMatch("chatty")})}),describe("#getDefaultText",function(){it("gets the screen name with @ prepended",function(){expect(this.component.getDefaultText()).toMatch("@chatty")})}),describe("#getCondensedText",function(){it('gets the condensed text in "data-condensed-text" attribute',function(){expect(this.component.getCondensedText()).toMatch("Tweet to Chatty Guy")})}),describe("#removeTextUserColor",function(){it('removes CSS "u-textUserColor" from tweet-box',function(){var a=this.$node.find(".tweet-box");expect(a).toHaveClass("u-textUserColor"),this.component.removeTextUserColor(),expect(a).not.toHaveClass("u-textUserColor")})}),describe("#addTextUserColor",function(){it('adds CSS "u-textUserColor" to tweet-box',function(){var a=this.$node.find(".tweet-box");this.component.removeTextUserColor(),this.component.addTextUserColor(),expect(a).toHaveClass("u-textUserColor")})}),describe("#enableTweetAction",function(){it('removes CSS "u-bgUserColor u-bgUserColorHover u-borderUserColor" from tweet-action',function(){var a=this.$node.find(".tweet-action");expect(a).not.toHaveClass("u-bgUserColor"),expect(a).not.toHaveClass("u-bgUserColorHover"),expect(a).not.toHaveClass("u-borderUserColor"),this.component.enableTweetAction(),expect(a).toHaveClass("u-bgUserColor"),expect(a).toHaveClass("u-bgUserColorHover"),expect(a).toHaveClass("u-borderUserColor")})}),describe("#disableTweetAction",function(){it('removes CSS "u-bgUserColor u-bgUserColorHover u-borderUserColor" from tweet-action',function(){var a=this.$node.find(".tweet-action");this.component.enableTweetAction(),this.component.disableTweetAction(),expect(a).not.toHaveClass("u-bgUserColor"),expect(a).not.toHaveClass("u-bgUserColorHover"),expect(a).not.toHaveClass("u-borderUserColor")})}),describe("after initialize",function(){it("triggers a uiInitTweetBox event at attach time",function(){spyOnEvent(document,"uiInitTweetbox"),setupComponent(a),expect("uiInitTweetbox").toHaveBeenTriggeredOnAndWith(document,{condensable:!0,condensedText:"Tweet to Chatty Guy",defaultText:"@chatty "})}),it("handles uiTweetBoxExpanded event",function(){spyOnEvent(document,"uiTweetBoxExpanded"),setupComponent(a),this.$node.trigger("uiTweetBoxExpanded"),expect(this.component.$node).toHandleWith("uiTweetBoxExpanded",this.component.removeTextUserColor)}),it("handles uiTweetBoxCondensed event",function(){spyOnEvent(document,"uiTweetBoxCondensed"),setupComponent(a),this.$node.trigger("uiTweetBoxCondensed"),expect(this.component.$node).toHandleWith("uiTweetBoxCondensed",this.component.addTextUserColor)}),it("handles uiDisableTweetAction event",function(){spyOnEvent(document,"uiDisableTweetAction"),setupComponent(a),this.$node.trigger("uiDisableTweetAction"),expect(this.component.$node).toHandleWith("uiDisableTweetAction",this.component.disableTweetAction)}),it("handles uiEnableTweetAction event",function(){spyOnEvent(document,"uiEnableTweetAction"),setupComponent(a),this.$node.trigger("uiEnableTweetAction"),expect(this.component.$node).toHandleWith("uiEnableTweetAction",this.component.enableTweetAction)})})})
});
define("test/app/ui/profile/highline_canopy_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile/highline_canopy",function(){var a='<div class="ProfileCanopy">\n    <div class="ProfileCanopy-inner">\n      <div class="ProfileCanopy-header u-bgUserColor" style=\n      "background-image: url(http://pbs.twimg.com/profile_banners/631823/1363323330/web_retina)">\n      <div class="AppContainer">\n          <div class="ProfileCanopy-avatar">\n            <a class=\n            "ProfileHeader-avatarLink u-inlineBlock profile-picture media-thumbnail"\n            data-resolved-url-large=\n            "http://a0.twimg.com/profile_images/378800000014386973/f2fb401cd715a4d36fef103efe02ec06.jpeg"\n            data-url=\n            "http://a0.twimg.com/profile_images/378800000014386973/f2fb401cd715a4d36fef103efe02ec06.jpeg"\n            href=\n            "http://a0.twimg.com/profile_images/378800000014386973/f2fb401cd715a4d36fef103efe02ec06.jpeg"\n            target="_blank"><img alt="" class=\n            "ProfileHeader-avatarImage avatar" src=\n            "http://a0.twimg.com/profile_images/378800000014386973/f2fb401cd715a4d36fef103efe02ec06.jpeg"></a>\n          </div>\n\n          <div class="ProfileCanopy-joinDate">\n            <p title="2:43 PM - 13 Jan 07">Joined January 2007</p>\n          </div>\n        </div>\n      </div>\n\n      <div class="AppContainer">\n        <div class="ProfileCanopy-card">\n          <div class="ProfileCardMini">\n            <div class="ProfileCardMini-avatar"><img alt="Bill Couch"\n            class="ProfileCardMini-avatarImage" src=\n            "http://a0.twimg.com/profile_images/378800000014386973/f2fb401cd715a4d36fef103efe02ec06_normal.jpeg"></div>\n\n            <h1 class="ProfileCardMini-name"><a class=\n            "js-nav u-textInheritAllColor" href="/couch">Bill\n            Couch</a></h1>\n\n            <p class="ProfileCardMini-screenname"><a class=\n            "u-textUserColor js-nav" href="/couch">@couch</a></p>\n          </div>\n        </div>\n\n        <div class="ProfileCanopy-nav">\n          <div class="ProfileNav" data-user-id="631823">\n            <div class="ProfilePage-editingOverlay"></div>\n\n            <ul class="ProfileNav-list">\n              <li class="ProfileNav-item ProfileNav-item--tweets">\n                <a class=\n                "ProfileNav-stat ProfileNav-stat--link u-textUserColor u-borderUserColorHover js-nav"\n                href="/couch/tweets" title="18,940 Tweets"><span class=\n                "ProfileNav-label">Tweets</span> <span class="ProfileNav-value"\n                data-is-compact="true">18.9K</span></a>\n              </li>\n\n              <li class="ProfileNav-item ProfileNav-item--following">\n                <a class=\n                "ProfileNav-stat ProfileNav-stat--link u-textUserColor u-borderUserColorHover js-nav"\n                href="/following" title="502 Following"><span class=\n                "ProfileNav-label">Following</span> <span class=\n                "ProfileNav-value" data-is-compact="false">502</span></a>\n              </li>\n\n              <li class="ProfileNav-item ProfileNav-item--followers">\n                <a class=\n                "ProfileNav-stat ProfileNav-stat--link u-textUserColor u-borderUserColorHover js-nav"\n                href="/followers" title="4,211 Followers"><span class=\n                "ProfileNav-label">Followers</span> <span class=\n                "ProfileNav-value" data-is-compact="false">4,211</span></a>\n              </li>\n\n              <li class="ProfileNav-item ProfileNav-item--media">\n                <a class=\n                "ProfileNav-stat ProfileNav-stat--link u-textUserColor u-borderUserColorHover js-nav"\n                href="/couch/media" title="475 Photos/Videos"><span class=\n                "ProfileNav-label">Photos/Videos</span> <span class=\n                "ProfileNav-value" data-is-compact="false">475</span></a>\n              </li>\n\n              <li class="ProfileNav-item ProfileNav-item--favorites">\n                <a class=\n                "ProfileNav-stat ProfileNav-stat--link u-textUserColor u-borderUserColorHover js-nav"\n                href="/favorites" title="16,149 Favorites"><span class=\n                "ProfileNav-label">Favorites</span> <span class=\n                "ProfileNav-value" data-is-compact="true">16.1K</span></a>\n              </li>\n\n              <li class="ProfileNav-item ProfileNav-item--more">\n                <div class="ProfileNavDropdown">\n                  <a class=\n                  "ProfileNav-stat ProfileNav-stat--link ProfileNav-stat--moreLink u-textUserColor u-borderUserColorHover js-dropdown-toggle"\n                  href="#more-profile-options"><span class=\n                  "ProfileNav-label">View<span class=\n                  "ProfileNav-dropdownCaret Icon Icon--caret"></span></span>\n                  <span class="ProfileNav-value">More</span></a>\n\n                  <ul class="ProfileNavDropdown-menu" id=\n                  "more-profile-options">\n                    <li class=\n                    "ProfileNavDropdown-item ProfileNavDropdown-item--lists u-bgUserColorHover">\n                    <a class="u-textUserColor u-linkClean js-nav" href=\n                    "/couch/lists">Lists</a>\n                    </li>\n                  </ul>\n                </div>\n              </li>\n\n              <li class=\n              "ProfileNav-item ProfileNav-item--userActions u-pullRight u-textRight with-rightCaret">\n                <div class="UserActions u-textLeft">\n                  <a class="UserActions-editButton btn js-nav"\n                  data-scribe-element="profile_edit_button" href=\n                  "/settings/profile">Edit profile</a>\n\n                  <div class="ProfilePage-editingButtons">\n                    <button class="ProfilePage-saveButton btn primary-btn">Save\n                    changes</button> <span class=\n                    "ProfilePage-savingIndicator" disabled>Saving...</span>\n                    <button class="ProfilePage-cancelButton btn"\n                    data-scribe-element="cancel_button">Cancel</button>\n                  </div>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  ';beforeEach(function(){setupComponent(a)}),xdescribe("reflowCanopy event",function(){var a=360,b=a,c=500,d=620,e=50;xdescribe("scrolling down the page",function(){it("locks the profile canopy when page is past the profile header threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:a+e}),expect(this.$node).toHaveClass(this.component.attr.lockedStateClass)}),it("transitions the full profile card when page is past the profile card threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:b+e}),expect(this.component.select("profileCardFullSelector")).not.toHaveClass(this.component.attr.defaultStateClass),expect(this.component.select("profileCardFullSelector")).not.toHaveClass(this.component.attr.lockedStateClass)}),it("locks the profile card mini window when page is past the profile card mini window threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:c+e}),expect(this.component.select("profileCardMiniWindowSelector")).toHaveClass(this.component.attr.lockedStateClass)}),xit("transitions the profile card mini when page is past profile card mini window threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:c+e}),expect(this.component.select("profileCardMiniSelector")).not.toHaveClass(this.component.attr.defaultStateClass),expect(this.component.select("profileCardMiniSelector")).not.toHaveClass(this.component.attr.lockedStateClass)}),it("triggers uiProfileCardMiniIsLocked event when page is past the profile card mini window threshold",function(){spyOnEvent(this.$node,"uiProfileCardMiniIsLocked"),this.$node.trigger("reflowCanopy",{scrollPos:c+e}),expect("uiProfileCardMiniIsLocked").toHaveBeenTriggeredOn(this.$node)}),it("locks the profile card mini when page is past the profile card mini threshold",function(){spyOn(this.component,"pastMiniProfileCardThreshold").andReturn(!0),this.$node.trigger("reflowCanopy",{scrollPos:d+e}),expect(this.component.select("profileCardMiniSelector")).not.toHaveClass(this.component.attr.defaultStateClass),expect(this.component.select("profileCardMiniSelector")).toHaveClass(this.component.attr.lockedStateClass)}),it("hides the profile card when page is past the profile card mini threshold",function(){spyOn(this.component,"pastMiniProfileCardThreshold").andReturn(!0),this.$node.trigger("reflowCanopy",{scrollPos:d+e}),expect(this.component.select("profileCardFullSelector")).not.toBeVisible()})}),xdescribe("scrolling up the page",function(){beforeEach(function(){this.$node.trigger("reflowCanopy",{scrollPos:d+e})}),it("unlocks the profile card mini when page is not past the profile card mini threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:d-e}),expect(this.component.select("profileCardMiniSelector")).not.toHaveClass(this.component.attr.lockedStateClass)}),it("shows the profile card when page is not past the profile card mini threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:d-e}),expect(this.component.select("profileCardFullSelector")).toBeVisible()}),it("unlocks the profile card mini window when page is not past the profile card mini window threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:c-e}),expect(this.component.select("profileCardMiniWindowSelector")).not.toHaveClass(this.component.attr.lockedStateClass)}),it("triggers uiProfileCardMiniIsUnlocked event when page is not past the profile card mini window threshold",function(){spyOnEvent(this.$node,"uiProfileCardMiniIsUnlocked"),this.$node.trigger("reflowCanopy",{scrollPos:c-e}),expect("uiProfileCardMiniIsUnlocked").toHaveBeenTriggeredOn(this.$node)}),it("unlocks the profile canopy when page is not past the profile header threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:a-e}),expect(this.$node).not.toHaveClass(this.component.attr.lockedStateClass)})}),xdescribe("after uiDisableCanopyScroll event",function(){beforeEach(function(){this.$node.trigger("uiDisableCanopyScroll")}),it("does not lock the profile canopy when page is past the profile header threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:a+e}),expect(this.$node).not.toHaveClass(this.component.attr.lockedStateClass)}),xdescribe("after uiEnableCanopyScroll event",function(){beforeEach(function(){this.$node.trigger("uiEnableCanopyScroll")}),it("locks the profile canopy when page is past the profile header threshold",function(){this.$node.trigger("reflowCanopy",{scrollPos:a+e}),expect(this.$node).toHaveClass(this.component.attr.lockedStateClass)})})})}),xdescribe("clicking the profile header",function(){it("transitions the page back to the top",function(){jasmine.Clock.useMock(),this.component.select("profileHeaderSelector").click(),jasmine.Clock.tick(1e3),expect($(window).scrollTop()).toBe(0)})})})
});
define("test/app/ui/profile/head_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile/head",function(){beforeEach(function(){var a='<div class="module profile-card component profile-header" data-component-term="profile_follow_card">\n      <div class="profile-header-inner flex-module clearfix ">\n          <div class="profile-header-inner-overlay"></div>\n          <a href="javascript:;" class="profile-picture">\n              <img src="https://twimg0-a.akamaihd.net/profile_images/2193426230/pic_bigger.jpg" alt="David Chen" class="avatar size73">\n          </a>\n          <div class="profile-card-inner" data-screen-name="chenosaurus" data-user-id="15349546">\n          <h1 class="fullname">\n            David Chen\n          </h1>\n          <h2 class="username">\n            <span class="screen-name"><s>@</s>chenosaurus</span>\n          </h2>\n          <p class="bio ">Skateboarding gambling skeeballer, moonlights as a frontend engineer @ Twitter.  <a href="http://chat.io" rel="nofollow">http://chat.io</a> <a href="http://gifsnap.com" rel="nofollow">http://gifsnap.com</a></p>\n          <p class="location-and-url">\n            <span class="location">\n              San Francisco, CA\n            </span>\n            <span class="divider">·</span>\n            <span class="url">\n              <a target="_blank" rel="me nofollow" href="http://twitter.com/chenosaurus">\n                http://twitter.com/chenosaurus\n              </a>\n            </span>\n          </p>\n        </div>\n      </div>\n        <div class="flex-module profile-banner-footer clearfix">\n          <ul class="stats js-mini-profile-stats" data-user-id="15349546">\n          </ul>\n          <a class="btn edit-profile-btn js-nav inline-edit-profile-btn" href="/settings/profile" data-scribe-element="profile_edit_button">Edit profile</a>\n          <button class="btn dm-button" type="button" title="Direct messages">\n            <i class="dm-envelope"></i>\n          </button>\n        </div>\n    </div>\n    ';this.html=a,setupComponent(this.html)}),describe("clicks edit profile button",function(){it("calls uiEditProfileInitialize",function(){spyOnEvent(document,"uiEditProfileInitialize"),setupComponent(this.html);var a={type:"click",preventDefault:function(){}},b=spyOn(a,"preventDefault");this.$node.find(".inline-edit-profile-btn").trigger(a),expect(b).toHaveBeenCalled(),expect("uiEditProfileInitialize").toHaveBeenTriggeredOn(document)})}),describe("clicks url",function(){it("calls uiUrlClicked",function(){setupComponent(this.html),spyOnEvent(this.$node,"uiUrlClicked"),this.component.select("urlSelector").click(),expect("uiUrlClicked").toHaveBeenTriggeredOn(this.$node)})}),describe("on an empty avatar",function(){describe("while not in edit mode",function(){it("should trigger uiShowEditAvatarOptions",function(){spyOn(this.Component.prototype,"isEditing").andReturn(!1);var a=this.component.select("nonEmptyAvatarSelector");a.addClass("empty-avatar"),spyOnEvent(this.$node,"uiEditProfileInitialize"),spyOnEvent(this.$node,"uiShowEditAvatarOptions");var b={type:"click",preventDefault:function(){},stopImmediatePropagation:function(){}},c=spyOn(b,"preventDefault"),d=spyOn(b,"stopImmediatePropagation");this.component.on("uiEditProfileInitialize",function(){this.component.trigger("uiEditProfileStart")}.bind(this)),a.trigger(b),expect("uiEditProfileInitialize").toHaveBeenTriggeredOn(this.$node),expect(c).toHaveBeenCalled(),expect(d).toHaveBeenCalled(),expect("uiShowEditAvatarOptions").toHaveBeenTriggeredOn(this.$node)})}),describe("while in edit mode",function(){it("should not trigger uiEditProfileInitialize",function(){spyOn(this.Component.prototype,"isEditing").andReturn(!0);var a=this.component.select("nonEmptyAvatarSelector");a.addClass("empty-avatar"),spyOnEvent(this.$node,"uiEditProfileInitialize"),a.trigger("click"),expect("uiEditProfileInitialize").not.toHaveBeenTriggeredOn(this.$node)})})}),describe("clicks on avatar",function(){describe("showAvatarModal",function(){beforeEach(function(){spyOn(this.Component.prototype,"showAvatarModal"),setupComponent(this.html)}),it("is called",function(){this.$node.find(".avatar").click(),expect(this.component.showAvatarModal).toHaveBeenCalled()}),it("is not called when the empty-avatar class exists",function(){this.$node.find(".avatar").addClass("empty-avatar").click(),expect(this.component.showAvatarModal).not.toHaveBeenCalled()})}),it("triggers uiOpenGallery event",function(){setupComponent(this.html,{profile_user:{screen_name:"chenosaurus"}}),spyOnEvent(this.$node.find(".avatar"),"uiOpenGallery"),this.$node.find(".avatar").click(),expect("uiOpenGallery").toHaveBeenTriggeredOnAndWith(this.$node.find(".avatar"),{profileHead:!0,title:"@chenosaurus's profile photo"})}),describe("uiAvatarClicked",function(){beforeEach(function(){setupComponent(this.html,{profile_user:{screen_name:"chenosaurus"}}),spyOnEvent(this.$node,"uiAvatarClicked")}),it("triggers when not in edit mode",function(){this.$node.find(".avatar").click(),expect("uiAvatarClicked").toHaveBeenTriggeredOn(this.$node)}),it("doesn't trigger when in edit mode",function(){spyOn(this.Component.prototype,"isEditing").andReturn(!0),this.$node.find(".avatar").click(),expect("uiAvatarClicked").not.toHaveBeenTriggeredOn(this.$node)})})})})
});
define("test/app/ui/profile/canopy_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/profile/canopy",function(){var a='<div class="profile-canopy">\n      <div class="bg-img"></div>\n      <div class="gradient"></div>\n      <div class="canopy-content">\n        <div class="user-details">\n          <a href="http://a0.twimg.com/profile_images/3381447326/ff51c26c07c7c1334a282d8748f258aa.jpeg" class="profile-picture media-thumbnail" data-resolved-url-large="http://a0.twimg.com/profile_images/3381447326/ff51c26c07c7c1334a282d8748f258aa.jpeg" data-url="http://a0.twimg.com/profile_images/3381447326/ff51c26c07c7c1334a282d8748f258aa.jpeg" target="_blank">\n            <img src="http://a0.twimg.com/profile_images/3381447326/ff51c26c07c7c1334a282d8748f258aa_bigger.jpeg" alt="Bill Couch" class="avatar size32">\n          </a>\n          <div class="user-text">\n            <h2 class="full-name">Bill Couch</h2>\n            <span class="screenname">@couch</span>\n          </div>\n        </div>\n        <div class="profile-user-actions">\n\n      <a class="btn edit-profile-btn js-nav inline-edit-profile-btn" href="/settings/profile" data-scribe-element="profile_edit_button">Edit profile</a>\n        <button class="btn dm-button" type="button" title="Direct messages">\n          <i class="dm-envelope"><span class="dm-new"></span></i>\n        </button>\n\n        </div>\n      </div>\n    </div>\n  ';beforeEach(function(){setupComponent(a)}),describe("event uiShowProfileCanopy",function(){it("shows the profile canopy",function(){this.$node.addClass("retracted"),this.component.trigger("uiShowProfileCanopy"),expect(this.$node).not.toHaveClass("retracted")})}),describe("event uiCloseProfilePopup",function(){it("shows the profile canopy when below the threshold",function(){this.$node.addClass("retracted"),spyOn(this.component,"belowVerticalThreshhold").andReturn(!0),this.component.trigger("uiCloseProfilePopup"),expect(this.$node).not.toHaveClass("retracted")}),it("does not change the state of the profile canopy when above the threshold",function(){this.$node.addClass("retracted"),spyOn(this.component,"belowVerticalThreshhold").andReturn(!1),this.component.trigger("uiCloseProfilePopup"),expect(this.$node).toHaveClass("retracted")})}),describe("event uiHideProfileCanopy",function(){it("hides the profile canopy",function(){this.$node.removeClass("retracted"),this.component.trigger("uiHideProfileCanopy"),expect(this.$node).toHaveClass("retracted")})}),describe("event uiShowProfilePopup",function(){it("hides the profile canopy when below the threshold",function(){this.$node.removeClass("retracted"),spyOn(this.component,"belowVerticalThreshhold").andReturn(!0),this.component.trigger("uiShowProfilePopup"),expect(this.$node).toHaveClass("retracted")}),it("does not change the state of the profile canopy when above the threshold",function(){this.$node.addClass("retracted"),spyOn(this.component,"belowVerticalThreshhold").andReturn(!1),this.component.trigger("uiShowProfilePopup"),expect(this.$node).toHaveClass("retracted")})})})
});
define("test/app/ui/gallery/with_gallery_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/gallery/with_gallery",function(){beforeEach(function(){var a='<div class="permalink-tweet">\n        <div class="media-thumbnail">\n        </div>\n      </div>\n    ';setupComponent(a)}),it("triggers the gallery",function(){spyOnEvent(this.component.$node.find(".media-thumbnail"),"uiOpenGallery"),this.component.$node.find(".media-thumbnail").click(),expect("uiOpenGallery").toHaveBeenTriggeredOn(this.component.$node.find(".media-thumbnail"))})})
});
define("test/app/ui/gallery/gallery_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/gallery/gallery",function(){var a=["data:image/jpeg;base64,","/9j/4AAQSkZJRgABAQEASABIAAD/2wCDEAAcABwAHAAeAB4AHgAmACYAJgAm","ADIAMgAyADIAMgBEAEQARABEAEQARABaAFoAWgBaAFoAWgBaAHYAdgB2AHYA","dgB2AHYAdgDpAOkA6QDpAOkA6QDpAc8BzwHPAc8BzwHPA5sDmwObA5sDmwcz","BzMHMwczDmMOYw5jHMMcwzmD/8EACwgAEAAMAQERAP/EABYAAQEBAAAAAAAA","AAAAAAAAAAYBBP/EACAQAAIBBAEFAAAAAAAAAAAAAAEDAgAEESIFEiExUYH/","2gAIAQEAAD8A1chya0CaobMIwfQqWCnuQGSYdiSO8vH2jjEXJZIyVPqJydTT","O0yLZQMDEiIGK//Z"].join(""),b=['<ul class="photo-list">','<a href="" target="_blank" data-status-id="111" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"></a>','<a href="" target="_blank" data-status-id="112" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"></a>','<a href="" target="_blank" data-status-id="113" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"></a>','<a href="" target="_blank" data-status-id="114" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"></a>','<a href="" target="_blank" data-status-id="115" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"></a>','<a href="" target="_blank" data-status-id="116" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"></a>','<a href="" target="_blank" data-status-id="117" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"></a>','<a href="" target="_blank" data-status-id="118" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"></a>',"</ul>"].join(""),c={sandboxes:{detailsPane:"http://localhost:3000/details_pane_content_sandbox.html",jsonp:"http://localhost:3000/jsonp_sandbox.html"}};beforeEach(function(){this.thumbs=$(b),this.html=$('<div class="gallery-container" style="display:none">      <div class="gallery-close-target"></div>      <div class="swift-media-gallery">        <div class="modal-header">          <a class="dismiss close-action" href="#"><i class="close-large"></i></a>          <a class="gridview grid-action" href="#"><i class="grid"></i></a>          <h2 class="modal-title">gallery</h2>        </div>        <div class="gallery-media"></div>        <div class="gallery-nav nav-prev">          <span class="nav-prev-handle"></span>        </div>        <div class="gallery-nav nav-next">          <span class="nav-next-handle"></span>        </div>        <div class="gallery-tweet">        </div>      </div>    </div>'),this.mockResponse={id:1,tweet_html:'<div class="tweet">tweet</div>'},ajaxRespondWithSuccess(this.mockResponse),setupComponent(this.html,c)}),it("opens the gallery",function(){var a=spyOn(this.Component.prototype,"open");setupComponent(this.html,c),$(document).trigger("uiOpenGallery",{title:"Gallery Title"}),expect(a).toHaveBeenCalled()}),it("opens the gallery and sets title",function(){setupComponent(this.html,c),$(document).trigger("uiOpenGallery",{title:"Gallery Title"}),expect(this.component.select("galleryTitleSelector").text()).toEqual("Gallery Title")}),it("opens the gallery and shows the grid icon",function(){setupComponent(this.html,c),$(document).trigger("uiOpenGallery",{title:"Gallery Title",showGrid:!0,profileUser:{screen_name:"name"}}),expect(this.component.select("galleryTitleSelector").text()).toEqual("Gallery Title"),expect(this.component.select("gridSelector")).toHaveClass("js-nav"),expect(this.component.select("gridSelector")).toHaveAttr("href","/name/media"),expect(this.component.select("gallerySelector")).not.toHaveClass("no-grid")}),it("closes the gallery on uiCloseGallery",function(){var a=spyOn(this.Component.prototype,"closeGallery");setupComponent(this.html,c),$(document).trigger("uiCloseGallery"),expect(a).toHaveBeenCalled()}),it("closes the gallery on uiShortcutEsc",function(){var a=spyOn(this.Component.prototype,"handleClose");setupComponent(this.html,c),$(document).trigger("uiShortcutEsc"),expect(a).toHaveBeenCalled()}),it("returns to the grid on uiShortcutEsc if fromGrid is true",function(){var a=spyOn(this.Component.prototype,"returnToGrid");setupComponent(this.html,c),this.component.$node.show(),this.component.fromGrid=!0,$(document).trigger("uiShortcutEsc"),expect(a).toHaveBeenCalled()}),it("closes the gallery on clicking the close action",function(){var a=spyOn(this.Component.prototype,"handleClose");setupComponent(this.html,c),this.component.select("closeSelector").click(),expect(a).toHaveBeenCalled()}),it("triggers navigation next on uiShortcutRight",function(){var a=spyOn(this.Component.prototype,"next");setupComponent(this.html,c),$(document).trigger("uiShortcutRight"),expect(a).toHaveBeenCalled()}),it("triggers navigation prev on uiShortcutLeft",function(){var a=spyOn(this.Component.prototype,"prev");setupComponent(this.html,c),$(document).trigger("uiShortcutLeft"),expect(a).toHaveBeenCalled()}),it("triggers navigation prev only once every 500 ms",function(){jasmine.Clock.useMock();var a=spyOn(this.Component.prototype,"prev");setupComponent(this.html,c),$(document).trigger("uiShortcutLeft"),$(document).trigger("uiShortcutLeft"),expect(a).toHaveBeenCalled(),expect(a.callCount).toEqual(1),jasmine.Clock.tick(201),$(document).trigger("uiShortcutLeft"),expect(a.callCount).toEqual(2),jasmine.Clock.tick(100),$(document).trigger("uiShortcutLeft"),expect(a.callCount).toEqual(2),jasmine.Clock.tick(100),$(document).trigger("uiShortcutLeft"),$(document).trigger("uiShortcutLeft"),expect(a.callCount).toEqual(3)}),it("triggers navigation next only once every 500 ms",function(){jasmine.Clock.useMock();var a=spyOn(this.Component.prototype,"next");setupComponent(this.html,c),$(document).trigger("uiShortcutRight"),$(document).trigger("uiShortcutRight"),expect(a).toHaveBeenCalled(),expect(a.callCount).toEqual(1),jasmine.Clock.tick(201),$(document).trigger("uiShortcutRight"),expect(a.callCount).toEqual(2),jasmine.Clock.tick(100),$(document).trigger("uiShortcutRight"),expect(a.callCount).toEqual(2),jasmine.Clock.tick(100),$(document).trigger("uiShortcutRight"),$(document).trigger("uiShortcutRight"),expect(a.callCount).toEqual(3)}),it("triggers navigation next on clicking the next action",function(){var a=spyOn(this.Component.prototype,"next");setupComponent(this.html,c),this.component.select("nextSelector").click(),expect(a).toHaveBeenCalled()}),it("triggers navigation prev on clicking the prev action",function(){var a=spyOn(this.Component.prototype,"prev");setupComponent(this.html,c),this.component.select("prevSelector").click(),expect(a).toHaveBeenCalled()}),it("opens the media passed into open() and sets up page for gallery",function(){setupComponent(this.html,c);var a=this.thumbs.find("a[data-status-id=111]"),b={target:a,preventDefault:function(){}};this.component.open(b),expect($("body").hasClass("gallery-enabled")).toEqual(!0),expect(this.component.select("gallerySelector").hasClass("show-controls")).toEqual(!0)}),it("renders the media element passed in",function(){setupComponent(this.html,c);var a=this.thumbs.find("a[data-status-id=111]"),b={target:a,preventDefault:function(){}};this.component.open(b),waitsFor(function(){return a.attr("loaded")},"loading to complete",1e3),runs(function(){expect(a.attr("loaded")).toEqual("true")})}),it("fixes snappy video urls",function(){setupComponent(this.html,c);var a=$("<div>").attr("data-source-url","https://www.snappytv.com/tc/1?autoplay=true&h=100&w=200").attr("data-height",100).attr("data-width",200);this.component.fixSnappyUrl(a),expect(a.attr("data-source-url")).toEqual("https://www.snappytv.com/tc/1?autoplay=true&h=200&w=400")}),it("should preload 2 media elements around the selected element",function(){setupComponent(this.html,c);var a=this.thumbs.find("a[data-status-id=115]"),b={target:a,preventDefault:function(){}};this.component.open(b);var d=this.thumbs.find("a[data-status-id=113]");waitsFor(function(){return d.attr("data-preloaded")},"loading to complete",1e3),runs(function(){expect(this.thumbs.find("a[data-status-id=113]").attr("data-preloaded")).toEqual("true"),expect(this.thumbs.find("a[data-status-id=114]").attr("data-preloaded")).toEqual("true"),expect(this.thumbs.find("a[data-status-id=116]").attr("data-preloaded")).toEqual("true"),expect(this.thumbs.find("a[data-status-id=117]").attr("data-preloaded")).toEqual("true")})}),it("should preload 2 tweets around the selected media",function(){var a=spyOn(this.Component.prototype,"getTweet");setupComponent(this.html,c);var b=this.thumbs.find("a[data-status-id=115]"),d={target:b,preventDefault:function(){}};this.component.open(d);var e=this.thumbs.find("a[data-status-id=117]");waitsFor(function(){return e.attr("data-preloaded")},"loading to complete",1e3),runs(function(){expect(a).toHaveBeenCalledWith("115"),expect(a).toHaveBeenCalledWith("116"),expect(a).toHaveBeenCalledWith("114"),expect(a).toHaveBeenCalledWith("113"),expect(a).toHaveBeenCalledWith("117")})}),it("should only have next selector enabled when on first media",function(){setupComponent(this.html,c);var a=this.thumbs.find("a[data-status-id=111]"),b={target:a,preventDefault:function(){}};this.component.open(b),expect(this.component.select("prevSelector")).not.toHaveClass("enabled"),expect(this.component.select("nextSelector")).toHaveClass("enabled")}),it("should only have prev selector enabled when on last media",function(){setupComponent(this.html,c);var a=this.thumbs.find("a[data-status-id=118]"),b={target:a,preventDefault:function(){}};this.component.open(b),expect(this.component.select("prevSelector")).toHaveClass("enabled"),expect(this.component.select("nextSelector")).not.toHaveClass("enabled")}),it("should enable all navigation when in the middle",function(){setupComponent(this.html,c);var a=this.thumbs.find("a[data-status-id=111]"),b={target:a,preventDefault:function(){}};this.component.open(b),this.component.next(),expect(this.component.select("prevSelector")).toHaveClass("enabled"),expect(this.component.select("nextSelector")).toHaveClass("enabled")}),it("should call renderNav when dataGotMoreMediaTimelineItems is fired",function(){var a=spyOn(this.Component.prototype,"renderNav");setupComponent(this.html,c),this.component.trigger(document,"dataGotMoreMediaTimelineItems",{}),expect(a).toHaveBeenCalled()})})
});
define("test/app/ui/gallery/with_grid_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/gallery/with_grid",function(){var a=["data:image/jpeg;base64,","/9j/4AAQSkZJRgABAQEASABIAAD/2wCDEAAcABwAHAAeAB4AHgAmACYAJgAm","ADIAMgAyADIAMgBEAEQARABEAEQARABaAFoAWgBaAFoAWgBaAHYAdgB2AHYA","dgB2AHYAdgDpAOkA6QDpAOkA6QDpAc8BzwHPAc8BzwHPA5sDmwObA5sDmwcz","BzMHMwczDmMOYw5jHMMcwzmD/8EACwgAEAAMAQERAP/EABYAAQEBAAAAAAAA","AAAAAAAAAAYBBP/EACAQAAIBBAEFAAAAAAAAAAAAAAEDAgAEESIFEiExUYH/","2gAIAQEAAD8A1chya0CaobMIwfQqWCnuQGSYdiSO8vH2jjEXJZIyVPqJydTT","O0yLZQMDEiIGK//Z"].join(""),b=['<ul class="photo-list">','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="111" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="112" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="113" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="114" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="115" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="1600" data-status-id="116" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="117" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="5000" data-status-id="118" data-href="" data-url="asdf" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>',"</ul>"].join(""),c=['<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="111" data-href="" data-url="asdf2" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="112" data-href="" data-url="asdf2" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="113" data-href="" data-url="asdf2" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="114" data-href="" data-url="asdf2" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="115" data-href="" data-url="asdf2" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="1600" data-status-id="116" data-href="" data-url="asdf2" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="800" data-status-id="117" data-href="" data-url="asdf2" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>','<a href="" target="_blank" data-height="1000" data-width="5000" data-status-id="118" data-href="" data-url="asdf2" class="media-thumbnail" data-resolved-url-large="'+a+'"><div class="media-overlay"></div></a>'].join(""),d=["<div>",'<ol class="stream-items js-navigable-stream" id="stream-items-id">','<li class="stream-media-items stream-item separation-module">','<div class="stream-media-grid-items media-item">',b,'<div class="stream-media-items-footer"></div>',"</div>","</li>","</ol>","</div>"].join(""),e={sandboxes:{detailsPane:"http://localhost:3000/details_pane_content_sandbox.html",jsonp:"http://localhost:3000/jsonp_sandbox.html"}},f=512,g=8;beforeEach(function(){this.$grid1=$(b),this.$grid2=$(c)}),it("triggers the gallery when clicking media",function(){setupComponent(this.$grid1),spyOnEvent(this.component.$node.find(".media-overlay"),"uiOpenGallery"),this.component.$node.find(".media-overlay").click(),expect("uiOpenGallery").toHaveBeenTriggeredOn(this.component.$node.find(".media-overlay"))}),it("triggers renderAll when uiHasInjectedOldTimelineItems is triggered",function(){var a=spyOn(this.Component.prototype,"renderAll");setupComponent(this.$grid1),this.component.trigger("uiHasInjectedOldTimelineItems"),expect(a).toHaveBeenCalled()}),it("triggers uiMediaGalleryResults when grid render is complete",function(){spyOnEvent(this.$grid1,"uiMediaGalleryResults"),setupComponent(this.$grid1,{scribeRows:!0}),expect("uiMediaGalleryResults").toHaveBeenTriggeredOnAndWith(this.component.$node,{thumbnails:["asdf","asdf","asdf","asdf","asdf","asdf","asdf"],scribeContext:{component:"media_gallery"}})}),it("triggers additional uiMediaGalleryResults when new results are rendered",function(){spyOnEvent(this.$grid1,"uiMediaGalleryResults"),setupComponent(this.$grid1,{scribeRows:!0}),expect("uiMediaGalleryResults").toHaveBeenTriggeredOnAndWith(this.component.$node,{thumbnails:["asdf","asdf","asdf","asdf","asdf","asdf","asdf"],scribeContext:{component:"media_gallery"}}),this.component.$node.append(this.$grid2),this.component.render(),expect("uiMediaGalleryResults").toHaveBeenTriggeredOnAndWith(this.component.$node,{thumbnails:["asdf","asdf2","asdf2","asdf2","asdf2","asdf2","asdf2","asdf2","asdf2"],scribeContext:{component:"media_gallery"}})}),it("only triggers render once when multiple uiHasInjectedOldTimelineItems events are triggered",function(){var a=spyOn(this.Component.prototype,"render");setupComponent(this.$grid1.clone()),this.component.trigger("uiHasInjectedOldTimelineItems"),this.component.trigger("uiHasInjectedOldTimelineItems"),this.component.trigger("uiHasInjectedOldTimelineItems"),this.component.trigger("uiHasInjectedOldTimelineItems"),expect(a).toHaveBeenCalled(),expect(a.callCount).toEqual(1)}),it("calculates the dimensions of a row correctly",function(){setupComponent(this.$grid1.clone(),e);var a=parseInt((f-g*4)/4),b=parseInt((f-g*3)/4);expect(parseInt($(this.component.getMedia()[0]).attr("scaled-width"))).toEqual(a),expect(parseInt($(this.component.getMedia()[1]).attr("scaled-width"))).toEqual(a),expect(parseInt($(this.component.getMedia()[2]).attr("scaled-width"))).toEqual(a),expect(parseInt($(this.component.getMedia()[3]).attr("scaled-width"))).toEqual(a),expect($(this.component.getMedia()[0])).toHaveClass("clear"),expect(parseInt($(this.component.getMedia()[4]).attr("scaled-width"))).toEqual(b),expect(parseInt($(this.component.getMedia()[5]).attr("scaled-width"))).toEqual(b*2),expect(parseInt($(this.component.getMedia()[6]).attr("scaled-width"))).toEqual(b),expect($(this.component.getMedia()[4])).toHaveClass("clear"),expect($(this.component.getMedia()[7]).attr("data-pano")).toEqual("true")}),it("limits the number of rows to render",function(){setupComponent(this.$grid1.clone(),$.extend(e,{gridRowLimit:1}));var a=parseInt((f-g*4)/4),b=parseInt((f-g*3)/4);expect(parseInt($(this.component.getMedia()[0]).attr("scaled-width"))).toEqual(a),expect(parseInt($(this.component.getMedia()[1]).attr("scaled-width"))).toEqual(a),expect(parseInt($(this.component.getMedia()[2]).attr("scaled-width"))).toEqual(a),expect(parseInt($(this.component.getMedia()[3]).attr("scaled-width"))).toEqual(a),expect($(this.component.getMedia()[0])).toHaveClass("clear"),expect($(this.component.getMedia()[4]).attr("data-grid-processed")).not.toEqual("true"),expect($(this.component.getMedia()[5]).attr("data-grid-processed")).not.toEqual("true"),expect($(this.component.getMedia()[6]).attr("data-grid-processed")).not.toEqual("true"),expect(parseInt($(this.component.node).attr("data-processed-rows"))).toEqual(2)}),describe("getUnscribedMedia",function(){beforeEach(function(){setupComponent(this.$grid1.clone()),this.component.select("mediaSelector").removeAttr("data-grid-processed"),this.component.select("mediaSelector").removeAttr("data-scribed")}),it("should return 0 if no items have been processed",function(){expect(this.component.getUnscribedMedia().length).toBe(0)}),it("should return processed items that have not been scribed",function(){var a=this.$node.find("a");$(a.get(0)).attr("data-grid-processed","true"),$(a.get(0)).attr("data-scribed","true"),$(a.get(1)).attr("data-grid-processed","true"),$(a.get(2)).attr("data-grid-processed","true"),expect(this.component.getUnscribedMedia().length).toBe(2)})}),describe("moveFooter",function(){describe("when the row limit is set",function(){beforeEach(function(){setupComponent($(d),$.extend(e,{itemsSelector:"#stream-items-id",gridRowLimit:1}))}),it("should not move the footer",function(){expect(this.component.$node.find(".stream-media-grid-items .stream-media-items-footer")).toExist()})}),describe("when the row limit is not set",function(){beforeEach(function(){setupComponent($(d),$.extend(e,{itemsSelector:"#stream-items-id",gridRowLimit:0}))}),it("should move the footer",function(){expect(this.component.$node.find(".stream-media-grid-items .stream-media-items-footer")).not.toExist(),expect(this.component.$node.find(".stream-items .stream-media-items-footer")).toExist()})})})})
});
define("test/app/ui/who_to_follow/who_to_follow_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/who_to_follow/who_to_follow_timeline",function(){function a(a,b){return'<div class="wtf-module">       <div class="empty-timeline">         <div class="content-header">           <h2 class="header-text">Here are some people you might enjoy following.</h2>           <button type="button" class="js-done btn-link" disabled>Close</button>           <button type="button" class="btn-link js-refresh-suggestions">Refresh</button>         </div>         <ul class="js-recommended-followers">'+a+"</ul>         "+b+"      </div>     </div>"}function b(a,b,c,d){return'<li class="js-actionable-user" data-user-id="'+a+'"'+(d?'data-impression-id="'+d+'"':"")+'">       <div class="user-actions '+c+'" data-user-id="'+a+'"'+(b?" data-protected=true":"")+'>       <button class="js-follow-btn" type="button">           <span class="button-text follow-text"><i class="follow"></i> Follow</span>           <span class="button-text unfollow-text">Unfollow</span>           <span class="button-text cancel-text">Cancel</span>         </button>       </div>     </li>'}function c(a,b,c){return'<div class="empty-timeline-footer content-no-header import-prompt">       <p>        <button class="btn js-launch-service" data-url="'+b+'}">        <i class="service-'+a+'"><span>Search contacts</span></i>        </button>        <strong>See who you already know on Twitter</strong>        <span>Find people you know, discover interesting accounts and let us make Twitter better for you by importing your contacts from '+c+"</span>      </p>    </div>"}describe("with recommendations",function(){var d=[{userId:"1",protectedUser:!1,followState:"not-following",impressionId:"p"},{userId:"2",protectedUser:!1,followState:"following"},{userId:"3",protectedUser:!0,followState:"pending"}],e="",f,g;d.forEach(function(a){e+=b(a.userId,a.protectedUser,a.followState,a.impressionId)}),beforeEach(function(){setupComponent(a(e,c("gmail","https://gmail.com/","foo@gmail.com")),{launchServiceSelector:".js-launch-service"}),f=this.component.select("doneButtonSelector"),$launchButton=this.component.select("launchServiceSelector"),g=d.map(function(a){return a.userId})}),describe("on page load / uiSwiftLoaded",function(){it("triggers a uiUsersDisplayed event for promoted account tracking",function(){spyOnEvent(document,"uiUsersDisplayed"),setupComponent(a(e,"")),this.component.trigger("uiSwiftLoaded"),expect("uiUsersDisplayed").toHaveBeenTriggeredOnAndWith(document,{users:[{id:"1",impressionId:"p"},{id:"2",impressionId:undefined},{id:"3",impressionId:undefined}]})}),it("triggers a uiDidGetRecommendations event with initialResults=true",function(){spyOnEvent(document,"uiDidGetRecommendations"),setupComponent(a(e,"")),this.component.trigger("uiSwiftLoaded"),expect("uiDidGetRecommendations").toHaveBeenTriggeredOnAndWith(document,{initialResults:!0})})}),describe("when dataFollowStateChange is triggered",function(){describe("timeline",function(){it("should refresh",function(){this.component.followingCount=3,spyOnEvent(this.$node,"uiTimelineShouldRefresh"),this.component.trigger("dataFollowStateChange",{newState:"not-following",userId:"1"}),expect("uiTimelineShouldRefresh").toHaveBeenTriggeredOnAndWith(this.$node,{injectImmediately:!0})})}),describe("when empty timeline following max is not reached",function(){it("disables button",function(){this.component.followingCount=4,expect(f).toBeDisabled(),this.component.trigger("dataFollowStateChange",{newState:"not-following",userId:"1"}),expect(f).toBeDisabled()})}),describe("when empty timeline following max is reached",function(){beforeEach(function(){spyOnEvent(this.$node,"uiDidReachTargetFollowingCount"),this.component.followingCount=5,expect(f).toBeDisabled(),this.component.trigger("dataFollowStateChange",{newState:"not-following",userId:"1"})}),it("enables button",function(){expect(f).not.toBeDisabled()}),it("triggers uiDidReachTargetFollowingCount",function(){expect("uiDidReachTargetFollowingCount").toHaveBeenTriggeredOn(this.$node)})}),it("changes the title copy based on number of followings",function(){var a=function(a){expect(this.component.select("headerTextSelector").text()).toEqual(a)}.bind(this),b=function(){this.component.followingCount++,this.component.trigger("dataFollowStateChange",{newState:"not-following",userId:"1"})}.bind(this);this.component.followingCount=0,b(),a("Victory! That’s 1."),b(),a("Congratulations! That’s 2."),b(),a("Excellent! You’re making progress."),b(),a("Good work! You’ve almost reached 5."),b(),a("Yee-haw! That’s 5 follows. Now you’re on a roll.")})}),describe("event click on done button",function(){it("removes the module from the DOM",function(){expect(this.$node).toExist(),f.attr("disabled",!1).trigger("click"),expect(this.$node.get()).not.toExist()}),it("triggers a uiDidHideEmptyTimelineModule event",function(){spyOnEvent(document,"uiDidHideEmptyTimelineModule"),f.attr("disabled",!1).trigger("click"),expect("uiDidHideEmptyTimelineModule").toHaveBeenTriggeredOn(document)}),it("triggers a uiDidDismissEmptyTimelineRecommendations event",function(){spyOnEvent(document,"uiDidDismissEmptyTimelineRecommendations"),f.attr("disabled",!1).trigger("click"),expect("uiDidDismissEmptyTimelineRecommendations").toHaveBeenTriggeredOnAndWith(document,{userIds:g})})}),describe("when uiFollowAction is triggered",function(){it("increases following count by 1",function(){this.component.followingCount=0,this.component.trigger("uiFollowAction"),expect(this.component.followingCount).toEqual(1)})}),describe("when uiUnfollowAction is triggered",function(){it("decreases following count by 1",function(){this.component.followingCount=3,this.component.trigger("uiUnfollowAction"),expect(this.component.followingCount).toEqual(2)})}),describe("click on Search contacts button",function(){it("triggers a uiImportServiceLaunched event",function(){expect(this.$node).toExist(),spyOnEvent(document,"uiImportServiceLaunched"),spyOn(window,"open").andReturn({focus:$.noop}),$launchButton.attr("disabled",!1).trigger("click"),expect("uiImportServiceLaunched").toHaveBeenTriggeredOnAndWith(document,{service:$launchButton.data("service")})}),it("opens a new window",function(){expect(this.$node).toExist(),spyOn(window,"open").andReturn({focus:$.noop}),$launchButton.attr("disabled",!1).trigger("click"),expect(window.open).toHaveBeenCalled()})})})})
});
define("test/app/ui/who_to_follow/with_unmatched_contacts_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/who_to_follow/with_unmatched_contacts",function(){beforeEach(function(){var a='<div>\n        <div class="select-all-people">\n          <label class="contacts-select-all">\n            <input type="checkbox" class="select-all-contacts" name="select_all">\n            Select all 4\n          </label>\n        </div>\n\n        <div class="contacts">\n          <label class="contact-item">\n            <input class="contact-checkbox" name="emails[]" value="john22@twitter.com" id="contact-box-1" type="checkbox">\n            <span class="contact-item-name" title="John 22">John 22</span>\n            <span class="contact-item-email" title="john22@twitter.com">&lt;john22@twitter.com&gt;</span>\n          </label>\n          <label class="contact-item">\n            <input class="contact-checkbox" name="emails[]" value="john43@twitter.com" id="contact-box-2" type="checkbox">\n            <span class="contact-item-name" title="John 43">John 43</span>\n            <span class="contact-item-email" title="john43@twitter.com">&lt;john43@twitter.com&gt;</span>\n          </label>\n          <label class="contact-item">\n            <input class="contact-checkbox" name="emails[]" value="john41@twitter.com" id="contact-box-3" type="checkbox">\n            <span class="contact-item-name" title="john41@twitter.com">john41@twitter.com</span>\n            <span class="contact-item-email" title="john41@twitter.com">&lt;john41@twitter.com&gt;</span>\n          </label>\n          <label class="contact-item">\n            <input class="contact-checkbox" name="emails[]" value="john40@twitter.com" id="contact-box-4" type="checkbox">\n            <span class="contact-item-name" title="john40@twitter.com">john40@twitter.com</span>\n            <span class="contact-item-email" title="john40@twitter.com">&lt;john40@twitter.com&gt;</span>\n          </label>\n        </div>\n\n        <button class="js-invite" disabled>Invite these friends</button>\n      </div>\n    ';setupComponent(a,{inviteContactsComponent:"invite_contacts_spec"})}),it("triggers an event with checked users when submitting",function(){spyOnEvent(this.$node,"uiInviteContacts"),this.$node.find("#contact-box-2").click(),this.$node.find("#contact-box-3").click(),this.component.select("actionButtonSelector").click(),expect("uiInviteContacts").toHaveBeenTriggeredOnAndWith(this.$node,{invitable:4,contacts:[{name:"John 43",email:"john43@twitter.com"},{email:"john41@twitter.com"}],scribeContext:{component:"invite_contacts_spec"}})})})
});
define("test/app/ui/who_to_follow/web_personalized_settings_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/who_to_follow/web_personalized_settings",function(){beforeEach(function(){var a='<div class="module" id="web-personalization">\n        <div class="flex-module web-personalization-header visible">\n            <h1>{{_i}}Tailor Twitter to your interests{{/i}}</h1>\n        </div>\n\n        <div class="flex-module web-personalization-inner web-personalization-allow-disallow visible">\n          <p>{{_i}}People on Twitter are talking about things you care about. Now we’ve made it easier for you to find them. We’ve tailored our suggestions based on websites you’ve recently visited that have Twitter buttons or widgets.{{/i}}</p>\n          <p>{{_i}}For example, if you visit sports websites, we might suggest teams and players that are popular and widely followed by other Twitter users that visit those sports websites.{{/i}}</p>\n          <p>{{_i}}<a href="{{cookie_personalization_learn_more_path}}">Learn more</a> about how this works and your additional privacy controls.{{/i}}</p>\n        </div>\n\n        <div class="flex-module web-personalization-inner">\n          <p>\n            {{_i}}Your browser has Do Not Track turned on. While Do Not Track is on, Twitter cannot provide tailored suggestions.{{/i}}\n          </p>\n          <p>{{_i}}<a href="{{cookie_personalization_learn_more_path}}">Learn more</a> about how this works and your additional privacy controls.{{/i}}</p>\n          <p>\n            <a href="{{home_path}}" class="btn primary-btn">\n              {{_i}}Back to timeline{{/i}}\n            </a>\n          </p>\n        </div>\n\n        <div class="flex-module web-personalization-footer web-personalization-allow-disallow visible">\n          <p>\n            <button class="js-web-personalization-allow btn primary-btn">{{_i}}OK{{/i}}</button>\n            <button class="js-web-personalization-disallow btn">{{_i}}Turn off{{/i}}</button>\n          </p>\n          <p>{{_i}}If you don’t want tailored suggestions, you can turn off this feature. Then your visits to websites that have Twitter buttons or widgets will no longer be collected to tailor your experience.{{/i}}</p>\n        </div>\n\n        <div class="web-personalization-inner web-personalization-results">\n        </div>\n        <div class="flex-module web-personalization-inner web-personalization-allowed js-results">\n          <p><span class="spinner" title="{{_i}}Loading...{{/i}}"></span></p>\n        </div>\n\n        <div class="flex-module web-personalization-footer web-personalization-allowed">\n          <p>\n            <button class="js-web-personalization-turnoff btn">{{_i}}Turn off{{/i}}</button>\n          </p>\n          <p>{{_i}}If you don’t want tailored suggestions, you can turn off this feature. Then your visits to websites that have Twitter buttons or widgets will no longer be collected to tailor your experience. <a href="{{cookie_personalization_learn_more_path}}">Learn more</a>.{{/i}}</p>\n        </div>\n      </div>\n     ';spyOnEvent(document,"uiWebPersonalizationImpression"),setupComponent(a,{showResults:!1})}),it("should trigger uiWebPersonalizationImpression upon initialization",function(){expect("uiWebPersonalizationImpression").toHaveBeenTriggeredOn(this.component),expect("uiAllowWebPersonalization").not.toHaveBeenTriggeredOn(this.component)}),it("should trigger uiAllowWebPersonalization when there are recommendations",function(){spyOnEvent(document,"uiAllowWebPersonalization"),setupComponent({showResults:!0}),expect("uiAllowWebPersonalization").toHaveBeenTriggeredOn(this.component)}),it("should handle allow button clicks",function(){spyOnEvent(document,"uiAllowWebPersonalization"),this.component.select("allowBtnSelector").click(),expect("uiAllowWebPersonalization").toHaveBeenTriggeredOnAndWith(this.component,{element:"allow"})}),it("should handle disallow button clicks",function(){spyOnEvent(document,"uiDisallowWebPersonalization"),this.component.select("disallowBtnSelector").click(),expect("uiDisallowWebPersonalization").toHaveBeenTriggeredOnAndWith(this.component,{element:"disallow"})}),it("should handle turn off button clicks",function(){spyOnEvent(document,"uiTurnoffWebPersonalization"),this.component.select("turnoffBtnSelector").click(),expect("uiTurnoffWebPersonalization").toHaveBeenTriggeredOnAndWith(this.component,{element:"turnoff"})}),it("should show the loading spinner on event uiAllowWebPersonalization",function(){this.component.trigger("uiAllowWebPersonalization"),expect(this.component.select("allowDisallowSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("resultsSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("spinnerSelector").hasClass("visible")).toBeTruthy(),expect(this.component.select("turnoffSelector").hasClass("visible")).toBeTruthy()}),it("should show the loading spinner on event uiDisallowWebPersonalization",function(){this.component.trigger("uiDisallowWebPersonalization"),expect(this.component.select("allowDisallowSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("resultsSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("spinnerSelector").hasClass("visible")).toBeTruthy(),expect(this.component.select("turnoffSelector").hasClass("visible")).toBeTruthy()}),it("should show the loading spinner on event uiTurnoffWebPersonalization",function(){this.component.trigger("uiTurnoffWebPersonalization"),expect(this.component.select("allowDisallowSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("resultsSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("spinnerSelector").hasClass("visible")).toBeTruthy(),expect(this.component.select("turnoffSelector").hasClass("visible")).toBeTruthy()}),it("should show the explanation on event dataUserRecommendationsError",function(){this.component.trigger("dataUserRecommendationsError"),expect(this.component.select("allowDisallowSelector").hasClass("visible")).toBeTruthy(),expect(this.component.select("resultsSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("spinnerSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("turnoffSelector").hasClass("visible")).toBeFalsy()}),it("should show the results HTML snippet on dataUserRecommendationsInitialResults",function(){this.component.trigger("dataUserRecommendationsInitialResults"),expect(this.component.select("spinnerSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("resultsSelector").children().length).toEqual(0),expect(this.component.select("turnoffSelector").hasClass("visible")).toBeTruthy(),this.component.trigger("dataUserRecommendationsInitialResults",{}),expect(this.component.select("spinnerSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("resultsSelector").children().length).toEqual(0),expect(this.component.select("turnoffSelector").hasClass("visible")).toBeTruthy(),this.component.trigger("dataUserRecommendationsInitialResults",{html:"<ul><li>Suggestion 1</li><li>Suggestion 2</li></ul>"}),expect(this.component.select("spinnerSelector").hasClass("visible")).toBeFalsy(),expect(this.component.select("resultsSelector").children().length).toEqual(1),expect(this.component.select("turnoffSelector").hasClass("visible")).toBeTruthy()}),it("event uiGoToHomePage should trigger uiNavigate to '/'",function(){spyOnEvent(document,"uiNavigate"),this.component.trigger("uiGoToHomePage"),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.component,{href:"/"})})})
});
define("test/app/ui/who_to_follow/with_invite_preview_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/who_to_follow/with_invite_preview",function(){var a='<div>\n      <a href="#" class="js-preview-invite">See what you’ll send them</a>\n    </div>\n  ';beforeEach(function(){setupComponent(a)}),it("pops open a window to preview",function(){spyOn(window,"open"),this.component.select("previewInviteSelector").click(),expect(window.open).toHaveBeenCalled()})})
});
define("test/app/ui/who_to_follow/with_invite_messages_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/who_to_follow/with_invite_messages",function(){beforeEach(function(){setupComponent("<div>")}),it("displays a message on success",function(){spyOnEvent(this.$node,"uiShowMessage"),spyOnEvent(this.$node,"uiInviteFinished"),this.component.trigger("dataInviteContactsSuccess",{invited:["john43@twitter.com","john41@twitter.com"]}),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(this.$node,{message:"We let 2 of your contacts know about Twitter."}),expect("uiInviteFinished").toHaveBeenTriggeredOn(this.$node,{count:2})}),it("displays an error if that is what happened",function(){spyOnEvent(this.$node,"uiShowError"),this.component.trigger("dataInviteContactsFailure",{errors:[{code:37}]}),expect("uiShowError").toHaveBeenTriggeredOn(this.$node)}),it("pretends there was not an error some of the time",function(){spyOnEvent(this.$node,"uiShowMessage"),spyOnEvent(this.$node,"uiInviteFinished"),this.component.trigger("dataInviteContactsFailure",{errors:[{code:71}]}),expect("uiShowMessage").toHaveBeenTriggeredOn(this.$node),expect("uiInviteFinished").toHaveBeenTriggeredOnAndWith(this.$node,{count:-1})})})
});
define("test/app/ui/who_to_follow/with_user_recommendations_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/who_to_follow/with_user_recommendations",function(){function a(a){return'<div class="module js-wtf-module">       <div class="flex-module-header">         <a class="js-refresh-suggestions" href="#">Refresh</a>       </div>       <div class="js-recommended-followers dashboard-user-recommendations">'+a+"</div>     </div>"}function b(a,b,c,d){return'<div class="js-actionable-user'+(d?" promoted-account":"")+'"         data-user-id="'+a+'" data-feedback-token="token" '+(d?'data-impression-id="'+d+'"':"")+'">       <div class="js-action-dismiss"></div>       <div class="content">         <a class="js-recommend-link"></a>         <span class="user-actions '+c+'" data-user-id="'+a+'"'+(b?" data-protected=true":"")+'>           <a href="#" class="follow-link">             <span class="link-text follow-text">Follow</span>             <span class="link-text unfollow-text">Unfollow</span>             <span class="link-text cancel-text">Cancel</span>           </a>         </span>       </div>     </div>'}beforeEach(function(){jasmine.Clock.useMock()}),describe("with recommendations",function(){var c=[{userId:"1",protectedUser:!1,followState:"not-following",impressionId:"p"},{userId:"2",protectedUser:!1,followState:"following"},{userId:"3",protectedUser:!0,followState:"pending"}],d="";c.forEach(function(a){d+=b(a.userId,a.protectedUser,a.followState,a.impressionId)});var e,f,g,h;beforeEach(function(){setupComponent(a(d)),e=this.$node.find(".js-recommended-followers"),f=this.$node.find(".js-refresh-suggestions"),g=[],h=[],c.forEach(function(a){var b=this.$node.find(".js-actionable-user[data-user-id="+a.userId+"]");g.push(b),h.push({dismiss:b.find(".js-action-dismiss"),follow:b.find(".follow-link .follow-text")})},this)}),describe("visibleIds",function(){it("should default to filtering out promoted users",function(){expect(this.component.getVisibleIds().length).toEqual(c.filter(function(a){return!a.impressionId}).length)}),it("should be able to display promoted users",function(){expect(this.component.getVisibleIds(null,!0).length).toEqual(c.length)})}),describe("event click on refresh suggestions link",function(){it("sets currentlyRefreshing to true",function(){expect(this.component.currentlyRefreshing).toBeFalsy(),this.$node.find(".js-refresh-suggestions").trigger("click"),expect(this.component.currentlyRefreshing).toBeTruthy()}),it("filters promoted users out of the excluded list",function(){var a=c.filter(function(a){return!a.impressionId}).map(function(a){return a.userId});spyOnEvent(this.$node,"uiRefreshUserRecommendations"),f.trigger("click"),expect("uiRefreshUserRecommendations").toHaveBeenTriggeredOnAndWith(this.$node,{excluded:a,limit:c.length,refreshType:"click"})}),it("triggers uiRefreshUserRecommendations with the wtf_options specified in init_data",function(){var a={pc:!0,connections:!0,limit:3};spyOnEvent(this.$node,"uiRefreshUserRecommendations"),this.component.attr.wtfOptions=a,f.trigger("click");var b={};for(var d in a)b[d]=a[d];b.excluded=c.filter(function(a){return!a.impressionId}).map(function(a){return a.userId}),b.refreshType="click",expect("uiRefreshUserRecommendations").toHaveBeenTriggeredOnAndWith(this.$node,b)}),it("animates the recommendations list out",function(){expect(e).toHaveCss("opacity","1"),f.trigger("click"),expect(e).toHaveCss("opacity","0")})}),describe("event dataDidGetUserRecommendations",function(){describe("when new recommendations are returned from the server",function(){it("injects the new recommendations",function(){this.component.trigger("dataDidGetUserRecommendations",{user_recommendations_html:"RECOMMENDATIONS"}),expect(e).toHaveText("RECOMMENDATIONS"),expect(this.$node).toHaveClass("has-content")}),it("triggers a uiUsersDisplayed event",function(){var a=[{userId:"1",protectedUser:!1,followState:"not-following",impressionId:"p"},{userId:"2",protectedUser:!1,followState:"following"},{userId:"3",protectedUser:!0,followState:"pending"}],c="";a.forEach(function(a){c+=b(a.userId,a.protectedUser,a.followState,a.impressionId)}),spyOnEvent(this.component.$node,"uiUsersDisplayed"),this.component.trigger("dataDidGetUserRecommendations",{user_recommendations_html:c}),expect("uiUsersDisplayed").toHaveBeenTriggeredOnAndWith(this.component.$node,{users:a.map(function(a){return{id:a.userId,impressionId:a.impressionId}})})}),it("animates in the new recommendations",function(){e.css("opacity",0),this.component.trigger("dataDidGetUserRecommendations",{user_recommendations_html:"RECOMMENDATIONS"}),expect(e).toHaveCss("opacity","1")})}),describe("when new recommendations are NOT returned from the server",function(){it("calls handleEmptyRefreshResponse",function(){spyOn(this.component,"handleEmptyRefreshResponse"),this.component.trigger("dataDidGetUserRecommendations"),expect(this.component.handleEmptyRefreshResponse).toHaveBeenCalled()})})}),describe("Cycling new recommendation on follow",function(){describe("when dataFollowStateChange is triggered with success",function(){beforeEach(function(){spyOnEvent(document,"uiGetUserRecommendations"),this.component.attr.wtfOptions={dismissable:!0}}),describe("when the user followed matches a user recommendation",function(){beforeEach(function(){this.component.trigger("dataFollowStateChange",{newState:"following",userId:"1"}),jasmine.Clock.tick(1e3)}),it("animates out the followed recommendation",function(){expect(g[0]).toHaveCss("opacity","0")}),it("triggers uiGetUserRecommendations event",function(){expect("uiGetUserRecommendations").toHaveBeenTriggeredOnAndWith(document,{limit:1,dismissable:!0,visible:["2","3"],refreshUserId:"1"})})}),describe("when the user followed does not match a user recommendation",function(){beforeEach(function(){this.component.trigger("dataFollowStateChange",{newState:"following",userId:"88"}),jasmine.Clock.tick(1e3)}),it("does not trigger uiGetUserRecommendations event",function(){expect("uiGetUserRecommendations").not.toHaveBeenTriggeredOn(document)})})}),describe("when dataFollowStateChange is triggered with failure",function(){beforeEach(function(){spyOnEvent(document,"uiGetUserRecommendations"),this.component.trigger("dataFollowStateChange",{newState:"not-following",userId:"1"}),jasmine.Clock.tick(1e3)}),it("does not animate out the followed recommendation",function(){expect(g[0]).toHaveCss("opacity","1")}),it("does not trigger uiGetUserRecommendations event",function(){expect("uiGetUserRecommendations").not.toHaveBeenTriggeredOn(document)})}),describe("when server returns user recommendation data",function(){it("animates in the new recommendations",function(){g[0].css("opacity",0),this.component.trigger("dataDidGetUserRecommendations",{user_recommendations_html:"<div class='js-actionable-user'>NEW RECOMMENDATION</div>",sourceEventData:{refreshUserId:g[0].attr("data-user-id")}}),expect(g[0]).toHaveCss("opacity","1"),expect(this.$node.find(".js-actionable-user:nth-child(1)")).toHaveText("NEW RECOMMENDATION")})}),describe("when a new recommendation is not returned from the server",function(){it("calls handleEmptyRefreshResponse",function(){spyOn(this.component,"handleEmptyRefreshResponse").andCallThrough(),spyOn(this.component,"animateContentIn"),this.component.trigger("dataDidGetUserRecommendations",{sourceEventData:{refreshUserId:g[0].attr("data-user-id")}}),expect(this.component.handleEmptyRefreshResponse).toHaveBeenCalled(),expect(this.component.animateContentIn).toHaveBeenCalledWith(g[0],"animationCallback",g[0].html())}),it("triggers uiGotEmptyRecommendationsResponse",function(){spyOnEvent(document,"uiGotEmptyRecommendationsResponse"),this.component.trigger("dataDidGetUserRecommendations"),expect("uiGotEmptyRecommendationsResponse").toHaveBeenTriggeredOn(this.$node)})})}),describe("event dataFailedToGetUserRecommendations",function(){it("calls handleEmptyRefreshResponse",function(){spyOn(this.component,"handleEmptyRefreshResponse"),this.component.trigger("dataFailedToGetUserRecommendations"),expect(this.component.handleEmptyRefreshResponse).toHaveBeenCalled()})}),describe("#handleEmptyRefreshResponse",function(){describe("when there are current recommendations",function(){beforeEach(function(){e.css("opacity",0),this.component.handleEmptyRefreshResponse()}),it("does not remove the module from the page",function(){expect(this.$node).toBeVisible()}),it("animates in the current recs",function(){expect(e).toHaveCss("opacity","1")})})})}),describe("with no rendered recommendations",function(){it("does not report users displayed",function(){var b=spyOn(this.Component.prototype,"reportUsersDisplayed");setupComponent(a("")),expect(b).not.toHaveBeenCalled()})}),describe("event uiRefreshUserRecsOnNewTweets",function(){it("does not refresh WTF recommendations by default",function(){setupComponent(a("")),spyOnEvent(this.$node,"uiRefreshUserRecommendations"),$(document).trigger("uiRefreshUserRecsOnNewTweets"),expect("uiRefreshUserRecommendations").not.toHaveBeenTriggeredOn(this.$node),expect(this.component.select("recListSelector")).not.toHaveCss("opacity","0")}),it("refreshes search page WTF recommendations with new tweets when wtfRefreshOnNewSearchTweets is true",function(){setupComponent(a(""),{wtfRefreshOnNewSearchTweets:!0}),spyOnEvent(this.$node,"uiRefreshUserRecommendations"),$(document).trigger("uiRefreshUserRecsOnNewTweets"),expect("uiRefreshUserRecommendations").toHaveBeenTriggeredOnAndWith(this.$node,{excluded:[],refreshType:"uiRefreshUserRecsOnNewTweets"}),expect(this.component.select("recListSelector")).toHaveCss("opacity","0")}),it("does not refresh home page WTF recommendations with new tweets when wtfRefreshDebounceBucket is null",function(){setupComponent(a(""),{wtfRefreshDebounceBucket:null}),spyOnEvent(this.$node,"uiRefreshUserRecommendations"),$(document).trigger("uiRefreshUserRecsOnNewTweets"),expect("uiRefreshUserRecommendations").not.toHaveBeenTriggeredOn(this.$node),expect(this.component.select("recListSelector")).not.toHaveCss("opacity","0")}),it("does not refresh home page WTF recommendations with new tweets when wtfRefreshDebounceBucket is control",function(){setupComponent(a(""),{wtfRefreshDebounceBucket:"control"}),spyOnEvent(this.$node,"uiRefreshUserRecommendations"),$(document).trigger("uiRefreshUserRecsOnNewTweets"),expect("uiRefreshUserRecommendations").not.toHaveBeenTriggeredOn(this.$node),expect(this.component.select("recListSelector")).not.toHaveCss("opacity","0")}),it("refreshes home page WTF recommendations with respect to debounce interval",function(){var b=1e3,c=b*30;jasmine.Clock.useMock(),setupComponent(a(""),{wtfRefreshOnNewHomeTweets:!0,wtfRefreshDebounceBucket:"1_min_debounce"}),spyOnEvent(this.$node,"uiRefreshUserRecommendations"),spyOn(this.component,"refreshRecommendations"),$(document).trigger("uiRefreshUserRecsOnNewTweets"),expect(this.component.refreshRecommendations.calls.length).toEqual(1),jasmine.Clock.tick(c),$(document).trigger("uiRefreshUserRecsOnNewTweets"),expect(this.component.refreshRecommendations.calls.length).toEqual(1),jasmine.Clock.tick(2*c+b),$(document).trigger("uiRefreshUserRecsOnNewTweets"),expect(this.component.refreshRecommendations.calls.length).toEqual(2)})}),describe("event uiPageChanged",function(){it("does not refresh WTF recommendations by default",function(){setupComponent(a("")),spyOnEvent(this.$node,"uiRefreshUserRecommendations"),$(document).trigger("uiPageChanged"),expect("uiRefreshUserRecommendations").not.toHaveBeenTriggeredOn(this.$node),expect(this.component.select("recListSelector")).not.toHaveCss("opacity","0")}),it("does refresh the WTF recommendations when wtfRefreshOnPageNav is true",function(){setupComponent(a(""),{wtfRefreshOnPageNav:!0}),spyOnEvent(this.$node,"uiRefreshUserRecommendations"),$(document).trigger("uiPageChanged"),expect("uiRefreshUserRecommendations").toHaveBeenTriggeredOnAndWith(this.$node,{excluded:[],refreshType:"uiPageChanged"}),expect(this.component.select("recListSelector")).toHaveCss("opacity","0")}),it("does not refresh the WTF recommendations when wtfRefreshOnPageNav is false",function(){setupComponent(a(""),{wtfRefreshOnPageNav:!1}),spyOnEvent(this.$node,"uiRefreshUserRecommendations"),$(document).trigger("uiPageChanged"),expect("uiRefreshUserRecommendations").not.toHaveBeenTriggeredOn(this.$node),expect(this.component.select("recListSelector")).not.toHaveCss("opacity","0")})})})
});
define("test/app/ui/who_to_follow/who_to_follow_dashboard_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/who_to_follow/who_to_follow_dashboard",function(){function a(a){return'<div class="module js-wtf-module">       <div class="flex-module-header">         <a class="js-refresh-suggestions" href="#">Refresh</a>       </div>       <div class="js-recommended-followers dashboard-user-recommendations">'+a+"</div>     </div>"}function b(a,b,c,d){return'<div class="js-actionable-user'+(d?" promoted-account":"")+'"         data-user-id="'+a+'" data-feedback-token="token" '+(d?'data-impression-id="'+d+'"':"")+'">       <div class="js-action-dismiss"></div>       <div class="content">         <a class="js-recommend-link"></a>         <span class="user-actions '+c+'" data-user-id="'+a+'"'+(b?" data-protected=true":"")+'>           <a href="#" class="follow-link">             <span class="link-text follow-text">Follow</span>             <span class="link-text unfollow-text">Unfollow</span>             <span class="link-text cancel-text">Cancel</span>           </a>         </span>       </div>     </div>'}function c(a,b,c,d){return'<div class="js-actionable-user'+(d?" promoted-account":"")+'"         data-user-id="'+a+'" data-feedback-token="token" '+(d?'data-impression-id="'+d+'"':"")+'">       <div class="js-action-dismiss"></div>       <div class="content">         <a class="js-recommend-link"></a>         <div class="user-actions '+c+'" data-user-id="'+a+'"'+(b?" data-protected=true":"")+'>            <a class="small-follow-btn follow-btn btn follow-button js-recommended-item">              <div class="js-action-follow follow-text">                <i class="activity-follow"></i>                Follow              </div>              <div class="js-action-unfollow following-text action-text">Following</div>              <div class="js-action-unfollow unfollow-text action-text">Unfollow</div>              <div class="block-text action-text">Blocked</div>              <div class="js-action-unblock unblock-text action-text">Unblock</div>              <div class="js-action-unfollow pending-text action-text">Pending</div>              <div class="js-action-unfollow cancel-req-text action-text">Cancel</div>            </a>         </div>        </div>     </div>'}var d=function(b,c){describe("with recommendations "+c,function(){var c=[{userId:"1",protectedUser:!1,followState:"not-following",impressionId:"p"},{userId:"2",protectedUser:!1,followState:"following"},{userId:"3",protectedUser:!0,followState:"pending"}],d=c.map(function(a){return b(a.userId,a.protectedUser,a.followState,a.impressionId)}),e,f;beforeEach(function(){setupComponent(a(d)),e=[],f=[],c.forEach(function(a){var b=this.$node.find(".js-actionable-user[data-user-id="+a.userId+"]");e.push(b),f.push({dismiss:b.find(".js-action-dismiss"),follow:b.find(".follow-link .follow-text")})},this)}),describe("on page load / uiSwiftLoaded",function(){it("triggers a uiUsersDisplayed event for promoted account tracking",function(){spyOnEvent(document,"uiUsersDisplayed"),setupComponent(a(d)),this.component.trigger("uiSwiftLoaded"),expect("uiUsersDisplayed").toHaveBeenTriggeredOnAndWith(document,{users:[{id:"1",impressionId:"p"},{id:"2",impressionId:undefined},{id:"3",impressionId:undefined}]})}),it("triggers a uiDidGetRecommendations event with initialResults=true",function(){spyOnEvent(document,"uiDidGetRecommendations"),setupComponent(a(d)),this.component.trigger("uiSwiftLoaded"),expect("uiDidGetRecommendations").toHaveBeenTriggeredOnAndWith(document,{initialResults:!0})})}),describe("event click on dismiss recommendation link",function(){it("triggers uiDismissUserRecommendation with the correct options",function(){spyOnEvent(this.$node,"uiDismissUserRecommendation"),f[0].dismiss.trigger("click"),expect("uiDismissUserRecommendation").toHaveBeenTriggeredOnAndWith(this.$node,{recommended_user_id:c[0].userId,impressionId:"p",excluded:[c[0].userId],visible:[c[1].userId,c[2].userId],token:"token",refreshUserId:c[0].userId})}),it("animates the recommendation out",function(){expect(e[0]).toHaveCss("opacity","1"),f[0].dismiss.trigger("click"),expect(e[0]).toHaveCss("opacity","0")})}),describe("event dataDidDismissRecommendation",function(){describe("when a new recommendation is returned from the server",function(){beforeEach(function(){this.component.trigger("dataDidDismissRecommendation",{user_recommendations_html:"<div class='js-actionable-user'>NEXT RECOMMENDATION</div>",sourceEventData:{refreshUserId:e[1].attr("data-user-id")}})}),it("injects the new recommendation",function(){expect(this.$node.find(".js-actionable-user:nth-child(2)")).toHaveText("NEXT RECOMMENDATION")}),it("animates in the new recommendation",function(){expect(this.$node.find(".js-actionable-user:nth-child(2)")).toHaveCss("opacity","1")})}),describe("when a new recommendation is not returned from the server",function(){it("calls handleEmptyDismissResponse",function(){spyOn(this.component,"handleEmptyDismissResponse"),this.component.trigger("dataDidDismissRecommendation"),expect(this.component.handleEmptyDismissResponse).toHaveBeenCalled()})})}),describe("event dataFailedToDismissUserRecommendation",function(){beforeEach(function(){spyOn(this.component,"handleEmptyDismissResponse"),this.component.trigger("dataFailedToDismissUserRecommendation",{sourceEventData:{refreshUserId:e[2].attr("data-user-id")}})}),it("calls handleEmptyDismissResponse",function(){expect(this.component.handleEmptyDismissResponse).toHaveBeenCalled()}),it("removes the user being dismissed",function(){expect(e[2]).not.toBeVisible()})}),describe("#handleEmptyDismissResponse",function(){describe("when there are more recommendations on the page",function(){beforeEach(function(){spyOnEvent(document,"uiShowMessage"),this.component.handleEmptyDismissResponse()}),it("does not remove the module from the page",function(){expect(this.$node).toBeVisible()}),it("does not trigger uiShowMessage",function(){expect("uiShowMessage").not.toHaveBeenTriggeredOn(document)})}),describe("when there are no more recommendations on the page",function(){beforeEach(function(){spyOnEvent(document,"uiShowMessage"),this.$node.find(".js-actionable-user").remove(),this.component.handleEmptyDismissResponse()}),it("removes the module from the page",function(){expect(this.$node).not.toBeVisible()}),it("triggers uiShowMessage with the correct message",function(){expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:"You have no more recommendations today!"})})})})})};d(b,"and follow link"),d(c,"and follow button"),describe("with no rendered recommendations",function(){it("triggers uiGetUserRecommendations with initialResults=true",function(){spyOnEvent(document,"uiGetUserRecommendations"),setupComponent(a("")),this.component.trigger("uiSwiftLoaded"),expect("uiGetUserRecommendations").toHaveBeenTriggeredOnAndWith(document,{initialResults:!0})})})})
});
define("test/app/ui/who_to_follow/with_import_prompt_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/who_to_follow/with_import_prompt",function(){var a='<div class="suggestions">\n      <a href="{{who_to_follow_suggestions_path}}" class="list-link">\n        View all suggestions\n        <i class="chev-right"></i>\n      </a>\n    </div>\n   ',b='<div class="flex-module import-prompt">\n      <div class="flex-module-footer">\n        <a href="{{who_to_follow_import_path}}">\n          <img class="address-book" src="/images/icon-address-book.png">\n        </a>\n        <p>\n          <a href="{{who_to_follow_import_path}}">Find people you know</a>\n          ·\n          <a href="{{who_to_follow_interests_path}}">Popular accounts</a>\n        </p>\n      </div>\n    </div>\n   ',c='<div class="cta js-launch-service" data-service="{{id}}" data-url="{{url}}" data-popup="{{popup}}" data-width="{{width}}" data-height="{{height}}">\n      <span class="service">\n        <i class="service-{{id}}"></i>\n      </span>\n      <p>\n        <strong>Find people you know</strong>\n        <span>Import your contacts from {{name}}</span>\n      </p>\n    </div>\n    <p class="flex-module-inner">\n      <span><button type="button" class="btn-link js-connect-other" href="#">Connect other address books</button></span>\n    </p>\n    <div class="other-services hidden">\n      {{#other_services}}\n        <span class="service js-launch-service" data-service="{{id}}" data-url="{{url}}" data-popup="{{popup}}" data-width="{{width}}" data-height="{{height}}">\n          <i class="service-{{id}}"></i>\n          <div>{{name}}</div>\n        </span>\n      {{/other_services}}\n      <p>\n        <span>\n          Choosing an option above will open a window for you to log in and securely import your contacts to Twitter. We\'ll also use this information to make follow suggestions. You can remove this privilege at any time.\n        </span>\n      </p>\n    </div>\n   ';describe("Clicking other services link",function(){it("should toggle visibility",function(){setupComponent(a+'<div class="flex-module import-prompt">'+c+"</div>"),expect(this.component.select("otherServicesSelector")).toHaveClass("hidden"),this.component.select("connectOtherSelector").click(),expect(this.component.select("otherServicesSelector")).not.toHaveClass("hidden"),this.component.select("connectOtherSelector").click(),expect(this.component.select("otherServicesSelector")).toHaveClass("hidden")}),it("should scribe open/close actions",function(){setupComponent(a+'<div class="flex-module import-prompt">'+c+"</div>"),spyOnEvent(this.$node,"uiWTFImportPromptToggle"),this.component.select("connectOtherSelector").click(),expect("uiWTFImportPromptToggle").toHaveBeenTriggeredOnAndWith(this.$node,{action:"open"}),this.component.select("connectOtherSelector").click(),expect("uiWTFImportPromptToggle").toHaveBeenTriggeredOnAndWith(this.$node,{action:"close"})})})})
});
define("test/app/ui/who_to_follow/web_personalized_signup_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/who_to_follow/web_personalized_signup",function(){beforeEach(function(){var a='<div>\n        <div class="flex-module js-web-personalization-signup">\n          <form action="{{signup_path}}" class="clearfix signup" method="post">\n            <div class="holding name">\n              <input type="text" autocomplete="off" name="user[name]" maxlength="20">\n              <span class="holder">{{_i}}Full name{{/i}}</span>\n            </div>\n            <div class="holding email">\n              <input class="email-input" type="text" autocomplete="off" name="user[email]">\n              <span class="holder">{{_i}}Email{{/i}}</span>\n            </div>\n            <div class="holding password">\n              <input type="password" name="user[user_password]">\n              <span class="holder">{{_i}}Password{{/i}}</span>\n            </div>\n            <input type="button" class="btn signup-btn js-submit js-signup-btn" value="{{_i}}Sign up{{/i}}">\n          </form>\n        </div>\n      </div>\n     ';setupComponent(a,{loggedIn:!1})}),it("should handle submit button clicks",function(){spyOnEvent(document,"uiScribeSignupForm"),this.component.select("signupBtnSelector").click(),expect("uiScribeSignupForm").toHaveBeenTriggeredOn(this.component)}),it("should show the component on uiAllowWebPersonalization",function(){this.component.trigger("uiAllowWebPersonalization"),expect(this.component.$node.hasClass("visible")).toBeTruthy()}),it("should hide the component on uiTurnoffWebPersonalization",function(){this.component.trigger("uiTurnoffWebPersonalization"),expect(this.component.$node.hasClass("visible")).toBeFalsy()})})
});
define("test/app/ui/who_to_follow/find_friends_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/who_to_follow/find_friends",function(){var a='<div>\n     <div class="test-body">\n       <div class="find-friends-container" data-screen-name="{{username}}">\n         <div class="matches">\n          <a href="javascript:;" class="skip-link">Skip</a>\n         </div>\n       </div>\n     </div>\n   </div>\n  ';beforeEach(function(){setupComponent(a,{spinnerContainer:".test-body"})}),it("triggers uiWantsInviteModule event when invite link is clicked",function(){spyOnEvent(this.$node,"uiWantsInviteModule"),this.component.select("inviteLinkSelector").click(),expect("uiWantsInviteModule").toHaveBeenTriggeredOn(this.$node)}),describe("module steps",function(){it("shows invite module on dataInviteModuleSuccess event",function(){expect(this.$node.find(".invite-module")).not.toExist(),this.component.trigger("dataInviteModuleSuccess",{html:'<div class="invite-module"></div>'}),expect(this.$node.find(".invite-module")).toExist()}),it("shows who to tweet module on dataWhoToTweetModuleSuccess event",function(){expect(this.$node.find(".who-to-tweet")).not.toExist(),this.component.trigger("dataWhoToTweetModuleSuccess",{html:'<div class="who-to-tweet"></div>'}),expect(this.$node.find(".who-to-tweet")).toExist()})}),describe("loading indicator/spinner",function(){it("shows spinner when modules are being retrieved",function(){var a=this.component.select("spinnerContainer");expect(a).not.toHaveClass("pushing-state"),$(document).trigger("uiWantsContactImportMatches"),expect(a).toHaveClass("pushing-state"),a.removeClass("pushing-state"),$(document).trigger("uiWantsInviteModule"),expect(a).toHaveClass("pushing-state"),a.removeClass("pushing-state"),$(document).trigger("uiWantsWhoToTweetModule",{screen_name:"askmommachow"}),expect(a).toHaveClass("pushing-state")}),it("hides spinner when modules succeed or fail to be retrieved",function(){var a=this.component.select("spinnerContainer");a.addClass("pushing-state"),$(document).trigger("dataContactImportMatchesSuccess"),expect(a).not.toHaveClass("pushing-state"),a.addClass("pushing-state"),$(document).trigger("dataInviteModuleSuccess",{html:""}),expect(a).not.toHaveClass("pushing-state"),a.addClass("pushing-state"),$(document).trigger("dataInviteModuleFailure"),expect(a).not.toHaveClass("pushing-state"),a.addClass("pushing-state"),$(document).trigger("dataWhoToTweetModuleSuccess",{screen_name:"askmommachow"}),expect(a).not.toHaveClass("pushing-state"),a.addClass("pushing-state"),$(document).trigger("dataWhoToTweetModuleFailure",{screen_name:"askmommachow"}),expect(a).not.toHaveClass("pushing-state")})})})
});
define("test/app/ui/who_to_follow/matched_contacts_list_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/who_to_follow/matched_contacts_list",function(){var a='<div class="js-stream-item stream-item">\n      <label class="listview-find-friends-result" data-user-id="504" id="listitem4">\n        <input type="checkbox" id="check4" class="js-action-checkbox">\n      </label>\n    </div>\n  ';beforeEach(function(){var a='<div>\n        <input type="checkbox" id="select_all_matches" value="50" checked>\n        <button class="js-follow-all">Follow <span class="js-follow-count">12</span> selected</button>\n        <div class="js-stream-item stream-item">\n          <label class="listview-find-friends-result" data-user-id="501" id="listitem1">\n            <input type="checkbox" id="check1" class="js-action-checkbox">\n          </label>\n        </div>\n        <div class="js-stream-item stream-item">\n          <label class="listview-find-friends-result" data-user-id="502" id="listitem2">\n            <input type="checkbox" id="check2" class="js-action-checkbox">\n          </label>\n        </div>\n        <div class="js-stream-item stream-item">\n          <label class="listview-find-friends-result" data-user-id="503" id="listitem3">\n            <input type="checkbox" id="check3" class="js-action-checkbox">\n          </label>\n        </div>\n      </div>\n    ';setupComponent(a),this.component.trigger("uiSwiftLoaded")}),describe("selected classes",function(){it("selects and checks rows on startup",function(){var a=this.$node.find("#listitem1");expect(a).toHaveClass("selected");var b=this.$node.find("#check1");expect(b).toBe(":checked")}),it("removes and adds the selected class from a row",function(){var a=this.$node.find("#listitem1");expect(a).toHaveClass("selected"),this.$node.find("#check1").click(),expect(a).not.toHaveClass("selected"),this.$node.find("#check1").click(),expect(a).toHaveClass("selected")})}),describe("follow all text",function(){it("uses the full count when select all is selected",function(){this.component.trigger("uiListSelectionChanged"),expect(this.$node.find(".js-follow-all")).toHaveText("Follow 50 selected")}),it("subtracts the checkboxes when select all is not selected",function(){this.$node.find("#check1").click(),this.$node.find("#check2").click(),expect(this.$node.find(".js-follow-all")).toHaveText("Follow 48 selected")}),it("uses the available checkboxes if select all has been specifically de-selected",function(){this.$node.find("#select_all_matches").click(),this.$node.find("#check1").click(),this.$node.find("#check2").click(),expect(this.$node.find(".js-follow-all")).toHaveText("Follow 2 selected")}),it("uses the full count if all available checkboxes have been re-checked",function(){this.$node.find("#select_all_matches").click(),this.$node.find("#check1").click(),this.$node.find("#check2").click(),this.$node.find("#check3").click(),expect(this.$node.find(".js-follow-all")).toHaveText("Follow 50 selected")}),it("disables the follow button when there is no one selected",function(){this.$node.find("#select_all_matches").click();var a=this.$node.find(".js-follow-all");expect(a).toHaveText("Follow 0 selected"),expect(a).toBeDisabled()})}),describe("follow all behavior",function(){beforeEach(function(){spyOnEvent(this.$node,"uiContactImportFollow")}),it("sends an excluding follow request when invisibles are checked",function(){this.$node.find("#check2").click(),this.$node.find(".js-follow-all").click(),expect("uiContactImportFollow").toHaveBeenTriggeredOnAndWith(this.$node,{excludeIds:[502],includeIds:[]})}),it("sends an including follow request when invisibles are unchecked",function(){this.$node.find("#select_all_matches").click(),this.$node.find("#check1").click(),this.$node.find("#check3").click(),this.$node.find(".js-follow-all").click(),expect("uiContactImportFollow").toHaveBeenTriggeredOnAndWith(this.$node,{excludeIds:[],includeIds:[501,503]})}),it("marks itself as loading on click",function(){var a=this.$node.find(".js-follow-all");a.click(),expect(a).toHaveClass("loading"),expect(a).toBeDisabled()}),it("unmarks the loading and shows a message when there is an error",function(){spyOnEvent(this.$node,"uiShowError");var a=this.$node.find(".js-follow-all").addClass("loading").attr("disabled",!0);this.$node.trigger("dataContactImportFollowFailure"),expect(a).not.toHaveClass("loading"),expect(a).not.toBeDisabled(),expect("uiShowError").toHaveBeenTriggeredOnAndWith(this.$node,{message:"There was an error following your contacts."})})}),describe("loading more results",function(){it("adds selected and checking if invisibles are checked",function(){var b=$(a).appendTo(this.$node);b.trigger("uiHasInjectedTimelineItem"),expect(b.find(".listview-find-friends-result")).toHaveClass("selected"),expect(b.find("input")).toBe(":checked")}),it("does not add selected and checking if invisibles are unchecked",function(){this.$node.find("#select_all_matches").click();var b=$(a).appendTo(this.$node);b.trigger("uiHasInjectedTimelineItem"),expect(b.find(".listview-find-friends-result")).not.toHaveClass("selected"),expect(b.find("input")).not.toBe(":checked")})})})
});
define("test/app/ui/who_to_follow/import_services_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/who_to_follow/import_services",function(){beforeEach(function(){setupComponent("<div>"),jasmine.Clock.useMock()}),describe("after the import is done",function(){beforeEach(function(){spyOnEvent(this.$node,"uiOpenImportLoadingDialog"),this.component.trigger("uiOauthImportSuccess")}),it("opens a dialog",function(){expect("uiOpenImportLoadingDialog").toHaveBeenTriggeredOn(this.$node)}),it("starts polling",function(){spyOnEvent(this.$node,"uiWantsContactImportStatus"),expect("uiWantsContactImportStatus").not.toHaveBeenTriggeredOn(this.$node),jasmine.Clock.tick(3e3),expect("uiWantsContactImportStatus").toHaveBeenTriggeredOn(this.$node)})}),describe("when stopPolling is called",function(){beforeEach(function(){spyOnEvent(this.$node,"uiCloseDialog"),this.component.startPolling(),jasmine.Clock.tick(3e3),spyOnEvent(this.$node,"uiWantsContactImportStatus"),this.component.stopPolling()}),it("stops the interval",function(){jasmine.Clock.tick(3e3),expect("uiWantsContactImportStatus").not.toHaveBeenTriggeredOn(this.$node)}),it("closes the dialog",function(){expect("uiCloseDialog").toHaveBeenTriggeredOn(this.$node)})}),describe("when the dialog is closed",function(){beforeEach(function(){spyOn(this.component,"stopPolling"),this.$node.trigger("uiImportLoadingDialogCancelled")}),it("stops polling",function(){expect(this.component.stopPolling).toHaveBeenCalled()})}),describe("when the contacts have loaded",function(){beforeEach(function(){spyOnEvent(this.$node,"uiNavigate"),spyOn(this.component,"stopPolling"),this.$node.trigger("dataContactImportStatusSuccess",{done:!0})}),it("stops polling",function(){expect(this.component.stopPolling).toHaveBeenCalled()}),it("redirects to the matches page",function(){expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,{href:"/who_to_follow/matches"})})}),describe("when the contacts have errored",function(){beforeEach(function(){spyOnEvent(this.$node,"uiShowError"),spyOn(this.component,"stopPolling"),this.$node.trigger("dataContactImportStatusSuccess",{done:!0,error:!0,message:"Oops"})}),it("stops polling",function(){expect(this.component.stopPolling).toHaveBeenCalled()}),it("shows an error",function(){expect("uiShowError").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Oops"})})}),describe("after 60 seconds",function(){beforeEach(function(){spyOn(this.component,"stopPolling"),spyOnEvent(this.$node,"uiShowError"),this.component.startPolling(),jasmine.Clock.tick(6e4)}),it("stops polling",function(){expect(this.component.stopPolling).toHaveBeenCalled()}),it("reports a timeout",function(){expect("uiShowError").toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/who_to_follow/invite_form_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/who_to_follow/invite_form",function(){var a='<form class="invite-friends" action="javascript:void(0)" method="GET">\n      <textarea name="addresses"></textarea>\n      <button type="submit" class="btn js-submit">Invite friends</button>\n    </form>\n  ';beforeEach(function(){setupComponent(a)}),it("triggers an event with normal email addresses",function(){spyOnEvent(this.$node,"uiInviteContacts"),this.component.select("addressesFieldSelector").val("katniss@district13.org, effie@thehungergames.com"),this.$node.find(".js-submit").submit(),expect("uiInviteContacts").toHaveBeenTriggeredOnAndWith(this.$node,{contacts:[{email:"katniss@district13.org"},{email:"effie@thehungergames.com"}]})}),it("treats endlines as separators",function(){spyOnEvent(this.$node,"uiInviteContacts"),this.component.select("addressesFieldSelector").val("katniss@district13.org\neffie@thehungergames.com\n\n zombo@zombo.com"),this.$node.find(".js-submit").submit(),expect("uiInviteContacts").toHaveBeenTriggeredOnAndWith(this.$node,{contacts:[{email:"katniss@district13.org"},{email:"effie@thehungergames.com"},{email:"zombo@zombo.com"}]})}),it("lets the backend deal with real names",function(){spyOnEvent(this.$node,"uiInviteContacts"),this.component.select("addressesFieldSelector").val('"Katniss Everdeen" <katniss@district13.org>, "Effie Trinket" <effie@thehungergames.com>'),this.$node.submit(),expect("uiInviteContacts").toHaveBeenTriggeredOnAndWith(this.$node,{contacts:[{email:'"Katniss Everdeen" <katniss@district13.org>, "Effie Trinket" <effie@thehungergames.com>'}]})}),it("triggers an error if an address is malformed",function(){spyOnEvent(this.$node,"uiShowError"),this.component.select("addressesFieldSelector").val("peeta"),this.$node.submit(),expect("uiShowError").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Please check the address you entered."})}),it("clears the text area on successful invite",function(){var a=this.component.select("addressesFieldSelector");a.val("katniss@district13.org"),this.$node.trigger("uiInviteFinished"),expect(a).toHaveValue("")}),it("adds expanded class when typing a comma",function(){var a=this.component.select("addressesFieldSelector");expect(a).not.toHaveClass("expanded"),a.val("katniss@district13.org,"),a.trigger("keyup"),expect(a).toHaveClass("expanded")})})
});
define("test/app/ui/promptbird/with_invite_contacts",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/promptbird/with_invite_contacts",function(){beforeEach(function(){var a='<div class="promptbird promptbird-dashboard-narrow" data-prompt-id="80">\n  <div class="prompt-wrapper invite-contacts">\n    <a class="dismiss js-dismiss" href="#" tabindex="-1"><i class="dismiss-white"></i></a>\n    <div class="prompt-content-wrapper">\n      <h2>Share Twitter with friends</h2>\n      <p>you previously imported your address book. Select contacts to invite.</p>\n      <div class="prompt-action-wrapper">\n        <span href="#" class="invite-contacts-button btn call-to-action">Invite friends</span>\n      </div>\n    </div>\n  </div>\n</div>\n    ';setupComponent(a)}),it("triggers uiPromptbirdShowInviteContactsDialog",function(){spyOnEvent(this.$node,"uiPromptbirdShowInviteContactsDialog"),this.component.select("inviteContactsSelector").click(),expect("uiPromptbirdShowInviteContactsDialog").toHaveBeenTriggeredOn(this.component)})})
});
define("test/app/ui/promptbird/with_invite_contacts_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/promptbird/with_invite_contacts",function(){beforeEach(function(){var a='<div class="promptbird promptbird-below-black-bar" data-prompt-id="223">\n\n  <div class="prompt-wrapper invite_contacts_prompt">\n  <a class="dismiss js-dismiss" href="#" tabindex="-1"><i class="close"></i></a>\n\n  <div class="prompt-content-wrapper ">\n    <h2>Share Twitter with friends</h2>\n\n    <p class="prompt-explanation">\n      You previously imported your address book. Select contacts to invite.\n    </p>\n\n    <div class="prompt-action-wrapper">\n      <a class="btn primary-btn call-to-action" href="#">\n        Invite friends\n      </a>\n    </div>\n  </div>\n</div>\n\n    ';setupComponent(a)}),it("triggers uiPromptbirdShowInviteContactsDialog",function(){spyOnEvent(this.$node,"uiPromptbirdShowInviteContactsDialog"),this.component.select("inviteContactsSelector").click(),expect("uiPromptbirdShowInviteContactsDialog").toHaveBeenTriggeredOn(this.component)})})
});
define("test/app/ui/dialogs/list_membership_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/list_membership_dialog",function(){var a="12",b="8";beforeEach(function(){var a='<div>\n        <div id=\'list-membership-dialog\'>\n          <div class=\'list-membership-content\'>\n            <ul class="list-membership-container" data-user-id="12">\n              <li data-list-id="8">\n                <img class="loading-spinner">\n                <input id="list_8" data-is-checked="true" checked="checked">\n              </li>\n              <li class="btn create-a-list">Create a list</li>\n            </ul>\n          </div>\n          <span class=\'lists-spinner\' title=\'{{_i}}Loading...{{/i}}\'></span>\n        </div>\n      </div>\n    ';setupComponent(a),this.$checkbox=$("#list_8"),this.$membership=this.$checkbox.closest(this.component.attr.membershipSelector),this.$spinner=this.$membership.find(this.component.attr.membershipSpinnerSelector)}),describe("trigger the dialog to open",function(){beforeEach(function(){spyOn(this.component,"open"),spyOnEvent(this.$node,"uiNeedsListMembershipContent"),this.component.trigger("uiOpenListMembershipDialog",{userId:a})}),it("calls open",function(){expect(this.component.open).toHaveBeenCalled()}),it("empties the current content",function(){expect(this.component.select("contentSelector")).toBeEmpty()}),it("triggers uiNeedsListMembershipContent",function(){expect("uiNeedsListMembershipContent").toHaveBeenTriggeredOnAndWith(this.$node,{userId:a})})}),describe("click on create list button",function(){beforeEach(function(){spyOn(this.component,"close"),spyOnEvent(this.$node,"uiOpenCreateListDialog"),this.component.userId=a,this.component.select("createListSelector").click()}),it("calls close",function(){expect(this.component.close).toHaveBeenCalled()}),it("opens the create list dialog",function(){expect("uiOpenCreateListDialog").toHaveBeenTriggeredOnAndWith(this.$node,{userId:a})})}),describe("click on a list",function(){beforeEach(function(){spyOnEvent(this.$node,"uiAddUserToList"),spyOnEvent(this.$node,"uiRemoveUserFromList")}),describe("when a pending request is in progress",function(){beforeEach(function(){this.$checkbox.hide(),this.$membership.click()}),it("does not trigger either uiAddUserToList or uiRemoveUserFromList",function(){expect("uiAddUserToList").not.toHaveBeenTriggeredOn(this.$node),expect("uiAddRemoveFromList").not.toHaveBeenTriggeredOn(this.$node)})}),describe("when the checkbox is checked",function(){beforeEach(function(){this.$checkbox.attr("checked","checked"),this.$checkbox.data("is-checked",!0),this.$checkbox.click()}),it("triggers uiRemoveUserFromList",function(){expect("uiRemoveUserFromList").toHaveBeenTriggeredOnAndWith(this.$node,{userId:a,listId:b})})}),describe("when the checkbox is unchecked",function(){beforeEach(function(){this.$checkbox.attr("checked",null),this.$checkbox.data("is-checked",!1),this.$checkbox.click()}),it("triggers uiAddUserToList",function(){expect("uiAddUserToList").toHaveBeenTriggeredOnAndWith(this.$node,{userId:a,listId:b})})})}),describe("event dataGotListMembershipContent",function(){beforeEach(function(){this.component.trigger("dataGotListMembershipContent",{html:"content"})}),it("adds the content",function(){expect(this.component.select("contentSelector")).toHaveText("content")}),it("hides the spinner",function(){expect(this.component.select("spinnerSelector")).not.toBeVisible()})}),describe("event dataFailedToGetListMembershipContent",function(){beforeEach(function(){spyOn(this.component,"close"),spyOnEvent(this.$node,"uiShowError"),this.component.trigger("dataFailedToGetListMembershipContent",{message:"error"})}),it("closes the dialog",function(){expect(this.component.close).toHaveBeenCalled()}),it("triggers uiShowError",function(){expect("uiShowError").toHaveBeenTriggeredOnAndWith(this.$node,{message:"error"})})}),describe("data completed events",function(){describe("event dataDidAddUserToList",function(){beforeEach(function(){this.component.trigger("dataDidAddUserToList",{sourceEventData:{listId:"8"}})}),it("hides the membership pending spinner",function(){expect(this.$spinner).not.toBeVisible()}),it("shows the checkbox",function(){expect(this.$checkbox).toBeVisible()}),it("sets the membership checkbox to checked",function(){expect(this.$checkbox).toHaveAttr("checked","checked")}),it("sets data-is-checked=true on the checkbox (to fix jquery event ordering bug)",function(){expect(this.$checkbox).toHaveData("is-checked",!0)})}),describe("event dataDidRemoveUserFromList",function(){beforeEach(function(){this.component.trigger("dataDidRemoveUserFromList",{sourceEventData:{listId:"8"}})}),it("hides the membership pending spinner",function(){expect(this.$spinner).not.toBeVisible()}),it("shows the checkbox",function(){expect(this.$checkbox).toBeVisible()}),it("sets the membership checkbox to unchecked",function(){expect(this.$checkbox).toHaveAttr("checked",null)}),it("sets data-is-checked=false on the checkbox (to fix jquery event ordering bug)",function(){expect(this.$checkbox).toHaveData("is-checked",!1)})}),describe("event dataFailedToAddUserToList",function(){beforeEach(function(){this.component.trigger("dataFailedToAddUserToList",{sourceEventData:{listId:"8"}})}),it("hides the membership pending spinner",function(){expect(this.$spinner).not.toBeVisible()}),it("shows the checkbox",function(){expect(this.$checkbox).toBeVisible()}),it("sets the membership checkbox to unchecked",function(){expect(this.$checkbox).toHaveAttr("checked",null)}),it("sets data-is-checked=false on the checkbox (to fix jquery event ordering bug)",function(){expect(this.$checkbox).toHaveData("is-checked",!1)})}),describe("event dataFailedToRemoveUserFromList",function(){beforeEach(function(){this.component.trigger("dataFailedToRemoveUserFromList",{sourceEventData:{listId:"8"}})}),it("hides the membership pending spinner",function(){expect(this.$spinner).not.toBeVisible()}),it("shows the checkbox",function(){expect(this.$checkbox).toBeVisible()}),it("sets the membership checkbox to checked",function(){expect(this.$checkbox).toHaveAttr("checked","checked")}),it("sets data-is-checked=true on the checkbox (to fix jquery event ordering bug)",function(){expect(this.$checkbox).toHaveData("is-checked",!0)})})})})
});
define("test/app/ui/dialogs/share_via_email_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/share_via_email_dialog",function(){var a='<div id="share-via-email-dialog" style="display: none;" class="modal-container">\n      <div class="modal draggable">\n        <div class="modal-content">\n          <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n          <div class="modal-header"></div>\n          <div class="modal-body modal-tweet"></div>\n          <div class="modal-footer"></div>\n        </div>\n      </div>\n    </div>\n  ',b='<div id="stream-item-1" class="selected-stream-item" tabindex="-1">\n    <div class="tweet">\n      <a id="share-via-email-link" class="js-share-via-email" href="#" data-nav="share_tweet">Share via email</a>\n    </div>\n  </div>\n  ';describe("When the dialog is open",function(){it('restores focus to the Tweet if the "Share via email" menuitem had focus prior to the opening of the Dialog',function(){setupComponent(a),$("#fixture_parent").append(b);var c=$(".tweet");spyOnEvent(c,"uiShouldAddFocusStyle");var d=$("#share-via-email-link");d.focus(),this.component.open(),this.component.close(),expect(d).toBeFocused(),expect("uiShouldAddFocusStyle").toHaveBeenTriggeredOn(c)})})})
});
define("test/app/ui/dialogs/sensitive_flag_confirmation_spec",["module","require","exports"],function(module, require, exports) {
"use script",describeComponent("app/ui/dialogs/sensitive_flag_confirmation",function(){beforeEach(function(){var a='<div>\n        <div id="sensitive_flag_dialog" style="display: none;" class="modal-container">\n          <div class="modal modal-small draggable">\n            <div class="modal-content">\n              <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n              <div class="modal-header">\n                <h3 class="modal-title">{{_i}}Flag this media{{/i}}</h3>\n              </div>\n              <div class="modal-body">\n                <input class="checkbox" type="checkbox" id="sensitive-settings-checkbox" value="settings"/>\n                <input class="checkbox" type="checkbox" id="sensitive-illegal-checkbox" value="illegal"/>\n              </div>\n              <div class="modal-footer">\n                <button id="submit_flag_confirmation" type="button" class="btn">{{_i}}Submit{{/i}}</button>\n                <button id="cancel_flag_confirmation" type="button" class="btn primary-btn">{{_i}}Cancel{{/i}}</button>\n              </div>\n            </div>\n          </div>\n          <div class="modal-overlay"></div>\n        </div>\n      <div>\n    ';setupComponent(a),this.component.trigger("uiFlagConfirmation",{id:"123"})}),it("opens on uiFlagConfirmation",function(){expect(this.component.$dialog).toBeVisible()}),it("closes on cancel click",function(){this.component.select("cancelSelector").click(),expect(this.component.$dialog).toBeHidden()}),it("repopulates data-tweet-id on each subsequent dialog open",function(){expect(this.component.$dialog).toHaveAttr("data-tweet-id","123"),this.component.close(),this.component.trigger("uiFlagConfirmation",{id:"abc"}),expect(this.component.$dialog).toHaveAttr("data-tweet-id","abc")}),it("calls uiFlagMedia on illegal being checked",function(){spyOnEvent(document,"uiFlagMedia"),this.component.select("illegalSelector").click(),this.component.select("submitSelector").click(),expect("uiFlagMedia").toHaveBeenTriggeredOnAndWith(document,{id:"123"})}),it("calls uiUpdateViewPossiblySensitive on settings being checked",function(){spyOnEvent(document,"uiUpdateViewPossiblySensitive"),this.component.select("settingsSelector").click(),this.component.select("submitSelector").click(),expect("uiUpdateViewPossiblySensitive").toHaveBeenTriggeredOnAndWith(document,{do_show:!1})})})
});
define("test/app/ui/dialogs/signin_or_signup_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/signin_or_signup",function(){beforeEach(function(){var a='<div>\n        <div id="signin-or-signup" class="modal-container" style="display: none;">\n          <h3 class="modal-title modal-long-title signup-only">{{_i}}Sign up for Twitter &amp; follow @<span>{{screen_name}}</span>{{/i}}</h3>\n        </div>\n      </div>\n    ';setupComponent(a)}),it("if attached with signUpOnly=false, the dialog has the class not-signup-only",function(){this.$dialog=this.component.select("dialogSelector"),this.$node.trigger("uiOpenSigninOrSignupDialog",{signUpOnly:!1}),expect(this.$dialog).toHaveClass("not-signup-only"),expect(this.$dialog).not.toHaveClass("signup-only")}),it("if opened with signUpOnly=true, the dialog has the class signup-only",function(){this.$dialog=this.component.select("dialogSelector"),this.$node.trigger("uiOpenSigninOrSignupDialog",{signUpOnly:!0}),expect(this.$dialog).toHaveClass("signup-only"),expect(this.$dialog).not.toHaveClass("not-signup-only")}),it("if opened with signUpOnly=true and screenName set, the dialog title lists that screen name",function(){this.$dialog=this.component.select("dialogSelector"),this.$node.trigger("uiOpenSigninOrSignupDialog",{signUpOnly:!0,screenName:"larry"}),expect(this.$dialog).toHaveClass("signup-only"),expect(this.$dialog).not.toHaveClass("not-signup-only"),expect(this.component.select("signupOnlyScreenNameSelector")).toHaveText("larry")})})
});
define("test/app/ui/dialogs/list_operations_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/list_operations_dialog",function(){var a="12",b={name:"name",description:"description",mode:"private"};beforeEach(function(){var a="<div>\n        <div class='list-editor'>\n          <input type='text' name='name' value='name'>\n          <textarea name='description'>description</textarea>\n          <input type='radio' name='mode' value='public'>\n          <input type='radio' name='mode' value='private' checked='checked'>\n          <button type=\"button\" class=\"btn btn-primary update-list-button\" data-list-id=\"{{id}}\" disabled>Save list</button>\n        </div>\n      </div>\n    ";setupComponent(a,{screenName:"jack",win:{location:""},list_id:40,is_public:!0})}),describe("typing in name input",function(){it("enables the submit button when name input has content",function(){this.component.$nameInput.val("content"),this.component.$nameInput.trigger("keyup"),expect(this.component.$saveButton).not.toBeDisabled()}),it("disables the submit button when name input has no content",function(){this.component.$nameInput.val(""),this.component.$nameInput.trigger("keyup"),expect(this.component.$saveButton).toBeDisabled()})}),describe("click on create list button",function(){beforeEach(function(){spyOnEvent(this.$node,"uiCreateList")}),it("does not call uiCreateList if a request is in progress",function(){this.component.requestInProgress=!0,this.component.$saveButton.click(),expect("uiCreateList").not.toHaveBeenTriggeredOn(this.$node)}),it("calls uiCreateList with the contents of the form",function(){this.component.$saveButton.click(),expect("uiCreateList").toHaveBeenTriggeredOnAndWith(this.$node,b)})}),describe("event dataDidCreateList",function(){beforeEach(function(){spyOn(this.component,"close"),spyOnEvent(this.$node,"uiOpenListMembershipDialog"),spyOnEvent(this.$node,"uiShowMessage"),this.component.userId=a,this.component.trigger("dataDidCreateList")}),it("closes the dialog",function(){expect(this.component.close).toHaveBeenCalled()}),it("triggers uiOpenListMembershipDialog",function(){expect("uiOpenListMembershipDialog").toHaveBeenTriggeredOnAndWith(this.$node,{userId:a})}),it("clears the form fields",function(){expect(this.component.$nameInput).toHaveValue(""),expect(this.$node.find("textarea")).toHaveValue("")}),it("sets createInProgress to false",function(){expect(this.component.createInProgress).toBeFalsy()}),it("displays the message returned from the server",function(){expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(this.$node,{message:"List created!"})})}),describe("event dataDidCreateList without a userId",function(){beforeEach(function(){spyOn(this.component,"close"),this.component.trigger("dataDidCreateList",{slug:"slug"})}),it("redirects to the list page",function(){delete this.component.userId,expect(this.component.attr.win.location).toBe("/jack/lists/slug")})}),describe("event dataFailedToCreateList",function(){beforeEach(function(){this.component.$saveButton.attr("disabled",!0),this.component.trigger("dataFailedToCreateList",{message:"error"})}),it("sets createInProgress to false",function(){expect(this.component.createInProgress).toBeFalsy()}),it("re-enables the create list button",function(){expect(this.component.$saveButton).not.toBeDisabled()})}),describe("event uiPageChanged",function(){it("has a default state",function(){expect(this.component.listId).toBe(40),expect(this.component.isPublic).toBe(!0)}),it("updates list state",function(){this.component.trigger("uiPageChanged",{init_data:{list_id:20,is_public:!1}}),expect(this.component.listId).toBe(20),expect(this.component.isPublic).toBe(!1)})})})
});
define("test/app/ui/dialogs/in_product_help_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/in_product_help_dialog",function(){function b(){$("#profile_image_help").click()}var a='<div id="in_product_help_dialog" style="display: none;" class="modal-container modal-in-product-help">\n      <div class="close-modal-background-target"></div>\n      <div class="modal modal-small draggable">\n        <div class="modal-content">\n          <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n          <div class="modal-header">\n            <h3 class="modal-title">Upload a profile image</h3>\n          </div>\n          <div class="modal-body">\n            <p>How to upload or change your profile picture:</p>\n            <ol>\n              <li>Click the <em>Choose file</em> button.</li>\n              <li><em>Select a file</em> to upload as your picture. It must be smaller than 700k and in JPG, GIF, or PNG format (no animated GIFs).</li>\n              <li>Click <em>Save changes</em> at the bottom of the page to see a thumbnail.</li>\n            </ol>\n          </div>\n          <div class="modal-footer">\n            <span class="satisfaction-prompt">\n              <span id="satisfaction_question">Was this helpful?</span>\n              <span id="satisfaction_feedback">Thanks for the feedback!</span>\n            </span>\n            <div id="satisfaction_buttons">\n              <button id="helpful_button" class="btn">{{_i}}Yes{{/i}}</button>\n              <button id="not_helpful_button" class="btn">{{_i}}No{{/i}}</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ';describe('the link when "Learn more" href is #',function(){beforeEach(function(){$("body").append($('<a id="profile_image_help" href="#">Learn more</a>')),setupComponent(a)}),afterEach(function(){$("#profile_image_help").remove()}),it("opens the dialog when clicking on the inProductHelpSelector",function(){spyOn(this.component,"open"),b(),expect(this.component.open).toHaveBeenCalled()}),it("tracks a dialog impression",function(){b(),expect(this.component).toScribe({component:"profile_image",element:"learn_more_dialog",action:"impression"})}),describe("the helpful/unhelpful buttons",function(){it('calls voteHelpful(true) when "helpful" is clicked',function(){spyOn(this.component,"voteHelpful"),b(),this.component.select("helpfulSelector").click(),expect(this.component.voteHelpful).toHaveBeenCalledWith(!0)}),it('tracks a helpful action when "helpful" is clicked',function(){b(),this.component.select("helpfulSelector").click(),expect(this.component).toScribe({component:"profile_image",element:"learn_more_dialog",action:"helpful"})}),it('called voteHelpful(false) when "not helpful" is clicked',function(){spyOn(this.component,"voteHelpful"),b(),this.component.select("notHelpfulSelector").click(),expect(this.component.voteHelpful).toHaveBeenCalledWith(!1)}),it('tracks a unhelpful action when "not helpful" is clicked',function(){b(),this.component.select("notHelpfulSelector").click(),expect(this.component).toScribe({component:"profile_image",element:"learn_more_dialog",action:"unhelpful"})}),it("set focus within the dialog",function(){b(),this.component.select("notHelpfulSelector").click(),expect($("#helpful_button")).toBeFocused()})})}),describe('the link when "Learn more" href is a Support link',function(){beforeEach(function(){$("body").append($('<a id="profile_image_help" href="https://support.twitter.com">Learn more</a>')),setupComponent(a)}),afterEach(function(){$("#profile_image_help").remove()}),it("doesn't open the dialog when clicking on the inProductHelpSelector",function(){spyOn(this.component,"open"),b(),expect(this.component.open).not.toHaveBeenCalled()}),it("tracks a link click",function(){b(),expect(this.component).toScribe({component:"profile_image",element:"learn_more_link",action:"click"})})})})
});
define("test/app/ui/dialogs/profile_image_upload_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponentWithDataComponents("app/ui/dialogs/profile_image_upload_dialog",["app/data/settings/profile_image_upload_scribe"],function(){var a='<div id="profile_image_upload_dialog" style="display: none;" class="modal-container image-upload-dialog">\n      <div class="close-modal-background-target"></div>\n      <div class="modal draggable profile-avatar-modal" style="top: 50px!important">\n        <div class="modal-content">\n          <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n          <div class="modal-header"><h3 class="modal-title">Upload a profile image</h3></div>\n          <div class="modal-body">\n            <div class="alert profile-image-alert message" style="display: none;">\n              <div>\n                <span id="profile-image-alert-message"></span>\n                <a class="dismiss" href="#">&times;</a>\n              </div>\n            </div>\n            <div class="upload-frame image-upload-webcam" style="display: none">\n              <div class="webcam-container"></div>\n              <canvas class="webcam-canvas" height="240" width="320" style="display:none"></canvas>\n            </div>\n            <div class="upload-frame clearfix image-upload-crop" style="display: none">\n              <img src="" class="crop-spinner" style="display: none">\n              <div class="crop-zone cropper-avatar-size">\n                <div class="cropper-mask">\n                  <div class="cropper-overlay"></div>\n                  <img class="crop-image" src="">\n                </div>\n                <div class="cropper-slider-outer">\n                  <i class="image-gray"></i>\n                  <div class="cropper-slider"></div>\n                  <i class="image-gray-large"></i>\n                </div>\n              </div>\n            </div>\n            <div style="display: none;"><canvas class="drawsurface"></canvas></div>\n            <div class="upload-frame clearfix image-upload-spinner"></div>\n          </div>\n          <div class="modal-footer">\n            <a href="#" class="btn profile-image-cancel">Cancel</a>\n            <a href="#" class="btn profile-image-previous" style="display: none">Previous</a>\n            <a href="#" class="btn primary-btn disabled profile-image-capture-webcam" style="display: none">Take picture</a>\n            <a href="#" class="btn primary-btn profile-image-save" style="display: none">Save</a>\n          </div>\n        </div>\n      </div>\n    </div>\n  ';beforeEach(function(){setupComponent(a,{uploadType:"avatar",eventData:{scribeContext:{component:"profile_image_upload"}}})}),describe("#open",function(){it("opens the dialog",function(){this.component.close(),expect(this.component.$node.is(":visible")).toBeFalsy(),this.component.open(),expect(this.component.$node.is(":visible")).toBeTruthy()})}),describe("#close",function(){it("scribes a close event",function(){this.component.open(),this.component.close(),expect(this.profileImageUploadScribe).toScribe({component:"profile_image_upload",action:"close"})}),it("scribes a close event when the cancel button is clicked",function(){this.component.open(),this.component.$node.find(this.component.attr.cancelSelector).click(),expect(this.profileImageUploadScribe).toScribe({component:"profile_image_upload",action:"close"})})}),describe("on uiCropImageReady",function(){it("should scribe",function(){spyOn(this.component,"determineCrop").andReturn({}),spyOn(this.component,"clientsideCrop").andReturn({}),spyOnEvent(this.$node,"uiImageSave"),this.component.trigger("uiCropImageReady"),expect("uiImageSave").toHaveBeenTriggeredOn(this.$node),expect(this.profileImageUploadScribe).toScribe({component:"profile_image_upload",element:"crop_upload",action:"complete"})})}),describe("click saveSelector",function(){beforeEach(function(){spyOnEvent(this.$node,"uiImageSave")}),it("does not trigger uiImageSave when there is already a save in progress",function(){this.$node.addClass("saving"),this.component.select("saveSelector").click(),expect("uiImageSave").not.toHaveBeenTriggeredOn(this.$node)})}),describe("click cancelSelector",function(){it("calls #close",function(){spyOn(this.component,"close"),this.component.select("cancelSelector").click(),expect(this.component.close).toHaveBeenCalled()})}),describe("on uiGotProfileImageData",function(){afterEach(function(){$("body").removeClass("show-avatar-options")}),describe("when component uploadType is header",function(){beforeEach(function(){setupComponent(a,{uploadType:"header"}),spyOnEvent(this.component.$node,"uiUploadReceived"),spyOnEvent(this.component.$node,"uiDropped")}),describe("when triggered with header and not wasDropped",function(){it("should trigger uiUploadReceived and not uiDropped",function(){this.component.trigger("uiGotProfileImageData",{uploadType:"header"}),expect("uiUploadReceived").toHaveBeenTriggeredOn(this.component),expect("uiDropped").not.toHaveBeenTriggeredOn(this.component)})}),describe("when triggered with header and wasDropped",function(){it("should trigger uiUploadReceived and uiDropped",function(){this.component.trigger("uiGotProfileImageData",{uploadType:"header",wasDropped:!0}),expect("uiUploadReceived").toHaveBeenTriggeredOn(this.component),expect("uiDropped").toHaveBeenTriggeredOn(this.component)})}),describe("when triggered with header and showing avatar options",function(){it("should not trigger uiUploadReceived or uiDropped",function(){$("body").addClass("show-avatar-options"),this.component.trigger("uiGotProfileImageData",{uploadType:"header",wasDropped:!0}),expect("uiUploadReceived").not.toHaveBeenTriggeredOn(this.component),expect("uiDropped").not.toHaveBeenTriggeredOn(this.component)})}),describe("when triggered with avatar",function(){it("should not trigger uiUploadReceived or uiDropped",function(){this.component.trigger("uiGotProfileImageData",{uploadType:"avatar",wasDropped:!0}),expect("uiUploadReceived").not.toHaveBeenTriggeredOn(this.component),expect("uiDropped").not.toHaveBeenTriggeredOn(this.component)})})}),describe("when component uploadType is avatar",function(){beforeEach(function(){setupComponent(a,{uploadType:"avatar"}),spyOnEvent(this.component.$node,"uiUploadReceived"),spyOnEvent(this.component.$node,"uiDropped")}),describe("when triggered with header and showing avatar options",function(){it("should trigger uiUploadReceived",function(){$("body").addClass("show-avatar-options"),this.component.trigger("uiGotProfileImageData",{uploadType:"header",wasDropped:!0}),expect("uiUploadReceived").toHaveBeenTriggeredOn(this.component),expect("uiDropped").toHaveBeenTriggeredOn(this.component)})})})}),describe("event uiImagePickerFileReady",function(){describe("when uploadType is header",function(){beforeEach(function(){setupComponent(a,{uploadType:"header",eventData:{scribeContext:{component:"header_image_upload"}}}),this.component.trigger("uiImagePickerFileReady",{uploadType:"header"})}),it("scribes a crop upload impression",function(){expect(this.profileImageUploadScribe).toScribe({component:"header_image_upload",element:"crop_upload",action:"impression"})}),it("scribes an upload complete event",function(){expect(this.profileImageUploadScribe).toScribe({component:"header_image_upload",element:"upload",action:"complete"})})}),describe("when uploadType is background",function(){beforeEach(function(){this.component.trigger("uiImagePickerFileReady",{uploadType:"background"})}),it("does not scribe a crop upload impression",function(){expect(this.profileImageUploadScribe).not.toScribe({component:"profile_image_upload",element:"crop_upload",action:"impression"})}),it("does not scribe an upload complete event",function(){expect(this.profileImageUploadScribe).not.toScribe({component:"profile_image_upload",element:"upload",action:"complete"})})})}),describe("#showCropper",function(){beforeEach(function(){this.component.open(),this.component.showCropper("filename")}),it("Uses the original title",function(){expect(this.component.select("titleSelector").text()).toEqual(this.component.attr.originalTitle)}),it("sets focus within the dialog",function(){expect(this.component.$node.find(".profile-image-cancel")).toBeFocused()})}),describe("event uiCropperWebcam",function(){it("scribes a webcam impression",function(){$.fn.webcam=function(a,b){},this.component.trigger("uiCropperWebcam",{uploadType:"avatar"}),expect(this.profileImageUploadScribe).toScribe({component:"profile_image_upload",element:"webcam",action:"impression"})})}),describe("event jsCamCapture",function(){it("scribes a crop impression",function(){this.component.trigger("jsCamCapture"),expect(this.profileImageUploadScribe).toScribe({component:"profile_image_upload",element:"crop_webcam",action:"impression"})})}),describe("event dataImageEnqueued",function(){}),describe("event uiImageUploadSuccess",function(){it("scribes save event",function(){this.component.trigger("uiImageUploadSuccess"),expect(this.profileImageUploadScribe).toScribe({component:"profile_image_upload",element:"save_upload",action:"complete"})}),it("triggers the alert banner",function(){spyOnEvent(this.$node,"uiAlertBanner"),this.component.trigger("uiImageUploadSuccess"),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Your avatar was published successfully."})})});var b=function(a){it("scribes failure event",function(){this.component.trigger(a,{}),expect(this.profileImageUploadScribe).toScribe({component:"profile_image_upload",element:"save_upload",action:"failure"})}),it("triggers the alert banner",function(){spyOnEvent(this.$node,"uiAlertBanner"),this.component.trigger(a,{message:"message"}),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(this.$node,{message:"message"})}),it("calls #close",function(){spyOn(this.component,"close"),this.component.trigger(a,{}),expect(this.component.close).toHaveBeenCalled()})};describe("event uiImageUploadFailure",function(){b("uiImageUploadFailure")}),describe("event dataImageFailedToEnqueue",function(){b("dataImageFailedToEnqueue")})})
});
define("test/app/ui/dialogs/embed_tweet_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/embed_tweet",function(){var a='<div id="embed-tweet-dialog" class="modal-container" style="display:none;">\n        <div class="modal">\n          <form>\n            <div class="embed-destination-wrapper">\n              <div class="embed-overlay embed-overlay-spinner">\n                <div class="embed-overlay-content"></div>\n              </div>\n              <div class="embed-overlay embed-overlay-error">\n                <p class="embed-overlay-content"></p>\n              </div>\n              <textarea class="embed-destination"></textarea>\n              <div class="embed-options">\n                <div class="embed-include-parent-tweet">\n                  <label for="include-parent-tweet">\n                    <input type="checkbox" id="include-parent-tweet" class="include-parent-tweet" checked>\n                    {{_i}}Include parent Tweet{{/i}}\n                  </label>\n                </div>\n                <div class="embed-include-card">\n                  <label for="include-card">\n                    <input type="checkbox" id="include-card" class="include-card" checked>\n                    {{_i}}Include media{{/i}}\n                  </label>\n                </div>\n              </div>\n            </div>\n          </form>\n          <div class="embed-preview">\n            <strong>{{_i}}Preview{{/i}}</strong>\n          </div>\n        </div>\n      </div>\n  ',b='<div id="stream-item-1" class="selected-stream-item" tabindex="-1">\n    <div class="tweet">\n        <a id="embed-tweet-link" class="js-embed-tweet" href="#" data-nav="embed_tweet">Embed Tweet</a>\n    </div>\n  </div>\n  ',c={id_str:"140",text:"@chatty hey hey hey x 40",user:{screen_name:"talkative"}},d="//example.com/embed",e={hasParentTweet:!1,tweetId:"140",screenName:"talkative"},f={hasParentTweet:!0,tweetId:"140",screenName:"talkative"},g={hasCards:!0,tweetId:"140",screenName:"talkative"},h={};beforeEach(function(){window.twttr={ready:function(){}},setupComponent($(a),{}),spyOn(this.component,"getWidgets").andReturn(),spyOn(this.component,"requestTweetEmbed").andReturn(),this.component.setUpDialog(h,e)}),afterEach(function(){window.twttr=undefined}),it("triggers uiNeedsOembed on open",function(){spyOn(this.component,"getOptions").andReturn({tweetId:"123123"}),spyOn(this.component,"tweetId").andReturn("123123"),spyOn(this.component,"selectEmbedCode").andCallThrough(),spyOnEvent(document,"uiNeedsOembed"),this.component.setUpDialog({},e),expect("uiNeedsOembed").toHaveBeenTriggeredOn(document)}),it("clears the embed code field on dataOembedError",function(){var a={tweetId:"123123"};spyOn(this.component,"getOptions").andReturn(a),this.$node.find("textarea").val("foobar"),this.component.failedToReceiveEmbedCode({},a),expect(this.$node.find("textarea").val()).toBe("")}),it("sets this.tweetId to string tweet id",function(){runs(function(){expect(this.component.tweetId()).toEqual(c.id_str)})}),it("focuses on textarea when embed code is updated",function(){spyOn(this.component,"getOptions").andReturn({tweetId:"123123"}),spyOn(this.component,"tweetId").andReturn("123123"),spyOn(this.component,"selectEmbedCode").andCallThrough(),this.component.setUpDialog({},e),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("embedCodeDestinationSelector"),b={tweetId:"123123"};a.blur(),expect(a).not.toBeFocused(),this.component.didReceiveEmbedCode({},{options:b,data:{url:"",html:""}}),expect(this.component.selectEmbedCode).toHaveBeenCalled(),expect(a).toBeFocused()})}),it("triggers uiCopyEtc event when embed code textarea is copied",function(){spyOnEvent(this.component.$node,"uiUserCopiedEmbedCode"),this.component.$embedCodeDestination.trigger("copy"),expect("uiUserCopiedEmbedCode").toHaveBeenTriggeredOn(this.component.$node)}),it("displays spinner on oembed retry",function(){var a={tweetId:"123123"};spyOn(this.component,"getOptions").andReturn(a),spyOn(this.component,"tweetId").andReturn(a.tweetId),this.component.setUpDialog({},e),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var b=this.component.select("spinnerOverlaySelector").show();this.component.retryEmbedCode({},a),expect(b).toBe(":visible")})}),it("displays error message if retry fails",function(){var a=this.component.select("embedCodeDestinationSelector"),b=this.component.select("errorOverlaySelector");b.hide(),spyOn(this.component,"getOptions").andReturn({tweetId:"123123"}),spyOn(this.component,"tweetId").andReturn("123123"),spyOn(this.component,"selectEmbedCode").andCallThrough(),this.component.setUpDialog({},e),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("embedCodeDestinationSelector"),c={tweetId:"123123"};this.component.failedToReceiveEmbedCode({},c),expect(a).toHaveCss("display","none"),expect(b).toHaveCss("display","block")})}),it("displays include parent tweet checkbox if fired with hasParentTweet",function(){setupComponent($(a),{}),spyOn(this.component,"requestTweetEmbed").andReturn(),spyOn(this.component,"getWidgets").andReturn(),this.component.setUpDialog({},f),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("includeParentTweetContainerSelector");expect(a).toHaveCss("display","block")})}),it("hides include parent tweet checkbox if tweet does not have parent",function(){this.component.setUpDialog({},e),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("includeParentTweetContainerSelector");expect(a).toHaveCss("display","none")})}),it("defaults include parent checkbox to checked",function(){this.component.setUpDialog({},e),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("includeParentTweetSelector");expect(a).toBeChecked()})}),it("sets hide_thread to true if checkbox unchecked",function(){this.component.setUpDialog({},f),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("includeParentTweetSelector");a.click();var b=this.component.getOptions();expect(b.data.hide_thread).toEqual(!0)})}),it("sets hide_thread to false if checkbox checked",function(){this.component.setUpDialog({},f),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.getOptions();expect(a.data.hide_thread).toEqual(!1)})}),it("displays show media checkbox if there is a has_cards class on event target",function(){setupComponent($(a),{}),spyOn(this.component,"requestTweetEmbed").andReturn(),spyOn(this.component,"getWidgets").andReturn(),this.component.setUpDialog({target:$('<div class="tweet has-cards"></div>')[0]},g),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("includeCardContainerSelector");expect(a).toHaveCss("display","block")})}),it("hides include media checkbox if the event target does not have has-cards",function(){this.component.setUpDialog({},e),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("includeCardContainerSelector");expect(a).toHaveCss("display","none")})}),it("defaults include media checkbox to checked",function(){this.component.setUpDialog({},g),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("includeCardSelector");expect(a).toBeChecked()})}),it("sets hide_media to true if checkbox unchecked",function(){this.component.setUpDialog({},g),waitsFor(function(){return this.component.$dialog.is(":visible")}),runs(function(){var a=this.component.select("includeCardSelector");a.click();var b=this.component.getOptions();expect(b.data.hide_media).toEqual(!0)})}),it("gets new tweet id from eventData",function(){this.component.setUpDialog({},e),waitsFor(function(){return this.component.$dialog.is(":visible")}),this.component.close(),this.component.setUpDialog({},{tweetId:"141",screenName:"chatty"}),runs(function(){var a=this.component.tweetId();expect(a).toEqual("141")})}),it("resets the include conversation input checkbox",function(){this.component.setUpDialog({},f),waitsFor(function(){return this.component.$dialog.is(":visible")}),this.component.close(),this.component.setUpDialog({},{tweetId:"141",screenName:"chatty",hasParentTweet:!0}),runs(function(){expect(this.component.includeParentTweet()).toEqual(!0)})}),it('restores focus to the Tweet if the "Embed" menuitem had focus prior to the opening of the Dialog',function(){this.component.close(),$("#fixture_parent").append(b);var a=$(".tweet");spyOnEvent(a,"uiShouldAddFocusStyle");var c=$("#embed-tweet-link");c.focus(),this.component.open(),this.component.close(),expect(c).toBeFocused(),expect("uiShouldAddFocusStyle").toHaveBeenTriggeredOn(a)})})
});
define("test/app/ui/dialogs/report_tweet_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/report_tweet",function(){function c(a,c){b={tweetId:"1",userId:"2",screenName:"jack",viewerFollowsAuthor:a,viewerBlocksAuthor:c},$(document).trigger("uiNeedsReportTweetDialog",b)}var a='<div id="report-tweet-dialog" style="display: none;" class="modal-container report-tweet-dialog abuse-dialog abuse-selected already-blocking">\n      <a class="js-close" />\n      <div class="report-form">\n        <input type="radio" value="abusive" name="report_type">\n        <input type="radio" value="something" name="report_type" checked="checked">\n        <input type="checkbox" name="block_user" checked="checked">\n        <span class="block-user-label"></span>\n        <span class="block-user-text"></span>\n        <button class="report-tweet-next-button"></button>\n        <button class="report-tweet-submit-button"></button>\n        <div class="abuse-links">\n          <a href="#" class="report-impersonation-link" data-abuse-type="impersonation" />\n          <a href="#" class="report-trademark-link" />\n          <a href="#" class="report-harassment-link" />\n          <a href="#" class="report-self-harm-link" />\n          <a href="#" class="report-ads-link" />\n        </div>\n      </div>\n      <div class="abuse-form"></div>\n    </div>\n  ',b;beforeEach(function(){setupComponent(a),spyOn(this.Component.prototype,"open").andCallThrough(),spyOn(this.Component.prototype,"close").andCallThrough(),this.submit=function(a,b){b&&this.$node.find("[name=block_user]").click(),this.$node.find("[value="+a+"]").click(),this.$node.find(".report-tweet-"+(a=="abusive"?"next":"submit")+"-button").click()},c(!1,!1)}),describe("when uiNeedsReportTweetDialog",function(){it("removes the abuse-selected class",function(){expect(this.$node).not.toHaveClass("abuse-selected")}),it("removes the abuse-dialog class",function(){expect(this.$node).not.toHaveClass("abuse-dialog")}),it("resets the report types",function(){expect(this.$node.find("[name=report_type]:checked").length).toBe(0)}),it("resets the block option",function(){expect(this.$node.find("[name=block_user]").attr("checked")).toBeFalsy()}),it("disables the submit button",function(){expect(this.$node.find(".report-tweet-submit-button").attr("disabled")).toBe("disabled")}),it("adds/removes the already-blocking class depending on viewerBlocksAuthor",function(){expect(this.$node).not.toHaveClass("already-blocking"),c(!1,!0),expect(this.$node).toHaveClass("already-blocking")}),it("sets the block user label depending on viewerFollowsAuthor",function(){expect(this.$node.find(".block-user-label")).toHaveText("Block @jack"),c(!0,!1),expect(this.$node.find(".block-user-label")).toHaveText("Block and unfollow @jack")}),it("sets the block user text",function(){expect(this.$node.find(".block-user-text")).toHaveText("Blocking will hide @jack's Tweets.")}),it("opens the dialog",function(){expect(this.component.open).toHaveBeenCalled()}),it("sets the abuse links",function(){var a="reported_username=jack&reported_tweet_id=1";expect(this.$node.find(".report-impersonation-link").attr("href")).toContain(a),expect(this.$node.find(".report-trademark-link").attr("href")).toContain(a),expect(this.$node.find(".report-harassment-link").attr("href")).toContain(a),expect(this.$node.find(".report-self-harm-link").attr("href")).toContain(a),expect(this.$node.find(".report-ads-link").attr("href")).toContain(a)})}),describe("when a report type is selected",function(){it("enables the submit button",function(){this.$node.find("[value=something]").click(),expect(this.$node.find(".report-tweet-submit-button").attr("disabled")).toBeFalsy()}),it("does not add the abuse-selected class if abuse is not selected",function(){this.$node.find("[value=something]").click(),expect(this.$node).not.toHaveClass("abuse-selected")}),it("adds the abuse-selected class if abuse is selected",function(){this.$node.find("[value=abusive]").click(),expect(this.$node).toHaveClass("abuse-selected")})}),describe("when the block button is clicked",function(){beforeEach(function(){this.click=function(){this.$node.find("[name=block_user]").click()},this.expectEnabled=function(a){var b=this.$node.find(".report-tweet-submit-button").attr("disabled");a?expect(b).toBeFalsy():expect(b).toBeTruthy()}}),it("enables the submit button if checking on",function(){this.click(),this.expectEnabled(!0)}),it("disables the submit button if checking off and there is no report type",function(){this.click(),this.expectEnabled(!0),this.click(),this.expectEnabled(!1)}),it("does not disable the button if checking off and there is a report type",function(){this.click(),this.expectEnabled(!0),this.$node.find("[value=something]").click(),this.click(),this.expectEnabled(!0)})}),describe("when a report is submitted",function(){beforeEach(function(){spyOnEvent(document,"uiDidReportTweet"),spyOnEvent(document,"uiDidTriggerBlockingAction"),spyOnEvent(document,"uiDidCancelReportTweet"),spyOnEvent(document,"uiDidCancelReportTweetAbusive")}),it("triggers uiDidReportTweet with the report type and blockUser=false when not checked",function(){this.submit("something"),expect("uiDidReportTweet").toHaveBeenTriggeredOnAndWith(document,{tweetData:b,tweetId:"1",userId:"2",screenName:"jack",reportType:"something",blockUser:!1})}),it("triggers uiDidReportTweet with the report type and blockUser=true when checked",function(){this.submit("abusive",!0),expect("uiDidReportTweet").toHaveBeenTriggeredOnAndWith(document,{tweetData:b,tweetId:"1",userId:"2",screenName:"jack",reportType:"abusive",blockUser:!0})}),it("does not trigger uiDidTriggerBlockingAction when block user is not checked",function(){this.submit("something",!1),expect("uiDidTriggerBlockingAction").not.toHaveBeenTriggeredOn(document)}),it("does triggers uiDidTriggerBlockingAction when block user is checked",function(){this.submit("something",!0),expect("uiDidTriggerBlockingAction").toHaveBeenTriggeredOnAndWith(document,{userId:"2"})}),it("closes the dialog if report type is not abusive",function(){this.submit("something"),expect(this.component.close).toHaveBeenCalled()}),it("does not trigger any cancel events when not abusive",function(){this.submit("something"),expect("uiDidCancelReportTweet").not.toHaveBeenTriggeredOn(document),expect("uiDidCancelReportTweetAbusive").not.toHaveBeenTriggeredOn(document)}),it("shows the abuse dialog if abuse is selected",function(){this.submit("abusive"),expect(this.component.close).not.toHaveBeenCalled(),expect(this.$node).toHaveClass("abuse-dialog")}),it("sets focus on the first link if abuse is selected",function(){this.submit("abusive"),expect(this.$node.find(".report-impersonation-link")).toBeFocused()}),it("triggers uiDidShowReportAbusiveTweetDialog if abuse is selected",function(){spyOnEvent(document,"uiDidShowReportAbusiveTweetDialog"),this.submit("abusive"),expect("uiDidShowReportAbusiveTweetDialog").toHaveBeenTriggeredOnAndWith(document,b)}),it("does not trigger any cancel events when abuse is selected",function(){this.submit("abusive"),expect("uiDidCancelReportTweet").not.toHaveBeenTriggeredOn(document),expect("uiDidCancelReportTweetAbusive").not.toHaveBeenTriggeredOn(document)})}),describe("when an abuse link is clicked",function(){it("triggers uiDidReportTweetToSupport",function(){spyOnEvent(document,"uiDidReportTweetToSupport"),this.$node.find(".report-impersonation-link").click(),expect("uiDidReportTweetToSupport").toHaveBeenTriggeredOnAndWith(document,{tweetData:b,abuseType:"impersonation"})}),it("closes the dialog",function(){this.$node.find(".report-impersonation-link").click(),expect(this.component.close).toHaveBeenCalled()}),it("does not trigger any cancel events",function(){spyOnEvent(document,"uiDidCancelReportTweet"),spyOnEvent(document,"uiDidCancelReportTweetAbusive"),this.$node.find(".report-impersonation-link").click(),expect("uiDidCancelReportTweet").not.toHaveBeenTriggeredOn(document),expect("uiDidCancelReportTweetAbusive").not.toHaveBeenTriggeredOn(document)})}),describe("when the dialog is closed",function(){it("triggers uiDidCancelReportTweet",function(){spyOnEvent(document,"uiDidCancelReportTweet"),spyOnEvent(document,"uiDidCancelReportTweetAbusive"),this.$node.find(".js-close").click(),expect("uiDidCancelReportTweet").toHaveBeenTriggeredOnAndWith(document,b),expect("uiDidCancelReportTweetAbusive").not.toHaveBeenTriggeredOn(document)})}),describe("when the abusive dialog is closed",function(){it("triggers uiDidCancelReportTweetAbusive",function(){spyOnEvent(document,"uiDidCancelReportTweet"),spyOnEvent(document,"uiDidCancelReportTweetAbusive"),this.submit("abusive"),this.$node.find(".js-close").click(),expect("uiDidCancelReportTweetAbusive").toHaveBeenTriggeredOnAndWith(document,b),expect("uiDidCancelReportTweet").not.toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/dialogs/profile_confirm_image_delete_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/profile_confirm_image_delete_dialog",function(){beforeEach(function(){var a='<div id="avatar_confirm_remove_dialog" class="modal-container profile-edit-message" style="display:none">\n        <div class="modal">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h3>Remove Photo?</h3>\n            </div>\n            <div class="modal-body">\n              <p class="profile-message">Are you sure you want to remove your profile photo?</p>\n            </div>\n            <div class="modal-footer">\n              <button class="btn primary-btn ok-btn">Remove Photo</button>\n              <button class="btn cancel-btn">Cancel</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ';this.html=a,setupComponent(this.html,{uploadType:"avatar"})}),describe("on uiConfirmDeleteImage",function(){it("opens the dialog when given correct uploadType",function(){spyOn(this.component,"open"),$(document).trigger("uiConfirmDeleteImage",{uploadType:"avatar"}),expect(this.component.open).toHaveBeenCalled()}),it("doesn't open the dialog when given wrong uploadType",function(){spyOn(this.component,"open"),$(document).trigger("uiConfirmDeleteImage",{uploadType:"header"}),expect(this.component.open).not.toHaveBeenCalled()})}),describe("clicking remove",function(){it("triggers uiDeleteImage",function(){setupComponent(this.html,{uploadType:"avatar"}),spyOnEvent(this.component.$node,"uiDeleteImage"),this.component.select("removeSelector").trigger("click");var a={uploadType:"avatar"};expect("uiDeleteImage").toHaveBeenTriggeredOnAndWith(this.component,a)})}),describe("on dataDeleteImageSuccess",function(){it("closes the dialog and triggers uiHideDeleteLink",function(){spyOnEvent(this.$node,"uiDialogClosed"),spyOnEvent(this.$node,"uiDialogOpened"),spyOnEvent(this.$node,"uiHideDeleteLink"),$(document).trigger("uiConfirmDeleteImage",{uploadType:"avatar"}),expect("uiDialogOpened").toHaveBeenTriggeredOn(this.$node),$(document).trigger("dataDeleteImageSuccess"),expect("uiDialogClosed").toHaveBeenTriggeredOn(this.$node),expect("uiHideDeleteLink").toHaveBeenTriggeredOnAndWith(this.$node,{uploadType:"avatar"})})}),describe("clicking cancel",function(){it("closes the dialog",function(){spyOnEvent(this.$node,"uiDialogClosed"),spyOnEvent(this.$node,"uiDialogOpened"),$(document).trigger("uiConfirmDeleteImage",{uploadType:"avatar"}),expect("uiDialogOpened").toHaveBeenTriggeredOn(this.$node),this.component.select("cancelSelector").trigger("click"),expect("uiDialogClosed").toHaveBeenTriggeredOn(this.$node)})}),describe("on uiDialogClosed",function(){it("enables the buttons",function(){spyOnEvent(this.$node,"uiDialogClosed"),$(document).trigger("uiConfirmDeleteImage",{uploadType:"avatar"}),this.component.disableButtons(),expect(this.component.select("removeSelector")).toHaveAttr("disabled","disabled"),expect(this.component.select("cancelSelector")).toHaveCss("display","none"),this.component.select("cancelSelector").trigger("click"),expect("uiDialogClosed").toHaveBeenTriggeredOn(this.$node),expect(this.component.select("removeSelector")).not.toHaveAttr("disabled"),expect(this.component.select("cancelSelector")).toHaveCss("display","block")})}),describe("on dataDeleteImageFailure",function(){it("enables the buttons",function(){$(document).trigger("uiConfirmDeleteImage",{uploadType:"avatar"}),this.component.disableButtons(),expect(this.component.select("removeSelector")).toHaveAttr("disabled","disabled"),expect(this.component.select("cancelSelector")).toHaveCss("display","none"),$(document).trigger("dataDeleteImageFailure"),expect(this.component.select("removeSelector")).not.toHaveAttr("disabled"),expect(this.component.select("cancelSelector")).toHaveCss("display","block")})})})
});
define("test/app/ui/dialogs/confirm_email_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/confirm_email_dialog",function(){var a='<div id="confirm-email-dialog" style="display: none;" class="modal-container">\n      <div class="confirm-email-actions">\n        <a class="resend-confirmation-email-link" href="#">Resend confirmation</a>\n      </div>\n    </div>\n  ';beforeEach(function(){setupComponent(a)}),describe("event uiOpenConfirmEmailDialog",function(){it("opens the dialog",function(){$(document).trigger("uiOpenConfirmEmailDialog"),expect(this.$node).toBeVisible()})}),describe("event dataResendConfirmationEmailSuccess",function(){it("closes the dialog",function(){this.component.open(),$(document).trigger("dataResendConfirmationEmailSuccess"),expect(this.$node).not.toBeVisible()})}),describe("click on resend confirmation email link",function(){it("triggers uiResendConfirmationEmail",function(){spyOnEvent(this.$node,"uiResendConfirmationEmail"),this.component.select("resendConfirmationEmailLinkSelector").click(),expect("uiResendConfirmationEmail").toHaveBeenTriggeredOn(this.$node)}),it("closes the dialog",function(){spyOn(this.component,"close"),this.component.select("resendConfirmationEmailLinkSelector").click(),expect(this.component.close).toHaveBeenCalled()})})})
});
define("test/app/ui/dialogs/with_modal_tweet_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/dialogs/with_modal_tweet",function(){beforeEach(function(){var a='<div id="dialog" class="modal-container">\n        <div class="modal draggable">\n          <div class="modal-body modal-tweet"></div>\n        </div>\n      </div\n    ';setupComponent(a)}),describe("adding a tweet",function(){it("adds a tweet element to the tweetSelector",function(){var a=$('<div class="tweet"></div>');this.component.addTweet(a),expect(this.$node.find(".tweet").length).toEqual(1)}),it("removes a tweet element from the tweetSelector",function(){var a=$('<div class="tweet"></div>');this.component.addTweet(a),expect(this.$node.find(".tweet").length).toEqual(1),this.component.removeTweet(),expect(this.$node.find(".tweet").length).toEqual(0)}),it("removes a tweet element on uiDialogClosed",function(){var a=$('<div class="tweet"></div>');this.component.addTweet(a),expect(this.$node.find(".tweet").length).toEqual(1),$(document).trigger("uiDialogClosed"),expect(this.$node.find(".tweet").length).toEqual(0)})})})
});
define("test/app/ui/dialogs/activity_popup_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/activity_popup",function(){beforeEach(function(){var a='<div id="activity-popup-dialog" style="display: none;" class="modal-container">\n        <div class="close-modal-background-target"></div>\n        <div class="modal draggable">\n          <div class="modal-content clearfix">\n            <button type="button" class="modal-btn modal-close"><i class="close-medium"></i></button>\n\n            <div class="modal-header">\n              <h3 class="modal-title">Bogus title</h3>\n            </div>\n\n            <div class="modal-body">\n              <div class="activity-tweet clearfix"></div>\n              <div class="loading">\n                <img src="about:blank">\n              </div>\n              <div class="activity-content clearfix">Bogus users</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ';setupComponent(a),this.$spinner=this.$node.find(".loading")}),describe("on uiRequestActivityPopup",function(){beforeEach(function(){this.$node.trigger("uiRequestActivityPopup",{titleHtml:"Title from click",tweetHtml:'<div data-tweet-id="1">Tweet from click</div>',isRetweeted:!0})}),it("shows the activity popup",function(){expect(this.$node).toBeVisible()}),it("shows a loading spinner",function(){expect(this.$node).not.toHaveClass("has-content")}),it("clears the content of the dialog",function(){expect(this.$node).not.toHaveText(/Bogus title/),expect(this.$node).not.toHaveText(/Bogus users/)}),it("shows the tweet from the click event in the dialog",function(){expect(this.$node).toHaveText(/Tweet from click/)}),it("shows the title from the click event in the dialog",function(){expect(this.$node).toHaveText(/Title from click/)}),describe("on dataActivityPopupSuccess",function(){beforeEach(function(){$(document).trigger("dataActivityPopupSuccess",{htmlTitle:"A title",htmlUsers:"A list of users"})}),it("inserts the returned content into the DOM",function(){expect(this.$node).toHaveText(/A title/),expect(this.$node).toHaveText(/A list of users/)}),it("hides the loading spinner",function(){expect(this.$node).toHaveClass("has-content")}),describe("on a second dataProfilePopupSuccess",function(){beforeEach(function(){$(document).trigger("dataActivityPopupSuccess",{htmlTitle:"A different title",htmlUsers:"A different list of users"})}),it("removes the old content and inserts the new content",function(){expect(this.$node).not.toHaveText(/A title/),expect(this.$node).toHaveText(/A different title/),expect(this.$node).not.toHaveText(/A list of users/),expect(this.$node).toHaveText(/A different list of users/)}),describe("pressing escape",function(){beforeEach(function(){this.component.trigger(document,"uiShortcutEsc")}),it("closes the dialog",function(){expect(this.$node).not.toBeVisible()})})})}),describe("on dataActivityPopupError",function(){beforeEach(function(){$(document).trigger("dataActivityPopupError",{message:"Sorry!"})}),it("adds the error message to the body of the popup",function(){expect(this.$node).toHaveText(/Sorry!/)}),it("hides the loading spinner",function(){expect(this.$node).toHaveClass("has-content")})})})})
});
define("test/app/ui/dialogs/promptbird_invite_contacts_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/promptbird_invite_contacts_dialog",function(){beforeEach(function(){var a='<div id="promptbird-invite-contacts-dialog" class="modal-container" style="display: none;">\n  <div class="close-modal-background-target"></div>\n  <div class="modal draggable" style="left: 506px;">\n    <div class="modal-content clearfix">\n      <button type="button" class="modal-btn modal-close js-close"><i class="close-medium"><span class="visuallyhidden">Close</span></i></button>\n      <div class="modal-header">\n        <h3 class="modal-title">Invite your friends to Twitter</h3>\n      </div>\n\n      <div class="contents"></div>\n\n      <div class="select-all-people">\n        <span class="invite-desc">Select friends to invite to Twitter. We’ll email them an invite.</span>\n        <label class="contacts-select-all">\n          <input type="checkbox" name="select_all" class="select-all-contacts" checked="checked">\n          Select all 2\n        </label>\n      </div>\n\n      <div class="contacts">\n          <label class="contact-item selected">\n            <span class="contact-item-name" title="a">a</span>\n            <span class="contact-item-email" title="a@example.com">a@example.com</span>\n            <input type="checkbox" name="emails[]" value="a@example.com" class="contact-checkbox" checked="">\n          </label>\n          <label class="contact-item selected">\n            <span class="contact-item-name" title="b">b "quote"</span>\n            <span class="contact-item-email" title="b@example.com">b@example.com</span>\n            <input type="checkbox" name="emails[]" value="b@example.com" class="contact-checkbox" checked="">\n          </label>\n      </div>\n\n      <div class="modal-footer clearfix">\n        <button class="btn primary-btn js-invite">Invite these friends</button>\n      </div>\n    </div>\n  </div>\n</div>\n    ';setupComponent(a)}),describe("selecting",function(){it("adds and removes selected class from contact item",function(){var a=this.component.select("contactSelector"),b=this.component.select("checkboxSelector");expect(a.first().hasClass("selected")).toBeTruthy(),b.first().click(),expect(a.first().hasClass("selected")).toBeFalsy(),b.last().click(),expect(a.last().hasClass("selected")).toBeFalsy(),b.first().click(),expect(a.first().hasClass("selected")).toBeTruthy()}),it("adds and removes selected class when selecting all",function(){var a=this.component.select("selectAllSelector"),b=this.component.select("contactSelector");b.each(function(){expect($(this).hasClass("selected")).toBeTruthy()}),a.click(),b.each(function(){expect($(this).hasClass("selected")).toBeFalsy()})})}),describe("invite success",function(){it("triggers uiPromptbirdInviteContactsSuccess",function(){spyOnEvent(this.$node,"uiPromptbirdInviteContactsSuccess"),this.$node.trigger("uiInviteFinished"),expect("uiPromptbirdInviteContactsSuccess").toHaveBeenTriggeredOn(this.$node)})})})
});
define("test/app/ui/dialogs/delete_tweet_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/delete_tweet_dialog",function(){var a='<div id="delete-tweet-dialog" style="display: none;" class="modal-container">\n      <div class="modal draggable">\n        <div class="modal-content">\n          <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n          <div class="modal-header">\n            <h3 class="modal-title">Are you sure you want to delete this tweet</h3>\n          </div>\n          <div class="modal-body modal-tweet"></div>\n          <div class="modal-footer">\n            <button class="btn cancel-action">Cancel</button>\n            <button class="btn primary-btn delete-action">Delete</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',b='<div id="stream-item-1" class="selected-stream-item" tabindex="-1">\n    <div class="tweet">\n      <ul>\n        <li class="action-del-container">\n          <a id="delete-btn" role="button" class="with-icn js-action-del" href="#">Delete</a>\n        </li>\n      </ul>\n    </div>\n  </div>\n  ';beforeEach(function(){this.html=a,setupComponent(this.html)}),it("opens the dialog",function(){spyOn(this.component,"open");var a=$('<div class="tweet"/>');attachFixtureToDom(a),a.trigger("uiOpenDeleteDialog",{id:1}),expect(this.component.open).toHaveBeenCalled()}),it("closes the dialog on uiCloseDeleteTweetDialog",function(){spyOn(this.Component.prototype,"close"),setupComponent(this.html),$(document).trigger("uiCloseDeleteTweetDialog"),expect(this.component.close).toHaveBeenCalled()}),it("closes the dialog on dataDidDeleteTweet",function(){spyOn(this.Component.prototype,"close"),setupComponent(this.html),$(document).trigger("dataDidDeleteTweet"),expect(this.component.close).toHaveBeenCalled()}),it("stores the id after opening",function(){spyOn(this.component,"open");var a=$('<div class="tweet"/>');attachFixtureToDom(a),a.trigger("uiOpenDeleteDialog",{id:1}),expect(this.component.open).toHaveBeenCalled(),expect(this.component.id).toEqual(1)}),it("calls deleteTweet",function(){spyOn(this.Component.prototype,"deleteTweet"),setupComponent(this.html);var a=$('<div class="tweet"/>');attachFixtureToDom(a),a.trigger("uiOpenDeleteDialog",{id:1}),this.component.select("deleteSelector").trigger("click"),expect(this.component.deleteTweet).toHaveBeenCalled()}),it("triggers uiDidDeleteTweet",function(){spyOnEvent(this.$node,"uiDidDeleteTweet");var a=$('<div class="tweet"/>');attachFixtureToDom(a),a.trigger("uiOpenDeleteDialog",{id:1}),expect(this.component.id).toEqual(1),this.component.deleteTweet(),expect("uiDidDeleteTweet").toHaveBeenTriggeredOnAndWith(this.$node,{id:1})}),it('restores focus to the Tweet if the "Delete" button had focus prior to the opening of the Dialog',function(){$("#fixture_parent").append(b);var a=$(".tweet");spyOnEvent(a,"uiShouldAddFocusStyle");var c=$("#delete-btn");c.focus(),this.component.open(),this.component.close(),expect(c).toBeFocused(),expect("uiShouldAddFocusStyle").toHaveBeenTriggeredOn(a)})})
});
define("test/app/ui/dialogs/iph_search_result_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/iph_search_result_dialog",function(){var a='<div id="in_product_help_dialog" style="display: none;" class="modal-container modal-in-product-help modal-search-result-help">\n      <div class="close-modal-background-target"></div>\n      <div class="modal modal-small draggable">\n        <div class="modal-content">\n          <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n          <div class="modal-header">\n            <h3 class="modal-title">Why is my search result empty?</h3>\n          </div>\n          <div class="modal-body">\n            <p>Sorry, we are not able to include all users & tweets in search results.</p>\n            <ol>\n              <li>If you know that a particular user exists, type their username after the "twitter.com/" in your browser\'s address bar to view their profile.</li>\n              <li>If you are searching for a specific tweet, it\'s probably not included in our search results at this time.</li>\n            </ol>\n          </div>\n          <div class="modal-footer">\n            <span class="satisfaction-prompt">\n              <span id="satisfaction_question">Was this helpful?</span>\n              <span id="satisfaction_feedback">Thanks for the feedback!</span>\n            </span>\n            <div id="satisfaction_buttons">\n              <button id="helpful_button" class="btn">Yes</button>\n              <button id="not_helpful_button" class="btn">No</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ';describe('link to "Why?" when ddg experiment is on',function(){beforeEach(function(){$("body").append($('<a id="search_result_help" href="#">Why?</a>')),setupComponent(a)}),afterEach(function(){$("#search_result_help").remove()}),it("opens the dialog when clicking on the inProductHelpSelector",function(){spyOn(this.component,"open"),$("#search_result_help").click(),expect(this.component.open).toHaveBeenCalled()}),it("tracks a dialog impression",function(){$("#search_result_help").click(),expect(this.component).toScribe({component:"search_result",element:"learn_more_dialog",action:"impression"})}),describe("the helpful/unhelpful buttons",function(){it('calls voteHelpful(true) when "helpful" is clicked',function(){spyOn(this.component,"voteHelpful"),$("#search_result_help").click(),this.component.select("helpfulSelector").click(),expect(this.component.voteHelpful).toHaveBeenCalledWith(!0)}),it('tracks a helpful action when "helpful" is clicked',function(){$("#search_result_help").click(),this.component.select("helpfulSelector").click(),expect(this.component).toScribe({component:"search_result",element:"learn_more_dialog",action:"helpful"})}),it('called voteHelpful(false) when "not helpful" is clicked',function(){spyOn(this.component,"voteHelpful"),$("#search_result_help").click(),this.component.select("notHelpfulSelector").click(),expect(this.component.voteHelpful).toHaveBeenCalledWith(!1)}),it('tracks a unhelpful action when "not helpful" is clicked',function(){$("#search_result_help").click(),this.component.select("notHelpfulSelector").click(),expect(this.component).toScribe({component:"search_result",element:"learn_more_dialog",action:"unhelpful"})}),it("set focus within the dialog",function(){$("#search_result_help").click(),this.component.select("notHelpfulSelector").click(),expect($("#helpful_button")).toBeFocused()})})})})
});
define("test/app/ui/dialogs/profile_edit_error_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/profile_edit_error_dialog",function(){beforeEach(function(){var a='<div id="profile-edit-error-dialog" class="modal-container profile-edit-message hidden">\n        <div class="modal">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h3>Oops!</h3>\n            </div>\n            <div class="modal-body">\n              <p class="profile-message"></p>\n            </div>\n            <div class="modal-footer">\n              <button class="btn primary-btn ok-btn">{{_i}}Ok{{/i}}</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ';this.html=a,setupComponent(this.html)}),describe("on uiShowProfileEditError",function(){it("opens the dialog",function(){spyOn(this.component,"open"),$(document).trigger("uiShowProfileEditError",{}),expect(this.component.open).toHaveBeenCalled()}),it("uses a provided message",function(){spyOn(this.component,"open"),$(document).trigger("uiShowProfileEditError",{message:"test message"}),expect(this.component.open).toHaveBeenCalled(),expect(this.component.select("messageSelector")).toHaveText("test message")})}),it("closes the dialog on ok click",function(){spyOn(this.Component.prototype,"close"),setupComponent(this.html),this.component.select("okaySelector").trigger("click"),expect(this.component.close).toHaveBeenCalled()})})
});
define("test/app/ui/dialogs/block_user_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/block_user_dialog",function(){beforeEach(function(){var a='<div id="block-user-dialog" style="display: none;" class="modal-container">\n        <div class="modal draggable">\n          <div class="modal-content">\n            <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n            <div class="modal-header">\n              <h3 class="modal-title">Are you sure you want to block this user?</h3>\n            </div>\n            <div class="modal-body modal-tweet"></div>\n            <div class="modal-footer">\n              <button class="btn cancel-action">Cancel</button>\n              <button class="btn primary-btn block-action">Block</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ';this.html=a,setupComponent(this.html)}),it("opens the dialog",function(){spyOn(this.component,"open");var a=$('<div class="tweet"/>');attachFixtureToDom(a),a.trigger("uiOpenBlockUserDialog"),expect(this.component.open).toHaveBeenCalled()}),it("triggers uiDidBlockUser",function(){var a="some user data";spyOnEvent(this.$node,"uiDidBlockUser");var b=$('<div class="tweet"/>');attachFixtureToDom(b),b.trigger("uiOpenBlockUserDialog",a),this.component.select("blockSelector").trigger("click"),expect("uiDidBlockUser").toHaveBeenTriggeredOnAndWith(this.$node,{sourceEventData:a})})})
});
define("test/app/ui/dialogs/keyboard_shortcuts_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/keyboard_shortcuts_dialog",function(){function b(){document.cookie="suppress_sr_shortcuts_msg=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}var a='<div id="doc">\n    <div id="keyboard-shortcut-dialog" class="modal-container">\n      <div class="modal modal-large draggable"></div>\n    </div>\n  </div>\n  ';beforeEach(function(){$("#kb-shortcuts-msg").remove(),b(),setupComponent(a)}),afterEach(b),describe("When the page is loaded",function(){describe('and the "suppress_sr_shortcuts_msg" cookie is not set',function(){it("inserts a visually hidden message for users of screen readers as the first element in the page.",function(){this.component.trigger(document,"uiSwiftLoaded"),expect($("#kb-shortcuts-msg")).toExist()})}),describe('and the "suppress_sr_shortcuts_msg" is set',function(){it("does not insert a visually hidden message for users of screen readers.",function(){document.cookie=this.component.attr.suppressSRMsgCookie+"=1; expires=Thu, 01 Jan 2020 00:00:00 GMT; path=/",this.component.trigger(document,"uiSwiftLoaded"),expect($("#kb-shortcuts-msg")).not.toExist()})})}),describe("When the keyboard shortcuts message is visible",function(){describe("and the user clicks the button to dismiss the message",function(){beforeEach(function(){this.component.trigger(document,"uiSwiftLoaded"),this.component.trigger($(this.component.attr.dismissShortcutsBtnSelector),"click")}),it("removes the message immediately.",function(){expect($("#kb-shortcuts-msg")).not.toExist()}),it("will not show the message the next time the page is loaded.",function(){this.component.trigger(document,"uiSwiftLoaded"),expect($("#kb-shortcuts-msg")).not.toExist()})})})})
});
define("test/app/ui/dialogs/temporary_password_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/temporary_password_dialog",function(){beforeEach(function(){var a='<div id="temporary-password-dialog" class="modal-container" style="display: block;">\n            <div class="close-modal-background-target"></div>\n            <div class="modal modal-small draggable" style="top: 194px; left: 455px;">\n              <form id="temporary-password-form" class="modal-content">\n                <button type="button" class="modal-btn modal-close js-close"><i class="close-medium"><span class="visuallyhidden">Close</span></i></button>      <div class="modal-header">\n                  <h3 class="modal-title">Temporary password</h3>\n                </div>\n                <div class="modal-body">\n                  <div id="password_confirm">\n                    <p>Enter your Twitter password to generate a temporary password.</p>\n                    <div class="input-wrapper password-wrapper">\n                      <input class="input-block" id="auth_password" name="auth_password" type="password" placeholder="Password">\n                      <small>\n                        <a href="/account/resend_password" id="forgot_password">Forgot your password?</a>\n                        <span id="reminder_sent" style="visibility: hidden">Reminder sent!</span>\n                      </small>\n                    </div>\n                  </div>\n                  <div class="hidden" id="show_app_password">\n                    <div id="temporary-password" class="important"></div>\n                    <p class="hidden" id="show_failure">Sorry, a temporary password could not be generated.</p>\n                    <p class="hidden" id="show_success">Use this temporary password instead of your Twitter password to log in to apps and devices. It will expire in an hour.</p>\n                  </div>\n                </div>\n                <div class="modal-footer">\n                  <button class="btn" id="cancel_password_button">Cancel</button>\n                  <button type="submit" id="save_password" class="btn primary-btn modal-submit">Generate</button>\n                  <button type="submit" id="close_password" class="btn hidden">Close</button>\n                  <button type="submit" id="retry_password" class="btn primary-btn modal-submit hidden">Retry</button>\n                </div>\n              </form>\n            </div>\n         </div>\n    ';setupComponent(a),this.component.resetPasswordDialog()}),describe("opening the dialog",function(){it("shows password confirmation form",function(){this.component.trigger("uiDialogOpened"),expect(this.component.select("passwordEnterSelector")).toBeVisible()}),it("clears out the previous temporary password",function(){this.component.trigger("uiDialogOpened"),expect(this.component.select("temporaryPasswordSelector")).toHaveValue("")})}),describe("submitting a password",function(){it("clicking on generate button hides password confirmation form",function(){this.component.select("generatePasswordSelector").click(),expect(this.component.select("passwordEnterSelector")).toBeHidden()}),it("submitting form (hitting enter) hides password confirmation form",function(){this.component.select("temporaryPasswordFormSelector").submit(),expect(this.component.select("passwordEnterSelector")).toBeHidden()}),it("shows spinner",function(){this.component.select("generatePasswordSelector").click(),expect(this.component.select("temporaryPasswordSelector")).toHaveClass("spinner")}),it("generates uiGenerateTemporaryPassword event",function(){spyOnEvent(document,"uiGenerateTemporaryPassword"),this.component.select("passwordSelector").val("somepassword"),this.component.select("generatePasswordSelector").click(),expect("uiGenerateTemporaryPassword").toHaveBeenTriggeredOnAndWith(document,{password:"somepassword"})})}),describe("receiving a temporary password",function(){it("shows temporary password",function(){this.component.passwordGenerated(null,{temporary_password:"123456789012"}),expect(this.component.select("temporaryPasswordSelector").text()).toEqual("1234 5678 9012"),expect(this.component.select("temporaryPasswordSelector")).not.toHaveClass("spinner")})}),describe("receiving an error result",function(){it("shows over limit message",function(){var a="That's too many incorrect passwords. Please try again later.";this.component.passwordGenerated({},{error_status:"OverLimitLoginVerificationAttempts"}),expect(this.component.select("passwordRetrySelector")).toBeHidden(),expect(this.component.select("closePasswordSelector")).toBeVisible(),expect(this.component.select("failureSelector").text()).toEqual(a)}),it("shows wrong password message",function(){var a="That's not the correct password. Try again.";this.component.passwordGenerated({},{error_status:"BadPassword"}),expect(this.component.select("passwordRetrySelector")).toBeVisible(),expect(this.component.select("closePasswordSelector")).toBeVisible(),expect(this.component.select("failureSelector").text()).toEqual(a)}),it("shows generic error message",function(){var a="Whoops! Something went wrong. Please try again!";this.component.passwordGenerated({},{error_status:"something random"}),expect(this.component.select("passwordRetrySelector")).toBeVisible(),expect(this.component.select("closePasswordSelector")).toBeVisible(),expect(this.component.select("failureSelector").text()).toEqual(a)}),it("scribes an event on an error",function(){this.component.passwordGenerated({},{error_status:"something random"}),expect(this.component).toScribe({component:"temporary_password_dialog",action:"temp_pass_failure"})})}),describe("retry entering password",function(){it("shows password entry text on submit",function(){this.component.select("temporaryPasswordFormSelector").submit(),this.component.trigger("dataFailedToGenerateTemporaryPassword",{error_status:"failed"}),this.component.select("temporaryPasswordFormSelector").submit(),expect(this.component.select("passwordEnterSelector")).toBeVisible(),expect(this.component.select("passwordRetrySelector")).toBeHidden()})})})
});
define("test/app/ui/dialogs/confirm_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/confirm_dialog",function(){var a='<div id="confirm_dialog" style="display: none;" class="modal-container" display="none">\n      <div class="close-modal-background-target"></div>\n      <div class="modal draggable">\n        <div class="modal-content">\n          <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n          <div class="modal-header">\n            <h3 class="modal-title"></h3>\n          </div>\n          <div class="modal-body">\n            <p class="modal-body-text"></p>\n          </div>\n          <div class="modal-footer">\n            <button class="btn" id="confirm_dialog_cancel_button"></button>\n            <button id="confirm_dialog_submit_button" class="btn primary-btn modal-submit"></button>\n          </div>\n        </div>\n      </div>\n      <div id="confirm_dialog_client"></div>\n    </div>\n  ';beforeEach(function(){setupComponent(a)}),describe("on uiOpenConfirmDialog",function(){var a;beforeEach(function(){a=this.$node.find("#confirm_dialog_client").get(0),this.component.trigger(a,"uiOpenConfirmDialog",{action:"DoSomething",titleText:"Title",bodyText:"Body text",cancelText:"Cancel",submitText:"OK!"})}),it("opens the dialog",function(){expect(this.$node).toBeVisible()}),it("sets the content appropriately",function(){expect(this.$node.find(".modal-title")).toHaveText("Title"),expect(this.$node.find(".modal-content p")).toHaveText("Body text"),expect(this.$node.find("#confirm_dialog_cancel_button")).toHaveText("Cancel"),expect(this.$node.find("#confirm_dialog_submit_button")).toHaveText("OK!")}),it("triggers the correct event when the submit button is clicked",function(){spyOnEvent(document,"uiDoSomethingConfirm"),this.$node.find("#confirm_dialog_submit_button").click(),expect("uiDoSomethingConfirm").toHaveBeenTriggeredOn(a)}),it("triggers the correct event when the cancel button is clicked",function(){spyOnEvent(document,"uiDoSomethingCancel"),this.$node.find("#confirm_dialog_cancel_button").click(),expect("uiDoSomethingCancel").toHaveBeenTriggeredOn(a)}),it("hides the body when there is no bodyText",function(){this.component.trigger(a,"uiOpenConfirmDialog",{action:"DoSomething"}),expect(this.component.select("modalBodySelector")).toBeHidden()}),it("shows the body when bodyText is added again",function(){this.component.trigger(a,"uiOpenConfirmDialog",{action:"DoSomething"}),this.component.trigger(a,"uiOpenConfirmDialog",{action:"DoSomething",bodyText:"body here"}),expect(this.component.select("modalBodySelector")).toBeVisible()})})})
});
define("test/app/ui/dialogs/tweet_export_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/tweet_export_dialog",function(){var a='<div id="tweet_export_dialog" style="display: none;" class="modal-container">\n    <div class="close-modal-background-target"></div>\n    <div class="modal modal-small draggable">\n      <div class="modal-content">\n        <button type="button" class="modal-btn modal-close"><i class="close-medium"></i></button>\n        <div class="modal-header">\n          <h3 class="modal-title">\n            <div class="tweet-export-success reset-hide hidden">Success!</div>\n            <div class="tweet-export-unavailable tweet-export-request-in-queue tweet-export-suspended-user reset-hide hidden">We\'re sorry, that didn\'t go through</div>\n            <div class="tweet-export-confirm-email-request tweet-export-confirm-email-error reset-hide hidden">Confirm your email address</div>\n            <div class="tweet-export-request-already-sent reset-hide hidden">Check your email</div>\n          </h3>\n        </div>\n        <div class="modal-body">\n          <p class="modal-body-text"></p>\n          <div class="tweet-export-success reset-hide hidden">We\'ve received your request. A link will be emailed to you when your download is ready. This may take a little while, so please be patient.</div><div class="tweet-export-unavailable reset-hide hidden">Thanks for your interest. At the moment, we\'re getting a lot of requests. Please try again later.</div><div class="tweet-export-confirm-email-request reset-hide hidden">You must confirm your email address before you can complete this process. After clicking the button below, you\'ll receive a confirmation email with instructions. When you\'re finished, come back here and resubmit your request.</div>\n          <div class="tweet-export-confirm-email-error reset-hide hidden">Oops! There was an error sending the confirmation email. Please try again.</div>\n          <div class="tweet-export-request-in-queue reset-hide hidden">You recently requested a download. Please wait a little while before requesting another one.</div>\n          <div class="tweet-export-request-already-sent reset-hide hidden">Your download is ready. Please check your email for further instructions.</div>\n          <div class="tweet-export-suspended-user reset-hide hidden">You can\'t request a download while your account is suspended.</div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn tweet-export-confirm-email-request reset-hide" id="resend_confirmation_button">Send confirmation email</button>\n          <button type="button" class="btn tweet-export-success reset-hide" id="thanks_button">Close</button>\n          <button type="button" class="btn tweet-export-unavailable tweet-export-request-in-queue tweet-export-request-already-sent reset-hide" id="okay_button">Okay</button>\n          <div class="reset-hide hidden" id="email_sending_spinner"><img class="loading-spinner" src=""></div>\n          <p style="color:#390;" class="reset-hide hidden" id="email_sent_text"><i class="checkmark"></i> Email sent</p>\n        </div>\n      </div>\n    </div>\n  </div>\n  ';beforeEach(function(){setupComponent(a)}),describe("When the dialog is opened",function(){describe("and request for the archive is successful",function(){beforeEach(function(){this.component.openDialog({},"success")}),it("shows the success message",function(){expect(this.component.select("successSelector")).toBeVisible()}),it('focuses the "Close" button',function(){expect(this.component.select("thanksSelector")).toBeFocused()}),it("scribes an event on success",function(){expect(this.component).toScribe({component:"tweet_export_dialog",element:"success",action:"impression"})})}),describe("and the archive is unavailable",function(){beforeEach(function(){this.component.openDialog({},"unavailable")}),it("shows the unavailable message",function(){expect(this.component.select("serviceUnavailableSelector")).toBeVisible()}),it('focuses the "Okay" button',function(){expect(this.component.select("okaySelector")).toBeFocused()}),it("scribes an event on unavailable",function(){expect(this.component).toScribe({component:"tweet_export_dialog",element:"unavailable",action:"impression"})})}),describe("and the user hasn not confirmed their email",function(){beforeEach(function(){this.component.openDialog({},"confirm_email_request")}),it("shows the confirm email message",function(){expect(this.component.select("confirmEmailRequestSelector")).toBeVisible()}),it("scribes an event",function(){expect(this.component).toScribe({component:"tweet_export_dialog",element:"confirm_email_request",action:"impression"})}),it('focuses the "Send confirmation email" button',function(){expect(this.component.select("resendConfirmationSelector")).toBeFocused()})}),describe("and the user is suspended",function(){beforeEach(function(){this.component.openDialog({},"suspended_user")}),it("shows the suspended user message on suspended_user",function(){expect(this.component.select("suspendedUserSelector")).toBeVisible()}),it('focuses the "Close" button',function(){expect(this.component.select("thanksSelector")).toBeFocused()}),it("scribes an event on suspended_user",function(){expect(this.component).toScribe({component:"tweet_export_dialog",element:"suspended_user",action:"impression"})})})}),describe("email confirmation dialog",function(){beforeEach(function(){this.component.openDialog({},"confirm_email_request")}),it("scribes an event if closed without action",function(){this.component.close(),expect(this.component).toScribe({component:"tweet_export_dialog",element:"confirm_email",action:"close"})}),it("triggers uiTweetExportConfirmEmail when button clicked",function(){spyOnEvent(this.$node,"uiTweetExportConfirmEmail"),this.component.select("resendConfirmationSelector").click(),expect("uiTweetExportConfirmEmail").toHaveBeenTriggeredOn(this.$node),expect($("#resend_confirmation_button")).toBeFocused()}),it("scribes an event when button clicked",function(){this.component.select("resendConfirmationSelector").click(),expect(this.component).toScribe({component:"tweet_export_dialog",element:"resend_confirmation_button",action:"click"})}),it("shows spinner when button clicked",function(){this.component.select("resendConfirmationSelector").click(),expect(this.component.select("resendConfirmationSelector")).not.toBeVisible(),expect(this.component.select("spinnerSelector")).toBeVisible()}),it("shows email sent text on dataResendConfirmationEmailSuccess",function(){this.component.select("resendConfirmationSelector").click(),this.component.trigger("dataResendConfirmationEmailSuccess"),expect(this.component.select("resendConfirmationSelector")).not.toBeVisible(),expect(this.component.select("spinnerSelector")).not.toBeVisible(),expect(this.component.select("emailSentSelector")).toBeVisible()}),it("shows error message and resend button on dataResendConfirmationEmailError",function(){this.component.select("resendConfirmationSelector").click(),this.component.trigger("dataResendConfirmationEmailError"),expect(this.component.select("spinnerSelector")).not.toBeVisible(),expect(this.component.select("confirmEmailErrorSelector")).toBeVisible(),expect(this.component.select("resendConfirmationSelector")).toBeVisible(),expect(this.component.select("resendConfirmationSelector")).toBeFocused()})})})
});
define("test/app/ui/dialogs/retweet_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/retweet_dialog",function(){var a='<div id="retweet-dialog" style="display: none;" class="modal-container">\n      <div class="modal draggable">\n        <div class="modal-content">\n          <button class="modal-btn modal-close"><i class="close-medium"></i></button>\n          <div class="modal-header">\n            <h3 class="modal-title">Retweet this to your followers?</h3>\n          </div>\n          <div class="modal-body modal-tweet"></div>\n          <div class="modal-footer">\n            <button class="btn cancel-action">Cancel</button>\n            <button class="btn primary-btn retweet-action">Retweet</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',b='<div id="stream-item-1" class="selected-stream-item" tabindex="-1">\n    <div class="tweet">\n      <ul>\n        <li class="action-del-container">\n          <a id="retweet-btn" role="button" class="with-icn retweet" data-modal="tweet-retweet" href="#">Retweet</a>\n        </li>\n      </ul>\n    </div>\n  </div>\n  ';beforeEach(function(){this.html=a,setupComponent(this.html)}),it("opens the dialog",function(){spyOn(this.component,"open");var a=$('<div class="tweet"/>');attachFixtureToDom(a),a.trigger("uiOpenRetweetDialog",{id:1}),expect(this.component.open).toHaveBeenCalled()}),it("closes the dialog on dataDidRetweet",function(){spyOn(this.Component.prototype,"close"),setupComponent(this.html),$(document).trigger("dataDidRetweet"),expect(this.component.close).toHaveBeenCalled()}),it("stores the id after opening",function(){spyOn(this.component,"open");var a=$('<div class="tweet"/>');attachFixtureToDom(a),a.trigger("uiOpenRetweetDialog",{id:1}),expect(this.component.open).toHaveBeenCalled(),expect(this.component.attr.sourceEventData.id).toEqual(1)}),it("calls retweet",function(){spyOn(this.Component.prototype,"retweet"),setupComponent(this.html);var a=$('<div class="tweet"/>');attachFixtureToDom(a),a.trigger("uiOpenRetweetDialog",{id:1}),this.component.select("retweetSelector").trigger("click"),expect(this.component.retweet).toHaveBeenCalled()}),it("triggers uiDidRetweet",function(){spyOnEvent(this.$node,"uiDidRetweet");var a=$('<div class="tweet"/>');attachFixtureToDom(a),a.trigger("uiOpenRetweetDialog",{id:1}),expect(this.component.attr.sourceEventData.id).toEqual(1),this.component.retweet(),expect("uiDidRetweet").toHaveBeenTriggeredOnAndWith(this.$node,{id:1})}),it('restores focus to the Tweet if the "Retweet" button had focus prior to the opening of the Dialog',function(){$("#fixture_parent").append(b);var a=$(".tweet");spyOnEvent(a,"uiShouldAddFocusStyle");var c=$("#retweet-btn");c.focus(),this.component.open(),this.component.close(),expect(c).toBeFocused(),expect("uiShouldAddFocusStyle").toHaveBeenTriggeredOn(a)})})
});
define("test/app/ui/dialogs/goto_user_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/dialogs/goto_user_dialog",function(){var a='<div id="goto-user-dialog" class="modal-container">\n      <div class="modal modal-small draggable">\n        <div class="modal-content">\n          <button type="button" class="modal-btn modal-close"><i class="close-medium"></i></button>\n          <div class="modal-header">\n            <h3 class="modal-title">Go to a person\'s profile</h3>\n          </div>\n          <div class="modal-body">\n            <div class="modal-inner">\n              <form action="" class="goto-user-form">\n                <input class="username-input" type="text" placeholder="Start typing a name to jump to a profile">\n                <ul class="dropdown-menu autocomplete-results" style="display: none; ">\n                  <li class="dropdown-link dropdown-account template-row autocomplete-item">\n                    <img width="24" height="24" class="avatar size24">\n                    <strong class="fullname"></strong>\n                    <span class="pretty-link"><s>@</s><b class="username"></b></span>\n                  </li>\n                </ul>\n              </form>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ';it("opens the dialog",function(){spyOn(this.Component.prototype,"open"),setupComponent(a),$(document).trigger("uiShortcutShowGotoUser"),expect(this.component.open).toHaveBeenCalled()}),it("triggers navigate with the profile url when user presses enter",function(){setupComponent(a),spyOnEvent(this.$node,"uiNavigate"),this.component.select("inputSelector").val("@username"),this.component.select("usernameFormSelector").trigger("submit"),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,{href:"/username"})}),it("triggers navigate with the profile url when uiTypeaheadItemSelected fired",function(){setupComponent(a),spyOnEvent(this.$node,"uiNavigate"),this.component.trigger("uiTypeaheadItemSelected",{item:{screen_name:"chatty",name:"Chatty"},href:"/chatty"}),expect(this.component.select("inputSelector").val()).toBe("chatty"),expect("uiNavigate").toHaveBeenTriggeredOnAndWith(this.$node,{href:"/chatty"})})})
});
define("test/app/ui/settings/with_cropper_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/settings/with_cropper",function(){function a(a){using("app/data/user_info",function(b){b.set({deciders:a})})}beforeEach(function(){var a='<div>\n        <img class="image" style="position:absolute;width:200px;height:200px">\n        <div class="mask" style="position:absolute;width:100px;height:100px"></div>\n      </div>\n    ';setupComponent(a,{cropImageSelector:".image",cropMaskSelector:".mask",maskPadding:10})}),describe("Test Image Sniffing",function(){it("turns gifs into png",function(){expect(this.component.determineImageType("data:image/gif;base64,asdfasdf")).toBe("image/png")}),it("keeps pngs as pngs",function(){expect(this.component.determineImageType("data:image/png;base64,iVBORw0KGgo")).toBe("image/png")}),it("keeps jpegs as jpegs",function(){expect(this.component.determineImageType("data:image/jpg;base64,/9j/4AAQSkZJRgAB")).toBe("image/jpeg"),expect(this.component.determineImageType("data:image/jpg;base64,/9j/asdfasdf")).toBe("image/jpeg")})}),describe("#computeTargetRect",function(){var a;beforeEach(function(){this.component.attr.maximumWidth=200,this.component.attr.maximumHeight=100,a={maskWidth:100,maskHeight:50,maskX:10,maskY:10},this.component.hqImageUploads=!0}),it("keeps original size and scales offsets when image is larger than the mask but smaller than max",function(){var b=$.extend(a,{imageWidth:150,imageHeight:75});expect(this.component.computeTargetRect(b)).toEqual({width:150,height:75,x:15,y:15})}),it("uses mask size and offsets when image is smaller than the mask",function(){var b=$.extend(a,{imageWidth:50,imageHeight:25});expect(this.component.computeTargetRect(b)).toEqual({width:100,height:50,x:10,y:10})}),it("uses max size and scaled offsets when image is larger than the max",function(){var b=$.extend(a,{imageWidth:250,imageHeight:150});expect(this.component.computeTargetRect(b)).toEqual({width:200,height:100,x:20,y:20})})}),describe("#setImageOffsetConstrainedToFit",function(){var a,b,c;beforeEach(function(){a=this.component.select("cropImageSelector"),b=this.component.select("cropMaskSelector"),c=b.offset()}),it("constrains offset inside the mask rect and padding",function(){var d=this.component.attr.maskPadding;this.component.setImageOffsetConstrainedToFit({top:9999,left:9999}),expect(a.offset()).toEqual({top:c.top+d,left:c.left+d}),this.component.setImageOffsetConstrainedToFit({top:-9999,left:-9999}),expect(a.offset()).toEqual({top:c.top-(a.height()-b.height())-d,left:c.left-(a.width()-b.width())-d})})}),describe("#compressionImageQuality",function(){describe("with cropToFit",function(){it("returns low quality when mqImageUploads and hqImageUploads are false",function(){a({mqImageUploads:!1,hqImageUploads:!1}),expect(this.component.compressionImageQuality()).toBe(.75)}),it("returns medium quality when only mqImageUploads is true",function(){a({mqImageUploads:!0,hqImageUploads:!1}),expect(this.component.compressionImageQuality()).toBe(.85)}),it("returns high quality when only hqImageUploads is true",function(){a({mqImageUploads:!1,hqImageUploads:!0}),expect(this.component.compressionImageQuality()).toBe(.9)}),it("returns high quality when mqImageUploads and hqImageUploads are true",function(){a({mqImageUploads:!0,hqImageUploads:!0}),expect(this.component.compressionImageQuality()).toBe(.9)})})})})
});
define("test/app/ui/settings/sms_phone_verify_form_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/sms_phone_verify_form",function(){describe("checkDeviceStatus()",function(){xit("",function(){expect("").toBe("")})}),describe("deviceStatusCheckSuccess()",function(){xit("",function(){expect("").toBe("")})}),describe("deviceStatusCheckComplete()",function(){xit("",function(){expect("").toBe("")})}),describe("reloadPage()",function(){xit("",function(){expect("").toBe("")})})})
});
define("test/app/ui/settings/change_photo_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/change_photo",function(){var a='<div id="choose-photo" class="dropdown">\n      <button type="button" class="btn choose-photo-button js-dropdown-toggle" id="profile_image_upload">\n        Change photo\n        <span class="caret"></span>\n      </button>\n      <div class="dropdown-menu">\n        <div class="dropdown-caret">\n          <span class="caret-outer"></span>\n          <span class="caret-inner"></span>\n        </div>\n        <ul>\n          <li id="photo-choose-existing" class="pretty-link dropdown-link"><button type="button" class="dropdown-link">Choose existing photo</button></li>\n          <li id="photo-choose-webcam" class="pretty-link dropdown-link" style="display:none"><button type="button" class="dropdown-link">Take photo</button></li>\n          <li id="photo-delete-image" class="pretty-link dropdown-link"><button type="button" class="dropdown-link">Remove photo</button></li>\n        </ul>\n      </div>\n    </div>\n    <p class="display-file-requirement">Maximum file size of 2MB</p>\n    <p class="display-file-name hidden"></p>\n  ';beforeEach(function(){setupComponent(a,{eventData:{}}),this.triggerDataEvent=function(a,b){$(document).trigger(a,$.extend({sourceEventData:{uploadType:this.component.attr.uploadType}},b))}}),describe("When the dropdown contains a single item",function(){describe("and the dropdown is requested to open",function(){beforeEach(function(){$("#photo-choose-webcam").remove(),$("#photo-delete-image").remove(),spyOnEvent($("#photo-choose-existing"),"click"),this.component.trigger($("#choose-photo"),"uiShouldShowDropdown")}),it("does not open",function(){expect(this.component.isOpen()).toBe(!1)}),it("triggers a click on the item",function(){expect("click").toHaveBeenTriggeredOn($("#photo-choose-existing"))})})}),describe("When the dropdown is open",function(){describe("and is configured to always be open",function(){it("remains open when requested to close.",function(){this.component.attr.alwaysOpen=!0,this.component.trigger($("#choose-photo"),"uiShouldShowDropdown"),this.component.trigger("uiCloseDropdowns"),expect(this.component.isOpen()).toBe(!0)})}),describe("and Flash is required",function(){it("prevents the menu from closing.",function(){var a=this.component.needsMenuHeldOpen;this.component.needsMenuHeldOpen=function(){return!0},this.component.trigger($("#choose-photo"),"uiShouldShowDropdown"),this.component.trigger("uiCloseDropdowns"),expect(this.component.isOpen()).toBe(!0),this.component.needsMenuHeldOpen=a})}),describe("and Flash is not required",function(){it("does not prevent the menu from closing.",function(){this.component.trigger($("#choose-photo"),"uiShouldShowDropdown"),this.component.trigger("uiCloseDropdowns"),expect(this.component.isOpen()).toBe(!1)})}),describe('and the "Take photo" item is clicked',function(){beforeEach(function(){this.component.trigger($("#choose-photo"),"uiShouldShowDropdown")}),it("triggers uiCropperWebcam event.",function(){spyOnEvent(this.component.$node,"uiCropperWebcam"),this.component.select("chooseWebcamSelector").trigger("click"),expect("uiCropperWebcam").toHaveBeenTriggeredOn(this.component.$node)}),describe("and Flash is required",function(){it("allows the menu to close.",function(){var a=this.component.needsMenuHeldOpen;this.component.needsMenuHeldOpen=function(){return!0},this.component.select("chooseWebcamSelector").trigger("click"),this.component.trigger("uiCloseDropdowns"),expect(this.component.isOpen()).toBe(!1),this.component.needsMenuHeldOpen=a})}),describe("and Flash is not required",function(){it("allows the menu to close.",function(){this.component.select("chooseWebcamSelector").trigger("click"),this.component.trigger("uiCloseDropdowns"),expect(this.component.isOpen()).toBe(!1)})})}),describe('and the "Remove photo" item is clicked',function(){describe("without delete confirmation",function(){beforeEach(function(){spyOnEvent(this.$node,"uiDeleteImage"),this.component.select("deleteImageSelector").trigger("click")}),it("triggers uiDeleteImage",function(){expect("uiDeleteImage").toHaveBeenTriggeredOnAndWith(this.$node,{uploadType:this.component.attr.uploadType})}),it("hides the remove item",function(){expect(this.component.select("deleteImageSelector")).toHaveCss("display","none")}),describe("and Flash is required",function(){it("allows the menu to close.",function(){var a=this.component.needsMenuHeldOpen;this.component.needsMenuHeldOpen=function(){return!0},this.component.select("chooseWebcamSelector").trigger("click"),this.component.trigger("uiCloseDropdowns"),expect(this.component.isOpen()).toBe(!1),this.component.needsMenuHeldOpen=a})}),describe("and Flash is not required",function(){it("allows the menu to close.",function(){this.component.select("chooseWebcamSelector").trigger("click"),this.component.trigger("uiCloseDropdowns"),expect(this.component.isOpen()).toBe(!1)})})}),describe("with delete confirmation",function(){beforeEach(function(){setupComponent(a,{confirmDelete:!0,eventData:{}}),spyOnEvent(this.$node,"uiDeleteImage"),spyOnEvent(this.$node,"uiConfirmDeleteImage"),this.component.trigger($("#choose-photo"),"uiShouldShowDropdown"),this.component.select("deleteImageSelector").trigger("click")}),it("prevents the menu from closing.",function(){this.component.trigger("uiCloseDropdowns"),expect(this.component.isOpen()).toBe(!0)}),it("triggers uiConfirmDeleteImage instead of uiDeleteImage.",function(){expect("uiDeleteImage").not.toHaveBeenTriggeredOn(this.$node),expect("uiConfirmDeleteImage").toHaveBeenTriggeredOnAndWith(this.$node,{uploadType:this.component.attr.uploadType})}),it("doesn't hide the remove item.",function(){expect(this.component.select("deleteImageSelector")).not.toHaveCss("display","none")})})}),describe('click "Remove photo" on background',function(){beforeEach(function(){this.component.attr.uploadType="background",this.component.select("deleteImageSelector").trigger("click")}),it("hides the remove item",function(){expect(this.component.select("deleteImageSelector")).toHaveCss("display","none")}),it("hides the file name p tag",function(){expect(this.$node.siblings(".display-file-name")).toHaveCss("display","none")}),it("shows the file requirement p tag",function(){expect(this.$node.siblings(".display-file-requirement")).toHaveCss("display","block")})})}),describe("event uiHideDeleteLink",function(){it('hides the "Remove photo" dropdown item with correct upload type',function(){this.triggerDataEvent("uiHideDeleteLink",{uploadType:"avatar"}),expect(this.component.select("deleteImageSelector")).toHaveCss("display","none")}),it('does not hide the "Remove photo" dropdown item with incorrect upload type',function(){this.triggerDataEvent("uiHideDeleteLink",{uploadType:"header"}),expect(this.component.select("deleteImageSelector")).toHaveCss("display","block")})}),describe("event dataImageEnqueued",function(){beforeEach(function(){this.triggerDataEvent("dataImageEnqueued")}),it('hides the "Remove photo" dropdown item',function(){expect(this.component.select("deleteImageSelector")).toHaveCss("display","none")}),it("hides the toggler button since there is now only one dropdown item available",function(){expect(this.component.select("togglerSelector")).toHaveCss("display","none")})}),describe("event uiImageUploadSuccess",function(){beforeEach(function(){this.component.select("deleteImageSelector").hide(),this.component.select("togglerSelector").hide(),$(document).trigger("uiImageUploadSuccess")}),it('shows the "Remove photo" dropdown item',function(){expect(this.component.select("deleteImageSelector")).not.toHaveCss("display","none")}),it("shows the toggler button since there are now multiple dropdown items available",function(){expect(this.component.select("togglerSelector")).not.toHaveCss("display","none")})}),describe("event uiImagePickerFileReady",function(){it("does not call showDeleteLink when on the header button component",function(){this.component.attr.uploadType="header",spyOn(this.component,"showDeleteLink"),this.triggerDataEvent("uiImagePickerFileReady",{uploadType:"background"}),expect(this.component.showDeleteLink).not.toHaveBeenCalled()}),it("does call showDeleteLink when on the background button component",function(){this.component.attr.uploadType="background",spyOn(this.component,"showDeleteLink"),this.triggerDataEvent("uiImagePickerFileReady",{uploadType:"background"}),expect(this.component.showDeleteLink).toHaveBeenCalled()})}),describe("event uiFileNameReady",function(){it("hides the file requirements",function(){spyOn(this.component,"showFileName"),this.triggerDataEvent("uiFileNameReady",{fileName:"coolTimes.jpg"}),expect(this.$node.siblings(".display-file-requirement")).toHaveCss("display","none")}),it("shows the file name",function(){spyOn(this.component,"showFileName"),this.triggerDataEvent("uiFileNameReady",{fileName:"coolTimes.jpg"}),expect(this.$node.siblings(".display-file-name")).toHaveCss("display","block")}),it("sets the file name text",function(){spyOn(this.component,"showFileName"),this.triggerDataEvent("uiFileNameReady",{fileName:"coolTimes.jpg"}),expect(this.$node.siblings(".display-file-name").text()).toBe("coolTimes.jpg")})}),describe("event dataDeleteImageSuccess",function(){it("triggers uiAlertBanner with the passed message",function(){spyOnEvent(this.$node,"uiAlertBanner"),this.triggerDataEvent("dataDeleteImageSuccess",{message:"success"}),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(this.$node,{message:"success"})})}),describe("event dataDeleteImageFailure",function(){beforeEach(function(){spyOnEvent(this.$node,"uiAlertBanner")}),it("triggers uiAlertBanner with the passed message",function(){this.triggerDataEvent("dataDeleteImageFailure",{message:"failure",sourceEventData:{uploadType:this.component.attr.uploadType}}),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(this.$node,{message:"failure"})}),it("triggers uiAlertBanner with a default message if none is passed",function(){this.triggerDataEvent("dataDeleteImageFailure"),expect("uiAlertBanner").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Sorry! Something went wrong deleting your avatar. Please try again."})}),it('shows the "Remove photo" dropdown item',function(){var a=this.component.select("deleteImageSelector");a.hide(),this.triggerDataEvent("dataDeleteImageFailure"),expect(a).not.toHaveCss("display","none")}),it("shows the toggler button since there are now multiple dropdown item available",function(){this.component.select("toggleSelector").hide(),this.triggerDataEvent("dataDeleteImageFailure"),expect(this.component.select("togglerSelector")).not.toHaveCss("display","none")})}),describe("when the user hovers over the first dropdown item",function(){it("should highlight the caret",function(){var a=this.component.select("caretSelector"),b=this.component.select("firstMenuItemSelector");b.trigger("mouseover"),expect(a).toHaveClass("hover"),b.trigger("mouseout"),expect(a).not.toHaveClass("hover")})}),describe("when the user focuses the first dropdown item",function(){it("should highlight the caret",function(){var a=this.component.select("caretSelector"),b=this.component.select("firstMenuItemSelector").find("button");b.focus(),expect(a).toHaveClass("hover"),b.blur(),expect(a).not.toHaveClass("hover")})})})
});
define("test/app/ui/settings/notifications_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/notifications",function(){var a='<span class="dropdown">\n      <label>\n        <input type="checkbox" value="1" id="field">\n      </label>\n      <select class="email-preference" data-attribute="field">\n         <option value="2">option a</option>\n         <option value="3">option b</option>\n      </select>\n    </span>\n  ';beforeEach(function(){var b=$(a);setupComponent(b,{toggler:".email-preference"})}),it("updates happen when clicking on an item",function(){expect(this.component.$node.find("#field")).toHaveValue("1"),expect(this.component.$node.find("input")).not.toBeChecked(),this.component.select("toggler").val(3),this.component.select("toggler").trigger("change"),expect(this.component.$node.find("#field")).toHaveValue("3"),expect(this.component.$node.find("input")).toBeChecked(),this.component.select("toggler").val(2),this.component.select("toggler").trigger("change"),expect(this.component.$node.find("#field")).toHaveValue("2"),expect(this.component.$node.find("input")).toBeChecked()})})
});
define("test/app/ui/settings/widgets_configurator_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/widgets_configurator",function(){beforeEach(function(){var a="<div></div>\n    ";setupComponent(a)}),describe("preventDefaultTypeahead()",function(){it("should prevent default for click lol",function(){var a=jasmine.createSpy();this.component.preventDefaultTypeahead({preventDefault:a,type:"click"}),expect(a).toHaveBeenCalled()}),it("should prevent default for enter lol",function(){var a=jasmine.createSpy();this.component.preventDefaultTypeahead({preventDefault:a,which:13}),expect(a).toHaveBeenCalled()})}),describe("updateTypeaheadValue()",function(){it("should do call hide and update val",function(){var a=jasmine.createSpy();this.component.$query=$("<input>"),this.component.$dropdown=$("<div>"),spyOn(this.component.$dropdown,"hide"),spyOn(this.component.$query,"val"),this.component.updateTypeaheadValue({},{query:"foo"}),expect(this.component.$dropdown.hide).toHaveBeenCalled(),expect(this.component.$query.val).toHaveBeenCalledWith("foo")})}),describe("setFocus",function(){it("should set the focus on the textarea",function(){this.component.params={focus_textarea:!0},this.component.$code=$("<input>"),this.component.$screenName=$("<input>"),spyOn(this.component.$code,"focus"),spyOn(this.component.$screenName,"focus"),this.component.setFocus(),expect(this.component.$code.focus).toHaveBeenCalled(),expect(this.component.$screenName.focus).not.toHaveBeenCalled()}),it("should set the focus on the correct element",function(){this.params={focus_textarea:!1},this.component.$code=$("<input>"),this.component.$screenName=$("<input>"),spyOn(this.component.$code,"focus"),spyOn(this.component.$screenName,"focus"),this.component.setFocus(),expect(this.component.$code.focus).not.toHaveBeenCalled(),expect(this.component.$screenName.focus).toHaveBeenCalled()})})})
});
define("test/app/ui/settings/tweet_export_download_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/tweet_export_download",function(){beforeEach(function(){var a='<div id="tweet_export_download" class="content-inner no-stream-end">\n        <p><a id="download_tweets" class="btn primary-btn" href="#">{{_i}}Download your Tweets{{/i}}</a></p>\n        <p id="dl_available_msg">Your data will be downloaded as a zip file. Unzip the file, and click \'index.html\' to view your data.</p>\n        <p id="dl_unavailable_msg" class="hidden">You recently downloaded your data. Please walt a little before downloading lt again.</p>\n      </div>\n    ';setupComponent(a)}),describe("download button is enabled",function(){it("triggers uiTweetExportIncrRateLimiter when clicked",function(){spyOnEvent(this.$node,"uiTweetExportIncrRateLimiter"),this.component.select("buttonSelector").click(),expect("uiTweetExportIncrRateLimiter").toHaveBeenTriggeredOn(this.$node)}),it("scribe click action when button enabled",function(){this.component.select("buttonSelector").click(),expect(this.component).toScribe({component:"tweet_export_download",element:"download_tweets",action:"click"})}),it("disables button on dataTweetExportDownloadSuccess",function(){expect(this.component.select("buttonSelector")).not.toHaveAttr("aria-disabled"),this.component.trigger("dataTweetExportDownloadSuccess"),expect(this.component.select("buttonSelector").attr("aria-disabled")).toBe("true")}),it("scribe done action when window has been redirected to the download url link",function(){this.component.trigger("dataTweetExportDownloadSuccess"),expect(this.component).toScribe({component:"tweet_export_download",element:"download_tweets",action:"done"})})}),describe("feature is unavailable",function(){beforeEach(function(){this.component.select("buttonSelector").addClass("feature-unavailable")}),it("triggers uiNeedsTweetExportDialog when clicked",function(){spyOnEvent(this.$node,"uiNeedsTweetExportDialog"),this.component.select("buttonSelector").click(),expect("uiNeedsTweetExportDialog").toHaveBeenTriggeredOn(this.$node)}),it("scribe click action when button enabled",function(){this.component.select("buttonSelector").click(),expect(this.component).toScribe({component:"tweet_export_download",element:"download_tweets",action:"click"})}),it("does not disable button on dataTweetExportDownloadSuccess",function(){expect(this.component.select("buttonSelector")).not.toHaveAttr("aria-disabled"),this.component.trigger("dataTweetExportDownloadSuccess"),expect(this.component.select("buttonSelector")).not.toHaveAttr("aria-disabled")}),it("does not scribe on dataTweetExportDownloadSuccess",function(){this.component.trigger("dataTweetExportDownloadSuccess"),expect(this.component).not.toScribe({component:"tweet_export_download",element:"download_tweets",action:"done"})})}),describe("download button is disabled",function(){beforeEach(function(){this.component.select("buttonSelector").attr("aria-disabled",!0)}),it("does not trigger uiTweetExportResendButtonClicked on button click",function(){spyOnEvent(this.$node,"uiTweetExportIncrRateLimiter"),this.component.select("buttonSelector").click(),expect("uiTweetExportIncrRateLimiter").not.toHaveBeenTriggeredOn(this.$node)}),it("does not trigger uiNeedsTweetExportDialog on button click",function(){spyOnEvent(this.$node,"uiNeedsTweetExportDialog"),this.component.select("buttonSelector").click(),expect("uiNeedsTweetExportDialog").not.toHaveBeenTriggeredOn(this.$node)}),it("scribe click action when button enabled",function(){this.component.select("buttonSelector").click(),expect(this.component).not.toScribe({component:"tweet_export_download",element:"download_tweets",action:"click"})}),it("continues showing disabled button on dataTweetExportDownloadSuccess",function(){expect(this.component.select("buttonSelector").attr("aria-disabled")).toBe("true"),this.component.trigger("dataTweetExportDownloadSuccess"),expect(this.component.select("buttonSelector").attr("aria-disabled")).toBe("true")}),it("does not scribe on dataTweetExportDownloadSuccess",function(){this.component.trigger("dataTweetExportDownloadSuccess"),expect(this.component).not.toScribe({component:"tweet_export_download",element:"download_tweets",action:"done"})})}),describe("dataTweetExportDownloadError",function(){it("disables button",function(){this.component.trigger("dataTweetExportDownloadError"),expect(this.component.select("buttonSelector")).toHaveAttr("aria-disabled")}),it("scribe rate_limit action",function(){this.component.trigger("dataTweetExportDownloadError"),expect(this.component).toScribe({component:"tweet_export_download",element:"download_tweets",action:"rate_limit"})})})})
});
define("test/app/ui/settings/widgets_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/widgets",function(){beforeEach(function(){var a="<div></div>\n    ";setupComponent(a)}),describe("clickDelete()",function(){it("should trigger uiOpenConfirmDialog",function(){spyOnEvent(this.component.node,"uiOpenConfirmDialog"),this.component.clickDelete(jQuery.Event("click")),expect("uiOpenConfirmDialog").toHaveBeenTriggeredOn(this.component.node)})})})
});
define("test/app/ui/settings/facebook_iframe_height_adjuster_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/facebook_iframe_height_adjuster",function(){beforeEach(function(){setupComponent('<div><iframe id="fb-iframe"></iframe></div>')}),it("should not have a data-facebook-frame-loaded attribute",function(){expect(this.$node).not.toHaveAttr("data-facebook-frame-loaded")}),typeof window.postMessage=="function"&&it("should adjust the height of #fb-iframe to the height attribute",function(){window.postMessage(JSON.stringify({height:199}),"*"),waitsFor(function(){return $("#fixture_parent").css("width",$("#fixture_parent").width()),this.component.select("iframeSelector").attr("data-facebook-frame-loaded")==="true"&&this.component.select("iframeSelector").css("height")=="199px"}.bind(this),2e3),runs(function(){expect(this.component.select("iframeSelector")).toHaveAttr("data-facebook-frame-loaded"),expect(this.component.select("iframeSelector").css("height")).toEqual("199px")})})})
});
define("test/app/ui/settings/tweet_export_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/tweet_export",function(){describe("with download button",function(){beforeEach(function(){var a='<div id="tweet_export">\n          <p><button type="button" class="btn" id="export_button">Request your archive</button></p>\n          <p id="export_ready">Click this button to request a file containing ail of your Tweets. When your file is ready, we\'ll email you a link to download it.</p>\n          <p id="export_in_queue" class="hidden">You recently requested a download. Please wait a few days before requesting another one.</p>\n        </div>\n      ';setupComponent(a)}),it("triggers uiTweetExportButtonClicked when clicked",function(){spyOnEvent(this.$node,"uiTweetExportButtonClicked"),this.component.select("exportButtonSelector").click(),expect("uiTweetExportButtonClicked").toHaveBeenTriggeredOn(this.$node)}),it("scribes when clicked",function(){this.component.select("exportButtonSelector").click(),expect(this.component).toScribe({component:"tweet_export",element:"export_button",action:"click"})})}),describe("with resend button",function(){beforeEach(function(){var a='<div id="tweet_export">\n          <p><button type="button" class="btn" id="export_resend_button">Resend email</button></p>\n          <p id="export_resend_instructions">Your download is ready, and we\'ve emailed you a link to it. If you didn\'t receive the email, click the button above to resend it.</p>\n          <p id="export_resend_success" class="hidden">Check your email for instructions on downloading your Tweets</p>\n        </div>\n      ';setupComponent(a)}),it("triggers uiTweetExportResendButtonClicked when clicked",function(){spyOnEvent(this.$node,"uiTweetExportResendButtonClicked"),this.component.select("resendButtonSelector").click(),expect("uiTweetExportResendButtonClicked").toHaveBeenTriggeredOn(this.$node)}),it("scribes when clicked",function(){this.component.select("resendButtonSelector").click(),expect(this.component).toScribe({component:"tweet_export",element:"export_resend_button",action:"click"})})}),describe("with grayed out button",function(){beforeEach(function(){var a='<div id="tweet_export">\n          <p><button type="button" class="btn" id="export_resend_button" disabled>Resend email</button></p>\n          <p>You recently requested a download. Please wait a few days before requesting another one.</p>\n        </div>\n      ';setupComponent(a)}),describe("click grayed out button",function(){it("does not trigger events",function(){spyOnEvent(this.$node,"uiTweetExportResendButtonClicked"),spyOnEvent(this.$node,"uiTweetExportButtonClicked"),this.component.select("resendButtonSelector").click(),expect("uiTweetExportButtonClicked").not.toHaveBeenTriggeredOn(this.$node),expect("uiTweetExportResendButtonClicked").not.toHaveBeenTriggeredOn(this.$node)})})})})
});
define("test/app/ui/settings/facebook_missing_permissions_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/facebook_missing_permissions",function(){beforeEach(function(){var a='<div id="facebook-missing-permissions" class="facebook-container hidden">\n        <p>\n          <img src="{{profile_image_url_https}}" title="Twitter: {{name}}" class="twitter-avatar"/>\n          <span class="arrow"></span>\n          <img src="//graph.facebook.com/{{profile_id}}/picture?type=square" class="facebook-avatar"/>\n        </p>\n        <p>\n          {{_i}}The following permissions are needed to post to Facebook:{{/i}}\n        </p>\n        <ul id="missing-permissions-list">\n          <li class="explanation hidden publish_actions publish_stream"><p>{{_i}}Post on your behalf to your profile.{{/i}}</p></li>\n          <li class="explanation hidden manage_pages"><p>{{_i}}Manage pages to post to your page(s).{{/i}}</p></li>\n        </ul>\n        <div class="actions">\n          <button id="grant-permissions-btn" class="btn primary-btn">\n            {{_i}}Allow{{/i}}\n          </button>\n          <button id="disconnect-btn" class="btn">\n            {{_i}}Disconnect{{/i}}\n          </button>\n        </div>\n      </div>\n     ';setupComponent(a)}),it("should trigger fbLoginNeeded upon clicking the allow button",function(){expect(this.$node).toHaveClass("hidden"),spyOnEvent(this.$node,"fbLoginNeeded"),this.component.select("grantPermissionsBtnSelector").trigger("click"),expect("fbLoginNeeded").toHaveBeenTriggeredOnAndWith(this.$node,{scribeContext:{element:"grant_permissions_button"}})}),it("should trigger fbDisconnectNeeded upon clicking the allow button",function(){expect(this.$node).toHaveClass("hidden"),spyOnEvent(this.$node,"fbDisconnectNeeded"),this.component.select("disconnectBtnSelector").trigger("click"),expect("fbDisconnectNeeded").toHaveBeenTriggeredOnAndWith(this.$node,{scribeContext:{element:"disconnect_button"}})}),it("should remove class 'hidden' upon fbPermissionsMissing",function(){$(document).trigger("fbPermissionsMissing",{}),expect(this.component.$node).not.toHaveClass("hidden"),expect(this.component.select("avatarSelector")).toHaveClass("blank")}),it("should update the profile's avatar with provided profile data uoon fbPermissionsMissing",function(){$(document).trigger("fbPermissionsMissing",{profile:{id:123}}),expect(this.component.select("avatarSelector").attr("src")).toEqual("//graph.facebook.com/123/picture?type=square")}),it("should only show missing permissions upon fbPermissionsMissing",function(){$(document).trigger("fbPermissionsMissing",{connected:{permissions:{missing:["publish_actions"]}}}),expect(this.component.select(".publish_actions")).not.toHaveClass("hidden"),expect(this.component.select(".manage_pages")).not.toHaveClass("hidden")})})
});
define("test/app/ui/settings/facebook_spinner_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/facebook_spinner",function(){beforeEach(function(){var a='<div id="facebook-spinner" class="facebook-container hidden">\n        <span class="facebook-avatar facebook-logo"></span> {{_i}}Contacting Facebook{{/i}}\n      </div>\n    ';setupComponent(a)}),it("should remove class 'hidden' upon uiSwiftLoaded",function(){$(document).trigger("uiSwiftLoaded",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbLoginNeeded",function(){$(document).trigger("fbLoginNeeded",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbPagePermissionsNeeded",function(){$(document).trigger("fbPagePermissionsNeeded",{}),expect(this.component.$node).not.toHaveClass("hidden")})})
});
define("test/app/ui/settings/facebook_connect_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/facebook_connect",function(){beforeEach(function(){var a='<div id="facebook-connect" class="facebook-container hidden">\n        {{>settings/facebook_banner}}\n        <p>\n          <span class="facebook-avatar facebook-logo"></span>\n          <button class="btn fb-btn">\n            {{_i}}Connect to Facebook{{/i}}\n          </button>\n        </p>\n        <p>\n          {{_i}}Post Tweets to your Facebook profile or page.{{/i}}\n        </p>\n      </div>\n    ';setupComponent(a)}),it("should trigger fbLoginNeeded upon clicking the login button",function(){expect(this.$node).toHaveClass("hidden"),spyOnEvent(this.$node,"fbLoginNeeded"),this.component.select("loginBtnSelector").trigger("click"),expect("fbLoginNeeded").toHaveBeenTriggeredOnAndWith(this.$node,{scribeContext:{element:"connect_button"}})}),it("should remove class 'hidden' upon fbReconnectionError",function(){$(document).trigger("fbReconnectionError",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbStatusNotConnected",function(){$(document).trigger("fbStatusNotConnected",{}),expect(this.component.$node).not.toHaveClass("hidden")})})
});
define("test/app/ui/settings/facebook_connection_conflict_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/facebook_connection_conflict",function(){beforeEach(function(){var a='<div id="facebook-connection-conflict" class="facebook-container hidden">\n        <div class="explanation"></div>\n        <p>\n          {{_i}}Or login to another Facebook profile.{{/i}}\n        </p>\n        <p>\n          <span class="facebook-avatar facebook-logo"></span>\n          <button class="btn fb-btn">\n            {{_i}}Login to Facebook{{/i}}\n          </button>\n        </p>\n      </div>\n    ';setupComponent(a)}),it("should trigger fbReloginNeeded upon clicking the login button",function(){expect(this.$node).toHaveClass("hidden"),spyOnEvent(this.$node,"fbReloginNeeded"),this.component.select("reloginBtnSelector").trigger("click"),expect("fbReloginNeeded").toHaveBeenTriggeredOnAndWith(this.$node,{scribeContext:{element:"relogin_button"}})}),it("should call show upon fbConnectionConflict",function(){$(document).trigger("fbConnectionConflict",{}),expect(this.component.$node).not.toHaveClass("hidden"),$(document).trigger("fbConnectionConflict",{html:'<p class="something">My explanation</p>'}),expect(this.component.select("explanationSelector").html()).toEqual('<p class="something">My explanation</p>')})})
});
define("test/app/ui/settings/login_verification_sms_check_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/login_verification_sms_check",function(){beforeEach(function(){var a='<fieldset class="control-group" id="login_verification_controls">\n        <label for="user_requires_login_verification" class="control-label">\n          Account security\n        </label>\n        <div class="controls" id="login_verification_controls">\n          <div class="control-list">\n            <label class="radio">\n              <input id="sms_login_verification" name="login_verification_type" type="radio" value="sms">Require a verification code when I sign in.\n              <input type="hidden" id="sms_login_verification_enabled" value="false">\n            </label>\n            <input name="user[requires_login_verification]" type="hidden" value="0">\n          </div>\n          <div class="login-verification-spinner"></div>\n            <p>After you sign in, Twitter will send a code to your phone that you\'ll need to access your account. Once activated, you will need to <a href="/settings/applications">generate a temporary password</a> to sign in to your Twitter account on other devices and apps. <a href="https://support.twitter.com">Learn more</a></p>\n        </div>\n      </fieldset>\n    ';setupComponent(a)}),it("should trigger uiOpenLoginVerificationConfirmationDialog when unchecked radio is clicked",function(){spyOnEvent(this.component.$node,"uiOpenLoginVerificationConfirmationDialog"),this.component.select("loginVerificationRadioSelector").trigger("click"),expect("uiOpenLoginVerificationConfirmationDialog").toHaveBeenTriggeredOn(this.component.$node)}),it("should do nothing when the hidden value is present",function(){this.component.select("loginVerificationEnabledSelector").val("true"),spyOnEvent(this.$node,"uiOpenLoginVerificationConfirmationDialog"),this.component.select("loginVerificationRadioSelector").trigger("click"),expect("uiOpenLoginVerificationConfirmationDialog").not.toHaveBeenTriggeredOn(this.component.$node)}),it("should check the radio when uiCheckLoginVerification is triggered on document",function(){$(document).trigger("uiCheckLoginVerification",{}),expect(this.component.$node.find("#sms_login_verification")).toBeChecked()})})
});
define("test/app/ui/settings/device_verified_form_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/device_verified_form",function(){beforeEach(function(){var a='<div>\n        <div class="checkbox activity-notifications-rts"></div>\n        <div class="activity-notifications-favs"></div>\n        <div class="message-notifications-mentions"></div>\n        <div class="sleep-settings"></div>\n        <input class="secure-field" type="checkbox">\n      </div>\n    ';setupComponent(a)}),it("should require a password after changing secure field",function(){expect(this.$node.hasClass("requires-password")).toBeFalsy(),this.component.select("secureField").trigger("click"),expect(this.$node.hasClass("requires-password")).toBeTruthy()})})
});
define("test/app/ui/settings/facebook_login_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/facebook_login",function(){beforeEach(function(){var a='<div id="facebook-login" class="facebook-container hidden">\n        {{>settings/facebook_banner}}\n        <p>\n          <img src="//graph.facebook.com/{{profile_id}}/picture?type=square" class="facebook-avatar"/>\n          <button class="btn fb-btn">\n            {{_i}}Login to Facebook{{/i}}\n          </button>\n        </p>\n        <p>\n          {{_i}}to manage your connection with Facebook.{{/i}}\n        </p>\n      </div>\n    ';setupComponent(a)}),it("should trigger fbLoginNeeded upon clicking the login button",function(){expect(this.$node).toHaveClass("hidden"),spyOnEvent(this.$node,"fbLoginNeeded"),this.component.select("loginBtnSelector").trigger("click"),expect("fbLoginNeeded").toHaveBeenTriggeredOnAndWith(this.$node,{scribeContext:{element:"login_button"}})}),it("should remove class 'hidden' upon fbLogoutError",function(){$(document).trigger("fbLogoutError",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbConnectionError",function(){$(document).trigger("fbConnectionError",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbStatusNotLoggedIn",function(){$(document).trigger("fbStatusNotLoggedIn",{}),expect(this.component.$node).not.toHaveClass("hidden")})})
});
define("test/app/ui/settings/facebook_mismatched_connection_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/facebook_mismatched_connection",function(){beforeEach(function(){var a='<div id="facebook-mismatched-connection" class="facebook-container hidden">\n        <p>\n          {{_i}}You\'re currently logged in to Facebook with a different account than the one\n          you have linked to Twitter:{{/i}}\n        </p>\n        <div class="facebook-account-group">\n          <img class="facebook-avatar connected-avatar"/> <span class="connected-name"></span>\n        </div>\n        <p>\n          {{_i}}Please log in to <span class="profile-name"></span>\'s Facebook account to proceed.{{/i}}\n        </p>\n        <p>\n          <img {{#profile_id}}src="//graph.facebook.com/{{profile_id}}/picture?type=square"{{/profile_id}} class="facebook-avatar"/>\n          <button class="btn fb-btn">\n            {{_i}}Login to Facebook{{/i}}\n          </button>\n        </p>\n      </div>\n    ';setupComponent(a)}),it("should trigger fbReloginNeeded upon clicking the login button",function(){expect(this.$node).toHaveClass("hidden"),spyOnEvent(this.$node,"fbReloginNeeded"),this.component.select("loginBtnSelector").trigger("click"),expect("fbReloginNeeded").toHaveBeenTriggeredOnAndWith(this.$node,{scribeContext:{element:"login_button"}})}),it("should remove class 'hidden' upon fbStatusConnectionMismatch",function(){$(document).trigger("fbStatusConnectionMismatch",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should update profile info with provided profile data upon fbStatusConnectionMismatch",function(){$(document).trigger("fbStatusConnectionMismatch",{profile:{name:"Larry",id:"123"}}),expect(this.component.$node).not.toHaveClass("hidden"),expect(this.component.select("profileNameSelector").text()).toEqual("Larry"),expect(this.component.select("profileImgSelector").attr("src")).toEqual("//graph.facebook.com/123/picture?type=square")}),it("should update connected info with provided connected data upon fbStatusConnectionMismatch",function(){$(document).trigger("fbStatusConnectionMismatch",{connected:{name:"Jack",id:"321"}}),expect(this.component.$node).not.toHaveClass("hidden"),expect(this.component.select("connectedNameSelector").text()).toEqual("Jack"),expect(this.component.select("connectedImgSelector").attr("src")).toEqual("//graph.facebook.com/321/picture?type=square")})})
});
define("test/app/ui/settings/sms_phone_create_form_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/sms_phone_create_form",function(){beforeEach(function(){var a='<div>\n        <span id="carrier-message-jawwal-ps">jawwal message</span>\n        <span id="carrier-message-wataniya-ps">wataniya message</span>\n        <span id="carrier-message-no-mt">no MT message</span>\n        <input id="device_carrier_name">\n        <span id="country_code_display"></span>\n        <input id="device_country_intl_prefix">\n        <div id="choose-carrier"><select></select></div>\n        <div id="choose-country"><select></select></div>\n        <div id="choose-language"><select></select></div>\n      </div>\n    ';setupComponent(a,{carrierInfo:{carriers:{Canada:[]},languages:{Canada:[{display:"English",value:"en"},{display:"Français",value:"fr"}]}},defaultCountry:{country:"United States",code:"+1"}})}),it("shows/hides carrier messages when changing carrier",function(){this.component.$chooseCountrySelect.trigger("uiItemSelect",{text:"Palestinian Territories",value:"+970"}),this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"jawwal_ps",text:"Jawwal"}),expect(this.component.$carrierMessageJawwal.is(":visible")).toBeTruthy(),expect(this.component.$carrierMessageWataniya.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageNoMT.is(":visible")).toBeFalsy(),this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"wataniya_ps",text:"Wataniya"}),expect(this.component.$carrierMessageJawwal.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageWataniya.is(":visible")).toBeTruthy(),expect(this.component.$carrierMessageNoMT.is(":visible")).toBeFalsy(),this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"some_carrier",text:"Some Carrier",mt_limit:"0"}),expect(this.component.$carrierMessageJawwal.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageWataniya.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageNoMT.is(":visible")).toBeTruthy(),this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"some_carrier",text:"Some Carrier",mt_limit:"100"}),expect(this.component.$carrierMessageJawwal.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageWataniya.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageNoMT.is(":visible")).toBeFalsy(),this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"some_carrier",text:"Some Carrier",mt_sms_limit:"0"}),expect(this.component.$carrierMessageJawwal.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageWataniya.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageNoMT.is(":visible")).toBeTruthy(),this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"some_carrier",text:"Some Carrier",mt_sms_limit:"100"}),expect(this.component.$carrierMessageJawwal.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageWataniya.is(":visible")).toBeFalsy(),expect(this.component.$carrierMessageNoMT.is(":visible")).toBeFalsy()}),it("updates carrier name field after changing carrier",function(){this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"some_carrier",text:"Some Carrier"}),jasmine.Clock.useMock(),jasmine.Clock.tick(1),expect(this.component.$carrierName.attr("value")).toBe("Some Carrier")}),it("empties carrier name fields after changing to a country with no carrier dropdown",function(){this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"some_carrier",text:"Some Carrier"}),jasmine.Clock.useMock(),jasmine.Clock.tick(1),this.component.$chooseCountrySelect.trigger("uiItemSelect",{text:"United Kingdom",value:"+1"}),expect(this.component.$carrierName.attr("value")).toBe("")}),it("updates country field after changing country",function(){this.component.$chooseCountrySelect.trigger("uiItemSelect",{text:"Canada",value:"+1"}),jasmine.Clock.useMock(),jasmine.Clock.tick(1),expect(this.component.$countryCodeDisplay.html()).toBe("+1"),expect(this.component.$countryCodeValue.val()).toBe("+1")})})
});
define("test/app/ui/settings/facebook_connected_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/settings/facebook_connected",function(){beforeEach(function(){var a='<div id="facebook-connected" class="facebook-container hidden">\n        {{>settings/facebook_banner}}\n        <p>{{_i}}Your account is connected to Facebook.{{/i}} <a id="disconnect-link" href="#">{{_i}}Disconnect it.{{/i}}</a></p>\n        <div class="facebook-account-group">\n          <img src="{{profile_image_url_https}}" title="Twitter: {{name}}" class="twitter-avatar"/>\n          <span class="arrow"></span>\n          <img src="//graph.facebook.com/{{profile_id}}/picture?type=square" class="facebook-avatar"/>\n        </div>\n        <p>{{_i}}Allow Twitter to:{{/i}}</p>\n        <div id="facebook-retweet" class="facebook-option">\n          <label>\n            <input type="checkbox">\n            <span>{{_i}}post retweets to Facebook{{/i}}</span>\n          </label>\n        </div>\n        <div id="facebook-profile" class="facebook-option">\n          <label>\n            <input checked type="checkbox">\n            <span>{{_i}}post to my Facebook profile{{/i}}</span>\n          </label>\n        </div>\n        <div id="facebook-page" class="facebook-option">\n          <p>\n            {{_i}}<a href="#">Allow</a> posting to one of your pages.{{/i}}\n          </p>\n          <div>\n            <label>\n              <input disabled type="checkbox">\n              <span>{{_i}}post to my Facebook page:{{/i}}</span>\n            </label>\n            <blockquote class="facebook-dropdown">\n              <select>\n                <option value="0">{{_i}}(select page){{/i}}</option>\n              </select>\n            </blockquote>\n          </div>\n        </div>\n        <p class="facebook-footnote">{{_i}}@Replies and direct messages will not be posted.{{/i}}</p>\n      </div>\n     ';setupComponent(a)}),it("should remove class 'hidden' upon fbPermissionsGranted",function(){$(document).trigger("fbPermissionsGranted",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbPagePermissionsMissing",function(){$(document).trigger("fbPagePermissionsMissing",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbProfileCrosspostingCompleted",function(){$(document).trigger("fbProfileCrosspostingCompleted",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbProfileCrosspostingError",function(){$(document).trigger("fbProfileCrosspostingError",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbPageCrosspostingCompleted",function(){$(document).trigger("fbPageCrosspostingCompleted",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbPageCrosspostingError",function(){$(document).trigger("fbPageCrosspostingError",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbRetweetCrosspostingCompleted",function(){$(document).trigger("fbRetweetCrosspostingCompleted",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should remove class 'hidden' upon fbRetweetCrosspostingError",function(){$(document).trigger("fbRetweetCrosspostingError",{}),expect(this.component.$node).not.toHaveClass("hidden")}),it("should trigger fbDisconnectNeeded upon clicking the disconnect button",function(){spyOnEvent(this.$node,"fbDisconnectNeeded"),this.component.select("disconnectSelector").trigger("click"),expect("fbDisconnectNeeded").toHaveBeenTriggeredOnAndWith(this.component,{scribeContext:{element:"disconnect_link"}})}),describe("toggle cross posting to the Facebook profile",function(){it("should trigger fbProfileCrosspostingChanged",function(){spyOnEvent(this.$node,"fbProfileCrosspostingChanged"),this.component.select("profileCheckBoxSelector").trigger("click"),expect("fbProfileCrosspostingChanged").toHaveBeenTriggeredOnAndWith(this.component,{crossPosting:!0,scribeContext:{element:"profile_check_box"}})}),it("should add the xhr class to the parent .facebook-option",function(){var a=this.component.select("profileCheckBoxSelector");a.trigger("click"),expect(a.parents(this.component.attr.optionSelector)).toHaveClass("xhr")})}),it("should trigger fbPagePermissionsNeeded upon clicking the grant page permissions link",function(){spyOnEvent(this.$node,"fbPagePermissionsNeeded"),this.component.select("pageGrantPermissionSelection").trigger("click"),expect("fbPagePermissionsNeeded").toHaveBeenTriggeredOnAndWith(this.component,{scribeContext:{element:"allow_page_access_link"}})}),describe("selecting a different page to cross post to",function(){it("should trigger fbPageCrosspostingChanged",function(){spyOnEvent(this.$node,"fbPageCrosspostingChanged"),this.component.select("pageDropDownSelector").trigger("change"),expect("fbPageCrosspostingChanged").toHaveBeenTriggeredOnAndWith(this.component,{pageId:"0",crossPosting:!1,scribeContext:{element:"page_dropdown"}})}),it("should add the xhr class to the parent .facebook-option",function(){var a=this.component.select("pageDropDownSelector");a.trigger("change"),expect(a.parents(this.component.attr.optionSelector)).toHaveClass("xhr")}),it("should disable page check box when no page was selected",function(){this.component.select("pageCheckBoxSelector").attr("disabled",!1),this.component.select("pageDropDownSelector").trigger("change"),expect(this.component.select("pageCheckBoxSelector")).toBeDisabled()})}),describe("toggle cross posting to the Facebook page",function(){it("should trigger fbPageCrosspostingChanged",function(){spyOnEvent(this.$node,"fbPageCrosspostingChanged"),this.component.select("pageCheckBoxSelector").trigger("click"),expect("fbPageCrosspostingChanged").toHaveBeenTriggeredOnAndWith(this.component,{pageId:"0",crossPosting:!1,scribeContext:{element:"page_check_box"}})}),it("should add the xhr class to the parent .facebook-option",function(){var a=this.component.select("pageCheckBoxSelector");a.trigger("click"),expect(a.parents(this.component.attr.optionSelector)).toHaveClass("xhr")})}),describe("toggle cross posting of retweets",function(){it("should trigger fbRetweetCrosspostingChanged",function(){spyOnEvent(this.$node,"fbRetweetCrosspostingChanged"),this.component.select("retweetCheckBoxSelector").trigger("click"),expect("fbRetweetCrosspostingChanged").toHaveBeenTriggeredOnAndWith(this.component,{crossPosting:!1,scribeContext:{element:"retweet_check_box"}})}),it("should add the xhr class to the parent .facebook-option",function(){var a=this.component.select("retweetCheckBoxSelector");a.trigger("click"),expect(a.parents(this.component.attr.optionSelector)).toHaveClass("xhr")})}),describe("XSS vulnerability",function(){it("should be fixed",function(){spyOn(window,"alert"),this.component.showConnected({permissions:{granted:["manage_pages"]},accounts:[{category:"page",name:"<script>alert('powned')</script>",id:1}]},"0"),expect(window.alert).not.toHaveBeenCalled()})})})
});
define("test/app/ui/account/resend_password_help_controls_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/account/resend_password_help_controls",{fixture:"test/fixtures/resend_password_help"},function(){beforeEach(function(){setupComponent(this.fixture)}),describe("yes button",function(){it("shows request SMS blurb if phone hint was correct",function(){this.component.showStep("verifyPhoneSelector"),this.component.select("yesButtonSelector").click(),expect(this.component.select("verifyPhoneSelector")).not.toBeVisible(),expect(this.component.select("requestSmsSelector")).toBeVisible()}),it("shows resend email option if email hint was correct",function(){this.component.showStep("verifyDomainSelector"),this.component.select("yesButtonSelector").click(),expect(this.component.select("verifyDomainSelector")).not.toBeVisible(),expect(this.component.select("resendEmailSelector")).toBeVisible()}),it("triggers uiResendPassword if user wanted to resend email",function(){spyOnEvent(document,"uiResendPassword"),this.component.showStep("resendEmailSelector"),this.component.select("yesButtonSelector").click(),expect("uiResendPassword").toHaveBeenTriggeredOn(document)}),it("triggers uiChoosePasswordResendType with alternate type if user wanted to resend by alternate type",function(){spyOnEvent(document,"uiChoosePasswordResendType"),this.component.showStep("alternateChoiceSelector"),this.component.select("yesButtonSelector").click(),expect("uiChoosePasswordResendType").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({try_resend_by:"phone"}))})}),describe("no button",function(){it("shows contact support link and triggers uiResendPasswordHelpNoButtonClicked if phone hint was incorrect",function(){spyOnEvent(document,"uiResendPasswordHelpNoButtonClicked"),this.component.showStep("verifyPhoneSelector"),this.component.select("noButtonSelector").click(),expect("uiResendPasswordHelpNoButtonClicked").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({helpState:"phone_hint"})),expect(this.component.select("verifyPhoneSelector")).not.toBeVisible(),expect(this.component.select("contactSupportSelector")).toBeVisible()}),it("shows contact support link and triggers uiResendPasswordHelpNoButtonClicked if email hint was incorrect",function(){spyOnEvent(document,"uiResendPasswordHelpNoButtonClicked"),this.component.showStep("verifyDomainSelector"),this.component.select("noButtonSelector").click(),expect("uiResendPasswordHelpNoButtonClicked").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({helpState:"email_hint"})),expect(this.component.select("verifyDomainSelector")).not.toBeVisible(),expect(this.component.select("contactSupportSelector")).toBeVisible()}),it("shows contact support link and triggers uiResendPasswordHelpNoButtonClicked if user does not have access to email",function(){spyOnEvent(document,"uiResendPasswordHelpNoButtonClicked"),this.component.showStep("resendEmailSelector"),this.component.select("noButtonSelector").click(),expect("uiResendPasswordHelpNoButtonClicked").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({helpState:"email_access"})),expect(this.component.select("resendEmailSelector")).not.toBeVisible(),expect(this.component.select("contactSupportSelector")).toBeVisible()}),it("triggers uiChoosePasswordResendType with same type if user wanted to resend by same type",function(){spyOnEvent(document,"uiChoosePasswordResendType"),this.component.showStep("alternateChoiceSelector"),this.component.select("noButtonSelector").click(),expect("uiChoosePasswordResendType").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({try_resend_by:"email"}))})})})
});
define("test/app/ui/account/resend_password_controls_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/account/resend_password_controls",function(){beforeEach(function(){var a='<div id="resend_password">\n        <button id="lookup_user">\n        <div id="captcha_dialog"></div>\n      </div>\n    ';setupComponent(a,{submitSelector:"#lookup_user"})}),describe("submit",function(){it("triggers uiOpenCaptchaDialog event on submit",function(){spyOnEvent(document,"uiOpenCaptchaDialog"),this.component.trigger("submit"),expect("uiOpenCaptchaDialog").toHaveBeenTriggeredOn(document)}),it("does not trigger uiOpenCaptchaDialog event when dialog opened",function(){this.component.dialogOpen=!0,spyOnEvent(document,"uiOpenCaptchaDialog"),this.component.trigger("submit"),expect("uiOpenCaptchaDialog").not.toHaveBeenTriggeredOn(document)}),it("triggers uiCloseDialog event when dialog opened and form submits",function(){this.component.dialogOpen=!0,spyOnEvent(document,"uiCloseDialog"),this.component.trigger("submit"),expect("uiCloseDialog").toHaveBeenTriggeredOn(document)}),it("does not trigger uiOpenCaptchaDialog event when captcha element does not exist",function(){$("#captcha_dialog").remove(),spyOnEvent(document,"uiOpenCaptchaDialog"),this.component.trigger("submit"),expect("uiOpenCaptchaDialog").not.toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/feedback/feedback_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/feedback/feedback_dialog",function(){var a='<div id="feedback_dialog" style="display: none;" class="modal-container feedback-dialog">\n  <div class="close-modal-background-target"></div>\n  <div class="modal draggable">\n    <div class="modal-content">\n      <button class="modal-btn modal-close"><i class="close-medium"><span class="visuallyhidden">{{_i}}Close{{/i}}</span></i></button>\n      <div class="modal-header">\n          <h3 class="modal-title">\n            {{_i}}Feedback{{/i}}\n          </h3>\n      </div>\n      <div class="modal-body">\n        {{! ------ TABS ------- }}\n        <ul class="nav-tabs">\n          <li data-tab-name="report">\n            <a href="#">\n              <i class="configurator-user"></i>{{_i}}Report{{/i}}\n            </a>\n          </li>\n          <li data-tab-name="debug">\n            <a href="#"><i class="configurator-search"></i>{{_i}}Debug{{/i}}</a>\n          </li>\n        </ul>\n\n        {{! ------ REPORT TAB CONTENT ------- }}\n        <div class="modal-inner report">\n          <form>\n            <fieldset class="common-form">\n              {{! Summary field}}\n              <div class="feedback-summary-label">\n                <label class="to-label" for="summary">{{_i}}Summary:{{/i}}</label>\n                <div class="placeholding-input">\n                  <input class="text-input" type="text" name="summary" maxlength="150" placeholder="{{_i}}Briefly describe the problem{{/i}}">\n                </div>\n              </div>\n              <span class="error summary-error">{{_i}}Summary Required{{/i}}</span>\n            </fieldset>\n            <fieldset class="common-form field">\n              {{! Comments text area}}\n              <span class="error description-error">{{_i}}Description Required{{/i}}</span>\n              <textarea class="feedback-comments flex-table-input" name="comments" rows="1" placeholder="{{_i}}Comments{{/i}}"></textarea>\n            </fieldset>\n            <div class="sample-content">{{! To be populated by JS}}</div>\n            <div class="modal-footer">\n              <label><input type="checkbox" name="includeScreenshot" checked> {{_i}}Include full-page screenshot?{{/i}}</label>\n              <a href="#" target="_blank" id="feedback-preview-screenshot">({{_i}}Preview{{/i}})</a>\n              <button type="button" class="btn cancel">{{_i}}Cancel{{/i}}</button>\n              <a class="report-link"><button type="submit" class="btn report primary-btn done">{{_i}}Report{{/i}}</button></a>\n            </div>\n          </form>\n        </div>\n\n        {{! ------ DEBUG TAB CONTENT ------- }}\n        <div class="modal-inner debug">\n          {{#is_feedback_enabled}}\n            {{_i}}Debug key to show:{{/i}} <select name="debug-key"></select>\n            <br><br>\n            <button id="select-paste-text">{{_i}}Select All Text{{/i}}</button><br>\n            <textarea readonly="true" class="feedback-json-output flex-table-input">\n            </textarea>\n            <br>\n            <div class="modal-footer">\n              <button class="btn primary-btn feedback-data-toggle on">{{_i}}Disable debug{{/i}}</button>\n            </div>\n          {{/is_feedback_enabled}}\n          {{^is_feedback_enabled}}\n            {{_i}}To see debug data, click the button below. Note that this will have a performance impact and refresh the page.{{/i}}<br><br>\n            <div class="modal-footer">\n              <button class="btn primary-btn feedback-data-toggle off">{{_i}}Enable debug{{/i}}</button>\n            </div>\n          {{/is_feedback_enabled}}\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n';beforeEach(function(){setupComponent(a),this.mockData={status:[{data:{test:"yes"},html:'<span class="status_content"></span>'},{data:{test:"yes x2"},html:'<span class="status_content_2"></span>'}]}}),describe("takeScreenshot",function(){it("is triggered when uiPrepareFeedbackDialog triggered",function(){spyOn(this.component,"takeScreenshot").andReturn(!0),this.component.trigger("uiPrepareFeedbackDialog",{debugKey:"key_1",projectKey:"team_1"}),expect(this.component.debugKey).toBe("key_1"),expect(this.component.projectKey).toBe("team_1"),expect(this.component.takeScreenshot).toHaveBeenCalled()})}),describe("uiToggleDebugFeedback",function(){it("is triggered to enable feedback when click on the toggle is off",function(){spyOnEvent(this.$node,"uiToggleDebugFeedback"),this.$node.find(".feedback-data-toggle.off").click(),expect("uiToggleDebugFeedback").toHaveBeenTriggeredOnAndWith(this.$node,{enabled:!0})}),it("is triggered to diabled feedback when click on the toggle is on",function(){this.component.trigger("dataDebugFeedbackChanged",{enabled:!0}),spyOnEvent(this.$node,"uiToggleDebugFeedback"),this.$node.find(".feedback-data-toggle.on").click(),expect("uiToggleDebugFeedback").toHaveBeenTriggeredOnAndWith(this.$node,{enabled:!1})})}),describe("dataFeedback",function(){it("sets the content container if the key matches",function(){var a=this.component.select("contentContainerSelector");this.component.debugKey="status",this.component.trigger("dataFeedback",this.mockData),expect(a).toContain(".status_content"),expect(a).toContain(".status_content_2")}),it("empties the content container if no key",function(){this.component.debugKey="status";var a=this.component.select("contentContainerSelector");this.component.trigger("dataFeedback",this.mockData),expect(a).toContain(".status_content"),this.component.debugKey="status",this.component.trigger("dataFeedback",{}),expect(a).not.toContain(".status_content")}),it("keeps the data object",function(){this.component.trigger("dataFeedback",this.mockData),expect(this.component.debugData).toEqual(this.mockData)}),it("logs to the console output if there is data",function(){spyOn(console,"dir"),this.component.trigger("dataFeedback",this.mockData),expect(console.dir).toHaveBeenCalledWith(this.mockData)}),it("hides the error fields from the inputs",function(){this.component.trigger("dataFeedback",{}),expect(this.component.select("summaryErrorSelector")).toBeHidden(),expect(this.component.select("descriptionErrorSelector")).toBeHidden()}),it("pops up the debug window if set in the cookie",function(){document.cookie=this.component.attr.lastTabCookie+"=debug;expires=Thu, 01 Jan 2020 00:00:00 GMT; path=/",this.component.trigger("dataFeedback",this.mockData),expect(this.component.select("contentContainerSelector")).toBeHidden(),expect(this.component.select("debugContainerSelector")).toBeVisible(),this.component.select("navBarTabSelector").click(),expect(document.cookie).toMatch(this.component.attr.lastTabCookie+"=report")}),it("refreshes the select options when opened",function(){this.component.trigger("dataFeedback",this.mockData),expect(this.component.select("debugKeySelectorSelector").html()).toBe("<option>status</option>"),this.component.debugKey="status",this.component.trigger("dataFeedback",this.mockData),expect(this.component.select("debugKeySelectorSelector").html()).toBe('<option value="status">status (selected)</option>')}),it("changes the JSON content when the selected key is changed",function(){this.component.debugKey="status",this.component.trigger("dataFeedback",{status:[{data:{test:"yes"}}],status2:[{data:{test:"maybe"}}]}),expect(this.component.select("pastedContentSelector").html().replace(/\s/g,"")).toBe('[{"test":"yes"}]'),this.component.select("debugKeySelectorSelector").val("status2").change(),expect(this.component.select("pastedContentSelector").html().replace(/\s/g,"")).toBe('[{"test":"maybe"}]')})}),describe("click to Report button",function(){beforeEach(function(){setupComponent(a,{reportEmail:"email@example.com",reportScreenshotProxyUrl:null})}),it("shows the required text for summary if not present",function(){this.component.trigger("dataFeedback",{});var a=this.component.select("summaryErrorSelector");expect(a).toBeHidden(),this.component.select("descriptionInputSelector").val("description"),this.component.select("reportLinkSelector").click(),expect(a).toBeVisible(),expect(this.component.select("descriptionErrorSelector")).toBeHidden()}),it("shows the required text for description if not present",function(){this.component.trigger("dataFeedback",{});var a=this.component.select("descriptionErrorSelector");expect(a).toBeHidden(),this.component.select("summaryInputSelector").val("summary"),this.component.select("reportLinkSelector").click(),expect(a).toBeVisible(),expect(this.component.select("summaryErrorSelector")).toBeHidden()}),it("does not submit a screenshot when the checkbox is deselected",function(){this.component.trigger("dataFeedback",{}),this.component.select("summaryInputSelector").val("summary"),this.component.select("descriptionInputSelector").val("description"),spyOnEvent(this.$node,"uiFeedbackBackendPost"),this.component.imageCanvas={},this.component.imageCanvas.toDataURL=function(){},spyOn(this.component.imageCanvas,"toDataURL").andReturn("screenshot"),this.$node.find("input[name=includeScreenshot]").attr("checked",!1);var a=this.component.select("reportLinkSelector");a.click(),expect("uiFeedbackBackendPost").toHaveBeenTriggeredOnAndWith(this.$node,{summary:"summary",comments:"description"})}),it("triggers a backend post with appropriate data when report clicked",function(){this.component.trigger("dataFeedback",{}),this.component.select("summaryInputSelector").val("summary"),this.component.select("descriptionInputSelector").val("description"),spyOnEvent(this.$node,"uiFeedbackBackendPost"),this.component.imageCanvas={},this.component.imageCanvas.toDataURL=function(){},spyOn(this.component.imageCanvas,"toDataURL").andReturn("screenshot");var a=this.component.select("reportLinkSelector");a.click(),expect(this.$node.select("reportLinkSelector").find("button")).toBe(".disabled"),expect(this.$node.select("spinnerSelector")).toBeVisible(),expect("uiFeedbackBackendPost").toHaveBeenTriggeredOnAndWith(this.$node,{summary:"summary",comments:"description",includeScreenshot:"on",screenshotData:"screenshot"})}),it("recieves JIRA ticket and displays it when API available",function(){var a={data:{debug_text:"test"},link:"http://example.com",ticketId:"test-1"};spyOnEvent(this.$node,"uiShowError"),ajaxRespondWithError({}),this.component.trigger("dataFeedbackBackendSuccess",a),runs(function(){expect(this.component.node).not.toBeVisible(),expect("uiShowError").toHaveBeenTriggeredOnAndWith(this.$node,{message:"Successfully created Jira ticket: <a target='_blank' href='"+a.link+"'>"+a.ticketId+"</a>"})})}),it("pops up the debug data text and generates email link when API unavailable",function(){var a={data:{debug_text:"test"},link:"mailto:someone@example.com"};spyOn(window,"open").andReturn("OK!"),ajaxRespondWithError({}),this.component.trigger("dataFeedbackBackendFailure",a),expect(window.open).toHaveBeenCalledWith(a.link,"_blank")})})})
});
define("test/app/ui/feedback/feedback_report_link_handler_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/feedback/feedback_report_link_handler",function(){var a='<button type="button" class="btn-link feedback-btn report-link" data-feedback-key="key_1" data-team-key="team_1"></button>\n';beforeEach(function(){setupComponent(a)}),it("triggers uiPrepareFeedbackDialog when clicked",function(){spyOnEvent(this.$node,"uiPrepareFeedbackDialog"),this.$node.select("reportElementLinkSelector").click(),expect("uiPrepareFeedbackDialog").toHaveBeenTriggeredOnAndWith(this.$node,{debugKey:"key_1",projectKey:"team_1"})})})
});
define("test/app/ui/signup_download/us_phone_number_checker_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/signup_download/us_phone_number_checker",function(){beforeEach(function(){var a='<input class="input-medium" type="text" value="" name="device[address]" id="device_address" placeholder="xxx-xxx-xxxx">';setupComponent(a)}),it("removes country code 1",function(){var a=this.component.$node;a.val("1234"),a.keyup(),expect(a.val()).toEqual("234")}),it("truncates overlength numbers",function(){var a=this.component.$node;a.val("1234567890123"),a.keyup(),expect(a.val()).toEqual("234-567-8901")}),it("truncates overlength numbers",function(){var a=this.component.$node;a.val("1234567890123"),a.keyup(),expect(a.val()).toEqual("234-567-8901")}),it("4 digits 1 dash",function(){var a=this.component.$node;a.val("4156"),a.keyup(),expect(a.val()).toEqual("415-6")}),it("8 digits 2 dashes",function(){var a=this.component.$node;a.val("41512389"),a.keyup(),expect(a.val()).toEqual("415-123-89")})})
});
define("test/app/ui/signup_download/next_and_skip_buttons_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/signup_download/next_and_skip_buttons",function(){beforeEach(function(){var a='<div class="content-placeholder">          <h3 class="title">What\'s your phone number?</h3>          <p>We\'ll send you a link to download the Twitter app. We’ll also activate Twitter text messaging so you can tweet by texting. Standard message rates apply. Others will be able to find you by your phone number.</p>          <br>          <div id="settings-alert-box" class="alert" style="display: none;">          </div>          <div class="input-prepend">            <label class="add-on" id="country_code_display">+1</label>            <input class="input-medium" type="text" value="" name="device[address]" id="device_address" placeholder="xxx-xxx-xxxx">          </div>          <p class="placeholder-actions">            <input class="btn primary-btn next" type="submit" value="Send link to my phone">            <a class="btn skip" href="http://localhost.twitter.com:3000/welcome">Skip</a>         </p>      </div>';setupComponent(a)}),it("scribes when next button clicked",function(){var a=this.component.$node.find(".next").trigger("click");expect(this.component).toScribe({component:"next_button",action:"click"})}),it("scribes when skip button clicked",function(){var a=this.component.$node.find(".skip").trigger("click");expect(this.component).toScribe({component:"skip_button",action:"click"})})})
});
define("test/app/ui/timelines/with_most_recent_story_pagination_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_most_recent_story_pagination",function(){beforeEach(function(){setupComponent()}),describe("#modifyCursorsFromResponse",function(){describe("when scrolling request",function(){beforeEach(function(){this.component.latest_request_cursor="pending_rc",this.component.refresh_cursor="rc",this.component.scroll_cursor="sc",this.data={scroll_cursor:"new_sc",is_scrolling_request:!0},this.component.modifyCursorsFromResponse(this.data)}),it("should set data.refresh_cursor to the new scroll_cursor",function(){expect(this.data.refresh_cursor).toBe("new_sc")}),it("should not modify data.scroll_cursor",function(){expect(this.data.scroll_cursor).toBe("new_sc")}),it("should set the latest_request_cursor to the new scroll_cursor",function(){expect(this.component.latest_request_cursor).toBe("new_sc")})}),describe("when refresh request",function(){beforeEach(function(){this.component.latest_request_cursor="pending_rc",this.component.refresh_cursor="rc",this.component.scroll_cursor="sc",this.data={refresh_cursor:"new_rc",is_refresh_request:!0},this.component.modifyCursorsFromResponse(this.data)}),it("should set data.refresh_cursor to the current refresh_cursor",function(){expect(this.data.refresh_cursor).toBe("rc")}),it("should set data.scroll_cursor to the new refresh_cursor",function(){expect(this.data.scroll_cursor).toBe("new_rc")}),it("should set the latest_request_cursor to the new refresh_cursor",function(){expect(this.component.latest_request_cursor).toBe("new_rc")})})}),describe("#updateCursorsAfterInjection",function(){beforeEach(function(){this.component.latest_request_cursor="new_rc",this.component.refresh_cursor="rc",this.component.scroll_cursor="sc",this.component.updateCursorsAfterInjection()}),it("should set the refresh_cursor to the latest_request_cursor",function(){expect(this.component.refresh_cursor).toBe(this.component.latest_request_cursor)}),it("should set the scroll_cursor to the latest_request_cursor",function(){expect(this.component.scroll_cursor).toBe(this.component.latest_request_cursor)})})})
});
define("test/app/ui/timelines/with_pinned_stream_items_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_pinned_stream_items",function(){var a="<div>\n      <ul class='stream-items'>\n        <li id='item5' class='js-stream-item'></li>\n        <li id='item4' class='js-stream-item before-expanded'></li>\n        <li id='item1' class='js-stream-item open js-pinned before-expanded'></li>\n        <li id='item2' class='js-stream-item open js-pinned after-expanded'></li>\n        <li id='item3' class='js-stream-item after-expanded'></li>\n      </ul>\n    </div>\n  ",b="<div>\n      <ul class='stream-items'>\n        <li id='item5' class='js-stream-item'></li>\n        <li id='item4' class='js-stream-item'></li>\n        <li id='item3' class='js-stream-item'></li>\n      </ul>\n    </div>\n  ";beforeEach(function(){setupComponent(a,{itemsSelector:".stream-items"})}),describe("#keepPinnedStreamItemsOnTop",function(){describe("timeline has no pinned tweets",function(){beforeEach(function(){this.$node.html(b),this.component.keepPinnedStreamItemsOnTop(),this.$reorderedItems=this.$node.find(".js-stream-item")}),it("does not re-order items",function(){var a=$.makeArray(this.$reorderedItems.map(function(){return this.id}));expect(a).toEqual(["item5","item4","item3"])}),it("does not add before-expanded class to items",function(){var a=$.makeArray(this.$reorderedItems.map(function(){return $(this).hasClass("before-expanded")}));expect(a).toEqual([!1,!1,!1])}),it("does not add after-expanded class to items",function(){var a=$.makeArray(this.$reorderedItems.map(function(){return $(this).hasClass("after-expanded")}));expect(a).toEqual([!1,!1,!1])})}),describe("timeline has pinned tweets",function(){beforeEach(function(){this.component.keepPinnedStreamItemsOnTop(),this.$reorderedItems=this.$node.find(".js-stream-item")}),it("moves pinned tweets to the top",function(){var a=$.makeArray(this.$reorderedItems.map(function(){return this.id}));expect(a).toEqual(["item1","item2","item5","item4","item3"])}),it("removes after-expanded class from first old item",function(){expect(this.$node.find("#item3")).not.toHaveClass("after-expanded")}),it("adds after-expanded class to first new item",function(){expect(this.$node.find("#item5")).toHaveClass("after-expanded")}),it("removes before-expanded class from last new item",function(){expect(this.$node.find("#item3")).not.toHaveClass("before-expanded")}),it("removes margin-top from first pinned tweet",function(){expect(this.$reorderedItems.eq(0)).toHaveCss("margin-top","0px")})})})})
});
define("test/app/ui/timelines/discover_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/timelines/discover_timeline",function(){describe("event uiPageChanged",function(){beforeEach(function(){this.navigate=function(){this.component.trigger("uiPageChanged",{fromCache:!0})},spyOnEvent(document,"uiTimelineShouldRefresh")}),describe("with attr refreshOnReturn true (default)",function(){it("triggers uiTimelineShouldRefresh",function(){setupComponent(),this.navigate(),expect("uiTimelineShouldRefresh").toHaveBeenTriggeredOn(document)})}),describe("with attr refreshOnReturn false",function(){it("does not trigger uiTimelineShouldRefresh",function(){setupComponent({refreshOnReturn:!1}),this.navigate(),expect("uiTimelineShouldRefresh").not.toHaveBeenTriggeredOn(document)})}),describe("with onlyShowMostRecentStories decider enabled",function(){beforeEach(function(){setupComponent({discoverDeciders:{onlyShowMostRecentStories:!0}})}),describe("#resetStateVariables",function(){describe("when refresh request",function(){beforeEach(function(){this.component.resetStateVariables({is_refresh_request:!0,refresh_cursor:"new_rc"})}),it("should save latest_request_cursor",function(){expect(this.component.latest_request_cursor).toBe("new_rc")})})}),describe("#resetStateVariables",function(){describe("when scrolling request",function(){beforeEach(function(){this.component.resetStateVariables({is_scrolling_request:!0,scroll_cursor:"new_sc"})}),it("should save latest_request_cursor",function(){expect(this.component.latest_request_cursor).toBe("new_sc")})})}),describe("#getNewItems",function(){beforeEach(function(){this.component.latentItems={count:10,html:"<p>test</p>"},this.component.getNewItems({})}),it("should set count to 0",function(){expect(this.component.latentItems.count).toBe(0)}),it("should empty html",function(){expect(this.component.latentItems.html).toBe("")})}),describe("event uiHasInjectedNewTimeline",function(){beforeEach(function(){this.component.latest_request_cursor="new_rc",this.component.refresh_cursor="rc",this.component.scroll_cursor="sc",this.component.trigger("uiHasInjectedNewTimeline")}),it("should update refresh_cursor",function(){expect(this.component.refresh_cursor).toBe(this.component.latest_request_cursor)}),it("should update scroll_cursor",function(){expect(this.component.scroll_cursor).toBe(this.component.latest_request_cursor)})})})}),describe("event uiStoryPaginationReset",function(){beforeEach(function(){setupComponent({discoverDeciders:{discoRefreshCookieEnabled:!0},refreshCookiePath:"/"}),document.cookie=this.component.attr.refreshCookieKey+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}),it("store cursor when set",function(){this.component.refresh_cursor="cookie",$(document).trigger("uiStoryPaginationReset"),expect(document.cookie).toMatch(this.component.attr.refreshCookieKey+"=cookie")}),it("not store cursor when empty",function(){this.component.refresh_cursor=null,$(document).trigger("uiStoryPaginationReset"),expect(document.cookie).not.toMatch(this.component.attr.refreshCookieKey+"=cookie")})})})
});
define("test/app/ui/timelines/with_min_max_pagination_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_min_max_pagination",function(){var a='<div>\n       <div class="test-values" data-min-position="6" data-max-position="7"></div>\n       <div class="test-empty" data-min-position="" data-max-position=""></div>\n    </div>\n  ';describe("when initialized",function(){it("it sets state variables from container",function(){setupComponent(a,{containerSelector:".test-values"}),expect(this.component.min_position).toBe("6"),expect(this.component.max_position).toBe("7")}),it("it sets state variables to undefined when container values are empty",function(){setupComponent(a,{containerSelector:".test-empty"}),expect(this.component.max_position).toBe(undefined),expect(this.component.min_position).toBe(undefined)})}),describe("when resetStateVariables is called",function(){var a;beforeEach(function(){setupComponent(),a=$('<div class="stream-container" data-max-position="1" data-min-position="2">'),$("body").append(a)}),afterEach(function(){$(".stream-container").remove()}),it("it updates the corresponding data- attributes for min_position and max_position",function(){this.component.select=function(){return a},this.component.resetStateVariables({max_position:"3",min_position:"4"}),expect($(".stream-container").attr("data-max-position")).toBe("3"),expect($(".stream-container").attr("data-min-position")).toBe("4")})}),describe("#shouldGetOldItems",function(){beforeEach(setupComponent),it("returns true if this.mix_position is not null",function(){this.component.min_position="0",expect(this.component.shouldGetOldItems()).toBeTruthy()}),it("returns false if this.min_position is null",function(){this.component.min_position=null,expect(this.component.shouldGetOldItems()).toBeFalsy()})}),describe("#getOldItemsData",function(){describe("max_position",function(){it("is set to the current min_position",function(){setupComponent(a,{containerSelector:".test-values"}),expect(this.component.min_position).toBe("6"),expect(this.component.getOldItemsData().max_position).toEqual("6")})})}),describe("#getNewItemsData",function(){describe("min_position",function(){it("is set to the current max_position",function(){setupComponent(a,{containerSelector:".test-values"}),expect(this.component.max_position).toBe("7"),expect(this.component.getNewItemsData().min_position).toEqual("7")})})})})
});
define("test/app/ui/timelines/universal_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/timelines/universal_timeline",function(){var a='<div id="timeline">\n      <div class="stream-container">\n        <div class="stream">\n          <ol class="stream-items">\n            <li class="js-stream-item stream-item" data-item-type="tweet">\n              <div class="tweet original-tweet js-actionable-tweet" data-impression-id="IMPRESSION_1" data-tweet-id="12345"></div>\n            </li>\n            <li class="js-stream-item stream-item  stream-user-gallery separation-module js-has-navigable-stream">\n              <ol class="big-avatar-list top-users-3 stream-items js-navigable-stream">\n                <li class="list-item js-list-item js-actionable-user js-stream-item stream-item user-gallery-item " data-screen-name="twitter" data-user-id="783214" data-item-id="783214" id="stream-item-user-783214" data-item-type="user">\n                </li>\n              </ol>\n            </li>\n            <li class="js-stream-item stream-item" data-user-id="101" data-item-type="user">\n              <div class="account promoted-account" data-user-id="101" data-impression-id="IMPRESSION_2"</div>\n            </li>\n            <li class="js-stream-item stream-item" data-item-type="tweet">\n              <div class="tweet original-tweet js-actionable-tweet" data-impression-id="IMPRESSION_1" data-tweet-id="12345">\n                <span class="media-thumbnail" data-height="1000" data-width="800" data-url="url"></span>\n                <div>hola</div>\n              </div>\n            </li>\n          </ol>\n        </div>\n      </div>\n    </div>\n  ',b={containerUserId:"101",impressionId:"IMPRESSION_2",isMentionClick:!1,isPromotedBadgeClick:!1,isReplyTo:!1,itemType:"user",position:3,userId:"101",profileClickTarget:"screen_name"},c={scribeContext:{},scribeData:{},tweetId:"12345",isReplyTo:!1,impressionId:"IMPRESSION_1",position:0,isMentionClick:!1,isPromotedBadgeClick:!1,itemType:"tweet",profileClickTarget:"screen_name"};describe("initialize",function(){beforeEach(function(){spyOnEvent(document,"uiTweetsDisplayed"),spyOnEvent(document,"uiUsersDisplayed"),setupComponent(a)}),it("triggers uiTweetsDisplayed",function(){var a={tweets:[c]};expect("uiTweetsDisplayed").toHaveBeenTriggeredOn(document,jasmine.objectContaining(a))}),it("triggers uiUsersDisplayed",function(){var a={users:[b]};expect("uiUsersDisplayed").toHaveBeenTriggeredOn(document,jasmine.objectContaining(a))})}),describe("update events",function(){function d(a){var d={items:[c,b]};it("triggers uiTweetsDisplayed",function(){this.component.trigger(a,d),expect("uiTweetsDisplayed").toHaveBeenTriggeredOn(document,jasmine.objectContaining({tweets:[c]}))}),it("triggers uiUsersDisplayed",function(){this.component.trigger(a,d),expect("uiUsersDisplayed").toHaveBeenTriggeredOn(document,jasmine.objectContaining({users:[b]}))})}beforeEach(function(){spyOnEvent(document,"uiTweetsDisplayed"),spyOnEvent(document,"uiUsersDisplayed"),setupComponent(a)}),d("uiHasInjectedNewTimeline"),d("uiHasInjectedOldTimelineItems"),d("uiHasInjectedRangeTimelineItems")}),describe("setItemType",function(){var b=$(a).find(".stream-item[data-item-type=tweet]"),c=$(a).find(".stream-item[data-item-type=user][data-user-id=101]"),d=$(a).find(".user-gallery-item");beforeEach(function(){setupComponent(a),this.component.attr.itemType="",this.component.attr.eventData.scribeContext.component=""}),it("sets it to tweet",function(){this.component.setItemType(b),expect(this.component.attr.itemType).toBe("tweet"),expect(this.component.attr.eventData.scribeContext.component).toBe("tweet")}),it("sets it to user",function(){this.component.setItemType(c),expect(this.component.attr.itemType).toBe("user"),expect(this.component.attr.eventData.scribeContext.component).toBe("user")}),it("sets item type to user and component to user_gallery",function(){this.component.setItemType(d),expect(this.component.attr.itemType).toBe("user"),expect(this.component.attr.eventData.scribeContext.component).toBe("user_gallery")})}),describe("prevToModuleClass",function(){beforeEach(function(){setupComponent(a)}),it("sets the given class on the previous item",function(){var a=this.$node.find(".stream-items li:first-child");expect(a.hasClass(this.component.attr.prevToModuleClass)).toBe(!0)})}),describe("clicking on media in universal timeline",function(){beforeEach(function(){spyOnEvent(document,"uiOpenGallery"),setupComponent(a)}),it("triggers uiOpenGallery",function(){var a=this.$node.find(".media-thumbnail");a.click(),expect("uiOpenGallery").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/ui/timelines/with_tweet_pagination_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_tweet_pagination",function(){var a='<div>\n       <div class="test-values" data-since-id="6" data-max-id="7"></div>\n       <div class="test-empty" data-since-id="" data-max-id=""></div>\n       <div id="stream-items-id"></div>\n    </div>\n  ',b='<div>\n       <div id="stream-items-id">\n         <div class="stream-item"></div>\n       </div>\n    </div>\n  ';describe("when initialized",function(){it("it sets state variables from container",function(){setupComponent(a,{containerSelector:".test-values"}),expect(this.component.max_id).toBe("7"),expect(this.component.since_id).toBe("6")}),it("it sets state variables to undefined when container values are empty",function(){setupComponent(a,{containerSelector:".test-empty"}),expect(this.component.max_id).toBe(undefined),expect(this.component.since_id).toBe(undefined)})}),describe("when resetStateVariables is called",function(){var a;beforeEach(function(){setupComponent(),a=$('<div class="stream-container" data-max-id="1" data-since-id="2">'),$("body").append(a)}),afterEach(function(){$(".stream-container").remove()}),it("it updates the corresponding data- attributes for since_id and max_id",function(){this.component.select=function(){return a},this.component.resetStateVariables({max_id:"3",since_id:"4"}),expect($(".stream-container").attr("data-max-id")).toBe("3"),expect($(".stream-container").attr("data-since-id")).toBe("4")})}),describe("#shouldGetOldItems",function(){beforeEach(setupComponent),it("returns true if this.max_id is not set",function(){this.component.max_id=null,expect(this.component.shouldGetOldItems()).toBeTruthy()}),it("returns true if this.max_id is greater than -1",function(){this.component.max_id="0",expect(this.component.shouldGetOldItems()).toBeTruthy()}),it("returns false if this.max_id is -1",function(){this.component.max_id="-1",expect(this.component.shouldGetOldItems()).toBeFalsy()})}),describe("#getNewItemsData",function(){describe("timeline_empty",function(){it("is falsy if timeline has items",function(){setupComponent(b,{itemsSelector:"#stream-items-id"}),expect(this.component.getNewItemsData().timeline_empty).toBeFalsy()}),it("is truthy if timeline does not have items",function(){setupComponent(a,{itemsSelector:"#stream-items-id"}),expect(this.component.getNewItemsData().timeline_empty).toBeTruthy()})})})})
});
define("test/app/ui/timelines/with_keyboard_navigation_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_keyboard_navigation",function(){var a,b=function(a){while(a-->0)$(document).trigger("uiShortcutSelectNext")},c=function(a){while(a-->0)$(document).trigger("uiShortcutSelectPrev")};beforeEach(function(){var b='<ol class="stream-items js-navigable-stream">\n        <li id="item-1" class=\'stream-item js-stream-item js-activity-follow\' data-item-id="1">\n          <div class="tweet" data-tweet-id="1">\n            <div class="stream-item-header"></div>\n            <div class="tweet-text">One</div>\n            <div class="context"></div>\n            <div class="stream-item-footer">\n              <ul class="tweet-actions js-actions">\n                <li class="action-reply-container">\n                  <a role="button" class="with-icn js-action-reply" data-modal="tweet-reply" href="#"></a>\n                </li>\n                <li class="action-rt-container js-toggle-state js-toggle-rt">\n                  <a role="button" class="with-icn retweet" data-modal="tweet-retweet" href="#"></a>\n                  <a role="button" class="with-icn undo-retweet" data-modal="tweet-retweet" href="#" title="Undo retweet"></a>\n                </li>\n                <li class="action-fav-container js-toggle-state js-toggle-fav">\n                  <a role="button" class="with-icn favorite" href="#"></a>\n                  <a role="button" class="with-icn unfavorite" href="#" title="Undo favorite"></a>\n                </li>\n              </ul>\n            </div>\n            <div class="expanded-content"></div>\n          </div>\n        </li>\n\n        <li id="item-2" class=\'stream-item js-stream-item\' data-item-id="2">\n          <div class=\'js-stream-tweet my-tweet\'>Two</div>\n        </li>\n\n        <li id="item-3" class=\'stream-item js-stream-item js-activity-mention\' data-item-id="3">\n          <div class=\'js-stream-tweet\' data-user-id=12 data-name=\'dude\'>Three</div>\n          <a class=\'reply-link\'/>\n        </li>\n\n        <li id="item-4" class=\'stream-item js-stream-item js-activity-reply\' data-item-id="4">\n          <div class=\'js-stream-tweet\' data-user-id=12 data-name=\'dude\'>Four</div>\n        </li>\n\n        <li id="item-5" class=\'stream-item js-stream-item\' data-item-id="5">\n          <div class=\'js-stream-tweet\' data-user-id=25 data-name=\'gal\'>Five</div>\n        </li>\n\n        <li id="item-6" class=\'stream-item js-stream-item\' data-item-id="6">\n          <div class=\'js-stream-tweet\' data-user-id=25 data-name=\'gal\'>Six <a href="#" class="js-nav"></a></div>\n        </li>\n\n        <li id="item-7" class=\'stream-item js-stream-item js-has-navigable-stream\' data-item-id="7">Seven\n          <ol class=\'js-navigable-stream\'>\n            <li id="item-7-1">One</li>\n            <li id="item-7-2">Two</li>\n            <li id="item-7-3">Three</li>\n          </ol>\n        </li>\n\n        <li id="item-8" class=\'stream-item js-stream-item\'>\n          <div class=\'js-stream-tweet\' data-user-id=25 data-name=\'gal\'>Eight <a href="#" class="js-nav"></a></div>\n        </li>\n\n      </ol>\n    ';setupComponent(b,{genericItemSelector:".js-stream-item",replyLinkSelector:".reply-link"}),a=this.component.$node.children()}),it("acquires the selected item from the markup, if specified",function(){this.component.$node.children().eq(4).addClass(this.component.attr.selectedClass),setupComponent(this.component.$node,{genericItemSelector:".js-stream-item",replyLinkSelector:".reply-link"}),expect(this.component.$selected).toBe(a.get(4))}),it("ignores the clicked item when an item is clicked",function(){a.eq(4).find("[data-name=gal]").click(),expect(this.component.$selected).not.toBe(a.get(4))}),it("selects the clicked item when an item is clicked and keyboard is being used for nav",function(){b(1),a.eq(4).find("[data-name=gal]").click(),expect(this.component.$selected).toBe(a.get(4))}),it("selects the top item when uiShortcutSelectNext is triggered on document",function(){b(1),expect(this.component.$selected).toBe(a.get(0)),expect(this.component.$selected).toBeFocused()}),it("selects the top item when uiShortcutSelectPrev is triggered on document",function(){c(1),expect(this.component.$selected).toBe(a.get(0)),expect(this.component.$selected).toBeFocused()}),it("selects in sequential order forward and backward given interleaved uiShortcutSelect<> events",function(){b(1),expect(this.component.$selected).toBe(a.get(0)),b(2),expect(this.component.$selected).toBe(a.get(2)),c(2),expect(this.component.$selected).toBe(a.get(0)),b(4),expect(this.component.$selected).toBe(a.get(4)),c(7),expect(this.component.$selected).toBe(a.get(0)),b(1),expect(this.component.$selected).toBe(a.get(1)),$(document).trigger("uiShortcutGotoTopOfScreen"),expect(this.component.$selected).toBe(a.get(0))}),describe("when an item is selected and the background is clicked",function(){beforeEach(function(){b(1),$("body").click()}),it("deselects the current item",function(){expect(this.component.$selected).not.toBe(a.get(0)),expect(this.component.$node.find(this.component.attr.selectedClass)).not.toExist()}),it("makes the previously focusable element no longer focusable",function(){expect(this.component.$node.find("li[tabindex=-1]")).not.toExist()}),it('removes the "aria-labelledby" attribute from the previously selected stream item',function(){expect(this.component.$node.find("li[aria-labelledby]")).not.toExist()})}),it("requests an expansion toggle on an item only when it has been keyboard-selected",function(){var c=jasmine.createSpy();a.slice(3,4).bind("uiShouldToggleExpandedState",c),expect(c.callCount).toBe(0),b(3),$(document).trigger("uiShortcutEnter"),expect(c.callCount).toBe(0),b(1),$(document).trigger("uiShortcutEnter"),expect(c.callCount).toBe(1),$(document).trigger("uiShortcutEnter"),expect(c.callCount).toBe(2),b(1),$(document).trigger("uiShortcutEnter"),expect(c.callCount).toBe(2)}),describe("when uiGotoTopOfScreen is triggered",function(){beforeEach(function(){spyOn(this.component,"clearSelection").andCallThrough(),spyOnEvent(document,"uiInjectNewItems"),spyOn(this.component,"selectAdjacentItem").andCallThrough()}),afterEach(function(){this.component.clearSelection()}),describe("and a tweet is currently selected",function(){beforeEach(function(){b(1),$(document).trigger("uiGotoTopOfScreen")}),it("clears the current selection",function(){expect(this.component.clearSelection).toHaveBeenCalled()}),it("triggers uiInjectNewItems",function(){expect("uiInjectNewItems").toHaveBeenTriggeredOn(document)}),it("selects the first item",function(){expect(this.component.selectAdjacentItem).toHaveBeenCalled()})}),describe("and no tweet is currently selected",function(){beforeEach(function(){$(document).trigger("uiGotoTopOfScreen")}),it("does not attempt to clear the current selection",function(){expect(this.component.clearSelection).not.toHaveBeenCalled()}),it("triggers uiInjectNewItems",function(){expect("uiInjectNewItems").toHaveBeenTriggeredOn(document)}),it("does not select the first item",function(){expect(this.component.selectAdjacentItem).not.toHaveBeenCalled()})})}),describe("favorite keyboard shortcut",function(){beforeEach(function(){spyOnEvent(a.get(0),"uiDidFavoriteTweetToggle")}),it("triggers uiDidFavoriteTweetToggle on selected item on uiShortcutFavorite",function(){b(1),$(document).trigger("uiShortcutFavorite"),expect("uiDidFavoriteTweetToggle").toHaveBeenTriggeredOn(a.get(0))})}),describe("retweet keyboard shortcut",function(){beforeEach(function(){spyOnEvent(a.get(1),"uiDidRetweetTweetToggle"),spyOnEvent(a.get(2),"uiDidRetweetTweetToggle")}),it("triggers uiDidRetweetTweetToggle on selected item on uiShortcutRetweet",function(){b(3),$(document).trigger("uiShortcutRetweet"),expect("uiDidRetweetTweetToggle").toHaveBeenTriggeredOn(a.get(2))}),it("does nothing if it's my tweet",function(){b(2),$(document).trigger("uiShortcutRetweet"),expect("uiDidRetweetTweetToggle").not.toHaveBeenTriggeredOn(a.get(1))})}),describe("reply keyboard shortcut",function(){beforeEach(function(){spyOnEvent(a.find(".reply-link").first(),"uiDidReplyTweetToggle")}),it("triggers uiDidReplyTweetToggle on selected item on uiShortcutReply",function(){b(3),$(document).trigger("uiShortcutReply"),expect("uiDidReplyTweetToggle").toHaveBeenTriggeredOn(a.find(".reply-link").first())})}),describe("block keyboard shortcut",function(){beforeEach(function(){spyOnEvent(document,"uiBlockAction"),spyOnEvent(document,"uiOpenBlockUserDialog")}),it("does nothing if it's my tweet",function(){b(2),$(document).trigger("uiShortcutBlock"),expect("uiOpenBlockUserDialog").not.toHaveBeenTriggeredOn(a.get(1))}),it("does nothing if it's not a js-stream-tweet or a js-activity-mention",function(){b(1),$(document).trigger("uiShortcutBlock"),expect("uiOpenBlockUserDialog").not.toHaveBeenTriggeredOn(a.get(0))}),it("requests confirmation dialog to be displayed",function(){b(4),$(document).trigger("uiShortcutBlock"),expect("uiOpenBlockUserDialog").toHaveBeenTriggeredOnAndWith(a.get(3),{userId:"12",username:"dude",fromShortcut:!0})})}),describe("updating the UI after blocking",function(){beforeEach(function(){spyOnEvent(document,"uiRemoveTweetsFromUser"),b(3)}),it("does nothing if on the profile page",function(){var a="<div class='profile-card'></div>\n        <div>\n          <div class='js-stream-item'>One</div>\n        </div>\n      ";setupComponent(a,{genericItemSelector:".js-stream-item",replyLinkSelector:".reply-link"}),$(document).trigger("uiUpdateAfterBlock"),expect("uiRemoveTweetsFromUser").not.toHaveBeenTriggeredOn(document)}),it("selects the next tweet not from the blocked user",function(){$(document).trigger("uiUpdateAfterBlock",{userId:"12"}),expect(this.component.$selected).toBe(a.get(4))}),it("selects the previous tweet not from the blocked user if end of stream is reached",function(){b(1),this.component.trigger(this.component.$node.find("#item-8"),"uiSelectItem"),$(document).trigger("uiUpdateAfterBlock",{userId:"25"}),expect(this.component.$selected.attr("id")).toBe("item-7-3")}),it("triggers uiRemoveTweetsFromUser",function(){var a={userId:"32"};$(document).trigger("uiUpdateAfterBlock",a),expect("uiRemoveTweetsFromUser").toHaveBeenTriggeredOnAndWith(document,a)})}),describe("when uiBeforeTweetRemoved is triggered",function(){it("selects the next item if the item being removed is currently selected",function(){b(1),expect(this.component.$selected.attr("data-item-id")).toBe("1"),$(document).trigger("uiBeforeTweetRemoved",{sourceEventData:{id:1}}),expect(this.component.$selected.attr("data-item-id")).toBe("2")}),it("do not change selection if the item being removed is not currently selected",function(){b(4),$(document).trigger("uiBeforeTweetRemoved",{sourceEventData:{id:1}}),expect(this.component.$selected.attr("data-item-id")).toBe("4")})}),describe("unblock keyboard shortcut",function(){beforeEach(function(){spyOnEvent(document,"uiUnblockAction")}),it("does nothing if it's my tweet",function(){b(2),$(document).trigger("uiShortcutUnblock"),expect("uiUnblockAction").not.toHaveBeenTriggeredOn(a.get(1))}),it("does nothing if it's not a js-stream-tweet or a js-activity-mention",function(){b(1),$(document).trigger("uiShortcutUnblock"),expect("uiUnblockAction").not.toHaveBeenTriggeredOn(a.get(0))}),it("triggers uiUnblockAction with selected user id and name and fromShortcut set to true",function(){b(4),$(document).trigger("uiShortcutUnblock"),expect("uiUnblockAction").toHaveBeenTriggeredOnAndWith(document,{userId:"12",username:"dude",fromShortcut:!0})})}),describe("activates a clicked link",function(){it("removes any active navigations on page change",function(){jasmine.Clock.useMock(),this.$node.find(".js-stream-item").last().addClass(this.component.attr.navigationActiveClass),$(document).trigger("uiPageChanged"),jasmine.Clock.tick(2e3),expect(this.$node).not.toHaveClass(this.component.attr.navigationActiveClass)}),it("sets the linkClicked when a pushState link is clicked",function(){var a=this.$node.find(".js-nav");a.click(),expect(this.component.$linkClicked).toBe(a.parents(".js-stream-item"))}),it("unsets the linkClicked when a pushState link is clicked after 1ms",function(){jasmine.Clock.useMock();var a=this.$node.find(".js-nav");a.click(),jasmine.Clock.tick(1),expect(this.component.$linkClicked).not.toBe(a.parents(".js-stream-item"))}),it("marks activeNavigation based on linkClicked on uiNavigate",function(){var a=this.$node.find(".js-nav");a.click(),this.component.trigger("uiNavigate"),expect(a.parents(".js-stream-item")).toHaveClass(this.component.attr.navigationActiveClass)})}),describe("when the uiSelectItem event is triggered",function(){describe("and there is a current selection",function(){it("moves selection to the target of the event",function(){b(1),this.component.trigger(this.component.$node.find("#item-2"),"uiSelectItem"),expect(this.component.$selected.attr("id")).toBe("item-2")}),it("moves focus to the target of the event if specified",function(){b(1),this.component.trigger(this.component.$node.find("#item-2"),"uiSelectItem",{setFocus:!0}),expect(this.component.$selected).toBeFocused()})}),describe("but nothing is currently selected",function(){it("does not move selection to the target of the event",function(){this.component.trigger(this.component.$node.find("#item-2"),"uiSelectItem"),expect(this.component.$selected.length).toBe(0)})})}),describe("when the stream item contains a nested navigable stream",function(){it("moves the selection to the first item in the nested stream when the user presses the down arrow key",function(){b(1),this.component.trigger(this.component.$node.find("#item-6"),"uiSelectItem"),b(1),expect(this.component.$selected.attr("id")).toBe("item-7-1")}),it("mmoves the selection to the last item in the nested stream when the user presses the up arrow key",function(){b(1),this.component.trigger(this.component.$node.find("#item-8"),"uiSelectItem"),c(1),expect(this.component.$selected.attr("id")).toBe("item-7-3")})}),describe("when the selection is inside a nested navigable stream",function(){describe("and the user presses the up arrow key when the current selection is the first item",function(){it("moves the selection to the previous adjacent item in the parent stream",function(){b(1),this.component.trigger(this.component.$node.find("#item-6"),"uiSelectItem"),b(1),c(1),expect(this.component.$selected.attr("id")).toBe("item-6")})}),describe("and the user presses the down key when the current selection is the last item",function(){it("moves the selection to the next adjacent item in the parent stream",function(){b(1),this.component.trigger(this.component.$node.find("#item-8"),"uiSelectItem"),c(1),expect(this.component.$selected.attr("id")).toBe("item-7-3")})})}),describe("when a stream item is marked unselectable",function(){beforeEach(function(){b(1),this.component.$node.find("#item-2").addClass(this.component.attr.unselectableClass),b(1)}),it("does not move selection to the next adjacent item",function(){expect(this.component.$selected.attr("id")).not.toBe("item-2")}),it("moves selection to the next adjacent",function(){expect(this.component.$selected.attr("id")).toBe("item-3")})}),describe("when a stream item is focused",function(){it("adds an id to the header node",function(){b(1),expect(this.component.$selected.find(".stream-item-header").attr("id")).toBe("tweet-1-0")}),it("adds an id to the tweet text node",function(){b(1),expect(this.component.$selected.find(".tweet-text").attr("id")).toBe("tweet-1-1")}),describe("and the context node is visible",function(){it("adds an id to the tweet context node",function(){$("#item-1").find(".context").html("<p>Self-Promoted by @sm</p>"),b(1),expect(this.component.$selected.find(".context").attr("id")).toBe("tweet-1-2")})}),describe("and the context node is not visible",function(){it("does not add an id to the tweet context node",function(){b(1),expect(this.component.$selected.find(".context").attr("id")).not.toExist()})}),describe("and the Tweet is expanded",function(){it("adds an id to the expanded content node",function(){var a=$("#item-1").find(".expanded-content");a.css("display","block"),a.html("<p>Expanded content</p>"),b(1),expect(this.component.$selected.find(".expanded-content").attr("id")).toBe("tweet-1-2")})}),describe("and the Tweet is not expanded",function(){it("does not add an id to the expanded content node",function(){b(1),expect(this.component.$selected.find(".expanded-content").attr("id")).not.toExist()})}),it("applies the aria-labelledby attribute to the stream item",function(){b(1),console.log(this.component.$selected[0]),expect(this.component.$selected.attr("aria-labelledby")).toBe("tweet-1-0 tweet-1-1")}),describe("and the Tweet has not been retweeted",function(){it("does not add an id to the undo retweet button",function(){b(1),expect(this.component.$selected.find(".tweet-actions .undo-retweet").attr("id")).toBeUndefined()})}),describe("and the Tweet has been retweeted",function(){beforeEach(function(){$("#item-1 .tweet").addClass("retweeted"),b(1)}),afterEach(function(){$("#item-1 .tweet").removeClass("retweeted")}),it("adds an id to the undo retweet button",function(){expect(this.component.$selected.find(".tweet-actions .undo-retweet").attr("id")).toBe("tweet-1-2")}),it("adds the id of the undo retweet button to the aria-labelledby attribute",function(){expect(this.component.$selected.attr("aria-labelledby")).toBe("tweet-1-0 tweet-1-1 tweet-1-2")})}),describe("and the Tweet has not been favorited",function(){it("does not add an id to the undo favorite button",function(){expect(this.component.$selected.find(".tweet-actions .unfavorite").attr("id")).toBeUndefined()})}),describe("and the Tweet has been favorited",function(){beforeEach(function(){$("#item-1 .tweet").addClass("favorited"),b(1)}),afterEach(function(){$("#item-1 .tweet").removeClass("favorited")}),it("adds an id to the undo favorite button",function(){expect(this.component.$selected.find(".tweet-actions .unfavorite").attr("id")).toBe("tweet-1-2")}),it("adds the id of the undo favorite button to the aria-labelledby attribute",function(){expect(this.component.$selected.attr("aria-labelledby")).toBe("tweet-1-0 tweet-1-1 tweet-1-2")})})}),describe("when focus is moved to another stream item",function(){it("removes the aria-labelledby attribute from the previously selected stream item",function(){b(1);var a=this.component.$selected;b(1),expect(a.attr("aria-labelledby")).toBeUndefined()})}),describe("when the user navigates forward",function(){it('triggers the "uiNextItemSelected" event',function(){spyOnEvent(this.component.$node.find("#item-1"),"uiNextItemSelected"),b(1),expect("uiNextItemSelected").toHaveBeenTriggeredOn(this.component.$node.find("#item-1"))})}),describe("when the user navigates backward",function(){it('triggers the "uiNextItemSelected" event',function(){spyOnEvent(this.component.$node.find("#item-1"),"uiPreviousItemSelected"),b(1),c(1),expect("uiPreviousItemSelected").toHaveBeenTriggeredOn(this.component.$node.find("#item-1"))})})})
});
define("test/app/ui/timelines/tweet_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/timelines/tweet_timeline",function(){var a='<div id="timeline">\n      <div class="stream-container">\n        <div class="stream">\n          <div class="stream-footer"><button class="back-to-top"></button></div>\n          <div class="stream-fail-container"><a href="#" class="try-again-after-whale">Try again</a></div>\n        </div>\n      </div>\n    </div>\n  ',b='<div id="timeline">\n      <div class="stream-container">\n        <div class="stream">\n          <div class="stream-items" id="stream-items-id">\n            <div class="js-stream-item stream-item">\n              <div class="tweet original-tweet js-actionable-tweet" data-impression-id="IMPRESSION_1" data-tweet-id="12345"></div>\n            </div>\n            <div class="js-stream-item stream-item" data-item-id="123456">\n              <div class="tweet original-tweet js-actionable-tweet" data-tweet-id="123456"></div>\n            </div>\n          </div>\n          <div class="stream-footer"><button class="back-to-top"></button></div>\n          <div class="stream-fail-container"><a href="#" class="try-again-after-whale">Try again</a></div>\n          <div class="stream-autoplay-marker"></div>\n        </div>\n      </div>\n    </div>\n  ',c="<div class=\"stream-item js-stream-item\" id='stream-item-tweet-105'>\n      <ol class='conversation-module' data-ancestors='102,103'>\n        <li class='conversation-tweet-item'><div class='tweet simple-tweet' data-item-id='102'></div></li>\n        <li class='conversation-tweet-item'><div class='tweet simple-tweet' data-item-id='103'></div></li>\n        <li class='original-tweet-item'><div class='tweet original-tweet has-conversation-module' data-item-id='105'></div></li>\n      </ol>\n    </li>\n  ",d="<div></div>",e=function(){var a="";for(var b=100;b<105;b++)a+='<div class="stream-item js-stream-item"><div class="js-actionable-tweet" data-tweet-id="'+b+'" data-user-id="'+(b+100)+'"><div>blah blah blah</div></div></div>';return a},f='<div class="stream-item"><div class="new-tweets-bar js-new-tweets-bar" data-item-count="1">1 new Tweet</div></div>',g='<div class="stream-item"><div class="new-tweets-bar js-new-tweets-bar" data-item-count="2">2 new Tweets</div></div>',h='<div><div class="tweet" data-tweet-id="22" data-impression-id="impression_PROFILE_TWEETS_0"></div></div>';describe("initialize",function(){beforeEach(function(){spyOnEvent(document,"uiTweetsDisplayed"),setupComponent(b)}),it("triggers uiTweetsDisplayed",function(){var a={tweets:[{scribeContext:{},scribeData:{},tweetId:"12345",isReplyTo:!1,impressionId:"IMPRESSION_1",position:0,isMentionClick:!1,isPromotedBadgeClick:!1,itemType:"tweet",profileClickTarget:"screen_name"},{scribeContext:{},scribeData:{},tweetId:"123456",isReplyTo:!1,position:1,isMentionClick:!1,isPromotedBadgeClick:!1,itemType:"tweet",profileClickTarget:"screen_name"}]};expect("uiTweetsDisplayed").toHaveBeenTriggeredOn(document,jasmine.objectContaining(a))})}),describe("initialized",function(){beforeEach(function(){setupComponent(b,{itemType:"tweet",autoplay:!0,overflowScroll:!0,injectComposedTweets:!0}),this.component.disableAutoplay()}),describe("triggering event uiWantsMoreTimelineItems",function(){it("triggers uiWantsMoreTimelineItems from getNewItems",function(){spyOnEvent(this.component.$node,"uiWantsMoreTimelineItems"),this.component.getNewItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.component)}),it("triggers uiWantsMoreTimelineItems from getOldItems",function(){spyOnEvent(this.component.$node,"uiWantsMoreTimelineItems"),this.component.getOldItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.component)}),it("triggers uiWantsMoreTimelineItems from uiNearTheBottom",function(){spyOnEvent(this.component.$node,"uiWantsMoreTimelineItems"),$(window).trigger("uiNearTheBottom"),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.component)}),it("triggers uiWantsMoreTimelineItems from uiTimelineShouldRefresh",function(){spyOnEvent(this.component.$node,"uiWantsMoreTimelineItems"),this.component.trigger("uiTimelineShouldRefresh"),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.component)})}),describe("#inspectItemsFromServer",function(){it("calls injectOldItems when dataGotMoreTimelineItems sends old-looking items",function(){var a=spyOn(this.component,"injectOldItems").andCallThrough();this.component.max_id="2000",this.$node.trigger("dataGotMoreTimelineItems",{max_id:"1000",items_html:d}),expect(a).toHaveBeenCalled()}),it("calls notifyNewItems when dataGotMoreTimelineItems sends new-looking items",function(){var a=spyOn(this.component,"notifyNewItems").andCallThrough();this.$node.trigger("dataGotMoreTimelineItems",{since_id:"1000",items_html:d}),expect(a).toHaveBeenCalled()})}),describe("#injectItems",function(){function a(a,b){var c={scribeContext:{},scribeData:{},isReplyTo:!1,isMentionClick:!1,itemType:"tweet",isPromotedBadgeClick:!1,profileClickTarget:"screen_name",position:b};return c.tweetId=a.toString(),c.userId=(a+100).toString(),c.containerUserId=c.userId,c}function b(a){return{description:"ancestor",isConversationComponent:!0,itemType:"tweet",tweetId:a.toString()}}describe("with normal tweets",function(){beforeEach(function(){spyOnEvent(this.component.$node,"uiTweetsDisplayed"),spyOnEvent(this.component.$node,"uiHasInjectedNewTimeline"),spyOnEvent(this.component.$node,"uiWantsToRefreshTimestamps"),this.component.injectItems("prepend",e(),"uiHasInjectedNewTimeline"),this.expectedData=[];for(var b=100;b<105;b++){var c=b-100;this.expectedData.push(a(b,c))}}),it("includes item scribe data when triggering a uiHasInjectedNewTimeline event",function(){expect("uiHasInjectedNewTimeline").toHaveBeenTriggeredOnAndWith(this.component.$node,jasmine.objectContaining({items:this.expectedData}))}),it("doesn't include item scribe data when triggering events other than uiHasInjectedNewTimeline",function(){spyOnEvent(this.component.$node,"uiHasInjectedOldTimeline"),this.component.injectItems("append",e(),"uiHasInjectedOldTimeline"),expect("uiHasInjectedOldTimeline").toHaveBeenTriggeredOnAndWith(this.component.$node,{})}),it("triggers uiTweetsDisplayed",function(){expect("uiTweetsDisplayed").toHaveBeenTriggeredOn(this.component.$node)}),it("triggers uiWantsToRefreshTimestamps",function(){expect("uiWantsToRefreshTimestamps").toHaveBeenTriggeredOn(this.$node)})}),describe("with conversation items",function(){var d=function(){function a(a){return'<div class="stream-item js-stream-item"><div class="js-actionable-tweet" data-tweet-id="'+a+'" data-user-id="'+(a+100)+'"><div>blah blah blah</div></div></div>'}var b="";return b+=a(110),b+=c,b+=a(102),b},e=[a(110,0),b(102),b(103)];beforeEach(function(){spyOnEvent(this.component.$node,"uiHasInjectedNewTimeline"),this.component.injectItems("prepend",d,"uiHasInjectedNewTimeline")}),it("includes item scribe data when triggering a uiHasInjectedNewTimeline event",function(){expect("uiHasInjectedNewTimeline").toHaveBeenTriggeredOnAndWith(this.component.$node,jasmine.objectContaining({items:e}))})})}),describe("#investigateDataError",function(){it("calls notifyOldItemsError on dataGotMoreTimelineItemsError",function(){var a=spyOn(this.component,"notifyOldItemsError");this.$node.trigger("dataGotMoreTimelineItemsError",{sourceEventData:{max_id:"1000"}}),expect(a).toHaveBeenCalled()})}),describe("#notifyOldItemsError",function(){it("shows the whale end",function(){var a=spyOn(this.component,"showWhaleEnd");this.component.notifyOldItemsError(),expect(a).toHaveBeenCalled()})}),describe("#tryAgainAfterWhale",function(){it("hides the whale end",function(){spyOn(this.component,"hideWhaleEnd"),this.$node.find(".try-again-after-whale").click(),expect(this.component.hideWhaleEnd).toHaveBeenCalled()}),it("attempts to fetch old items",function(){spyOn(this.component,"getOldItems"),this.$node.find(".try-again-after-whale").click(),expect(this.component.getOldItems).toHaveBeenCalled()})}),describe("#injectComposedTweet",function(){it("will inject a new tweet if it is not in the stream",function(){var a=this.$node.find(".stream-item[data-item-id='123456']").clone().attr("data-item-id","2345"),b=$("<div/>").append(a).html();this.component.injectComposedTweet({},{tweet_html:b}),expect(this.$node.find(".stream-item").length).toBe(3)}),it("will not inject a new tweet if it is already present",function(){var a=$("<div/>").append(this.$node.find(".stream-item[data-item-id='123456']").clone()).html();this.component.injectComposedTweet({},{tweet_html:a}),expect(this.$node.find(".stream-item").length).toBe(2)})}),describe("#notifyNewItems",function(){it("adds the new items bar",function(){this.component.notifyNewItems({new_tweets_bar_html:f,items_html:d}),expect(this.component.$node.find(".new-tweets-bar")).toHaveText(/1 new Tweet/)}),it("replaces the new items bar if one is already present",function(){this.component.notifyNewItems({new_tweets_bar_html:f,items_html:d}),this.component.notifyNewItems({new_tweets_bar_html:g,items_html:d}),expect(this.component.$node.find(".new-tweets-bar")).toHaveText(/2 new Tweets/)}),it("adds given data to latentItems memory reference",function(){var a={new_tweets_bar_html:f,items_html:"Miles Davis"};this.component.notifyNewItems(a),expect(this.component.latentItems.count).toEqual(1),expect(this.component.latentItems.html).toEqual("Miles Davis")}),it("accumulates consecutive polling request into the latentItems.html memory reference",function(){var a={new_tweets_bar_html:f,items_html:"Miles Davis"};this.component.notifyNewItems(a);var b={new_tweets_bar_html:g,items_html:"Gil Evans"};this.component.notifyNewItems(b),expect(this.component.latentItems.count).toEqual(2),expect(this.component.latentItems.html).toEqual("Gil EvansMiles Davis")}),it("triggers the uiAddPageCount event on notifyNewItems",function(){spyOnEvent(this.component.$node,"uiAddPageCount"),this.component.notifyNewItems({new_tweets_bar_html:f,items_html:d}),expect("uiAddPageCount").toHaveBeenTriggeredOn(this.component)}),it("removes client-injected tweets and selects an alternate new tweets bar when composedThenInjectedTweetIds present",function(){this.component.composedThenInjectedTweetIds={1234:!0},this.component.notifyNewItems({new_tweets_bar_html:g,new_tweets_bar_alternate_html:[f],items_html:["1235","1234"].map(function(a){return"<div class='stream-item' data-item-id='"+a+"'></div>"}).join("")}),expect(this.component.latentItems.html).toBe('<div class="stream-item" data-item-id="1235"></div>')}),it("triggers the uiInjectNewItems event when injectImmediately is true",function(){spyOnEvent(this.component.$node,"uiInjectNewItems"),this.component.notifyNewItems({new_tweets_bar_html:f,items_html:d,sourceEventData:{injectImmediately:!0}}),expect("uiInjectNewItems").toHaveBeenTriggeredOn(this.component)}),it("triggers the uiInjectNewItems event when timeline_empty is true",function(){spyOnEvent(this.component.$node,"uiInjectNewItems"),this.component.notifyNewItems({new_tweets_bar_html:f,items_html:d,sourceEventData:{timeline_empty:!0}}),expect("uiInjectNewItems").toHaveBeenTriggeredOn(this.component)}),it("triggers the uiSelectTopTweet event when selectTopTweet is true",function(){spyOnEvent(this.component.$node,"uiSelectTopTweet"),this.component.notifyNewItems({new_tweets_bar_html:f,items_html:d,sourceEventData:{selectTopTweet:!0}}),expect("uiSelectTopTweet").toHaveBeenTriggeredOn(this.component)}),it("inserts the new items before navigating to a new page via pushState",function(){var a={new_tweets_bar_html:f,items_html:"Miles Davis"};this.component.notifyNewItems(a),$(document).trigger("uiBeforePageChanged"),expect(this.component.latentItems.count).toEqual(0)}),it("resets the cache of previously injected composed tweets when the pushState cache is busted",function(){this.component.composedThenInjectedTweetIds={1:!0,2:!0},$(document).trigger("dataPageMutated"),expect(this.component.composedThenInjectedTweetIds[1]).not.toBeDefined(),expect(this.component.composedThenInjectedTweetIds[2]).not.toBeDefined()})}),describe("#notifyNewItems with autoplay enabled",function(){it("does not prepend a new tweets bar, instead injects the tweets straight away",function(){this.component.reenableAutoplay(),expect(this.component.$node.find(".js-stream-item").length).toBe(2),this.component.notifyNewItems({new_tweets_bar_html:f,items_html:e()}),expect(this.component.$node.find(".new-tweets-bar").length).toBe(0),expect(this.component.$node.find(".js-stream-item").length).toBe(7)}),it("does update the latentItems.count when there are unseen tweets at top",function(){this.component.reenableAutoplay(),this.component.notifyNewItems({new_tweets_bar_html:f,items_html:e()}),expect(this.component.latentItems.count).toBe(1),this.component.notifyNewItems({new_tweets_bar_html:g,items_html:e()}),expect(this.component.latentItems.count).toBe(2),expect(this.component.$node.find(".js-stream-item").length).toBe(12)})}),describe("other autoplay functionality",function(){it("sends an event when autoplay functionality is turned on",function(){spyOnEvent(this.component.$node,"uiHasEnabledAutoplay"),this.component.reenableAutoplay(),expect("uiHasEnabledAutoplay").toHaveBeenTriggeredOn(this.component),spyOnEvent(this.component.$node,"uiHasDisabledAutoplay"),this.component.disableAutoplay(),expect("uiHasDisabledAutoplay").toHaveBeenTriggeredOn(this.component)})}),describe("click on back to top link",function(){it("scrolls to the top of the screen",function(){this.component.select("backToTopSelector").click(),expect($(window).scrollTop()).toEqual(0)})})}),describe("polling",function(){var a,c="",e=3e3,g=3e4,h=2,i=100;beforeEach(function(){a=$("<div>"),jasmine.Clock.useMock()}),describe("with pauseAfterBackoff",function(){beforeEach(function(){setupComponent(b,{itemType:"tweet",autoplay:!0,overflowScroll:!0,pollingWatchNode:a,pollingOptions:{focusedInterval:e,blurredInterval:g,backoffFactor:2,pauseAfterBackoff:!0,backoffEmptyResponseLimit:h,resumeItemCount:i}}),this.component.disableAutoplay(),spyOnEvent(this.$node,"uiWantsMoreTimelineItems")}),it("pauses polling when limit responses received without new items",function(){expect(this.component.pollingPaused).toBe(!1);for(var a=0;a<h;++a)$(document).trigger("dataGotMoreTimelineItems",{items_html:c,sourceEventData:{fromPolling:!0,interval:g}});expect(this.component.pollingPaused).toBe(!0),spyOnEvent(this.$node,"uiTimelineShouldRefresh"),jasmine.Clock.tick(g*2),expect("uiTimelineShouldRefresh").not.toHaveBeenTriggeredOn(this.$node)}),it("increases count on first request after paused",function(){for(var a=0;a<h;++a)$(document).trigger("dataGotMoreTimelineItems",{items_html:c,sourceEventData:{fromPolling:!0,interval:g}});expect(this.component.pollingPaused).toBe(!0),spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.component.trigger("uiTimelineShouldRefresh"),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({count:i}))}),it("triggers refresh on click if polling paused",function(){this.component.notifyNewItems({new_tweets_bar_html:f,items_html:d}),this.component.pausePolling(),spyOnEvent(this.$node,"uiTimelineShouldRefresh"),this.$node.find(".js-new-tweets-bar").click(),expect("uiTimelineShouldRefresh").toHaveBeenTriggeredOn(this.$node)})})})})
});
define("test/app/ui/timelines/with_cursor_pagination_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_cursor_pagination",function(){var a='<div>\n      <div class="stream-container" data-cursor="1" data-cursor-index="falafel" data-cursor-offset="2"></div>\n    </div>\n   ';beforeEach(function(){setupComponent(a,{containerSelector:".stream-container"})}),describe("when resetStateVariables is called",function(){it("it updates the corresponding data- attribute for cursor",function(){expect(this.component.cursor).toBe("1"),expect(this.component.cursorIndex).toBe("falafel"),expect(this.component.cursorOffset).toBe("2"),this.component.resetStateVariables({cursor:"2",cursor_index:"more_falafel",cursor_offset:"3"}),expect($(".stream-container").attr("data-cursor")).toBe("2"),expect($(".stream-container").attr("data-cursor-index")).toBe("more_falafel"),expect($(".stream-container").attr("data-cursor-offset")).toBe("3"),expect(this.component.cursor).toBe("2"),expect(this.component.cursorIndex).toBe("more_falafel"),expect(this.component.cursorOffset).toBe("3")})}),describe("event uiTimelineReset",function(){it("resets cursor state from dom",function(){expect(this.component.cursor).toBe("1"),$(".stream-container").attr("data-cursor","2"),this.component.trigger("uiTimelineReset"),expect(this.component.cursor).toBe("2")})})})
});
define("test/app/ui/timelines/with_story_pagination_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_story_pagination",function(){var a='<div>\n      <div class="stream-container" data-scroll-cursor="1s" data-refresh-cursor="1r"></div>\n    </div>\n   ';beforeEach(function(){setupComponent(a,{containerSelector:".stream-container"})}),describe("getOldItemsData",function(){it("returns request data with the scroll_cursor",function(){var a=this.component.getOldItemsData();expect(a.scroll_cursor).toBe("1s"),expect(a.refresh_cursor).toBe(undefined)}),it("returns topic id when available",function(){this.component.topic=975;var a=this.component.getOldItemsData();expect(a.topic).toBe(975)})}),describe("getNewItemsData",function(){it("returns request data with the refresh_cursor",function(){var a=this.component.getNewItemsData();expect(a.refresh_cursor).toBe("1r"),expect(a.scroll_cursor).toBe(undefined)}),it("returns topic id when available",function(){this.component.topic=975;var a=this.component.getNewItemsData();expect(a.topic).toBe(975)})}),describe("resetStateVariables",function(){it("sets the topic if available",function(){this.component.resetStateVariables({topic:975}),expect(this.component.topic).toBe(975)}),it("updates scroll_cursor when given",function(){this.component.resetStateVariables({scroll_cursor:"2s"}),expect($(".stream-container").attr("data-scroll-cursor")).toBe("2s")}),it("updates refresh_cursor when given",function(){this.component.resetStateVariables({refresh_cursor:"2r"}),expect($(".stream-container").attr("data-refresh-cursor")).toBe("2r")}),it("triggers uiStoryPaginationReset",function(){spyOnEvent(document,"uiStoryPaginationReset"),this.component.resetStateVariables(),expect("uiStoryPaginationReset").toHaveBeenTriggeredOn(document)}),it("resets the local scroll_cursor when not given in data",function(){$(".stream-container").attr("data-scroll-cursor","3s"),expect(this.component.scroll_cursor).toBe("1s"),this.component.resetStateVariables(),expect(this.component.scroll_cursor).toBe("3s")}),it("resets the local refresh_cursor when not give in data",function(){$(".stream-container").attr("data-refresh-cursor","3r"),expect(this.component.refresh_cursor).toBe("1r"),this.component.resetStateVariables(),expect(this.component.refresh_cursor).toBe("3r")}),it("sets shouldGetOldItems to false if data.scroll_cursor is null and data.is_scrolling_request is true",function(){expect(this.component.has_more_items).toBe(!0),this.component.resetStateVariables({is_scrolling_request:!0}),expect(this.component.has_more_items).toBe(!1),expect(this.component.scroll_cursor).toBe(null),expect($(".stream-container").attr("data-scroll-cursor")).toBe(undefined)}),it('sets shouldGetOldItems to false if data.scroll_cursor is "" and data.is_scrolling_request is true',function(){expect(this.component.has_more_items).toBe(!0),this.component.resetStateVariables({is_scrolling_request:!0,scroll_cursor:""}),expect(this.component.has_more_items).toBe(!1),expect(this.component.scroll_cursor).toBe(null),expect($(".stream-container").attr("data-scroll-cursor")).toBe(undefined)}),describe("on initial load",function(){beforeEach(function(){$(".stream-container").attr("data-scroll-cursor",""),$(".stream-container").attr("data-refresh-cursor","")}),it('sets scroll_cursor to null when scroll_cursor: "" in given data',function(){this.component.resetStateVariables({scroll_cursor:""}),expect(this.component.scroll_cursor).toBe(null)}),it("sets refresh_cursor to null when refresh_cursor: null in given data",function(){this.component.resetStateVariables(),expect(this.component.refresh_cursor).toBe(null)})})}),describe("event uiTimelineReset",function(){it("resets cursor state from dom",function(){expect(this.component.scroll_cursor).toBe("1s"),expect(this.component.refresh_cursor).toBe("1r"),$(".stream-container").attr("data-scroll-cursor","3s"),$(".stream-container").attr("data-refresh-cursor","3r"),this.component.trigger("uiTimelineReset"),expect(this.component.scroll_cursor).toBe("3s"),expect(this.component.refresh_cursor).toBe("3r")})})})
});
define("test/app/ui/timelines/with_polling_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_polling",function(){function b(a,b){expect("uiTimelineShouldRefresh").toHaveBeenTriggeredOn(a,jasmine.objectContaining({injectImmediately:!1,interval:b,fromPolling:!0}))}var a;beforeEach(function(){jasmine.Clock.useMock(),a=$("<div>")}),describe("after initialize",function(){it("is enabled by default",function(){setupComponent({pollingWatchNode:a}),expect(this.component.pollingTimer).not.toBe(undefined)}),it("is disabled by setting pollingEnabled to false",function(){setupComponent({pollingWatchNode:a,pollingEnabled:!1}),expect(this.component.pollingTimer).toBe(undefined)})}),describe("triggers refresh",function(){describe("with default polling options",function(){beforeEach(function(){jasmine.Clock.useMock(),using("core/clock",function(a){a.restart()}),setupComponent({pollingWatchNode:a}),spyOnEvent(this.$node,"uiTimelineShouldRefresh")}),it("triggers uiTimelineShouldRefresh every 30 seconds when focused",function(){for(var a=0;a<4;++a)jasmine.Clock.tick(3e4),b(this.$node,3e4)}),it("triggers uiTimelineShouldRefresh with backoff to 90 seconds when blurred",function(){jasmine.Clock.tick(1e4),a.blur(),jasmine.Clock.tick(2e4),b(this.$node,3e4),jasmine.Clock.tick(6e4),b(this.$node,6e4);for(var c=0;c<4;++c)jasmine.Clock.tick(9e4),b(this.$node,9e4)})})})})
});
define("test/app/ui/timelines/follower_request_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/timelines/follower_request_timeline",function(){var a='<li class="js-stream-item stream-item stream-item" data-item-id="111" data-item-type="user" id="stream-item-user-111">\n      <div class="js-follower-request js-actionable-user account " data-screen-name="john11" data-user-id="111">\n        <div class="friend-actions btn-group">\n          <button type="button" class="btn js-action-accept">\n            <span class="active-btn-text">Accept</span>\n            <span class="pending-btn-text">Accepting</span>\n          </button>\n          <button type="button" class="btn js-action-deny">\n            <span class="active-btn-text">Decline</span>\n            <span class="pending-btn-text">Declining</span>\n          </button>\n        </div>\n        <div class="js-profile-actions" style="display: none">\n          <div class="follow-bar">\n            <div class="user-actions btn-group not-following can-dm " data-user-id="111" data-screen-name="john11" data-name="John 11" data-protected="false">\n              <button class="js-follow-btn follow-button btn" type="button">\n                <span class="button-text follow-text"><i class="follow"></i> Follow</span>\n                <span class="button-text following-text">Following</span>\n                <span class="button-text unfollow-text">Unfollow</span>\n                <span class="button-text blocked-text">Blocked</span>\n                <span class="button-text unblock-text">Unblock</span>\n                <span class="button-text pending-text">Pending</span>\n                <span class="button-text cancel-text">Cancel</span>\n              </button>\n              <span class="user-dropdown btn">\n                <i class="account-arrow"></i>\n                <ul class="dropdown-menu">\n                  <li class="dropdown-caret">\n                    <span class="caret-outer"></span>\n                    <span class="caret-inner"></span>\n                  </li>\n                  <li class="mention-text pretty-link dropdown-link not-blocked">Tweet to <s>@</s>john11</li>\n                  <li class="dm-text dropdown-link">Send a Direct Message</li>\n                  <li class="list-text pretty-link dropdown-link not-blocked">Add or remove from lists…</li>\n                  <li class="dropdown-divider not-blocked"></li>\n                  <li class="block-text pretty-link dropdown-link not-blocked">Block <s>@</s>john11</li>\n                  <li class="unblock-text pretty-link dropdown-link">Unblock <s>@</s>john11</li>\n                  <li class="report-spam-text pretty-link dropdown-link">Report <s>@</s>john11 for spam</li>\n                  <li class="hide-suggestion-text dropdown-link">Hide this suggestion</li>\n                  <li class="dropdown-divider is-following"></li>\n                  <li class="retweet-on-text dropdown-link">Turn on Retweets</li>\n                  <li class="retweet-off-text dropdown-link">Turn off Retweets</li>\n                  <li class="device-notifications-on-text dropdown-link">Turn on mobile notifications</li>\n                  <li class="device-notifications-off-text dropdown-link">Turn off mobile notifications</li>\n                </ul>\n              </span>\n            </div>\n          </div>\n        </div>\n        <div class="content">\n          <div class="stream-item-header">\n            <a class="js-user-profile-link account-group" href="/john11">\n              <img class="avatar" src="/unversioned_dev_assets/sticky/default_profile_images/default_profile_6_normal.png" alt="John 11" data-user-id="111">\n              <strong class="fullname">John 11</strong>\n              <span class="username">@john11</span>\n            </a>\n          </div>\n          <p class="bio ">Hi my name is John. I am a unique snowflake. I enjoy snowboarding, wine, and movies. http://twitter.com</p>\n        </div>\n      </div>\n    </li>\n  ';beforeEach(function(){setupComponent(a)}),describe("accepting a follower request",function(){it("changes the button state to disabled and accepting",function(){spyOnEvent(this.$node,"uiDidFollowerAccept"),this.$node.find(".js-action-accept").click(),expect("uiDidFollowerAccept").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"111"})),expect(this.$node.find(".js-action-accept")).toHaveClass("pending"),expect(this.$node.find(".js-action-accept")).toBeDisabled()}),it("shows follow and user actions on success",function(){spyOnEvent(this.$node,"uiDidFollowerAccept"),this.$node.find(".js-action-accept").click(),expect(this.$node.find(".js-action-accept")).toHaveClass("pending"),spyOnEvent(document,"dataFollowerAcceptSuccess"),$(document).trigger("dataFollowerAcceptSuccess",{userId:"111"}),expect(this.$node.find(".friend-actions")).not.toBeVisible(),expect(this.$node.find(".js-profile-actions")).toBeVisible()}),it("returns to original state on failure",function(){spyOnEvent(this.$node,"uiDidFollowerAccept"),this.$node.find(".js-action-accept").click(),expect(this.$node.find(".js-action-accept")).toHaveClass("pending"),spyOnEvent(document,"dataFollowerAcceptFailure"),$(document).trigger("dataFollowerAcceptFailure",{userId:"111"}),expect(this.$node.find(".js-action-accept")).not.toHaveClass("pending"),expect(this.$node.find(".js-action-accept")).not.toBeDisabled()})}),describe("declining a follower request",function(){it("changes the button state to disabled and accepting",function(){spyOnEvent(this.$node,"uiDidFollowerDecline"),this.$node.find(".js-action-deny").click(),expect("uiDidFollowerDecline").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({userId:"111"})),expect(this.$node.find(".js-action-deny")).toHaveClass("pending"),expect(this.$node.find(".js-action-deny")).toBeDisabled()}),it("removes the stream item on success",function(){spyOnEvent(this.$node,"uiDidFollowerDecline"),this.$node.find(".js-action-deny").click(),expect(this.$node.find(".js-action-deny")).toHaveClass("pending"),spyOnEvent(document,"dataFollowerDeclineSuccess"),$(document).trigger("dataFollowerDeclineSuccess",{userId:"111"}),expect($(document).find(".js-stream-item")).not.toExist()}),it("returns to original state on failure",function(){spyOnEvent(this.$node,"uiDidFollowerDecline"),this.$node.find(".js-action-deny").click(),expect(this.$node.find(".js-action-deny")).toHaveClass("pending"),spyOnEvent(document,"dataFollowerDeclineFailure"),$(document).trigger("dataFollowerDeclineFailure",{userId:"111"}),expect(this.$node.find(".js-action-deny")).not.toHaveClass("pending"),expect(this.$node.find(".js-action-deny")).not.toBeDisabled()})})})
});
define("test/app/ui/timelines/with_excluded_ids_pagination_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_excluded_ids_pagination",function(){var a='<div>\n      <div class="stream-container" data-cursor="1"></div>\n      <div data-user-id="123" class="js-actionable-user"> </div>\n    </div>\n   ';beforeEach(function(){setupComponent(a,{containerSelector:".stream-container"})}),describe("when getOldItemsData is called",function(){var a={cursor:1,is_forward:!0,query:"1"},b=function(){return a};it("it does not add excluded ids if useExcludedIdsPagination is false",function(){expect(this.component.aroundGetOldItemsData(b)).toEqual(a)}),it("it does add excluded ids if useExcludedIdsPagination is true",function(){this.component.attr.useExcludedIdsPagination=!0,this.component.attr.welcomeUserSelector=".js-actionable-user";var a={cursor:undefined,is_forward:!0,query:"1",excluded:"123"};expect(this.component.aroundGetOldItemsData(b)).toEqual(a)})})})
});
define("test/app/ui/timelines/user_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/timelines/user_timeline",function(){var a='<div id="timeline">\n      <div class="stream-container" data-cursor="100">\n        <div class="stream">\n          <div class="stream-footer"><button class="back-to-top"></button></div>\n          <div class="stream-fail-container"><a href="#" class="try-again-after-whale">Try again</a></div>\n        </div>\n      </div>\n    </div>\n  ',b="<div></div>";beforeEach(function(){setupComponent(a)}),describe("triggering event uiWantsMoreTimelineItems",function(){it("triggers uiWantsMoreTimelineItems from getOldItems",function(){spyOnEvent(this.component.$node,"uiWantsMoreTimelineItems"),this.component.getOldItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.component)}),it("triggers uiWantsMoreTimelineItems from uiNearTheBottom",function(){spyOnEvent(this.component.$node,"uiWantsMoreTimelineItems"),$(window).trigger("uiNearTheBottom"),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.component)})}),describe("#inspectItemsFromServer",function(){it("calls injectOldItems",function(){var a=spyOn(this.component,"injectOldItems").andCallThrough();this.$node.trigger("dataGotMoreTimelineItems",{items_html:b}),expect(a).toHaveBeenCalled()})}),describe("#investigateDataError",function(){it("calls notifyOldItemsError on dataGotMoreTimelineItemsError",function(){var a=spyOn(this.component,"notifyOldItemsError");this.$node.trigger("dataGotMoreTimelineItemsError",{sourceEventData:{}}),expect(a).toHaveBeenCalled()})}),describe("#notifyOldItemsError",function(){it("shows the whale end",function(){var a=spyOn(this.component,"showWhaleEnd");this.component.notifyOldItemsError(),expect(a).toHaveBeenCalled()})}),describe("#tryAgainAfterWhale",function(){it("hides the whale end",function(){spyOn(this.component,"hideWhaleEnd"),this.$node.find(".try-again-after-whale").click(),expect(this.component.hideWhaleEnd).toHaveBeenCalled()}),it("attempts to fetch old items",function(){spyOn(this.component,"getOldItems"),this.$node.find(".try-again-after-whale").click(),expect(this.component.getOldItems).toHaveBeenCalled()})}),describe("click on back to top link",function(){it("scrolls to the top of the screen",function(){this.component.select("backToTopSelector").click(),expect($(window).scrollTop()).toEqual(0)})}),describe("cursor pagination",function(){it("sends the original (DOM) cursor with uiWantsMoreTimelineItems",function(){spyOnEvent(this.component.$node,"uiWantsMoreTimelineItems"),this.component.getOldItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.component.$node,jasmine.objectContaining({cursor:"100",is_forward:!0,query:""}))}),it("sends the returned (ajax) cursor with uiWantsMoreTimelineItems",function(){spyOnEvent(this.component.$node,"uiWantsMoreTimelineItems"),this.$node.trigger("dataGotMoreTimelineItems",{items_html:b,cursor:"200",has_more_items:!0}),this.component.getOldItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.component.$node,jasmine.objectContaining({cursor:"200",is_forward:!0,query:""}))}),it("send the cursor and query params with uiWantsMoreTimelineItems",function(){setupComponent(a,{query:"cursorQuery"}),spyOnEvent(this.component.$node,"uiWantsMoreTimelineItems"),this.component.getOldItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.component.$node,jasmine.objectContaining({cursor:"100",is_forward:!0,query:"cursorQuery"}))})})})
});
define("test/app/ui/timelines/with_activity_supplements_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_activity_supplements",function(){var a,b,c;beforeEach(function(){var a='<li class="js-stream-item stream-item stream-item js-activity js-activity-favorite">\n        <div class="stream-item-content clearfix stream-item-activity stream-item-favorite stream-item-activity-network">\n          <div class="stream-item-activity-header">\n            <button type="button" class="btn-link view-all-supplements show"></button>\n          </div>\n          <ol class="activity-supplement has-hidden-supplements">\n            <li id="supplement-1" class="stream-item supplement visible-supplement"><div class="original-tweet js-stream-tweet"></div></li>\n            <li id="supplement-2" class="stream-item supplement hidden-supplement js-unselectable-stream-item"><div class="original-tweet js-stream-tweet"></div></li>\n          </ol>\n        </div>\n      </li>\n    ';setupComponent(a)}),describe("when all of the supplements in the stream item are hidden",function(){describe("and the toggle to show all visible supplements is clicked",function(){beforeEach(function(){spyOnEvent(this.component.$node.find("#supplement-1"),"uiSelectItem"),this.component.select("viewAllSupplementsButton").click()}),it('adds the "js-has-navigable-stream" to the parent stream item',function(){expect(this.component.$node).toHaveClass("js-has-navigable-stream")}),it('removes the "js-unselectable-stream-item" from all hidden supplements',function(){expect(this.component.$node.find(".hidden-supplement")).not.toHaveClass("js-unselectable-stream-item")}),it('triggers the "uiSelectItem" event on the first/visible supplement',function(){var a=this.component.$node.find("#supplement-1");expect("uiSelectItem").toHaveBeenTriggeredOnAndWith(a,{setFocus:!0,el:a[0]})})})}),describe("when all of the supplements in the stream item are visible",function(){beforeEach(function(){this.component.select("viewAllSupplementsButton").click()}),describe("and the toggle to hide all visible supplements is clicked",function(){it('triggers the "uiShouldToggleExpandedState" on the open supplements',function(){var a=this.component.$node.find("#supplement-1");a.addClass("open"),spyOnEvent(a,"uiShouldToggleExpandedState"),this.component.select("viewAllSupplementsButton").click(),expect("uiShouldToggleExpandedState").toHaveBeenTriggeredOn(a)}),it('does not trigger the "uiShouldToggleExpandedState" on the closed supplements',function(){var a=this.component.$node.find("#supplement-2");spyOnEvent(a,"uiShouldToggleExpandedState"),this.component.select("viewAllSupplementsButton").click(),expect("uiShouldToggleExpandedState").not.toHaveBeenTriggeredOn(a)}),it('removes the "js-has-navigable-stream" class from the parent stream item',function(){this.component.select("viewAllSupplementsButton").click(),expect(this.component.$node).not.toHaveClass("js-has-navigable-stream")}),it('adds the "js-unselectable-stream-item" to all hidden supplements',function(){this.component.select("viewAllSupplementsButton").click(),expect(this.component.$node.find(".hidden-supplement")).toHaveClass("js-unselectable-stream-item")}),it('triggers the "uiSelectItem" event on the parent stream item',function(){spyOnEvent(this.component.$node,"uiSelectItem"),this.component.select("viewAllSupplementsButton").click(),expect("uiSelectItem").toHaveBeenTriggeredOnAndWith(this.component.$node,{setFocus:!0})})})}),describe("when the first visible supplement has been expanded",function(){describe('and the "uiSelectItem" event is triggered on the visible supplement',function(){beforeEach(function(){var a=this.component.$node.find("#supplement-1");spyOnEvent(this.component.$node,"uiSelectItem"),this.component.$node.addClass("js-has-navigable-stream"),this.component.select("viewAllSupplementsButton").addClass("show"),this.component.trigger(a,"uiSelectItem")}),it('triggers the "uiSelectItem" event on the parent stream item',function(){expect("uiSelectItem").toHaveBeenTriggeredOn(this.component.$node)}),it('removes the "js-has-navigable-stream" from the parent stream item',function(){expect(this.component.$node).not.toHaveClass("js-has-navigable-stream")})})})})
});
define("test/app/ui/timelines/with_contextual_tweet_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_contextual_tweet",function(){describe("when the timeline has items",function(){var a='<div class="GridTimeline">\n        <div class="GridTimeline-items">\n          <div class="Tweet is-pinned" data-tweet-id="1"></div>\n          <div class="Tweet" data-tweet-id="2"></div>\n          <div class="Tweet" data-tweet-id="3"></div>\n        </div>\n      </div>\n    ';beforeEach(function(){setupComponent(a,{itemsSelector:".GridTimeline-items"})}),describe("getNewItemsData",function(){it("should add the contextual tweet id from the first tweet in the items that is not pinned",function(){var a=this.component.getNewItemsData();expect(a.contextual_tweet_id).toEqual("2")})}),describe("getOldItemsData",function(){it("should add the contextual tweet id from the last tweet in the items",function(){var a=this.component.getOldItemsData();expect(a.contextual_tweet_id).toEqual("3")})})}),describe("when the timeline is empty",function(){var a='<div class="GridTimeline">\n        <div class="GridTimeline-items"></div>\n      </div>\n    ';beforeEach(function(){setupComponent(a,{itemsSelector:".GridTimeline-items"})}),describe("getNewItemsData",function(){it("should not set contextual_tweet_id",function(){var a=this.component.getNewItemsData();expect(a.contextual_tweet_id).toBeUndefined()})}),describe("getOldItemsData",function(){it("should not set contextual_tweet_id",function(){var a=this.component.getOldItemsData();expect(a.contextual_tweet_id).toBeUndefined()})})})})
});
define("test/app/ui/timelines/event_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/timelines/event_timeline",function(){var a,b=function(a){return'<div class="js-stream-item"><div class="tweet" data-tweet-id="'+a+'"></div></div>'};beforeEach(function(){var b="<div>\n       <div class='stream-items'>\n        <div class='js-stream-item'><div class='tweet' data-tweet-id='1234'></div></div>\n        <div class='js-stream-item'><div class='tweet' data-tweet-id='3'></div></div>\n        <div class='js-stream-item'><div class='tweet' data-tweet-id='2'></div></div>\n        <div class='js-stream-item'><div class='tweet' data-tweet-id='1'></div></div>\n       </div>\n      </div>\n    ";setupComponent(b,{curated_timeline_since_id:"1234",autoplay:!0,itemsSelector:".stream-items"}),this.component.autoplay=!1,a=this.$node.find(".js-stream-item")}),describe("overriding standard timeline functionality",function(){it("takes the max of a bubbling since_id and a saved photoSinceId (for the photostrip)",function(){var a=jasmine.createSpy();$(document).on("uiWantsMoreTimelineItems",a),this.component.photoSinceId="100",this.$node.trigger("uiWantsMoreTimelineItems",{since_id:"3"}),expect(a.mostRecentCall.args[1]).toEqual({hasModified:!0,curated_timeline_since_id:"1234",since_id:"100"})})}),describe("curated timeline since id",function(){it("stores the curated_timeline_since_id when the component initializes",function(){expect(this.component.curatedTimelineSinceId).toEqual("1234")}),it("updates the curated_timeline_since_id when new data is returned",function(){this.component.trigger("dataGotMoreTimelineItems",{curated_timeline_since_id:"2345"}),expect(this.component.curatedTimelineSinceId).toEqual("2345")}),it("does not updates the curated_timeline_since_id when new data is returned without pinned tweet",function(){this.component.trigger("dataGotMoreTimelineItems",{new_photos_html:""}),this.component.trigger("dataGotMoreTimelineItems",{curated_timeline_since_id:null,has_more_items:!1,items_html:'<div class="js-stream-item stream-item stream-item expanding-stream-item" data-item-id="250326262038556672" data-item-type="tweet" id="stream-item-tweet-250326262038556672"></div>',new_photos_html:[],new_tweets_bar_html:'<div class="stream-item"><div class="new-tweets-bar js-new-tweets-bar" data-item-count="3">3 new Tweets </div>↵</div>',since_id:"250326262038556672"}),expect(this.component.curatedTimelineSinceId).toEqual("1234")}),it("injects the curated_timeline_since_id into the timeline request",function(){spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.component.modifyNewTimelineRequest($.Event("click"),{since_id:"1",include_new_items_bar:!0}),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.$node,{since_id:"1",include_new_items_bar:!0,curated_timeline_since_id:"1234",hasModified:!0})})}),describe("#transferClass",function(){it("transfers a given class from a given node onto the next node in a specified direction",function(){var b=a.eq(1);b.addClass("miles-davis").addClass("gil-evans"),this.component.transferClass(b,"miles-davis",b.next()),this.component.transferClass(b,"gil-evans",b.prev()),expect(b.next()).toHaveClass("miles-davis"),expect(b).not.toHaveClass("miles-davis"),expect(b.prev()).toHaveClass("gil-evans"),expect(b).not.toHaveClass("gil-evans")})}),describe("#repositionPromotedItem",function(){it("moves to the top of the items if there is no open item at the top",function(){this.component.$promotedItem=a.eq(1).addClass("promoted"),this.component.trigger("uiHasInjectedNewTimeline"),expect(this.$node.find(".promoted").index()).toBe(0)}),it("moves to second position if there is an open item at the top",function(){this.component.$promotedItem=a.eq(1).addClass("promoted"),a.eq(0).addClass("open"),this.component.trigger("uiHasInjectedNewTimeline"),expect(this.$node.find(".promoted").index()).toBe(1)})}),describe("hoisting pinned tweets",function(){it("moves pinned tweets from their natural position to the top of the stream",function(){var a=this.$node.find(".stream-items"),c=$(b(4567)).addClass("preexpanded open"),d=$(b(5678)),e=$(b(6789)).addClass("preexpanded open");a.prepend(c).prepend(d).prepend(e),e.trigger("uiHasInjectedTimelineItem"),d.trigger("uiHasInjectedTimelineItem"),c.trigger("uiHasInjectedTimelineItem"),expect(a.children().eq(0)).toEqual(e),expect(a.children().eq(1)).toEqual(c),expect(a.children().eq(2)).toEqual(d)}),it("does not hoist anything if autoplay is enabled",function(){this.component.$node.trigger("uiHasEnabledAutoplay");var a=this.$node.find(".stream-items"),c=$(b(4567)).addClass("preexpanded open"),d=$(b(5678)),e=$(b(6789)).addClass("preexpanded open");a.prepend(c).prepend(d).prepend(e),e.trigger("uiHasInjectedTimelineItem"),d.trigger("uiHasInjectedTimelineItem"),c.trigger("uiHasInjectedTimelineItem"),expect(a.children().eq(0)).toEqual(e),expect(a.children().eq(1)).toEqual(d),expect(a.children().eq(2)).toEqual(c)})}),describe("deduping functionality",function(){it("dedupes duplicate apperances of pinned tweets",function(){expect(this.$node.find(".js-stream-item").length).toBe(4),this.$node.find(".stream-items").prepend(b(1234)),this.component.trigger(this.$node.find(".js-stream-item").first(),"uiHasInjectedTimelineItem"),expect(this.$node.find(".js-stream-item").length).toBe(4)})})})
});
define("test/app/ui/timelines/with_preserved_scroll_position_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/timelines/with_preserved_scroll_position",function(){var a='<div id="timeline">\n      <div class="stream-container">\n        <div class="stream">\n          <div class="stream-footer"><button class="back-to-top"></button></div>\n          <div class="stream-fail-container"><a href="#" class="try-again-after-whale">Try again</a></div>\n        </div>\n      </div>\n    </div>\n  ',b='<div id="timeline">\n      <div class="stream-container">\n        <div class="stream">\n          <div class="stream-items" id="stream-items-id">\n            <div class="js-stream-item stream-item" data-item-id="12345" data-item-type="tweet">\n              <div class="tweet original-tweet js-actionable-tweet" data-tweet-id="12345"></div>\n            </div>\n            <div class="js-stream-item stream-item" data-item-id="123456" data-item-type="tweet">\n              <div class="tweet original-tweet js-actionable-tweet" data-tweet-id="123456"></div>\n            </div>\n            <div class="tear stream-item"><button class="tear-inner btn-link">Load more tweets</button></div>\n            <div class="js-stream-item stream-item" data-item-id="1234567" data-item-type="tweet">\n              <div class="tweet original-tweet js-actionable-tweet" data-tweet-id="1234567" data-retweet-id="12345678"></div>\n            </div>\n          </div>\n          <div class="stream-footer"><button class="back-to-top"></button></div>\n          <div class="stream-fail-container"><a href="#" class="try-again-after-whale">Try again</a></div>\n          <div class="stream-autoplay-marker"></div>\n        </div>\n      </div>\n    </div>\n  ',c='<div id="timeline">\n      <div class="stream-container">\n        <div class="stream">\n          <div class="stream-items" id="stream-items-id">\n            <div class="js-stream-item stream-item" data-item-id="12345" data-item-type="tweet">\n              <div class="tweet original-tweet js-actionable-tweet" data-tweet-id="12345"></div>\n            </div>\n            <div class="js-stream-item stream-item" data-item-id="123456" data-item-type="tweet">\n              <div class="tweet original-tweet js-actionable-tweet" data-tweet-id="123456" data-promoted="true"></div>\n            </div>\n            <div class="tear stream-item"><button class="tear-inner btn-link">Load more tweets</button></div>\n            <div class="js-stream-item stream-item" data-item-id="1234567" data-item-type="tweet">\n              <div class="tweet original-tweet js-actionable-tweet" data-tweet-id="1234567"></div>\n            </div>\n          </div>\n          <div class="stream-footer"><button class="back-to-top"></button></div>\n          <div class="stream-fail-container"><a href="#" class="try-again-after-whale">Try again</a></div>\n          <div class="stream-autoplay-marker"></div>\n        </div>\n      </div>\n    </div>\n  ';describe("findSiblingTweets",function(){beforeEach(function(){setupComponent(b)}),it("adds a previous tweet",function(){var a=this.component.findSiblingTweets(this.$node.find(".stream-item[data-item-id=123456]"),"prev",3);expect(a.length).toEqual(1,"items in set"),expect(a[0]).toBe(this.$node.find(".stream-item[data-item-id=12345]")[0])}),it("adds the next tweets including tear",function(){var a=this.component.findSiblingTweets(this.$node.find(".stream-item[data-item-id=12345]"),"next",3);expect(a.length).toEqual(3,"items in set"),expect(a[0]).toBe(this.$node.find(".stream-item[data-item-id=123456]")[0]),expect(a[1]).toBe(this.$node.find(".tear")),expect(a[2]).toBe(this.$node.find(".stream-item[data-item-id=1234567]")[0])}),it("stops at tear when adding previous",function(){var a=this.component.findSiblingTweets(this.$node.find(".stream-item[data-item-id=1234567]"),"prev",3);expect(a.length).toEqual(0,"items in set")}),it("stops at counter when adding next",function(){var a=this.component.findSiblingTweets(this.$node.find(".stream-item[data-item-id=12345]"),"next",1);expect(a.length).toEqual(1,"items in set")})}),describe("findNearestRealTweet",function(){beforeEach(function(){setupComponent(c,{tearClass:"tear"})}),it("skips a promoted tweet",function(){var a=this.component.findNearestRealTweet(this.$node.find(".tear"),"prev");expect(a).toHaveAttr("data-item-id","12345")}),it("skips a tear",function(){var a=this.component.findNearestRealTweet(this.$node.find(".stream-item[data-item-id=123456]"),"prev");expect(a).toHaveAttr("data-item-id","12345")}),it("finds next",function(){var a=this.component.findNearestRealTweet(this.$node.find(".stream-item[data-item-id=123456]"),"next");expect(a).toHaveAttr("data-item-id","1234567")})}),describe("getTweetId",function(){beforeEach(function(){setupComponent(b)}),it("gets a tweet id",function(){var a=this.component.getTweetId(this.$node.find(".stream-item[data-item-id=123456]"));expect(a).toEqual("123456")}),it("gets a retweet id",function(){var a=this.component.getTweetId(this.$node.find(".stream-item[data-item-id=1234567]"));expect(a).toBe("12345678")})}),describe("findTweetAtTop",function(){it("returns a jquery object of length one",function(){setupComponent(b,{preservedScrollEnabled:!0,genericItemSelector:".js-stream-item"}),this.$node.parent().css({position:"static"}),this.$node.css({width:"100%",height:"100%",position:"absolute"}),expect(this.component.findTweetAtTop().length).toEqual(1,"jquery object"),expect(this.component.findTweetAtTop()instanceof jQuery).toBe(!0,"instanceof jquery")}),it("returns a jquery object of length zero",function(){setupComponent(a,{preservedScrollEnabled:!0,genericItemSelector:".js-stream-item"}),expect(this.component.findTweetAtTop().length).toEqual(0,"jquery object"),expect(this.component.findTweetAtTop()instanceof jQuery).toBe(!0,"instanceof jquery")})}),describe("recordTweetAtTop",function(){it("returns the top tweet",function(){setupComponent(b,{preservedScrollEnabled:!0,genericItemSelector:".js-stream-item"}),this.$node.parent().css({position:"static"}),this.$node.css({width:"100%",height:"100%",position:"absolute"});var a=this.component.findTweetAtTop();spyOnEvent(this.$node,"uiTimelineScrollSet"),this.component.recordTweetAtTop(),expect(a).toHaveClass(this.component.attr.currentScrollPosClass),expect(a).toHaveAttr("data-offset"),expect(a.attr("data-offset")).toBeGreaterThan(0),expect("uiTimelineScrollSet").toHaveBeenTriggeredOnAndWith(this.$node,{topItem:"12345"},!0)})}),describe("trimTimeline",function(){it("trims all except current",function(){setupComponent(b,{preservedScrollEnabled:!0,countAboveTear:0,countBelowTearAboveCurrent:0,countBelowCurrent:0,containerSelector:".stream-container"}),spyOn(this.component,"findTweetAtTop").andReturn(this.$node.find(".stream-item[data-item-id=123456]")),this.component.recordTweetAtTop(),this.component.trimTimeline(),expect(this.$node.find(".tweet").length).toEqual(1,"tweets"),expect(this.component.select("tearSelector").length).toEqual(1,"tears"),expect(this.component.select("containerSelector")).toHaveAttr("data-max-id","123455")}),it("saves all if all in top ten",function(){setupComponent(b,{preservedScrollEnabled:!0,countAboveTear:10,countBelowTearAboveCurrent:0,countBelowCurrent:0,containerSelector:".stream-container"}),spyOn(this.component,"findTweetAtTop").andReturn(this.$node.find(".stream-item[data-item-id=123456]")),this.component.recordTweetAtTop(),this.component.trimTimeline(),expect(this.$node.find(".tweet").length).toEqual(3,"tweets"),expect(this.component.select("tearSelector").length).toEqual(1,"tears"),expect(this.component.select("containerSelector")).toHaveAttr("data-max-id","12345677")}),it("saves top one, tear, and current - removing one from the middle",function(){setupComponent(b,{preservedScrollEnabled:!0,genericItemSelector:".stream-item",countAboveTear:1,countBelowTearAboveCurrent:0,countBelowCurrent:0,containerSelector:".stream-container"}),spyOn(this.component,"findTweetAtTop").andReturn(this.$node.find(".stream-item[data-item-id=1234567]")),this.component.recordTweetAtTop(),this.component.trimTimeline(),expect(this.$node.find(".tweet").length).toEqual(2,"tweets"),expect(this.component.select("tearSelector").length).toEqual(1,"tears"),expect(this.component.select("containerSelector")).toHaveAttr("data-max-id","12345677")}),it("saves one below tear and current",function(){setupComponent(b,{preservedScrollEnabled:!0,genericItemSelector:".stream-item",countAboveTear:0,countBelowTearAboveCurrent:1,countBelowCurrent:0,containerSelector:".stream-container"}),this.component.select("tearSelector").remove(),spyOn(this.component,"findTweetAtTop").andReturn(this.$node.find(".stream-item[data-item-id=1234567]")),this.component.recordTweetAtTop(),this.component.trimTimeline(),expect(this.$node.find(".tweet").length).toEqual(2,"tweets"),expect(this.component.select("tearSelector").length).toEqual(1,"tears"),expect(this.component.select("containerSelector")).toHaveAttr("data-max-id","12345677")}),it("saves all below current",function(){setupComponent(b,{preservedScrollEnabled:!0,genericItemSelector:".stream-item",countAboveTear:0,countBelowTearAboveCurrent:0,countBelowCurrent:20,containerSelector:".stream-container"}),spyOn(this.component,"findTweetAtTop").andReturn(this.$node.find(".stream-item[data-item-id=12345]")),this.component.recordTweetAtTop(),this.component.trimTimeline(),expect(this.$node.find(".tweet").length).toEqual(3,"tweets"),expect(this.component.select("tearSelector").length).toEqual(2,"tears"),expect(this.component.select("containerSelector")).toHaveAttr("data-max-id","12345677")})}),describe("restorePosition",function(){it("removes the scroll pos class",function(){setupComponent(b,{preservedScrollEnabled:!0});var a=this.$node.find(".stream-item[data-item-id=123456]");a.addClass(this.component.attr.currentScrollPosClass),this.component.restorePosition({},{fromCache:!0}),expect(a).not.toHaveClass(this.component.attr.currentScrollPosClass)})}),describe("expandTear",function(){beforeEach(function(){setupComponent(b,{preservedScrollEnabled:!0}),spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.component.getRangeItemsData=function(a,b){return{since_id:a,max_id:b}}}),it("requests a range of tweets",function(){var a=this.component.select("tearSelector");this.component.expandTear({target:a[0]}),expect(a).toHaveClass(this.component.attr.tearProcessingClass),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.$node,{since_id:"12345677",max_id:"123456"})})}),describe("when the user presses Enter while focused on the tear",function(){beforeEach(function(){using("app/data/user_info",function(a){a.set({deciders:{preserve_scroll_position:!0}})}),setupComponent(b,{preservedScrollEnabled:!0}),spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.component.getRangeItemsData=function(a,b){return{since_id:a,max_id:b}}}),it("requests a range of tweets",function(){var a=this.component.select("tearSelector");a.attr("tabIndex",-1).focus(),this.component.trigger(a,"uiShortcutEnter"),expect(a).toHaveClass(this.component.attr.tearProcessingClass),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.$node,{since_id:"12345677",max_id:"123456"})})}),describe("injectRangeItems",function(){beforeEach(function(){setupComponent(b,{preservedScrollEnabled:!0});var a=this.component.select("tearSelector");a.addClass(this.component.attr.tearProcessingClass),this.component.getRangeItemsData=function(a,b){return{since_id:a,max_id:b}},this.component.reportInjectedItems=function(a){return},this.component.expandTear({target:a})}),it("injects tweets at the tear",function(){this.component.injectRangeItems({since_id:"123456",items_html:'<div class="injected tweet"></div>'}),expect(this.$node.find(".tweet").length).toEqual(4,"tweets"),expect(this.$node.find(".injected").length).toEqual(1,"injected tweets"),expect(this.component.select("tearSelector")).not.toHaveClass(this.component.attr.tearProcessingClass),expect(this.component.select("tearSelector").length).toEqual(1)}),it("removes the tear after injecting tweets",function(){this.component.injectRangeItems({since_id:"123456",items_html:'<div class="injected tweet" data-item-id="12345678"></div>'}),expect(this.$node.find(".injected").length).toEqual(0,"injected tweets"),expect(this.component.select("tearSelector").length).toEqual(0,"tears")}),it("ignores the wrong range of tweets",function(){this.component.injectRangeItems({since_id:"12345",items_html:'<div class="injected tweet" data-item-id="1234567"></div>'}),expect(this.$node.find(".injected").length).toEqual(0,"injected tweets"),expect(this.component.select("tearSelector").length).toEqual(1,"tears")})}),describe("notifyRangeItemsError",function(){it("removes the processing state from a tear on error",function(){setupComponent(b,{preservedScrollEnabled:!0});var a=this.component.select("tearSelector");a.addClass(this.component.attr.tearProcessingClass),this.component.getRangeItemsData=function(a,b){return{since_id:a,max_id:b}},this.component.reportInjectedItems=function(a){return},this.component.expandTear({target:a}),this.component.notifyRangeItemsError(),expect(this.component.select("tearSelector")).not.toHaveClass(this.component.attr.tearProcessingClass)})}),describe("initialize",function(){it("binds when decider is enabled",function(){using("app/data/user_info",function(a){a.set({deciders:{preserve_scroll_position:!0}})}),setupComponent(b,{preservedScrollEnabled:!0,containerSelector:".stream-container"}),expect(this.component.preserveScrollPosition).toBe(!0)}),it("does nothing when decider is disabled",function(){using("app/data/user_info",function(a){a.set({deciders:{preserve_scroll_position:!1}})}),setupComponent(b,{preservedScrollEnabled:!0,containerSelector:".stream-container"}),expect(this.component.preserveScrollPosition).not.toBe(!0)}),it("does nothing when disabled by attr",function(){using("app/data/user_info",function(a){a.set({deciders:{preserve_scroll_position:!0}})}),setupComponent(b,{preservedScrollEnabled:!1,containerSelector:".stream-container"}),expect(this.component.preserveScrollPosition).not.toBe(!0)})})})
});
define("test/app/ui/forms/with_submit_disable_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/forms/with_submit_disable",function(){beforeEach(function(){var a='<form>\n        <input type="submit" value="Submit" />\n      </form>\n    ';setupComponent(a),this.component.trigger(document,"uiSwiftLoaded")}),describe("When first initialised",function(){it("should start disabled",function(){expect(this.component.$submit).toBeDisabled()})}),describe("When data has been modified",function(){it("should be enabled",function(){expect(this.component.$submit).toBeDisabled(),this.component.trigger("dataFormValueModified"),expect(this.component.$submit).not.toBeDisabled()})}),describe("When data has been reverted",function(){it("should be disabled",function(){expect(this.component.$submit).toBeDisabled(),this.component.trigger("dataFormValueModified"),expect(this.component.$submit).not.toBeDisabled(),this.component.trigger("dataFormValueReset"),expect(this.component.$submit).toBeDisabled()})})})
});
define("test/app/ui/forms/input_with_placeholder_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/forms/input_with_placeholder",function(){beforeEach(function(){var a='<div class="holding">\n        <input type="text" value="" />\n        <span class="holder">Full name</span>\n      </div>\n    ';setupComponent(a)}),it("adds the hasome class once you type in it",function(){var a=this.$node.find("input"),b=this.$node.find(".holder");expect(a).toHaveValue(""),expect(this.$node).not.toHaveClass("hasome"),a.val("typy-typey"),a.trigger("keydown"),expect(this.$node).toHaveClass("hasome")}),it("doesn't remove the hasome class until you blur it",function(){var a=this.$node.find("input"),b=this.$node.find(".holder");a.val("typy-typey"),a.trigger("keydown"),expect(this.$node).toHaveClass("hasome"),a.val(""),a.trigger("keydown"),expect(this.$node).toHaveClass("hasome"),a.trigger("blur"),expect(this.$node).not.toHaveClass("hasome")}),describe("on uiInputChanged",function(){it("should hide the placeholder if input is present",function(){var a=this.$node.find("input"),b=this.$node.find(".holder");a.val("typy-typey"),a.trigger("uiInputChanged"),expect(this.$node).toHaveClass("hasome")}),it("should show the placeholder if input is not present",function(){var a=this.$node.find("input"),b=this.$node.find(".holder");a.val(""),a.trigger("uiInputChanged"),expect(this.$node).not.toHaveClass("hasome")})}),describe("input with existing value",function(){beforeEach(function(){var a='<div class="holding">\n           <input type="text" value="Diana" />\n           <span class="holder">Full name</span>\n         </div>\n      ';setupComponent(a)}),it("has the hasome class",function(){expect(this.$node).toHaveClass("hasome")})})})
});
define("test/app/ui/forms/select_box_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/forms/select_box",function(){beforeEach(function(){var a='<select>\n        <option attr1="foo1" attr2="foo2">Foo</option>\n        <option attr1="bar1" attr2="bar2">Bar</option>\n        <option attr1="baz1" attr2="baz2">Baz</option>\n      </select>\n    ';setupComponent(a)}),it("fires uiItemSelect event after selecting items",function(){var a=[{index:0,attr1:"foo1",attr2:"foo2",text:"Foo"},{index:1,attr1:"bar1",attr2:"bar2",text:"Bar"},{index:2,attr1:"baz1",attr2:"baz2",text:"Baz"}],b=this.component;this.component.$node.on("uiItemSelect",function(c,d){expect(d.index>=0).toBeTruthy();for(var e in a[d.index])expect(d[e]).toEqual(a[d.index][e]);d.index+1<a.length?(b.node.selectedIndex++,b.$node.trigger("change")):expect(!0).toBeTruthy()}),this.component.node.selectedIndex=0,this.component.$node.trigger("change")}),it("lets you change the contents of select box",function(){var a={index:0,attr1:"beep1",attr2:"beep2",text:"Beep"};this.component.$node.on("uiItemSelect",function(b,c){for(var d in a)expect(c[d]).toEqual(a[d])}),this.component.$node.trigger("setItems",{items:[{attr1:"beep1",attr2:"beep2",text:"Beep"}]}),expect(this.component.$node.find("option").length).toBe(1),expect(this.component.$node.find("option")[0].innerHTML).toBe("Beep"),expect(this.component.$node.find("option").attr("attr1")).toBe("beep1"),expect(this.component.$node.find("option").attr("attr2")).toBe("beep2"),expect(this.component.$node.find("option").attr("text")).toBeFalsy()})})
});
define("test/app/ui/forms/form_value_modification_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/forms/form_value_modification",function(){function a(a,b){if(a.is("[type=checkbox], [type=radio]"))a.is(":checked")?a.removeAttr("checked"):a.attr("checked","checked");else if(a.is("select")){var c=a.find("option:selected"),d=a.find("option:not(:selected)");c.removeAttr("selected"),d.attr("selected","selected")}else a.is("[type=file]")||a.val(b);a.trigger("change")}beforeEach(function(){var a='<form>\n        <input type="hidden" name="hidden" value="hidden-value" />\n        <input type="text" name="text" value="text-value" />\n        <input type="checkbox" name="checkbox" value="1" checked="checked" />\n        <input type="radio" name="radio-button" value="radio-value-1" />\n        <input type="radio" name="radio-button" value="radio-value-2" checked="checked" />\n        <input type="file" name="file-value" value="some-file-data" />\n        <select name="select">\n          <option value="select-value-1">Select value 1</option>\n          <option value="select-value-2" selected="selected">Select value 2</option>\n        </select>\n        <select name="multiple-select" multiple="multiple">\n          <option selected="selected">Multiple select value 1</option>\n          <option>Multiple select value 2</option>\n          <option selected="selected">Multiple select value 3</option>\n        </select>\n        <textarea name="textarea">text area value</textarea>\n        <input type="submit" value="Submit" />\n      </form>\n    ';setupComponent(a),this.$textField=this.$node.find("input[type=text]"),this.$selectField=this.$node.find("select:not([multiple])"),this.component.trigger(document,"uiSwiftLoaded")}),describe("When form values have not been changed",function(){describe("the submit button",function(){it("should be disabled",function(){expect(this.component.$submit).toBeDisabled()})})}),describe("When form values have been changed",function(){describe("the submit button",function(){it("should be enabled",function(){expect(this.component.$submit).toBeDisabled(),a(this.$textField,"This value has been modified"),expect(this.component.$submit).not.toBeDisabled()}),it("should return to being disabled if form values revert to their originals",function(){var b=this.$textField.val();expect(this.component.$submit).toBeDisabled(),a(this.$textField,"This value has been modified"),expect(this.component.$submit).not.toBeDisabled(),a(this.$textField,b),expect(this.component.$submit).toBeDisabled()}),it("should remain enabled if at least one field remains changed",function(){var b=this.$textField,c=this.$selectField,d=this.component.$submit,e=b.val();expect(d).toBeDisabled(),a(b,"This value has been modified"),expect(d).not.toBeDisabled(),a(c),expect(d).not.toBeDisabled(),a(b,e),expect(d).not.toBeDisabled(),a(c),expect(d).toBeDisabled()}),it("should remain enabled if a file input has ever been changed",function(){var b=this.$node.find("[type=file]"),c=this.$textField,d=this.component.$submit,e=c.val();expect(d).toBeDisabled(),a(b),expect(d).not.toBeDisabled(),a(c,e+" modified"),expect(d).not.toBeDisabled(),a(c,e),expect(d).not.toBeDisabled()})})}),describe("Supported input types",function(){function b(b){return function(){var c=this.$node.find(b),d=this.component.$submit,e=c.val();expect(d).toBeDisabled(),a(c,e+" has changed"),expect(d).not.toBeDisabled(),a(c,e),expect(d).toBeDisabled()}}it("Text inputs",b("input[type=text]")),it("Hidden inputs",b("input[type=hidden]")),it("Checkboxes",b("input[type=checkbox]")),it("Radio buttons",b("input[type=radio]:checked")),it("Select inputs",b("select:not([multiple])")),it("Multiple select",b("select[multiple=multiple]")),it("Textarea",b("textarea")),it("File inputs",function(){expect(this.component.$submit).toBeDisabled(),$("input[type=file]").trigger("change"),expect(this.component.$submit).not.toBeDisabled()})})})
});
define("test/app/ui/forms/mobile_gallery_email_form_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/forms/mobile_gallery_email_form",function(){beforeEach(function(){var a='<form class="dialog-form">\n        <fieldset class="common-form">\n          <label class="field">\n            <span class="label">{{_i}}Enter your email address:{{/i}}</span>\n            <span class="input-wrapper">\n              <input type="email" name="email" required/>\n            </span>\n            <span class="notification"></span>\n          </label>\n        </fieldset>\n        <div class="modal-footer">\n          <div class="dialog-prompt">\n            <input type="submit" class="btn primary-btn submit js-submit" value="{{_i}}Send link{{/i}}">\n          </div>\n        </div>\n      </form>\n    ';setupComponent(a),this.component.$node.find("input[name=email]").val("hello@me.com")}),describe("emailValid",function(){it("should be true for emails",function(){expect(this.component.emailValid()).toBeTruthy()}),it("should be false non-emails",function(){this.component.$node.find("input[name=email]").val("bad@email"),expect(this.component.emailValid()).toBeFalsy()})}),describe("inline notification",function(){it("should show when keyup with good email",function(){jasmine.Clock.useMock(),this.component.$node.find("input[name=email]").trigger("keyup"),jasmine.Clock.tick(500),expect(this.component.$node.find(".notification")).toBeHidden()}),it("should hide when keyup with bad email",function(){jasmine.Clock.useMock(),this.component.$node.find("input[name=email]").val("bad@email"),this.component.$node.find("input[name=email]").trigger("keyup"),jasmine.Clock.tick(500),expect(this.component.$node.find(".notification")).toBeVisible()})}),describe("form",function(){it("should trigger uiSendDownloadLink on submit",function(){spyOnEvent(document,"uiSendDownloadLink"),this.component.trigger("submit"),expect("uiSendDownloadLink").toHaveBeenTriggeredOn(document)}),it("should do nothing on submit with invalid email",function(){this.component.$node.find("input[name=email]").val("bad@email"),spyOnEvent(document,"uiSendDownloadLink"),this.component.trigger("submit"),expect("uiSendDownloadLink").not.toHaveBeenTriggeredOn(document)})}),describe("event dataSendDownloadLinkSuccess",function(){it("triggers uiShowMessage and uiCloseMobileGalleryDownloadDialog",function(){spyOnEvent(document,"uiShowMessage"),spyOnEvent(document,"uiCloseMobileGalleryDownloadDialog"),this.component.trigger("dataSendDownloadLinkSuccess"),expect("uiShowMessage").toHaveBeenTriggeredOn(document),expect("uiCloseMobileGalleryDownloadDialog").toHaveBeenTriggeredOn(document)}),it("scribes notification_sent",function(){this.component.trigger("dataSendDownloadLinkSuccess"),expect(this.component).toScribe({component:"send_link_form",action:"notification_sent"})})}),describe("event dataSendDownloadLinkError",function(){it("triggers events for over limit error",function(){var a={errors:[{message:"Over limit",code:33}]};spyOnEvent(document,"uiShowError"),spyOnEvent(document,"uiCloseMobileGalleryDownloadDialog"),this.component.trigger("dataSendDownloadLinkError",a),expect("uiShowError").toHaveBeenTriggeredOnAndWith(document,{message:a.errors[0].message}),expect("uiCloseMobileGalleryDownloadDialog").toHaveBeenTriggeredOn(document)}),it("does not trigger events for invalid email errors",function(){var a={error:"This email is invalid.",request:"/download/send_link.json"};spyOnEvent(document,"uiShowError"),spyOnEvent(document,"uiCloseMobileGalleryDownloadDialog"),this.component.trigger("dataSendDownloadLinkError",a),expect("uiShowError").not.toHaveBeenTriggeredOn(document),expect("uiCloseMobileGalleryDownloadDialog").not.toHaveBeenTriggeredOn(document)}),it("shows notification for invalid email errors",function(){var a={error:"This email is invalid.",request:"/download/send_link.json"};this.component.trigger("dataSendDownloadLinkError",a),expect(this.component.$node.find(".notification")).toBeVisible()})})})
});
define("test/app/ui/forms/element_group_toggler_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/forms/element_group_toggler",function(){function a(a){var b;for(b=0;b<a.length;b++)expect(a[b].disabled).toBeTruthy()}function b(a){var b;for(b=0;b<a.length;b++)expect(a[b].disabled).toBeFalsy()}beforeEach(function(){var a='<div>\n        <input type="checkbox" class="toggler" id="toggler1">\n        <input type="radio" class="toggleable" id="radio1">\n        <input type="radio" class="toggleable" id="radio2">\n        <select class="toggleable" id="select-elem">\n        <input type="radio" id="non-toggleable">\n      </div>\n    ';setupComponent(a)}),it("should change the disabled state of toggleables after clicking a toggler",function(){var c=this.component.$node.find(".toggleable"),d=this.component.$node.find("#toggler1"),e=this.component.$node.find("#non-toggleable")[0];b(c),d.click(),a(c),expect(e.disabled).toBeFalsy(),d.click(),b(c),expect(e.disabled).toBeFalsy()}),it("prevents multiple elements from being togglers",function(){$('<input type="checkbox" class="toggler" id="toggler2">').appendTo(this.component.$node),expect(function(){this.Component.attachTo(this.component.$node)}).toThrow()})})
});
define("test/app/data/trends/location_dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/trends/location_dialog",function(){var a={location:{woeid:1,name:"Worldwide"},personalized:!1};beforeEach(function(){setupComponent()}),describe("event uiWantsTrendsLocationDialog",function(){it("makes a GET request to /trends/location_dialog",function(){this.component.trigger("uiWantsTrendsLocationDialog"),expect($.ajax.mostRecentOptions.url).toBe("/trends/location_dialog"),expect($.ajax.mostRecentOptions.type).toBe("GET")}),it("triggers dataGotTrendsLocationDialog on success",function(){ajaxRespondWithSuccess({}),spyOnEvent(document,"dataGotTrendsLocationDialog"),this.component.trigger("uiWantsTrendsLocationDialog"),expect("dataGotTrendsLocationDialog").toHaveBeenTriggeredOn(document)}),it("triggers dataGotTrendsLocationDialogError on error",function(){ajaxRespondWithError({msg:"error!"}),spyOnEvent(document,"dataGotTrendsLocationDialogError"),this.component.trigger("uiWantsTrendsLocationDialog"),expect("dataGotTrendsLocationDialogError").toHaveBeenTriggeredOn(document)})}),describe("event uiChangeLocation",function(){it('makes a POST request to "/trends/dialog"',function(){this.component.trigger("uiChangeLocation",a);var b=$.ajax.mostRecentOptions;expect(b.url).toBe("/trends/dialog"),expect(b.type).toBe("POST"),expect(b.data.pc).toBe(!0),expect(b.data.woeid).toBe(1),expect(b.data.personalized).toBe(!1)}),describe("when personalized trends are selected",function(){it("makes a POST request with appropriate data",function(){this.component.trigger("uiChangeLocation",{personalized:!0});var a=$.ajax.mostRecentOptions;expect(a.url).toBe("/trends/dialog"),expect(a.type).toBe("POST"),expect(a.data.pc).toBe(!0),expect(a.data.woeid).toBeUndefined(),expect(a.data.personalized).toBe(!0)})}),describe("on success",function(){beforeEach(function(){spyOnEvent(document,"dataChangedTrendLocation"),spyOnEvent(document,"dataTempTrendsCacheKeyChanged"),spyOnEvent(document,"dataPageMutated"),spyOnEvent(document,"uiRefreshTrends")}),it("triggers dataChangedTrendLocation",function(){ajaxRespondWithSuccess({}),this.component.trigger("uiChangeLocation",a),expect("dataChangedTrendLocation").toHaveBeenTriggeredOn(document)}),it("triggers dataTempTrendsCacheKeyChanged",function(){ajaxRespondWithSuccess({trends_cache_key:1}),this.component.trigger("uiChangeLocation",a),expect("dataTempTrendsCacheKeyChanged").toHaveBeenTriggeredOn(document),expect("dataPageMutated").toHaveBeenTriggeredOn(document)}),it("triggers 'uiRefreshTrends' with the results of the ajax response",function(){ajaxRespondWithSuccess({update_module_html:!0,woeid:1,personalized:a.personalized,pc:!0}),this.component.trigger("uiChangeLocation",a),expect("uiRefreshTrends").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({woeid:a.location.woeid,personalized:a.personalized,pc:!0,update_module_html:!0}))})}),it("triggers dataGotTrendsLocationDialogError on error",function(){ajaxRespondWithError({msg:"error!"}),spyOnEvent(document,"dataGotTrendsLocationDialogError"),this.component.trigger("uiChangeLocation",a),expect("dataGotTrendsLocationDialogError").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/trends/recent_locations_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/trends/recent_locations",function(){var a=[{name:"Worldwide",woeid:1},{name:"United States",woeid:1132412},{name:"New York",woeid:32245234}];beforeEach(function(){this.setupComponent()}),describe("#hasRecentLocation",function(){beforeEach(function(){spyOn(this.component.storage,"getArray").andReturn(a)}),it("return true for a stored location",function(){expect(this.component.hasRecentLocation(1)).toBe(!0)}),it("return false for a stored location",function(){expect(this.component.hasRecentLocation(2352352352)).toBe(!1)})}),describe("event uiWantsRecentTrendLocations",function(){beforeEach(function(){spyOnEvent(document,"dataGotRecentTrendLocations")}),it("triggers dataGotRecentTrendLocations",function(){this.component.trigger("uiWantsRecentTrendLocations"),expect("dataGotRecentTrendLocations").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({trendLocations:[]}))}),it("returns stored trend locations",function(){spyOn(this.component.storage,"getArray").andReturn(a),this.component.trigger("uiWantsRecentTrendLocations"),expect("dataGotRecentTrendLocations").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({trendLocations:a}))})}),describe("event dataChangedTrendLocation",function(){describe("when triggered with valid location",function(){beforeEach(function(){this.getRecentTrendLocationsSpy=spyOn(this.component,"getRecentTrendLocations"),this.component.trigger("dataChangedTrendLocation",{location:{name:"Worldwide",woeid:1}})}),it("should save new location",function(){expect(this.component.hasRecentLocation(1)).toBe(!0)}),it("should call getRecentTrendLocations",function(){expect(this.getRecentTrendLocationsSpy).toHaveBeenCalled()}),it("should not save a location twice",function(){this.getRecentTrendLocationsSpy.reset(),this.component.trigger("dataChangedTrendLocation",{location:{name:"Worldwide",woeid:1}}),expect(this.getRecentTrendLocationsSpy.callCount).toEqual(0)})}),describe("when triggered with invalid location",function(){beforeEach(function(){spyOn(this.component,"getRecentTrendLocations"),this.component.trigger("dataChangedTrendLocation",{location:{}})}),it("should not save location",function(){expect(this.component.getRecentTrendLocations).not.toHaveBeenCalled()})}),describe("#storage",function(){var a=function(a){return{woeid:a,name:"test "+a}};it("monitor max elements",function(){this.component.trigger("dataChangedTrendLocation",{location:a(1)}),this.component.trigger("dataChangedTrendLocation",{location:a(2)}),this.component.trigger("dataChangedTrendLocation",{location:a(3)}),this.component.trigger("dataChangedTrendLocation",{location:a(4)}),this.component.trigger("dataChangedTrendLocation",{location:a(5)}),this.component.trigger("dataChangedTrendLocation",{location:a(6)}),expect(this.component.hasRecentLocation(1)).toEqual(!1),expect(this.component.hasRecentLocation(3)).toEqual(!0),expect(this.component.hasRecentLocation(6)).toEqual(!0)})})})})
});
define("test/app/data/typeahead/trend_locations_datasource_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/data/typeahead/trend_locations_datasource",function(){var a={items:[{name:"Worldwide"},{name:"United States"},{name:"San Francisco"},{name:"New York"},{name:"New Orleans"},{name:"New Rochelle"}],limit:2};beforeEach(function(){this.datasource=new this.Module(a,{id:"trendLocations"})}),describe("getLocalSuggestions",function(){it("return $limit trend locations when no query is specified",function(){expect(this.datasource.getLocalSuggestions({query:""})).toEqual(a.items.slice(0,2))}),it("respects the set limit for response",function(){var a=[{name:"New York"},{name:"New Orleans"}];expect(this.datasource.getLocalSuggestions({query:"New"})).toEqual(a)}),it("ignores query case sensitivity",function(){expect(this.datasource.getLocalSuggestions({query:"new"}).length).not.toEqual(0)}),it("ignores query spaces",function(){expect(this.datasource.getLocalSuggestions({query:"newy"}).length).toEqual(1)}),it("returns no results item when no suggestions match",function(){var a=this.datasource.getLocalSuggestions({query:"DNE"})[0];expect(a.woeid).toEqual(-1),expect(a.placeTypeCode).toEqual(-1)})}),describe("setTrendLocations",function(){it("updates the internal items attribute",function(){var a={name:"test"};this.datasource.setTrendLocations({trendLocations:a}),expect(this.datasource.attr.items).toEqual(a)})})})
});
define("test/app/data/typeahead/topics_datasource_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/data/typeahead/topics_datasource",function(){var a=[{topic:"twoffice",tokens:[{token:"twoffice"}],rounded_score:440},{topic:"twitter",tokens:[{token:"twitter"}],rounded_score:11140},{topic:"twars",tokens:[{token:"twars"}],rounded_score:100},{topic:"$appl",tokens:[{token:"$appl"}],rounded_score:40},{topic:"$fb",tokens:[{token:"$fb"}],rounded_score:14},{topic:"#winning",tokens:[{token:"#winning"}],rounded_score:4},{topic:"＃fixedWidthWinning",tokens:[{token:"＃fixedWidthWinning"}],rounded_score:3}],b={twitter:{topic:"twitter",tokens:[{token:"twitter"}],rounded_score:11140},twoffice:{topic:"twoffice",tokens:[{token:"twoffice"}],rounded_score:440},twars:{topic:"twars",tokens:[{token:"twars"}],rounded_score:100},$appl:{topic:"$appl",tokens:[{token:"$appl"}],rounded_score:40},$fb:{topic:"$fb",tokens:[{token:"$fb"}],rounded_score:14},"#winning":{topic:"#winning",tokens:[{token:"#winning"}],rounded_score:4},"＃fixedWidthWinning":{topic:"＃fixedWidthWinning",tokens:[{token:"＃fixedWidthWinning"}],rounded_score:3}},c={topic:"tWitter",tokens:[{token:"tWitter"}],rounded_score:11140},d={t:["twoffice","twitter","twars"],$:["$appl","$fb"],"#":["#winning"],"＃":["＃fixedWidthWinning"]};describe("prefetch fails and stale data loaded from localstorage",function(){beforeEach(function(){ajaxRespondWithError({}),this.datasource=new this.Module({id:"topics",localQueriesEnabled:!0,remoteQueriesEnabled:!0,ttl_ms:1e4})}),it("loads data from local storage if ajax call fails",function(){spyOn(this.datasource.storage,"now").andReturn((new Date).getTime()+2e4),expect($.ajax).toHaveBeenCalled(),expect($.ajax.callCount).toBe(1),this.datasource.storage.setItem(this.datasource.attr.storageHash,b,0),expect(this.datasource.topicsHash).toEqual({}),this.datasource.attr.version=-1,this.datasource.loadData(),expect($.ajax.callCount).toBe(2),expect(this.datasource.topicsHash).toEqual(b)})}),describe("no local queries",function(){it("does not prefetch on boot",function(){expect($.ajax).not.toHaveBeenCalled(),this.datasource=new this.Module({id:"topics",localQueriesEnabled:!1,remoteQueriesEnabled:!0,ttl_ms:-1}),expect($.ajax).not.toHaveBeenCalled()})}),describe("prefetch",function(){beforeEach(function(){ajaxRespondWithSuccess({topics:a}),this.datasource=new this.Module({id:"topics",localQueriesEnabled:!0,remoteQueriesEnabled:!0,ttl_ms:1e4})}),it("does not prefetch if the cache is current",function(){spyOn(this.datasource.storage,"now").andReturn((new Date).getTime()+10),expect($.ajax).toHaveBeenCalled(),this.datasource.loadData(),expect($.ajax.callCount).toBe(1)}),it("does not prefetch if the cache is old",function(){spyOn(this.datasource.storage,"now").andReturn((new Date).getTime()+2e4),expect($.ajax).toHaveBeenCalled(),this.datasource.loadData(),expect($.ajax.callCount).toBe(2)}),it("prefetches data from the API",function(){expect($.ajax).toHaveBeenCalled(),expect(this.datasource.topicsHash).toEqual(b),expect(this.datasource.adjacencyList).toEqual(d)}),it("loads data from local storage",function(){expect($.ajax).toHaveBeenCalled(),expect($.ajax.callCount).toBe(1),this.datasource.topicsHash={},this.datasource.loadData(),expect($.ajax.callCount).toBe(1),expect(this.datasource.topicsHash).toEqual(b)}),it("versioning prefetches data when the localStorage version is out of date",function(){expect($.ajax).toHaveBeenCalled(),expect($.ajax.callCount).toBe(1),this.datasource.topicsHash={},this.datasource.attr.version=-1,this.datasource.loadData(),expect($.ajax.callCount).toBe(2),expect(this.datasource.topicsHash).toEqual(b)}),it("requests with the correct header",function(){this.datasource.getLocalSuggestions({query:"twitter"}),expect($.ajax.mostRecentOptions.headers["X-Phx"]).toBe(!0)}),it("matches",function(){expect(this.datasource.getLocalSuggestions({query:"twitter"})).toEqual([{topic:"twitter",tokens:[{token:"twitter"}],rounded_score:11140}])}),it("matches regardless of case",function(){expect(this.datasource.getLocalSuggestions({query:"TwiTTer"})).toEqual([{topic:"twitter",tokens:[{token:"twitter"}],rounded_score:11140}])}),it("does not match",function(){expect(this.datasource.getLocalSuggestions({query:"test"})).toEqual([])}),it("respects a limit",function(){this.datasource.attr.limit=2,expect(this.datasource.getLocalSuggestions({query:"tw"})).toEqual([{topic:"twitter",tokens:[{token:"twitter"}],rounded_score:11140},{topic:"twoffice",tokens:[{token:"twoffice"}],rounded_score:440}])}),it("does not match multiterm queries",function(){expect(this.datasource.getLocalSuggestions({query:"justin chen"})).toEqual([])}),it("concatenates local and remote results",function(){var a={topics:[b.twars,b.twitter]},c={topics:[b.twoffice]};expect(this.datasource.processRemoteSuggestions({query:"test"},c,a)).toEqual({topics:[b.twars,b.twitter,b.twoffice]})}),it("trims local and remote results to a limit",function(){var a={topics:[b.twars,b.twitter]},c={topics:[b.twoffice,b.$appl]};this.datasource.attr.limit=3,expect(this.datasource.processRemoteSuggestions({query:"test"},c,a)).toEqual({topics:[b.twars,b.twitter,b.twoffice]})}),it("filters duplicated topics between local/remote result sets",function(){var a={topics:[b.twars,b.twitter]},d={topics:[b.twoffice,c]};expect(this.datasource.processRemoteSuggestions({query:"test"},d,a)).toEqual({topics:[b.twars,b.twitter,b.twoffice]})}),it("sorts topics by score",function(){expect(this.datasource.getLocalSuggestions({query:"tw"})).toEqual([b.twitter,b.twoffice,b.twars])})}),describe("prefetch remoteType hashtag",function(){beforeEach(function(){ajaxRespondWithSuccess({topics:a}),this.datasource=new this.Module({id:"topics",localQueriesEnabled:!0,remoteQueriesEnabled:!0,ttl_ms:1e3,remoteType:"hashtags"})}),describe("getLocalSuggestions",function(){it("matches when the query starts with a normal hashtag",function(){expect(this.datasource.getLocalSuggestions({query:"#winning"}).length).toEqual(1)}),it("does not match when the query starts without a hashtag",function(){expect(this.datasource.getLocalSuggestions({query:"winning"}).length).toEqual(0)}),it("matches when the query starts with a cashtag",function(){expect(this.datasource.getLocalSuggestions({query:"$fb"}).length).toEqual(1)}),it("does not match when the query does not start with a cashtag",function(){expect(this.datasource.getLocalSuggestions({query:"fb"}).length).toEqual(0)}),it("matches when the query starts with a fixed-width hashtag",function(){expect(this.datasource.getLocalSuggestions({query:"＃fixedWidthWinning"}).length).toEqual(1)}),it("does not match when the query does not start with a fixed-width hashtag",function(){expect(this.datasource.getLocalSuggestions({query:"fixedWidthWinning"}).length).toEqual(0)})})})})
});
define("test/app/data/typeahead/with_cache_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/data/typeahead/with_cache",function(){describe("typeaheadCache",function(){beforeEach(function(){setupComponent({cache_limit:2})}),describe("aroundGetSuggestions",function(){it("should call triggerSuggestionsEvent if cached results are found",function(){spyOn(this.component,"getCachedSuggestions").andReturn("cached"),spyOn(this.component,"triggerSuggestionsEvent"),this.component.aroundGetSuggestions(function(){throw"failure"},null,{id:"",query:"m"}),expect(this.component.getCachedSuggestions).toHaveBeenCalled(),expect(this.component.triggerSuggestionsEvent).toHaveBeenCalled()}),it("should not call triggerSuggestionsEvent if no cache results were found",function(){spyOn(this.component,"getCachedSuggestions").andReturn(null),spyOn(this.component,"triggerSuggestionsEvent");var a=!1;this.component.aroundGetSuggestions(function(){a=!0},null,{id:"",query:"m"}),expect(this.component.triggerSuggestionsEvent).not.toHaveBeenCalled(),expect(a).toEqual(!0)})}),describe("afterTriggerSuggestionsEvent",function(){it("should update the cache with the suggestions if remote",function(){spyOn(this.component,"setCachedSuggestions"),this.component.afterTriggerSuggestionsEvent("","key","suggestions",!1),expect(this.component.setCachedSuggestions).toHaveBeenCalled()}),it("should not update the cache if local results",function(){spyOn(this.component,"setCachedSuggestions"),this.component.afterTriggerSuggestionsEvent("","key","suggestions",!0),expect(this.component.setCachedSuggestions).not.toHaveBeenCalled()})}),describe("setCachedSuggestions",function(){it("should cache things",function(){this.component.setCachedSuggestions("t",[1,2,3,4]),expect(this.component.getCachedSuggestions("t")).toEqual([1,2,3,4])}),it("should delete the oldest query if the limit is exceeded",function(){this.component.cache.LIMIT=3,this.component.setCachedSuggestions("t",[1,2,3,4]),this.component.setCachedSuggestions("te",[1,2,3]),this.component.setCachedSuggestions("tes",[1,2]),this.component.setCachedSuggestions("test",[1]),expect(this.component.cache.COUNT).toBe(3),expect(this.component.cache.t).toBe(undefined),expect(this.component.cache.NEWEST.query).toEqual("test"),expect(this.component.cache.OLDEST.query).toEqual("te")}),it("should override existing values",function(){this.component.setCachedSuggestions("t",[1,2,3,4]),this.component.setCachedSuggestions("t",[1]),expect(this.component.getCachedSuggestions("t")).toEqual([1]),expect(this.component.cache.NEWEST.query).toEqual("t"),expect(this.component.cache.OLDEST.query).toEqual("t")}),it("does not cache if the limit is 0",function(){this.component.cache.LIMIT=0,this.component.setCachedSuggestions("t",[1]),expect(this.component.getCachedSuggestions("t")).toEqual(undefined)})}),describe("deleteCachedSuggestions",function(){it("should delete items in the cache",function(){this.component.setCachedSuggestions("t",[1,2,3,4]),this.component.deleteCachedSuggestions("t"),expect(this.component.cache.t).toBe(undefined)}),it("should maintain the correct ordering after deleting an item",function(){this.component.cache.LIMIT=4,this.component.setCachedSuggestions("t",[1,2,3,4]),this.component.setCachedSuggestions("te",[1,2,3]),this.component.setCachedSuggestions("tes",[1,2]),this.component.setCachedSuggestions("test",[1]),this.component.deleteCachedSuggestions("te"),expect(this.component.cache.NEWEST.query).toEqual("test"),expect(this.component.cache.OLDEST.query).toEqual("t"),expect(this.component.cache.OLDEST.after.query).toEqual("tes"),expect(this.component.cache.tes.before.query).toEqual("t")})})})})
});
define("test/app/data/typeahead/saved_searches_datasource_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/data/typeahead/saved_searches_datasource",function(){var a={items:[{name:"twitter"},{name:"twitpack"},{name:"twitpic"}],limit:2};beforeEach(function(){this.datasource=new this.Module(a,{id:"savedSearches"})}),describe("getLocalSuggestions",function(){it("returns saved searches when no query is specified",function(){expect(this.datasource.getLocalSuggestions({query:""})).toBe(a.items)}),it("returns max 2 when a query is specified",function(){var a=[{name:"twitter"},{name:"twitpack"}];expect(this.datasource.getLocalSuggestions({query:"twit"})).toEqual(a)}),it("respects the set limit for response",function(){this.datasource.attr.limit=3,expect(this.datasource.getLocalSuggestions({query:"twit"})).toEqual(a.items)}),it("does matching",function(){expect(this.datasource.getLocalSuggestions({query:"twitpi"})).toEqual([{name:"twitpic"}])}),it("returns an empty array when limit is 0",function(){this.datasource.attr.limit=0,expect(this.datasource.getLocalSuggestions({query:"twit"})).toEqual([])})}),describe("addSavedSearch",function(){it("does nothing if data param is not provided",function(){this.datasource.addSavedSearch(null),expect(this.datasource.attr.items).toEqual(a.items)}),it("adds new saved search to items",function(){var a={created_at:"Wed Nov 21 02:15:45 +0000 2012",id:1368982795,id_str:"1368982795",name:"chatty",position:null,query:"chatty",sourceEventData:""},b=[{name:"twitter"},{name:"twitpack"},{name:"twitpic"},{id:1368982795,id_str:"1368982795",name:"chatty",query:"chatty",saved_search_path:"/search?src=savs&q=chatty",search_query_source:"saved_search_click"}];this.datasource.addSavedSearch(a),expect(this.datasource.attr.items).toEqual(b)})}),describe("removeSavedSearch",function(){it("does nothing if data param is not provided",function(){this.datasource.removeSavedSearch(null),expect(this.datasource.attr.items).toEqual(a.items)}),it("removes saved search from items",function(){var a={created_at:"Wed Nov 21 02:15:45 +0000 2012",id:1368982795,id_str:"1368982795",name:"twitter",position:null,query:"twitter",sourceEventData:""},b=[{name:"twitpack"},{name:"twitpic"},{id:1368982795,id_str:"1368982795",name:"chatty",query:"chatty",saved_search_path:"/search?src=savs&q=chatty",search_query_source:"saved_search_click"}];this.datasource.removeSavedSearch(a),expect(this.datasource.attr.items).toEqual(b)})})})
});
define("test/app/data/typeahead/recent_searches_datasource_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/data/typeahead/recent_searches_datasource",function(){var a={normalized_name:"twitter",name:"twitter",recent_search_path:"/search?src=typd&q=twitter",search_query_source:"typed_query"},b={normalized_name:"twitpack",name:"twitpack",recent_search_path:"/search?src=typd&q=twitpack",search_query_source:"typed_query"},c={normalized_name:"twitpic",name:"twitpic",recent_search_path:"/search?src=typd&q=twitpic",search_query_source:"typed_query"},d={normalized_name:"chatty",name:"chatty",recent_search_path:"/search?src=typd&q=chatty",search_query_source:"typed_query"},e=[a,b,c],f={normalized_name:"a",name:"A",recent_search_path:"/search?src=typd&q=A",search_query_source:"typed_query"},g={normalized_name:"b",name:"B",recent_search_path:"/search?src=typd&q=B",search_query_source:"typed_query"},h={normalized_name:"c",name:"C",recent_search_path:"/search?src=typd&q=C",search_query_source:"typed_query"},i={normalized_name:"d",name:"D",recent_search_path:"/search?src=typd&q=D",search_query_source:"typed_query"},j={normalized_name:"b",name:"b",recent_search_path:"/search?src=typd&q=b",search_query_source:"typed_query"},k={limit:2,maxLength:5};beforeEach(function(){this.datasource=new this.Module(k,{id:"recentSearches"}),this.datasource.items=e.slice(0)}),describe("getLocalSuggestions",function(){it("returns max 2 when a query is specified",function(){expect(this.datasource.getLocalSuggestions({query:"twit"})).toEqual(e.slice(0,2))}),it("respects the set limit for response",function(){this.datasource.attr.limit=3,expect(this.datasource.getLocalSuggestions({query:"twit"})).toEqual(e)}),it("returns default array when no query is specified",function(){expect(this.datasource.getLocalSuggestions({query:""})).toEqual(e.slice(0,2))}),it("does matching",function(){expect(this.datasource.getLocalSuggestions({query:"twitpi"})).toEqual([c])}),it("returns an empty array when limit is 0",function(){this.datasource.attr.limit=0,expect(this.datasource.getLocalSuggestions({query:"twit"})).toEqual([])})}),describe("addRecentSearch",function(){it("does nothing if data param is not provided",function(){this.datasource.addRecentSearch(null),expect(this.datasource.items).toEqual(e)}),it("adds new recent search to items",function(){var a={query:"chatty"},b=[d].concat(e);this.datasource.addRecentSearch(a),expect(this.datasource.items).toEqual(b)}),it("trims the extra white space",function(){var a={query:"chatty  "},b=[d].concat(e);this.datasource.addRecentSearch(a),expect(this.datasource.items).toEqual(b)})}),describe("removeRecentSearchFromList",function(){it("removes recent search from memory and localstorage",function(){var a=this.datasource;a.removeRecentSearchFromList("twitter");var b=e.slice(1);expect(a.items).toEqual(b)}),it("removes the recent search even with different casing",function(){var a=this.datasource;a.removeRecentSearchFromList("tWiTtEr");var b=e.slice(1);expect(a.items).toEqual(b)})}),describe("removeAllRecentSearches",function(){it("removes all recent searches from memory and localstorage",function(){var a=this.datasource;spyOn(a,"updateStorage"),a.removeAllRecentSearches(),expect(a.items).toEqual([]),expect(a.updateStorage).toHaveBeenCalled()})}),describe("updateRecentSearchList",function(){beforeEach(function(){this.datasource.items=[f,g,h]}),it("if a query is in the list, it should be moved to the front",function(){this.datasource.addRecentSearch({query:"B"});var a=[g,f,h];expect(this.datasource.items).toEqual(a)}),it("should move the query to the front even if it has different case",function(){this.datasource.addRecentSearch({query:"b"});var a=[j,f,h];expect(this.datasource.items).toEqual(a)}),it("if maxLength of list is reached, the oldest (last in list) query should be popped off",function(){this.datasource.attr.maxLength=3,this.datasource.addRecentSearch({query:"D"});var a=[i,f,g];expect(this.datasource.items).toEqual(a)}),it("if a query is not in the list, it should be added to the front",function(){this.datasource.addRecentSearch({query:"D"});var a=[i,f,g,h];expect(this.datasource.items).toEqual(a)})})})
});
define("test/app/data/typeahead/accounts_datasource_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/data/typeahead/accounts_datasource",function(){function c(a){return a=$.extend(!0,{},a),a.tokens=a.tokens.map(function(a){return a.token}),a}var a=[{screen_name:"timtrueman",profile_image_url:"http://a0.twimg.com/profile_images/2011876236/1_mini.jpg",name:"Tim Trueman",id:10273252,tokens:[{token:"tim"},{token:"trueman"},{token:"timtrueman"},{token:"@timtrueman"}]},{screen_name:"jcummins",profile_image_url:"http://a0.twimg.com/profile_images/profile_images/1244859041/me_mini.jpg",name:"J.P. Cummins",id:13039722,tokens:[{token:"j.p."},{token:"cummins"},{token:"jcummins"},{token:"@jcummins"}]},{screen_name:"alexcebrian",profile_image_url:"http://a0.twimg.com/profile_images/1202598849/x2_mini.jpg",name:"Alex Cebrian",id:40151220,tokens:[{token:"alex"},{token:"cebrian"},{token:"alexcebrian"},{token:"@alexcebrian"}],is_dmable:!0},{screen_name:"𝟙emojiGirl",profile_image_url:"http://a0.twimg.com/profile_images/1202598849/x2_mini.jpg",name:"𝟙emojiGirl",id:1234,tokens:[{token:"𝟙emojiGirl"},{token:"@𝟙emojiGirl"}],is_dmable:!0},{screen_name:"maxykanter",profile_image_url:"http://a0.twimg.com/profile_images/1300397656/184373_10150163203551995_520771994_8413187_4738665_n__1__mini.jpg",name:"Max Kanter",id:89626699,tokens:[{token:"max"},{token:"kanter"},{token:"maxykanter"},{token:"@maxykanter"}]}],b=[{screen_name:"timtrueman",profile_image_url:"http://a0.twimg.com/profile_images/2011876236/1_mini.jpg",name:"Tim Trueman",id:10273252,tokens:["tim","trueman","timtrueman","@timtrueman"]},{screen_name:"jcummins",profile_image_url:"http://a0.twimg.com/profile_images/profile_images/1244859041/me_mini.jpg",name:"J.P. Cummins",id:13039722,tokens:["j.p.","cummins","jcummins","@jcummins"]},{screen_name:"alexcebrian",profile_image_url:"http://a0.twimg.com/profile_images/1202598849/x2_mini.jpg",name:"Alex Cebrian",id:40151220,tokens:["alex","cebrian","alexcebrian","@alexcebrian"],is_dm_able:!0,social_context:{following:!1}},{screen_name:"maxykanter",profile_image_url:"http://a0.twimg.com/profile_images/1300397656/184373_10150163203551995_520771994_8413187_4738665_n__1__mini.jpg",name:"Max Kanter",id:89626699,tokens:["max","kanter","maxykanter","@maxykanter"]},{screen_name:"𝟙emojiGirl",profile_image_url:"http://a0.twimg.com/profile_images/1202598849/x2_mini.jpg",name:"𝟙 emojiGirl",id:1234,tokens:["𝟙emojiGirl","𝟙emojiGirl","@𝟙emojiGirl"],is_dmable:!0}],d={12345:12345},e={10273252:c(a[0]),13039722:c(a[1]),40151220:c(a[2]),1234:c(a[3]),89626699:c(a[4])},f={t:[10273252],"@":[10273252,13039722,40151220,1234,89626699],j:[13039722],c:[13039722,40151220],a:[40151220],"𝟙":[1234],m:[89626699],k:[89626699]};describe("prefetch fails and stale data loaded from localstorage",function(){beforeEach(function(){ajaxRespondWithError({}),this.datasource=new this.Module({id:"accounts",localQueriesEnabled:!0,remoteQueriesEnabled:!0,ttl_ms:1e3})}),it("loads data from local storage if ajax call fails",function(){spyOn(this.datasource.storage,"now").andReturn((new Date).getTime()+2e3),expect($.ajax).toHaveBeenCalled(),expect($.ajax.callCount).toBe(1),this.datasource.storage.setItem(this.datasource.attr.storageHash,e,0),expect(this.datasource.userHash).toEqual({}),this.datasource.attr.version=-1,this.datasource.loadData(),expect($.ajax.callCount).toBe(2),expect(this.datasource.userHash).toEqual(e)})}),describe("general datasource configuration params",function(){beforeEach(function(){ajaxRespondWithSuccess({testType:$.extend(!0,[],a)}),this.datasource=new this.Module({id:"myId",localQueriesEnabled:!0,remoteQueriesEnabled:!0,prefetchPath:"/test/",prefetchType:"testType",remoteType:"remoteType",ttl_ms:1e3})}),it("queries the given remote prefetch path using prefetchType and parses that field on response",function(){expect($.ajax).toHaveBeenCalled(),expect($.ajax.mostRecentOptions.url).toBe("/test/"),expect($.ajax.mostRecentOptions.data.result_type).toBe("testType"),expect(this.datasource.adjacencyList).toEqual(f),expect(this.datasource.userHash).toEqual(e)}),it("returns remote results based on it's given remoteType into its id",function(){var a=[{id:4},{id:5},{id:6}],b={remoteType:a},c={myId:a};expect(this.datasource.processRemoteSuggestions("test",b,{})).toEqual(c)}),it("reads local results based on it's given id",function(){var a=[{id:4},{id:5},{id:6}],b={myId:a},c={other:[{id:3}]},d={myId:a};expect(this.datasource.processRemoteSuggestions("test",c,b)).toEqual(d)}),it("merges results from local and remote into one field",function(){var a=[{id:4},{id:5},{id:6}],b={myId:a},c={remoteType:[{id:3}]},d={myId:a.concat([{id:3}])};expect(this.datasource.processRemoteSuggestions("test",c,b)).toEqual(d)})}),describe("handles social context blackList operations correctly",function(){beforeEach(function(){this.datasource=new this.Module({ttl_ms:2592e5,storageBlackList:"userBlackList"})}),it("fetches social context blacklist from localStorage",function(){this.datasource.storage.setItem(this.datasource.attr.storageBlackList,d,this.datasource.attr.ttl_ms),this.datasource.initialize(),expect(this.datasource.socialContextBlackList).toEqual(d)}),it("initializes empty blackList if none in localStorage",function(){this.datasource.initialize(),expect(this.datasource.socialContextBlackList).toEqual({})}),it("removes first_connecting_user social context from a suggestion if first_connecting_user in blacklist",function(){this.datasource.initialize(),this.datasource.socialContextBlackList={123:987654321};var a={first_connecting_user_id:123,first_connecting_user_name:"bill frank"};this.datasource.removeBlacklistSocialContext(a),expect(a).toEqual({first_connecting_user_id:undefined,first_connecting_user_name:undefined})})}),describe("localStorage",function(){beforeEach(function(){ajaxRespondWithSuccess({users:$.extend(!0,[],a)}),this.datasource=new this.Module({id:"accounts",localQueriesEnabled:!0,remoteQueriesEnabled:!0,ttl_ms:1e3})}),it("prefetches data from the API",function(){expect($.ajax).toHaveBeenCalled(),expect(this.datasource.adjacencyList).toEqual(f),expect(this.datasource.userHash).toEqual(e)}),it("loads data from local storage",function(){expect($.ajax).toHaveBeenCalled(),expect($.ajax.callCount).toBe(1),this.datasource.adjacency={},this.datasource.userHash={},this.datasource.loadData(),expect($.ajax.callCount).toBe(1),expect(this.datasource.adjacencyList).toEqual(f),expect(this.datasource.userHash).toEqual(e)}),it("versioning prefetches data when the localStorage version is out of date",function(){expect($.ajax).toHaveBeenCalled(),expect($.ajax.callCount).toBe(1),this.datasource.adjacency={},this.datasource.userHash={},this.datasource.attr.version=-1,this.datasource.loadData(),expect($.ajax.callCount).toBe(2),expect(this.datasource.adjacencyList).toEqual(f),expect(this.datasource.userHash).toEqual(e)}),it("switching protocols reloads the data since profile URLs are protocol-specific",function(){expect($.ajax).toHaveBeenCalled(),expect($.ajax.callCount).toBe(1),this.datasource.adjacency={},this.datasource.userHash={},spyOn(this.datasource,"getProtocol").andReturn("https:"),this.datasource.loadData(),expect($.ajax.callCount).toBe(2),expect(this.datasource.adjacencyList).toEqual(f),expect(this.datasource.userHash).toEqual(e)}),describe("prefetch",function(){beforeEach(function(){ajaxRespondWithSuccess({users:$.extend(!0,[],a)}),this.datasource=new this.Module({id:"accounts",localQueriesEnabled:!0,remoteQueriesEnabled:!0,ttl_ms:1e3})}),it("does not prefetch if the cache is current",function(){spyOn(this.datasource.storage,"now").andReturn((new Date).getTime()+10),expect($.ajax).toHaveBeenCalled(),this.datasource.loadData(),expect($.ajax.callCount).toBe(1)}),it("does not prefetch if the cache is old",function(){spyOn(this.datasource.storage,"now").andReturn((new Date).getTime()+2e3),expect($.ajax).toHaveBeenCalled(),this.datasource.loadData(),expect($.ajax.callCount).toBe(2)})}),it("requests with the correct header",function(){this.datasource.getLocalSuggestions({query:"twitter"}),expect($.ajax.mostRecentOptions.headers["X-Phx"]).toBe(!0)}),it("matches",function(){spyOn(this.datasource,"getAccountsFromIds").andReturn(b),expect(this.datasource.getLocalSuggestions({query:"tim"})).toEqual([b[0]])}),it("does not match",function(){spyOn(this.datasource,"getAccountsFromIds").andReturn(b),expect(this.datasource.getLocalSuggestions({query:"test"})).toEqual([])}),it("respects a limit",function(){var a=[1,2,3,4,5,6];spyOn(this.datasource,"getAccountsFromIds").andReturn(a),spyOn(this.datasource,"matcher").andReturn(function(a){return a}),this.datasource.attr.limit=3,expect(this.datasource.getLocalSuggestions({query:"test"})).toEqual([1,2,3])}),it("filters non dmAble people out when attr set on prefetched data",function(){this.datasource.attr.onlyDMable=!0,spyOn(this.datasource,"getAccountsFromIds").andReturn(b),expect(this.datasource.getLocalSuggestions({query:"tim"})).toEqual([])}),it("filters dmAble people when attr set on prefetched data",function(){this.datasource.attr.onlyDMable=!0,spyOn(this.datasource,"getAccountsFromIds").andReturn(b),expect(this.datasource.getLocalSuggestions({query:"alex"})).toEqual([b[2]])}),it("works on multibyte queries",function(){spyOn(this.datasource,"getAccountsFromIds").andReturn(b),expect(this.datasource.getLocalSuggestions({query:"𝟙emoji"})).toEqual([b[4]])}),it("matches multiterm queries",function(){spyOn(this.datasource,"getAccountsFromIds").andReturn(b),expect(this.datasource.getLocalSuggestions({query:"tim true"})).toEqual([b[0]])}),it("does not match multiterm queries",function(){spyOn(this.datasource,"getAccountsFromIds").andReturn(b),expect(this.datasource.getLocalSuggestions({query:"cupcake tim"})).toEqual([])}),it("concatenates local and remote results",function(){var a={accounts:[{id:1},{id:2},{id:3}]};expect(this.datasource.processRemoteSuggestions({query:"test"},{users:[{id:4},{id:5},{id:6}]},a)).toEqual({accounts:[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6}]})}),it("trims local and remote results to a limit",function(){var a={accounts:[{id:1},{id:2}]};this.datasource.attr.limit=3,expect(this.datasource.processRemoteSuggestions({query:"test"},{users:[{id:3},{id:4}]},a)).toEqual({accounts:[{id:1},{id:2},{id:3}]})}),it("filters duplicated users between local/remote result sets",function(){var a={accounts:[{id:1},{id:2},{id:3}]};expect(this.datasource.processRemoteSuggestions({query:"test"},{users:[{id:3},{id:4},{id:5}]},a)).toEqual({accounts:[{id:1},{id:2},{id:3},{id:4},{id:5}]})}),it("filters dmAble people when attr set",function(){this.datasource.attr.onlyDMable=!0;var a={accounts:[]};expect(this.datasource.processRemoteSuggestions({query:"test"},{users:[{id:1,is_dm_able:!0},{id:2},{id:3,is_dm_able:!0}]},a)).toEqual({accounts:[{id:1,is_dm_able:!0},{id:3,is_dm_able:!0}]})}),it("doesn't filter dmAble people normally",function(){this.datasource.attr.onlyDMable=!1;var a={accounts:[]};expect(this.datasource.processRemoteSuggestions({query:"test"},{users:[{id:1,is_dm_able:!0},{id:2},{id:3,is_dm_able:!0}]},a)).toEqual({accounts:[{id:1,is_dm_able:!0},{id:2},{id:3,is_dm_able:!0}]})}),it("sorts accounts: local first, then remote, sorted by graph weight / score within each local/remote section",function(){var a={accounts:[{id:1},{id:2},{id:3}]};expect([{id:1,rounded_graph_weight:1e3,rounded_score:0},{id:2,rounded_graph_weight:500,rounded_score:0},{id:3,rounded_graph_weight:1500,rounded_score:0},{id:4,rounded_graph_weight:0,rounded_score:1e5},{id:5,rounded_graph_weight:0,rounded_score:25e4}].sort(this.datasource.sorter)).toEqual([{id:3,rounded_graph_weight:1500,rounded_score:0},{id:1,rounded_graph_weight:1e3,rounded_score:0},{id:2,rounded_graph_weight:500,rounded_score:0},{id:5,rounded_graph_weight:0,rounded_score:25e4},{id:4,rounded_graph_weight:0,rounded_score:1e5}])}),it("only returns unique ids when looking up potentially matching ids",function(){this.datasource.adjacencyList={a:[1,2,3,4],b:[3,4,5,6]},expect(this.datasource.getPotentiallyMatchingIds(["a","b"])).toEqual([1,2,3,4,5,6])}),it("requiresRemoteSuggestions",function(){var a={query:"Cookie Monster",accountsWithoutAtSignLocalOnly:!1};expect(this.datasource.requiresRemoteSuggestions(a)).toBeTruthy()}),describe("queryData: accountsWithoutAtSignLocalOnly",function(){it("requiresRemoteSuggestions returns true when on and query begins with ampersand",function(){var a={query:"@charlie",accountsWithoutAtSignLocalOnly:!0};expect(this.datasource.requiresRemoteSuggestions(a)).toBeTruthy()}),it("requiresRemoteSuggestions returns false when on and query has no ampersand",function(){var a={query:"charlie",accountsWithoutAtSignLocalOnly:!0};expect(this.datasource.requiresRemoteSuggestions(a)).toBeFalsy()})}),describe("localQueriesEnabled off",function(){beforeEach(function(){this.datasource=new this.Module({localQueriesEnabled:!1})}),it("returns no results on getLocalSuggestions",function(){expect(this.datasource.getLocalSuggestions({query:"tim"})).toEqual([])})}),describe("remoteQueriesEnabled off",function(){beforeEach(function(){this.datasource=new this.Module({remoteQueriesEnabled:!1})}),it("does not requiresRemoteSuggestions",function(){expect(this.datasource.requiresRemoteSuggestions()).toBeFalsy()}),it("returns only local results",function(){var a={accounts:[{id:3}]},b={users:[{id:4},{id:5},{id:6}]};expect(this.datasource.processRemoteSuggestions({query:"test"},b,a)).toEqual(a)})})})})
});
define("test/app/data/typeahead/with_external_event_listeners_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/data/typeahead/with_external_event_listeners",function(){var a=[{screen_name:"timtrueman",profile_image_url:"http://a0.twimg.com/profile_images/2011876236/1_mini.jpg",name:"Tim Trueman",id:"10273252",tokens:["tim","trueman","timtrueman","@timtrueman"]},{screen_name:"jcummins",profile_image_url:"http://a0.twimg.com/profile_images/profile_images/1244859041/me_mini.jpg",name:"J.P. Cummins",id:"13039722",tokens:["j.p.","cummins","jcummins","@jcummins"]},{screen_name:"alexcebrian",profile_image_url:"http://a0.twimg.com/profile_images/1202598849/x2_mini.jpg",name:"Alex Cebrian",id:"40151220",tokens:["alex","cebrian","alexcebrian","@alexcebrian"]},{screen_name:"maxykanter",profile_image_url:"http://a0.twimg.com/profile_images/1300397656/184373_10150163203551995_520771994_8413187_4738665_n__1__mini.jpg",name:"Max Kanter",id:"89626699",tokens:["max","kanter","maxykanter","@maxykanter"]}],b={pre_follow_user:{screen_name:"timtrueman",profile_image_url:"http://a0.twimg.com/profile_images/2011876236/1_mini.jpg",name:"Tim Trueman",id:"1",tokens:["tim","trueman","timtrueman","@timtrueman"],score_boost:0},post_follow_user:{screen_name:"timtrueman",profile_image_url:"http://a0.twimg.com/profile_images/2011876236/1_mini.jpg",name:"Tim Trueman",id:"1",tokens:["tim","trueman","timtrueman","@timtrueman"],score_boost:100},pre_visit_no_cache_user:{screen_name:"timtrueman",profile_image_url:"http://a0.twimg.com/profile_images/2011876236/1_mini.jpg",name:"Tim Trueman",id:"2",tokens:["tim","trueman","timtrueman","@timtrueman"],score_boost:0},post_visit_no_cache_user:{screen_name:"timtrueman",profile_image_url:"http://a0.twimg.com/profile_images/2011876236/1_mini.jpg",name:"Tim Trueman",id:"2",tokens:["tim","trueman","timtrueman","@timtrueman"],score_boost:75},pre_visit_cache_user:{screen_name:"timtrueman",profile_image_url:"http://a0.twimg.com/profile_images/2011876236/1_mini.jpg",name:"Tim Trueman",id:"3",tokens:["tim","trueman","timtrueman","@timtrueman"],score_boost:0},post_visit_cache_user:{screen_name:"timtrueman",profile_image_url:"http://a0.twimg.com/profile_images/2011876236/1_mini.jpg",name:"Tim Trueman",id:"3",tokens:["tim","trueman","timtrueman","@timtrueman"],score_boost:85}},c={itemType:"user",newState:"not-following",new_state:"not-following",originalFollowState:"following",userId:"10273252",user:a[0]},d={itemType:"user",newState:"not-following",new_state:"not-following",originalFollowState:"following",userId:"40151220",user:a[2]},e={itemType:"user",newState:"following",new_state:"following",originalFollowState:"not-following",userId:"89626699",user:a[3]},f=a[3],g={10273252:a[0],13039722:a[1],40151220:a[2],89626699:a[3]},h={t:["10273252"],"@":["10273252","13039722","40151220","89626699"],j:["13039722"],c:["13039722","40151220"],a:["40151220"],m:["89626699"],k:["89626699"]},i={10273252:a[0],13039722:a[1]},j={10273252:a[0],13039722:a[1],40151220:a[2]},k={t:["10273252"],"@":["10273252","13039722","40151220"],j:["13039722"],c:["13039722","40151220"],a:["40151220"]},l={t:[],"@":["13039722","40151220"],j:["13039722"],c:["13039722","40151220"],a:["40151220"]},m={itemType:"user",newState:"following",new_state:"following",originalFollowState:"not-following",userId:"1",user:b.pre_follow_user};malFormedDataMissingUser={itemType:"user",newState:"following",new_state:"following",originalFollowState:"not-following",userId:"1"},malFormedDataMissingUserId={itemType:"user",newState:"following",new_state:"following",originalFollowState:"not-following",user:b.pre_follow_user},describe("Updates typeahead data structures for various events",function(){beforeEach(function(){setupComponent(),this.component.setupEventListeners("accounts"),this.component.setupEventListeners("recentSearches"),this.component.datasources={recentSearches:{addRecentSearch:function(){return!0},removeOneRecentSearch:function(){return!0},removeAllRecentSearches:function(){return!0}},accounts:{userHash:{10273252:a[0],13039722:a[1],40151220:a[2]},adjacencyList:{t:["10273252"],"@":["10273252","13039722","40151220"],j:["13039722"],c:["13039722","40151220"],a:["40151220"]},attr:{ttl_ms:100,maxLengthBlacklist:3},socialContextBlackList:{123:40,89626699:40,12:51},storage:{setItem:function(){return!0}}}}}),describe("recent searches events",function(){beforeEach(function(){var a='<form class="form-search"></form>\n        ';setupComponent($(a)),this.component.setupEventListeners("recentSearches"),this.component.datasources={recentSearches:{addRecentSearch:function(){return!0},removeOneRecentSearch:function(){return!0},removeAllRecentSearches:function(){return!0}}}}),describe("uiSearchQuery event",function(){it("calls addRecentSearch  with search source",function(){spyOn(this.component.datasources.recentSearches,"addRecentSearch"),this.component.trigger("uiSearchQuery",{source:"search"}),expect(this.component.datasources.recentSearches.addRecentSearch).toHaveBeenCalled()})}),describe("uiTypeaheadItemSelected event",function(){it("does not call addRecentSearch with incorrect source",function(){spyOn(this.component.datasources.recentSearches,"addRecentSearch"),this.component.trigger("uiTypeaheadItemSelected",{source:"otherType",isSearchInput:!0}),expect(this.component.datasources.recentSearches.addRecentSearch).not.toHaveBeenCalled()}),it("does call addRecentSearch with topic item type and search input",function(){spyOn(this.component.datasources.recentSearches,"addRecentSearch"),this.component.trigger("uiTypeaheadItemSelected",{source:"topics",isSearchInput:!0}),expect(this.component.datasources.recentSearches.addRecentSearch).toHaveBeenCalled()}),it("does call addRecentSearch with recent_search item type and search input",function(){spyOn(this.component.datasources.recentSearches,"addRecentSearch"),this.component.trigger("uiTypeaheadItemSelected",{source:"recent_search",isSearchInput:!0}),expect(this.component.datasources.recentSearches.addRecentSearch).toHaveBeenCalled()}),it("does call addRecentSearch with saved_search item type and search input",function(){spyOn(this.component.datasources.recentSearches,"addRecentSearch"),this.component.trigger("uiTypeaheadItemSelected",{source:"saved_search",isSearchInput:!0}),expect(this.component.datasources.recentSearches.addRecentSearch).toHaveBeenCalled()}),it("does not call addRecentSearch with non-search input",function(){spyOn(this.component.datasources.recentSearches,"addRecentSearch"),this.component.trigger("uiTypeaheadItemSelected",{source:"topics",isSearchInput:!1}),expect(this.component.datasources.recentSearches.addRecentSearch).not.toHaveBeenCalled()})}),describe("uiTypeaheadDeleteRecentSearch event",function(){it("removeOneRecentSearch function called",function(){spyOn(this.component.datasources.recentSearches,"removeOneRecentSearch"),spyOnEvent(this.$node,"uiTypeaheadRecentSearchDeleted"),this.component.trigger("uiTypeaheadDeleteRecentSearch",{}),expect(this.component.datasources.recentSearches.removeOneRecentSearch).toHaveBeenCalled(),expect("uiTypeaheadRecentSearchDeleted").toHaveBeenTriggeredOn(this.$node)}),it("removeAllRecentSearches function called when deleleAll flag is set",function(){spyOn(this.component.datasources.recentSearches,"removeAllRecentSearches"),spyOnEvent(this.$node,"uiTypeaheadRecentSearchDeleted"),this.component.trigger("uiTypeaheadDeleteRecentSearch",{deleteAll:!0}),expect(this.component.datasources.recentSearches.removeAllRecentSearches).toHaveBeenCalled(),expect("uiTypeaheadRecentSearchDeleted").toHaveBeenTriggeredOn(this.$node)})})}),describe("social context blacklist operations",function(){it("it should remove all users that have expired, but not other users",function(){var a=150;spyOn(Date.prototype,"getTime").andReturn(a);var b=this.component.datasources.accounts.socialContextBlackList;expect("123"in b).toBe(!0),expect("89626699"in b).toBe(!0),this.component.trigger("dataFollowStateChange",c),expect("10273252"in b).toBe(!0),expect("12"in b).toBe(!0),expect("123"in b).toBe(!1),expect("89626699"in b).toBe(!1)}),it("it should delete oldest user if list is full",function(){list=this.component.datasources.accounts.socialContextBlackList={123:51,89626699:52,12:53},this.component.trigger("dataFollowStateChange",d),expect("40151220"in list).toBe(!0),expect("123"in list).toBe(!1)})}),describe("event dataFollowStateChange",function(){describe("error state",function(){it("should return before processing if user not defined",function(){this.component.trigger("dataFollowStateChange",malFormedDataMissingUser),expect(this.component.datasources.accounts.userHash).toEqual(j),expect(this.component.datasources.accounts.adjacencyList).toEqual(k)}),it("should return before processing if userId not defined",function(){this.component.trigger("dataFollowStateChange",malFormedDataMissingUserId),expect(this.component.datasources.accounts.userHash).toEqual(j),expect(this.component.datasources.accounts.adjacencyList).toEqual(k)})}),describe("not-following state",function(){it("should remove the user from the typeahead local storage",function(){this.component.trigger("dataFollowStateChange",c),expect(this.component.datasources.accounts.adjacencyList).toEqual(l)}),it("should add user to blacklist",function(){var a=this.component.datasources.accounts.socialContextBlackList;expect("10273252"in a).toBe(!1),this.component.trigger("dataFollowStateChange",c),expect("10273252"in a).toBe(!0)})}),describe("following state",function(){it("should add the user to the typeahead local storage",function(){this.component.trigger("dataFollowStateChange",e),expect(this.component.datasources.accounts.userHash).toEqual(g),expect(this.component.datasources.accounts.adjacencyList).toEqual(h)}),it("should remove user from blacklist",function(){var a=this.component.datasources.accounts.socialContextBlackList;expect("89626699"in a).toBe(!0),this.component.trigger("dataFollowStateChange",e),expect("89626699"in a).toBe(!1)}),it("should add correct social_proof to the account",function(){this.component.trigger("dataFollowStateChange",e),expect(this.component.datasources.accounts.userHash[89626699].social_proof).toEqual(1)}),it("should give the followed user a score boost",function(){var a=m.user;this.component.trigger("dataFollowStateChange",m),expect(this.component.datasources.accounts.userHash[a.id].score_boost).toEqual(b.post_follow_user.score_boost)})})}),describe("event profileVisit",function(){it("should add the user to typeahead local storage",function(){this.component.trigger("profileVisit",f),expect(this.component.datasources.accounts.userHash).toEqual(g),expect(this.component.datasources.accounts.adjacencyList).toEqual(h)}),it("should give an uncached user a score boost",function(){var a=b.pre_visit_no_cache_user;this.component.trigger("profileVisit",a),expect(this.component.datasources.accounts.userHash[a.id].score_boost).toEqual(b.post_visit_no_cache_user.score_boost)}),it("should add correct social_proof to the account",function(){this.component.trigger("profileVisit",f),expect(this.component.datasources.accounts.userHash[89626699].social_proof).toEqual(0)}),it("should give the cached user a score boost",function(){var a=b.pre_visit_cache_user;this.component.trigger("profileVisit",a),this.component.trigger("profileVisit",a),expect(this.component.datasources.accounts.userHash[a.id].score_boost).toEqual(b.post_visit_cache_user.score_boost)})}),describe("event dataLoadedTrendLocations",function(){beforeEach(function(){this.component.setupEventListeners("trendLocations"),this.component.datasources={trendLocations:{attr:{},setTrendLocations:function(){}}}}),it("should set locations for the trend locations datasource",function(){var a=this.component.datasources.trendLocations;spyOn(a,"setTrendLocations"),$(document).trigger("dataLoadedTrendLocations",{trendLocations:{name:"new york",name:"sf"}}),expect(a.setTrendLocations).toHaveBeenCalled()})}),describe("event dataLoadedTrendLocations",function(){beforeEach(function(){this.component.setupEventListeners("contextHelpers"),this.component.datasources={contextHelpers:{updatePageContext:function(){}}}}),it("should update page context using the data when naving to different page",function(){spyOn(this.component.datasources.contextHelpers,"updatePageContext"),this.component.trigger("uiPageChanged",{init_data:{typeaheadData:{contextHelpers:{}}}}),expect(this.component.datasources.contextHelpers.updatePageContext).toHaveBeenCalled()})})})})
});
define("test/app/data/typeahead/typeahead_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/typeahead/typeahead",function(){var a=function(a,b,c){return{attr:c||{id:"accounts",remotePath:"/test/",remoteType:"remoteTypeTest",prefetchPath:"test",prefetchType:"test"},getLocalSuggestions:function(b){return a},processRemoteSuggestions:function(b){return a},requiresRemoteSuggestions:function(a){return b}}};beforeEach(function(){jasmine.Clock.useMock(),setupComponent({cache_limit:0})}),describe("event uiNeedsTypeaheadSuggestions",function(){describe("input parameters",function(){it("requires parameters",function(){expect(function(){this.component.trigger("uiNeedsTypeaheadSuggestions")}).toThrow()}),it("requires 'query'",function(){expect(function(){this.component.trigger("uiNeedsTypeaheadSuggestions",{datasources:[],id:"test"})}).toThrow()}),it("requires 'datasources'",function(){expect(function(){this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},id:"test"})}).toThrow()}),it("requires 'id'",function(){expect(function(){this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:"[]"})}).toThrow()})}),it("triggers 'dataTypeaheadSuggestionsResults' if a result is found",function(){this.component.datasources.accounts=a(["match"]),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts"],id:"1"}),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{queryData:{query:"test"},suggestions:{accounts:["match"]},id:"1"})}),it("does not trigger if results are not found",function(){this.component.datasources.accounts=a([]),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts"],id:"1"}),expect("dataTypeaheadSuggestionsResults").not.toHaveBeenTriggered()})}),describe("dedups recent search suggestions",function(){it("dedups topics",function(){var b=[{name:"A"}],c=[{topic:"a"},{topic:"B"}];this.component.datasources.recentSearches=a(b,!1),this.component.datasources.topics=a(c,!1),this.component.trigger("uiNeedsTypeaheadSuggestions",{datasources:["topics","recentSearches"],queryData:{query:"A"},id:"1"}),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{queryData:{query:"A"},suggestions:{topics:[{topic:"B",origin:"prefetched"}],recentSearches:[{name:"A",origin:"prefetched"}]},id:"1"})})}),describe("truncates topics with less than 4 recent search suggestions",function(){it("truncates topics with a mix of recent and topics suggestions",function(){var b=[{name:"e"},{name:"ex"},{name:"exa"}],c=[{topic:"exampl"},{topic:"example"}];this.component.datasources.recentSearches=a(b,!1),this.component.datasources.topics=a(c,!1),this.component.trigger("uiNeedsTypeaheadSuggestions",{datasources:["topics","recentSearches"],queryData:{query:"e"},id:"1"}),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{queryData:{query:"e"},suggestions:{topics:[{topic:"exampl",origin:"prefetched"}],recentSearches:[{name:"e",origin:"prefetched"},{name:"ex",origin:"prefetched"},{name:"exa",origin:"prefetched"}]},id:"1"})}),it("returns no topics suggestions if 4 recents suggestions present",function(){var b=[{name:"e"},{name:"ex"},{name:"exa"},{name:"exam"}],c=[{topic:"exampl"},{topic:"example"}];this.component.datasources.recentSearches=a(b,!1),this.component.datasources.topics=a(c,!1),this.component.trigger("uiNeedsTypeaheadSuggestions",{datasources:["topics","recentSearches"],queryData:{query:"e"},id:"1"}),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{queryData:{query:"e"},suggestions:{topics:[],recentSearches:[{name:"e",origin:"prefetched"},{name:"ex",origin:"prefetched"},{name:"exa",origin:"prefetched"},{name:"exam",origin:"prefetched"}]},id:"1"})})}),describe("event dataTypeaheadSuggestionsResults",function(){it("returns the original id, query, and suggestions",function(){var b=[1,2,3];this.component.datasources.accounts=a(b),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts","searches"],id:"1"}),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{id:"1",queryData:{query:"test"},suggestions:{accounts:b}})}),it("sets the origin on the results properly",function(){var b=[{id:1}];this.component.datasources.accounts=a(b),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts"],id:"1"}),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{id:"1",queryData:{query:"test"},suggestions:{accounts:[{id:1,origin:"prefetched"}]}})})}),describe("processRemoteSuggestions",function(){beforeEach(function(){this.eventsFired=0,$(document).on("dataTypeaheadSuggestionsResults",function(){this.eventsFired++}.bind(this))}),afterEach(function(){$(document).off("dataTypeaheadSuggestionsResults")}),it('does not trigger api request for "@" query',function(){this.component.datasources.accounts=a([]),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"@"},datasources:["accounts"],id:"1"}),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{queryData:{query:"@"},id:"1",suggestions:{}}),expect($.ajax).not.toHaveBeenCalled(),expect(this.eventsFired).toEqual(1)}),it("combines ds urls and uses the remotePath and Type when making queries",function(){var b=[1,2,3];ajaxRespondWithSuccess(),this.component.datasources.accounts=a(b,!0),this.component.datasources.test=a(b,!0,{id:"test",remotePath:"/test/",remoteType:"remoteTypeTest2",prefetchPath:"test",prefetchType:"test"}),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts","test"],id:"1"}),jasmine.Clock.tick(this.component.attr.remoteThrottleInterval+1),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{id:"1",queryData:{query:"test"},suggestions:{accounts:b,test:b}}),expect($.ajax).toHaveBeenCalled(),expect(this.eventsFired).toEqual(1),expect($.ajax.mostRecentOptions.url).toBe("/test/"),expect($.ajax.mostRecentOptions.data.result_type).toBe("remoteTypeTest,remoteTypeTest2"),expect($.ajax.mostRecentOptions.headers["X-Phx"]).toBe(!0)}),it("includes context if tweetContextEnabled is true",function(){var b="This is a test tweet",c=[1,2,3];ajaxRespondWithSuccess(),this.component.attr.tweetContextEnabled=!0,this.component.datasources.accounts=a(c,!0),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test",tweetContext:b},datasources:["accounts"],id:"1"}),jasmine.Clock.tick(this.component.attr.remoteThrottleInterval+1),expect($.ajax).toHaveBeenCalled(),expect(this.eventsFired).toEqual(1),expect($.ajax.mostRecentOptions.data.tweet_context).toBe(b)}),it("does not include context if tweetContextEnabled is false (default)",function(){var b="This is a test tweet",c=[1,2,3];ajaxRespondWithSuccess(),this.component.datasources.accounts=a(c,!0),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test",tweetContext:b},datasources:["accounts"],id:"1"}),jasmine.Clock.tick(this.component.attr.remoteThrottleInterval+1),expect($.ajax).toHaveBeenCalled(),expect(this.eventsFired).toEqual(1),expect($.ajax.mostRecentOptions.data.tweet_context).toBe(undefined)}),it("does trigger api request for datasources with remote request",function(){var b=[1,2,3];ajaxRespondWithSuccess({accounts:b}),this.component.datasources.accounts=a(b,!0),this.component.datasources.noRemote=a(b,!1,{id:"noRemote"}),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts","noRemote"],id:"1"}),jasmine.Clock.tick(this.component.attr.remoteThrottleInterval+1),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{id:"1",queryData:{query:"test"},suggestions:{accounts:b,noRemote:b}}),expect($.ajax).toHaveBeenCalled(),expect(this.eventsFired).toEqual(2),expect($.ajax.mostRecentOptions.headers["X-Phx"]).toBe(!0)}),it("does set the appropriate throttle interval",function(){this.component.datasources.accounts=a([],!0),this.component.attr.useThrottle=!0,this.component.attr.remoteThrottleInterval=1e3,jasmine.Clock.useMock(),spyOn(this.component,"executeRemoteRequest"),this.component.getRemoteSuggestions("1",{query:"test"},{},["accounts"]),expect(this.component.executeRemoteRequest.calls.length).toEqual(1),jasmine.Clock.tick(100),this.component.getRemoteSuggestions("1",{query:"test"},{},["accounts"]),jasmine.Clock.tick(300),expect(this.component.executeRemoteRequest.calls.length).toEqual(1),jasmine.Clock.tick(601),expect(this.component.executeRemoteRequest.calls.length).toEqual(2),jasmine.Clock.tick(1e3),this.component.getRemoteSuggestions("1",{query:"test"},{},["accounts"]),expect(this.component.executeRemoteRequest.calls.length).toEqual(3)}),it("does set the appropriate debounce interval",function(){this.component.datasources.accounts=a([],!0),this.component.attr.useThrottle=!1,this.component.attr.remoteDebounceInterval=1e3,jasmine.Clock.useMock(),spyOn(this.component,"executeRemoteRequest"),this.component.getRemoteSuggestions("1",{query:"test"},{},["accounts"]),expect(this.component.executeRemoteRequest.calls.length).toEqual(0),jasmine.Clock.tick(100),expect(this.component.executeRemoteRequest.calls.length).toEqual(0),jasmine.Clock.tick(901),expect(this.component.executeRemoteRequest.calls.length).toEqual(1)}),it("does not trigger api request when request limit exceeded",function(){var b=[1,2,3];this.component.attr.outstandingRemoteRequestCount=6,this.component.attr.useThrottle=!0,this.component.datasources.accounts=a(b,!0),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts"],id:"1"}),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{id:"1",queryData:{query:"test"},suggestions:{accounts:b}}),expect($.ajax).not.toHaveBeenCalled(),expect(this.eventsFired).toEqual(1),expect(this.component.attr.outstandingRemoteRequestCount).toEqual(6)}),it("does trigger api request when request limit not exceeded",function(){var b=[1,2,3];this.component.attr.outstandingRemoteRequestCount=0,ajaxRespondWithSuccess({accounts:b}),this.component.datasources.accounts=a(b,!0),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts"],id:"1"}),jasmine.Clock.tick(this.component.attr.remoteThrottleInterval+1),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{id:"1",queryData:{query:"test"},suggestions:{accounts:b}}),expect($.ajax).toHaveBeenCalled(),expect(this.eventsFired).toEqual(2),expect($.ajax.mostRecentOptions.headers["X-Phx"]).toBe(!0),expect(this.component.attr.outstandingRemoteRequestCount).toEqual(0)}),it("does not trigger api request for datasources with no remote request",function(){var b=[1,2,3];this.component.datasources.accounts=a(b,!1),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts"],id:"1"}),expect("dataTypeaheadSuggestionsResults").toHaveBeenTriggeredOnAndWith(document,{id:"1",queryData:{query:"test"},suggestions:{accounts:b}}),expect($.ajax).not.toHaveBeenCalled(),expect(this.eventsFired).toEqual(1)}),it("does save last remote request in queue if remote request limit reached",function(){var b=[1,2,3];this.component.attr.outstandingRemoteRequestMax=0,this.component.datasources.accounts=a(b,!0),this.component.datasources.accounts=a(b,!0),this.component.datasources.noRemote=a(b,!1),ajaxRespondWithSuccess({accounts:b}),spyOnEvent(document,"dataTypeaheadSuggestionsResults"),this.component.trigger("uiNeedsTypeaheadSuggestions",{queryData:{query:"test"},datasources:["accounts","noRemote"],id:"1"}),jasmine.Clock.tick(this.component.attr.remoteThrottleInterval+1),expect(this.component.attr.queuedRequestData.queryData.query).toEqual("test")})})})
});
define("test/app/data/typeahead/context_helper_datasource_spec",["module","require","exports"],function(module, require, exports) {
describeModule("app/data/typeahead/context_helper_datasource",function(){describe("getting local suggestions",function(){beforeEach(function(){this.datasource=new this.Module({id:"contextHelpers"})}),it("returns item on home timelines",function(){this.datasource.currentPage="home";var a=this.datasource.getLocalSuggestions({query:"query"});expect(a).toEqual([{text:"Search for {{strong_query}} from people you follow",query:"query",rewrittenQuery:"query",mode:"timeline"}])}),it("returns item on profiles",function(){this.datasource.currentPage="profile",this.datasource.currentProfileUser="screenName";var a=this.datasource.getLocalSuggestions({query:"query"});expect(a).toEqual([{text:"Search for {{strong_query}} in screenName's timeline",query:"query",rewrittenQuery:"query from:screenName"}])}),it("returns item on your own profile (me)",function(){this.datasource.currentPage="me",this.datasource.currentProfileUser="screenName";var a=this.datasource.getLocalSuggestions({query:"query"});expect(a).toEqual([{text:"Search for {{strong_query}} in your timeline",query:"query",rewrittenQuery:"query from:screenName"}])}),it("returns nothing on other pages",function(){this.datasource.currentPage="search";var a=this.datasource.getLocalSuggestions({query:"query"});expect(a.length).toBe(0)})}),describe("updating context on page change",function(){beforeEach(function(){this.datasource=new this.Module({id:"contextHelpers"})}),it("loads data from init_data",function(){var a={page_name:"testPage",section_name:"testSection",screen_name:"testUser"};this.datasource.updatePageContext(a),expect(this.datasource.currentPage).toBe("testPage"),expect(this.datasource.currentSection).toBe("testSection"),expect(this.datasource.currentProfileUser).toBe(null)}),it("loads screenName from init_data if on a profile page",function(){var a={page_name:"profile",section_name:"testSection",screen_name:"testUser"};this.datasource.updatePageContext(a),expect(this.datasource.currentPage).toBe("profile"),expect(this.datasource.currentSection).toBe("testSection"),expect(this.datasource.currentProfileUser).toBe("testUser")})})})
});
define("test/app/data/sms/sms_download_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/sms/sms_download_scribe",function(){beforeEach(function(){setupComponent()}),it("scribes when the user dismiss the prompt",function(){this.component.trigger("uiDismissMobileDownloadPrompt"),expect(this.component).toScribe({component:"sms_download",action:"dismiss"})}),it("scribes when the prompt is loaded",function(){this.component.trigger("uiMobileDownloadPromptLoaded"),expect(this.component).toScribe({component:"sms_download",action:"impression"})}),it("scribes when user submit device verification request",function(){var a={deviceId:1,pin:1234};this.component.trigger("uiDidSubmitDeviceVerification",a),expect(this.component).toScribe({component:"sms_download",element:"device_verification",action:"submit"})}),it("scribes when user submit a download request",function(){var a={countryCode:"+1",deviceNumber:"1234567890"};this.component.trigger("uiDidSubmitDownloadLinkRequest",a),expect(this.component).toScribe({component:"sms_download",element:"download_link",action:"submit"})}),it("scribes when user submit a resend request",function(){var a={deviceId:1};this.component.trigger("uiDidResendDownloadLinkRequest",a),expect(this.component).toScribe({component:"sms_download",element:"download_link_resend",action:"submit"})}),it("scribes when the user fails to verify the device",function(){this.component.trigger("dataFailedToVerifyDevice"),expect(this.component).toScribe({component:"sms_download",element:"device_verification",action:"failure"})}),it("scribes when user fails to submit download link",function(){this.component.trigger("dataFailedToSubmitDownloadLinkRequest"),expect(this.component).toScribe({component:"sms_download",element:"download_link",action:"failure"})}),it("scribes when user fails on download resend request",function(){this.component.trigger("dataFailedToResendDownloadLinkRequest"),expect(this.component).toScribe({component:"sms_download",element:"download_link_resend",action:"failure"})})})
});
define("test/app/data/sms/device_verification_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/sms/device_verification",function(){beforeEach(function(){spyOnEvent(document,"dataDidVerifyDevice"),spyOnEvent(document,"dataFailedToVerifyDevice"),spyOnEvent(document,"dataDidSubmitDownloadLinkRequest"),spyOnEvent(document,"dataFailedToSubmitDownloadLinkRequest"),spyOnEvent(document,"dataDidResendDownloadLinkRequest"),spyOnEvent(document,"dataFailedToResendDownloadLinkRequest"),setupComponent()}),describe("download",function(){function a(){$(document).trigger("uiDidSubmitDownloadLinkRequest",{countryCode:"1",deviceNumber:"123"})}describe("on uiDidSubmitDownloadLinkRequest",function(){it("posts to the /i/devices/download endpoint",function(){a();var b=$.ajax.mostRecentOptions;expect(b.url).toBe("/i/devices/download"),expect(b.data.country_code).toBe("1"),expect(b.data.phone_number).toBe("123")})}),describe("when /i/devices/download succeeds",function(){it("triggers dataDidSubmitDownloadLinkRequest",function(){ajaxRespondWithSuccess({}),a(),expect("dataDidSubmitDownloadLinkRequest").toHaveBeenTriggeredOn(document)})}),describe("when /i/devices/download fails",function(){it("triggers dataFailedToSubmitDownloadLinkRequest",function(){ajaxRespondWithError({}),a(),expect("dataFailedToSubmitDownloadLinkRequest").toHaveBeenTriggeredOn(document)})})}),describe("resend",function(){function a(){$(document).trigger("uiDidResendDownloadLinkRequest",{deviceId:"1"})}describe("on uiDidResendDownloadLinkRequest",function(){it("posts to the /i/devices/download endpoint with a resend param",function(){a();var b=$.ajax.mostRecentOptions;expect(b.url).toBe("/i/devices/download"),expect(b.data.resend).toBe(!0),expect(b.data.device_id).toBe("1")})}),describe("when /i/devices/download succeeds",function(){it("triggers uiShowMessage with a success message",function(){ajaxRespondWithSuccess({}),a(),expect("dataDidResendDownloadLinkRequest").toHaveBeenTriggeredOn(document)})}),describe("when /i/devices/download fails",function(){it("triggers uiShowMessage with an error message",function(){ajaxRespondWithError({}),a(),expect("dataFailedToResendDownloadLinkRequest").toHaveBeenTriggeredOn(document)})})}),describe("verify",function(){function a(){$(document).trigger("uiDidSubmitDeviceVerification",{deviceId:1,pin:"1234"})}describe("on uiDidSubmitDeviceVerification",function(){it("posts to the /i/devices/verify endpoint",function(){a();var b=$.ajax.mostRecentOptions;expect(b.url).toEqual("/i/devices/verify"),expect(b.data.device_id).toBe(1),expect(b.data.pin).toBe("1234")})}),describe("on /i/devices/verify success",function(){it("triggers dataDidVerifyDevice",function(){ajaxRespondWithSuccess({success:!0}),a(),expect("dataDidVerifyDevice").toHaveBeenTriggeredOn(document),expect("dataFailedToVerifyDevice").not.toHaveBeenTriggeredOn(document)})}),describe("on /i/devices/verify failure",function(){it("triggers dataFailedToVerifyDevice",function(){ajaxRespondWithError({}),a(),expect("dataFailedToVerifyDevice").toHaveBeenTriggeredOn(document),expect("dataDidVerifyDevice").not.toHaveBeenTriggeredOn(document)})})})})
});
define("test/app/data/mobile_gallery/send_download_link_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/mobile_gallery/send_download_link",function(){beforeEach(function(){setupComponent()}),describe("event uiSendDownloadLink",function(){it("calls the API",function(){this.component.trigger("uiSendDownloadLink",{email:"foo@gmail.com",appId:"ipad"}),expect($.ajax.mostRecentOptions.url).toEqual("/download/send_link")}),it("triggers dataSendDownloadLinkSuccess on success",function(){ajaxRespondWithSuccess({status:"ok"}),spyOnEvent(document,"dataSendDownloadLinkSuccess"),this.component.trigger("uiSendDownloadLink",{email:"foo@gmail.com",appId:"ipad"}),expect("dataSendDownloadLinkSuccess").toHaveBeenTriggeredOnAndWith(document,{status:"ok"})}),it("triggers dataSendDownloadLinkError on error",function(){var a={errors:[{message:"Over limit",code:33}]};ajaxRespondWithError(a),spyOnEvent(document,"dataSendDownloadLinkError"),this.component.trigger("uiSendDownloadLink",{email:"foo@gmail.com",appId:"ipad"}),expect("dataSendDownloadLinkError").toHaveBeenTriggeredOn(document)}),it("passes parameters email and app_id",function(){this.component.trigger("uiSendDownloadLink",{email:"foo@gmail.com",appId:"ipad"}),expect($.ajax).toHaveBeenCalled(),expect($.ajax.mostRecentCall.args[0].data.email).toEqual("foo@gmail.com"),expect($.ajax.mostRecentCall.args[0].data.app_id).toEqual("ipad")})})})
});
define("test/app/data/mobile_gallery/download_links_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/mobile_gallery/download_links_scribe",function(){beforeEach(function(){var a='<div>\n     <a class="store-button app-store"></a>\n     <a class="store-button google-play"></a>\n     <a class="all-devices"></a>\n     </div>\n     ';setupComponent(a)}),it("scribes app store link",function(){this.$node.find(".app-store").click(),expect(this.component).toScribe({component:"download_links",element:"app_store_button",action:"click"})}),it("scribes google play link",function(){this.$node.find(".google-play").click(),expect(this.component).toScribe({component:"download_links",element:"google_play_button",action:"click"})}),it("scribes all devices link",function(){this.$node.find(".all-devices").click(),expect(this.component).toScribe({component:"download_links",element:"all_devices_link",action:"click"})})})
});
define("test/app/data/welcome/second_session_follow_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/second_session_follow",function(){beforeEach(function(){setupComponent()}),describe("event uiFollowAllFriends",function(){it("calls the endpoint and fires dataFollowAllSuccess on success",function(){ajaxRespondWithSuccess({}),spyOnEvent(document,"dataFollowAllSuccess"),this.component.trigger("uiFollowAllFriends",{ids:[1,2,3]}),expect($.ajax).toHaveBeenCalled(),expect("dataFollowAllSuccess").toHaveBeenTriggeredOn(document)}),it("calls the endpoint and fires dataFollowAllFailure on failure",function(){ajaxRespondWithError({}),spyOnEvent(document,"dataFollowAllFailure"),this.component.trigger("uiFollowAllFriends",{ids:[1,2,3]}),expect($.ajax).toHaveBeenCalled(),expect("dataFollowAllFailure").toHaveBeenTriggeredOn(document)}),it("does nothing if ids are empty",function(){spyOnEvent(document,"dataFollowAllSuccess"),this.component.trigger("uiFollowAllFriends",{ids:[]}),expect($.ajax).not.toHaveBeenCalled(),expect("dataFollowAllFailure").not.toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/welcome/users_cards_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/users_cards",function(){beforeEach(function(){setupComponent({sectionName:"category",sectionCategoryName:"music"}),this.$requestNode=$("<div></div>"),attachFixtureToDom(this.$requestNode)}),describe("event uiWantsWelcomeMoreResults",function(){it("fires success back at the triggering object",function(){spyOnEvent(this.$requestNode,"dataWelcomeMoreResultsSuccess"),ajaxRespondWithSuccess({html:"<div></div>",title:"Even moar results"}),this.$requestNode.trigger("uiWantsWelcomeMoreResults",{type:"wtf",cursor:"4"}),expect($.ajax.mostRecentOptions.url).toEqual("/welcome/more_results"),expect($.ajax.mostRecentOptions.data).toEqual({type:"wtf",cursor:"4",section_context:"category",section_category_context:"music"}),expect("dataWelcomeMoreResultsSuccess").toHaveBeenTriggeredOnAndWith(this.$requestNode,{html:"<div></div>",title:"Even moar results"})}),it("schedules a retry if the server asked nicely",function(){jasmine.Clock.useMock(),spyOnEvent(this.$requestNode,"dataWelcomeMoreResultsSuccess"),ajaxRespondWithSuccess({retry_in:3}),this.$requestNode.trigger("uiWantsWelcomeMoreResults",{type:"contacts",cursor:"4"}),expect("dataWelcomeMoreResultsSuccess").not.toHaveBeenTriggeredOn(this.$requestNode),ajaxRespondWithSuccess({html:"<div></div>",title:"Even moar results"}),jasmine.Clock.tick(3e3),expect("dataWelcomeMoreResultsSuccess").toHaveBeenTriggeredOnAndWith(this.$requestNode,{html:"<div></div>",title:"Even moar results"})})}),describe("event uiWantsWelcomeSearchResultsCard",function(){it("fires success back at the triggering object",function(){spyOnEvent(this.$requestNode,"dataWelcomeSearchResultsCardSuccess"),ajaxRespondWithSuccess({html:"<div></div>"}),this.$requestNode.trigger("uiWantsWelcomeSearchResultsCard",{query:"kittens"}),expect($.ajax.mostRecentOptions.url).toEqual("/welcome/results_card"),expect($.ajax.mostRecentOptions.data).toEqual({type:"search",query:"kittens",section_context:"category",section_category_context:"music"}),expect("dataWelcomeSearchResultsCardSuccess").toHaveBeenTriggeredOnAndWith(this.$requestNode,{html:"<div></div>"})})})})
});
define("test/app/data/welcome/interests_picker_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/interests_picker_scribe",function(){beforeEach(function(){setupComponent()}),it("scribes an interest click event",function(){this.component.trigger("uiShowWelcomeInterest",{interest:"music",pos:3}),expect(this.component).toScribe({component:"suggestion_category",action:"click"},{items:[{name:"music",position:3}]})}),it("scribes a custom interest search",function(){this.component.trigger("uiWelcomeCustomInterestSubmitted",{interest:"custom-1",query:"designer",pos:3}),expect(this.component).toScribe({component:"custom_interest_form",action:"search"},{query:"designer",items:[{name:"custom-1",item_query:"designer",position:3}]})})})
});
define("test/app/data/welcome/welcome_alerts_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/welcome_alerts",function(){beforeEach(function(){setupComponent()}),describe("createPhone",function(){it("triggers dataCreatePhoneSuccess on success",function(){var a={success:1};ajaxRespondWithSuccess(a),spyOnEvent(document,"dataCreatePhoneSuccess"),this.component.createPhone({},{device_id:1}),expect("dataCreatePhoneSuccess").toHaveBeenTriggeredOnAndWith(document,a)}),it("triggers dataCreatePhoneError on error",function(){ajaxRespondWithError({},{},{}),spyOnEvent(document,"dataCreatePhoneError"),this.component.createPhone({},{device_id:1}),expect("dataCreatePhoneError").toHaveBeenTriggeredOn(document)})}),describe("cancelPhoneVerification",function(){it("triggers dataCancelPhoneVerificationSuccess on success",function(){var a={success:1};ajaxRespondWithSuccess(a),spyOnEvent(document,"dataCancelPhoneVerificationSuccess"),this.component.cancelPhoneVerification({},{device_id:1}),expect("dataCancelPhoneVerificationSuccess").toHaveBeenTriggeredOnAndWith(document,a)}),it("triggers dataCancelPhoneVerificationError on error",function(){ajaxRespondWithError({},{},{}),spyOnEvent(document,"dataCancelPhoneVerificationError"),this.component.cancelPhoneVerification({},{device_id:1}),expect("dataCancelPhoneVerificationError").toHaveBeenTriggeredOn(document)})}),describe("verifyPhone",function(){it("triggers dataVerifyPhoneSuccess on success",function(){var a={success:1};ajaxRespondWithSuccess(a),spyOnEvent(document,"dataVerifyPhoneSuccess"),this.component.verifyPhone({},{device_id:1}),expect("dataVerifyPhoneSuccess").toHaveBeenTriggeredOnAndWith(document,a)})}),describe("enableTwitterAlertsSms",function(){it("triggers dataEnableTwitterAlertsSmsSuccess on success",function(){var a={success:1};ajaxRespondWithSuccess(a),spyOnEvent(document,"dataEnableTwitterAlertsSmsSuccess"),this.component.enableTwitterAlertsSms({},{device_id:1}),expect("dataEnableTwitterAlertsSmsSuccess").toHaveBeenTriggeredOnAndWith(document,a)}),it("triggers dataEnableTwitterAlertsSmsError on error",function(){ajaxRespondWithError({},{},{}),spyOnEvent(document,"dataEnableTwitterAlertsSmsError"),this.component.enableTwitterAlertsSms({},{device_id:1}),expect("dataEnableTwitterAlertsSmsError").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/welcome/welcome_alerts_phone_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/welcome_alerts_phone_scribe",function(){beforeEach(function(){setupComponent({sectionName:"alerts",sectionCategoryName:"phone_create"})}),it("scribes a skip activation click event",function(){this.component.trigger("uiSkipActivationClick",{}),expect(this.component).toScribe({component:"phone_create",element:"form",action:"skip_activation_click"})}),it("scribes a create phone click event",function(){this.component.trigger("uiCreatePhoneClick",{}),expect(this.component).toScribe({component:"phone_create",element:"form",action:"create_phone_click"})}),it("scribes a cancel phone verification click event",function(){this.component.trigger("uiWantsCancelPhoneVerification",{}),expect(this.component).toScribe({component:"phone_verify",element:"form",action:"cancel_verification_click"})}),it("scribes a phone verification success event",function(){this.component.trigger("uiPhoneVerificationSuccess",{}),expect(this.component).toScribe({component:"phone_verify",element:"form",action:"verification_success"})}),it("scribes a change phone click event",function(){this.component.trigger("uiChangePhoneClick",{}),expect(this.component).toScribe({component:"phone_verified",element:"form",action:"change_phone_click"})}),it("scribes an enbale twitter alerts sms click",function(){this.component.trigger("uiWantsEnableTwitterAlertsSms",{}),expect(this.component).toScribe({component:"phone_verified",element:"form",action:"enable_twitter_alerts_sms_click"})}),it("scribes an enable twitter alerts sms success event",function(){this.component.trigger("dataEnableTwitterAlertsSmsSuccess",{}),expect(this.component).toScribe({component:"phone_verified",element:"form",action:"enable_twitter_alerts_sms_success"})}),it("scribes an enable twitter alerts sms error event",function(){this.component.trigger("dataEnableTwitterAlertsSmsError",{}),expect(this.component).toScribe({component:"phone_verified",element:"form",action:"enable_twitter_alerts_sms_error"})})})
});
define("test/app/data/welcome/intro_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/intro_scribe",function(){beforeEach(function(){setupComponent({sectionName:"interests"})}),it("scribes a video click",function(){this.component.trigger("uiWelcomeVideoClicked"),expect(this.component).toScribe({component:"video",action:"click"})})})
});
define("test/app/data/welcome/welcome_data_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/welcome_data",function(){var a="test";beforeEach(function(){setupComponent()}),describe("dataSulCategorySuccess",function(){it("triggers dataSulCategorySuccess on success",function(){var b={items_html:"<p>It worked!</p>",slug:a};ajaxRespondWithSuccess(b),spyOnEvent(document,"dataSulCategorySuccess"),this.component.getSulCategoryData({},{slug:a}),expect("dataSulCategorySuccess").toHaveBeenTriggeredOnAndWith(document,b)}),it("triggers uiShowMessage on success if message is present",function(){var b={items_html:"<p>It worked!</p>",slug:a,message:"Hello!"};ajaxRespondWithSuccess(b),spyOnEvent(document,"uiShowMessage"),this.component.getSulCategoryData({},{slug:a}),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(document,{message:b.message})}),it("triggers dataSulCategoryError on success if there is no items_html",function(){var b={slug:a};ajaxRespondWithSuccess(b),spyOnEvent(document,"dataSulCategoryError"),this.component.getSulCategoryData({},{slug:a}),expect("dataSulCategoryError").toHaveBeenTriggeredOnAndWith(document,{slug:a})}),it("triggers dataSulCategoryError on error",function(){ajaxRespondWithError({},{},{}),spyOnEvent(document,"dataSulCategoryError"),this.component.getSulCategoryData({},{slug:a}),expect("dataSulCategoryError").toHaveBeenTriggeredOn(document)})})})
});
define("test/app/data/welcome/preview_stream_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/preview_stream_scribe",function(){beforeEach(function(){setupComponent({sectionName:"category",sectionCategoryName:"music"})}),it("scribes an open event",function(){this.component.trigger("dataWelcomeStreamPreviewSuccess"),expect(this.component).toScribe({component:"preview_stream_dialog",action:"open"},{context:"music"})})})
});
define("test/app/data/welcome/flow_nav_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/flow_nav_scribe",function(){describe("interests page",function(){beforeEach(function(){setupComponent({sectionName:"interests"})}),it("scribes completion and progress on next click",function(){this.component.trigger("uiWelcomeNavNextClicked"),expect(this.component).toScribe({action:"complete"}),expect(this.component).toScribe({component:"progress",action:"done"})}),it("scribes completion and skipping on skip click",function(){this.component.trigger("uiWelcomeNavSkipClicked"),expect(this.component).toScribe({action:"complete"}),expect(this.component).toScribe({component:"progress",action:"skip"})}),it("does not scribe completion on back",function(){this.component.trigger("uiWelcomeNavPrevClicked"),expect(this.component).not.toScribe({action:"complete"})})}),describe("category page",function(){beforeEach(function(){setupComponent({sectionName:"category",progressSectionName:"interests",sectionCategoryName:"sports"})}),it("scribes completion on back",function(){this.component.trigger("uiWelcomeNavPrevClicked"),expect(this.component).toScribe({section:"interests",action:"complete"},{context:"sports"})})}),describe("import page next",function(){beforeEach(function(){setupComponent({sectionName:"import"}),this.component.trigger("uiWelcomeNavNextClicked",{finished:!0})}),it("scribes completion on next",function(){expect(this.component).toScribe({action:"complete"})}),it('scribes a "finished" impression as well',function(){expect(this.component).toScribe({section:"finished",action:"impression"})})})})
});
define("test/app/data/welcome/welcome_cards_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/welcome_cards_scribe",function(){beforeEach(function(){setupComponent({sectionName:"category",sectionCategoryName:"music"})}),it("scribes a search event for cards",function(){this.component.trigger("uiWelcomeUserSearch",{query:"marian call"}),expect(this.component).toScribe({component:"user_search_form",action:"search"},{context:"music",query:"marian call"})}),it("scribes a more results event",function(){this.component.trigger("uiWantsWelcomeMoreResults",{componentName:"similarities_user_stream",scribeData:{profile_id:"101"}}),expect(this.component).toScribe({component:"similarities_user_stream",element:"load_more",action:"click"},{context:"music",profile_id:"101"})}),it("does not scribe more results if it is automatic",function(){this.component.trigger("uiWantsWelcomeMoreResults",{automatic:!0,componentName:"similarities_user_stream",scribeData:{profile_id:"101"}}),expect(this.component).not.toScribe({component:"similarities_user_stream",element:"load_more",action:"click"})}),it("scribes a dismiss event",function(){this.component.trigger("uiWelcomeCardRemoved",{componentName:"similarities_user_stream",scribeData:{profile_id:"101"}}),expect(this.component).toScribe({component:"similarities_user_stream",action:"dismiss"},{context:"music",profile_id:"101"})}),it("scribes a search focus event",function(){setupComponent({sectionName:"category",sectionCategoryName:"sports"}),this.component.trigger("uiWelcomeFocusedSearch",{placeholder:"Your favorite band",component:"search_suggestion"}),expect(this.component).toScribe({component:"search_suggestion",action:"click"},{context:"sports",query:"Your favorite band"})})})
});
define("test/app/data/welcome/welcome_alerts_download_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/welcome_alerts_download_scribe",function(){beforeEach(function(){setupComponent({sectionName:"alerts",sectionCategoryName:"download"})}),it("scribes a download click event",function(){this.component.trigger("uiDownloadClick",{}),expect(this.component).toScribe({component:"download",element:"form",action:"download_click"})}),it("scribes a skip download click event",function(){this.component.trigger("uiSkipDownloadClick",{}),expect(this.component).toScribe({component:"download",element:"form",action:"skip_download_click"})})})
});
define("test/app/data/welcome/invitations_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/invitations_scribe",function(){beforeEach(function(){setupComponent()}),describe("invitations ui",function(){it("scribes a link click",function(){this.$node.trigger("uiWelcomeInviteLinkClicked"),expect(this.component).toScribe({component:"invite_contacts_link",action:"click"})}),it("scribes the dialog opening",function(){this.$node.trigger("uiWelcomeShowInviting"),expect(this.component).toScribe({component:"invite_contacts_dialog",action:"open"})})})})
});
define("test/app/data/welcome/lifeline_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/welcome/lifeline_scribe",function(){beforeEach(function(){setupComponent()}),it("device_follow_dialog impression should be scribed",function(){this.component.scribeOpen(),expect(this.component).toScribe({action:"impression"})})})
});
define("test/app/data/who_to_follow/web_personalized_scribe_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/who_to_follow/web_personalized_scribe",function(){it("should scribe an EU impression when inEU is true",function(){setupComponent({inEU:!0}),this.component.trigger("uiWebPersonalizationImpression"),expect(this.component).toScribe({element:"eu",action:"impression"})}),it("should not scribe an EU impression when inEU is false",function(){setupComponent({inEU:!1}),this.component.trigger("uiWebPersonalizationImpression"),expect(this.component).not.toScribe({element:"eu",action:"impression"})}),it("should scribe an Do Not Track impression when doNotTrack is true",function(){setupComponent({doNotTrack:!0}),this.component.trigger("uiWebPersonalizationImpression"),expect(this.component).toScribe({element:"dnt",action:"impression"})}),it("should not scribe an Do Not Track impression when doNotTrack is false",function(){setupComponent({doNotTrack:!1}),this.component.trigger("uiWebPersonalizationImpression"),expect(this.component).not.toScribe({element:"dnt",action:"impression"})}),it("should scribe a settings click upon uiAllowWebPersonalization, uiDisallowWebPersonalization or uiTurnoffWebPersonalization",function(){setupComponent(),["uiAllowWebPersonalization","uiDisallowWebPersonalization","uiTurnoffWebPersonalization"].forEach(function(a){this.component.trigger(a,{element:"some-element"}),expect(this.component).toScribe({component:"settings",element:"some-element",action:"click"})}.bind(this))}),it("should scribe signup form submissions",function(){setupComponent(),this.component.trigger("uiScribeSignupForm"),expect(this.component).toScribe({section:"signup_callout",component:"form",action:"signup_click"})})})
});
define("test/app/data/who_to_follow/web_personalized_proxy_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/who_to_follow/web_personalized_proxy",function(){describe("updatePersonalizationSettings",function(){it("should invoke success callback when logged out and use cookie personalization is true",function(){var a=!0;setupComponent({loggedIn:!1}),this.success=function(){},this.error=function(){},spyOn(this,"success"),this.component.updatePersonalizationSettings(a,this.success,this.error),expect(this.success).toHaveBeenCalled()}),it("should update personalization settings when logged in",function(){var a=!0;setupComponent({loggedIn:!0}),this.success=function(){},this.error=function(){},this.component.updatePersonalizationSettings(a,this.success,this.error),expect($.ajax.mostRecentOptions.url).toEqual("/account/update_personalization_settings.json"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.eventData).toBeNull(),expect($.ajax.mostRecentOptions.data).toEqual({use_cookie_personalization:a,cookie_personalization_prompt_displayed:!0,authenticity_token:"AUTHORIZED",post_authenticity_token:"AUTHORIZED"})}),it("should turn off cookie personalization when logged out and use cookie personalization is false",function(){var a=!1;setupComponent({loggedIn:!1}),this.success=function(){},this.error=function(){},this.component.updatePersonalizationSettings(a,this.success,this.error),expect($.ajax.mostRecentOptions.url).toEqual("/account/turn_off_cookie_personalization.json"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.eventData).toBeNull(),expect($.ajax.mostRecentOptions.data).toEqual({authenticity_token:"AUTHORIZED",post_authenticity_token:"AUTHORIZED"})})}),describe("getRecommendedUsers",function(){it("should POST to '/i/users/suggested_web_personalized_users'",function(){setupComponent(),this.component.getRecommendedUsers(),expect($.ajax.mostRecentOptions.url).toEqual("/i/users/suggested_web_personalized_users"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.dataType).toEqual("json"),expect($.ajax.mostRecentOptions.eventData).toBeNull(),expect($.ajax.mostRecentOptions.data).toEqual({limit:6,authenticity_token:"AUTHORIZED",post_authenticity_token:"AUTHORIZED"})}),it("should trigger dataUserRecommendationsInitialResults upon success",function(){spyOnEvent(document,"dataUserRecommendationsInitialResults"),setupComponent(),ajaxRespondWithSuccess({count:6,html:"<ul><li>Recommendation 1</li></ul>"}),this.component.getRecommendedUsers(),expect("dataUserRecommendationsInitialResults").toHaveBeenTriggeredOnAndWith(this.component,{count:6,html:"<ul><li>Recommendation 1</li></ul>"})}),it("should trigger dataUserRecommendationsError upon error",function(){spyOnEvent(document,"dataUserRecommendationsError"),setupComponent(),ajaxRespondWithError({}),this.component.getRecommendedUsers(),expect("dataUserRecommendationsError").toHaveBeenTriggeredOn(this.component)}),it("should trigger uiShowError upon error",function(){spyOnEvent(document,"uiShowError"),setupComponent(),ajaxRespondWithError({}),this.component.getRecommendedUsers(),expect("uiShowError").toHaveBeenTriggeredOnAndWith(this.component,{message:"We can&#8217;t show you tailored suggestions at this time. Please try again later."})})}),describe("allowWebPersonalization",function(){it("should trigger dataGetRecommendedUsers upon success",function(){spyOnEvent(document,"dataGetRecommendedUsers"),setupComponent(),ajaxRespondWithSuccess({}),this.component.allowWebPersonalization(),expect("dataGetRecommendedUsers").toHaveBeenTriggeredOn(this.component)}),it("should trigger uiShowError upon error",function(){spyOnEvent(document,"uiShowError"),setupComponent({loggedIn:!0}),ajaxRespondWithError({}),this.component.allowWebPersonalization(),expect("uiShowError").toHaveBeenTriggeredOnAndWith(this.component,{message:"We&#8217;re not able to set your preference at this time. Please try again later."})})}),describe("disallowWebPersonalization",function(){it("should trigger uiShowMessage upon success",function(){spyOnEvent(document,"uiShowMessage"),setupComponent({loggedIn:!0}),ajaxRespondWithSuccess({}),this.component.disallowWebPersonalization(),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(this.component,{message:"Thanks. We&#8217;ve set your preference. This will go into effect on other browsers once you log into Twitter on that browser."}),spyOnEvent(document,"uiShowMessage"),setupComponent({loggedIn:!1}),ajaxRespondWithSuccess({}),this.component.disallowWebPersonalization(),expect("uiShowMessage").toHaveBeenTriggeredOnAndWith(this.component,{message:"Thanks. We&#8217;ve set your preference."})}),it("should trigger uiGoToHomePage upon success",function(){spyOnEvent(document,"uiGoToHomePage"),setupComponent(),ajaxRespondWithSuccess({}),this.component.disallowWebPersonalization(),expect("uiGoToHomePage").toHaveBeenTriggeredOn(this.component)}),it("should trigger uiShowError upon error",function(){spyOnEvent(document,"uiShowError"),setupComponent(),ajaxRespondWithError({}),this.component.disallowWebPersonalization(),expect("uiShowError").toHaveBeenTriggeredOnAndWith(this.component,{message:"We&#8217;re not able to set your preference at this time. Please try again later."})})})})
});
define("test/app/data/settings/facebook_proxy_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/settings/facebook_proxy",function(){FB=function(){},FB.init=function(a){return a},FB.getLoginStatus=function(a,b){a()},FB.login=function(a,b){a()},FB.logout=function(a){a()},FB.api=function(a,b,c){c()};var a=function(a){return a=a||{},$.extend(!0,{connected:{accounts:[{access_token:"AMdE7lA2H6L05sEwHQgCQYEAAAEwFmQ7Epi0Q9qmEId8tP19v4pE11Lmqc8BAJmi9FcZCxnknLirGyhZBBEZACJtgLPOn7q2tI52MctGBOXsLONiZAwqO",perms:["ADMINISTER","EDIT_PROFILE","CREATE_CONTENT","MODERATE_CONTENT","CREATE_ADS","BASIC_ADMIN"],name:"Page 1",id:"490211837393844",category:"Fictional Character"},{access_token:"88VD9imxw4NiPpAAAEwF1Lmqc8Bb4ZC5w70P2rAAHetvQkjz1GUTyLifVsPZAldzKoZBZA3IWYOy5000DAPU3xNa49eZBPMHqZADvs3UqjTarpDLpDaUuxD",perms:["ADMINISTER","EDIT_PROFILE","CREATE_CONTENT","MODERATE_CONTENT","CREATE_ADS","BASIC_ADMIN"],name:"Page 2",id:"185126407415961",category:"Local business"}],permissions:{missing:[],granted:["user_birthday","installed","publish_actions","status_update","publish_stream","create_note","video_upload","photo_upload","share_item","manage_pages"]},name:"Bart Teeuwisse",id:"531856943"},profile:{cross_posting:!0,retweet_cross_posting:!0,name:"Bart Teeuwisse",id:"531856943"},page:{cross_posting:!0,id:"490211837393844"}},a)};beforeEach(function(){spyOn(FB,"init"),spyOn(FB,"getLoginStatus"),setupComponent(),expect(FB.init).toHaveBeenCalledWith({appId:undefined,status:!1}),expect(FB.getLoginStatus).toHaveBeenCalledWith(jasmine.any(Function),!0)}),describe("event fbLogoutNeeded",function(){it("should invoke logout function",function(){spyOn(FB,"logout"),this.component.trigger("fbLogoutNeeded"),expect(FB.logout).toHaveBeenCalled()}),it("should invoke logoutFBCB",function(){spyOn(this.component,"logoutFBCB"),this.component.trigger("fbLogoutNeeded"),expect(this.component.logoutFBCB).toHaveBeenCalled()})}),describe("logoutFBCB",function(){it("should trigger fbStatusNotLoggedIn when FB app is installed",function(){setupComponent({facebook:{profile:{id:1}}}),spyOnEvent(document,"fbStatusNotLoggedIn"),this.component.logoutFBCB(),expect("fbStatusNotLoggedIn").toHaveBeenTriggeredOnAndWith(document,{profile:{id:1},connected:{permissions:{granted:[],missing:[]},accounts:[]}})}),it("should trigger fbStatusNotConnected when FB app is not installed",function(){spyOnEvent(document,"fbStatusNotConnected"),this.component.logoutFBCB(),expect("fbStatusNotConnected").toHaveBeenTriggeredOnAndWith(document,{profile:{requiredPermissions:[]},page:{requiredPermissions:[]},connected:{permissions:{granted:[],missing:[]},accounts:[]}})})}),describe("event fbDisconnectNeeded",function(){it("should call FB.api to delete app permissions",function(){spyOn(FB,"api"),this.component.trigger("fbDisconnectNeeded"),expect(FB.api).toHaveBeenCalledWith("/me/permissions","DELETE",jasmine.any(Function))})}),describe("disconnectFBCB",function(){it("should call FB.getLoginStatus to restart the flow",function(){this.component.disconnectFBCB(!0),expect(FB.getLoginStatus).toHaveBeenCalled(),this.component.disconnectFBCB(),expect(FB.getLoginStatus).toHaveBeenCalled()}),it("should call resetProfileAndPage upon disconnect",function(){spyOn(this.component,"resetProfileAndPage"),this.component.disconnectFBCB(!0),expect(this.component.resetProfileAndPage).toHaveBeenCalled()})}),describe("event fbLoginNeeded",function(){it("should call FB.login",function(){}),it("should call FB.login with a scope of requiredPermissions",function(){spyOn(FB,"login"),spyOn(this.component,"requiredPermissions").andReturn(["user_birthday","publish_actions","publish_stream"]),this.component.trigger("fbLoginNeeded"),expect(FB.login).toHaveBeenCalledWith(jasmine.any(Function),{scope:"user_birthday,publish_actions,publish_stream"})}),it("should call statusCB upon returning from FB.login",function(){spyOn(this.component,"statusCB"),this.component.trigger("fbLoginNeeded"),expect(this.component.statusCB).toHaveBeenCalled()})}),describe("event fbReloginNeeded",function(){it("should call FB.logout",function(){spyOn(FB,"logout"),this.component.trigger("fbReloginNeeded"),expect(FB.logout).toHaveBeenCalledWith(jasmine.any(Function))})}),describe("reloginFBCB",function(){it("should trigger fbLoginNeeded when FB.logout's response status equals unknown",function(){spyOn(FB,"login"),spyOnEvent(document,"fbLoginNeeded"),this.component.reloginFBCB({status:"unknown"}),expect("fbLoginNeeded").toHaveBeenTriggeredOn(document),expect(FB.login).toHaveBeenCalled()}),it("should trigger fbLogoutError when FB.logout's response status does not equal unknown",function(){spyOnEvent(document,"fbLogoutError"),this.component.reloginFBCB({status:"bogus"}),expect("fbLogoutError").toHaveBeenTriggeredOn(document)})}),describe("event fbPagePermissionsNeeded",function(){it("should trigger FB.login with the combined profile and page permissions",function(){spyOn(FB,"login"),this.component.trigger("fbPagePermissionsNeeded"),expect(FB.login).toHaveBeenCalledWith(jasmine.any(Function),{scope:""}),setupComponent({facebook:{profile:{requiredPermissions:["a","b","c"]},page:{requiredPermissions:["d","e"]}}}),this.component.trigger("fbPagePermissionsNeeded"),expect(FB.login).toHaveBeenCalledWith(jasmine.any(Function),{scope:"a,b,c,d,e"})})}),describe("event fbProfileCrosspostingChanged",function(){it("should POST to /settings/facebook/profile_crossposting_changed",function(){this.component.trigger("fbProfileCrosspostingChanged",{crossPosting:!0}),expect($.ajax.mostRecentOptions.url).toEqual("/settings/facebook/profile_crossposting_changed"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.dataType).toEqual("json"),expect($.ajax.mostRecentOptions.data).toEqual({authenticity_token:"AUTHORIZED",profileAccessToken:undefined,crossPosting:!0})}),it("should trigger 'fbProfileCrosspostingCompleted' upon success",function(){var b=a();spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbProfileCrosspostingCompleted"),ajaxRespondWithSuccess({}),this.component.trigger("fbProfileCrosspostingChanged",!0),expect("fbProfileCrosspostingCompleted").toHaveBeenTriggeredOnAndWith(document,b)}),it("should trigger 'fbProfileCrosspostingError' upon an API error",function(){var b=a({flash:"There was a Twitter server error. The error has been reported to our engineering team. Please try again as it might be a temporary problem."});spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbProfileCrosspostingError"),ajaxRespondWithSuccess({error:{code:1400}}),this.component.trigger("fbProfileCrosspostingChanged",!0),expect("fbProfileCrosspostingError").toHaveBeenTriggeredOnAndWith(document,b)}),it("should trigger 'fbProfileCrosspostingError' upon a HTTP error",function(){var b=a({flash:"There was a communication error with Twitter: "});spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbProfileCrosspostingError"),ajaxRespondWithError({}),this.component.trigger("fbProfileCrosspostingChanged",!0),expect("fbProfileCrosspostingError").toHaveBeenTriggeredOnAndWith(document,b)})}),describe("event fbPageCrosspostingChanged",function(){it("should POST to /settings/facebook/page_crossposting_changed",function(){this.component.trigger("fbPageCrosspostingChanged",{crossPosting:!0,pageId:1}),expect($.ajax.mostRecentOptions.url).toEqual("/settings/facebook/page_crossposting_changed"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.dataType).toEqual("json"),expect($.ajax.mostRecentOptions.data).toEqual({authenticity_token:"AUTHORIZED",profileAccessToken:undefined,pageId:1,crossPosting:!0})}),it("should trigger 'fbPageCrosspostingCompleted' upon success",function(){var b=a();spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbPageCrosspostingCompleted"),ajaxRespondWithSuccess({}),this.component.trigger("fbPageCrosspostingChanged",!0),expect("fbPageCrosspostingCompleted").toHaveBeenTriggeredOnAndWith(document,b)}),it("should trigger 'fbPageCrosspostingError' upon an API error",function(){var b=a({flash:"There was a Twitter server error. The error has been reported to our engineering team. Please try again as it might be a temporary problem."});spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbPageCrosspostingError"),ajaxRespondWithSuccess({error:{code:1400}}),this.component.trigger("fbPageCrosspostingChanged",!0),expect("fbPageCrosspostingError").toHaveBeenTriggeredOnAndWith(document,b)}),it("should trigger 'fbPageCrosspostingError' upon a HTTP error",function(){var b=a({flash:"There was a communication error with Twitter: "});spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbPageCrosspostingError"),ajaxRespondWithError({}),this.component.trigger("fbPageCrosspostingChanged",!0),expect("fbPageCrosspostingError").toHaveBeenTriggeredOnAndWith(document,b)})}),describe("event fbRetweetCrosspostingChanged",function(){it("should POST to /settings/facebook/retweet_crossposting_changed",function(){this.component.trigger("fbRetweetCrosspostingChanged",{crossPosting:!0}),expect($.ajax.mostRecentOptions.url).toEqual("/settings/facebook/retweet_crossposting_changed"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.dataType).toEqual("json"),expect($.ajax.mostRecentOptions.data).toEqual({authenticity_token:"AUTHORIZED",profileAccessToken:undefined,crossPosting:!0})}),it("should trigger 'fbRetweetCrosspostingCompleted' upon success",function(){var b=a();spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbRetweetCrosspostingCompleted"),ajaxRespondWithSuccess({}),this.component.trigger("fbRetweetCrosspostingChanged",!0),expect("fbRetweetCrosspostingCompleted").toHaveBeenTriggeredOnAndWith(document,b)}),it("should trigger 'fbRetweetCrosspostingError' upon an API error",function(){var b=a({flash:"There was a Twitter server error. The error has been reported to our engineering team. Please try again as it might be a temporary problem."});spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbRetweetCrosspostingError"),ajaxRespondWithSuccess({error:{code:1400}}),this.component.trigger("fbRetweetCrosspostingChanged",!0),expect("fbRetweetCrosspostingError").toHaveBeenTriggeredOnAndWith(document,b)}),it("should trigger 'fbRetweetCrosspostingError' upon a HTTP error",function(){var b=a({flash:"There was a communication error with Twitter: "});spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbRetweetCrosspostingError"),ajaxRespondWithError({}),this.component.trigger("fbRetweetCrosspostingChanged",!0),expect("fbRetweetCrosspostingError").toHaveBeenTriggeredOnAndWith(document,b)})}),describe("processErrorResponse",function(){it("should call FB.getLoginStatus for status codes 1100, 1110, 1210, 1300",function(){[1100,1110,1210,1300].forEach(function(a){this.component.processErrorResponse({error:{code:a}},"unused"),expect(FB.getLoginStatus).toHaveBeenCalledWith(jasmine.any(Function),!0)}.bind(this))}),it("should trigger 'fbConnectionConflict' for status 1200",function(){spyOnEvent(document,"fbConnectionConflict");var b=a({html:"<h1>Hello World</h1>"});spyOn(this.component,"status").andReturn(b),this.component.processErrorResponse({error:{code:1200},html:"<h1>Hello World</h1>"},"unused"),expect("fbConnectionConflict").toHaveBeenTriggeredOnAndWith(document,b)}),it("should call 'resetProfileAndPage' for status 1210",function(){spyOn(this.component,"resetProfileAndPage"),this.component.processErrorResponse({error:{code:1210}},"unused"),expect(this.component.resetProfileAndPage).toHaveBeenCalled()}),it("should trigger eventName for status 1400",function(){var b=a({flash:"There was a Twitter server error. The error has been reported to our engineering team. Please try again as it might be a temporary problem."});spyOnEvent(document,"eventName"),spyOn(this.component,"status").andReturn(b),this.component.processErrorResponse({error:{code:1400}},"eventName"),expect("eventName").toHaveBeenTriggeredOnAndWith(document,b)}),it("should call checkPermissions for status 1500 & 1510",function(){spyOn(this.component,"checkPermissions"),[1500,1510].forEach(function(a){this.component.processErrorResponse({error:{code:a}},"unused"),expect(this.component.checkPermissions).toHaveBeenCalled()}.bind(this))}),it("should trigger eventName for status < 1000",function(){spyOnEvent(document,"eventName");var b=a({flash:"Facebook reported an error. The error has been reported to our engineering team. Please try again as it might be a temporary problem."});spyOn(this.component,"status").andReturn(b),[1,10,100,999].forEach(function(a){this.component.processErrorResponse({error:{code:a}},"eventName"),expect("eventName").toHaveBeenTriggeredOnAndWith(document,b)}.bind(this))}),it("should trigger eventName for 2000 > status < 3000",function(){spyOnEvent(document,"eventName");var b=a({flash:"There was a communication error between Twitter and Facebook. The error has been reported to our engineering team. Please try again as it might be a temporary problem."});spyOn(this.component,"status").andReturn(b),[2001,2100,2999].forEach(function(a){this.component.processErrorResponse({error:{code:a}},"eventName"),expect("eventName").toHaveBeenTriggeredOnAndWith(document,b)}.bind(this))}),it("should trigger eventName for all other status codes",function(){spyOnEvent(document,"eventName");var b=a({flash:"There was a communication error with Twitter: OOPS"});spyOn(this.component,"status").andReturn(b),[1e3,2e3,3e3,3001,3100,9999].forEach(function(a){this.component.processErrorResponse({error:{code:a,message:"OOPS"}},"eventName"),expect("eventName").toHaveBeenTriggeredOnAndWith(document,b)}.bind(this))})}),describe("updateProfilePageConnected",function(){beforeEach(function(){this.component.resetProfileAndPage()}),it("should match our base line",function(){expect(this.component.profile).toEqual({requiredPermissions:[],crossPosting:!1,retweetCrossPosting:!1}),expect(this.component.page).toEqual({requiredPermissions:[],crossPosting:!1}),expect(this.component.connected).toEqual({permissions:{granted:[],missing:[]},accounts:[]})}),it("should update profile state with profile data",function(){setupComponent({facebook:{profile:{id:1,requiredPermissions:[],crossPosting:!1,retweetCrossPosting:!1},page:{id:2,requiredPermissions:[],crossPosting:!1}}}),this.component.updateProfilePageConnected({profile:{cross_posting:!0,name:"Larry",id:1,retweet_cross_posting:!0}}),expect(this.component.profile).toEqual({requiredPermissions:[],crossPosting:!0,retweetCrossPosting:!0,name:"Larry",id:1}),expect(this.component.page).toEqual({requiredPermissions:[],crossPosting:!1}),expect(this.component.connected).toEqual({permissions:{granted:[],missing:[]},accounts:[]})}),it("should update page state with page data",function(){setupComponent({facebook:{profile:{id:1,requiredPermissions:[],crossPosting:!1,retweetCrossPosting:!1},page:{id:2,requiredPermissions:[],crossPosting:!1}}}),this.component.updateProfilePageConnected({page:{cross_posting:!0,id:3,retweet_cross_posting:!0}}),expect(this.component.profile).toEqual({id:1,requiredPermissions:[],crossPosting:!1,retweetCrossPosting:!1}),expect(this.component.page).toEqual({requiredPermissions:[],crossPosting:!0,id:3}),expect(this.component.connected).toEqual({permissions:{granted:[],missing:[]},accounts:[]})}),it("should do nothing if there is no profile, page and connected data",function(){this.component.updateProfilePageConnected({}),expect(this.component.profile).toEqual({requiredPermissions:[],crossPosting:!1,retweetCrossPosting:!1}),expect(this.component.page).toEqual({requiredPermissions:[],crossPosting:!1}),expect(this.component.connected).toEqual({permissions:{granted:[],missing:[]},accounts:[]})}),it("should update connected state with connected data",function(){this.component.updateProfilePageConnected({connected:{permissions:{granted:["a","b"],missing:["c","d"]},accounts:[1,2,3]}}),expect(this.component.profile).toEqual({requiredPermissions:[],crossPosting:!1,retweetCrossPosting:!1}),expect(this.component.page).toEqual({requiredPermissions:[],crossPosting:!1}),expect(this.component.connected).toEqual({permissions:{granted:["a","b"],missing:["c","d"]},accounts:[1,2,3]})})}),describe("checkPermissions",function(){beforeEach(function(){setupComponent({facebook:{profile:{requiredPermissions:["a"]},page:{requiredPermissions:["d"]}}})}),it("should trigger 'fbPermissionsGranted' if all required permissions have been granted",function(){spyOnEvent(document,"fbPermissionsGranted");var b=a();spyOn(this.component,"status").andReturn(b),this.component.connected.permissions={missing:[]},this.component.checkPermissions(),expect("fbPermissionsGranted").toHaveBeenTriggeredOnAndWith(document,b)}),it("should trigger 'fbPermissionsMissing' if required profile permissions are missing",function(){spyOnEvent(document,"fbPermissionsMissing");var b=a();spyOn(this.component,"status").andReturn(b),this.component.connected.permissions={missing:["a"]},this.component.checkPermissions(),expect("fbPermissionsMissing").toHaveBeenTriggeredOnAndWith(document,b),this.component.connected.permissions={missing:["a","d"]},this.component.checkPermissions(),expect("fbPermissionsMissing").toHaveBeenTriggeredOnAndWith(document,b)}),it("should trigger 'fbPagePermissionsMissing' if only required page permissions are missing",function(){spyOnEvent(document,"fbPagePermissionsMissing");var b=a();spyOn(this.component,"status").andReturn(b),this.component.connected.permissions={missing:["d"]},this.component.checkPermissions(),expect("fbPagePermissionsMissing").toHaveBeenTriggeredOnAndWith(document,b)})}),describe("requiredPermissions",function(){beforeEach(function(){setupComponent({facebook:{profile:{id:1,requiredPermissions:["a","b","c"]},page:{id:2,requiredPermissions:["d","e"]}}})}),it("should return profile & page permissions combined if there is a page connection",function(){expect(this.component.requiredPermissions()).toEqual(["a","b","c","d","e"])}),it("should return only profile permissions if there is no page connection",function(){delete this.component.page.id,expect(this.component.requiredPermissions()).toEqual(["a","b","c"])})}),describe("statusCB",function(){it("should trigger 'fbStatusNotLoggedIn' when not connected and profile ID on record",function(){setupComponent({facebook:{profile:{id:1}}});var b=a();spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbStatusNotLoggedIn"),this.component.statusCB({}),expect("fbStatusNotLoggedIn").toHaveBeenTriggeredOnAndWith(document,b)}),it("should trigger 'fbStatusNotConnected' when not connected and no profile ID on record",function(){var b=a();spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbStatusNotConnected"),this.component.statusCB({}),expect("fbStatusNotConnected").toHaveBeenTriggeredOnAndWith(document,b)}),it("should call reconnected when response profile ID matches the profile ID on record",function(){setupComponent({facebook:{profile:{id:1}},connected:{permissions:{missing:["a"]}}}),this.component.statusCB({status:"connected",authResponse:{userID:"1",accessToken:"yadayada"}}),expect($.ajax.mostRecentOptions.url).toEqual("/settings/facebook/reconnected"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.dataType).toEqual("json"),expect($.ajax.mostRecentOptions.data).toEqual({authenticity_token:"AUTHORIZED",profileAccessToken:"yadayada",missingPermissions:["a"]})}),it("should call reconnectedSuccess upon successful reconnecting",function(){setupComponent({facebook:{profile:{id:1}}}),spyOn(this.component,"reconnectedSuccess"),ajaxRespondWithSuccess({}),this.component.statusCB({status:"connected",authResponse:{userID:"1"}}),expect(this.component.reconnectedSuccess).toHaveBeenCalled()}),it("should call reconnectedError upon failing to reconnect",function(){setupComponent({facebook:{profile:{id:1}}}),spyOn(this.component,"reconnectedError"),ajaxRespondWithError({}),this.component.statusCB({status:"connected",authResponse:{userID:"1"}}),expect(this.component.reconnectedError).toHaveBeenCalled()}),it("should call connected when there is no profile ID on record",function(){setupComponent(),this.component.statusCB({status:"connected",authResponse:{userID:"1",accessToken:"yadayada"}}),expect($.ajax.mostRecentOptions.url).toEqual("/settings/facebook/connected"),expect($.ajax.mostRecentOptions.type).toEqual("POST"),expect($.ajax.mostRecentOptions.dataType).toEqual("json"),expect($.ajax.mostRecentOptions.data).toEqual({authenticity_token:"AUTHORIZED",profileAccessToken:"yadayada",profileId:"1"})}),it("should call connectedSuccess upon successful reconnecting",function(){setupComponent(),spyOn(this.component,"connectedSuccess"),ajaxRespondWithSuccess({}),this.component.statusCB({status:"connected",authResponse:{userID:"1"}}),expect(this.component.connectedSuccess).toHaveBeenCalled()}),it("should call connectedError upon failing to reconnect",function(){setupComponent(),spyOn(this.component,"connectedError"),ajaxRespondWithError({}),this.component.statusCB({status:"connected",authResponse:{userID:"1"}}),expect(this.component.connectedError).toHaveBeenCalled()}),it("should call FB.api when there is a profile ID on record",function(){setupComponent({facebook:{profile:{id:1}}}),spyOn(FB,"api"),this.component.statusCB({status:"connected",authResponse:{userID:"2"}}),expect(FB.api).toHaveBeenCalledWith("/","POST",{batch:[{method:"GET",relative_url:this.component.profile.id+"?fields=name"},{method:"GET",relative_url:"me?fields=name"}]},jasmine.any(Function))})}),describe("apiResponse",function(){it("should trigger 'fbStatusConnectionMismatch' upon a successful FB.api call",function(){spyOnEvent(document,"fbStatusConnectionMismatch"),this.component.apiResponse([{code:200,body:'{"name": "Jip"}'},{code:200,body:'{"name": "Janneke"}'}]),expect("fbStatusConnectionMismatch").toHaveBeenTriggeredOnAndWith(document,{profile:{name:"Jip"},connected:{name:"Janneke"}})}),it("should trigger 'fbConnectionError' upon an unsuccessful FB.api call",function(){var b=a({flash:"Facebook reported an error. The error has been reported to our engineering team. Please try again as it might be a temporary problem."});spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"fbConnectionError"),this.component.apiResponse(!1),expect("fbConnectionError").toHaveBeenTriggeredOnAndWith(document,b)})}),describe("connectedSuccess",function(){it("should call processSuccess",function(){spyOn(this.component,"processSuccess"),this.component.connectedSuccess({}),expect(this.component.processSuccess).toHaveBeenCalledWith({},"fbConnectionError")})}),describe("connectedError",function(){it("should call triggerTwitterCommunicationError with 'fbConnectionError'",function(){spyOn(this.component,"triggerTwitterCommunicationError"),this.component.connectedError({xhr:{statusText:"timeout"}}),expect(this.component.triggerTwitterCommunicationError).toHaveBeenCalledWith("fbConnectionError","timeout")})}),describe("reconnectedSuccess",function(){it("should call processSuccess",function(){spyOn(this.component,"processSuccess"),this.component.reconnectedSuccess({}),expect(this.component.processSuccess).toHaveBeenCalledWith({},"fbReconnectionError")})}),describe("reconnectedError",function(){it("should call triggerTwitterCommunicationError with 'fbReconnectionError'",function(){spyOn(this.component,"triggerTwitterCommunicationError"),this.component.reconnectedError({xhr:{statusText:"parseerror"}}),expect(this.component.triggerTwitterCommunicationError).toHaveBeenCalledWith("fbReconnectionError","parseerror")})}),describe("processSuccess",function(){it("should call updateProfilePageConnected",function(){spyOn(this.component,"updateProfilePageConnected"),this.component.processSuccess({}),expect(this.component.updateProfilePageConnected).toHaveBeenCalledWith({})}),it("should call processErrorResponse if there is an error response",function(){spyOn(this.component,"processErrorResponse"),this.component.processSuccess({error:{code:999,message:""}},"fbConnectionError"),expect(this.component.processErrorResponse).toHaveBeenCalledWith({error:{code:999,message:""}},"fbConnectionError")}),it("should update the profile accessToken and check permissions upon success",function(){expect(this.component.profile.accessToken).toEqual(undefined),spyOn(this.component,"checkPermissions"),this.component.processSuccess({sourceEventData:{authResponse:{accessToken:"GOGOGO"}}}),expect(this.component.profile.accessToken).toEqual("GOGOGO"),expect(this.component.checkPermissions).toHaveBeenCalled()})}),describe("triggerTwitterCommunicationError",function(){it("should trigger 'eventName' and add 'flash' to the current state object",function(){var b=a({flash:"There was a communication error with Twitter: OOPS"});spyOn(this.component,"status").andReturn(b),spyOnEvent(document,"eventName"),this.component.triggerTwitterCommunicationError("eventName","OOPS"),expect("eventName").toHaveBeenTriggeredOnAndWith(document,b)})}),describe("resetProfileAndPage",function(){it("should reset profile and page state",function(){setupComponent({facebook:{profile:{id:1,name:"Larry",crossPosting:!0,retweetCrossPosting:!1,requiredPermissions:["a","b","c"]},page:{id:2,crossPosting:!0,requiredPermissions:["d","e"]}}}),this.component.resetProfileAndPage();var a=this.component.profile,b=this.component.page;expect(a.id).toEqual(undefined),expect(a.name).toEqual(undefined),expect(a.crossPosting).toEqual(!1),expect(a.retweetCrossPosting).toEqual(!1),expect(a.requiredPermissions).toEqual(["a","b","c"]),expect(b.id).toEqual(undefined),expect(b.crossPosting).toEqual(!1),expect(b.requiredPermissions).toEqual(["d","e"])})})})
});
define("test/app/data/settings/login_verification_test_run_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/settings/login_verification_test_run",function(){beforeEach(function(){setupComponent()}),it("posts to /settings/security/attempt_login_verification_sms on uiTestLoginVerificationSms",function(){ajaxRespondWithSuccess({}),$(document).trigger("uiTestLoginVerificationSms"),expect($.ajax.mostRecentOptions.url).toBe("/settings/security/attempt_login_verification_sms"),expect($.ajax.mostRecentOptions.type).toBe("POST")}),it("triggers dataSendTestSmsSuccess on success",function(){ajaxRespondWithSuccess({}),spyOnEvent(document,"dataSendTestSmsSuccess"),$(document).trigger("uiTestLoginVerificationSms"),expect("dataSendTestSmsSuccess").toHaveBeenTriggeredOn(document)}),it("triggers dataSendTestSmsError on failure",function(){ajaxRespondWithError({}),spyOnEvent(document,"dataSendTestSmsError"),$(document).trigger("uiTestLoginVerificationSms"),expect("dataSendTestSmsError").toHaveBeenTriggeredOn(document)})})
});
define("test/app/data/feedback/feedback_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/data/feedback/feedback",function(){beforeEach(function(){this.mockData={data:{mocking:"hello world"}},setupComponent(this.mockData),spyOn(this.component,"refreshPage").andReturn(!0),document.cookie=this.component.attr.feedbackCookie+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}),describe("initialize",function(){beforeEach(function(){spyOnEvent(document,"dataDebugFeedbackChanged"),setupComponent(this.mockData)}),it("sets the data object with the debug data in options",function(){expect(this.component.attr.data).toEqual(this.mockData.data)}),it("sets an empty object when no data is passed",function(){setupComponent(),expect(this.component.attr.data).toEqual({})}),it("triggers dataDebugFeedbackChanged on initialize",function(){expect("dataDebugFeedbackChanged").toHaveBeenTriggeredOnAndWith(document,{enabled:!1})})}),describe("uiNeedsFeedbackData",function(){it("triggers dataFeedback with given data",function(){spyOnEvent(document,"dataFeedback"),this.component.trigger("uiNeedsFeedbackData"),expect("dataFeedback").toHaveBeenTriggeredOnAndWith(document,this.mockData.data)})}),describe("uiToggleDebugFeedback",function(){it("sets the cookie with value 1 when enabled",function(){spyOnEvent(this.$node,"dataDebugFeedbackChanged"),this.component.trigger("uiToggleDebugFeedback",{enabled:!0}),expect(document.cookie).toMatch(this.component.attr.feedbackCookie+"=true"),expect("dataDebugFeedbackChanged").toHaveBeenTriggeredOnAndWith(this.$node,{enabled:!0})}),it("deletes the cookie when disabled",function(){spyOnEvent(this.$node,"dataDebugFeedbackChanged"),this.component.trigger("uiToggleDebugFeedback",{enabled:!0}),this.component.trigger("uiToggleDebugFeedback",{enabled:!1}),expect(document.cookie).not.toMatch(this.component.attr.feedbackCookie),expect("dataDebugFeedbackChanged").toHaveBeenTriggeredOnAndWith(this.$node,{enabled:!1})})}),describe("pingBackend",function(){it("contacts the backend and marks server as available if successful",function(){this.component.attr.reportBackendPingUrl="http://example.com",ajaxRespondWithSuccess({}),this.component.trigger("uiCheckFeedbackBackendAvailable",{}),expect(this.component.isBackendAvailable()).toEqual(!0)}),it("contacts the backend and marks server as down if it fails",function(){this.component.attr.reportBackendPingUrl="http://example.com",ajaxRespondWithError({}),this.component.trigger("uiCheckFeedbackBackendAvailable",{}),expect(this.component.isBackendAvailable()).toEqual(!1)})}),describe("backendPost",function(){it("posts to the backend and returns data, if available",function(){mock={summary:"summary",description:"description"},spyOnEvent(document,"dataFeedbackBackendSuccess"),spyOn(this.component,"isBackendAvailable").andReturn(!0),this.component.attr.reportBackendGetUrl="http://example.com",ajaxRespondWithSuccess({key:"TEST-123"}),this.component.trigger("uiFeedbackBackendPost",mock),expect("dataFeedbackBackendSuccess").toHaveBeenTriggeredOnAndWith(document,{link:this.component.attr.reportBackendGetUrl+"TEST-123",ticketId:"TEST-123"})}),it("generates an email link when no backend available",function(){mock={summary:"summary",description:"description",other:"test",array:["a","b","c"]},spyOnEvent(document,"dataFeedbackBackendFailure"),spyOn(this.component,"isBackendAvailable").andReturn(!1),this.component.trigger("uiFeedbackBackendPost",mock),expect("dataFeedbackBackendFailure").toHaveBeenTriggeredOnAndWith(document,{link:"mailto:undefined?subject=summary&body=description: description%0D%0Aother: test%0D%0Aarray: a,b,c%0D%0A",data:mock})}),it("falls back to email when the backend fails",function(){mock={summary:"summary",description:"description"},spyOnEvent(document,"dataFeedbackBackendFailure"),spyOn(this.component,"isBackendAvailable").andReturn(!0),ajaxRespondWithError({}),this.component.trigger("uiFeedbackBackendPost",mock),expect("dataFeedbackBackendFailure").toHaveBeenTriggeredOnAndWith(document,{link:"mailto:undefined?subject=summary&body=description: description%0D%0A",data:mock})})}),describe("dataSetDebugData",function(){it("merges the new data to the data field",function(){this.component.attr.data={test1:[{data:"123"}]},this.component.trigger("dataSetDebugData",{test2:[{data:"234"}]}),expect(this.component.attr.data.test1).toEqual([{data:"123"}]),expect(this.component.attr.data.test2).toEqual([{data:"234"}])}),it("appends to the previous data value",function(){this.component.trigger("dataSetDebugData",{test1:[{data:"123"}]}),this.component.trigger("dataSetDebugData",{test1:[{data:"234"},{data:"345"}]}),expect(this.component.attr.data.test1).toEqual([{data:"123"},{data:"234"},{data:"345"}])})}),describe("logNavigation",function(){it("logs pushState navigations",function(){var a="http://twitter.com",b="test_module",c="test title";this.component.trigger("uiPageChanged",{href:a,module:b,title:c}),expect(this.component.attr.data.pushState).toEqual([{data:{href:a,module:b,title:c}}])})})})
});
define("test/app/utils/storage/core_spec",["module","require","exports","app/utils/storage/core"],function(module, require, exports) {
var CoreStorage=require("app/utils/storage/core");module.exports={},describe("CoreStorage",function(){beforeEach(function(){this.storage=new CoreStorage("test"),this.other=new CoreStorage("test2")}),describe("setItem()/getItem()",function(){it("can set a value and retreive it",function(){this.storage.setItem("thing","pass!"),expect(this.storage.getItem("thing")).toBe("pass!")}),it("should be able to store non-string types",function(){this.storage.setItem("thing",47),expect(this.storage.getItem("thing")).toBe(47),this.storage.setItem("thing",[1,2,3]),expect(this.storage.getItem("thing")).toEqual([1,2,3])})}),describe("removeItem()",function(){it("can remove a value",function(){this.storage.setItem("thing","to be removed"),this.storage.removeItem("thing"),expect(this.storage.getItem("thing")).toBe(null)})}),describe("keys()",function(){it("can retreive a list of keys",function(){this.storage.setItem("thing1","pass!"),this.storage.setItem("thing2","pass!"),this.storage.setItem("thing3","pass!"),expect(this.storage.keys().sort()).toEqual(["thing1","thing2","thing3"])}),it("does not retrieve keys from other namespaces",function(){this.storage.setItem("thing1","pass!"),this.storage.setItem("thing2","pass!"),this.storage.setItem("thing3","pass!"),this.other.setItem("blam","waa"),expect(this.storage.keys().sort()).toEqual(["thing1","thing2","thing3"])})}),describe("clear()",function(){it("can remove all keys in the namespace",function(){this.storage.setItem("thing1","pass!"),this.storage.setItem("thing2","pass!"),this.storage.setItem("thing3","pass!"),this.storage.clear(),expect(this.storage.keys()).toEqual([])}),it("does not clear other namespaces",function(){this.storage.setItem("thing1","pass!"),this.storage.setItem("thing2","pass!"),this.storage.setItem("thing3","pass!"),this.other.setItem("boo","yaa"),this.storage.clear(),expect(this.other.keys()).toEqual(["boo"])})}),afterEach(function(){this.storage.clear(),this.other.clear()})})
});
define("test/app/utils/storage/with_expiry_spec",["module","require","exports","app/utils/storage/custom"],function(module, require, exports) {
var customStorage=require("app/utils/storage/custom");module.exports={};var threeHours=108e5,oneHour=36e5,oneSecond=1e3,fiveSeconds=5e3;describe("CoreStorage withExpiry",function(){beforeEach(function(){var a=customStorage({withExpiry:!0});this.storage=new a("test")}),describe("setItem()",function(){it("can set item with ttl",function(){this.storage.setItem("thing","temp",oneSecond),expect(this.storage.getItem("thing")).toBe("temp")}),it("can set item without ttl",function(){this.storage.setItem("thing","temp"),expect(this.storage.getItem("thing")).toBe("temp")})}),describe("getItem()",function(){it("will retrieve item if within ttl",function(){this.storage.setItem("thing","temp",oneHour),expect(this.storage.getItem("thing")).toBe("temp")}),it("will remove item and return null if trying to retrieve item that has expired",function(){this.storage.setItem("thing","temp",0),spyOn(this.storage,"now").andReturn((new Date).getTime()+oneHour),expect(this.storage.getItem("thing")).toBe(null)})}),describe("updateTTL()",function(){it("will update the ttl",function(){this.storage.setItem("thing","temp",0),spyOn(this.storage,"now").andReturn((new Date).getTime()+oneHour),expect(this.storage.isExpired("thing")).toBe(!0),this.storage.updateTTL("thing",threeHours),expect(this.storage.isExpired("thing")).toBe(!1)})}),describe("isExpired()",function(){it("will return true if the item has expired",function(){this.storage.setItem("thing","temp",0),spyOn(this.storage,"now").andReturn((new Date).getTime()+oneHour),expect(this.storage.isExpired("thing")).toBe(!0)}),it("will return false if the item has not expired",function(){this.storage.setItem("thing","temp",oneHour),expect(this.storage.isExpired("thing")).toBe(!1)})}),describe("removeItem()",function(){it("removes ttl as well as value",function(){this.storage.setItem("thing","temp",oneHour),expect(this.storage.ttl.getItem("thing")).toBeTruthy(),this.storage.removeItem("thing"),expect(this.storage.getItem("thing")).toBeNull(),expect(this.storage.ttl.getItem("thing")).toBeNull()})}),describe("getCacheAge()",function(){it("returns the integer number of hours an item has been in local storage if item not expired",function(){this.storage.setItem("thing","temp",threeHours),spyOn(this.storage,"now").andReturn((new Date).getTime()+oneHour+fiveSeconds),expect(this.storage.getCacheAge("thing",threeHours)===1).toBeTruthy()}),it("returns -1 if item not in cache",function(){expect(this.storage.getCacheAge("notInCacheThing4958W00t",threeHours)===-1).toBeTruthy()}),it("returns the integer number of hours an item has been in local storage if item has expired",function(){this.storage.setItem("thing","temp",oneHour),spyOn(this.storage,"now").andReturn((new Date).getTime()+threeHours+fiveSeconds),expect(this.storage.getCacheAge("thing",oneHour)===3).toBeTruthy()}),it("returns -1 if item age is negative",function(){this.storage.setItem("thing","temp",threeHours),spyOn(this.storage,"now").andReturn(0),expect(this.storage.getCacheAge("thing",threeHours)===-1).toBeTruthy()}),it("returns 0 if item age is less than one hour",function(){this.storage.setItem("thing","temp",threeHours),spyOn(this.storage,"now").andReturn((new Date).getTime()+oneHour-fiveSeconds),expect(this.storage.getCacheAge("thing",threeHours)===0).toBeTruthy()})}),afterEach(function(){this.storage.clear()})})
});
define("test/app/utils/storage/custom_spec",["module","require","exports","app/utils/storage/custom"],function(module, require, exports) {
var customStorage=require("app/utils/storage/custom");module.exports={};var testMixins=function(a,b){var c=customStorage(a),d=new c("test"),e=[];d.mixedIn.forEach(function(a){e.push(a.name)}),expect(e).toEqual(b)};describe("custom storage",function(){it("creates constructors with the right mixins",function(){testMixins({withExpiry:!0},["withExpiry"]),testMixins({withCrypto:!0},["withCrypto"]),testMixins({withExpiry:!0,withCrypto:!0},["withCrypto","withExpiry"]),testMixins({withExpiry:!0,withCrypto:!1},["withExpiry"])}),it("creates constructors with the right mixins when the same mixin is requested multiple times",function(){testMixins({withExpiry:!0,withCrypto:!0},["withCrypto","withExpiry"]),testMixins({withExpiry:!0,withCrypto:!0},["withCrypto","withExpiry"]),testMixins({withCrypto:!0},["withCrypto"]),testMixins({withCrypto:!0},["withCrypto"])}),it("includes withArray when withMaxElements or withUniqueElements is included",function(){testMixins({withMaxElements:3},["withArray","withMaxElements"]),testMixins({withUniqueElements:!0},["withArray","withUniqueElements"]),testMixins({withMaxElements:3,withUniqueElements:!0},["withArray","withUniqueElements","withMaxElements"]),testMixins({withArray:!0,withMaxElements:3,withUniqueElements:!0},["withArray","withUniqueElements","withMaxElements"])})})
});
define("test/app/utils/storage/with_crypto_spec",["module","require","exports","app/utils/storage/custom"],function(module, require, exports) {
var customStorage=require("app/utils/storage/custom");module.exports={},describe("CoreStorage withCrypto",function(){beforeEach(function(){var a=customStorage({withCrypto:!0});this.storage=new a("test","secret"),this.badStorage=new a("test","badSecret")}),describe("encode()",function(){it("encrypts string or non-string values",function(){expect(this.storage.encode("thing")).toNotEqual("thing"),expect(this.storage.encode(47)).toNotEqual("47"),expect(this.storage.encode([1,2,3])).toNotEqual("[1,2,3]")})}),describe("decode()",function(){it("decrypts string or non-string values",function(){var a=this.storage.encode("thing"),b=this.storage.encode(47),c=this.storage.encode([1,2,3]);expect(this.storage.decode(a)).toBe("thing"),expect(this.storage.decode(b)).toBe(47),expect(this.storage.decode(c)).toEqual([1,2,3])}),it("throws if the store has a bad secret",function(){var a=this.storage.encode("thing");expect(function(){this.badStorage.decode(a)}).toThrow()})}),describe("getItem()",function(){beforeEach(function(){this.storage.setItem("str","thing"),this.storage.setItem("num",47),this.storage.setItem("arr",[1,2,3])}),it("gets strings and non-strings with good secret",function(){expect(this.storage.getItem("str")).toEqual("thing"),expect(this.storage.getItem("num")).toEqual(47),expect(this.storage.getItem("arr")).toEqual([1,2,3])}),it("removes items if accessed via bad key",function(){expect(this.badStorage.getItem("str")).toBeNull(),expect(this.badStorage.getItem("num")).toBeNull(),expect(this.badStorage.getItem("arr")).toBeNull()})}),afterEach(function(){this.storage.clear()})})
});
define("test/app/utils/image/image_loader_spec",["module","require","exports","app/utils/image/image_loader"],function(module, require, exports) {
var imageLoader=require("app/utils/image/image_loader");module.exports={},describe("image loading utility functions",function(){var a=["data:image/jpeg;base64,","/9j/4AAQSkZJRgABAQEASABIAAD/2wCDEAAcABwAHAAeAB4AHgAmACYAJgAm","ADIAMgAyADIAMgBEAEQARABEAEQARABaAFoAWgBaAFoAWgBaAHYAdgB2AHYA","dgB2AHYAdgDpAOkA6QDpAOkA6QDpAc8BzwHPAc8BzwHPA5sDmwObA5sDmwcz","BzMHMwczDmMOYw5jHMMcwzmD/8EACwgAEAAMAQERAP/EABYAAQEBAAAAAAAA","AAAAAAAAAAYBBP/EACAQAAIBBAEFAAAAAAAAAAAAAAEDAgAEESIFEiExUYH/","2gAIAQEAAD8A1chya0CaobMIwfQqWCnuQGSYdiSO8vH2jjEXJZIyVPqJydTT","O0yLZQMDEiIGK//Z"].join(""),b=["data:image/jpeg;base64,","/9j/4AAQSkZJRgABAQEASABIAAD/2wCDEAAcABwAHAAeAB4AHgAmACYAJgAm","ADIAMgAyADIAMgBEAEQARABEAEQARABaAFoAWgBaAFoAWgBaAHYAdgB2AHYA","this ought to make it invalid.","BzMHMwczDmMOYw5jHMMcwzmD/8EACwgAEAAMAQERAP/EABYAAQEBAAAAAAAA","AAAAAAAAAAYBBP/EACAQAAIBBAEFAAAAAAAAAAAAAAEDAgAEESIFEiExUYH/","2gAIAQEAAD8A1chya0CaobMIwfQqWCnuQGSYdiSO8vH2jjEXJZIyVPqJydTT","O0yLZQMDEiIGK//Z"].join("");it("calls the success cb if image loads successfully",function(){var b=jasmine.createSpy(),c=jasmine.createSpy();runs(function(){imageLoader.load(a,b,c)}),waitsFor(function(){return b.callCount>0},"image was loaded",500),runs(function(){expect(b).toHaveBeenCalled(),expect(c).not.toHaveBeenCalled()})}),it("calls the error cb if image fails to loads successfully",function(){var a=jasmine.createSpy(),c=jasmine.createSpy();runs(function(){imageLoader.load(b,a,c)}),waitsFor(function(){return c.callCount>0},"image was not loaded",500),runs(function(){expect(c).toHaveBeenCalled(),expect(a).not.toHaveBeenCalled()})})})
});
define("test/app/utils/crypto/aes_spec",["module","require","exports","app/utils/crypto/aes"],function(module, require, exports) {
var aes=require("app/utils/crypto/aes");module.exports={},describe("aes",function(){beforeEach(function(){this.encrypted=aes.enc("thing","secret")}),it("decrypts a string given the correct secret",function(){expect(aes.dec(this.encrypted,"secret")).toBe("thing")}),xit("throws when given an incorrect secret",function(){var a=this;expect(function(){aes.dec(a.encrypted,"secret2")}).toThrow()})})
});
define("test/app/ui/trends/dialog/current_location_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/trends/dialog/current_location",function(){beforeEach(function(){var a='<div class="trends-current-location">\n          <div class="js-location-personalized">\n            If you want to stop seeing tailored Trends, choose a new location now.\n          </div>\n          <div class="js-location-nonpersonalized">\n            Current location: <span class="current-location"></span>\n          </div>\n        </div>\n     ';this.setupComponent(a,{personalized:!1,location:{woeid:1,name:"Worldwide"}})}),describe("after initialize",function(){it("should set personalized",function(){expect(this.component.attr.personalized).toEqual(!1)}),it("should set location",function(){expect(this.component.attr.location).toEqual({woeid:1,name:"Worldwide"})})}),describe("event dataChangedTrendLocation",function(){var a={woeid:2,name:"test"};beforeEach(function(){$(document).trigger("dataChangedTrendLocation",{personalized:!0,location:a})}),it("should update personalized",function(){expect(this.component.attr.personalized).toEqual(!0)}),it("should update location",function(){expect(this.component.attr.location).toEqual(a)})}),describe("#updateView",function(){describe("when personalized",function(){beforeEach(function(){this.component.attr.personalized=!0,this.component.updateView()}),it("should hide the nonpersonalized container",function(){expect(this.component.select("nonpersonalizedSelector")).toBeHidden()}),it("should show the personalized container",function(){expect(this.component.select("personalizedSelector")).toBeVisible()})}),describe("when personalized is undefined",function(){beforeEach(function(){this.component.attr.personalized=undefined,this.component.attr.location={name:"test"},this.component.updateView()}),it("should update the location text",function(){expect(this.component.select("currentLocationSelector").text()).toEqual("test")}),it("should hide the personalized container",function(){expect(this.component.select("personalizedSelector")).toBeHidden()}),it("should show the nonpersonalized container",function(){expect(this.component.select("nonpersonalizedSelector")).toBeVisible()})}),describe("when nonpersonalized",function(){beforeEach(function(){this.component.attr.personalized=!1,this.component.attr.location={name:"test"},this.component.updateView()}),it("should update the location text",function(){expect(this.component.select("currentLocationSelector").text()).toEqual("test")}),it("should hide the personalized container",function(){expect(this.component.select("personalizedSelector")).toBeHidden()}),it("should show the nonpersonalized container",function(){expect(this.component.select("nonpersonalizedSelector")).toBeVisible()})})})})
});
define("test/app/ui/trends/dialog/dialog_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/trends/dialog/dialog",{fixture:"test/fixtures/trends_location_dialog_api"},function(){var a='<div id="trends_dialog" class="trends-dialog modal-container" style="display:none;">\n    <div class="close-modal-background-target"></div>\n    <div class="modal draggable">\n      <div class="modal-content">\n        <div class="modal-header">\n        <div class="modal-body">\n          <div class="trends-personalized content-placeholder">\n            <p class="placeholder-actions">\n              <button type="button" class="btn customize-by-location">Change</button>\n              <button type="button" class="btn primary-btn done" id="keep-tailored-trends">Keep tailored Trends</button>\n            </p>\n          </div>\n          <div class="trends-dialog-error"><p></p></div>\n          <div class="trends-wrapper" id="trends_dialog_content">\n            <div class="loading"><span class="spinner-bigger"></span></div>\n          </div>\n        </div>\n        <div class="modal-footer trends-by-location">\n          <button type="button" class="btn select-default" data-personalized="true">Get tailored Trends</button>\n          <button type="button" class="btn select-default" data-woeid="1" data-name="Worldwide">Get Worldwide Trends</button>\n          <button type="button" class="btn primary-btn done" id="done-button">Done</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  ';beforeEach(function(){this.setupComponent(a)}),describe("#setCurrentView",function(){beforeEach(function(){spyOn(this.component,"showPersonalizedView").andCallThrough(),spyOn(this.component,"showNonpersonalizedView").andCallThrough(),this.component.open()}),describe("when user has personalized trends",function(){beforeEach(function(){$(document).trigger("dataGotTrendsLocationDialog",$.merge({personalized:!0},this.fixture))}),it("should call showPersonalizedView",function(){expect(this.component.showPersonalizedView).toHaveBeenCalled()}),it("should not call showNonpersonalizedView",function(){expect(this.component.showNonpersonalizedView).not.toHaveBeenCalled()}),it('should set focus to the "Keep tailored Trends" button',function(){expect($("#keep-tailored-trends")).toBeFocused()})}),describe("when user has nonpersonalized trends",function(){beforeEach(function(){$(document).trigger("dataGotTrendsLocationDialog",this.fixture)}),it("should call showNonpersonalizedView",function(){expect(this.component.showNonpersonalizedView).toHaveBeenCalled()}),it("should not call showPersonalizedView",function(){expect(this.component.showPersonalizedView).not.toHaveBeenCalled()}),it('should set focus to the "Done" button',function(){expect($("#done-button")).toBeFocused()})})}),describe("event uiShowTrendsLocationDialog",function(){describe("when dialog is not initialized",function(){beforeEach(function(){spyOn(this.component,"open"),spyOn(this.component,"setCurrentView"),spyOnEvent(document,"uiWantsTrendsLocationDialog"),spyOnEvent(this.$node,"uiTrendsDialogOpened"),$(document).trigger("uiShowTrendsLocationDialog")}),it("opens the dialog",function(){expect(this.component.open).toHaveBeenCalled()}),it("triggers uiWantsTrendsLocationDialog when there is no content",function(){expect("uiWantsTrendsLocationDialog").toHaveBeenTriggeredOn(document),expect(this.component.initialized).toEqual(!0)}),it("triggers uiTrendsDialogOpened",function(){expect("uiTrendsDialogOpened").toHaveBeenTriggeredOn(this.$node)})}),describe("when dialog is already initialized",function(){beforeEach(function(){this.component.initialized=!0,$(document).trigger("uiShowTrendsLocationDialog")}),it("does not trigger uiWantsTrendsLocationDialog when there is content",function(){expect("uiWantsTrendsLocationDialog").not.toHaveBeenTriggeredOn(document)}),it('should set focus to the "Done" button',function(){expect($("#done-button")).toBeFocused()})})}),describe("event uiDialogClose",function(){beforeEach(function(){spyOn(this.component,"showQuickSelectContainer"),spyOnEvent(document,"uiTrendsDialogReset"),$(document).trigger("uiDialogClosed")}),it("should call showQuickSelectContainer",function(){expect(this.component.showQuickSelectContainer).toHaveBeenCalled()}),it("should trigger uiTrendsDialogReset",function(){expect("uiTrendsDialogReset").toHaveBeenTriggeredOn(document)})}),describe("event dataGotTrendsLocationDialog",function(){var a="<p>test</p>";beforeEach(function(){$(document).trigger("dataGotTrendsLocationDialog",{dialog_html:a,personalized:!1,location:{woeid:1,name:"Worldwide"}})}),it("should set the dialog_html",function(){expect(this.component.select("contentSelector")).toExist(),expect(this.component.select("contentSelector")).toHaveHtml(a)}),it("should save the location state",function(){expect(this.component.attr.personalized).toEqual(!1),expect(this.component.attr.location.woeid).toEqual(1)})}),describe("event dataChangeTrendLocation",function(){beforeEach(function(){$(document).trigger("dataGotTrendsLocationDialog",this.fixture),$(document).trigger("dataChangedTrendLocation",{personalized:!1,location:{woeid:1,name:"Worldwide"}})}),it("should save location",function(){expect(this.component.attr.location.woeid).toEqual(1),expect(this.component.attr.location.name).toEqual("Worldwide")}),it("should save personalized",function(){expect(this.component.attr.personalized).toEqual(!1)}),it("should hide the loading element",function(){expect(this.component.select("loadingSelector")).toBeHidden()})}),describe("event dataGotTrendsLocationDialogError",function(){var a="<p>Error!</p>";beforeEach(function(){$(document).trigger("dataGotTrendsLocationDialogError",{message:a})}),it("should hide all views",function(){expect(this.component.select("personalizedSelector")).toBeHidden(),expect(this.component.select("nonPersonalizedSelector")).toBeHidden()}),it("should set initialized to false",function(){expect(this.component.initialized).toEqual(!1)}),it("should add and error class to the container",function(){expect(this.$node).toHaveClass(this.component.attr.errorClass)}),it("should show the error message",function(){expect(this.component.select("errorSelector")).toHaveHtml(a)})}),describe("event click on doneSelector",function(){beforeEach(function(){this.component.open(),this.component.select("doneSelector").trigger("click")}),it("should close the dialog",function(){expect(this.$node).toBeHidden()})}),describe("event click on defaultSelector",function(){beforeEach(function(){this.component.open(),spyOnEvent(document,"uiChangeLocation")}),describe("when defaultSelector is personalized",function(){beforeEach(function(){this.component.select("defaultSelector").filter('[data-personalized="true"]').trigger("click")}),it("should trigger uiChangeLocation",function(){expect("uiChangeLocation").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({personalized:!0}))}),it("should close the dialog",function(){expect(this.$node).toBeHidden()})}),describe("when defaultSelector is personalized",function(){beforeEach(function(){this.component.select("defaultSelector").not('[data-personalized="true"]').trigger("click")}),it("should trigger uiChangeLocation",function(){expect("uiChangeLocation").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({location:{woeid:1,name:"Worldwide"}}))}),it("should close the dialog",function(){expect(this.$node).toBeHidden()})})}),describe("event click on changeTrendsSelector",function(){beforeEach(function(){$(document).trigger("uiShowTrendsLocationDialog"),this.component.select("changeTrendsSelector").trigger("click")}),it("should show non personalized view",function(){expect(this.component.select("nonPersonalizedSelector")).toBeVisible()}),it("should hide personalized view",function(){expect(this.component.select("personalizedSelector")).toBeHidden()}),it("should set focus within the dialog",function(){expect($("#done-button")).toBeFocused()})}),describe("event click on showDropdownSelector",function(){beforeEach(function(){this.component.open(),$(document).trigger("dataGotTrendsLocationDialog",this.fixture),this.component.select("showDropdownSelector").trigger("click")}),it("should show non personalized view",function(){expect(this.component.select("nonPersonalizedSelector")).toBeVisible()}),it("should hide quickSelect container",function(){expect(this.component.select("quickSelectSelector")).toBeHidden()}),it("should show dropdownSelect container",function(){expect(this.component.select("dropdownSelector")).toBeVisible()}),it("should set focus within the dialog",function(){expect($("#done-button")).toBeFocused()})}),describe("event click on showQuickSelectSelector",function(){beforeEach(function(){this.component.open(),$(document).trigger("dataGotTrendsLocationDialog",this.fixture),this.component.select("showQuickSelectSelector").trigger("click")}),it("should show non personalized view",function(){expect(this.component.select("nonPersonalizedSelector")).toBeVisible()}),it("should show quickSelect container",function(){expect(this.component.select("quickSelectSelector")).toBeVisible()}),it("should hide dropdownSelect container",function(){expect(this.component.select("dropdownSelector")).toBeHidden()}),it("should set focus within the dialog",function(){expect($("#done-button")).toBeFocused()})}),describe("event uiChangeLocation",function(){beforeEach(function(){this.component.open(),$(document).trigger("dataGotTrendsLocationDialog",this.fixture),this.component.trigger("uiChangeLocation")}),it("should show the loading spinner",function(){expect(this.component.select("loadingSelector")).toBeVisible()}),it("should set focus within the dialog",function(){expect($("#done-button")).toBeFocused()})})})
});
define("test/app/ui/trends/dialog/with_location_info_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/trends/dialog/with_location_info",function(){beforeEach(function(){this.setupComponent()}),describe("before initialize",function(){beforeEach(function(){this.setupComponent({location:{woeid:1,name:"Worldwide"},personalized:!1})}),it("should set personalized to default attr",function(){expect(this.component.attr.personalized).toBe(!1)}),it("should set location to default attr",function(){expect(this.component.attr.location.woeid).toBe(1),expect(this.component.attr.location.name).toBe("Worldwide")})}),describe("event dataChangedTrendLocation",function(){beforeEach(function(){$(document).trigger("dataChangedTrendLocation",{location:{woeid:2,name:"New York"}})}),it("should set personalized",function(){expect(this.component.attr.personalized).toBe(!1)}),it("should set location to default attr",function(){expect(this.component.attr.location.woeid).toBe(2),expect(this.component.attr.location.name).toBe("New York")})}),describe("#changeLocationInfo",function(){beforeEach(function(){spyOnEvent(document,"uiChangeLocation"),this.component.changeLocationInfo({woeid:1,name:"Worldwide"})}),it("should trigger uiChangeLocation",function(){expect("uiChangeLocation").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({location:{woeid:1,name:"Worldwide"}}))})}),describe("#setPersonalizedTrends",function(){beforeEach(function(){spyOnEvent(document,"uiChangeLocation"),this.component.setPersonalizedTrends()}),it("should trigger uiChangeLocation",function(){expect("uiChangeLocation").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({personalized:!0}))})})})
});
define("test/app/ui/trends/dialog/recent_trends_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/trends/dialog/recent_trends",function(){var a=[{name:"Worldwide",woeid:1},{name:"United States",woeid:1132412},{name:"New York",woeid:32245234}];beforeEach(function(){var a=$('      <div>        <ul class="trend-location-picker">          <li><button type="button" class="btn-link trend-location-picker-item" href="#"></button></li>        </ul>      </div>    ');this.setupComponent(a,{personalized:!0,location:{woeid:1,name:"Worldwide"}})}),describe("after initialize",function(){beforeEach(function(){spyOnEvent(document,"uiWantsRecentTrendLocations")}),it("should set location",function(){expect(this.component.attr.location.woeid).toEqual(1),expect(this.component.attr.location.name).toEqual("Worldwide")}),it("should set personalized",function(){expect(this.component.attr.personalized).toEqual(!0)}),it("should set $list",function(){expect(this.component.$list).toExist()}),it("should set $template",function(){expect(this.component.$template).not.toBeNull()}),it("should trigger uiWantsRecentTrendLocations",function(){expect("uiWantsRecentTrendLocations").toHaveBeenTriggeredOn(document)})}),describe("event dataGotRecentTrendLocations",function(){describe("when no results returned",function(){beforeEach(function(){$(document).trigger("dataGotRecentTrendLocations",{trendLocations:[]})}),it("should hide the component node",function(){expect(this.component.$node).toBeHidden()}),it("should empty the list",function(){expect(this.component.$list).toBeEmpty()})}),describe("when results returned",function(){beforeEach(function(){$(document).trigger("dataGotRecentTrendLocations",{trendLocations:a})}),it("should show the list element",function(){expect(this.component.select("listContainerSelector")).toBeVisible()}),it("should add each location item",function(){expect(this.component.$list.children().size()).toBe(3)})})})})
});
define("test/app/ui/trends/dialog/with_location_list_picker_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/ui/trends/dialog/with_location_list_picker",function(){beforeEach(function(){var a=$('      <ul class="trend-location-picker">        <li><a class="trend-location-picker-item" href="#" data-woeid="1" data-name="Worldwide">Worldwide</a></li>        <li><a class="trend-location-picker-item" href="#" data-woeid="2" data-name="United States">United States</a></li>        <li><a class="trend-location-picker-item" href="#" data-woeid="3" data-name="United States">New York</a></li>      </ul>    ');this.setupComponent(a)}),describe("event dataChangedTrendLocation",function(){describe("when personalized is false",function(){beforeEach(function(){spyOn(this.component,"showSelected"),this.component.trigger("dataChangedTrendLocation",{personalized:!1,location:{woeid:1,name:"Worldwide"}})}),it("should call showSelected",function(){expect(this.component.showSelected).toHaveBeenCalledWith(1,!1)}),it("should store the location",function(){expect(this.component.attr.location.woeid).toEqual(1),expect(this.component.attr.location.name).toEqual("Worldwide")}),it("should store the personalized field",function(){expect(this.component.attr.personalized).toEqual(!1)})}),describe("#showSelected",function(){describe("when personalized",function(){it("should not select any elements",function(){this.component.showSelected(1,!0),expect(this.component.select("locationSelector").filter(this.component.attr.selectedAttr).length).toBe(0)})}),describe("when not personalized and woeid is present",function(){it("should add class to selected element",function(){this.component.showSelected(1,!1);var a=this.component.select("locationSelector").filter('[data-woeid="1"]');expect(a).toHaveClass(this.component.attr.selectedAttr)})}),describe("when not personalized and woeid is not present",function(){it("should not select any elements",function(){this.component.showSelected(null,!1),expect(this.component.select("locationSelector").filter(this.component.attr.selectedAttr).length).toBe(0)})})}),describe("when personalized is true",function(){beforeEach(function(){spyOn(this.component,"showSelected").andCallThrough(),this.component.trigger("dataChangedTrendLocation",{personalized:!0,location:{woeid:1,name:"Worldwide"}})}),it("should not add a selected class to any item",function(){var a=this.component.select("locationSelector");expect(a).not.toHaveClass(this.component.attr.selectedAttr)})})}),describe("event click",function(){beforeEach(function(){spyOnEvent(document,"uiChangeLocation")}),it("should trigger uiChangeLocation",function(){this.component.select("locationSelector").get(0).click(),expect("uiChangeLocation").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({location:{woeid:1,name:"Worldwide"}}))})})})
});
define("test/app/ui/trends/dialog/location_search_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/trends/dialog/location_search",function(){beforeEach(function(){this.$shell=$('<div class="trends-search-locations trend-locations-section">        <form class="form-search trends-search-form">          <label class="visuallyhidden">Trend location search</label>          <input class="search-input trends-location-search-input" type="text" name="search-locations" placeholder="Search locations" autocomplete="off"></input>          {{>swift_typeahead_dropdown}}        </form>      </div>'),this.setupComponent(this.$shell)}),describe("after initialize",function(){it("should set the $input element",function(){expect(this.component.$input).toBe(this.$shell.find("input"))})}),describe("event uiTypeaheadItemSelected",function(){describe("when a location is returned",function(){var a={item:{name:"Worldwide",woeid:1}};beforeEach(function(){spyOnEvent(this.component.$node,"uiChangeLocation"),this.component.trigger("uiTypeaheadItemSelected",a)}),it("should set the currently selected woeid",function(){expect(this.component.currentSelection).toEqual(a.item)}),it("should trigger uiChangeLocation",function(){expect("uiChangeLocation").toHaveBeenTriggeredOnAndWith(this.component.$node,jasmine.objectContaining({location:a.item}))})}),describe("when not found mock location is returned",function(){beforeEach(function(){spyOnEvent(this.component.$node,"uiChangeLocation"),spyOnEvent(this.component.$node,"uiTrendsLocationSearchNoResults"),this.component.trigger("uiTypeaheadItemSelected",{item:{woeid:-1}})}),it("should trigger uiTrendsLocationSearchNoResults",function(){expect("uiTrendsLocationSearchNoResults").toHaveBeenTriggeredOn(this.component.$node)}),it("should not trigger uiChangeLocation",function(){expect("uiChangeLocation").not.toHaveBeenTriggeredOn()})})}),describe("event uiTypeaheadItemComplete",function(){var a={item:{name:"Worldwide",woeid:1}};beforeEach(function(){spyOnEvent(this.component.$node,"uiChangeLocation"),this.component.trigger("uiTypeaheadItemComplete",a)}),it("should set the currently selected woeid",function(){expect(this.component.currentSelection).toEqual(a.item)}),it("should trigger uiChangeLocation",function(){expect("uiChangeLocation").toHaveBeenTriggeredOnAndWith(this.component.$node,jasmine.objectContaining({location:a.item}))})}),describe("event dataChangedTrendLocation",function(){beforeEach(function(){spyOn(this.component,"reset")}),it("should call reset when location changes",function(){this.component.currentSelection={woeid:2},$(document).trigger("dataChangedTrendLocation",{location:{woeid:1}}),expect(this.component.reset).toHaveBeenCalled()}),it("should not call reset when location is the same",function(){this.component.currentSelection={woeid:1},$(document).trigger("dataChangedTrendLocation",{location:{woeid:1}}),expect(this.component.reset).not.toHaveBeenCalled()})}),describe("#reset",function(){beforeEach(function(){this.component.currentSelection=1,this.component.$input.val("test"),$(document).trigger("uiTrendsDialogReset")}),it("should set the currentSelection to null",function(){expect(this.component.currentSelection).toBeNull()}),it("should set the input value to empty",function(){expect(this.component.$input.val()).toEqual("")})})})
});
define("test/app/ui/trends/dialog/nearby_trends_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/trends/dialog/nearby_trends",function(){beforeEach(function(){this.setupComponent({personalized:!0,location:{woeid:1,name:"Worldwide"}})}),describe("after initialize",function(){it("should set location",function(){expect(this.component.attr.location.woeid).toEqual(1),expect(this.component.attr.location.name).toEqual("Worldwide")}),it("should set personalized",function(){expect(this.component.attr.personalized).toEqual(!0)})})})
});
define("test/app/ui/trends/dialog/location_dropdown_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/trends/dialog/location_dropdown",function(){beforeEach(function(){this.$regions=$('<select name="regions">          <option></option>          <option value="1">Worldwide</option>          <option value="2">United States</option>        </select>'),this.$cities=$('<select name="cities">          <option value="1" data-woeid="1" data-name="Worldwide">All Cities</option>          <option value="2" data-woeid="2" data-name="United States">All Cities</option>          <option value="3" data-woeid="2" data-name="New York">New York</option>          <option value="4" data-woeid="2" data-name="San Francisco">San Francisco</option>        </select>');var a=$("<div></div>");a.append(this.$regions.clone(!1)),a.append(this.$cities.clone(!1)),this.setupComponent(a)}),describe("after initialize",function(){it("should set $regions",function(){expect(this.component.$regions).toExist()}),it("should set $cities",function(){expect(this.component.$cities).toExist()}),it("should setup citiesByRegionWoeid",function(){expect(this.component.citiesByRegionWoeid[1].length).toEqual(1),expect(this.component.citiesByRegionWoeid[2].length).toEqual(3)})}),describe("event change on $regions",function(){beforeEach(function(){spyOnEvent(this.component.$cities,"change"),this.component.$regions.find('option[value="2"]').prop("selected",!0).change()}),it("should update the cities dropdown",function(){var a=this.component.$cities.find("option"),b=$.map(a,function(a){return $(a).val()});expect(b).toEqual(["2","3","4"])}),it("should trigger event change on $cities",function(){expect("change").toHaveBeenTriggeredOn(this.component.$cities)})}),describe("#updateCity",function(){beforeEach(function(){spyOnEvent(document,"uiChangeLocation"),this.component.$cities=this.$cities.clone(!1),this.component.$cities.children().first().prop("selected",!0),this.component.updateCity()}),it("should set the current selection",function(){expect(this.component.currentSelection).toEqual(1)}),it("should trigger uiChangeLocation",function(){expect("uiChangeLocation").toHaveBeenTriggeredOnAndWith(document,jasmine.objectContaining({location:{woeid:1,name:"Worldwide"}}))})}),describe("event dataChangedTrendLocation",function(){beforeEach(function(){spyOn(this.component,"reset"),this.component.currentSelection=1}),it("should call reset when selection changes",function(){$(document).trigger("dataChangedTrendLocation",{location:{woeid:2}}),expect(this.component.reset).toHaveBeenCalled()}),it("should not call reset when selection does not change",function(){$(document).trigger("dataChangedTrendLocation",{location:{woeid:1}}),expect(this.component.reset).not.toHaveBeenCalled()})}),describe("#reset",function(){beforeEach(function(){this.component.currentSelection=2,this.component.reset()}),it("should set currentSelection to null",function(){expect(this.component.currentSelection).toBeNull()}),it("should set the region to empty",function(){expect(this.component.$regions.val()).toEqual("")}),it("should set the city to empty",function(){expect(this.component.$cities.val()).toBeNull()})})})
});
define("test/app/ui/welcome/alerts/phone_create_form_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/welcome/alerts/phone_create_form",function(){beforeEach(function(){var a='<div>\n        <input id="device_carrier_name">\n        <span id="country_code_display"></span>\n        <input id="device_country_intl_prefix">\n        <div id="choose-carrier"><select></select></div>\n        <div id="choose-country"><select></select></div>\n        <div id="choose-language"><select></select></div>\n      </div>\n    ';setupComponent(a,{carrierInfo:{carriers:{Canada:[]},languages:{Canada:[{display:"English",value:"en"},{display:"Français",value:"fr"}]}},defaultCountry:{country:"United States",code:"+1"}})}),it("updates carrier name field after changing carrier",function(){this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"some_carrier",text:"Some Carrier"}),jasmine.Clock.useMock(),jasmine.Clock.tick(1),expect(this.component.$carrierName.attr("value")).toBe("Some Carrier")}),it("empties carrier name fields after changing to a country with no carrier dropdown",function(){this.component.$chooseCarrierSelect.trigger("uiItemSelect",{value:"some_carrier",text:"Some Carrier"}),jasmine.Clock.useMock(),jasmine.Clock.tick(1),this.component.$chooseCountrySelect.trigger("uiItemSelect",{text:"United Kingdom",value:"+1"}),expect(this.component.$carrierName.attr("value")).toBe("")}),it("updates country field after changing country",function(){this.component.$chooseCountrySelect.trigger("uiItemSelect",{text:"Canada",value:"+1"}),jasmine.Clock.useMock(),jasmine.Clock.tick(1),expect(this.component.$countryCodeDisplay.html()).toBe("+1"),expect(this.component.$countryCodeValue.val()).toBe("+1")})})
});
define("test/app/ui/timelines/conversations/descendant_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/timelines/conversations/descendant_timeline",function(){var a='<div id="descendants">\n      <div class="stream-container" data-cursor="100">\n        <div class="stream">\n          <div class="stream-footer">\n            <div class="timeline-end has-more-items"></div>\n            <button class="back-to-top"></button>\n          </div>\n          <div class="stream-fail-container"><a href="#" class="try-again-after-whale">Try again</a></div>\n          <ol id="stream-items-id">\n            <li><div class="tweet" id="item1"></div></li>\n            <li><div class="tweet" id="item2"></div></li>\n          </ol>\n          <ol class="hidden-replies-container"></ol>\n        </div>\n      </div>\n    </div>\n  ',b='<li><div class="tweet" id="item3"></div></li><li><div class="tweet" id="item4"></div></li>\n  ';beforeEach(function(){setupComponent(a,{tweetId:"42"})}),describe("event uiNearTheBottom",function(){beforeEach(function(){spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),$(window).trigger("uiNearTheBottom")}),it("triggers uiWantsMoreTimelineItems",function(){expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.component)}),it("sets requestInProgress to true",function(){expect(this.component.requestInProgress).toBeTruthy()})}),describe("event dataGotMoreTimelineItems",function(){it("appends new items to existing ones",function(){var a=this.component.select("itemsSelector").html();this.$node.trigger("dataGotMoreTimelineItems",{items_html:b}),expect(this.component.select("itemsSelector")).toHaveHtml(a+b.trim())}),it("does not call scrollTop",function(){spyOn(this.component.$window,"scrollTop"),this.$node.trigger("dataGotMoreTimelineItems",{items_html:b}),expect(this.component.$window.scrollTop).not.toHaveBeenCalled()}),it("sets requestInProgress to false",function(){this.component.requestInProgress=!0,this.$node.trigger("dataGotMoreTimelineItems",{items_html:b}),expect(this.component.requestInProgress).toBeFalsy()}),describe("when dataGotMoreTimelineItems is triggered with has_more_items=false",function(){beforeEach(function(){this.$node.trigger("dataGotMoreTimelineItems",{items_html:b,has_more_items:!1})}),it("does not remove stream end",function(){expect(this.component.select("endOfStreamSelector")).toExist()})})}),describe("event dataGotMoreTimelineItemsError",function(){beforeEach(function(){this.component.requestInProgress=!0,this.component.select("errorMessageSelector").hide(),this.component.select("endOfStreamSelector").show(),this.$node.trigger("dataGotMoreTimelineItemsError",{sourceEventData:{}})}),it("shows stream whale",function(){expect(this.component.select("errorMessageSelector")).toBeVisible()}),it("hides stream end",function(){expect(this.component.select("endOfStreamSelector")).not.toBeVisible()}),it("sets requestInProgress to false",function(){expect(this.component.requestInProgress).toBeFalsy()})}),describe("click tryAgainSelector",function(){beforeEach(function(){this.component.select("errorMessageSelector").show(),this.component.select("endOfStreamSelector").hide(),spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.$node.find(".try-again-after-whale").click()}),it("hides stream whale",function(){expect(this.component.select("errorMessageSelector")).not.toBeVisible()}),it("shows stream end",function(){expect(this.component.select("endOfStreamSelector")).toBeVisible()}),it("attempts to fetch old items",function(){expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.$node)})}),describe("cursor pagination",function(){it("sends the original (DOM) cursor with uiWantsMoreTimelineItems",function(){spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.component.getOldItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({cursor:"100",is_forward:!0,query:""}))}),it("sends the returned (ajax) cursor with uiWantsMoreTimelineItems",function(){spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.$node.trigger("dataGotMoreTimelineItems",{items_html:b,cursor:"200",has_more_items:!0}),this.component.getOldItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({cursor:"200",is_forward:!0,query:""}))})}),describe("event dataTweetSuccess",function(){var a="<li><div class='tweet' id='new_tweet'></div></li>\n    ";describe("when the tweet is not a reply to the contextual tweet of the conversation",function(){it("does not append the tweet to the conversation",function(){$(document).trigger("dataTweetSuccess",{tweet_html:a}),expect(this.component.$hiddenRepliesContainer.children().length).toBe(0),expect(this.component.$repliesContainer.children().length).toBe(2)})}),describe("when the tweet is a reply to the contextual tweet of the conversation",function(){var b=function(b,d,e){it("appends "+b,function(){$(document).trigger("dataTweetSuccess",{tweet_html:a,in_reply_to_status_id:this.component.attr.tweetId}),replies=this.component.$repliesContainer.children(),hiddenReplies=this.component.$hiddenRepliesContainer.children(),c.call(this,replies,d),c.call(this,hiddenReplies,e)})},c=function(a,b){expect(a.length).toBe(b.length),b.forEach(function(b,c){expect($(a[c]).find(this.component.attr.tweetSelector)).toHaveId(b)},this)};describe("before reaching the end of the timeline",function(){b("the tweet to the bottom of the hidden replies container",["item1","item2"],["new_tweet"])}),describe("after reaching the end of the timeline",function(){beforeEach(function(){this.component.select("timelineEndSelector").removeClass("has-more-items")}),b("the tweet to the bottom of the timeline",["item1","item2","new_tweet"],[])})})}),describe("event uiHasInjectedOldTimelineItems",function(){var a="<li><div class='tweet' data-tweet-id='15'></div></li>\n      <li><div class='tweet' data-tweet-id='25'></div></li>\n    ",b="<li><div class='tweet' data-tweet-id='10'></div></li>\n      <li><div class='tweet' data-tweet-id='15'></div></li>\n      <li><div class='tweet' data-tweet-id='20'></div></li>\n      <li><div class='tweet' data-tweet-id='30'></div></li>\n      <li><div class='tweet' data-tweet-id='40'></div></li>\n    ";beforeEach(function(){this.component.$repliesContainer.html(a),this.component.$hiddenRepliesContainer.html(b)});var c=function(a,b,c){it("injects "+a,function(){this.$node.trigger("uiHasInjectedOldTimelineItems",{}),d.call(this,this.component.$repliesContainer.children(),b),d.call(this,this.component.$hiddenRepliesContainer.children(),c)})},d=function(a,b){expect(a.length).toBe(b.length),b.forEach(function(b,c){expect($(a[c]).find(this.component.attr.tweetSelector)).toHaveData("tweet-id",b)},this)};describe("when the end of the stream has been reached",function(){beforeEach(function(){this.component.select("timelineEndSelector").removeClass("has-more-items")}),c("all hidden replies in tweet id order",[10,15,20,25,30,40],[])}),describe("when the end of the stream has not yet been reached",function(){c("only hidden replies older then the last tweet",[10,15,20,25],[30,40])})})})
});
define("test/app/ui/timelines/conversations/ancestor_timeline_spec",["module","require","exports"],function(module, require, exports) {
describeComponent("app/ui/timelines/conversations/ancestor_timeline",function(){var a='<div id="ancestors">\n      <div class="stream-container" data-cursor="100">\n        <div class="stream">\n          <div class="stream-footer"></div>\n          <div class="stream-fail-container"><a href="#" class="try-again-after-whale">Try again</a></div>\n          <div id="stream-items-id">\n            <div id="item3"></div>\n            <div id="item4"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',b='<div id="item1"></div><div id="item2"></div>\n  ';beforeEach(function(){setupComponent(a)}),describe("event uiNearTheTop",function(){beforeEach(function(){spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),$(window).trigger("uiNearTheTop")}),it("triggers uiWantsMoreTimelineItems",function(){expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.component)}),it("sets requestInProgress to true",function(){expect(this.component.requestInProgress).toBeTruthy()})}),describe("event dataGotMoreTimelineItems",function(){it("prepends new items to existing ones",function(){var a=this.component.select("itemsSelector").html();this.$node.trigger("dataGotMoreTimelineItems",{items_html:b}),expect(this.component.select("itemsSelector")).toHaveHtml(b.trim()+a)}),it("restores scroll position to what it was before new items were injected",function(){spyOn(this.component.$document,"height").andCallFake(function(){var a=this.second?20:10;return this.second=!0,a}),spyOn(this.component.$window,"scrollTop"),this.$node.trigger("dataGotMoreTimelineItems",{items_html:b}),expect(this.component.$window.scrollTop).toHaveBeenCalledWith(10)}),it("sets requestInProgress to false",function(){this.component.requestInProgress=!0,this.$node.trigger("dataGotMoreTimelineItems",{items_html:b}),expect(this.component.requestInProgress).toBeFalsy()}),describe("when dataGotMoreTimelineItems is triggered with has_more_items=false",function(){beforeEach(function(){this.$node.trigger("dataGotMoreTimelineItems",{items_html:b,has_more_items:!1})}),it("removes stream end",function(){expect(this.component.select("endOfStreamSelector")).not.toExist()})})}),describe("event dataGotMoreTimelineItemsError",function(){beforeEach(function(){this.component.requestInProgress=!0,this.component.select("errorMessageSelector").hide(),this.component.select("endOfStreamSelector").show(),this.$node.trigger("dataGotMoreTimelineItemsError",{sourceEventData:{}})}),it("shows stream whale",function(){expect(this.component.select("errorMessageSelector")).toBeVisible()}),it("hides stream end",function(){expect(this.component.select("endOfStreamSelector")).not.toBeVisible()}),it("sets requestInProgress to false",function(){expect(this.component.requestInProgress).toBeFalsy()})}),describe("click tryAgainSelector",function(){beforeEach(function(){this.component.select("errorMessageSelector").show(),this.component.select("endOfStreamSelector").hide(),spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.$node.find(".try-again-after-whale").click()}),it("hides stream whale",function(){expect(this.component.select("errorMessageSelector")).not.toBeVisible()}),it("shows stream end",function(){expect(this.component.select("endOfStreamSelector")).toBeVisible()}),it("attempts to fetch old items",function(){expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOn(this.$node)})}),describe("cursor pagination",function(){it("sends the original (DOM) cursor with uiWantsMoreTimelineItems",function(){spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.component.getOldItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({cursor:"100",is_forward:!1,query:""}))}),it("sends the returned (ajax) cursor with uiWantsMoreTimelineItems",function(){spyOnEvent(this.$node,"uiWantsMoreTimelineItems"),this.$node.trigger("dataGotMoreTimelineItems",{items_html:b,cursor:"200",has_more_items:!0}),this.component.getOldItems(),expect("uiWantsMoreTimelineItems").toHaveBeenTriggeredOnAndWith(this.$node,jasmine.objectContaining({cursor:"200",is_forward:!1,query:""}))})})})
});
define("test/app/utils/storage/array/with_max_elements_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/utils/storage/array/with_max_elements",function(){var a;beforeEach(function(){setupComponent(),a=null,this.component.setItem=function(b,c){a=c},this.component.getItem=function(){return a},this.component.setMaxElements("array",3)}),describe("push()",function(){it("evicts elements from the front of the array",function(){a=null;for(var b=0;b<=6;b++)this.component.push("array",b);expect(a).toEqual([4,5,6])})}),describe("pushAll()",function(){it("evicts elements from the front of the array if more than max elements are pushed over multiple calls",function(){this.component.pushAll("array",[1,2,3]),this.component.pushAll("array",[4,5,6]),expect(a).toEqual([4,5,6])}),it("evicts elements from the front of the array if more than max elements are pushed in one call",function(){this.component.pushAll("array",[1,2,3,4,5,6]),expect(a).toEqual([4,5,6])})})})
});
define("test/app/utils/storage/array/with_array_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/utils/storage/array/with_array",function(){beforeEach(function(){setupComponent(),this.component.setItem=this.component.getItem=function(){}}),describe("push()",function(){it("can push a value",function(){spyOn(this.component,"setItem"),expect(this.component.push("array","a")).toEqual(1),expect(this.component.setItem).toHaveBeenCalledWith("array",["a"])})}),describe("pushAll()",function(){it("can push multiple values",function(){spyOn(this.component,"setItem"),expect(this.component.pushAll("array",["a","b"])).toEqual(["a","b"]),expect(this.component.setItem).toHaveBeenCalledWith("array",["a","b"])})})})
});
define("test/app/utils/storage/array/with_unique_elements_spec",["module","require","exports"],function(module, require, exports) {
describeMixin("app/utils/storage/array/with_unique_elements",function(){var a;beforeEach(function(){setupComponent(),a=null,this.component.setItem=function(b,c){a=c},this.component.getItem=function(){return a}}),describe("push()",function(){it("does not allow duplicate elements",function(){for(var b=0;b<4;b++)this.component.push("array",b%2);expect(a).toEqual([0,1])})}),describe("pushAll()",function(){it("does not allow duplicate elements if duplicate elements are pushed over multiple calls",function(){this.component.pushAll("array",[1,2]),this.component.pushAll("array",[1,2]),this.component.pushAll("array",[2,3]),expect(a).toEqual([1,2,3])}),it("does not allow duplicate elements if duplicate elements are pushed in one call",function(){this.component.pushAll("array",[1,2,1,2,2,3]),expect(a).toEqual([1,2,3])})})})
});
define("app/data/welcome/preview_stream_scribe",["module","require","exports","core/component","app/data/with_scribe"],function(module, require, exports) {
function previewStreamScribe(){this.scribeOpen=function(a,b){this.scribe({component:"preview_stream_dialog",action:"open"},{context:this.attr.sectionCategoryName})},this.after("initialize",function(){this.on("dataWelcomeStreamPreviewSuccess",this.scribeOpen)})}var defineComponent=require("core/component"),withScribe=require("app/data/with_scribe");module.exports=defineComponent(previewStreamScribe,withScribe)
});
define("app/ui/welcome/with_nav_buttons",["module","require","exports"],function(module, require, exports) {
function withNavButtons(){this.defaultAttrs({buttonSelector:".btn",prevButtonSelector:".js-prev-btn",nextButtonSelector:".js-next-btn"}),this.didClickButton=function(a,b){var c=$(a.target);c.attr("aria-disabled")?(a.preventDefault(),a.stopImmediatePropagation()):c.is(this.attr.prevButtonSelector)?this.trigger("uiWelcomeNavPrevClicked"):c.is(this.attr.nextButtonSelector)&&this.trigger("uiWelcomeNavNextClicked",{finished:c.data("finished")})},this.setPrevButton=function(a,b){this.setButton(this.select("prevButtonSelector"),b)},this.setNextButton=function(a,b){this.setButton(this.select("nextButtonSelector"),b)},this.setButton=function(a,b){b.href!==undefined&&a.attr("href",b.href),b.primary!==undefined&&a.toggleClass("primary-btn",b.primary),b.enabled!==undefined&&a.attr("aria-disabled",!b.enabled)},this.after("initialize",function(){this.on(document,"uiSetWelcomePrevButton",this.setPrevButton),this.on(document,"uiSetWelcomeNextButton",this.setNextButton),this.on("click",{buttonSelector:this.didClickButton})})}module.exports=withNavButtons
});
define("app/ui/welcome/interests_category_flow_nav",["module","require","exports","core/component","app/ui/welcome/with_nav_buttons"],function(module, require, exports) {
function interestsCategoryFlowNav(){this.maybeShowInvitingDialog=function(a){this.shouldShowInvitingDialog&&(a.preventDefault(),a.stopImmediatePropagation(),this.trigger("uiWelcomeShowInviting",{successPath:this.select("nextButtonSelector").attr("href")}))},this.setInvitingBit=function(a,b){b.unmatched_contacts_count==0?this.shouldShowInvitingDialog=!1:b.unmatched_contacts_count>0&&(this.shouldShowInvitingDialog=!0)},this.clearInvitingBit=function(){this.shouldShowInvitingDialog=!1},this.after("initialize",function(){this.shouldShowInvitingDialog=!1,this.on(document,"dataWelcomeMoreResultsSuccess",this.setInvitingBit),this.on(document,"uiWelcomeShowInviting",this.clearInvitingBit),this.on("click",{nextButtonSelector:this.maybeShowInvitingDialog})})}var defineComponent=require("core/component"),withNavButtons=require("app/ui/welcome/with_nav_buttons");module.exports=defineComponent(interestsCategoryFlowNav,withNavButtons)
});
define("app/ui/welcome/with_similarities",["module","require","exports"],function(module, require, exports) {
function withSimilarities(){this.defaultAttrs({notFollowingFollowButtonSelector:".not-following .js-follow-btn"}),this.askForSimilarities=function(a,b){var c=$(a.target),d=c.closest(".user-actions"),e=c.closest(".welcome-card"),f=d.attr("data-user-id");this.trigger(e,"uiWantsWelcomeSimilaritiesCard",{userId:f})},this.showSimilarities=function(a,b){var c=$(a.target),d=$(b.html);d.insertAfter(c),d.find(".welcome-results").hide().slideDown()},this.after("initialize",function(){this.on("dataWelcomeSimilaritiesCardSuccess",this.showSimilarities),this.on("mousedown",{notFollowingFollowButtonSelector:this.askForSimilarities})})}module.exports=withSimilarities
});
define("app/ui/capped_file_upload",["module","require","exports","core/component"],function(module, require, exports) {
function cappedFileUpload(){this.validateUpload=function(a,b){if(!a.target.files||!a.target.files.length){this.trigger("fileUploaded");return}var c=a.target.files[0],d=c.size||c.fileSize,e=c.name||c.fileName;d&&d>this.attr.maxSize?($(a.target).val(null),this.trigger("uiAlertBanner",{message:this.attr.message}),typeof this.attr.error=="function"&&this.attr.error()):this.trigger("fileUploaded",{name:e})},this.after("initialize",function(){this.on("change",this.validateUpload)})}var defineComponent=require("core/component"),CappedFileUpload=defineComponent(cappedFileUpload);module.exports=CappedFileUpload
});